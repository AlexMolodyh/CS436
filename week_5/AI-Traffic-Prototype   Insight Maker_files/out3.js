var requirejs,require,define;(function(a){function b(a){return"[object Function]"===J.call(a)}function c(a){return"[object Array]"===J.call(a)}function d(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function e(a,b){if(a){var c;for(c=a.length-1;-1<c&&(!a[c]||!b(a[c],c,a));c-=1);}}function f(a,b){return O.call(a,b)}function g(a,b){return f(a,b)&&a[b]}function k(a,b){for(var c in a)if(f(a,c)&&b(a[c],c))break}function l(a,b,c,d){b&&k(b,function(b,e){if(c||!f(a,e))d&&"string"!==typeof b?(a[e]||(a[e]={}),l(a[e],b,c,d)):a[e]=b});return a}function m(a,b){return function(){return b.apply(a,arguments)}}function n(a){throw a;}function p(b){if(!b)return b;var c=a;d(b.split("."),function(a){c=c[a]});return c}function q(a,b,c,d){b=Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);b.requireType=a;b.requireModules=d;c&&(b.originalError=c);return b}function u(e){function u(a,b,c){var d,e,f,k,l,m,n,p=b&&b.split("/"),q=W.map,r=q&&q["*"];if(a&&"."===a.charAt(0))if(b){d=g(W.pkgs,b)?p=[b]:p.slice(0,p.length-1);b=a=d.concat(a.split("/"));for(d=0;b[d];d+=1)if(e=b[d],"."===e)b.splice(d,1),d-=1;else if(".."===e)if(1!==d||".."!==b[2]&&".."!==b[0])0<d&&(b.splice(d-1,2),d-=2);else break;d=g(W.pkgs,b=a[0]);a=a.join("/");d&&a===b+"/"+d.main&&(a=b)}else 0===a.indexOf("./")&&(a=a.substring(2));if(c&&q&&(p||r)){b=a.split("/");for(d=b.length;0<d;d-=1){f=b.slice(0,d).join("/");if(p)for(e=p.length;0<e;e-=1)if(c=g(q,p.slice(0,e).join("/")))if(c=g(c,f)){k=c;l=d;break}if(k)break;!m&&r&&g(r,f)&&(m=g(r,f),n=d)}!k&&m&&(k=m,l=n);k&&(b.splice(0,l,k),a=b.join("/"))}return a}function x(a){N&&d(document.getElementsByTagName("script"),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===V.contextName)return b.parentNode.removeChild(b),!0})}function F(a){var b=g(W.paths,a);if(b&&c(b)&&1<b.length)return x(a),b.shift(),V.require.undef(a),V.require([a]),!0}function z(a){var b,c=a?a.indexOf("!"):-1;-1<c&&(b=a.substring(0,c),a=a.substring(c+1,a.length));return[b,a]}function B(a,b,c,d){var e,f,k=null,l=b?b.name:null,m=a,n=!0,p="";a||(n=!1,a="_@r"+(Ea+=1));a=z(a);k=a[0];a=a[1];k&&(k=u(k,l,d),f=g(ea,k));a&&(k?p=f&&f.normalize?f.normalize(a,function(a){return u(a,l,d)}):u(a,l,d):(p=u(a,l,d),a=z(p),k=a[0],p=a[1],c=!0,e=V.nameToUrl(p)));c=!k||f||c?"":"_unnormalized"+(Fa+=1);return{prefix:k,name:p,parentMap:b,unnormalized:!!c,url:e,originalName:m,isDefine:n,id:(k?k+"!"+p:p)+c}}function y(a){var b=a.id,c=g(da,b);c||(c=da[b]=new V.Module(a));return c}function C(a,b,c){var d=a.id,e=g(da,d);if(!f(ea,d)||e&&!e.defineEmitComplete)if(e=y(a),e.error&&"error"===b)c(e.error);else e.on(b,c);else"defined"===b&&c(ea[d])}function r(a,b){var c=a.requireModules,e=!1;if(b)b(a);else if(d(c,function(b){if(b=g(da,b))b.error=a,b.events.error&&(e=!0,b.emit("error",a))}),!e)v.onError(a)}function I(){pa.length&&(Q.apply(ua,[ua.length-1,0].concat(pa)),pa=[])}function A(a){delete da[a];delete va[a]}function E(a,b,c){var e=a.map.id;a.error?a.emit("error",a.error):(b[e]=!0,d(a.depMaps,function(d,e){var f=d.id,k=g(da,f);k&&!a.depMatched[e]&&!c[f]&&(g(b,f)?(a.defineDep(e,ea[f]),a.check()):E(k,b,c))}),c[e]=!0)}function J(){var a,b,c,e,f=(c=1E3*W.waitSeconds)&&V.startTime+c<(new Date).getTime(),g=[],l=[],m=!1,n=!0;if(!S){S=!0;k(va,function(c){a=c.map;b=a.id;if(c.enabled&&(a.isDefine||l.push(c),!c.error))if(!c.inited&&f)F(b)?m=e=!0:(g.push(b),x(b));else if(!c.inited&&c.fetched&&a.isDefine&&(m=!0,!a.prefix))return n=!1});if(f&&g.length)return c=q("timeout","Load timeout for modules: "+g,null,g),c.contextName=V.contextName,r(c);n&&d(l,function(a){E(a,{},{})});f&&!e||!m||!N&&!M||Ga||(Ga=setTimeout(function(){Ga=0;J()},50));S=!1}}function G(a){f(ea,a[0])||y(B(a[0],null,!0)).init(a[1],a[2])}function O(a){a=a.currentTarget||a.srcElement;var b=V.onScriptLoad;a.detachEvent&&!U?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=V.onScriptError;a.detachEvent&&!U||a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function L(){var a;for(I();ua.length;){a=ua.shift();if(null===a[0])return r(q("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));G(a)}}var S,Aa,V,wa,Ga,W={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},da={},va={},Ha={},ua=[],ea={},la={},Ea=1,Fa=1;wa={require:function(a){return a.require?a.require:a.require=V.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?a.exports:a.exports=ea[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){var b=g(W.pkgs,a.map.id);return(b?g(W.config,a.map.id+"/"+b.main):g(W.config,a.map.id))||{}},exports:ea[a.map.id]}}};Aa=function(a){this.events=g(Ha,a.id)||{};this.map=a;this.shim=g(W.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};Aa.prototype={init:function(a,b,c,d){d=d||{};if(!this.inited){this.factory=b;if(c)this.on("error",c);else this.events.error&&(c=m(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.errback=c;this.inited=!0;this.ignore=d.ignore;d.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;V.startTime=(new Date).getTime();var a=this.map;if(this.shim)V.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],m(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;la[a]||(la[a]=!0,V.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,c,d=this.map.id;c=this.depExports;var e=this.exports,f=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(b(f)){if(this.events.error&&this.map.isDefine||v.onError!==n)try{e=V.execCb(d,f,c,e)}catch(g){a=g}else e=V.execCb(d,f,c,e);this.map.isDefine&&((c=this.module)&&void 0!==c.exports&&c.exports!==this.exports?e=c.exports:void 0===e&&this.usingExports&&(e=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",r(this.error=a)}else e=f;this.exports=e;if(this.map.isDefine&&!this.ignore&&(ea[d]=e,v.onResourceLoad))v.onResourceLoad(V,this.map,this.depMaps);A(d);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,c=B(a.prefix);this.depMaps.push(c);C(c,"defined",m(this,function(c){var d,e;e=this.map.name;var l=this.map.parentMap?this.map.parentMap.name:null,n=V.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(c.normalize&&(e=c.normalize(e,function(a){return u(a,l,!0)})||""),c=B(a.prefix+"!"+e,this.map.parentMap),C(c,"defined",m(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),e=g(da,c.id)){this.depMaps.push(c);if(this.events.error)e.on("error",m(this,function(a){this.emit("error",a)}));e.enable()}}else d=m(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),d.error=m(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];k(da,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&A(a.map.id)});r(a)}),d.fromText=m(this,function(c,e){var g=a.name,k=B(g),l=sa;e&&(c=e);l&&(sa=!1);y(k);f(W.config,b)&&(W.config[g]=W.config[b]);try{v.exec(c)}catch(m){return r(q("fromtexteval","fromText eval for "+b+" failed: "+m,m,[b]))}l&&(sa=!0);this.depMaps.push(k);V.completeLoad(g);n([g],d)}),c.load(a.name,n,d,W)}));V.enable(c,this);this.pluginMaps[c.id]=c},enable:function(){va[this.map.id]=this;this.enabling=this.enabled=!0;d(this.depMaps,m(this,function(a,b){var c,d;if("string"===typeof a){a=B(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=g(wa,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;C(a,"defined",m(this,function(a){this.defineDep(b,a);this.check()}));this.errback&&C(a,"error",m(this,this.errback))}c=a.id;d=da[c];!f(wa,c)&&d&&!d.enabled&&V.enable(a,this)}));k(this.pluginMaps,m(this,function(a){var b=g(da,a.id);b&&!b.enabled&&V.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){d(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};V={config:W,contextName:e,registry:da,defined:ea,urlFetched:la,defQueue:ua,Module:Aa,makeModuleMap:B,nextTick:v.nextTick,onError:r,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=W.pkgs,e=W.shim,f={paths:!0,config:!0,map:!0};k(a,function(a,b){f[b]?"map"===b?(W.map||(W.map={}),l(W[b],a,!0,!0)):l(W[b],a,!0):W[b]=a});a.shim&&(k(a.shim,function(a,b){c(a)&&(a={deps:a});!a.exports&&!a.init||a.exportsFn||(a.exportsFn=V.makeShimExports(a));e[b]=a}),W.shim=e);a.packages&&(d(a.packages,function(a){a="string"===typeof a?{name:a}:a;b[a.name]={name:a.name,location:a.location||a.name,main:(a.main||"main").replace(P,"").replace(H,"")}}),W.pkgs=b);k(da,function(a,b){a.inited||a.map.unnormalized||(a.map=B(b))});(a.deps||a.callback)&&V.require(a.deps||[],a.callback)},makeShimExports:function(b){return function(){var c;b.init&&(c=b.init.apply(a,arguments));return c||b.exports&&p(b.exports)}},makeRequire:function(a,c){function d(g,k,l){var m,n;c.enableBuildCallback&&k&&b(k)&&(k.__requireJsBuild=!0);if("string"===typeof g){if(b(k))return r(q("requireargs","Invalid require call"),l);if(a&&f(wa,g))return wa[g](da[a.id]);if(v.get)return v.get(V,g,a,d);m=B(g,a,!1,!0);m=m.id;return f(ea,m)?ea[m]:r(q("notloaded",'Module name "'+m+'" has not been loaded yet for context: '+e+(a?"":". Use require([])")))}L();V.nextTick(function(){L();n=y(B(null,a));n.skipMap=c.skipMap;n.init(g,k,l,{enabled:!0});J()});return d}c=c||{};l(d,{isBrowser:N,toUrl:function(b){var c,d=b.lastIndexOf("."),e=b.split("/")[0];-1!==d&&("."!==e&&".."!==e||1<d)&&(c=b.substring(d,b.length),b=b.substring(0,d));return V.nameToUrl(u(b,a&&a.id,!0),c,!0)},defined:function(b){return f(ea,B(b,a,!1,!0).id)},specified:function(b){b=B(b,a,!1,!0).id;return f(ea,b)||f(da,b)}});a||(d.undef=function(b){I();var c=B(b,a,!0),d=g(da,b);delete ea[b];delete la[c.url];delete Ha[b];d&&(d.events.defined&&(Ha[b]=d.events),A(b))});return d},enable:function(a){g(da,a.id)&&y(a).enable()},completeLoad:function(a){var b,c,d=g(W.shim,a)||{},e=d.exports;for(I();ua.length;){c=ua.shift();if(null===c[0]){c[0]=a;if(b)break;b=!0}else c[0]===a&&(b=!0);G(c)}c=g(da,a);if(!b&&!f(ea,a)&&c&&!c.inited){if(W.enforceDefine&&(!e||!p(e)))return F(a)?void 0:r(q("nodefine","No define call for "+a,null,[a]));G([a,d.deps||[],d.exportsFn])}J()},nameToUrl:function(a,b,d){var e,f,k,l,m,n;if(v.jsExtRegExp.test(a))l=a+(b||"");else{e=W.paths;f=W.pkgs;l=a.split("/");for(m=l.length;0<m;m-=1)if(n=l.slice(0,m).join("/"),k=g(f,n),n=g(e,n)){c(n)&&(n=n[0]);l.splice(0,m,n);break}else if(k){a=a===k.name?k.location+"/"+k.main:k.location;l.splice(0,m,a);break}l=l.join("/");l+=b||(/\?/.test(l)||d?"":".js");l=("/"===l.charAt(0)||l.match(/^[\w\+\.\-]+:/)?"":W.baseUrl)+l}return W.urlArgs?l+((-1===l.indexOf("?")?"?":"&")+W.urlArgs):l},load:function(a,b){v.load(V,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||R.test((a.currentTarget||a.srcElement).readyState))D=null,a=O(a),V.completeLoad(a.id)},onScriptError:function(a){var b=O(a);if(!F(b.id))return r(q("scripterror","Script error for: "+b.id,a,[b.id]))}};V.require=V.makeRequire();return V}var v,y,z,x,B,A,D,E,G,C,F=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,I=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,H=/\.js$/,P=/^\.\//;y=Object.prototype;var J=y.toString,O=y.hasOwnProperty,Q=Array.prototype.splice,N=!("undefined"===typeof window||!navigator||!window.document),M=!N&&"undefined"!==typeof importScripts,R=N&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,U="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),S={},L={},pa=[],sa=!1;if("undefined"===typeof define){if("undefined"!==typeof requirejs){if(b(requirejs))return;L=requirejs;requirejs=void 0}"undefined"!==typeof require&&!b(require)&&(L=require,require=void 0);v=requirejs=function(a,b,d,e){var f,k="_";!c(a)&&"string"!==typeof a&&(f=a,c(b)?(a=b,b=d,d=e):a=[]);f&&f.context&&(k=f.context);(e=g(S,k))||(e=S[k]=v.s.newContext(k));f&&e.configure(f);return e.require(a,b,d)};v.config=function(a){return v(a)};v.nextTick="undefined"!==typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()};require||(require=v);v.version="2.1.8";v.jsExtRegExp=/^\/|:|\?|\.js$/;v.isBrowser=N;y=v.s={contexts:S,newContext:u};v({});d(["toUrl","undef","defined","specified"],function(a){v[a]=function(){var b=S._;return b.require[a].apply(b,arguments)}});N&&(z=y.head=document.getElementsByTagName("head")[0],x=document.getElementsByTagName("base")[0])&&(z=y.head=x.parentNode);v.onError=n;v.createNode=function(a){var b=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");b.type=a.scriptType||"text/javascript";b.charset="utf-8";b.async=!0;return b};v.load=function(a,b,c){var d=a&&a.config||{};if(N)return d=v.createNode(d,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&0>d.attachEvent.toString().indexOf("[native code")||U?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(sa=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,E=d,x?z.insertBefore(d,x):z.appendChild(d),E=null,d;if(M)try{importScripts(c),a.completeLoad(b)}catch(e){a.onError(q("importscripts","importScripts failed for "+b+" at "+c,e,[b]))}};N&&e(document.getElementsByTagName("script"),function(a){z||(z=a.parentNode);if(B=a.getAttribute("data-main"))return G=B,L.baseUrl||(A=G.split("/"),G=A.pop(),C=A.length?A.join("/")+"/":"./",L.baseUrl=C),G=G.replace(H,""),v.jsExtRegExp.test(G)&&(G=B),L.deps=L.deps?L.deps.concat(G):[G],!0});define=function(a,d,f){var g,k;"string"!==typeof a&&(f=d,d=a,a=null);c(d)||(f=d,d=null);!d&&b(f)&&(d=[],f.length&&(f.toString().replace(F,"").replace(I,function(a,b){d.push(b)}),d=(1===f.length?["require"]:["require","exports","module"]).concat(d)));sa&&((g=E)||(D&&"interactive"===D.readyState||e(document.getElementsByTagName("script"),function(a){if("interactive"===a.readyState)return D=a}),g=D),g&&(a||(a=g.getAttribute("data-requiremodule")),k=S[g.getAttribute("data-requirecontext")]));(k?k.defQueue:pa).push([a,d,f])};define.amd={jQuery:!0};v.exec=function(a){return eval(a)};v(L)}})(this);var translations={};function getText(a){translations[a]&&(a=translations[a]);for(var b=1;b<arguments.length;b++)a=a.replace("%s",arguments[b]);return a};var graph,primitiveBank={},defaultSolver='{"enabled": false, "algorithm": "RK1", "timeStep": 1}',doc=document.implementation.createDocument("","",null);primitiveBank.text=doc.createElement("Text");primitiveBank.text.setAttribute("name",getText("Text Area"));primitiveBank.text.setAttribute("LabelPosition","Middle");primitiveBank.folder=doc.createElement("Folder");primitiveBank.folder.setAttribute("name",getText("New Folder"));primitiveBank.folder.setAttribute("Note","");primitiveBank.folder.setAttribute("Type","None");primitiveBank.folder.setAttribute("Solver",defaultSolver);primitiveBank.folder.setAttribute("Image","None");primitiveBank.folder.setAttribute("FlipHorizontal",!1);primitiveBank.folder.setAttribute("FlipVertical",!1);primitiveBank.folder.setAttribute("LabelPosition","Middle");primitiveBank.folder.setAttribute("AgentBase","");primitiveBank.ghost=doc.createElement("Ghost");primitiveBank.ghost.setAttribute("Source","");primitiveBank.picture=doc.createElement("Picture");primitiveBank.picture.setAttribute("name","");primitiveBank.picture.setAttribute("Note","");primitiveBank.picture.setAttribute("Image","Growth");primitiveBank.picture.setAttribute("FlipHorizontal",!1);primitiveBank.picture.setAttribute("FlipVertical",!1);primitiveBank.picture.setAttribute("LabelPosition","Bottom");primitiveBank.display=doc.createElement("Display");primitiveBank.display.setAttribute("name",getText("Default Display"));primitiveBank.display.setAttribute("Note","");primitiveBank.display.setAttribute("Type","Time Series");primitiveBank.display.setAttribute("xAxis",getText("Time")+" (%u)");primitiveBank.display.setAttribute("yAxis","");primitiveBank.display.setAttribute("yAxis2","");primitiveBank.display.setAttribute("showMarkers",!1);primitiveBank.display.setAttribute("showLines",!0);primitiveBank.display.setAttribute("showArea",!1);primitiveBank.display.setAttribute("ThreeDimensional",!1);primitiveBank.display.setAttribute("Primitives","");primitiveBank.display.setAttribute("Primitives2","");primitiveBank.display.setAttribute("AutoAddPrimitives",!1);primitiveBank.display.setAttribute("ScatterplotOrder","X Primitive, Y Primitive");primitiveBank.display.setAttribute("Image","Display");primitiveBank.display.setAttribute("FlipHorizontal",!1);primitiveBank.display.setAttribute("FlipVertical",!1);primitiveBank.display.setAttribute("LabelPosition","Bottom");primitiveBank.display.setAttribute("legendPosition","Automatic");function setValuedProperties(a){a.setAttribute("Units","Unitless");a.setAttribute("MaxConstraintUsed",!1);a.setAttribute("MinConstraintUsed",!1);a.setAttribute("MaxConstraint","100");a.setAttribute("MinConstraint","0");a.setAttribute("ShowSlider",!1);a.setAttribute("SliderMax",100);a.setAttribute("SliderMin",0);a.setAttribute("SliderStep","")}primitiveBank.stock=doc.createElement("Stock");primitiveBank.stock.setAttribute("name",getText("New Stock"));primitiveBank.stock.setAttribute("Note","");primitiveBank.stock.setAttribute("InitialValue","0");primitiveBank.stock.setAttribute("StockMode","Store");primitiveBank.stock.setAttribute("Delay","10");primitiveBank.stock.setAttribute("Volume","100");primitiveBank.stock.setAttribute("NonNegative",!1);setValuedProperties(primitiveBank.stock);primitiveBank.stock.setAttribute("Image","None");primitiveBank.stock.setAttribute("FlipHorizontal",!1);primitiveBank.stock.setAttribute("FlipVertical",!1);primitiveBank.stock.setAttribute("LabelPosition","Middle");primitiveBank.state=doc.createElement("State");primitiveBank.state.setAttribute("name",getText("New State"));primitiveBank.state.setAttribute("Note","");primitiveBank.state.setAttribute("Active","false");primitiveBank.state.setAttribute("Residency","0");primitiveBank.state.setAttribute("Image","None");primitiveBank.state.setAttribute("FlipHorizontal",!1);primitiveBank.state.setAttribute("FlipVertical",!1);primitiveBank.state.setAttribute("LabelPosition","Middle");primitiveBank.transition=doc.createElement("Transition");primitiveBank.transition.setAttribute("name",getText("Transition"));primitiveBank.transition.setAttribute("Note","");primitiveBank.transition.setAttribute("Trigger","Timeout");primitiveBank.transition.setAttribute("Value","1");primitiveBank.transition.setAttribute("Repeat",!1);primitiveBank.transition.setAttribute("Recalculate",!1);setValuedProperties(primitiveBank.transition);primitiveBank.action=doc.createElement("Action");primitiveBank.action.setAttribute("name",getText("New Action"));primitiveBank.action.setAttribute("Note","");primitiveBank.action.setAttribute("Trigger","Probability");primitiveBank.action.setAttribute("Value","0.5");primitiveBank.action.setAttribute("Repeat",!0);primitiveBank.action.setAttribute("Recalculate",!1);primitiveBank.action.setAttribute("Action","Self.Move({Rand(), Rand()})");primitiveBank.agents=doc.createElement("Agents");primitiveBank.agents.setAttribute("name",getText("New Agent Population"));primitiveBank.agents.setAttribute("Note","");primitiveBank.agents.setAttribute("Size",100);primitiveBank.agents.setAttribute("GeoWrap",!1);primitiveBank.agents.setAttribute("GeoDimUnits","Unitless");primitiveBank.agents.setAttribute("GeoWidth",200);primitiveBank.agents.setAttribute("GeoHeight",100);primitiveBank.agents.setAttribute("Placement","Random");primitiveBank.agents.setAttribute("PlacementFunction","{Rand()*Width(Self), Rand()*Height(Self)}");primitiveBank.agents.setAttribute("Network","None");primitiveBank.agents.setAttribute("NetworkFunction","RandBoolean(0.02)");primitiveBank.agents.setAttribute("Agent","");primitiveBank.agents.setAttribute("Image","None");primitiveBank.agents.setAttribute("FlipHorizontal",!1);primitiveBank.agents.setAttribute("FlipVertical",!1);primitiveBank.agents.setAttribute("LabelPosition","Middle");primitiveBank.agents.setAttribute("ShowSlider",!1);primitiveBank.agents.setAttribute("SliderMax",100);primitiveBank.agents.setAttribute("SliderMin",0);primitiveBank.agents.setAttribute("SliderStep",1);primitiveBank.variable=doc.createElement("Variable");primitiveBank.variable.setAttribute("name",getText("New Variable"));primitiveBank.variable.setAttribute("Note","");primitiveBank.variable.setAttribute("Equation","0");setValuedProperties(primitiveBank.variable);primitiveBank.variable.setAttribute("Image","None");primitiveBank.variable.setAttribute("FlipHorizontal",!1);primitiveBank.variable.setAttribute("FlipVertical",!1);primitiveBank.variable.setAttribute("LabelPosition","Middle");primitiveBank.button=doc.createElement("Button");primitiveBank.button.setAttribute("name",getText("New Button"));primitiveBank.button.setAttribute("Note","");primitiveBank.button.setAttribute("Function",'showMessage("Button action triggered!\\n\\nIf you want to edit this Action, click on the button while holding down the Shift key on your keyboard.")');primitiveBank.button.setAttribute("Image","None");primitiveBank.button.setAttribute("FlipHorizontal",!1);primitiveBank.button.setAttribute("FlipVertical",!1);primitiveBank.button.setAttribute("LabelPosition","Middle");primitiveBank.converter=doc.createElement("Converter");primitiveBank.converter.setAttribute("name",getText("New Converter"));primitiveBank.converter.setAttribute("Note","");primitiveBank.converter.setAttribute("Source","Time");primitiveBank.converter.setAttribute("Data","0,0; 1,1; 2,4; 3,9");primitiveBank.converter.setAttribute("Interpolation","Linear");setValuedProperties(primitiveBank.converter);primitiveBank.converter.setAttribute("Image","None");primitiveBank.converter.setAttribute("FlipHorizontal",!1);primitiveBank.converter.setAttribute("FlipVertical",!1);primitiveBank.converter.setAttribute("LabelPosition","Middle");primitiveBank.flow=doc.createElement("Flow");primitiveBank.flow.setAttribute("name",getText("Flow"));primitiveBank.flow.setAttribute("Note","");primitiveBank.flow.setAttribute("FlowRate","0");primitiveBank.flow.setAttribute("OnlyPositive",!0);primitiveBank.flow.setAttribute("TimeIndependent",!1);setValuedProperties(primitiveBank.flow);primitiveBank.link=doc.createElement("Link");primitiveBank.link.setAttribute("name",getText("Link"));primitiveBank.link.setAttribute("Note","");primitiveBank.link.setAttribute("BiDirectional",!1);primitiveBank.setting=doc.createElement("Setting");primitiveBank.setting.setAttribute("Note","");primitiveBank.setting.setAttribute("Version","36");primitiveBank.setting.setAttribute("Throttle","1");primitiveBank.setting.setAttribute("TimeLength","100");primitiveBank.setting.setAttribute("TimeStart","0");primitiveBank.setting.setAttribute("TimeStep","1");primitiveBank.setting.setAttribute("TimeUnits","Years");primitiveBank.setting.setAttribute("Units","");primitiveBank.setting.setAttribute("SolutionAlgorithm","RK1");primitiveBank.setting.setAttribute("BackgroundColor","white");primitiveBank.setting.setAttribute("Macros","");primitiveBank.setting.setAttribute("SensitivityPrimitives","");primitiveBank.setting.setAttribute("SensitivityRuns",50);primitiveBank.setting.setAttribute("SensitivityBounds","50, 80, 95, 100");primitiveBank.setting.setAttribute("SensitivityShowRuns","false");primitiveBank.setting.setAttribute("StrictUnits","true");primitiveBank.setting.setAttribute("StrictLinks","true");primitiveBank.setting.setAttribute("StrictAgentResolution","true");primitiveBank.setting.setAttribute("StyleSheet","{}");var blankGraphTemplate='<mxGraphModel>\n  <root>\n    <mxCell id="0"/>\n    <mxCell id="1" parent="0"/>\n    <Folder name="Step 2. Share your Insights" Note="" Type="None" Solver="{&quot;enabled&quot;: false, &quot;algorithm&quot;: &quot;RK1&quot;, &quot;timeStep&quot;: 1}" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Top" AgentBase="" id="44">\n      <mxCell style="folder;dashed=0;fontSize=18;fontFamily=Verdana;fontStyle=1;rounded=0;strokeColor=#C0C0C0;strokeWidth=1;30=10;fillColor=#FFFFFF" parent="1" vertex="1">\n        <mxGeometry x="710" y="90" width="320" height="522" as="geometry"/>\n      </mxCell>\n    </Folder>\n    <Setting Note="" Version="34" TimeLength="20" TimeStart="0" TimeStep="1" TimeUnits="Years" StrictUnits="true" StrictLinks="true" StrictAgentResolution="true" Units="" HiddenUIGroups="Validation,User Interface" SolutionAlgorithm="RK1" BackgroundColor="white" Throttle="1" Macros="" SensitivityPrimitives="" SensitivityRuns="50" SensitivityBounds="50, 80, 95, 100" SensitivityShowRuns="false" id="2">\n      <mxCell parent="1" vertex="1" visible="0">\n        <mxGeometry x="20" y="20" width="80" height="40" as="geometry"/>\n      </mxCell>\n    </Setting>\n    <Display name="Default Display" Note="" Type="Time Series" xAxis="Time (%u)" yAxis="%o" ThreeDimensional="false" Primitives="35" AutoAddPrimitives="true" ScatterplotOrder="X Primitive, Y Primitive" Image="Display" yAxis2="" Primitives2="" showMarkers="false" showLines="true" showArea="false" legendPosition="None" id="3">\n      <mxCell style="roundImage;image=/builder/images/DisplayFull.png;" parent="1" vertex="1" visible="0">\n        <mxGeometry x="50" y="20" width="64" height="64" as="geometry"/>\n      </mxCell>\n    </Display>\n    <Button name="Click me to Clear this Demo Model" Note="" Function="clearModel()" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="23">\n      <mxCell style="button;fontSize=18;fillColor=#FFFF99;strokeColor=#FF9900;fontColor=#FF6600;fontStyle=1;fontFamily=Verdana" parent="1" vertex="1">\n        <mxGeometry x="510" y="12" width="520" height="58" as="geometry"/>\n      </mxCell>\n    </Button>\n    <Picture name="" Note="" Image="List" FlipHorizontal="false" FlipVertical="false" LabelPosition="Bottom" id="46">\n      <mxCell style="picture;image=https://insightmaker.com/builder/images/SD/List.png;imageFlipV=0;imageFlipH=0;shape=image" parent="1" vertex="1">\n        <mxGeometry x="30" y="10" width="64" height="64" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Text name="Insight Maker Basics" LabelPosition="Middle" id="47">\n      <mxCell style="text;fontStyle=1;fontFamily=Helvetica" parent="1" vertex="1">\n        <mxGeometry x="100" y="17" width="320" height="50" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Picture name="" Note="" Image="Network" FlipHorizontal="false" FlipVertical="false" LabelPosition="Bottom" id="48">\n      <mxCell style="picture;image=https://insightmaker.com/builder/images/SD/Network.png;imageFlipV=0;imageFlipH=0;shape=image" parent="1" vertex="1">\n        <mxGeometry x="950" y="492" width="132" height="132" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Text name="&lt;i style=&quot;float:left;margin-right:8px;margin-bottom:5px;color:lightgrey&quot; class=&quot;fa fa-3x fa-share-alt&quot;&gt;&lt;/i&gt; Insight Maker models are web pages, so sharing them is as easy as emailing a link or posting it to Twitter or Facebook. If you have your own web page or blog, you can embed Insight Maker models right in your page.&#xa;&lt;hr style=&quot;width:50%; margin-top:16px;margin-bottom:16px&quot;&gt;&lt;i style=&quot;float:left;margin-right:10px;margin-bottom:5px;color:lightgrey&quot; class=&quot;fa fa-4x fa-file-text-o&quot;&gt;&lt;/i&gt; Insight Maker provides two great ways to help you explain your model: Stories and Articles.&#xa;&#xa;&lt;a href=&quot;/storytelling&quot; target=&quot;_blank&quot;&gt;Stories&lt;/a&gt; create a walkthrough of your model where you can show messages and reveal the model step-by-step. Articles take a story and convert it into a crisp static web page.&#xa;&#xa;Here are a few example articles made with Insight Maker. What will you write your article on?&#xa;&#xa; \u2022 &quot;&lt;a href=&quot;https://insightmaker.com/article/20382&quot; target=&quot;_blank&quot;&gt;Air Pollution Dynamics&lt;/a&gt;&quot;&#xa; \u2022 &quot;&lt;a href=&quot;https://insightmaker.com/article/8872&quot; target=&quot;_blank&quot;&gt;Bird Feeder Dilemma&lt;/a&gt;&quot;&#xa; \u2022 &quot;&lt;a href=&quot;https://insightmaker.com/article/133&quot; target=&quot;_blank&quot;&gt;Balancing Loop with Delay&lt;/a&gt;&quot;" LabelPosition="Middle" id="55">\n      <mxCell style="text;fontFamily=Helvetica;fontStyle=0;fontSize=15;align=left;labelPosition=middle;verticalLabelPosition=middle;verticalAlign=middle" parent="1" vertex="1">\n        <mxGeometry x="730" y="138" width="280" height="455" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Folder name="Step 1. Build your Model" Note="" Type="None" Solver="{&quot;enabled&quot;: false, &quot;algorithm&quot;: &quot;RK1&quot;, &quot;timeStep&quot;: 1}" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" AgentBase="" id="42">\n      <mxCell style="folder;dashed=0;fontSize=18;fontFamily=Verdana;fontStyle=1;image=None;shape=rectangle;rounded=0;strokeColor=#C0C0C0;strokeWidth=1;30=10" parent="1" vertex="1">\n        <mxGeometry x="15" y="90" width="680" height="522" as="geometry">\n          <mxRectangle x="15" y="98" width="250" height="30" as="alternateBounds"/>\n        </mxGeometry>\n      </mxCell>\n    </Folder>\n    <Link name="Link" Note="" BiDirectional="false" id="28">\n      <mxCell style="link;dashed=0;strokeColor=#003366;strokeWidth=5;30=50;endArrow=block" parent="42" source="51" target="49" edge="1">\n        <mxGeometry x="35" width="100" height="100" as="geometry">\n          <mxPoint x="35" y="100" as="sourcePoint"/>\n          <mxPoint x="135" as="targetPoint"/>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Link name="Link" Note="" BiDirectional="false" id="29">\n      <mxCell style="link;strokeColor=#003366;dashed=0;strokeWidth=5;30=50;endArrow=block" parent="42" source="49" target="50" edge="1">\n        <mxGeometry x="35" width="100" height="100" as="geometry">\n          <mxPoint x="35" y="100" as="sourcePoint"/>\n          <mxPoint x="135" as="targetPoint"/>\n          <Array as="points"/>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Text name="Use an extensive set of &lt;a href=&quot;/diagramming&quot; target=&quot;_blank&quot;&gt;drawing tools to create&lt;/a&gt; causal loop diagrams, flow charts or rich pictures. Build the diagram that communicates your insights and mental models.&#xa;&#xa;This diagram is an Insight Maker model. Feel free to change it. Each  picture, textbox or other element is called a &quot;&lt;a href=&quot;/primitives&quot; target=&quot;_blank&quot;&gt;Primitive&lt;/a&gt;&quot;. You can click and drag primitives to move them or edit their contents in the sidebar." LabelPosition="Middle" id="45">\n      <mxCell style="text;fontFamily=Helvetica;fontStyle=0;fontSize=15;align=left;labelPosition=middle;verticalLabelPosition=middle;verticalAlign=middle" parent="42" vertex="1">\n        <mxGeometry x="185" y="36" width="475" height="136" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Picture name="Simulate" Note="" Image="https://insightmaker.com/sites/default/files/misc/kchart.png" FlipHorizontal="false" FlipVertical="false" LabelPosition="Left" id="49">\n      <mxCell style="picture;image=https://insightmaker.com/sites/default/files/misc/kchart.png;imageFlipV=0;imageFlipH=0;shape=image;verticalLabelPosition=middle;verticalAlign=middle;labelPosition=left;align=right;fontStyle=1" parent="42" vertex="1">\n        <mxGeometry x="79" y="223" width="90" height="90" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Picture name="Analyze" Note="" Image="https://insightmaker.com/sites/default/files/misc/kformula.png" FlipHorizontal="false" FlipVertical="false" LabelPosition="Left" id="50">\n      <mxCell style="picture;image=https://insightmaker.com/sites/default/files/misc/kformula.png;imageFlipV=0;imageFlipH=0;shape=image;verticalLabelPosition=middle;verticalAlign=middle;labelPosition=left;align=right;fontStyle=1" parent="42" vertex="1">\n        <mxGeometry x="79" y="402" width="90" height="90" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Picture name="Diagram" Note="" Image="https://insightmaker.com/sites/default/files/misc/kivio.png" FlipHorizontal="false" FlipVertical="false" LabelPosition="Left" id="51">\n      <mxCell style="picture;image=https://insightmaker.com/sites/default/files/misc/kivio.png;imageFlipV=0;imageFlipH=0;shape=image;verticalLabelPosition=middle;verticalAlign=middle;labelPosition=left;align=right;fontStyle=1" parent="42" vertex="1">\n        <mxGeometry x="79" y="40" width="90" height="90" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Text name="Add equations to your model to &lt;a href=&quot;/simulating&quot; target=&quot;_blank&quot;&gt;simulate&lt;/a&gt; future behavior and changes. Use a powerful &lt;a href=&quot;/equations&quot; target=&quot;_blank&quot;&gt;equation language&lt;/a&gt; and large library of &lt;a href=&quot;/functions&quot; target=&quot;_blank&quot;&gt;built-in functions&lt;/a&gt; to simulate &lt;a href=&quot;/systemdynamics&quot; target=&quot;_blank&quot;&gt;System Dynamics&lt;/a&gt; or &lt;a href=&quot;/agentbased&quot; target=&quot;_blank&quot;&gt;Agent Based Models&lt;/a&gt;. View and explore results directly within Insight Maker." LabelPosition="Middle" id="52">\n      <mxCell style="text;fontFamily=Helvetica;fontStyle=0;fontSize=15;align=left;labelPosition=middle;verticalLabelPosition=middle;verticalAlign=middle" parent="42" vertex="1">\n        <mxGeometry x="185" y="215" width="290" height="120" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="Analyze your model results. Study the trends to understand the dynamics of your system. Use Insight Maker&#39;s &lt;a href=&quot;/sensitivitytesting&quot; target=&quot;_blank&quot;&gt;Sensitivity Testing Tool&lt;/a&gt; to understand the effect of randomness. Apply Insight Maker&#39;s &lt;a href=&quot;/optimization&quot; target=&quot;_blank&quot;&gt;Optimization Tool&lt;/a&gt; to maximize or minimize a goal. Utilize Insight Maker&#39;s &lt;a href=&quot;/scripting&quot; target=&quot;_blank&quot;&gt;scripting&lt;/a&gt; capabilities to take complete control of your analysis." LabelPosition="Middle" id="53">\n      <mxCell style="text;fontFamily=Helvetica;fontStyle=0;fontSize=15;align=left;labelPosition=middle;verticalLabelPosition=middle;verticalAlign=middle" parent="42" vertex="1">\n        <mxGeometry x="185" y="387" width="475" height="120" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Folder name="Product Adoption" Note="" Type="None" Solver="{&quot;enabled&quot;: false, &quot;algorithm&quot;: &quot;RK1&quot;, &quot;timeStep&quot;: 1}" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" AgentBase="" id="41">\n      <mxCell style="folder;strokeWidth=1;30=10;fontSize=13;image=None;shape=rectangle;" parent="42" vertex="1">\n        <mxGeometry x="490" y="213" width="170" height="122" as="geometry">\n          <mxRectangle x="490" y="213" width="170" height="27" as="alternateBounds"/>\n        </mxGeometry>\n      </mxCell>\n    </Folder>\n    <Stock name="Users" Note="" InitialValue="1000" StockMode="Store" Delay="10" Volume="100" NonNegative="false" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="100" SliderMin="0" SliderStep="" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="35">\n      <mxCell style="stock;fontSize=9;strokeWidth=1;30=10" parent="41" vertex="1">\n        <mxGeometry x="20" y="90" width="40" height="20" as="geometry"/>\n      </mxCell>\n    </Stock>\n    <Flow name="Adoption" Note="" FlowRate="[Users]*[Rate]" OnlyPositive="true" TimeIndependent="false" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="100" SliderMin="0" SliderStep="" id="36">\n      <mxCell style="flow;fontSize=9;strokeWidth=2;30=20" parent="41" target="35" edge="1">\n        <mxGeometry x="-680" y="-150" width="100" height="100" as="geometry">\n          <mxPoint x="40" y="40" as="sourcePoint"/>\n          <mxPoint x="-680" y="-50" as="targetPoint"/>\n        </mxGeometry>\n      </mxCell>\n    </Flow>\n    <Variable name="Rate" Note="" Equation="0.2" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="100" SliderMin="0" SliderStep="" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="37">\n      <mxCell style="variable;fontSize=9;strokeWidth=1;30=10" parent="41" vertex="1">\n        <mxGeometry x="60" y="25" width="40" height="20" as="geometry"/>\n      </mxCell>\n    </Variable>\n    <Link name="Link" Note="" BiDirectional="false" id="38">\n      <mxCell style="link;strokeWidth=1;30=10" parent="41" source="37" target="36" edge="1">\n        <mxGeometry x="-650" y="-150" width="100" height="100" as="geometry">\n          <mxPoint x="-650" y="-50" as="sourcePoint"/>\n          <mxPoint x="-550" y="-150" as="targetPoint"/>\n          <Array as="points">\n            <mxPoint x="50" y="42"/>\n          </Array>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Button name="Click me to Simulate" Note="" Function="runModel();" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="40">\n      <mxCell style="button;fillColor=#B3E2CD;strokeWidth=2;30=20;fontSize=12" parent="41" vertex="1">\n        <mxGeometry x="80" y="63" width="75" height="35" as="geometry"/>\n      </mxCell>\n    </Button>\n  </root>\n</mxGraphModel>\n';function setConverterInit(a){var b=parseFloat(getTimeStart(),10),c=parseFloat(getTimeStart(),10)+parseFloat(getTimeLength(),10);a.setAttribute("Data",b+","+Math.pow(b,2)+"; "+(b+c)/2+","+Math.pow((b+c)/2,2)+"; "+c+","+Math.pow(c,2))};var viewConfig={showTopLinks:!0,sideBarWidth:330,referenceBarWidth:240,enableContextMenu:!0,focusDiagram:!0,allowEdits:is_editor&&!is_embed,saveEnabled:!0,buttonGroups:!0,showLogo:!0,primitiveGroup:!0,connectionsGroup:!0,actionsGroup:!0,styleGroup:!0,toolsGroup:!0,exploreGroup:!1,fullScreenResults:!1,showResultsEdit:!0};
is_ebook&&(viewConfig.showTopLinks=!1,viewConfig.sideBarWidth=250,viewConfig.referenceBarWidth=150,viewConfig.focusDiagram=!1,viewConfig.saveEnabled=!1,viewConfig.showLogo=!1,viewConfig.primitiveGroup=!1,viewConfig.actionsGroup=!0,viewConfig.styleGroup=!1,viewConfig.runFlush=!0,viewConfig.fullScreenResults=!0,viewConfig.showResultsEdit=!1);is_embed&&(viewConfig.sideBarWidth=200,viewConfig.referenceBarWidth=150,viewConfig.focusDiagram=!1,viewConfig.saveEnabled=!1,viewConfig.buttonGroups=!1,viewConfig.primitiveGroup=!1,viewConfig.connectionsGroup=!1,viewConfig.actionsGroup=!1,viewConfig.styleGroup=!1,viewConfig.toolsGroup=!1,viewConfig.fullScreenResults=!0,viewConfig.showResultsEdit=!1);is_editor||(viewConfig.saveEnabled=!1,viewConfig.primitiveGroup=!1,viewConfig.connectionsGroup=!1,viewConfig.actionsGroup=!1,viewConfig.styleGroup=!1,viewConfig.toolsGroup=!0,is_embed||(viewConfig.exploreGroup=!0),viewConfig.showResultsEdit=!1);Ext.onReady(function(){setTimeout(function(){setTimeout(function(){try{Ext.get("model-overview").fadeOut({duration:1E3,remove:!0})}catch(a){}},250);Ext.get("loading").remove();Ext.get("loading-mask").fadeOut({remove:!0})},250)});function replace_html(a,b){if(a){var c="string"===typeof a?document.getElementById(a):a,d=document.createElement(c.nodeName);d.id=c.id;d.className=c.className;d.innerHTML=b;c.parentNode?c.parentNode.replaceChild(d,c):c.innerHTML=b;return d}}
function setTopLinks(){if(viewConfig.showTopLinks){var a="",b="&uarr;";ribbonPanel.getDockedItems()[0].isVisible()||(b="&darr;");if(-1==drupal_node_ID)a='<div style="float:right;padding:0.2em;"><nobr><a href="'+base_path+'/browse" target="_blank">'+getText("Find More Insights")+'</a> | <a href="javascript:toggleTopBar()"  id="toolbarToggle">'+b+"</a></nobr></div>";else{is_editor&&(a='<div style="float:left;padding:0.2em;"><a href="'+base_path+"/node/"+drupal_node_ID+'/access" target="_blank" id="editBut">'+
getText("Insight Access")+"</a>",a=a+' | <a href="'+base_path+"/node/"+drupal_node_ID+'/delete" id="deleteBut">'+getText("Delete Insight")+"</a>",a+="</div></div>");a+='<div style="float:right;padding:0.2em;"><nobr>';is_embed?a=a+'<a target="_blank" href="'+base_path+"/insight/"+drupal_node_ID+'">'+getText("Full Screen Insight")+"</a> | ":(a=a+'<a target="_blank" href="'+base_path+'/insight/">'+getText("Make New Insight")+"</a> | ",a=a+'<a target="_blank" href="'+base_path+"/node/"+drupal_node_ID+'/clone">'+getText("Clone Insight")+"</a> | ");if(star_link)var c=-1<star_link.indexOf("unflag"),a=a+'<span id="star-link"><a href="#" onclick="doStar('+!c+')">'+(c?"<i class='fa fa-star'></i> Unstar":"<i class='fa fa-star-o'></i> Star")+"</a></span> | ";a=a+'<a href="'+base_path+'/browse" target="_blank">'+getText("Find More Insights")+'</a> | <a href="javascript:toggleTopBar()" id="toolbarToggle">'+b+"</a></nobr></div>"}replace_html(document.getElementById("toplinks-holder"),a);$.fn.frameWarp&&$("#editBut").frameWarp({url:base_path+"/node/"+drupal_node_ID+"/access"})}}function doStar(a){$.ajax({url:star_link,method:"GET"});$("#star-link").html("<i class='fa fa-star"+(a?"":"-o")+"'></i>")};Ext.chart.series.Series.prototype.coordinateStacked=function(a,b,c){var d=this.getStore().queryBy(function(a){return!0}).items,e=this["get"+a+"Axis"](),f=this.getHidden(),g={min:0,max:0},k=this["fieldCategory"+a],l,m,n,p,q,u,v={},y=[],z,x=[],B=[],A=this.getStacked(),D=this.getSprites();if(0<D.length){for(m=0;m<k.length;m++){l=k[m];q=this.getFields([l]);for(n=0;n<d.length;n++)y[n]=0,x[n]=0,B[n]=0;for(n=0;n<q.length;n++){v={};p=q[n];if(f[n])v["dataStart"+l]=y,v["data"+l]=y;else if(u=this.coordinateData(d,p,e),A){z=[];for(p=0;p<d.length;p++)u[p]||(u[p]=0),0<=u[p]?(y[p]=x[p],x[p]+=u[p],z[p]=x[p]):(y[p]=B[p],B[p]+=u[p],z[p]=B[p]);v["dataStart"+l]=y;v["data"+l]=z;this.getRangeOfData(y,g);this.getRangeOfData(z,g)}else v["dataStart"+l]=y,v["data"+l]=u,this.getRangeOfData(u,g);D[n].setAttributes(v)}}this.dataRange[b]=g.min;this.dataRange[b+c]=g.max;v={};v["dataMin"+a]=g.min;v["dataMax"+a]=g.max;for(m=0;m<D.length;m++)D[m].setAttributes(v)}};Ext.chart.series.Series.prototype.coordinate=function(a,b,c){var d=this.getStore(),e=this.getHidden(),f=d.queryBy(function(a){return!0}).items,g=this["get"+a+"Axis"](),k={min:Infinity,max:-Infinity},l=this["fieldCategory"+a]||[a],m=this.getFields(l),n,p,q={},u=this.getSprites();if(0<u.length){if(!Ext.isBoolean(e)||!e)for(e=0;e<l.length;e++)n=m[e],p=this.coordinateData(f,n,g),this.getRangeOfData(p,k),q["data"+l[e]]=this.coordinateData(d.getData().items,n,g);this.dataRange[b]=k.min;this.dataRange[b+
c]=k.max;q["dataMin"+a]=k.min;q["dataMax"+a]=k.max;g&&(g.range=null,q["range"+a]=g.getRange());for(e=0;e<u.length;e++)u[e].setAttributes(q)}};function getCustomColor(a){var b=Ext.create({xtype:"window",referenceHolder:!0,minWidth:540,minHeight:200,layout:"fit",header:!1,resizable:!0,modal:!0,items:{xtype:"colorselector",reference:"selector",showPreviousColor:!1,showOkCancelButtons:!0,listeners:{ok:function(c,e){a(e);b.close()},cancel:function(){b.close()}}}}),c=b.lookupReference("selector");c.setFormat("#hex6");c.setColor("#0000ff");c.lookupReference("alphaSlider").up().setHidden(!0);b.show()};var mxClient={VERSION:"3.3.0.1",IS_IE:0<=navigator.userAgent.indexOf("MSIE"),IS_IE6:0<=navigator.userAgent.indexOf("MSIE 6"),IS_IE11:!!navigator.userAgent.match(/Trident\/7\./),IS_QUIRKS:0<=navigator.userAgent.indexOf("MSIE")&&(null==document.documentMode||5==document.documentMode),IS_EM:"spellcheck"in document.createElement("textarea")&&8==document.documentMode,VML_PREFIX:"v",OFFICE_PREFIX:"o",IS_NS:0<=navigator.userAgent.indexOf("Mozilla/")&&0>navigator.userAgent.indexOf("MSIE"),IS_OP:0<=navigator.userAgent.indexOf("Opera/")||0<=navigator.userAgent.indexOf("OPR/"),IS_OT:0<=navigator.userAgent.indexOf("Presto/")&&0>navigator.userAgent.indexOf("Presto/2.4.")&&0>navigator.userAgent.indexOf("Presto/2.3.")&&0>navigator.userAgent.indexOf("Presto/2.2.")&&0>navigator.userAgent.indexOf("Presto/2.1.")&&0>navigator.userAgent.indexOf("Presto/2.0.")&&0>navigator.userAgent.indexOf("Presto/1."),IS_SF:0<=navigator.userAgent.indexOf("AppleWebKit/")&&0>navigator.userAgent.indexOf("Chrome/"),IS_IOS:navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,IS_GC:0<=navigator.userAgent.indexOf("Chrome/"),IS_FF:0<=navigator.userAgent.indexOf("Firefox/"),IS_MT:0<=navigator.userAgent.indexOf("Firefox/")&&0>navigator.userAgent.indexOf("Firefox/1.")&&0>navigator.userAgent.indexOf("Firefox/2.")||0<=navigator.userAgent.indexOf("Iceweasel/")&&0>navigator.userAgent.indexOf("Iceweasel/1.")&&0>navigator.userAgent.indexOf("Iceweasel/2.")||0<=navigator.userAgent.indexOf("SeaMonkey/")&&0>navigator.userAgent.indexOf("SeaMonkey/1.")||0<=navigator.userAgent.indexOf("Iceape/")&&0>navigator.userAgent.indexOf("Iceape/1."),IS_SVG:0<=navigator.userAgent.indexOf("Firefox/")||0<=navigator.userAgent.indexOf("Iceweasel/")||0<=navigator.userAgent.indexOf("Seamonkey/")||0<=navigator.userAgent.indexOf("Iceape/")||0<=navigator.userAgent.indexOf("Galeon/")||0<=navigator.userAgent.indexOf("Epiphany/")||0<=navigator.userAgent.indexOf("AppleWebKit/")||0<=navigator.userAgent.indexOf("Gecko/")||0<=navigator.userAgent.indexOf("Opera/")||null!=document.documentMode&&9<=document.documentMode,NO_FO:!document.createElementNS||"[object SVGForeignObjectElement]"!=document.createElementNS("http://www.w3.org/2000/svg","foreignObject")||0<=navigator.userAgent.indexOf("Opera/"),IS_VML:"MICROSOFT INTERNET EXPLORER"==navigator.appName.toUpperCase(),IS_WIN:0<navigator.appVersion.indexOf("Win"),IS_MAC:0<navigator.appVersion.indexOf("Mac"),IS_TOUCH:"ontouchstart"in document.documentElement,IS_POINTER:null!=window.navigator.msPointerEnabled?window.navigator.msPointerEnabled:!1,IS_LOCAL:0>document.location.href.indexOf("http://")&&0>document.location.href.indexOf("https://"),isBrowserSupported:function(){return mxClient.IS_VML||mxClient.IS_SVG},link:function(a,b,c){c=c||document;if(mxClient.IS_IE6)c.write('<link rel="'+a+'" href="'+b+'" charset="ISO-8859-1" type="text/css"/>');else{var d=c.createElement("link");d.setAttribute("rel",a);d.setAttribute("href",b);d.setAttribute("charset","ISO-8859-1");d.setAttribute("type","text/css");c.getElementsByTagName("head")[0].appendChild(d)}},include:function(a){document.write('<script src="'+
a+'">\x3c/script>')},dispose:function(){for(var a=0;a<mxEvent.objects.length;a++)null!=mxEvent.objects[a].mxListenerList&&mxEvent.removeAllListeners(mxEvent.objects[a])}};"undefined"==typeof mxLoadResources&&(mxLoadResources=!0);"undefined"==typeof mxResourceExtension&&(mxResourceExtension=".txt");"undefined"==typeof mxLoadStylesheets&&(mxLoadStylesheets=!0);"undefined"!=typeof mxBasePath&&0<mxBasePath.length?("/"==mxBasePath.substring(mxBasePath.length-1)&&(mxBasePath=mxBasePath.substring(0,mxBasePath.length-1)),mxClient.basePath=mxBasePath):mxClient.basePath=".";"undefined"!=typeof mxImageBasePath&&0<mxImageBasePath.length?("/"==mxImageBasePath.substring(mxImageBasePath.length-1)&&(mxImageBasePath=mxImageBasePath.substring(0,mxImageBasePath.length-1)),mxClient.imageBasePath=mxImageBasePath):mxClient.imageBasePath=mxClient.basePath+"/images";mxClient.language="undefined"!=typeof mxLanguage&&null!=mxLanguage?mxLanguage:mxClient.IS_IE?navigator.userLanguage:navigator.language;mxClient.defaultLanguage="undefined"!=typeof mxDefaultLanguage&&null!=mxDefaultLanguage?mxDefaultLanguage:"en";mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/common.css");"undefined"!=typeof mxLanguages&&null!=mxLanguages&&(mxClient.languages=mxLanguages);mxClient.IS_VML&&(mxClient.IS_SVG?mxClient.IS_VML=!1:(8==document.documentMode?(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml","#default#VML"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office","#default#VML")):(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office")),mxClient.IS_QUIRKS&&30<=document.styleSheets.length?function(){var a=document.createElement("style");a.type="text/css";a.styleSheet.cssText=mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}";document.getElementsByTagName("head")[0].appendChild(a)}():document.createStyleSheet().cssText=mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}",mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/explorer.css"),window.attachEvent("onunload",mxClient.dispose)));var mxLog={consoleName:"Console",TRACE:!1,DEBUG:!0,WARN:!0,buffer:"",init:function(){if(null==mxLog.window&&null!=document.body){var a=mxLog.consoleName+" - mxGraph "+mxClient.VERSION,b=document.createElement("table");b.setAttribute("width","100%");b.setAttribute("height","100%");var c=document.createElement("tbody"),d=document.createElement("tr"),e=document.createElement("td");e.style.verticalAlign="top";mxLog.textarea=document.createElement("textarea");mxLog.textarea.setAttribute("readOnly","true");mxLog.textarea.style.height="100%";mxLog.textarea.style.resize="none";mxLog.textarea.value=mxLog.buffer;mxLog.textarea.style.width=mxClient.IS_NS&&"BackCompat"!=document.compatMode?"99%":"100%";e.appendChild(mxLog.textarea);d.appendChild(e);c.appendChild(d);d=document.createElement("tr");mxLog.td=document.createElement("td");mxLog.td.style.verticalAlign="top";mxLog.td.setAttribute("height","30px");d.appendChild(mxLog.td);c.appendChild(d);b.appendChild(c);mxLog.addButton("Info",function(a){mxLog.info()});mxLog.addButton("DOM",function(a){a=mxUtils.getInnerHtml(document.body);mxLog.debug(a)});mxLog.addButton("Trace",function(a){mxLog.TRACE=!mxLog.TRACE;mxLog.TRACE?mxLog.debug("Tracing enabled"):mxLog.debug("Tracing disabled")});mxLog.addButton("Copy",function(a){try{mxUtils.copy(mxLog.textarea.value)}catch(b){mxUtils.alert(b)}});mxLog.addButton("Show",function(a){try{mxUtils.popup(mxLog.textarea.value)}catch(b){mxUtils.alert(b)}});mxLog.addButton("Clear",function(a){mxLog.textarea.value=""});d=c=0;"number"===typeof window.innerWidth?(c=window.innerHeight,d=window.innerWidth):(c=document.documentElement.clientHeight||document.body.clientHeight,d=document.body.clientWidth);mxLog.window=new mxWindow(a,b,Math.max(0,d-320),Math.max(0,c-210),300,160);mxLog.window.setMaximizable(!0);mxLog.window.setScrollable(!1);mxLog.window.setResizable(!0);mxLog.window.setClosable(!0);mxLog.window.destroyOnClose=!1;if((mxClient.IS_NS||mxClient.IS_IE)&&!mxClient.IS_GC&&!mxClient.IS_SF&&"BackCompat"!=document.compatMode||11==document.documentMode){var f=mxLog.window.getElement(),a=function(a,b){mxLog.textarea.style.height=Math.max(0,f.offsetHeight-70)+"px"};mxLog.window.addListener(mxEvent.RESIZE_END,a);mxLog.window.addListener(mxEvent.MAXIMIZE,a);mxLog.window.addListener(mxEvent.NORMALIZE,a);mxLog.textarea.style.height="92px"}}},info:function(){mxLog.writeln(mxUtils.toString(navigator))},addButton:function(a,b){var c=document.createElement("button");mxUtils.write(c,a);mxEvent.addListener(c,"click",b);mxLog.td.appendChild(c)},isVisible:function(){return null!=mxLog.window?mxLog.window.isVisible():!1},show:function(){mxLog.setVisible(!0)},setVisible:function(a){null==mxLog.window&&mxLog.init();null!=mxLog.window&&mxLog.window.setVisible(a)},enter:function(a){if(mxLog.TRACE)return mxLog.writeln("Entering "+a),(new Date).getTime()},leave:function(a,b){if(mxLog.TRACE){var c=0!=b?" ("+((new Date).getTime()-b)+" ms)":"";mxLog.writeln("Leaving "+a+c)}},debug:function(){mxLog.DEBUG&&mxLog.writeln.apply(this,arguments)},warn:function(){mxLog.WARN&&mxLog.writeln.apply(this,arguments)},write:function(){for(var a="",b=0;b<arguments.length;b++)a+=arguments[b],b<arguments.length-1&&(a+=" ");null!=mxLog.textarea?(mxLog.textarea.value+=a,0<=navigator.userAgent.indexOf("Presto/2.5")&&(mxLog.textarea.style.visibility="hidden",mxLog.textarea.style.visibility="visible"),mxLog.textarea.scrollTop=mxLog.textarea.scrollHeight):mxLog.buffer+=a},writeln:function(){for(var a="",b=0;b<arguments.length;b++)a+=arguments[b],b<arguments.length-1&&(a+=" ");mxLog.write(a+"\n")}},mxObjectIdentity={FIELD_NAME:"mxObjectId",counter:0,get:function(a){if(null==a[mxObjectIdentity.FIELD_NAME])if("object"===typeof a){var b=mxUtils.getFunctionName(a.constructor);a[mxObjectIdentity.FIELD_NAME]=b+"#"+mxObjectIdentity.counter++}else"function"===typeof a&&(a[mxObjectIdentity.FIELD_NAME]="Function#"+mxObjectIdentity.counter++);return a[mxObjectIdentity.FIELD_NAME]},clear:function(a){"object"!==typeof a&&"function"!==typeof a||delete a[mxObjectIdentity.FIELD_NAME]}};function mxDictionary(){this.clear()}mxDictionary.prototype.map=null;mxDictionary.prototype.clear=function(){this.map={}};mxDictionary.prototype.get=function(a){a=mxObjectIdentity.get(a);return this.map[a]};mxDictionary.prototype.put=function(a,b){var c=mxObjectIdentity.get(a),d=this.map[c];this.map[c]=b;return d};mxDictionary.prototype.remove=function(a){a=mxObjectIdentity.get(a);var b=this.map[a];delete this.map[a];return b};mxDictionary.prototype.getKeys=function(){var a=[],b;for(b in this.map)a.push(b);return a};mxDictionary.prototype.getValues=function(){var a=[],b;for(b in this.map)a.push(this.map[b]);return a};mxDictionary.prototype.visit=function(a){for(var b in this.map)a(b,this.map[b])};var mxResources={resources:[],extension:mxResourceExtension,resourcesEncoded:!1,loadDefaultBundle:!0,loadSpecialBundle:!0,isLanguageSupported:function(a){return null!=mxClient.languages?0<=mxUtils.indexOf(mxClient.languages,a):!0},getDefaultBundle:function(a,b){return mxResources.loadDefaultBundle||!mxResources.isLanguageSupported(b)?a+mxResources.extension:null},getSpecialBundle:function(a,b){if(null==mxClient.languages||!this.isLanguageSupported(b)){var c=b.indexOf("-");0<c&&(b=b.substring(0,c))}return mxResources.loadSpecialBundle&&mxResources.isLanguageSupported(b)&&b!=mxClient.defaultLanguage?a+"_"+b+mxResources.extension:null},add:function(a,b){b=null!=b?b:null!=mxClient.language?mxClient.language.toLowerCase():mxConstants.NONE;if(b!=mxConstants.NONE){var c=mxResources.getDefaultBundle(a,b);if(null!=c)try{var d=mxUtils.load(c);d.isReady()&&mxResources.parse(d.getText())}catch(e){}c=mxResources.getSpecialBundle(a,b);if(null!=c)try{d=mxUtils.load(c),d.isReady()&&mxResources.parse(d.getText())}catch(f){}}},parse:function(a){if(null!=a){a=a.split("\n");for(var b=0;b<a.length;b++)if("#"!=a[b].charAt(0)){var c=a[b].indexOf("=");if(0<c){var d=a[b].substring(0,c),e=a[b].length;13==a[b].charCodeAt(e-1)&&e--;c=a[b].substring(c+1,e);this.resourcesEncoded?(c=c.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),mxResources.resources[d]=unescape(c)):mxResources.resources[d]=c}}}},get:function(a,b,c){a=mxResources.resources[a];null==a&&(a=c);if(null!=a&&null!=b){c=[];for(var d=null,e=0;e<a.length;e++){var f=a.charAt(e);"{"==f?d="":null!=d&&"}"==f?(d=parseInt(d)-1,0<=d&&d<b.length&&c.push(b[d]),d=null):null!=d?d+=f:c.push(f)}a=c.join("")}return a}};function mxPoint(a,b){this.x=null!=a?a:0;this.y=null!=b?b:0}mxPoint.prototype.x=null;mxPoint.prototype.y=null;mxPoint.prototype.equals=function(a){return null!=a&&a.x==this.x&&a.y==this.y};mxPoint.prototype.clone=function(){return mxUtils.clone(this)};function mxRectangle(a,b,c,d){mxPoint.call(this,a,b);this.width=null!=c?c:0;this.height=null!=d?d:0}mxRectangle.prototype=new mxPoint;mxRectangle.prototype.constructor=mxRectangle;mxRectangle.prototype.width=null;mxRectangle.prototype.height=null;mxRectangle.prototype.setRect=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};mxRectangle.prototype.getCenterX=function(){return this.x+this.width/2};mxRectangle.prototype.getCenterY=function(){return this.y+this.height/2};mxRectangle.prototype.add=function(a){if(null!=a){var b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x+a.width);a=Math.max(this.y+this.height,a.y+a.height);this.x=b;this.y=c;this.width=d-b;this.height=a-c}};mxRectangle.prototype.grow=function(a){this.x-=a;this.y-=a;this.width+=2*a;this.height+=2*a};mxRectangle.prototype.getPoint=function(){return new mxPoint(this.x,this.y)};mxRectangle.prototype.rotate90=function(){var a=(this.width-this.height)/2;this.x+=a;this.y-=a;a=this.width;this.width=this.height;this.height=a};mxRectangle.prototype.equals=function(a){return null!=a&&a.x==this.x&&a.y==this.y&&a.width==this.width&&a.height==this.height};mxRectangle.fromRectangle=function(a){return new mxRectangle(a.x,a.y,a.width,a.height)};
var mxEffects={animateChanges:function(a,b,c){var d=0,e=function(){for(var g=!1,k=0;k<b.length;k++){var l=b[k];if(l instanceof mxGeometryChange||l instanceof mxTerminalChange||l instanceof mxValueChange||l instanceof mxChildChange||l instanceof mxStyleChange){var m=a.getView().getState(l.cell||l.child,!1);if(null!=m)if(g=!0,l.constructor!=mxGeometryChange||a.model.isEdge(l.cell))mxUtils.setOpacity(m.shape.node,100*d/10);else{var n=a.getView().scale,p=(l.geometry.x-l.previous.x)*n,q=(l.geometry.y-
l.previous.y)*n,u=(l.geometry.width-l.previous.width)*n,n=(l.geometry.height-l.previous.height)*n;0==d?(m.x-=p,m.y-=q,m.width-=u,m.height-=n):(m.x+=p/10,m.y+=q/10,m.width+=u/10,m.height+=n/10);a.cellRenderer.redraw(m);mxEffects.cascadeOpacity(a,l.cell,100*d/10)}}}10>d&&g?(d++,window.setTimeout(e,f)):null!=c&&c()},f=30;e()},cascadeOpacity:function(a,b,c){for(var d=a.model.getChildCount(b),e=0;e<d;e++){var f=a.model.getChildAt(b,e),g=a.getView().getState(f);null!=g&&(mxUtils.setOpacity(g.shape.node,c),mxEffects.cascadeOpacity(a,f,c))}b=a.model.getEdges(b);if(null!=b)for(e=0;e<b.length;e++)d=a.getView().getState(b[e]),null!=d&&mxUtils.setOpacity(d.shape.node,c)},fadeOut:function(a,b,c,d,e,f){d=d||40;e=e||30;var g=b||100;mxUtils.setOpacity(a,g);if(f||null==f){var k=function(){g=Math.max(g-d,0);mxUtils.setOpacity(a,g);0<g?window.setTimeout(k,e):(a.style.visibility="hidden",c&&a.parentNode&&a.parentNode.removeChild(a))};window.setTimeout(k,e)}else a.style.visibility="hidden",c&&a.parentNode&&a.parentNode.removeChild(a)}},mxUtils={errorResource:"none"!=mxClient.language?"error":"",closeResource:"none"!=mxClient.language?"close":"",errorImage:mxClient.imageBasePath+"/error.gif",removeCursors:function(a){null!=a.style&&(a.style.cursor="");a=a.childNodes;if(null!=a)for(var b=a.length,c=0;c<b;c+=1)mxUtils.removeCursors(a[c])},getCurrentStyle:function(){return mxClient.IS_IE?function(a){return null!=a?a.currentStyle:null}:function(a){return null!=a?window.getComputedStyle(a,""):null}}(),setPrefixedStyle:function(){var a=null;mxClient.IS_OT?a="O":mxClient.IS_SF||mxClient.IS_GC?a="Webkit":mxClient.IS_MT?a="Moz":mxClient.IS_IE&&9<=document.documentMode&&10>document.documentMode&&(a="ms");return function(b,c,d){b[c]=d;null!=a&&0<c.length&&(c=a+c.substring(0,1).toUpperCase()+c.substring(1),b[c]=d)}}(),hasScrollbars:function(a){a=mxUtils.getCurrentStyle(a);return null!=a&&("scroll"==a.overflow||"auto"==a.overflow)},bind:function(a,b){return function(){return b.apply(a,arguments)}},eval:function(a){var b=null;if(0<=a.indexOf("function"))try{eval("var _mxJavaScriptExpression="+
a),b=_mxJavaScriptExpression,_mxJavaScriptExpression=null}catch(c){mxLog.warn(c.message+" while evaluating "+a)}else try{b=eval(a)}catch(d){mxLog.warn(d.message+" while evaluating "+a)}return b},findNode:function(a,b,c){if(a.nodeType==mxConstants.NODETYPE_ELEMENT){var d=a.getAttribute(b);if(null!=d&&d==c)return a}for(a=a.firstChild;null!=a;){d=mxUtils.findNode(a,b,c);if(null!=d)return d;a=a.nextSibling}return null},getFunctionName:function(a){var b=null;if(null!=a)if(null!=a.name)b=a.name;else{a=a.toString();for(b=9;" "==a.charAt(b);)b++;var c=a.indexOf("(",b),b=a.substring(b,c)}return b},indexOf:function(a,b){if(null!=a&&null!=b)for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1},remove:function(a,b){var c=null;if("object"==typeof b)for(var d=mxUtils.indexOf(b,a);0<=d;)b.splice(d,1),c=a,d=mxUtils.indexOf(b,a);for(var e in b)b[e]==a&&(delete b[e],c=a);return c},isNode:function(a,b,c,d){return null==a||isNaN(a.nodeType)||null!=b&&a.nodeName.toLowerCase()!=b.toLowerCase()?!1:null==c||a.getAttribute(c)==d},isAncestorNode:function(a,b){for(var c=b;null!=c;){if(c==a)return!0;c=c.parentNode}return!1},getChildNodes:function(a,b){b=b||mxConstants.NODETYPE_ELEMENT;for(var c=[],d=a.firstChild;null!=d;)d.nodeType==b&&c.push(d),d=d.nextSibling;return c},importNode:function(a,b,c){if(mxClient.IS_IE&&(null==document.documentMode||10>document.documentMode))switch(b.nodeType){case 1:var d=a.createElement(b.nodeName);if(b.attributes&&0<b.attributes.length){for(var e=0;e<b.attributes.length;e++)d.setAttribute(b.attributes[e].nodeName,b.getAttribute(b.attributes[e].nodeName));if(c&&b.childNodes&&0<b.childNodes.length)for(e=0;e<b.childNodes.length;e++)d.appendChild(mxUtils.importNode(a,b.childNodes[e],c))}return d;case 3:case 4:case 8:return a.createTextNode(b.value)}else return a.importNode(b,c)},createXmlDocument:function(){var a=null;document.implementation&&document.implementation.createDocument?a=document.implementation.createDocument("","",null):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLDOM"));return a},parseXml:function(){return window.DOMParser?function(a){return(new DOMParser).parseFromString(a,"text/xml")}:function(a){var b=mxUtils.createXmlDocument();b.async="false";b.loadXML(a);return b}}(),clearSelection:function(){return document.selection?function(){document.selection.empty()}:window.getSelection?function(){window.getSelection().removeAllRanges()}:function(){}}(),getPrettyXml:function(a,b,c){var d=[];if(null!=a)if(b=b||"  ",c=c||"",a.nodeType==mxConstants.NODETYPE_TEXT)d.push(a.value);else{d.push(c+"<"+a.nodeName);var e=a.attributes;if(null!=e)for(var f=0;f<e.length;f++){var g=mxUtils.htmlEntities(e[f].value);d.push(" "+e[f].nodeName+'="'+g+'"')}e=a.firstChild;if(null!=e){for(d.push(">\n");null!=e;)d.push(mxUtils.getPrettyXml(e,b,c+b)),e=e.nextSibling;d.push(c+"</"+a.nodeName+">\n")}else d.push("/>\n")}return d.join("")},removeWhitespace:function(a,b){for(var c=b?a.previousSibling:a.nextSibling;null!=c&&c.nodeType==mxConstants.NODETYPE_TEXT;){var d=b?c.previousSibling:c.nextSibling,e=mxUtils.getTextContent(c);0==mxUtils.trim(e).length&&c.parentNode.removeChild(c);c=d}},htmlEntities:function(a,b){a=(a||"").replace(/&/g,"&amp;");a=a.replace(/"/g,"&quot;");a=a.replace(/\'/g,"&#39;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");if(null==b||b)a=a.replace(/\n/g,"&#xa;");return a},isVml:function(a){return null!=a&&"urn:schemas-microsoft-com:vml"==a.tagUrn},getXml:function(a,b){var c="";null!=window.XMLSerializer?c=(new XMLSerializer).serializeToString(a):null!=a.xml&&(c=a.xml.replace(/\r\n\t[\t]*/g,"").replace(/>\r\n/g,">").replace(/\r\n/g,"\n"));return c.replace(/\n/g,b||"&#xa;")},getTextContent:function(a){return void 0!==a.innerText?a.innerText:null!=a?a[void 0===a.textContent?"text":"textContent"]:""},setTextContent:function(a,b){void 0!==a.innerText?a.innerText=b:a[void 0===a.textContent?"text":"textContent"]=b},getInnerHtml:function(){return mxClient.IS_IE?function(a){return null!=a?a.innerHTML:""}:function(a){return null!=a?(new XMLSerializer).serializeToString(a):""}}(),getOuterHtml:function(){return mxClient.IS_IE?function(a){if(null!=a){if(null!=a.outerHTML)return a.outerHTML;var b=[];b.push("<"+a.nodeName);var c=a.attributes;if(null!=c)for(var d=0;d<c.length;d++){var e=c[d].value;null!=e&&0<e.length&&(b.push(" "),b.push(c[d].nodeName),b.push('="'),b.push(e),b.push('"'))}0==a.innerHTML.length?b.push("/>"):(b.push(">"),b.push(a.innerHTML),b.push("</"+a.nodeName+">"));return b.join("")}return""}:function(a){return null!=a?(new XMLSerializer).serializeToString(a):""}}(),write:function(a,b){var c=a.ownerDocument.createTextNode(b);null!=a&&a.appendChild(c);return c},writeln:function(a,b){var c=a.ownerDocument.createTextNode(b);null!=a&&(a.appendChild(c),a.appendChild(document.createElement("br")));return c},br:function(a,b){b=b||1;for(var c=null,d=0;d<b;d++)null!=a&&(c=a.ownerDocument.createElement("br"),a.appendChild(c));return c},button:function(a,b,c){c=null!=c?c:document;c=c.createElement("button");mxUtils.write(c,a);mxEvent.addListener(c,"click",function(a){b(a)});return c},para:function(a,b){var c=document.createElement("p");mxUtils.write(c,b);null!=a&&a.appendChild(c);return c},addTransparentBackgroundFilter:function(a){a.style.filter+="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+mxClient.imageBasePath+"/transparent.gif', sizingMethod='scale')"},linkAction:function(a,b,c,d,e){return mxUtils.link(a,b,function(){c.execute(d)},e)},linkInvoke:function(a,b,c,d,e,f){return mxUtils.link(a,b,function(){c[d](e)},f)},link:function(a,b,c,d){var e=document.createElement("span");e.style.color="blue";e.style.textDecoration="underline";e.style.cursor="pointer";null!=d&&(e.style.paddingLeft=d+"px");mxEvent.addListener(e,"click",c);mxUtils.write(e,b);null!=a&&a.appendChild(e);return e},fit:function(a){var b=parseInt(a.offsetLeft),c=parseInt(a.offsetWidth),d=mxUtils.getDocumentScrollOrigin(a.ownerDocument),e=d.x,d=d.y,f=document.body,g=document.documentElement,k=e+(f.clientWidth||g.clientWidth);b+c>k&&(a.style.left=Math.max(e,k-c)+"px");b=parseInt(a.offsetTop);c=parseInt(a.offsetHeight);f=d+Math.max(f.clientHeight||0,g.clientHeight);b+c>f&&(a.style.top=Math.max(d,f-c)+"px")},load:function(a){a=new mxXmlRequest(a,null,"GET",!1);a.send();return a},get:function(a,b,c,d,e,f){a=new mxXmlRequest(a,null,"GET");null!=d&&a.setBinary(d);a.send(b,c,e,f);return a},post:function(a,b,c,d){return(new mxXmlRequest(a,b)).send(c,d)},submit:function(a,b,c,d){return(new mxXmlRequest(a,b)).simulate(c,d)},loadInto:function(a,b,c){mxClient.IS_IE?b.onreadystatechange=function(){4==b.readyState&&c()}:b.addEventListener("load",c,!1);b.load(a)},getValue:function(a,b,c){a=null!=a?a[b]:null;null==a&&(a=c);return a},getNumber:function(a,b,c){a=null!=a?a[b]:null;null==a&&(a=c||0);return Number(a)},getColor:function(a,b,c){a=null!=a?a[b]:null;null==a?a=c:a==mxConstants.NONE&&(a=null);return a},clone:function(a,b,c){c=null!=c?c:!1;var d=null;if(null!=a&&"function"==typeof a.constructor){var d=new a.constructor,e;for(e in a)e!=mxObjectIdentity.FIELD_NAME&&(null==b||0>mxUtils.indexOf(b,e))&&(d[e]=c||"object"!=typeof a[e]?a[e]:mxUtils.clone(a[e]))}return d},equalPoints:function(a,b){if(null==a&&null!=b||null!=a&&null==b||null!=a&&null!=b&&a.length!=b.length)return!1;if(null!=a&&null!=b)for(var c=0;c<a.length;c++)if(a[c]==b[c]||null!=a[c]&&!a[c].equals(b[c]))return!1;return!0},equalEntries:function(a,b){if(null==a&&null!=b||null!=a&&null==b||null!=a&&null!=b&&a.length!=b.length)return!1;if(null!=a&&null!=b)for(var c in a)if(!(mxUtils.isNaN(a[c])&&mxUtils.isNaN(b[c])||a[c]==b[c]))return!1;return!0},isNaN:function(a){return"number"==typeof a&&isNaN(a)},extend:function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a},toString:function(a){var b="",c;for(c in a)try{if(null==a[c])b+=c+" = [null]\n";else if("function"==typeof a[c])b+=c+" => [Function]\n";else if("object"==typeof a[c])var d=mxUtils.getFunctionName(a[c].constructor),b=b+(c+" => ["+d+"]\n");else b+=c+" = "+a[c]+"\n"}catch(e){b+=c+"="+e.message}return b},toRadians:function(a){return Math.PI*a/180},toDegree:function(a){return 180*a/Math.PI},arcToCurves:function(a,b,c,d,e,f,g,k,l){k-=a;l-=b;if(0===c||0===d)return q;c=Math.abs(c);d=Math.abs(d);var m=-k/2,n=-l/2,p=Math.cos(e*Math.PI/180),q=Math.sin(e*Math.PI/180);e=p*m+q*n;var m=-1*q*m+p*n,n=e*e,u=m*m,v=c*c,y=d*d,z=n/v+u/y;1<z?(c*=Math.sqrt(z),d*=Math.sqrt(z),f=0):(z=1,f===g&&(z=-1),f=z*Math.sqrt((v*y-v*u-y*n)/(v*u+y*n)));n=f*c*m/d;u=-1*f*d*e/c;k=p*n-q*u+k/2;l=q*n+p*u+l/2;v=Math.atan2((m-u)/d,(e-n)/c)-Math.atan2(0,1);f=0<=v?v:2*Math.PI+v;v=Math.atan2((-m-u)/d,(-e-n)/c)-Math.atan2((m-u)/d,(e-n)/c);e=0<=v?v:2*Math.PI+
v;0==g&&0<e?e-=2*Math.PI:0!=g&&0>e&&(e+=2*Math.PI);g=2*e/Math.PI;g=Math.ceil(0>g?-1*g:g);e/=g;m=8/3*Math.sin(e/4)*Math.sin(e/4)/Math.sin(e/2);n=p*c;p*=d;c*=q;d*=q;for(var x=Math.cos(f),B=Math.sin(f),u=-m*(n*B+d*x),v=-m*(c*B-p*x),q=[],A=0;A<g;++A){f+=e;var x=Math.cos(f),B=Math.sin(f),y=n*x-d*B+k,z=c*x+p*B+l,D=-m*(n*B+d*x),x=-m*(c*B-p*x),B=6*A;q[B]=Number(u+a);q[B+1]=Number(v+b);q[B+2]=Number(y-D+a);q[B+3]=Number(z-x+b);q[B+4]=Number(y+a);q[B+5]=Number(z+b);u=y+D;v=z+x}return q},getBoundingBox:function(a,
b,c){var d=null;if(null!=a&&null!=b&&0!=b){b=mxUtils.toRadians(b);var d=Math.cos(b),e=Math.sin(b);c=null!=c?c:new mxPoint(a.x+a.width/2,a.y+a.height/2);var f=new mxPoint(a.x,a.y);b=new mxPoint(a.x+a.width,a.y);var g=new mxPoint(b.x,a.y+a.height);a=new mxPoint(a.x,g.y);f=mxUtils.getRotatedPoint(f,d,e,c);b=mxUtils.getRotatedPoint(b,d,e,c);g=mxUtils.getRotatedPoint(g,d,e,c);a=mxUtils.getRotatedPoint(a,d,e,c);d=new mxRectangle(f.x,f.y,0,0);d.add(new mxRectangle(b.x,b.y,0,0));d.add(new mxRectangle(g.x,g.y,0,0));d.add(new mxRectangle(a.x,a.y,0,0))}return d},getRotatedPoint:function(a,b,c,d){d=null!=d?d:new mxPoint;var e=a.x-d.x;a=a.y-d.y;return new mxPoint(e*b-a*c+d.x,a*b+e*c+d.y)},getPortConstraints:function(a,b,c,d){b=mxUtils.getValue(a.style,mxConstants.STYLE_PORT_CONSTRAINT,null);if(null==b)return d;d=b.toString();b=mxConstants.DIRECTION_MASK_NONE;c=0;1==mxUtils.getValue(a.style,mxConstants.STYLE_PORT_CONSTRAINT_ROTATION,0)&&(c=mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0));a=0;45<c?(a=1,135<=c&&(a=2)):-45>c&&(a=3,-135>=c&&(a=2));if(0<=d.indexOf(mxConstants.DIRECTION_NORTH))switch(a){case 0:b|=mxConstants.DIRECTION_MASK_NORTH;break;case 1:b|=mxConstants.DIRECTION_MASK_EAST;break;case 2:b|=mxConstants.DIRECTION_MASK_SOUTH;break;case 3:b|=mxConstants.DIRECTION_MASK_WEST}if(0<=d.indexOf(mxConstants.DIRECTION_WEST))switch(a){case 0:b|=mxConstants.DIRECTION_MASK_WEST;break;case 1:b|=mxConstants.DIRECTION_MASK_NORTH;break;case 2:b|=mxConstants.DIRECTION_MASK_EAST;break;case 3:b|=mxConstants.DIRECTION_MASK_SOUTH}if(0<=d.indexOf(mxConstants.DIRECTION_SOUTH))switch(a){case 0:b|=mxConstants.DIRECTION_MASK_SOUTH;break;case 1:b|=mxConstants.DIRECTION_MASK_WEST;break;case 2:b|=mxConstants.DIRECTION_MASK_NORTH;break;case 3:b|=mxConstants.DIRECTION_MASK_EAST}if(0<=d.indexOf(mxConstants.DIRECTION_EAST))switch(a){case 0:b|=mxConstants.DIRECTION_MASK_EAST;break;case 1:b|=mxConstants.DIRECTION_MASK_SOUTH;break;case 2:b|=mxConstants.DIRECTION_MASK_WEST;break;case 3:b|=mxConstants.DIRECTION_MASK_NORTH}return b},reversePortConstraints:function(a){var b=0,b=(a&mxConstants.DIRECTION_MASK_WEST)<<3,b=b|(a&mxConstants.DIRECTION_MASK_NORTH)<<1,b=b|(a&mxConstants.DIRECTION_MASK_SOUTH)>>1;return b|(a&mxConstants.DIRECTION_MASK_EAST)>>3},findNearestSegment:function(a,b,c){var d=-1;if(0<a.absolutePoints.length)for(var e=a.absolutePoints[0],f=null,g=1;g<a.absolutePoints.length;g++){var k=a.absolutePoints[g],e=mxUtils.ptSegDistSq(e.x,e.y,k.x,k.y,b,c);if(null==f||e<f)f=e,d=g-1;e=k}return d},rectangleIntersectsSegment:function(a,b,c){var d=a.y,e=a.x,f=d+a.height,g=e+a.width;a=b.x;var k=c.x;b.x>c.x&&(a=c.x,k=b.x);k>g&&(k=g);a<e&&(a=e);if(a>k)return!1;var e=b.y,g=c.y,l=c.x-b.x;1E-7<Math.abs(l)&&(c=(c.y-b.y)/l,b=b.y-c*b.x,e=c*a+b,g=c*k+b);e>g&&(b=g,g=e,e=b);g>f&&(g=f);e<d&&(e=d);return e>g?!1:!0},contains:function(a,b,c){return a.x<=b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c},intersects:function(a,b){var c=a.width,d=a.height,e=b.width,f=b.height;if(0>=e||0>=f||0>=c||0>=d)return!1;var g=a.x,k=a.y,l=b.x,m=b.y,e=e+l,f=f+m,c=c+
g,d=d+k;return(e<l||e>g)&&(f<m||f>k)&&(c<g||c>l)&&(d<k||d>m)},intersectsHotspot:function(a,b,c,d,e,f){d=null!=d?d:1;e=null!=e?e:0;f=null!=f?f:0;if(0<d){var g=a.getCenterX(),k=a.getCenterY(),l=a.width,m=a.height,n=mxUtils.getValue(a.style,mxConstants.STYLE_STARTSIZE)*a.view.scale;0<n&&(mxUtils.getValue(a.style,mxConstants.STYLE_HORIZONTAL,!0)?(k=a.y+n/2,m=n):(g=a.x+n/2,l=n));l=Math.max(e,l*d);m=Math.max(e,m*d);0<f&&(l=Math.min(l,f),m=Math.min(m,f));d=new mxRectangle(g-l/2,k-m/2,l,m);g=mxUtils.toRadians(mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION)||0);0!=g&&(e=Math.cos(-g),f=Math.sin(-g),g=new mxPoint(a.getCenterX(),a.getCenterY()),a=mxUtils.getRotatedPoint(new mxPoint(b,c),e,f,g),b=a.x,c=a.y);return mxUtils.contains(d,b,c)}return!0},getOffset:function(a,b){var c=0,d=0;if(null!=b&&b)var e=mxUtils.getDocumentScrollOrigin(a.ownerDocument),c=c+e.x,d=d+e.y;for(;a.offsetParent;)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;return new mxPoint(c,d)},getDocumentScrollOrigin:function(a){if(mxClient.IS_QUIRKS)return new mxPoint(a.body.scrollLeft,a.body.scrollTop);a=a.defaultView||a.parentWindow;return new mxPoint(null!=a&&void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,null!=a&&void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop)},getScrollOrigin:function(a){for(var b=document.body,c=document.documentElement,d=mxUtils.getDocumentScrollOrigin(null!=a?a.ownerDocument:document);null!=a&&a!=b&&a!=c;)!isNaN(a.scrollLeft)&&!isNaN(a.scrollTop)&&(d.x+=a.scrollLeft,d.y+=a.scrollTop),a=a.parentNode;return d},convertPoint:function(a,b,c){var d=mxUtils.getScrollOrigin(a);a=mxUtils.getOffset(a);a.x-=d.x;a.y-=d.y;return new mxPoint(b-a.x,c-a.y)},ltrim:function(a,b){return a.replace(RegExp("^["+(b||"\\s")+"]+","g"),"")},rtrim:function(a,b){return a.replace(RegExp("["+(b||"\\s")+"]+$","g"),"")},trim:function(a,b){return mxUtils.ltrim(mxUtils.rtrim(a,b),b)},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)&&("string"!=typeof a||0>a.toLowerCase().indexOf("0x"))},isInteger:function(a){return String(parseInt(a))===String(a)},mod:function(a,b){return(a%b+b)%b},intersection:function(a,b,c,d,e,f,g,k){var l=(k-f)*(c-a)-(g-e)*(d-b);g=((g-e)*(b-f)-(k-f)*(a-e))/l;e=((c-a)*(b-f)-(d-b)*(a-e))/l;return 0<=g&&1>=g&&0<=e&&1>=e?new mxPoint(a+g*(c-a),b+g*(d-b)):null},ptSegDistSq:function(a,b,c,d,e,f){c-=a;d-=b;e-=a;f-=b;0>=e*c+f*d?c=0:(e=c-e,f=d-f,a=e*c+f*d,c=0>=a?0:a*a/(c*c+d*d));e=e*e+f*f-c;0>e&&(e=0);
return e},ptLineDist:function(a,b,c,d,e,f){return Math.abs((d-b)*e-(c-a)*f+c*b-d*a)/Math.sqrt((d-b)*(d-b)+(c-a)*(c-a))},relativeCcw:function(a,b,c,d,e,f){c-=a;d-=b;e-=a;f-=b;a=e*d-f*c;0==a&&(a=e*c+f*d,0<a&&(a=(e-c)*c+(f-d)*d,0>a&&(a=0)));return 0>a?-1:0<a?1:0},animateChanges:function(a,b){mxEffects.animateChanges.apply(this,arguments)},cascadeOpacity:function(a,b,c){mxEffects.cascadeOpacity.apply(this,arguments)},fadeOut:function(a,b,c,d,e,f){mxEffects.fadeOut.apply(this,arguments)},setOpacity:function(a,
b){mxUtils.isVml(a)?a.style.filter=100<=b?"":"alpha(opacity="+b/5+")":mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?a.style.filter=100<=b?"":"alpha(opacity="+b+")":a.style.opacity=b/100},createImage:function(a){var b=null;mxClient.IS_IE6&&"CSS1Compat"!=document.compatMode?(b=document.createElement(mxClient.VML_PREFIX+":image"),b.setAttribute("src",a),b.style.borderStyle="none"):(b=document.createElement("img"),b.setAttribute("src",a),b.setAttribute("border","0"));return b},sortCells:function(a,b){b=null!=b?b:!0;var c=new mxDictionary;a.sort(function(a,e){var f=c.get(a);null==f&&(f=mxCellPath.create(a).split(mxCellPath.PATH_SEPARATOR),c.put(a,f));var g=c.get(e);null==g&&(g=mxCellPath.create(e).split(mxCellPath.PATH_SEPARATOR),c.put(e,g));f=mxCellPath.compare(f,g);return 0==f?0:0<f==b?1:-1});return a},getStylename:function(a){return null!=a&&(a=a.split(";")[0],0>a.indexOf("="))?a:""},getStylenames:function(a){var b=[];if(null!=a){a=a.split(";");for(var c=0;c<a.length;c++)0>a[c].indexOf("=")&&b.push(a[c])}return b},indexOfStylename:function(a,b){if(null!=a&&null!=b)for(var c=a.split(";"),d=0,e=0;e<c.length;e++){if(c[e]==b)return d;d+=c[e].length+1}return-1},addStylename:function(a,b){0>mxUtils.indexOfStylename(a,b)&&(null==a?a="":0<a.length&&";"!=a.charAt(a.length-1)&&(a+=";"),a+=b);return a},removeStylename:function(a,b){var c=[];if(null!=a)for(var d=a.split(";"),e=0;e<d.length;e++)d[e]!=b&&c.push(d[e]);return c.join(";")},removeAllStylenames:function(a){var b=[];if(null!=a){a=a.split(";");for(var c=0;c<a.length;c++)0<=a[c].indexOf("=")&&b.push(a[c])}return b.join(";")},setCellStyles:function(a,b,c,d){if(null!=b&&0<b.length){a.beginUpdate();try{for(var e=0;e<b.length;e++)if(null!=b[e]){var f=mxUtils.setStyle(a.getStyle(b[e]),c,d);a.setStyle(b[e],f)}}finally{a.endUpdate()}}},setStyle:function(a,b,c){var d=null!=c&&("undefined"==typeof c.length||0<c.length);if(null==a||0==a.length)d&&(a=b+"="+c+";");else if(a.substring(0,b.length+1)==b+"="){var e=a.indexOf(";");a=d?b+"="+c+(0>e?";":a.substring(e)):0>e||e==a.length-1?"":a.substring(e+1)}else{var f=a.indexOf(";"+b+"=");0>f?d&&(d=";"==a.charAt(a.length-1)?"":";",a=a+d+b+"="+c+";"):(e=a.indexOf(";",f+1),a=d?a.substring(0,f+1)+b+"="+c+(0>e?";":a.substring(e)):a.substring(0,f)+(0>e?";":a.substring(e)))}return a},setCellStyleFlags:function(a,b,c,d,e){if(null!=b&&0<b.length){a.beginUpdate();try{for(var f=0;f<b.length;f++)if(null!=b[f]){var g=mxUtils.setStyleFlag(a.getStyle(b[f]),c,d,e);a.setStyle(b[f],g)}}finally{a.endUpdate()}}},setStyleFlag:function(a,b,c,d){if(null==a||0==a.length)a=d||null==d?b+"="+c:b+"=0";else{var e=a.indexOf(b+"=");if(0>e)e=";"==a.charAt(a.length-1)?"":";",a=d||null==d?a+e+b+"="+c:a+e+b+"=0";else{var f=a.indexOf(";",e),g="",g=0>f?a.substring(e+b.length+1):a.substring(e+b.length+1,f),g=null==d?parseInt(g)^c:d?parseInt(g)|c:parseInt(g)&~c;a=a.substring(0,e)+b+"="+g+(0<=f?a.substring(f):"")}}return a},getAlignmentAsPoint:function(a,b){var c=0,d=0;a==mxConstants.ALIGN_CENTER?c=-0.5:a==mxConstants.ALIGN_RIGHT&&(c=-1);b==mxConstants.ALIGN_MIDDLE?d=-0.5:b==mxConstants.ALIGN_BOTTOM&&(d=-1);return new mxPoint(c,d)},getSizeForString:function(a,b,c,d){b=null!=b?b:mxConstants.DEFAULT_FONTSIZE;c=null!=c?c:mxConstants.DEFAULT_FONTFAMILY;var e=document.createElement("div");e.style.fontFamily=c;e.style.fontSize=Math.round(b)+"px";e.style.lineHeight=Math.round(b*mxConstants.LINE_HEIGHT)+"px";e.style.position="absolute";e.style.visibility="hidden";e.style.display=mxClient.IS_QUIRKS?"inline":"inline-block";e.style.zoom="1";null!=d?(e.style.width=d+"px",e.style.whiteSpace="normal"):e.style.whiteSpace="nowrap";e.innerHTML=a;document.body.appendChild(e);a=new mxRectangle(0,0,e.offsetWidth,e.offsetHeight);document.body.removeChild(e);return a},getViewXml:function(a,b,c,d,e){d=null!=d?d:0;e=null!=e?e:0;b=null!=b?b:1;null==c&&(c=[a.getModel().getRoot()]);var f=a.getView(),g=null,k=f.isEventsEnabled();f.setEventsEnabled(!1);var l=f.drawPane,m=f.overlayPane;a.dialect==mxConstants.DIALECT_SVG?(f.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),f.canvas.appendChild(f.drawPane),f.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g")):(f.drawPane=f.drawPane.cloneNode(!1),f.canvas.appendChild(f.drawPane),f.overlayPane=f.overlayPane.cloneNode(!1));f.canvas.appendChild(f.overlayPane);var n=f.getTranslate();f.translate=new mxPoint(d,e);b=new mxTemporaryCellStates(a.getView(),b,c);try{g=(new mxCodec).encode(a.getView())}finally{b.destroy(),f.translate=n,f.canvas.removeChild(f.drawPane),f.canvas.removeChild(f.overlayPane),f.drawPane=l,f.overlayPane=m,f.setEventsEnabled(k)}return g},getScaleForPageCount:function(a,b,c,d){if(1>a)return 1;c=null!=c?c:mxConstants.PAGE_FORMAT_A4_PORTRAIT;d=null!=d?d:0;var e=c.width-2*d;c=c.height-2*d;d=b.getGraphBounds().clone();b=b.getView().getScale();d.width/=b;d.height/=b;b=d.width;c=b/d.height/(e/c);d=Math.sqrt(a);var f=Math.sqrt(c);c=d*f;d/=f;if(1>c&&d>a){var g=d/a;d=a;c/=g}1>d&&c>a&&(g=c/a,c=a,d/=g);g=Math.ceil(c)*Math.ceil(d);for(f=0;g>a;){var g=Math.floor(c)/c,k=Math.floor(d)/d;1==g&&(g=
Math.floor(c-1)/c);1==k&&(k=Math.floor(d-1)/d);g=g>k?g:k;c*=g;d*=g;g=Math.ceil(c)*Math.ceil(d);f++;if(10<f)break}return e*c/b*0.99999},show:function(a,b,c,d,e,f){c=null!=c?c:0;d=null!=d?d:0;null==b?b=window.open().document:b.open();9==document.documentMode&&b.writeln('\x3c!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=9"><![endif]--\x3e');var g=a.getGraphBounds(),k=Math.ceil(c-g.x),l=Math.ceil(d-g.y);null==e&&(e=Math.ceil(g.width+c)+Math.ceil(Math.ceil(g.x)-g.x));null==f&&(f=Math.ceil(g.height+
d)+Math.ceil(Math.ceil(g.y)-g.y));if(mxClient.IS_IE||11==document.documentMode){d="<html><head>";g=document.getElementsByTagName("base");for(c=0;c<g.length;c++)d+=g[c].outerHTML;d+="<style>";for(c=0;c<document.styleSheets.length;c++)try{d+=document.styleSheets(c).cssText}catch(m){}d=d+'</style></head><body style="margin:0px;">'+('<div style="position:absolute;overflow:hidden;width:'+e+"px;height:"+f+'px;"><div style="position:relative;left:'+k+"px;top:"+l+'px;">')+a.container.innerHTML;d+="</div></div></body><html>";b.writeln(d);b.close()}else{b.writeln("<html><head>");g=document.getElementsByTagName("base");for(c=0;c<g.length;c++)b.writeln(mxUtils.getOuterHtml(g[c]));d=document.getElementsByTagName("link");for(c=0;c<d.length;c++)b.writeln(mxUtils.getOuterHtml(d[c]));d=document.getElementsByTagName("style");for(c=0;c<d.length;c++)b.writeln(mxUtils.getOuterHtml(d[c]));b.writeln('</head><body style="margin:0px;"></body></html>');b.close();c=b.createElement("div");c.position="absolute";c.overflow="hidden";c.style.width=e+"px";c.style.height=f+"px";e=b.createElement("div");e.style.position="absolute";e.style.left=k+"px";e.style.top=l+"px";f=a.container.firstChild;for(d=null;null!=f;)g=f.cloneNode(!0),f==a.view.drawPane.ownerSVGElement?(c.appendChild(g),d=g):e.appendChild(g),f=f.nextSibling;b.body.appendChild(c);null!=e.firstChild&&b.body.appendChild(e);null!=d&&(d.style.minWidth="",d.style.minHeight="",d.firstChild.setAttribute("transform","translate("+k+","+l+")"))}mxUtils.removeCursors(b.body);return b},printScreen:function(a){var b=window.open();a.getGraphBounds();mxUtils.show(a,b.document);a=function(){b.focus();b.print();b.close()};mxClient.IS_GC?b.setTimeout(a,500):a()},popup:function(a,b){if(b){var c=document.createElement("div");c.style.overflow="scroll";c.style.width="636px";c.style.height="460px";var d=document.createElement("pre");d.innerHTML=mxUtils.htmlEntities(a,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;");c.appendChild(d);var d=document.body.clientWidth,e=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight),c=new mxWindow("Popup Window",c,d/2-320,e/2-240,640,480,!1,!0);c.setClosable(!0);c.setVisible(!0)}else mxClient.IS_NS?(c=window.open(),c.document.writeln("<pre>"+mxUtils.htmlEntities(a)+"</pre"),c.document.close()):(c=window.open(),d=c.document.createElement("pre"),d.innerHTML=mxUtils.htmlEntities(a,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),c.document.body.appendChild(d))},alert:function(a){alert(a)},prompt:function(a,b){return prompt(a,null!=b?b:"")},confirm:function(a){return confirm(a)},error:function(a,b,c,d){var e=document.createElement("div");e.style.padding="20px";var f=document.createElement("img");f.setAttribute("src",d||mxUtils.errorImage);f.setAttribute("valign","bottom");f.style.verticalAlign="middle";e.appendChild(f);e.appendChild(document.createTextNode("\u00a0"));e.appendChild(document.createTextNode("\u00a0"));e.appendChild(document.createTextNode("\u00a0"));mxUtils.write(e,a);a=document.body.clientWidth;d=document.body.clientHeight||document.documentElement.clientHeight;var g=new mxWindow(mxResources.get(mxUtils.errorResource)||mxUtils.errorResource,e,(a-b)/2,d/4,b,null,!1,!0);c&&(mxUtils.br(e),b=document.createElement("p"),c=document.createElement("button"),mxClient.IS_IE?c.style.cssText="float:right":c.setAttribute("style","float:right"),mxEvent.addListener(c,"click",function(a){g.destroy()}),mxUtils.write(c,mxResources.get(mxUtils.closeResource)||mxUtils.closeResource),b.appendChild(c),e.appendChild(b),mxUtils.br(e),g.setClosable(!0));g.setVisible(!0);return g},
makeDraggable:function(a,b,c,d,e,f,g,k,l,m){a=new mxDragSource(a,c);a.dragOffset=new mxPoint(null!=e?e:0,null!=f?f:mxConstants.TOOLTIP_VERTICAL_OFFSET);a.autoscroll=g;a.setGuidesEnabled(!1);null!=l&&(a.highlightDropTargets=l);null!=m&&(a.getDropTarget=m);a.getGraphForEvent=function(a){return"function"==typeof b?b(a):b};null!=d&&(a.createDragElement=function(){return d.cloneNode(!0)},k&&(a.createPreviewElement=function(a){var b=d.cloneNode(!0),c=parseInt(b.style.width),e=parseInt(b.style.height);b.style.width=Math.round(c*a.view.scale)+"px";b.style.height=Math.round(e*a.view.scale)+"px";return b}));return a}},mxConstants={DEFAULT_HOTSPOT:0.3,MIN_HOTSPOT_SIZE:8,MAX_HOTSPOT_SIZE:0,RENDERING_HINT_EXACT:"exact",RENDERING_HINT_FASTER:"faster",RENDERING_HINT_FASTEST:"fastest",DIALECT_SVG:"svg",DIALECT_VML:"vml",DIALECT_MIXEDHTML:"mixedHtml",DIALECT_PREFERHTML:"preferHtml",DIALECT_STRICTHTML:"strictHtml",NS_SVG:"http://www.w3.org/2000/svg",NS_XHTML:"http://www.w3.org/1999/xhtml",NS_XLINK:"http://www.w3.org/1999/xlink",SHADOWCOLOR:"gray",SHADOW_OFFSET_X:2,SHADOW_OFFSET_Y:3,SHADOW_OPACITY:1,NODETYPE_ELEMENT:1,NODETYPE_ATTRIBUTE:2,NODETYPE_TEXT:3,NODETYPE_CDATA:4,NODETYPE_ENTITY_REFERENCE:5,NODETYPE_ENTITY:6,NODETYPE_PROCESSING_INSTRUCTION:7,NODETYPE_COMMENT:8,NODETYPE_DOCUMENT:9,NODETYPE_DOCUMENTTYPE:10,NODETYPE_DOCUMENT_FRAGMENT:11,NODETYPE_NOTATION:12,TOOLTIP_VERTICAL_OFFSET:16,DEFAULT_VALID_COLOR:"#00FF00",DEFAULT_INVALID_COLOR:"#FF0000",OUTLINE_HIGHLIGHT_COLOR:"#00FF00",OUTLINE_HIGHLIGHT_STROKEWIDTH:5,HIGHLIGHT_STROKEWIDTH:3,CURSOR_MOVABLE_VERTEX:"move",CURSOR_MOVABLE_EDGE:"move",CURSOR_LABEL_HANDLE:"default",CURSOR_TERMINAL_HANDLE:"pointer",CURSOR_BEND_HANDLE:"crosshair",CURSOR_VIRTUAL_BEND_HANDLE:"crosshair",CURSOR_CONNECT:"pointer",HIGHLIGHT_COLOR:"#00FF00",CONNECT_TARGET_COLOR:"#0000FF",INVALID_CONNECT_TARGET_COLOR:"#FF0000",DROP_TARGET_COLOR:"#0000FF",VALID_COLOR:"#00FF00",INVALID_COLOR:"#FF0000",EDGE_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_STROKEWIDTH:1,EDGE_SELECTION_STROKEWIDTH:1,VERTEX_SELECTION_DASHED:!0,EDGE_SELECTION_DASHED:!0,GUIDE_COLOR:"#FF0000",GUIDE_STROKEWIDTH:1,OUTLINE_COLOR:"#0099FF",OUTLINE_STROKEWIDTH:mxClient.IS_IE?2:3,HANDLE_SIZE:7,LABEL_HANDLE_SIZE:4,HANDLE_FILLCOLOR:"#00FF00",HANDLE_STROKECOLOR:"black",LABEL_HANDLE_FILLCOLOR:"yellow",CONNECT_HANDLE_FILLCOLOR:"#0000FF",LOCKED_HANDLE_FILLCOLOR:"#FF0000",OUTLINE_HANDLE_FILLCOLOR:"#00FFFF",OUTLINE_HANDLE_STROKECOLOR:"#0033FF",DEFAULT_FONTFAMILY:"Arial,Helvetica",DEFAULT_FONTSIZE:11,DEFAULT_TEXT_DIRECTION:"",LINE_HEIGHT:1.2,ABSOLUTE_LINE_HEIGHT:!1,DEFAULT_FONTSTYLE:0,DEFAULT_STARTSIZE:40,DEFAULT_MARKERSIZE:6,DEFAULT_IMAGESIZE:24,ENTITY_SEGMENT:30,RECTANGLE_ROUNDING_FACTOR:0.15,LINE_ARCSIZE:20,ARROW_SPACING:10,ARROW_WIDTH:30,ARROW_SIZE:30,PAGE_FORMAT_A4_PORTRAIT:new mxRectangle(0,0,826,1169),PAGE_FORMAT_A4_LANDSCAPE:new mxRectangle(0,0,1169,826),PAGE_FORMAT_LETTER_PORTRAIT:new mxRectangle(0,0,850,1100),PAGE_FORMAT_LETTER_LANDSCAPE:new mxRectangle(0,0,1100,850),NONE:"none",STYLE_PERIMETER:"perimeter",STYLE_SOURCE_PORT:"sourcePort",STYLE_TARGET_PORT:"targetPort",STYLE_PORT_CONSTRAINT:"portConstraint",STYLE_PORT_CONSTRAINT_ROTATION:"portConstraintRotation",STYLE_OPACITY:"opacity",STYLE_TEXT_OPACITY:"textOpacity",STYLE_TEXT_DIRECTION:"textDirection",STYLE_OVERFLOW:"overflow",STYLE_ORTHOGONAL:"orthogonal",STYLE_EXIT_X:"exitX",STYLE_EXIT_Y:"exitY",STYLE_EXIT_PERIMETER:"exitPerimeter",STYLE_ENTRY_X:"entryX",STYLE_ENTRY_Y:"entryY",STYLE_ENTRY_PERIMETER:"entryPerimeter",STYLE_WHITE_SPACE:"whiteSpace",STYLE_ROTATION:"rotation",STYLE_FILLCOLOR:"fillColor",STYLE_POINTER_EVENTS:"pointerEvents",STYLE_SWIMLANE_FILLCOLOR:"swimlaneFillColor",STYLE_MARGIN:"margin",STYLE_GRADIENTCOLOR:"gradientColor",STYLE_GRADIENT_DIRECTION:"gradientDirection",STYLE_STROKECOLOR:"strokeColor",STYLE_SEPARATORCOLOR:"separatorColor",STYLE_STROKEWIDTH:"strokeWidth",STYLE_ALIGN:"align",STYLE_VERTICAL_ALIGN:"verticalAlign",STYLE_LABEL_WIDTH:"labelWidth",STYLE_LABEL_POSITION:"labelPosition",STYLE_VERTICAL_LABEL_POSITION:"verticalLabelPosition",STYLE_IMAGE_ASPECT:"imageAspect",STYLE_IMAGE_ALIGN:"imageAlign",STYLE_IMAGE_VERTICAL_ALIGN:"imageVerticalAlign",STYLE_GLASS:"glass",STYLE_IMAGE:"image",STYLE_IMAGE_WIDTH:"imageWidth",STYLE_IMAGE_HEIGHT:"imageHeight",STYLE_IMAGE_BACKGROUND:"imageBackground",STYLE_IMAGE_BORDER:"imageBorder",STYLE_FLIPH:"flipH",STYLE_FLIPV:"flipV",STYLE_NOLABEL:"noLabel",STYLE_NOEDGESTYLE:"noEdgeStyle",STYLE_LABEL_BACKGROUNDCOLOR:"labelBackgroundColor",STYLE_LABEL_BORDERCOLOR:"labelBorderColor",STYLE_LABEL_PADDING:"labelPadding",STYLE_INDICATOR_SHAPE:"indicatorShape",STYLE_INDICATOR_IMAGE:"indicatorImage",STYLE_INDICATOR_COLOR:"indicatorColor",STYLE_INDICATOR_STROKECOLOR:"indicatorStrokeColor",STYLE_INDICATOR_GRADIENTCOLOR:"indicatorGradientColor",STYLE_INDICATOR_SPACING:"indicatorSpacing",STYLE_INDICATOR_WIDTH:"indicatorWidth",STYLE_INDICATOR_HEIGHT:"indicatorHeight",STYLE_INDICATOR_DIRECTION:"indicatorDirection",STYLE_SHADOW:"shadow",STYLE_SEGMENT:"segment",STYLE_ENDARROW:"endArrow",STYLE_STARTARROW:"startArrow",STYLE_ENDSIZE:"endSize",STYLE_STARTSIZE:"startSize",STYLE_SWIMLANE_LINE:"swimlaneLine",STYLE_ENDFILL:"endFill",STYLE_STARTFILL:"startFill",STYLE_DASHED:"dashed",STYLE_DASH_PATTERN:"dashPattern",STYLE_ROUNDED:"rounded",STYLE_CURVED:"curved",STYLE_ARCSIZE:"arcSize",STYLE_SMOOTH:"smooth",STYLE_SOURCE_PERIMETER_SPACING:"sourcePerimeterSpacing",STYLE_TARGET_PERIMETER_SPACING:"targetPerimeterSpacing",STYLE_PERIMETER_SPACING:"perimeterSpacing",STYLE_SPACING:"spacing",STYLE_SPACING_TOP:"spacingTop",STYLE_SPACING_LEFT:"spacingLeft",STYLE_SPACING_BOTTOM:"spacingBottom",STYLE_SPACING_RIGHT:"spacingRight",STYLE_HORIZONTAL:"horizontal",STYLE_DIRECTION:"direction",STYLE_ELBOW:"elbow",STYLE_FONTCOLOR:"fontColor",STYLE_FONTFAMILY:"fontFamily",STYLE_FONTSIZE:"fontSize",STYLE_FONTSTYLE:"fontStyle",STYLE_ASPECT:"aspect",STYLE_AUTOSIZE:"autosize",STYLE_FOLDABLE:"foldable",STYLE_EDITABLE:"editable",STYLE_BENDABLE:"bendable",STYLE_MOVABLE:"movable",STYLE_RESIZABLE:"resizable",STYLE_ROTATABLE:"rotatable",STYLE_CLONEABLE:"cloneable",STYLE_DELETABLE:"deletable",STYLE_SHAPE:"shape",STYLE_EDGE:"edgeStyle",STYLE_LOOP:"loopStyle",STYLE_ROUTING_CENTER_X:"routingCenterX",STYLE_ROUTING_CENTER_Y:"routingCenterY",FONT_BOLD:1,FONT_ITALIC:2,FONT_UNDERLINE:4,SHAPE_RECTANGLE:"rectangle",SHAPE_ELLIPSE:"ellipse",SHAPE_DOUBLE_ELLIPSE:"doubleEllipse",SHAPE_RHOMBUS:"rhombus",SHAPE_LINE:"line",SHAPE_IMAGE:"image",SHAPE_ARROW:"arrow",SHAPE_ARROW_CONNECTOR:"arrowConnector",SHAPE_LABEL:"label",SHAPE_CYLINDER:"cylinder",SHAPE_SWIMLANE:"swimlane",SHAPE_CONNECTOR:"connector",SHAPE_ACTOR:"actor",SHAPE_CLOUD:"cloud",SHAPE_TRIANGLE:"triangle",SHAPE_HEXAGON:"hexagon",ARROW_CLASSIC:"classic",ARROW_BLOCK:"block",ARROW_OPEN:"open",ARROW_OVAL:"oval",ARROW_DIAMOND:"diamond",ARROW_DIAMOND_THIN:"diamondThin",ALIGN_LEFT:"left",ALIGN_CENTER:"center",ALIGN_RIGHT:"right",ALIGN_TOP:"top",ALIGN_MIDDLE:"middle",ALIGN_BOTTOM:"bottom",DIRECTION_NORTH:"north",DIRECTION_SOUTH:"south",DIRECTION_EAST:"east",DIRECTION_WEST:"west",TEXT_DIRECTION_DEFAULT:"",TEXT_DIRECTION_AUTO:"auto",TEXT_DIRECTION_LTR:"ltr",TEXT_DIRECTION_RTL:"rtl",DIRECTION_MASK_NONE:0,DIRECTION_MASK_WEST:1,DIRECTION_MASK_NORTH:2,DIRECTION_MASK_SOUTH:4,DIRECTION_MASK_EAST:8,DIRECTION_MASK_ALL:15,ELBOW_VERTICAL:"vertical",ELBOW_HORIZONTAL:"horizontal",EDGESTYLE_ELBOW:"elbowEdgeStyle",EDGESTYLE_ENTITY_RELATION:"entityRelationEdgeStyle",EDGESTYLE_LOOP:"loopEdgeStyle",EDGESTYLE_SIDETOSIDE:"sideToSideEdgeStyle",EDGESTYLE_TOPTOBOTTOM:"topToBottomEdgeStyle",EDGESTYLE_ORTHOGONAL:"orthogonalEdgeStyle",EDGESTYLE_SEGMENT:"segmentEdgeStyle",PERIMETER_ELLIPSE:"ellipsePerimeter",PERIMETER_RECTANGLE:"rectanglePerimeter",PERIMETER_RHOMBUS:"rhombusPerimeter",PERIMETER_HEXAGON:"hexagonPerimeter",PERIMETER_TRIANGLE:"trianglePerimeter"};function mxEventObject(a){this.name=a;this.properties=[];for(var b=1;b<arguments.length;b+=2)null!=arguments[b+1]&&(this.properties[arguments[b]]=arguments[b+1])}mxEventObject.prototype.name=null;mxEventObject.prototype.properties=null;mxEventObject.prototype.consumed=!1;mxEventObject.prototype.getName=function(){return this.name};mxEventObject.prototype.getProperties=function(){return this.properties};mxEventObject.prototype.getProperty=function(a){return this.properties[a]};mxEventObject.prototype.isConsumed=function(){return this.consumed};mxEventObject.prototype.consume=function(){this.consumed=!0};function mxMouseEvent(a,b){this.evt=a;this.sourceState=this.state=b}mxMouseEvent.prototype.consumed=!1;mxMouseEvent.prototype.evt=null;mxMouseEvent.prototype.graphX=null;mxMouseEvent.prototype.graphY=null;mxMouseEvent.prototype.state=null;mxMouseEvent.prototype.sourceState=null;mxMouseEvent.prototype.getEvent=function(){return this.evt};mxMouseEvent.prototype.getSource=function(){return mxEvent.getSource(this.evt)};mxMouseEvent.prototype.isSource=function(a){return null!=a?mxUtils.isAncestorNode(a.node,this.getSource()):!1};mxMouseEvent.prototype.getX=function(){return mxEvent.getClientX(this.getEvent())};mxMouseEvent.prototype.getY=function(){return mxEvent.getClientY(this.getEvent())};mxMouseEvent.prototype.getGraphX=function(){return this.graphX};mxMouseEvent.prototype.getGraphY=function(){return this.graphY};mxMouseEvent.prototype.getState=function(){return this.state};mxMouseEvent.prototype.getCell=function(){var a=this.getState();return null!=a?a.cell:null};mxMouseEvent.prototype.isPopupTrigger=function(){return mxEvent.isPopupTrigger(this.getEvent())};mxMouseEvent.prototype.isConsumed=function(){return this.consumed};mxMouseEvent.prototype.consume=function(a){(null!=a?a:1)&&this.evt.preventDefault&&this.evt.preventDefault();mxClient.IS_IE&&(this.evt.returnValue=!0);this.consumed=!0};function mxEventSource(a){this.setEventSource(a)}mxEventSource.prototype.eventListeners=null;mxEventSource.prototype.eventsEnabled=!0;mxEventSource.prototype.eventSource=null;mxEventSource.prototype.isEventsEnabled=function(){return this.eventsEnabled};mxEventSource.prototype.setEventsEnabled=function(a){this.eventsEnabled=a};mxEventSource.prototype.getEventSource=function(){return this.eventSource};mxEventSource.prototype.setEventSource=function(a){this.eventSource=a};mxEventSource.prototype.addListener=function(a,b){null==this.eventListeners&&(this.eventListeners=[]);this.eventListeners.push(a);this.eventListeners.push(b)};mxEventSource.prototype.removeListener=function(a){if(null!=this.eventListeners)for(var b=0;b<this.eventListeners.length;)this.eventListeners[b+1]==a?this.eventListeners.splice(b,2):b+=2};mxEventSource.prototype.fireEvent=function(a,b){if(null!=this.eventListeners&&this.isEventsEnabled()){null==a&&(a=new mxEventObject);null==b&&(b=this.getEventSource());null==b&&(b=this);for(var c=[b,a],d=0;d<this.eventListeners.length;d+=2){var e=this.eventListeners[d];null!=e&&e!=a.getName()||this.eventListeners[d+1].apply(this,c)}}};var mxEvent={objects:[],addListener:function(){var a=function(a,c,d){null==a.mxListenerList&&(a.mxListenerList=[],mxEvent.objects.push(a));a.mxListenerList.push({name:c,f:d})};return window.addEventListener?function(b,c,d){b.addEventListener(c,d,!1);a(b,c,d)}:function(b,c,d){b.attachEvent("on"+c,d);a(b,c,d)}}(),removeListener:function(){var a=function(a,c,d){if(null!=a.mxListenerList){c=a.mxListenerList.length;for(var e=0;e<c;e++)if(a.mxListenerList[e].f==d){a.mxListenerList.splice(e,1);break}0==a.mxListenerList.length&&(a.mxListenerList=null,a=mxUtils.indexOf(mxEvent.objects,a),0<=a&&mxEvent.objects.splice(a,1))}};return window.removeEventListener?function(b,c,d){b.removeEventListener(c,d,!1);a(b,c,d)}:function(b,c,d){b.detachEvent("on"+c,d);a(b,c,d)}}(),removeAllListeners:function(a){var b=a.mxListenerList;if(null!=b)for(;0<b.length;){var c=b[0];mxEvent.removeListener(a,c.name,c.f)}},addGestureListeners:function(a,b,c,d){null!=b&&mxEvent.addListener(a,mxClient.IS_POINTER?"MSPointerDown":"mousedown",b);null!=c&&mxEvent.addListener(a,mxClient.IS_POINTER?"MSPointerMove":"mousemove",c);null!=d&&mxEvent.addListener(a,mxClient.IS_POINTER?"MSPointerUp":"mouseup",d);!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(null!=b&&mxEvent.addListener(a,"touchstart",b),null!=c&&mxEvent.addListener(a,"touchmove",c),null!=d&&mxEvent.addListener(a,"touchend",d))},removeGestureListeners:function(a,b,c,d){null!=b&&mxEvent.removeListener(a,mxClient.IS_POINTER?"MSPointerDown":"mousedown",b);null!=c&&mxEvent.removeListener(a,mxClient.IS_POINTER?"MSPointerMove":"mousemove",c);null!=d&&mxEvent.removeListener(a,mxClient.IS_POINTER?"MSPointerUp":"mouseup",d);!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(null!=b&&mxEvent.removeListener(a,"touchstart",b),null!=c&&mxEvent.removeListener(a,"touchmove",c),null!=d&&mxEvent.removeListener(a,"touchend",d))},redirectMouseEvents:function(a,b,c,d,e,f,g){var k=function(a){return"function"==typeof c?c(a):c};mxEvent.addGestureListeners(a,function(a){null!=d?d(a):mxEvent.isConsumed(a)||b.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a,k(a)))},function(a){null!=e?e(a):mxEvent.isConsumed(a)||b.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,k(a)))},function(a){null!=f?f(a):mxEvent.isConsumed(a)||b.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a,k(a)))});mxEvent.addListener(a,"dblclick",function(a){if(null!=g)g(a);else if(!mxEvent.isConsumed(a)){var c=k(a);b.dblClick(a,null!=c?c.cell:null)}})},release:function(a){if(null!=a&&(mxEvent.removeAllListeners(a),a=a.childNodes,null!=a))for(var b=a.length,c=0;c<b;c+=1)mxEvent.release(a[c])},addMouseWheelListener:function(a){if(null!=a){var b=function(b){null==b&&(b=window.event);var d=0,d=mxClient.IS_FF?-b.detail/2:b.wheelDelta/120;0!=d&&a(b,0<d)};mxClient.IS_NS&&null==document.documentMode?mxEvent.addListener(window,mxClient.IS_SF||mxClient.IS_GC?"mousewheel":"DOMMouseScroll",b):mxEvent.addListener(document,"mousewheel",b)}},disableContextMenu:function(){return mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?function(a){mxEvent.addListener(a,"contextmenu",function(){return!1})}:function(a){a.setAttribute("oncontextmenu","return false;")}}(),getSource:function(a){return null!=a.srcElement?a.srcElement:a.target},isConsumed:function(a){return null!=a.isConsumed&&a.isConsumed},isTouchEvent:function(a){return null!=a.pointerType?"touch"==a.pointerType||a.pointerType===a.MSPOINTER_TYPE_TOUCH:null!=a.mozInputSource?5==a.mozInputSource:0==a.type.indexOf("touch")},isMultiTouchEvent:function(a){return null!=a.type&&0==a.type.indexOf("touch")&&null!=a.touches&&1<a.touches.length},isMouseEvent:function(a){return null!=a.pointerType?"mouse"==a.pointerType||a.pointerType===a.MSPOINTER_TYPE_MOUSE:null!=a.mozInputSource?1==a.mozInputSource:0==a.type.indexOf("mouse")},isLeftMouseButton:function(a){return a.button==(mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?1:0)},isMiddleMouseButton:function(a){return a.button==(mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?4:1)},isRightMouseButton:function(a){return 2==a.button},isPopupTrigger:function(a){return mxEvent.isRightMouseButton(a)||mxClient.IS_MAC&&mxEvent.isControlDown(a)&&!mxEvent.isShiftDown(a)&&!mxEvent.isMetaDown(a)&&!mxEvent.isAltDown(a)},isShiftDown:function(a){return null!=a?a.shiftKey:!1},isAltDown:function(a){return null!=a?a.altKey:!1},isControlDown:function(a){return null!=a?a.ctrlKey:!1},isMetaDown:function(a){return null!=a?a.metaKey:!1},getMainEvent:function(a){"touchstart"!=a.type&&"touchmove"!=a.type||null==a.touches||null==a.touches[0]?"touchend"==a.type&&null!=a.changedTouches&&null!=a.changedTouches[0]&&(a=a.changedTouches[0]):a=a.touches[0];return a},getClientX:function(a){return mxEvent.getMainEvent(a).clientX},getClientY:function(a){return mxEvent.getMainEvent(a).clientY},consume:function(a,b,c){c=null!=c?c:!0;if(null!=b?b:1)a.preventDefault?(c&&a.stopPropagation(),a.preventDefault()):c&&(a.cancelBubble=!0);a.isConsumed=!0;a.preventDefault||(a.returnValue=!1)},LABEL_HANDLE:-1,ROTATION_HANDLE:-2,CUSTOM_HANDLE:-100,VIRTUAL_HANDLE:-1E5,MOUSE_DOWN:"mouseDown",MOUSE_MOVE:"mouseMove",MOUSE_UP:"mouseUp",ACTIVATE:"activate",RESIZE_START:"resizeStart",RESIZE:"resize",RESIZE_END:"resizeEnd",MOVE_START:"moveStart",MOVE:"move",MOVE_END:"moveEnd",PAN_START:"panStart",PAN:"pan",PAN_END:"panEnd",MINIMIZE:"minimize",NORMALIZE:"normalize",MAXIMIZE:"maximize",HIDE:"hide",SHOW:"show",CLOSE:"close",DESTROY:"destroy",REFRESH:"refresh",SIZE:"size",SELECT:"select",FIRED:"fired",FIRE_MOUSE_EVENT:"fireMouseEvent",GESTURE:"gesture",TAP_AND_HOLD:"tapAndHold",GET:"get",RECEIVE:"receive",CONNECT:"connect",DISCONNECT:"disconnect",SUSPEND:"suspend",RESUME:"resume",MARK:"mark",ROOT:"root",POST:"post",OPEN:"open",SAVE:"save",BEFORE_ADD_VERTEX:"beforeAddVertex",ADD_VERTEX:"addVertex",AFTER_ADD_VERTEX:"afterAddVertex",DONE:"done",EXECUTE:"execute",EXECUTED:"executed",BEGIN_UPDATE:"beginUpdate",START_EDIT:"startEdit",END_UPDATE:"endUpdate",END_EDIT:"endEdit",BEFORE_UNDO:"beforeUndo",UNDO:"undo",REDO:"redo",CHANGE:"change",NOTIFY:"notify",LAYOUT_CELLS:"layoutCells",CLICK:"click",SCALE:"scale",TRANSLATE:"translate",SCALE_AND_TRANSLATE:"scaleAndTranslate",UP:"up",DOWN:"down",ADD:"add",REMOVE:"remove",CLEAR:"clear",ADD_CELLS:"addCells",CELLS_ADDED:"cellsAdded",MOVE_CELLS:"moveCells",CELLS_MOVED:"cellsMoved",RESIZE_CELLS:"resizeCells",CELLS_RESIZED:"cellsResized",TOGGLE_CELLS:"toggleCells",CELLS_TOGGLED:"cellsToggled",ORDER_CELLS:"orderCells",CELLS_ORDERED:"cellsOrdered",REMOVE_CELLS:"removeCells",CELLS_REMOVED:"cellsRemoved",GROUP_CELLS:"groupCells",UNGROUP_CELLS:"ungroupCells",REMOVE_CELLS_FROM_PARENT:"removeCellsFromParent",FOLD_CELLS:"foldCells",CELLS_FOLDED:"cellsFolded",ALIGN_CELLS:"alignCells",LABEL_CHANGED:"labelChanged",CONNECT_CELL:"connectCell",CELL_CONNECTED:"cellConnected",SPLIT_EDGE:"splitEdge",FLIP_EDGE:"flipEdge",START_EDITING:"startEditing",EDITING_STARTED:"editingStarted",EDITING_STOPPED:"editingStopped",ADD_OVERLAY:"addOverlay",REMOVE_OVERLAY:"removeOverlay",UPDATE_CELL_SIZE:"updateCellSize",ESCAPE:"escape",CLICK:"click",DOUBLE_CLICK:"doubleClick",START:"start",RESET:"reset"};function mxXmlRequest(a,b,c,d,e,f){this.url=a;this.params=b;this.method=c||"POST";this.async=null!=d?d:!0;this.username=e;this.password=f}mxXmlRequest.prototype.url=null;mxXmlRequest.prototype.params=null;mxXmlRequest.prototype.method=null;mxXmlRequest.prototype.async=null;mxXmlRequest.prototype.binary=!1;mxXmlRequest.prototype.withCredentials=!1;mxXmlRequest.prototype.username=null;mxXmlRequest.prototype.password=null;mxXmlRequest.prototype.request=null;mxXmlRequest.prototype.decodeSimulateValues=!1;mxXmlRequest.prototype.isBinary=function(){return this.binary};mxXmlRequest.prototype.setBinary=function(a){this.binary=a};mxXmlRequest.prototype.getText=function(){return this.request.responseText};mxXmlRequest.prototype.isReady=function(){return 4==this.request.readyState};mxXmlRequest.prototype.getDocumentElement=function(){var a=this.getXml();return null!=a?a.documentElement:null};mxXmlRequest.prototype.getXml=function(){var a=this.request.responseXML;if(9<=document.documentMode||null==a||null==a.documentElement)a=mxUtils.parseXml(this.request.responseText);return a};mxXmlRequest.prototype.getText=function(){return this.request.responseText};mxXmlRequest.prototype.getStatus=function(){return this.request.status};mxXmlRequest.prototype.create=function(){if(window.XMLHttpRequest)return function(){var a=new XMLHttpRequest;this.isBinary()&&a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined");return a};if("undefined"!=typeof ActiveXObject)return function(){return new ActiveXObject("Microsoft.XMLHTTP")}}();mxXmlRequest.prototype.send=function(a,b,c,d){this.request=this.create();null!=this.request&&(null!=a&&(this.request.onreadystatechange=mxUtils.bind(this,function(){this.isReady()&&(a(this),this.onreadystatechaange=null)})),!mxClient.IS_QUIRKS&&(null==document.documentMode||10<document.documentMode)&&window.XMLHttpRequest&&null!=c&&null!=d&&(this.request.timeout=c,this.request.ontimeout=d),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),window.XMLHttpRequest&&this.withCredentials&&(this.request.withCredentials="true"),this.request.send(this.params))};mxXmlRequest.prototype.setRequestHeaders=function(a,b){null!=b&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")};mxXmlRequest.prototype.simulate=function(a,b){a=a||document;var c=null;a==document&&(c=window.onbeforeunload,window.onbeforeunload=null);var d=a.createElement("form");d.setAttribute("method",this.method);d.setAttribute("action",this.url);null!=b&&d.setAttribute("target",b);d.style.display="none";d.style.visibility="hidden";for(var e=0<this.params.indexOf("&")?this.params.split("&"):this.params.split(),f=0;f<e.length;f++){var g=e[f].indexOf("=");if(0<g){var k=e[f].substring(0,g),g=e[f].substring(g+
1);this.decodeSimulateValues&&(g=decodeURIComponent(g));var l=a.createElement("textarea");l.setAttribute("name",k);mxUtils.write(l,g);d.appendChild(l)}}a.body.appendChild(d);d.submit();a.body.removeChild(d);null!=c&&(window.onbeforeunload=c)};var mxClipboard={STEPSIZE:10,insertCount:1,cells:null,setCells:function(a){mxClipboard.cells=a},getCells:function(){return mxClipboard.cells},isEmpty:function(){return null==mxClipboard.getCells()},cut:function(a,b){b=mxClipboard.copy(a,b);mxClipboard.insertCount=0;mxClipboard.removeCells(a,b);return b},removeCells:function(a,b){a.removeCells(b)},copy:function(a,b){b=b||a.getSelectionCells();var c=a.getExportableCells(a.model.getTopmostCells(b));mxClipboard.insertCount=1;mxClipboard.setCells(a.cloneCells(c));return c},paste:function(a){var b=null;if(!mxClipboard.isEmpty()){var b=a.getImportableCells(mxClipboard.getCells()),c=mxClipboard.insertCount*mxClipboard.STEPSIZE,d=a.getDefaultParent(),b=a.importCells(b,c,c,d);mxClipboard.insertCount++;a.setSelectionCells(b)}return b}};function mxWindow(a,b,c,d,e,f,g,k,l,m){null!=b&&(g=null!=g?g:!0,this.content=b,this.init(c,d,e,f,m),this.installMaximizeHandler(),this.installMinimizeHandler(),this.installCloseHandler(),this.setMinimizable(g),this.setTitle(a),(null==k||k)&&this.installMoveHandler(),null!=l&&null!=l.parentNode?l.parentNode.replaceChild(this.div,l):document.body.appendChild(this.div))}mxWindow.prototype=new mxEventSource;mxWindow.prototype.constructor=mxWindow;mxWindow.prototype.closeImage=mxClient.imageBasePath+"/close.gif";mxWindow.prototype.minimizeImage=mxClient.imageBasePath+"/minimize.gif";mxWindow.prototype.normalizeImage=mxClient.imageBasePath+"/normalize.gif";mxWindow.prototype.maximizeImage=mxClient.imageBasePath+"/maximize.gif";mxWindow.prototype.resizeImage=mxClient.imageBasePath+"/resize.gif";mxWindow.prototype.visible=!1;mxWindow.prototype.minimumSize=new mxRectangle(0,0,50,40);mxWindow.prototype.destroyOnClose=!0;mxWindow.prototype.contentHeightCorrection=8==document.documentMode||7==document.documentMode?6:2;mxWindow.prototype.title=null;mxWindow.prototype.content=null;mxWindow.prototype.init=function(a,b,c,d,e){e=null!=e?e:"mxWindow";this.div=document.createElement("div");this.div.className=e;this.div.style.left=a+"px";this.div.style.top=b+"px";this.table=document.createElement("table");this.table.className=e;mxClient.IS_POINTER&&(this.div.style.msTouchAction="none");null!=c&&(mxClient.IS_QUIRKS||(this.div.style.width=c+"px"),this.table.style.width=c+"px");null!=d&&(mxClient.IS_QUIRKS||(this.div.style.height=d+"px"),this.table.style.height=d+"px");a=document.createElement("tbody");b=document.createElement("tr");this.title=document.createElement("td");this.title.className=e+"Title";b.appendChild(this.title);a.appendChild(b);b=document.createElement("tr");this.td=document.createElement("td");this.td.className=e+"Pane";7==document.documentMode&&(this.td.style.height="100%");this.contentWrapper=document.createElement("div");this.contentWrapper.className=e+"Pane";this.contentWrapper.style.width="100%";this.contentWrapper.appendChild(this.content);if(mxClient.IS_QUIRKS||"DIV"!=this.content.nodeName.toUpperCase())this.contentWrapper.style.height="100%";this.td.appendChild(this.contentWrapper);b.appendChild(this.td);a.appendChild(b);this.table.appendChild(a);this.div.appendChild(this.table);e=mxUtils.bind(this,function(a){this.activate()});mxEvent.addGestureListeners(this.title,e);mxEvent.addGestureListeners(this.table,e);this.hide()};mxWindow.prototype.setTitle=function(a){for(var b=this.title.firstChild;null!=b;){var c=b.nextSibling;b.nodeType==mxConstants.NODETYPE_TEXT&&b.parentNode.removeChild(b);b=c}mxUtils.write(this.title,a||"")};mxWindow.prototype.setScrollable=function(a){0>navigator.userAgent.indexOf("Presto/2.5")&&(this.contentWrapper.style.overflow=a?"auto":"hidden")};mxWindow.prototype.activate=function(){if(mxWindow.activeWindow!=this){var a=mxUtils.getCurrentStyle(this.getElement()),a=null!=a?a.zIndex:3;if(mxWindow.activeWindow){var b=mxWindow.activeWindow.getElement();null!=b&&null!=b.style&&(b.style.zIndex=a)}b=mxWindow.activeWindow;this.getElement().style.zIndex=parseInt(a)+1;mxWindow.activeWindow=this;this.fireEvent(new mxEventObject(mxEvent.ACTIVATE,"previousWindow",b))}};mxWindow.prototype.getElement=function(){return this.div};mxWindow.prototype.fit=function(){mxUtils.fit(this.div)};mxWindow.prototype.isResizable=function(){return null!=this.resize?"none"!=this.resize.style.display:!1};mxWindow.prototype.setResizable=function(a){if(a)if(null==this.resize){this.resize=document.createElement("img");this.resize.style.position="absolute";this.resize.style.bottom="2px";this.resize.style.right="2px";this.resize.setAttribute("src",mxClient.imageBasePath+"/resize.gif");this.resize.style.cursor="nw-resize";var b=null,c=null,d=null,e=null;a=mxUtils.bind(this,function(a){this.activate();b=mxEvent.getClientX(a);c=mxEvent.getClientY(a);d=this.div.offsetWidth;e=this.div.offsetHeight;mxEvent.addGestureListeners(document,null,f,g);this.fireEvent(new mxEventObject(mxEvent.RESIZE_START,"event",a));mxEvent.consume(a)});var f=mxUtils.bind(this,function(a){if(null!=b&&null!=c){var f=mxEvent.getClientX(a)-b,g=mxEvent.getClientY(a)-c;this.setSize(d+f,e+g);this.fireEvent(new mxEventObject(mxEvent.RESIZE,"event",a));mxEvent.consume(a)}}),g=mxUtils.bind(this,function(a){null!=b&&null!=c&&(c=b=null,mxEvent.removeGestureListeners(document,null,f,g),this.fireEvent(new mxEventObject(mxEvent.RESIZE_END,"event",a)),mxEvent.consume(a))});mxEvent.addGestureListeners(this.resize,a,f,g);this.div.appendChild(this.resize)}else this.resize.style.display="inline";else null!=this.resize&&(this.resize.style.display="none")};mxWindow.prototype.setSize=function(a,b){a=Math.max(this.minimumSize.width,a);b=Math.max(this.minimumSize.height,b);mxClient.IS_QUIRKS||(this.div.style.width=a+"px",this.div.style.height=b+"px");this.table.style.width=a+"px";this.table.style.height=b+"px";mxClient.IS_QUIRKS||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")};mxWindow.prototype.setMinimizable=function(a){this.minimize.style.display=a?"":"none"};mxWindow.prototype.getMinimumSize=function(){return new mxRectangle(0,0,0,this.title.offsetHeight)};mxWindow.prototype.installMinimizeHandler=function(){this.minimize=document.createElement("img");this.minimize.setAttribute("src",this.minimizeImage);this.minimize.setAttribute("align","right");this.minimize.setAttribute("title","Minimize");this.minimize.style.cursor="pointer";this.minimize.style.marginRight="1px";this.minimize.style.display="none";this.title.appendChild(this.minimize);var a=!1,b=null,c=null,d=mxUtils.bind(this,function(d){this.activate();if(a)a=!1,this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.contentWrapper.style.display="",this.maximize.style.display=b,mxClient.IS_QUIRKS||(this.div.style.height=c),this.table.style.height=c,null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",d));else{a=!0;this.minimize.setAttribute("src",this.normalizeImage);this.minimize.setAttribute("title","Normalize");this.contentWrapper.style.display="none";b=this.maximize.style.display;this.maximize.style.display="none";c=this.table.style.height;var f=this.getMinimumSize();0<f.height&&(mxClient.IS_QUIRKS||(this.div.style.height=f.height+"px"),this.table.style.height=f.height+"px");0<f.width&&(mxClient.IS_QUIRKS||(this.div.style.width=f.width+"px"),this.table.style.width=f.width+"px");null!=this.resize&&(this.resize.style.visibility="hidden");this.fireEvent(new mxEventObject(mxEvent.MINIMIZE,"event",d))}mxEvent.consume(d)});mxEvent.addGestureListeners(this.minimize,d)};mxWindow.prototype.setMaximizable=function(a){this.maximize.style.display=a?"":"none"};mxWindow.prototype.installMaximizeHandler=function(){this.maximize=document.createElement("img");this.maximize.setAttribute("src",this.maximizeImage);this.maximize.setAttribute("align","right");this.maximize.setAttribute("title","Maximize");this.maximize.style.cursor="default";this.maximize.style.marginLeft="1px";this.maximize.style.cursor="pointer";this.maximize.style.display="none";this.title.appendChild(this.maximize);var a=!1,b=null,c=null,d=null,e=null,f=mxUtils.bind(this,function(f){this.activate();if("none"!=this.maximize.style.display){if(a)a=!1,this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.contentWrapper.style.display="",this.minimize.style.visibility="",this.div.style.left=b+"px",this.div.style.top=c+"px",mxClient.IS_QUIRKS||(this.div.style.height=d,this.div.style.width=e,k=mxUtils.getCurrentStyle(this.contentWrapper),"auto"!=k.overflow&&null==this.resize)||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-
this.contentHeightCorrection+"px"),this.table.style.height=d,this.table.style.width=e,null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",f));else{a=!0;this.maximize.setAttribute("src",this.normalizeImage);this.maximize.setAttribute("title","Normalize");this.contentWrapper.style.display="";this.minimize.style.visibility="hidden";b=parseInt(this.div.style.left);c=parseInt(this.div.style.top);d=this.table.style.height;e=this.table.style.width;this.div.style.left="0px";this.div.style.top="0px";k=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight||0);mxClient.IS_QUIRKS||(this.div.style.width=document.body.clientWidth-2+"px",this.div.style.height=k-2+"px");this.table.style.width=document.body.clientWidth-2+"px";this.table.style.height=k-2+"px";null!=this.resize&&(this.resize.style.visibility="hidden");if(!mxClient.IS_QUIRKS){var k=mxUtils.getCurrentStyle(this.contentWrapper);if("auto"==k.overflow||null!=this.resize)this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px"}this.fireEvent(new mxEventObject(mxEvent.MAXIMIZE,"event",f))}mxEvent.consume(f)}});mxEvent.addGestureListeners(this.maximize,f);mxEvent.addListener(this.title,"dblclick",f)};mxWindow.prototype.installMoveHandler=function(){this.title.style.cursor="move";mxEvent.addGestureListeners(this.title,mxUtils.bind(this,function(a){var b=mxEvent.getClientX(a),c=mxEvent.getClientY(a),d=this.getX(),e=this.getY(),f=mxUtils.bind(this,function(a){var f=mxEvent.getClientX(a)-b,g=mxEvent.getClientY(a)-c;this.setLocation(d+f,e+g);this.fireEvent(new mxEventObject(mxEvent.MOVE,"event",a));mxEvent.consume(a)}),g=mxUtils.bind(this,function(a){mxEvent.removeGestureListeners(document,null,f,g);this.fireEvent(new mxEventObject(mxEvent.MOVE_END,"event",a));mxEvent.consume(a)});mxEvent.addGestureListeners(document,null,f,g);this.fireEvent(new mxEventObject(mxEvent.MOVE_START,"event",a));mxEvent.consume(a)}));mxClient.IS_POINTER&&(this.title.style.msTouchAction="none")};mxWindow.prototype.setLocation=function(a,b){this.div.style.left=a+"px";this.div.style.top=b+"px"};mxWindow.prototype.getX=function(){return parseInt(this.div.style.left)};mxWindow.prototype.getY=function(){return parseInt(this.div.style.top)};mxWindow.prototype.installCloseHandler=function(){this.closeImg=document.createElement("img");this.closeImg.setAttribute("src",this.closeImage);this.closeImg.setAttribute("align","right");this.closeImg.setAttribute("title","Close");this.closeImg.style.marginLeft="2px";this.closeImg.style.cursor="pointer";this.closeImg.style.display="none";this.title.insertBefore(this.closeImg,this.title.firstChild);mxEvent.addGestureListeners(this.closeImg,mxUtils.bind(this,function(a){this.fireEvent(new mxEventObject(mxEvent.CLOSE,"event",a));this.destroyOnClose?this.destroy():this.setVisible(!1);mxEvent.consume(a)}))};mxWindow.prototype.setImage=function(a){this.image=document.createElement("img");this.image.setAttribute("src",a);this.image.setAttribute("align","left");this.image.style.marginRight="4px";this.image.style.marginLeft="0px";this.image.style.marginTop="-2px";this.title.insertBefore(this.image,this.title.firstChild)};mxWindow.prototype.setClosable=function(a){this.closeImg.style.display=a?"":"none"};mxWindow.prototype.isVisible=function(){return null!=this.div?"none"!=this.div.style.display:!1};mxWindow.prototype.setVisible=function(a){null!=this.div&&this.isVisible()!=a&&(a?this.show():this.hide())};mxWindow.prototype.show=function(){this.div.style.display="";this.activate();var a=mxUtils.getCurrentStyle(this.contentWrapper);mxClient.IS_QUIRKS||"auto"!=a.overflow&&null==this.resize||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px");this.fireEvent(new mxEventObject(mxEvent.SHOW))};mxWindow.prototype.hide=function(){this.div.style.display="none";this.fireEvent(new mxEventObject(mxEvent.HIDE))};mxWindow.prototype.destroy=function(){this.fireEvent(new mxEventObject(mxEvent.DESTROY));null!=this.div&&(mxEvent.release(this.div),this.div.parentNode.removeChild(this.div),this.div=null);this.contentWrapper=this.content=this.title=null};function mxForm(a){this.table=document.createElement("table");this.table.className=a;this.body=document.createElement("tbody");this.table.appendChild(this.body)}mxForm.prototype.table=null;mxForm.prototype.body=!1;mxForm.prototype.getTable=function(){return this.table};mxForm.prototype.addButtons=function(a,b){var c=document.createElement("tr"),d=document.createElement("td");c.appendChild(d);var d=document.createElement("td"),e=document.createElement("button");mxUtils.write(e,mxResources.get("ok")||"OK");d.appendChild(e);mxEvent.addListener(e,"click",function(){a()});e=document.createElement("button");mxUtils.write(e,mxResources.get("cancel")||"Cancel");d.appendChild(e);mxEvent.addListener(e,"click",function(){b()});c.appendChild(d);this.body.appendChild(c)};mxForm.prototype.addText=function(a,b){var c=document.createElement("input");c.setAttribute("type","text");c.value=b;return this.addField(a,c)};mxForm.prototype.addCheckbox=function(a,b){var c=document.createElement("input");c.setAttribute("type","checkbox");this.addField(a,c);b&&(c.checked=!0);return c};mxForm.prototype.addTextarea=function(a,b,c){var d=document.createElement("textarea");mxClient.IS_NS&&c--;d.setAttribute("rows",c||2);d.value=b;return this.addField(a,d)};mxForm.prototype.addCombo=function(a,b,c){var d=document.createElement("select");null!=c&&d.setAttribute("size",c);b&&d.setAttribute("multiple","true");return this.addField(a,d)};mxForm.prototype.addOption=function(a,b,c,d){var e=document.createElement("option");mxUtils.writeln(e,b);e.setAttribute("value",c);d&&e.setAttribute("selected",d);a.appendChild(e)};mxForm.prototype.addField=function(a,b){var c=document.createElement("tr"),d=document.createElement("td");mxUtils.write(d,a);c.appendChild(d);d=document.createElement("td");d.appendChild(b);c.appendChild(d);this.body.appendChild(c);return b};function mxImage(a,b,c){this.src=a;this.width=b;this.height=c}mxImage.prototype.src=null;mxImage.prototype.width=null;mxImage.prototype.height=null;function mxDivResizer(a,b){if("div"==a.nodeName.toLowerCase()){null==b&&(b=window);this.div=a;var c=mxUtils.getCurrentStyle(a);null!=c&&(this.resizeWidth="auto"==c.width,this.resizeHeight="auto"==c.height);mxEvent.addListener(b,"resize",mxUtils.bind(this,function(a){this.handlingResize||(this.handlingResize=!0,this.resize(),this.handlingResize=!1)}));this.resize()}}mxDivResizer.prototype.resizeWidth=!0;mxDivResizer.prototype.resizeHeight=!0;mxDivResizer.prototype.handlingResize=!1;mxDivResizer.prototype.resize=function(){var a=this.getDocumentWidth(),b=this.getDocumentHeight(),c=parseInt(this.div.style.left),d=parseInt(this.div.style.right),e=parseInt(this.div.style.top),f=parseInt(this.div.style.bottom);this.resizeWidth&&!isNaN(c)&&!isNaN(d)&&0<=c&&0<=d&&0<a-d-c&&(this.div.style.width=a-d-c+"px");this.resizeHeight&&!isNaN(e)&&!isNaN(f)&&0<=e&&0<=f&&0<b-e-f&&(this.div.style.height=b-e-f+"px")};mxDivResizer.prototype.getDocumentWidth=function(){return document.body.clientWidth};mxDivResizer.prototype.getDocumentHeight=function(){return document.body.clientHeight};function mxDragSource(a,b){this.element=a;this.dropHandler=b;mxEvent.addGestureListeners(a,mxUtils.bind(this,function(a){this.mouseDown(a)}));this.eventConsumer=function(a,b){var e=b.getProperty("eventName"),f=b.getProperty("event");e!=mxEvent.MOUSE_DOWN&&f.consume()}}mxDragSource.prototype.element=null;mxDragSource.prototype.dropHandler=null;mxDragSource.prototype.dragOffset=null;mxDragSource.prototype.dragElement=null;mxDragSource.prototype.previewElement=null;mxDragSource.prototype.enabled=!0;mxDragSource.prototype.currentGraph=null;mxDragSource.prototype.currentDropTarget=null;mxDragSource.prototype.currentPoint=null;mxDragSource.prototype.currentGuide=null;mxDragSource.prototype.currentHighlight=null;mxDragSource.prototype.autoscroll=!0;mxDragSource.prototype.guidesEnabled=!0;mxDragSource.prototype.gridEnabled=!0;mxDragSource.prototype.highlightDropTargets=!0;mxDragSource.prototype.dragElementZIndex=100;mxDragSource.prototype.dragElementOpacity=70;mxDragSource.prototype.isEnabled=function(){return this.enabled};mxDragSource.prototype.setEnabled=function(a){this.enabled=a};mxDragSource.prototype.isGuidesEnabled=function(){return this.guidesEnabled};mxDragSource.prototype.setGuidesEnabled=function(a){this.guidesEnabled=a};mxDragSource.prototype.isGridEnabled=function(){return this.gridEnabled};mxDragSource.prototype.setGridEnabled=function(a){this.gridEnabled=a};mxDragSource.prototype.getGraphForEvent=function(a){return null};mxDragSource.prototype.getDropTarget=function(a,b,c,d){return a.getCellAt(b,c)};mxDragSource.prototype.createDragElement=function(a){return this.element.cloneNode(!0)};mxDragSource.prototype.createPreviewElement=function(a){return null};mxDragSource.prototype.isActive=function(){return null!=this.mouseMoveHandler};mxDragSource.prototype.reset=function(){null!=this.currentGraph&&(this.dragExit(this.currentGraph),this.currentGraph=null);this.removeDragElement();this.removeListeners();this.stopDrag()};mxDragSource.prototype.mouseDown=function(a){this.enabled&&!mxEvent.isConsumed(a)&&null==this.mouseMoveHandler&&(this.startDrag(a),this.mouseMoveHandler=mxUtils.bind(this,this.mouseMove),this.mouseUpHandler=mxUtils.bind(this,this.mouseUp),mxEvent.addGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),mxClient.IS_TOUCH&&!mxEvent.isMouseEvent(a)&&(this.eventSource=mxEvent.getSource(a),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler)),mxEvent.consume(a,!0,!1))};mxDragSource.prototype.startDrag=function(a){this.dragElement=this.createDragElement(a);this.dragElement.style.position="absolute";this.dragElement.style.zIndex=this.dragElementZIndex;mxUtils.setOpacity(this.dragElement,this.dragElementOpacity)};mxDragSource.prototype.stopDrag=function(){this.removeDragElement()};mxDragSource.prototype.removeDragElement=function(){null!=this.dragElement&&(null!=this.dragElement.parentNode&&this.dragElement.parentNode.removeChild(this.dragElement),this.dragElement=null)};mxDragSource.prototype.graphContainsEvent=function(a,b){var c=mxEvent.getClientX(b),d=mxEvent.getClientY(b),e=mxUtils.getOffset(a.container),f=mxUtils.getScrollOrigin();return c>=e.x-f.x&&d>=e.y-f.y&&c<=e.x-f.x+a.container.offsetWidth&&d<=e.y-f.y+a.container.offsetHeight};mxDragSource.prototype.mouseMove=function(a){var b=this.getGraphForEvent(a);null!=b&&!this.graphContainsEvent(b,a)&&(b=null);b!=this.currentGraph&&(null!=this.currentGraph&&this.dragExit(this.currentGraph,a),this.currentGraph=b,null!=this.currentGraph&&this.dragEnter(this.currentGraph,a));null!=this.currentGraph&&this.dragOver(this.currentGraph,a);if(null==this.dragElement||null!=this.previewElement&&"visible"==this.previewElement.style.visibility)null!=this.dragElement&&(this.dragElement.style.visibility="hidden");else{var b=mxEvent.getClientX(a),c=mxEvent.getClientY(a);null==this.dragElement.parentNode&&document.body.appendChild(this.dragElement);this.dragElement.style.visibility="visible";null!=this.dragOffset&&(b+=this.dragOffset.x,c+=this.dragOffset.y);var d=mxUtils.getDocumentScrollOrigin(document);this.dragElement.style.left=b+d.x+"px";this.dragElement.style.top=c+d.y+"px"}mxEvent.consume(a)};mxDragSource.prototype.mouseUp=function(a){if(null!=this.currentGraph){if(null!=this.currentPoint&&(null==this.previewElement||"hidden"!=this.previewElement.style.visibility)){var b=this.currentGraph.view.scale,c=this.currentGraph.view.translate;this.drop(this.currentGraph,a,this.currentDropTarget,this.currentPoint.x/b-c.x,this.currentPoint.y/b-c.y)}this.dragExit(this.currentGraph);this.currentGraph=null}this.stopDrag();this.removeListeners();mxEvent.consume(a)};mxDragSource.prototype.removeListeners=function(){null!=this.eventSource&&(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler),this.eventSource=null);mxEvent.removeGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler);this.mouseUpHandler=this.mouseMoveHandler=null};mxDragSource.prototype.dragEnter=function(a,b){a.isMouseDown=!0;a.isMouseTrigger=mxEvent.isMouseEvent(b);this.previewElement=this.createPreviewElement(a);this.isGuidesEnabled()&&null!=this.previewElement&&(this.currentGuide=new mxGuide(a,a.graphHandler.getGuideStates()));this.highlightDropTargets&&(this.currentHighlight=new mxCellHighlight(a,mxConstants.DROP_TARGET_COLOR));a.addListener(mxEvent.FIRE_MOUSE_EVENT,this.eventConsumer)};mxDragSource.prototype.dragExit=function(a,b){this.currentPoint=this.currentDropTarget=null;a.isMouseDown=!1;a.removeListener(this.eventConsumer);null!=this.previewElement&&(null!=this.previewElement.parentNode&&this.previewElement.parentNode.removeChild(this.previewElement),this.previewElement=null);null!=this.currentGuide&&(this.currentGuide.destroy(),this.currentGuide=null);null!=this.currentHighlight&&(this.currentHighlight.destroy(),this.currentHighlight=null)};mxDragSource.prototype.dragOver=function(a,b){var c=mxUtils.getOffset(a.container),d=mxUtils.getScrollOrigin(a.container),e=mxEvent.getClientX(b)-c.x+d.x,c=mxEvent.getClientY(b)-c.y+d.y;a.autoScroll&&(null==this.autoscroll||this.autoscroll)&&a.scrollPointToVisible(e,c,a.autoExtend);null!=this.currentHighlight&&a.isDropEnabled()&&(this.currentDropTarget=this.getDropTarget(a,e,c,b),d=a.getView().getState(this.currentDropTarget),this.currentHighlight.highlight(d));if(null!=this.previewElement){null==this.previewElement.parentNode&&(a.container.appendChild(this.previewElement),this.previewElement.style.zIndex="3",this.previewElement.style.position="absolute");var d=this.isGridEnabled()&&a.isGridEnabledEvent(b),f=!0;if(null!=this.currentGuide&&this.currentGuide.isEnabledForEvent(b))var f=parseInt(this.previewElement.style.width),g=parseInt(this.previewElement.style.height),f=new mxRectangle(0,0,f,g),c=new mxPoint(e,c),c=this.currentGuide.move(f,c,d),f=!1,e=c.x,c=c.y;else if(d)var d=a.view.scale,g=a.view.translate,k=a.gridSize/2,e=(a.snap(e/d-g.x-k)+g.x)*d,c=(a.snap(c/d-g.y-k)+g.y)*d;null!=this.currentGuide&&f&&this.currentGuide.hide();null!=this.previewOffset&&(e+=this.previewOffset.x,c+=this.previewOffset.y);this.previewElement.style.left=Math.round(e)+"px";this.previewElement.style.top=Math.round(c)+"px";this.previewElement.style.visibility="visible"}this.currentPoint=new mxPoint(e,c)};mxDragSource.prototype.drop=function(a,b,c,d,e){this.dropHandler(a,b,c,d,e);"hidden"!=a.container.style.visibility&&a.container.focus()};function mxToolbar(a){this.container=a}mxToolbar.prototype=new mxEventSource;mxToolbar.prototype.constructor=mxToolbar;mxToolbar.prototype.container=null;mxToolbar.prototype.enabled=!0;mxToolbar.prototype.noReset=!1;mxToolbar.prototype.updateDefaultMode=!0;mxToolbar.prototype.addItem=function(a,b,c,d,e,f){var g=document.createElement(null!=b?"img":"button"),k=e||(null!=f?"mxToolbarMode":"mxToolbarItem");g.className=k;g.setAttribute("src",b);null!=a&&(null!=b?g.setAttribute("title",a):mxUtils.write(g,a));this.container.appendChild(g);null!=c&&(mxEvent.addListener(g,"click",c),mxClient.IS_TOUCH&&mxEvent.addListener(g,"touchend",c));a=mxUtils.bind(this,function(a){null!=d?g.setAttribute("src",b):g.style.backgroundColor=""});mxEvent.addGestureListeners(g,mxUtils.bind(this,function(a){null!=d?g.setAttribute("src",d):g.style.backgroundColor="gray";if(null!=f){null==this.menu&&(this.menu=new mxPopupMenu,this.menu.init());var b=this.currentImg;this.menu.isMenuShowing()&&this.menu.hideMenu();b!=g&&(this.currentImg=g,this.menu.factoryMethod=f,b=new mxPoint(g.offsetLeft,g.offsetTop+g.offsetHeight),this.menu.popup(b.x,b.y,null,a),this.menu.isMenuShowing()&&(g.className=k+"Selected",this.menu.hideMenu=function(){mxPopupMenu.prototype.hideMenu.apply(this);g.className=k;this.currentImg=null}))}}),null,a);mxEvent.addListener(g,"mouseout",a);return g};mxToolbar.prototype.addCombo=function(a){var b=document.createElement("div");b.style.display="inline";b.className="mxToolbarComboContainer";var c=document.createElement("select");c.className=a||"mxToolbarCombo";b.appendChild(c);this.container.appendChild(b);return c};mxToolbar.prototype.addActionCombo=function(a,b){var c=document.createElement("select");c.className=b||"mxToolbarCombo";this.addOption(c,a,null);mxEvent.addListener(c,"change",function(a){var b=c.options[c.selectedIndex];c.selectedIndex=0;null!=b.funct&&b.funct(a)});this.container.appendChild(c);return c};mxToolbar.prototype.addOption=function(a,b,c){var d=document.createElement("option");mxUtils.writeln(d,b);"function"==typeof c?d.funct=c:d.setAttribute("value",c);a.appendChild(d);return d};mxToolbar.prototype.addSwitchMode=function(a,b,c,d,e){var f=document.createElement("img");f.initialClassName=e||"mxToolbarMode";f.className=f.initialClassName;f.setAttribute("src",b);f.altIcon=d;null!=a&&f.setAttribute("title",a);mxEvent.addListener(f,"click",mxUtils.bind(this,function(a){a=this.selectedMode.altIcon;null!=a?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",a)):this.selectedMode.className=this.selectedMode.initialClassName;this.updateDefaultMode&&(this.defaultMode=f);this.selectedMode=f;a=f.altIcon;null!=a?(f.altIcon=f.getAttribute("src"),f.setAttribute("src",a)):f.className=f.initialClassName+"Selected";this.fireEvent(new mxEventObject(mxEvent.SELECT));c()}));this.container.appendChild(f);null==this.defaultMode&&(this.defaultMode=f,this.selectMode(f),c());return f};mxToolbar.prototype.addMode=function(a,b,c,d,e,f){f=null!=f?f:!0;var g=document.createElement(null!=b?"img":"button");g.initialClassName=e||"mxToolbarMode";g.className=g.initialClassName;g.setAttribute("src",b);g.altIcon=d;null!=a&&g.setAttribute("title",a);this.enabled&&f&&(mxEvent.addListener(g,"click",mxUtils.bind(this,function(a){this.selectMode(g,c);this.noReset=!1})),mxEvent.addListener(g,"dblclick",mxUtils.bind(this,function(a){this.selectMode(g,c);this.noReset=!0})),null==this.defaultMode&&(this.defaultMode=g,this.defaultFunction=c,this.selectMode(g,c)));this.container.appendChild(g);return g};mxToolbar.prototype.selectMode=function(a,b){if(this.selectedMode!=a){if(null!=this.selectedMode){var c=this.selectedMode.altIcon;null!=c?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",c)):this.selectedMode.className=this.selectedMode.initialClassName}this.selectedMode=a;c=this.selectedMode.altIcon;null!=c?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",c)):this.selectedMode.className=this.selectedMode.initialClassName+"Selected";this.fireEvent(new mxEventObject(mxEvent.SELECT,"function",b))}};mxToolbar.prototype.resetMode=function(a){!a&&this.noReset||this.selectedMode==this.defaultMode||this.selectMode(this.defaultMode,this.defaultFunction)};mxToolbar.prototype.addSeparator=function(a){return this.addItem(null,a,null)};mxToolbar.prototype.addBreak=function(){mxUtils.br(this.container)};mxToolbar.prototype.addLine=function(){var a=document.createElement("hr");a.style.marginRight="6px";a.setAttribute("size","1");this.container.appendChild(a)};mxToolbar.prototype.destroy=function(){mxEvent.release(this.container);this.selectedMode=this.defaultFunction=this.defaultMode=this.container=null;null!=this.menu&&this.menu.destroy()};function mxUndoableEdit(a,b){this.source=a;this.changes=[];this.significant=null!=b?b:!0}mxUndoableEdit.prototype.source=null;mxUndoableEdit.prototype.changes=null;mxUndoableEdit.prototype.significant=null;mxUndoableEdit.prototype.undone=!1;mxUndoableEdit.prototype.redone=!1;mxUndoableEdit.prototype.isEmpty=function(){return 0==this.changes.length};mxUndoableEdit.prototype.isSignificant=function(){return this.significant};mxUndoableEdit.prototype.add=function(a){this.changes.push(a)};mxUndoableEdit.prototype.notify=function(){};mxUndoableEdit.prototype.die=function(){};mxUndoableEdit.prototype.undo=function(){if(!this.undone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var a=this.changes.length-1;0<=a;a--){var b=this.changes[a];null!=b.execute?b.execute():null!=b.undo&&b.undo();this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",b))}this.undone=!0;this.redone=!1;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};mxUndoableEdit.prototype.redo=function(){if(!this.redone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var a=this.changes.length,b=0;b<a;b++){var c=this.changes[b];null!=c.execute?c.execute():null!=c.redo&&c.redo();this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",c))}this.undone=!1;this.redone=!0;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};function mxUndoManager(a){this.size=null!=a?a:100;this.clear()}mxUndoManager.prototype=new mxEventSource;mxUndoManager.prototype.constructor=mxUndoManager;mxUndoManager.prototype.size=null;mxUndoManager.prototype.history=null;mxUndoManager.prototype.indexOfNextAdd=0;mxUndoManager.prototype.isEmpty=function(){return 0==this.history.length};mxUndoManager.prototype.clear=function(){this.history=[];this.indexOfNextAdd=0;this.fireEvent(new mxEventObject(mxEvent.CLEAR))};mxUndoManager.prototype.canUndo=function(){return 0<this.indexOfNextAdd};mxUndoManager.prototype.undo=function(){for(;0<this.indexOfNextAdd;){var a=this.history[--this.indexOfNextAdd];a.undo();if(a.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",a));break}}};mxUndoManager.prototype.canRedo=function(){return this.indexOfNextAdd<this.history.length};mxUndoManager.prototype.redo=function(){for(var a=this.history.length;this.indexOfNextAdd<a;){var b=this.history[this.indexOfNextAdd++];b.redo();if(b.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.REDO,"edit",b));break}}};mxUndoManager.prototype.undoableEditHappened=function(a){this.trim();0<this.size&&this.size==this.history.length&&this.history.shift();this.history.push(a);this.indexOfNextAdd=this.history.length;this.fireEvent(new mxEventObject(mxEvent.ADD,"edit",a))};mxUndoManager.prototype.trim=function(){if(this.history.length>this.indexOfNextAdd)for(var a=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd),b=0;b<a.length;b++)a[b].die()};var mxUrlConverter=function(){};mxUrlConverter.prototype.enabled=!0;mxUrlConverter.prototype.baseUrl=null;mxUrlConverter.prototype.baseDomain=null;mxUrlConverter.prototype.updateBaseUrl=function(){this.baseDomain=location.protocol+"//"+location.host;this.baseUrl=this.baseDomain+location.pathname;var a=this.baseUrl.lastIndexOf("/");0<a&&(this.baseUrl=this.baseUrl.substring(0,a+1))};mxUrlConverter.prototype.isEnabled=function(){return this.enabled};mxUrlConverter.prototype.setEnabled=function(a){this.enabled=a};mxUrlConverter.prototype.getBaseUrl=function(){return this.baseUrl};mxUrlConverter.prototype.setBaseUrl=function(a){this.baseUrl=a};mxUrlConverter.prototype.getBaseDomain=function(){return this.baseDomain};mxUrlConverter.prototype.setBaseDomain=function(a){this.baseDomain=a};mxUrlConverter.prototype.isRelativeUrl=function(a){return"//"!=a.substring(0,2)&&"http://"!=a.substring(0,7)&&"https://"!=a.substring(0,8)&&"data:image"!=a.substring(0,10)};mxUrlConverter.prototype.convert=function(a){this.isEnabled()&&this.isRelativeUrl(a)&&(null==this.getBaseUrl()&&this.updateBaseUrl(),a="/"==a.charAt(0)?this.getBaseDomain()+a:this.getBaseUrl()+a);return a};function mxPanningManager(a){this.thread=null;this.active=!1;this.dy=this.dx=this.t0y=this.t0x=this.tdy=this.tdx=0;this.scrollbars=!1;this.scrollTop=this.scrollLeft=0;this.mouseListener={mouseDown:function(a,b){},mouseMove:function(a,b){},mouseUp:mxUtils.bind(this,function(a,b){this.active&&this.stop()})};a.addMouseListener(this.mouseListener);mxEvent.addListener(document,"mouseup",mxUtils.bind(this,function(){this.active&&this.stop()}));var b=mxUtils.bind(this,function(){this.scrollbars=mxUtils.hasScrollbars(a.container);this.scrollLeft=a.container.scrollLeft;this.scrollTop=a.container.scrollTop;return window.setInterval(mxUtils.bind(this,function(){this.tdx-=this.dx;this.tdy-=this.dy;if(this.scrollbars){var b=-a.container.scrollLeft-Math.ceil(this.dx),d=-a.container.scrollTop-Math.ceil(this.dy);a.panGraph(b,d);a.panDx=this.scrollLeft-a.container.scrollLeft;a.panDy=this.scrollTop-a.container.scrollTop;a.fireEvent(new mxEventObject(mxEvent.PAN))}else a.panGraph(this.getDx(),this.getDy())}),this.delay)});this.isActive=function(){return active};this.getDx=function(){return Math.round(this.tdx)};this.getDy=function(){return Math.round(this.tdy)};this.start=function(){this.t0x=a.view.translate.x;this.t0y=a.view.translate.y;this.active=!0};this.panTo=function(c,d,e,f){this.active||this.start();this.scrollLeft=a.container.scrollLeft;this.scrollTop=a.container.scrollTop;f=null!=f?f:0;var g=a.container;this.dx=c+(null!=e?e:0)-g.scrollLeft-g.clientWidth;0>this.dx&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:this.dx=this.handleMouseOut?Math.max(this.dx,0):0;0==this.dx&&(this.dx=c-g.scrollLeft,this.dx=0<this.dx&&this.dx<this.border?this.dx-this.border:this.handleMouseOut?Math.min(0,this.dx):0);this.dy=d+f-g.scrollTop-g.clientHeight;0>this.dy&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.dy=this.handleMouseOut?Math.max(this.dy,0):0;0==this.dy&&(this.dy=d-g.scrollTop,this.dy=0<this.dy&&this.dy<this.border?this.dy-this.border:this.handleMouseOut?Math.min(0,this.dy):0);0!=this.dx||0!=this.dy?(this.dx*=this.damper,this.dy*=this.damper,null==this.thread&&(this.thread=b())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)};this.stop=function(){if(this.active)if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdy=this.tdx=0,this.scrollbars)a.panDx=0,a.panDy=0,a.fireEvent(new mxEventObject(mxEvent.PAN));else{var b=a.panDx,d=a.panDy;if(0!=b||0!=d)a.panGraph(0,0),a.view.setTranslate(this.t0x+b/a.view.scale,this.t0y+d/a.view.scale)}};this.destroy=function(){a.removeMouseListener(this.mouseListener)}}mxPanningManager.prototype.damper=1/6;mxPanningManager.prototype.delay=10;mxPanningManager.prototype.handleMouseOut=!0;mxPanningManager.prototype.border=0;function mxPopupMenu(a){this.factoryMethod=a;null!=a&&this.init()}mxPopupMenu.prototype=new mxEventSource;mxPopupMenu.prototype.constructor=mxPopupMenu;mxPopupMenu.prototype.submenuImage=mxClient.imageBasePath+"/submenu.gif";mxPopupMenu.prototype.zIndex=10006;mxPopupMenu.prototype.factoryMethod=null;mxPopupMenu.prototype.useLeftButtonForPopup=!1;mxPopupMenu.prototype.enabled=!0;mxPopupMenu.prototype.itemCount=0;mxPopupMenu.prototype.autoExpand=!1;mxPopupMenu.prototype.smartSeparators=!1;mxPopupMenu.prototype.labels=!0;mxPopupMenu.prototype.init=function(){this.table=document.createElement("table");this.table.className="mxPopupMenu";this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.div=document.createElement("div");this.div.className="mxPopupMenu";this.div.style.display="inline";this.div.style.zIndex=this.zIndex;this.div.appendChild(this.table);mxEvent.disableContextMenu(this.div)};mxPopupMenu.prototype.isEnabled=function(){return this.enabled};mxPopupMenu.prototype.setEnabled=function(a){this.enabled=a};mxPopupMenu.prototype.isPopupTrigger=function(a){return a.isPopupTrigger()||this.useLeftButtonForPopup&&mxEvent.isLeftMouseButton(a.getEvent())};mxPopupMenu.prototype.addItem=function(a,b,c,d,e,f,g){d=d||this;this.itemCount++;d.willAddSeparator&&(d.containsItems&&this.addSeparator(d,!0),d.willAddSeparator=!1);d.containsItems=!0;var k=document.createElement("tr");k.className="mxPopupMenuItem";var l=document.createElement("td");l.className="mxPopupMenuIcon";null!=b?(e=document.createElement("img"),e.src=b,l.appendChild(e)):null!=e&&(b=document.createElement("div"),b.className=e,l.appendChild(b));k.appendChild(l);this.labels&&(l=document.createElement("td"),l.className="mxPopupMenuItem"+(null==f||f?"":" mxDisabled"),mxUtils.write(l,a),l.align="left",k.appendChild(l),a=document.createElement("td"),a.className="mxPopupMenuItem"+(null==f||f?"":" mxDisabled"),a.style.paddingRight="6px",a.style.textAlign="right",k.appendChild(a),null==d.div&&this.createSubmenu(d));d.tbody.appendChild(k);if(!1!=g&&!1!=f){var m=null;mxEvent.addGestureListeners(k,mxUtils.bind(this,function(a){this.eventReceiver=k;d.activeRow!=k&&d.activeRow!=d&&(null!=d.activeRow&&null!=d.activeRow.div.parentNode&&this.hideSubmenu(d),null!=k.div&&(this.showSubmenu(d,k),d.activeRow=k));if(mxClient.IS_QUIRKS||8==document.documentMode)m=document.selection.createRange();mxEvent.consume(a)}),mxUtils.bind(this,function(a){d.activeRow!=k&&d.activeRow!=d&&(null!=d.activeRow&&null!=d.activeRow.div.parentNode&&this.hideSubmenu(d),this.autoExpand&&null!=k.div&&(this.showSubmenu(d,k),d.activeRow=k));k.className="mxPopupMenuItemHover"}),mxUtils.bind(this,function(a){if(this.eventReceiver==k){d.activeRow!=k&&this.hideMenu();if(null!=m){try{m.select()}catch(b){}m=null}null!=c&&c(a)}this.eventReceiver=null;mxEvent.consume(a)}));mxEvent.addListener(k,"mouseout",mxUtils.bind(this,function(a){k.className="mxPopupMenuItem"}))}return k};mxPopupMenu.prototype.createSubmenu=function(a){a.table=document.createElement("table");a.table.className="mxPopupMenu";a.tbody=document.createElement("tbody");a.table.appendChild(a.tbody);a.div=document.createElement("div");a.div.className="mxPopupMenu";a.div.style.position="absolute";a.div.style.display="inline";a.div.style.zIndex=this.zIndex;a.div.appendChild(a.table);var b=document.createElement("img");b.setAttribute("src",this.submenuImage);td=a.firstChild.nextSibling.nextSibling;td.appendChild(b)};mxPopupMenu.prototype.showSubmenu=function(a,b){if(null!=b.div){b.div.style.left=a.div.offsetLeft+b.offsetLeft+b.offsetWidth-1+"px";b.div.style.top=a.div.offsetTop+b.offsetTop+"px";document.body.appendChild(b.div);var c=parseInt(b.div.offsetLeft),d=parseInt(b.div.offsetWidth),e=mxUtils.getDocumentScrollOrigin(document),f=document.documentElement;c+d>e.x+(document.body.clientWidth||f.clientWidth)&&(b.div.style.left=a.div.offsetLeft-d+(mxClient.IS_IE?6:-6)+"px");mxUtils.fit(b.div)}};mxPopupMenu.prototype.addSeparator=function(a,b){a=a||this;if(this.smartSeparators&&!b)a.willAddSeparator=!0;else if(null!=a.tbody){a.willAddSeparator=!1;var c=document.createElement("tr"),d=document.createElement("td");d.className="mxPopupMenuIcon";d.style.padding="0 0 0 0px";c.appendChild(d);d=document.createElement("td");d.style.padding="0 0 0 0px";d.setAttribute("colSpan","2");var e=document.createElement("hr");e.setAttribute("size","1");d.appendChild(e);c.appendChild(d);a.tbody.appendChild(c)}};mxPopupMenu.prototype.popup=function(a,b,c,d){if(null!=this.div&&null!=this.tbody&&null!=this.factoryMethod){this.div.style.left=a+"px";for(this.div.style.top=b+"px";null!=this.tbody.firstChild;)mxEvent.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0;this.factoryMethod(this,c,d);0<this.itemCount&&(this.showMenu(),this.fireEvent(new mxEventObject(mxEvent.SHOW)))}};mxPopupMenu.prototype.isMenuShowing=function(){return null!=this.div&&this.div.parentNode==document.body};mxPopupMenu.prototype.showMenu=function(){9<=document.documentMode&&(this.div.style.filter="none");document.body.appendChild(this.div);mxUtils.fit(this.div)};mxPopupMenu.prototype.hideMenu=function(){null!=this.div&&(null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1,this.fireEvent(new mxEventObject(mxEvent.HIDE)))};mxPopupMenu.prototype.hideSubmenu=function(a){null!=a.activeRow&&(this.hideSubmenu(a.activeRow),null!=a.activeRow.div.parentNode&&a.activeRow.div.parentNode.removeChild(a.activeRow.div),a.activeRow=null)};mxPopupMenu.prototype.destroy=function(){null!=this.div&&(mxEvent.release(this.div),null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.div=null)};function mxAutoSaveManager(a){this.changeHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.graphModelChanged(c.getProperty("edit").changes)});this.setGraph(a)}mxAutoSaveManager.prototype=new mxEventSource;mxAutoSaveManager.prototype.constructor=mxAutoSaveManager;mxAutoSaveManager.prototype.graph=null;mxAutoSaveManager.prototype.autoSaveDelay=10;mxAutoSaveManager.prototype.autoSaveThrottle=2;mxAutoSaveManager.prototype.autoSaveThreshold=5;mxAutoSaveManager.prototype.ignoredChanges=0;mxAutoSaveManager.prototype.lastSnapshot=0;mxAutoSaveManager.prototype.enabled=!0;mxAutoSaveManager.prototype.changeHandler=null;mxAutoSaveManager.prototype.isEnabled=function(){return this.enabled};mxAutoSaveManager.prototype.setEnabled=function(a){this.enabled=a};mxAutoSaveManager.prototype.setGraph=function(a){null!=this.graph&&this.graph.getModel().removeListener(this.changeHandler);this.graph=a;null!=this.graph&&this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)};mxAutoSaveManager.prototype.save=function(){};mxAutoSaveManager.prototype.graphModelChanged=function(a){a=((new Date).getTime()-this.lastSnapshot)/1E3;a>this.autoSaveDelay||this.ignoredChanges>=this.autoSaveThreshold&&a>this.autoSaveThrottle?(this.save(),this.reset()):this.ignoredChanges++};mxAutoSaveManager.prototype.reset=function(){this.lastSnapshot=(new Date).getTime();this.ignoredChanges=0};mxAutoSaveManager.prototype.destroy=function(){this.setGraph(null)};
function mxAnimation(a){this.delay=null!=a?a:20}mxAnimation.prototype=new mxEventSource;mxAnimation.prototype.constructor=mxAnimation;mxAnimation.prototype.delay=null;mxAnimation.prototype.thread=null;mxAnimation.prototype.isRunning=function(){return null!=this.thread};mxAnimation.prototype.startAnimation=function(){null==this.thread&&(this.thread=window.setInterval(mxUtils.bind(this,this.updateAnimation),this.delay))};mxAnimation.prototype.updateAnimation=function(){this.fireEvent(new mxEventObject(mxEvent.EXECUTE))};mxAnimation.prototype.stopAnimation=function(){null!=this.thread&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new mxEventObject(mxEvent.DONE)))};function mxMorphing(a,b,c,d){mxAnimation.call(this,d);this.graph=a;this.steps=null!=b?b:6;this.ease=null!=c?c:1.5}mxMorphing.prototype=new mxAnimation;mxMorphing.prototype.constructor=mxMorphing;mxMorphing.prototype.graph=null;mxMorphing.prototype.steps=null;mxMorphing.prototype.step=0;mxMorphing.prototype.ease=null;mxMorphing.prototype.cells=null;mxMorphing.prototype.updateAnimation=function(){var a=new mxCellStatePreview(this.graph);if(null!=this.cells)for(var b=0;b<this.cells.length;b++)this.animateCell(this.cells[b],a,!1);else this.animateCell(this.graph.getModel().getRoot(),a,!0);this.show(a);(a.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()};mxMorphing.prototype.show=function(a){a.show()};mxMorphing.prototype.animateCell=function(a,b,c){var d=this.graph.getView().getState(a),e=null;if(null!=d&&(e=this.getDelta(d),this.graph.getModel().isVertex(a)&&(0!=e.x||0!=e.y))){var f=this.graph.view.getTranslate(),g=this.graph.view.getScale();e.x+=f.x*g;e.y+=f.y*g;b.moveState(d,-e.x/this.ease,-e.y/this.ease)}if(c&&!this.stopRecursion(d,e))for(d=this.graph.getModel().getChildCount(a),e=0;e<d;e++)this.animateCell(this.graph.getModel().getChildAt(a,e),b,c)};mxMorphing.prototype.stopRecursion=function(a,b){return null!=b&&(0!=b.x||0!=b.y)};mxMorphing.prototype.getDelta=function(a){var b=this.getOriginForCell(a.cell),c=this.graph.getView().getTranslate(),d=this.graph.getView().getScale();return new mxPoint((b.x-(a.x/d-c.x))*d,(b.y-(a.y/d-c.y))*d)};mxMorphing.prototype.getOriginForCell=function(a){var b=null;if(null!=a){var c=this.graph.getModel().getParent(a);a=this.graph.getCellGeometry(a);b=this.getOriginForCell(c);null!=a&&(a.relative?(c=this.graph.getCellGeometry(c),null!=c&&(b.x+=a.x*c.width,b.y+=a.y*c.height)):(b.x+=a.x,b.y+=a.y))}null==b&&(b=this.graph.view.getTranslate(),b=new mxPoint(-b.x,-b.y));return b};function mxImageBundle(a){this.images=[];this.alt=null!=a?a:!1}mxImageBundle.prototype.images=null;mxImageBundle.prototype.images=null;mxImageBundle.prototype.putImage=function(a,b,c){this.images[a]={value:b,fallback:c}};mxImageBundle.prototype.getImage=function(a){var b=null;null!=a&&(a=this.images[a],null!=a&&(b=this.alt?a.fallback:a.value));return b};function mxImageExport(){}mxImageExport.prototype.includeOverlays=!1;mxImageExport.prototype.drawState=function(a,b){null!=a&&(this.visitStatesRecursive(a,b,mxUtils.bind(this,function(){this.drawCellState.apply(this,arguments)})),this.includeOverlays&&this.visitStatesRecursive(a,b,mxUtils.bind(this,function(){this.drawOverlays.apply(this,arguments)})))};mxImageExport.prototype.visitStatesRecursive=function(a,b,c){if(null!=a){c(a,b);for(var d=a.view.graph,e=d.model.getChildCount(a.cell),f=0;f<e;f++){var g=d.view.getState(d.model.getChildAt(a.cell,f));this.visitStatesRecursive(g,b,c)}}};mxImageExport.prototype.getLinkForCellState=function(a,b){return null};mxImageExport.prototype.drawCellState=function(a,b){var c=this.getLinkForCellState(a,b);null!=c&&b.setLink(c);this.drawShape(a,b);this.drawText(a,b);null!=c&&b.setLink(null)};mxImageExport.prototype.drawShape=function(a,b){a.shape instanceof mxShape&&a.shape.checkBounds()&&(b.save(),a.shape.paint(b),b.restore())};mxImageExport.prototype.drawText=function(a,b){null!=a.text&&a.text.checkBounds()&&(b.save(),a.text.paint(b),b.restore())};mxImageExport.prototype.drawOverlays=function(a,b){null!=a.overlays&&a.overlays.visit(function(a,d){d instanceof mxShape&&d.paint(b)})};function mxAbstractCanvas2D(){this.converter=this.createUrlConverter();this.reset()}
mxAbstractCanvas2D.prototype.state=null;mxAbstractCanvas2D.prototype.states=null;mxAbstractCanvas2D.prototype.path=null;mxAbstractCanvas2D.prototype.rotateHtml=!0;mxAbstractCanvas2D.prototype.lastX=0;mxAbstractCanvas2D.prototype.lastY=0;mxAbstractCanvas2D.prototype.moveOp="M";mxAbstractCanvas2D.prototype.lineOp="L";mxAbstractCanvas2D.prototype.quadOp="Q";mxAbstractCanvas2D.prototype.curveOp="C";mxAbstractCanvas2D.prototype.closeOp="Z";mxAbstractCanvas2D.prototype.pointerEvents=!1;mxAbstractCanvas2D.prototype.createUrlConverter=function(){return new mxUrlConverter};mxAbstractCanvas2D.prototype.reset=function(){this.state=this.createState();this.states=[]};mxAbstractCanvas2D.prototype.createState=function(){return{dx:0,dy:0,scale:1,alpha:1,fillColor:null,fillAlpha:1,gradientColor:null,gradientAlpha:1,gradientDirection:null,strokeColor:null,strokeWidth:1,dashed:!1,dashPattern:"3 3",lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:null,fontBorderColor:null,fontSize:mxConstants.DEFAULT_FONTSIZE,fontFamily:mxConstants.DEFAULT_FONTFAMILY,fontStyle:0,shadow:!1,shadowColor:mxConstants.SHADOWCOLOR,shadowAlpha:mxConstants.SHADOW_OPACITY,shadowDx:mxConstants.SHADOW_OFFSET_X,shadowDy:mxConstants.SHADOW_OFFSET_Y,rotation:0,rotationCx:0,rotationCy:0}};mxAbstractCanvas2D.prototype.format=function(a){return Math.round(parseFloat(a))};mxAbstractCanvas2D.prototype.addOp=function(){if(null!=this.path&&(this.path.push(arguments[0]),2<arguments.length))for(var a=this.state,b=2;b<arguments.length;b+=2)this.lastX=arguments[b-1],this.lastY=arguments[b],this.path.push(this.format((this.lastX+a.dx)*a.scale)),this.path.push(this.format((this.lastY+a.dy)*a.scale))};mxAbstractCanvas2D.prototype.rotatePoint=function(a,b,c,d,e){c*=Math.PI/180;return mxUtils.getRotatedPoint(new mxPoint(a,b),Math.cos(c),Math.sin(c),new mxPoint(d,e))};mxAbstractCanvas2D.prototype.save=function(){this.states.push(this.state);this.state=mxUtils.clone(this.state)};mxAbstractCanvas2D.prototype.restore=function(){0<this.states.length&&(this.state=this.states.pop())};mxAbstractCanvas2D.prototype.setLink=function(a){};mxAbstractCanvas2D.prototype.scale=function(a){this.state.scale*=a;this.state.strokeWidth*=a};mxAbstractCanvas2D.prototype.translate=function(a,b){this.state.dx+=a;this.state.dy+=b};mxAbstractCanvas2D.prototype.setAlpha=function(a){this.state.alpha=a};mxAbstractCanvas2D.prototype.setFillColor=function(a){a==mxConstants.NONE&&(a=null);this.state.fillColor=a;this.state.gradientColor=null};mxAbstractCanvas2D.prototype.setGradient=function(a,b,c,d,e,f,g,k,l){c=this.state;c.fillColor=a;c.fillAlpha=null!=k?k:1;c.gradientColor=b;c.gradientAlpha=null!=l?l:1;c.gradientDirection=g};mxAbstractCanvas2D.prototype.setStrokeColor=function(a){a==mxConstants.NONE&&(a=null);this.state.strokeColor=a};mxAbstractCanvas2D.prototype.setStrokeWidth=function(a){this.state.strokeWidth=a};mxAbstractCanvas2D.prototype.setDashed=function(a){this.state.dashed=a};mxAbstractCanvas2D.prototype.setDashPattern=function(a){this.state.dashPattern=a};mxAbstractCanvas2D.prototype.setLineCap=function(a){this.state.lineCap=a};mxAbstractCanvas2D.prototype.setLineJoin=function(a){this.state.lineJoin=a};mxAbstractCanvas2D.prototype.setMiterLimit=function(a){this.state.miterLimit=a};mxAbstractCanvas2D.prototype.setFontColor=function(a){a==mxConstants.NONE&&(a=null);this.state.fontColor=a};mxAbstractCanvas2D.prototype.setFontBackgroundColor=function(a){a==mxConstants.NONE&&(a=null);this.state.fontBackgroundColor=a};mxAbstractCanvas2D.prototype.setFontBorderColor=function(a){a==mxConstants.NONE&&(a=null);this.state.fontBorderColor=a};mxAbstractCanvas2D.prototype.setFontSize=function(a){this.state.fontSize=a};mxAbstractCanvas2D.prototype.setFontFamily=function(a){this.state.fontFamily=a};mxAbstractCanvas2D.prototype.setFontStyle=function(a){null==a&&(a=0);this.state.fontStyle=a};mxAbstractCanvas2D.prototype.setShadow=function(a){this.state.shadow=a};mxAbstractCanvas2D.prototype.setShadowColor=function(a){a==mxConstants.NONE&&(a=null);this.state.shadowColor=a};mxAbstractCanvas2D.prototype.setShadowAlpha=function(a){this.state.shadowAlpha=a};mxAbstractCanvas2D.prototype.setShadowOffset=function(a,b){this.state.shadowDx=a;this.state.shadowDy=b};mxAbstractCanvas2D.prototype.begin=function(){this.lastY=this.lastX=0;this.path=[]};mxAbstractCanvas2D.prototype.moveTo=function(a,b){this.addOp(this.moveOp,a,b)};mxAbstractCanvas2D.prototype.lineTo=function(a,b){this.addOp(this.lineOp,a,b)};mxAbstractCanvas2D.prototype.quadTo=function(a,b,c,d){this.addOp(this.quadOp,a,b,c,d)};mxAbstractCanvas2D.prototype.curveTo=function(a,b,c,d,e,f){this.addOp(this.curveOp,a,b,c,d,e,f)};mxAbstractCanvas2D.prototype.arcTo=function(a,b,c,d,e,f,g){a=mxUtils.arcToCurves(this.lastX,this.lastY,a,b,c,d,e,f,g);if(null!=a)for(b=0;b<a.length;b+=6)this.curveTo(a[b],a[b+1],a[b+2],a[b+3],a[b+4],a[b+5])};mxAbstractCanvas2D.prototype.close=function(a,b,c,d,e,f){this.addOp(this.closeOp)};mxAbstractCanvas2D.prototype.end=function(){};function mxXmlCanvas2D(a){mxAbstractCanvas2D.call(this);this.root=a;this.writeDefaults()}mxUtils.extend(mxXmlCanvas2D,mxAbstractCanvas2D);mxXmlCanvas2D.prototype.textEnabled=!0;mxXmlCanvas2D.prototype.compressed=!0;mxXmlCanvas2D.prototype.writeDefaults=function(){var a;a=this.createElement("fontfamily");a.setAttribute("family",mxConstants.DEFAULT_FONTFAMILY);this.root.appendChild(a);a=this.createElement("fontsize");a.setAttribute("size",mxConstants.DEFAULT_FONTSIZE);this.root.appendChild(a);a=this.createElement("shadowcolor");a.setAttribute("color",mxConstants.SHADOWCOLOR);this.root.appendChild(a);a=this.createElement("shadowalpha");a.setAttribute("alpha",mxConstants.SHADOW_OPACITY);this.root.appendChild(a);a=this.createElement("shadowoffset");a.setAttribute("dx",mxConstants.SHADOW_OFFSET_X);a.setAttribute("dy",mxConstants.SHADOW_OFFSET_Y);this.root.appendChild(a)};mxXmlCanvas2D.prototype.format=function(a){return parseFloat(parseFloat(a).toFixed(2))};mxXmlCanvas2D.prototype.createElement=function(a){return this.root.ownerDocument.createElement(a)};mxXmlCanvas2D.prototype.save=function(){this.compressed&&mxAbstractCanvas2D.prototype.save.apply(this,arguments);this.root.appendChild(this.createElement("save"))};mxXmlCanvas2D.prototype.restore=function(){this.compressed&&mxAbstractCanvas2D.prototype.restore.apply(this,arguments);this.root.appendChild(this.createElement("restore"))};mxXmlCanvas2D.prototype.scale=function(a){if(this.compressed){if(this.state.scale==a)return;mxAbstractCanvas2D.prototype.setAlpha.apply(this,arguments)}var b=this.createElement("scale");b.setAttribute("scale",a);this.root.appendChild(b)};mxXmlCanvas2D.prototype.translate=function(a,b){var c=this.createElement("translate");c.setAttribute("dx",this.format(a));c.setAttribute("dy",this.format(b));this.root.appendChild(c)};mxXmlCanvas2D.prototype.rotate=function(a,b,c,d,e){var f=this.createElement("rotate");if(0!=a||b||c)f.setAttribute("theta",this.format(a)),f.setAttribute("flipH",b?"1":"0"),f.setAttribute("flipV",c?"1":"0"),f.setAttribute("cx",this.format(d)),f.setAttribute("cy",this.format(e)),this.root.appendChild(f)};mxXmlCanvas2D.prototype.setAlpha=function(a){if(this.compressed){if(this.state.alpha==a)return;mxAbstractCanvas2D.prototype.setAlpha.apply(this,arguments)}var b=this.createElement("alpha");b.setAttribute("alpha",this.format(a));this.root.appendChild(b)};mxXmlCanvas2D.prototype.setFillColor=function(a){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.fillColor==a)return;mxAbstractCanvas2D.prototype.setFillColor.apply(this,arguments)}var b=this.createElement("fillcolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)};mxXmlCanvas2D.prototype.setGradient=function(a,b,c,d,e,f,g,k,l){if(null!=a&&null!=b){mxAbstractCanvas2D.prototype.setGradient.apply(this,arguments);var m=this.createElement("gradient");m.setAttribute("c1",a);m.setAttribute("c2",b);m.setAttribute("x",this.format(c));m.setAttribute("y",this.format(d));m.setAttribute("w",this.format(e));m.setAttribute("h",this.format(f));null!=g&&m.setAttribute("direction",g);null!=k&&m.setAttribute("alpha1",k);null!=l&&m.setAttribute("alpha2",l);this.root.appendChild(m)}};mxXmlCanvas2D.prototype.setStrokeColor=function(a){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.strokeColor==a)return;mxAbstractCanvas2D.prototype.setStrokeColor.apply(this,arguments)}var b=this.createElement("strokecolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)};mxXmlCanvas2D.prototype.setStrokeWidth=function(a){if(this.compressed){if(this.state.strokeWidth==a)return;mxAbstractCanvas2D.prototype.setStrokeWidth.apply(this,arguments)}var b=this.createElement("strokewidth");b.setAttribute("width",this.format(a));this.root.appendChild(b)};mxXmlCanvas2D.prototype.setDashed=function(a){if(this.compressed){if(this.state.dashed==a)return;mxAbstractCanvas2D.prototype.setDashed.apply(this,arguments)}var b=this.createElement("dashed");b.setAttribute("dashed",a?"1":"0");this.root.appendChild(b)};mxXmlCanvas2D.prototype.setDashPattern=function(a){if(this.compressed){if(this.state.dashPattern==a)return;mxAbstractCanvas2D.prototype.setDashPattern.apply(this,arguments)}var b=this.createElement("dashpattern");b.setAttribute("pattern",a);this.root.appendChild(b)};mxXmlCanvas2D.prototype.setLineCap=function(a){if(this.compressed){if(this.state.lineCap==a)return;mxAbstractCanvas2D.prototype.setLineCap.apply(this,arguments)}var b=this.createElement("linecap");b.setAttribute("cap",a);this.root.appendChild(b)};mxXmlCanvas2D.prototype.setLineJoin=function(a){if(this.compressed){if(this.state.lineJoin==a)return;mxAbstractCanvas2D.prototype.setLineJoin.apply(this,arguments)}var b=this.createElement("linejoin");b.setAttribute("join",a);this.root.appendChild(b)};mxXmlCanvas2D.prototype.setMiterLimit=function(a){if(this.compressed){if(this.state.miterLimit==a)return;mxAbstractCanvas2D.prototype.setMiterLimit.apply(this,arguments)}var b=this.createElement("miterlimit");b.setAttribute("limit",a);this.root.appendChild(b)};mxXmlCanvas2D.prototype.setFontColor=function(a){if(this.textEnabled){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.fontColor==a)return;mxAbstractCanvas2D.prototype.setFontColor.apply(this,arguments)}var b=this.createElement("fontcolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)}};mxXmlCanvas2D.prototype.setFontBackgroundColor=function(a){if(this.textEnabled){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.fontBackgroundColor==a)return;mxAbstractCanvas2D.prototype.setFontBackgroundColor.apply(this,arguments)}var b=this.createElement("fontbackgroundcolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)}};mxXmlCanvas2D.prototype.setFontBorderColor=function(a){if(this.textEnabled){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.fontBorderColor==a)return;mxAbstractCanvas2D.prototype.setFontBorderColor.apply(this,arguments)}var b=this.createElement("fontbordercolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)}};mxXmlCanvas2D.prototype.setFontSize=function(a){if(this.textEnabled){if(this.compressed){if(this.state.fontSize==a)return;mxAbstractCanvas2D.prototype.setFontSize.apply(this,arguments)}var b=this.createElement("fontsize");b.setAttribute("size",a);this.root.appendChild(b)}};mxXmlCanvas2D.prototype.setFontFamily=function(a){if(this.textEnabled){if(this.compressed){if(this.state.fontFamily==a)return;mxAbstractCanvas2D.prototype.setFontFamily.apply(this,arguments)}var b=this.createElement("fontfamily");b.setAttribute("family",a);this.root.appendChild(b)}};mxXmlCanvas2D.prototype.setFontStyle=function(a){if(this.textEnabled){null==a&&(a=0);if(this.compressed){if(this.state.fontStyle==a)return;mxAbstractCanvas2D.prototype.setFontStyle.apply(this,arguments)}var b=this.createElement("fontstyle");b.setAttribute("style",a);this.root.appendChild(b)}};mxXmlCanvas2D.prototype.setShadow=function(a){if(this.compressed){if(this.state.shadow==a)return;mxAbstractCanvas2D.prototype.setShadow.apply(this,arguments)}var b=this.createElement("shadow");b.setAttribute("enabled",a?"1":"0");this.root.appendChild(b)};mxXmlCanvas2D.prototype.setShadowColor=function(a){if(this.compressed){a==mxConstants.NONE&&(a=null);if(this.state.shadowColor==a)return;mxAbstractCanvas2D.prototype.setShadowColor.apply(this,arguments)}var b=this.createElement("shadowcolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)};mxXmlCanvas2D.prototype.setShadowAlpha=function(a){if(this.compressed){if(this.state.shadowAlpha==a)return;mxAbstractCanvas2D.prototype.setShadowAlpha.apply(this,arguments)}var b=this.createElement("shadowalpha");b.setAttribute("alpha",a);this.root.appendChild(b)};mxXmlCanvas2D.prototype.setShadowOffset=function(a,b){if(this.compressed){if(this.state.shadowDx==a&&this.state.shadowDy==b)return;mxAbstractCanvas2D.prototype.setShadowOffset.apply(this,arguments)}var c=this.createElement("shadowoffset");c.setAttribute("dx",a);c.setAttribute("dy",b);this.root.appendChild(c)};mxXmlCanvas2D.prototype.rect=function(a,b,c,d){var e=this.createElement("rect");e.setAttribute("x",this.format(a));e.setAttribute("y",this.format(b));e.setAttribute("w",this.format(c));e.setAttribute("h",this.format(d));this.root.appendChild(e)};mxXmlCanvas2D.prototype.roundrect=function(a,b,c,d,e,f){var g=this.createElement("roundrect");g.setAttribute("x",this.format(a));g.setAttribute("y",this.format(b));g.setAttribute("w",this.format(c));g.setAttribute("h",this.format(d));g.setAttribute("dx",this.format(e));g.setAttribute("dy",this.format(f));this.root.appendChild(g)};mxXmlCanvas2D.prototype.ellipse=function(a,b,c,d){var e=this.createElement("ellipse");e.setAttribute("x",this.format(a));e.setAttribute("y",this.format(b));e.setAttribute("w",this.format(c));e.setAttribute("h",this.format(d));this.root.appendChild(e)};mxXmlCanvas2D.prototype.image=function(a,b,c,d,e,f,g,k){e=this.converter.convert(e);var l=this.createElement("image");l.setAttribute("x",this.format(a));l.setAttribute("y",this.format(b));l.setAttribute("w",this.format(c));l.setAttribute("h",this.format(d));l.setAttribute("src",e);l.setAttribute("aspect",f?"1":"0");l.setAttribute("flipH",g?"1":"0");l.setAttribute("flipV",k?"1":"0");this.root.appendChild(l)};mxXmlCanvas2D.prototype.begin=function(){this.root.appendChild(this.createElement("begin"));this.lastY=this.lastX=0};mxXmlCanvas2D.prototype.moveTo=function(a,b){var c=this.createElement("move");c.setAttribute("x",this.format(a));c.setAttribute("y",this.format(b));this.root.appendChild(c);this.lastX=a;this.lastY=b};mxXmlCanvas2D.prototype.lineTo=function(a,b){var c=this.createElement("line");c.setAttribute("x",this.format(a));c.setAttribute("y",this.format(b));this.root.appendChild(c);this.lastX=a;this.lastY=b};mxXmlCanvas2D.prototype.quadTo=function(a,b,c,d){var e=this.createElement("quad");e.setAttribute("x1",this.format(a));e.setAttribute("y1",this.format(b));e.setAttribute("x2",this.format(c));e.setAttribute("y2",this.format(d));this.root.appendChild(e);this.lastX=c;this.lastY=d};mxXmlCanvas2D.prototype.curveTo=function(a,b,c,d,e,f){var g=this.createElement("curve");g.setAttribute("x1",this.format(a));g.setAttribute("y1",this.format(b));g.setAttribute("x2",this.format(c));g.setAttribute("y2",this.format(d));g.setAttribute("x3",this.format(e));g.setAttribute("y3",this.format(f));this.root.appendChild(g);this.lastX=e;this.lastY=f};mxXmlCanvas2D.prototype.close=function(){this.root.appendChild(this.createElement("close"))};mxXmlCanvas2D.prototype.text=function(a,b,c,d,e,f,g,k,l,m,n,p,q){if(this.textEnabled&&null!=e){mxUtils.isNode(e)&&(e=mxUtils.getOuterHtml(e));var u=this.createElement("text");u.setAttribute("x",this.format(a));u.setAttribute("y",this.format(b));u.setAttribute("w",this.format(c));u.setAttribute("h",this.format(d));u.setAttribute("str",e);null!=f&&u.setAttribute("align",f);null!=g&&u.setAttribute("valign",g);u.setAttribute("wrap",k?"1":"0");null==l&&(l="");u.setAttribute("format",l);null!=m&&u.setAttribute("overflow",m);null!=n&&u.setAttribute("clip",n?"1":"0");null!=p&&u.setAttribute("rotation",p);null!=q&&u.setAttribute("dir",q);this.root.appendChild(u)}};mxXmlCanvas2D.prototype.stroke=function(){this.root.appendChild(this.createElement("stroke"))};mxXmlCanvas2D.prototype.fill=function(){this.root.appendChild(this.createElement("fill"))};mxXmlCanvas2D.prototype.fillAndStroke=function(){this.root.appendChild(this.createElement("fillstroke"))};function mxSvgCanvas2D(a,b){mxAbstractCanvas2D.call(this);this.root=a;this.gradients=[];this.defs=null;this.styleEnabled=null!=b?b:!1;var c=null;if(a.ownerDocument!=document)for(c=a;null!=c&&"svg"!=c.nodeName;)c=c.parentNode;null!=c&&(0<c.getElementsByTagName("defs").length&&(this.defs=c.getElementsByTagName("defs")[0]),null==this.defs&&(this.defs=this.createElement("defs"),null!=c.firstChild?c.insertBefore(this.defs,c.firstChild):c.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}
mxUtils.extend(mxSvgCanvas2D,mxAbstractCanvas2D);(function(){mxSvgCanvas2D.prototype.useDomParser=!mxClient.IS_IE&&"function"===typeof DOMParser&&"function"===typeof XMLSerializer;if(mxSvgCanvas2D.prototype.useDomParser){var a=(new DOMParser).parseFromString("test text","text/html");mxSvgCanvas2D.prototype.useDomParser=null!=a}})();mxSvgCanvas2D.prototype.node=null;mxSvgCanvas2D.prototype.matchHtmlAlignment=!0;mxSvgCanvas2D.prototype.textEnabled=!0;mxSvgCanvas2D.prototype.foEnabled=!0;mxSvgCanvas2D.prototype.foAltText="[Object]";mxSvgCanvas2D.prototype.strokeTolerance=0;mxSvgCanvas2D.prototype.refCount=0;mxSvgCanvas2D.prototype.blockImagePointerEvents=!1;mxSvgCanvas2D.prototype.lineHeightCorrection=1.05;mxSvgCanvas2D.prototype.pointerEventsValue="all";mxSvgCanvas2D.prototype.fontMetricsPadding=10;mxSvgCanvas2D.prototype.format=function(a){return parseFloat(parseFloat(a).toFixed(2))};mxSvgCanvas2D.prototype.getBaseUrl=function(){var a=window.location.href,b=a.lastIndexOf("#");0<b&&(a=a.substring(0,b));return a};mxSvgCanvas2D.prototype.reset=function(){mxAbstractCanvas2D.prototype.reset.apply(this,arguments);this.gradients=[]};mxSvgCanvas2D.prototype.createStyle=function(a){a=this.createElement("style");a.setAttribute("type","text/css");mxUtils.write(a,"svg{font-family:"+mxConstants.DEFAULT_FONTFAMILY+";font-size:"+mxConstants.DEFAULT_FONTSIZE+";fill:none;stroke-miterlimit:10}");return a};mxSvgCanvas2D.prototype.createElement=function(a,b){if(null!=this.root.ownerDocument.createElementNS)return this.root.ownerDocument.createElementNS(b||mxConstants.NS_SVG,a);var c=this.root.ownerDocument.createElement(a);null!=b&&c.setAttribute("xmlns",b);return c};mxSvgCanvas2D.prototype.createAlternateContent=function(a,b,c,d,e,f,g,k,l,m,n,p,q){return null!=this.foAltText?(a=this.state,b=this.createElement("text"),b.setAttribute("x",Math.round(d/2)),b.setAttribute("y",Math.round((e+a.fontSize)/2)),b.setAttribute("fill",a.fontColor||"black"),b.setAttribute("text-anchor","middle"),b.setAttribute("font-size",Math.round(a.fontSize)+"px"),b.setAttribute("font-family",a.fontFamily),(a.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&b.setAttribute("font-weight",
"bold"),(a.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&b.setAttribute("font-style","italic"),(a.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&b.setAttribute("text-decoration","underline"),mxUtils.write(b,this.foAltText),b):null};mxSvgCanvas2D.prototype.createGradientId=function(a,b,c,d,e){"#"==a.charAt(0)&&(a=a.substring(1));"#"==b.charAt(0)&&(b=b.substring(1));a=a.toLowerCase()+"-"+c;b=b.toLowerCase()+"-"+d;c=null;null==e||e==mxConstants.DIRECTION_SOUTH?c="s":e==mxConstants.DIRECTION_EAST?c="e":(d=a,a=b,b=d,e==mxConstants.DIRECTION_NORTH?c="s":e==mxConstants.DIRECTION_WEST&&(c="e"));return"mx-gradient-"+a+"-"+b+"-"+c};mxSvgCanvas2D.prototype.getSvgGradient=function(a,b,c,d,e){var f=this.createGradientId(a,b,c,d,e),g=this.gradients[f];if(null==g){var k=this.root.ownerSVGElement,l=0,m=f+"-"+l;if(null!=k)for(g=k.ownerDocument.getElementById(m);null!=g&&g.ownerSVGElement!=k;)m=f+"-"+l++,g=k.ownerDocument.getElementById(m);else m="id"+ ++this.refCount;null==g&&(g=this.createSvgGradient(a,b,c,d,e),g.setAttribute("id",m),null!=this.defs?this.defs.appendChild(g):k.appendChild(g));this.gradients[f]=g}return g.getAttribute("id")};mxSvgCanvas2D.prototype.createSvgGradient=function(a,b,c,d,e){var f=this.createElement("linearGradient");f.setAttribute("x1","0%");f.setAttribute("y1","0%");f.setAttribute("x2","0%");f.setAttribute("y2","0%");null==e||e==mxConstants.DIRECTION_SOUTH?f.setAttribute("y2","100%"):e==mxConstants.DIRECTION_EAST?f.setAttribute("x2","100%"):e==mxConstants.DIRECTION_NORTH?f.setAttribute("y1","100%"):e==mxConstants.DIRECTION_WEST&&f.setAttribute("x1","100%");c=1>c?";stop-opacity:"+c:"";e=this.createElement("stop");e.setAttribute("offset","0%");e.setAttribute("style","stop-color:"+a+c);f.appendChild(e);c=1>d?";stop-opacity:"+d:"";e=this.createElement("stop");e.setAttribute("offset","100%");e.setAttribute("style","stop-color:"+b+c);f.appendChild(e);return f};mxSvgCanvas2D.prototype.addNode=function(a,b){var c=this.node,d=this.state;if(null!=c){if("path"==c.nodeName)if(null!=this.path&&0<this.path.length)c.setAttribute("d",this.path.join(" "));else return;a&&null!=d.fillColor?this.updateFill():this.styleEnabled||("ellipse"==c.nodeName&&mxClient.IS_FF?c.setAttribute("fill","transparent"):c.setAttribute("fill","none"),a=!1);b&&null!=d.strokeColor?this.updateStroke():this.styleEnabled||c.setAttribute("stroke","none");null!=d.transform&&0<d.transform.length&&c.setAttribute("transform",d.transform);d.shadow&&this.root.appendChild(this.createShadow(c));0<this.strokeTolerance&&!a&&this.root.appendChild(this.createTolerance(c));!this.pointerEvents||"path"==c.nodeName&&this.path[this.path.length-1]!=this.closeOp?!this.pointerEvents&&null==this.originalRoot&&c.setAttribute("pointer-events","none"):c.setAttribute("pointer-events",this.pointerEventsValue);this.root.appendChild(c)}};mxSvgCanvas2D.prototype.updateFill=function(){var a=this.state;1>a.alpha&&this.node.setAttribute("fill-opacity",a.alpha);if(null!=a.fillColor)if(null!=a.gradientColor)if(a=this.getSvgGradient(a.fillColor,a.gradientColor,a.fillAlpha,a.gradientAlpha,a.gradientDirection),mxClient.IS_IE||this.root.ownerDocument!=document)this.node.setAttribute("fill","url(#"+a+")");else{var b=this.getBaseUrl().replace(/([\(\)])/g,"\\$1");this.node.setAttribute("fill","url("+b+"#"+a+")")}else this.node.setAttribute("fill",a.fillColor.toLowerCase())};mxSvgCanvas2D.prototype.getCurrentStrokeWidth=function(){return Math.max(1,this.format(this.state.strokeWidth*this.state.scale))};mxSvgCanvas2D.prototype.updateStroke=function(){var a=this.state;this.node.setAttribute("stroke",a.strokeColor.toLowerCase());1>a.alpha&&this.node.setAttribute("stroke-opacity",a.alpha);var b=this.getCurrentStrokeWidth();1!=b&&this.node.setAttribute("stroke-width",b);"path"==this.node.nodeName&&this.updateStrokeAttributes();a.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern(a.strokeWidth*a.scale))};mxSvgCanvas2D.prototype.updateStrokeAttributes=function(){var a=this.state;null!=a.lineJoin&&"miter"!=a.lineJoin&&this.node.setAttribute("stroke-linejoin",a.lineJoin);if(null!=a.lineCap){var b=a.lineCap;"flat"==b&&(b="butt");"butt"!=b&&this.node.setAttribute("stroke-linecap",b)}null==a.miterLimit||this.styleEnabled&&10==a.miterLimit||this.node.setAttribute("stroke-miterlimit",a.miterLimit)};mxSvgCanvas2D.prototype.createDashPattern=function(a){var b=[];if("string"===typeof this.state.dashPattern){var c=this.state.dashPattern.split(" ");if(0<c.length)for(var d=0;d<c.length;d++)b[d]=Number(c[d])*a}return b.join(" ")};mxSvgCanvas2D.prototype.createTolerance=function(a){a=a.cloneNode(!0);var b=parseFloat(a.getAttribute("stroke-width")||1)+this.strokeTolerance;a.setAttribute("pointer-events","stroke");a.setAttribute("visibility","hidden");a.removeAttribute("stroke-dasharray");a.setAttribute("stroke-width",b);a.setAttribute("fill","none");a.setAttribute("stroke",mxClient.IS_OT?"none":"white");return a};mxSvgCanvas2D.prototype.createShadow=function(a){a=a.cloneNode(!0);var b=this.state;"none"==a.getAttribute("fill")||mxClient.IS_FF&&"transparent"==a.getAttribute("fill")||a.setAttribute("fill",b.shadowColor);"none"!=a.getAttribute("stroke")&&a.setAttribute("stroke",b.shadowColor);a.setAttribute("transform","translate("+this.format(b.shadowDx*b.scale)+","+this.format(b.shadowDy*b.scale)+")"+(b.transform||""));a.setAttribute("opacity",b.shadowAlpha);return a};mxSvgCanvas2D.prototype.setLink=function(a){if(null==a)this.root=this.originalRoot;else{this.originalRoot=this.root;var b=this.createElement("a");null==b.setAttributeNS||this.root.ownerDocument!=document&&null==document.documentMode?b.setAttribute("xlink:href",a):b.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",a);this.root.appendChild(b);this.root=b}};mxSvgCanvas2D.prototype.rotate=function(a,b,c,d,e){if(0!=a||b||c){var f=this.state;d+=f.dx;e+=f.dy;d*=f.scale;e*=f.scale;f.transform=f.transform||"";if(b&&c)a+=180;else if(b!=c){var g=b?d:0,k=b?-1:1,l=c?e:0,m=c?-1:1;f.transform+="translate("+this.format(g)+","+this.format(l)+")scale("+this.format(k)+","+this.format(m)+")translate("+this.format(-g)+","+this.format(-l)+")"}if(b?!c:c)a*=-1;0!=a&&(f.transform+="rotate("+this.format(a)+","+this.format(d)+","+this.format(e)+")");f.rotation+=a;f.rotationCx=d;f.rotationCy=e}};mxSvgCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments);this.node=this.createElement("path")};mxSvgCanvas2D.prototype.rect=function(a,b,c,d){var e=this.state,f=this.createElement("rect");f.setAttribute("x",this.format((a+e.dx)*e.scale));f.setAttribute("y",this.format((b+e.dy)*e.scale));f.setAttribute("width",this.format(c*e.scale));f.setAttribute("height",this.format(d*e.scale));this.node=f};mxSvgCanvas2D.prototype.roundrect=function(a,b,c,d,e,f){this.rect(a,b,c,d);0<e&&this.node.setAttribute("rx",this.format(e*this.state.scale));0<f&&this.node.setAttribute("ry",this.format(f*this.state.scale))};mxSvgCanvas2D.prototype.ellipse=function(a,b,c,d){var e=this.state,f=this.createElement("ellipse");f.setAttribute("cx",Math.round((a+c/2+e.dx)*e.scale));f.setAttribute("cy",Math.round((b+d/2+e.dy)*e.scale));f.setAttribute("rx",c/2*e.scale);f.setAttribute("ry",d/2*e.scale);this.node=f};mxSvgCanvas2D.prototype.image=function(a,b,c,d,e,f,g,k){e=this.converter.convert(e);f=null!=f?f:!0;g=null!=g?g:!1;k=null!=k?k:!1;var l=this.state;a+=l.dx;b+=l.dy;var m=this.createElement("image");m.setAttribute("x",this.format(a*l.scale));m.setAttribute("y",this.format(b*l.scale));m.setAttribute("width",this.format(c*l.scale));m.setAttribute("height",this.format(d*l.scale));null==m.setAttributeNS?m.setAttribute("xlink:href",e):m.setAttributeNS(mxConstants.NS_XLINK,"xlink:href",e);f||m.setAttribute("preserveAspectRatio","none");1>l.alpha&&m.setAttribute("opacity",l.alpha);e=this.state.transform||"";if(g||k){var n=f=1,p=0,q=0;g&&(f=-1,p=-c-2*a);k&&(n=-1,q=-d-2*b);e+="scale("+f+","+n+")translate("+p*l.scale+","+q*l.scale+")"}0<e.length&&m.setAttribute("transform",e);this.pointerEvents||m.setAttribute("pointer-events","none");this.root.appendChild(m);this.blockImagePointerEvents&&(m.setAttribute("style","pointer-events:none"),m=this.createElement("rect"),m.setAttribute("visibility","hidden"),m.setAttribute("pointer-events","fill"),m.setAttribute("x",this.format(a*l.scale)),m.setAttribute("y",this.format(b*l.scale)),m.setAttribute("width",this.format(c*l.scale)),m.setAttribute("height",this.format(d*l.scale)),this.root.appendChild(m))};mxSvgCanvas2D.prototype.convertHtml=function(a){if(this.useDomParser){var b=(new DOMParser).parseFromString(a,"text/html");null!=b&&(a=(new XMLSerializer).serializeToString(b.body),"<body"==a.substring(0,5)&&(a=a.substring(a.indexOf(">",5)+1)),"</body>"==a.substring(a.length-7,a.length)&&(a=a.substring(0,a.length-7)))}else b=document.createElement("textarea"),b.innerHTML=a.replace(/&amp;/g,"&amp;amp;").replace(/&#60;/g,"&amp;lt;").replace(/&#62;/g,"&amp;gt;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a=b.value.replace(/&/g,"&amp;").replace(/&amp;lt;/g,"&lt;").replace(/&amp;gt;/g,"&gt;").replace(/&amp;amp;/g,"&amp;").replace(/<br>/g,"<br />").replace(/<hr>/g,"<hr />").replace(/(<img[^>]+)>/gm,"$1 />");return a};mxSvgCanvas2D.prototype.createDiv=function(a,b,c,d,e){c=this.state;var f=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(c.fontSize*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT*this.lineHeightCorrection;d="display:inline-block;font-size:"+Math.round(c.fontSize)+"px;font-family:"+c.fontFamily+";color:"+c.fontColor+";line-height:"+f+";"+d;(c.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(d+="font-weight:bold;");(c.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(d+="font-style:italic;");(c.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(d+="text-decoration:underline;");b==mxConstants.ALIGN_CENTER?d+="text-align:center;":b==mxConstants.ALIGN_RIGHT&&(d+="text-align:right;");b="";null!=c.fontBackgroundColor&&(b+="background-color:"+c.fontBackgroundColor+";");null!=c.fontBorderColor&&(b+="border:1px solid "+c.fontBorderColor+";");mxUtils.isNode(a)||(a=this.convertHtml(a),"fill"!=e&&"width"!=e?a='<div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;'+
b+'">'+a+"</div>":d+=b);if(!mxClient.IS_IE&&document.createElementNS)return e=document.createElementNS("http://www.w3.org/1999/xhtml","div"),e.setAttribute("style",d),mxUtils.isNode(a)?this.root.ownerDocument!=document?e.appendChild(a.cloneNode(!0)):e.appendChild(a):e.innerHTML=a,e;mxUtils.isNode(a)&&this.root.ownerDocument!=document&&(a=a.outerHTML);return mxUtils.parseXml('<div xmlns="http://www.w3.org/1999/xhtml" style="'+d+'">'+a+"</div>").documentElement};mxSvgCanvas2D.prototype.text=function(a,b,c,d,e,f,g,k,l,m,n,p,q){if(this.textEnabled&&null!=e){p=null!=p?p:0;var u=this.state;a+=u.dx;b+=u.dy;if(this.foEnabled&&"html"==l){var v="vertical-align:top;";n?v+="overflow:hidden;max-height:"+Math.round(d)+"px;max-width:"+Math.round(c)+"px;":"fill"==m?v+="width:"+Math.round(c)+"px;height:"+Math.round(d)+"px;":"width"==m&&(v+="width:"+Math.round(c)+"px;",0<d&&(v+="max-height:"+Math.round(d)+"px;"));var v=k&&0<c?v+("width:"+Math.round(c)+"px;white-space:normal;"):v+"white-space:nowrap;",y=this.createElement("g");1>u.alpha&&y.setAttribute("opacity",u.alpha);var z=this.createElement("foreignObject");z.setAttribute("pointer-events","all");v=this.createDiv(e,f,g,v,m);if(null!=v){null!=q&&v.setAttribute("dir",q);y.appendChild(z);this.root.appendChild(y);var x=0,B=q=2;if(!mxClient.IS_IE||9!=document.documentMode&&mxClient.IS_SVG)this.root.ownerDocument!=document||mxClient.IS_FF?(v.style.visibility="hidden",document.body.appendChild(v)):z.appendChild(v),A=v,null!=A.firstChild&&"DIV"==A.firstChild.nodeName&&(A=A.firstChild),x=A.offsetWidth,!n&&k&&0<c&&this.root.ownerDocument!=document&&(G=v.style.whiteSpace,v.style.whiteSpace="nowrap",x==A.offsetWidth&&(q+=this.fontMetricsPadding),v.style.whiteSpace=G),x+=q,k&&(n&&(x=Math.min(x,c)),v.style.width=x+"px"),x=A.offsetWidth+q,q=A.offsetHeight+2,v.parentNode!=z&&(z.appendChild(v),v.style.visibility="");else{var A=document.createElement("div");A.style.cssText=v.getAttribute("style");A.style.display=mxClient.IS_QUIRKS?"inline":"inline-block";A.style.position="absolute";A.style.visibility="hidden";var D=document.createElement("div");D.style.display=mxClient.IS_QUIRKS?"inline":"inline-block";D.innerHTML=mxUtils.isNode(e)?e.outerHTML:e;A.appendChild(D);document.body.appendChild(A);8!=document.documentMode&&9!=document.documentMode&&null!=u.fontBorderColor&&(q+=2,B+=2);if(k&&0<c){var x=D.offsetWidth,E=0;if(!n&&this.root.ownerDocument!=document){var G=A.style.whiteSpace;A.style.whiteSpace="nowrap";if(x==D.offsetWidth)q+=this.fontMetricsPadding;else if(8==document.documentMode||9==document.documentMode)E=-2;A.style.whiteSpace=G}x+=q;n&&(x=Math.min(x,c));A.style.width=x+"px";x=D.offsetWidth+q+E;q=D.offsetHeight+B;A.style.display="inline-block";A.style.position="";A.style.visibility="";A.style.width=x+"px";v.setAttribute("style",A.style.cssText)}else x=D.offsetWidth+q,q=D.offsetHeight+B;A.parentNode.removeChild(A);z.appendChild(v)}n&&(q=Math.min(q,d),x=Math.min(x,c));"fill"==m?(c=Math.max(c,x),d=Math.max(d,q)):(c="width"==m?Math.max(c,x):x,d=q);1>u.alpha&&y.setAttribute("opacity",u.alpha);q=v=0;f==mxConstants.ALIGN_CENTER?v-=c/2:f==mxConstants.ALIGN_RIGHT&&(v-=c);a+=v;g==mxConstants.ALIGN_MIDDLE?q-=d/2-2:g==mxConstants.ALIGN_BOTTOM&&(q-=d-3);!mxClient.IS_OP&&mxClient.IS_GC&&mxClient.IS_MAC?q+=1:mxClient.IS_FF&&mxClient.IS_WIN&&(q-=1);b+=q;A=1!=u.scale?"scale("+u.scale+")":"";0!=u.rotation&&this.rotateHtml?(A+="rotate("+u.rotation+","+c/2+","+d/2+")",b=this.rotatePoint((a+c/2)*u.scale,(b+d/2)*u.scale,u.rotation,u.rotationCx,u.rotationCy),a=b.x-c*u.scale/2,b=b.y-d*u.scale/2):(a*=u.scale,b*=u.scale);0!=p&&(A+="rotate("+p+","+-v+","+-q+")");y.setAttribute("transform","translate("+Math.round(a)+","+Math.round(b)+")"+A);z.setAttribute("width",Math.round(Math.max(1,c)));z.setAttribute("height",Math.round(Math.max(1,d)));this.root.ownerDocument!=document&&(a=this.createAlternateContent(z,a,b,c,d,e,f,g,k,l,m,n,p),null!=a&&(z.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility"),c=this.createElement("switch"),c.appendChild(z),c.appendChild(a),y.appendChild(c)))}}else this.plainText(a,b,c,d,e,f,g,k,m,n,p,q)}};mxSvgCanvas2D.prototype.createClip=function(a,b,c,d){a=Math.round(a);b=Math.round(b);c=Math.round(c);d=Math.round(d);for(var e="mx-clip-"+a+"-"+b+"-"+c+"-"+d,f=0,g=e+"-"+f;null!=document.getElementById(g);)g=e+"-"+ ++f;clip=this.createElement("clipPath");clip.setAttribute("id",g);e=this.createElement("rect");e.setAttribute("x",a);e.setAttribute("y",b);e.setAttribute("width",c);e.setAttribute("height",d);clip.appendChild(e);return clip};mxSvgCanvas2D.prototype.plainText=function(a,b,c,d,e,f,g,k,l,m,n,p){n=null!=n?n:0;k=this.state;var q=Math.round(k.fontSize),u=this.createElement("g"),v=k.transform||"";this.updateFont(u);0!=n&&(v+="rotate("+n+","+this.format(a*k.scale)+","+this.format(b*k.scale)+")");null!=p&&u.setAttribute("direction",p);m&&0<c&&0<d&&(p=a,n=b,f==mxConstants.ALIGN_CENTER?p-=c/2:f==mxConstants.ALIGN_RIGHT&&(p-=c),"fill"!=l&&(g==mxConstants.ALIGN_MIDDLE?n-=d/2:g==mxConstants.ALIGN_BOTTOM&&(n-=d)),n=this.createClip(p*k.scale-2,n*k.scale-2,c*k.scale+4,d*k.scale+4),null!=this.defs?this.defs.appendChild(n):this.root.appendChild(n),mxClient.IS_IE||this.root.ownerDocument!=document?u.setAttribute("clip-path","url(#"+n.getAttribute("id")+")"):(p=this.getBaseUrl().replace(/([\(\)])/g,"\\$1"),u.setAttribute("clip-path","url("+p+"#"+n.getAttribute("id")+")")));n=f==mxConstants.ALIGN_RIGHT?"end":f==mxConstants.ALIGN_CENTER?"middle":"start";"start"!=n&&u.setAttribute("text-anchor",n);this.styleEnabled&&q==mxConstants.DEFAULT_FONTSIZE||u.setAttribute("font-size",Math.round(q*k.scale)+"px");0<v.length&&u.setAttribute("transform",v);1>k.alpha&&u.setAttribute("opacity",k.alpha);v=e.split("\n");p=Math.round(q*mxConstants.LINE_HEIGHT);var y=q+(v.length-1)*p;n=b+q-1;g==mxConstants.ALIGN_MIDDLE?"fill"==l?n-=d/2:(m=(this.matchHtmlAlignment&&m&&0<d?Math.min(y,d):y)/2,n-=m+1):g==mxConstants.ALIGN_BOTTOM&&("fill"==l?n-=d:(m=this.matchHtmlAlignment&&m&&0<d?Math.min(y,d):y,n-=m+2));for(m=0;m<v.length;m++)0<v[m].length&&0<mxUtils.trim(v[m]).length&&
(q=this.createElement("text"),q.setAttribute("x",this.format(a*k.scale)),q.setAttribute("y",this.format(n*k.scale)),mxUtils.write(q,v[m]),u.appendChild(q)),n+=p;this.root.appendChild(u);this.addTextBackground(u,e,a,b,c,"fill"==l?d:y,f,g,l)};mxSvgCanvas2D.prototype.updateFont=function(a){var b=this.state;a.setAttribute("fill",b.fontColor);this.styleEnabled&&b.fontFamily==mxConstants.DEFAULT_FONTFAMILY||a.setAttribute("font-family",b.fontFamily);(b.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&a.setAttribute("font-weight","bold");(b.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&a.setAttribute("font-style","italic");(b.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&a.setAttribute("text-decoration","underline")};mxSvgCanvas2D.prototype.addTextBackground=function(a,b,c,d,e,f,g,k,l){var m=this.state;if(null!=m.fontBackgroundColor||null!=m.fontBorderColor){var n=null;if("fill"==l||"width"==l)g==mxConstants.ALIGN_CENTER?c-=e/2:g==mxConstants.ALIGN_RIGHT&&(c-=e),k==mxConstants.ALIGN_MIDDLE?d-=f/2:k==mxConstants.ALIGN_BOTTOM&&(d-=f),n=new mxRectangle((c+1)*m.scale,d*m.scale,(e-2)*m.scale,(f+2)*m.scale);else if(null!=a.getBBox&&this.root.ownerDocument==document)try{var n=a.getBBox(),p=mxClient.IS_IE&&mxClient.IS_SVG,n=new mxRectangle(n.x,n.y+(p?0:1),n.width,n.height+(p?1:0))}catch(q){}else n=document.createElement("div"),n.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(m.fontSize*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT,n.style.fontSize=Math.round(m.fontSize)+"px",n.style.fontFamily=m.fontFamily,n.style.whiteSpace="nowrap",n.style.position="absolute",n.style.visibility="hidden",n.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",n.style.zoom="1",(m.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(n.style.fontWeight="bold"),(m.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(n.style.fontStyle="italic"),b=mxUtils.htmlEntities(b,!1),n.innerHTML=b.replace(/\n/g,"<br/>"),document.body.appendChild(n),e=n.offsetWidth,f=n.offsetHeight,n.parentNode.removeChild(n),g==mxConstants.ALIGN_CENTER?c-=e/2:g==mxConstants.ALIGN_RIGHT&&(c-=e),k==mxConstants.ALIGN_MIDDLE?d-=f/2:k==mxConstants.ALIGN_BOTTOM&&(d-=f),n=new mxRectangle((c+1)*m.scale,(d+2)*m.scale,e*m.scale,(f+1)*m.scale);null!=n&&(b=this.createElement("rect"),b.setAttribute("fill",m.fontBackgroundColor||"none"),b.setAttribute("stroke",m.fontBorderColor||"none"),b.setAttribute("x",Math.floor(n.x-1)),b.setAttribute("y",Math.floor(n.y-1)),b.setAttribute("width",Math.ceil(n.width+2)),b.setAttribute("height",Math.ceil(n.height)),m=null!=m.fontBorderColor?Math.max(1,this.format(m.scale)):0,b.setAttribute("stroke-width",m),this.root.ownerDocument==document&&1==mxUtils.mod(m,2)&&b.setAttribute("transform","translate(0.5, 0.5)"),a.insertBefore(b,a.firstChild))}};mxSvgCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)};mxSvgCanvas2D.prototype.fill=function(){this.addNode(!0,!1)};mxSvgCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};var mxVmlCanvas2D=function(a){mxAbstractCanvas2D.call(this);this.root=a};mxUtils.extend(mxVmlCanvas2D,mxAbstractCanvas2D);mxVmlCanvas2D.prototype.node=null;mxVmlCanvas2D.prototype.textEnabled=!0;mxVmlCanvas2D.prototype.moveOp="m";mxVmlCanvas2D.prototype.lineOp="l";mxVmlCanvas2D.prototype.curveOp="c";mxVmlCanvas2D.prototype.closeOp="x";mxVmlCanvas2D.prototype.rotatedHtmlBackground="";mxVmlCanvas2D.prototype.vmlScale=1;mxVmlCanvas2D.prototype.createElement=function(a){return document.createElement(a)};mxVmlCanvas2D.prototype.createVmlElement=function(a){return this.createElement(mxClient.VML_PREFIX+":"+a)};mxVmlCanvas2D.prototype.addNode=function(a,b){var c=this.node,d=this.state;if(null!=c){if("shape"==c.nodeName)if(null!=this.path&&0<this.path.length)c.path=this.path.join(" ")+" e",c.style.width=this.root.style.width,c.style.height=this.root.style.height,c.coordsize=parseInt(c.style.width)+" "+parseInt(c.style.height);else return;c.strokeweight=this.format(Math.max(1,d.strokeWidth*d.scale/this.vmlScale))+"px";d.shadow&&this.root.appendChild(this.createShadow(c,a&&null!=d.fillColor,b&&null!=d.strokeColor));b&&null!=d.strokeColor?(c.stroked="true",c.strokecolor=d.strokeColor):c.stroked="false";c.appendChild(this.createStroke());a&&null!=d.fillColor?c.appendChild(this.createFill()):!this.pointerEvents||"shape"==c.nodeName&&this.path[this.path.length-1]!=this.closeOp?c.filled="false":c.appendChild(this.createTransparentFill());this.root.appendChild(c)}};mxVmlCanvas2D.prototype.createTransparentFill=function(){var a=this.createVmlElement("fill");a.src=mxClient.imageBasePath+"/transparent.gif";a.type="tile";return a};mxVmlCanvas2D.prototype.createFill=function(){var a=this.state,b=this.createVmlElement("fill");b.color=a.fillColor;if(null!=a.gradientColor){b.type="gradient";b.method="none";b.color2=a.gradientColor;var c=180-a.rotation,c=a.gradientDirection==mxConstants.DIRECTION_WEST?c-(90+("x"==this.root.style.flip?180:0)):a.gradientDirection==mxConstants.DIRECTION_EAST?c+(90+("x"==this.root.style.flip?180:0)):a.gradientDirection==mxConstants.DIRECTION_NORTH?c-(180+("y"==this.root.style.flip?-180:0)):c+("y"==this.root.style.flip?-180:0);if("x"==this.root.style.flip||"y"==this.root.style.flip)c*=-1;b.angle=mxUtils.mod(c,360);b.opacity=100*a.alpha*a.fillAlpha+"%";b.setAttribute(mxClient.OFFICE_PREFIX+":opacity2",100*a.alpha*a.gradientAlpha+"%")}else 1>a.alpha&&(b.opacity=100*a.alpha+"%");return b};mxVmlCanvas2D.prototype.createStroke=function(){var a=this.state,b=this.createVmlElement("stroke");b.endcap=a.lineCap||"flat";b.joinstyle=a.lineJoin||"miter";b.miterlimit=a.miterLimit||"10";1>a.alpha&&(b.opacity=100*a.alpha+"%");a.dashed&&(b.dashstyle=this.getVmlDashStyle());return b};mxVmlCanvas2D.prototype.getVmlDashStyle=function(){var a="dash";if("string"===typeof this.state.dashPattern){var b=this.state.dashPattern.split(" ");0<b.length&&1==b[0]&&(a="0 2")}return a};mxVmlCanvas2D.prototype.createShadow=function(a,b,c){var d=this.state,e=Math.PI/180*-d.rotation,f=Math.cos(e),e=Math.sin(e),g=d.shadowDx*d.scale,k=d.shadowDy*d.scale;"x"==this.root.style.flip?g*=-1:"y"==this.root.style.flip&&(k*=-1);var l=a.cloneNode(!0);l.style.marginLeft=Math.round(g*f-k*e)+"px";l.style.marginTop=Math.round(g*e+k*f)+"px";8==document.documentMode&&(l.strokeweight=a.strokeweight,"shape"==a.nodeName&&(l.path=this.path.join(" ")+" e",l.style.width=this.root.style.width,l.style.height=this.root.style.height,l.coordsize=parseInt(a.style.width)+" "+parseInt(a.style.height)));c?(l.strokecolor=d.shadowColor,l.appendChild(this.createShadowStroke())):l.stroked="false";b?l.appendChild(this.createShadowFill()):l.filled="false";return l};mxVmlCanvas2D.prototype.createShadowFill=function(){var a=this.createVmlElement("fill");a.color=this.state.shadowColor;a.opacity=100*this.state.alpha*this.state.shadowAlpha+"%";return a};mxVmlCanvas2D.prototype.createShadowStroke=function(){var a=this.createStroke();a.opacity=100*this.state.alpha*this.state.shadowAlpha+"%";return a};mxVmlCanvas2D.prototype.rotate=function(a,b,c,d,e){b&&c?a+=180:b?this.root.style.flip="x":c&&(this.root.style.flip="y");if(b?!c:c)a*=-1;this.root.style.rotation=a;this.state.rotation+=a;this.state.rotationCx=d;this.state.rotationCy=e};mxVmlCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments);this.node=this.createVmlElement("shape");this.node.style.position="absolute"};mxVmlCanvas2D.prototype.quadTo=function(a,b,c,d){var e=this.state,f=(this.lastX+e.dx)*e.scale,g=(this.lastY+e.dy)*e.scale;a=(a+e.dx)*e.scale;b=(b+e.dy)*e.scale;c=(c+e.dx)*e.scale;d=(d+e.dy)*e.scale;var g=g+2/3*(b-g),k=c+2/3*(a-c);b=d+2/3*(b-d);this.path.push("c "+this.format(f+2/3*(a-f))+" "+this.format(g)+" "+this.format(k)+" "+this.format(b)+" "+this.format(c)+" "+this.format(d));this.lastX=c/e.scale-e.dx;this.lastY=d/e.scale-e.dy};mxVmlCanvas2D.prototype.createRect=function(a,b,c,d,e){var f=this.state;a=this.createVmlElement(a);a.style.position="absolute";a.style.left=this.format((b+f.dx)*f.scale)+"px";a.style.top=this.format((c+f.dy)*f.scale)+"px";a.style.width=this.format(d*f.scale)+"px";a.style.height=this.format(e*f.scale)+"px";return a};mxVmlCanvas2D.prototype.rect=function(a,b,c,d){this.node=this.createRect("rect",a,b,c,d)};mxVmlCanvas2D.prototype.roundrect=function(a,b,c,d,e,f){this.node=this.createRect("roundrect",a,b,c,d);this.node.setAttribute("arcsize",Math.max(100*e/c,100*f/d)+"%")};mxVmlCanvas2D.prototype.ellipse=function(a,b,c,d){this.node=this.createRect("oval",a,b,c,d)};mxVmlCanvas2D.prototype.image=function(a,b,c,d,e,f,g,k){var l=null;f?(l=this.createRect("rect",a,b,c,d),l.stroked="false",a=this.createVmlElement("fill"),a.aspect=f?"atmost":"ignore",a.rotate="true",a.type="frame",a.src=e,l.appendChild(a)):(l=this.createRect("image",a,b,c,d),l.src=e);g&&k?l.style.rotation="180":g?l.style.flip="x":k&&(l.style.flip="y");1>this.state.alpha&&(l.style.filter+="alpha(opacity="+100*this.state.alpha+")");this.root.appendChild(l)};mxVmlCanvas2D.prototype.createDiv=function(a,b,c,d){c=this.createElement("div");var e=this.state,f="";null!=e.fontBackgroundColor&&(f+="background-color:"+e.fontBackgroundColor+";");null!=e.fontBorderColor&&(f+="border:1px solid "+e.fontBorderColor+";");mxUtils.isNode(a)?c.appendChild(a):"fill"!=d&&"width"!=d?(d=this.createElement("div"),d.style.cssText=f,d.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",d.style.zoom="1",d.style.textDecoration="inherit",d.innerHTML=a,c.appendChild(d)):(c.style.cssText=f,c.innerHTML=a);a=c.style;a.fontSize=Math.round(e.fontSize/this.vmlScale)+"px";a.fontFamily=e.fontFamily;a.color=e.fontColor;a.verticalAlign="top";a.textAlign=b||"left";a.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(e.fontSize*mxConstants.LINE_HEIGHT/this.vmlScale)+"px":mxConstants.LINE_HEIGHT;(e.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(a.fontWeight="bold");(e.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(a.fontStyle="italic");(e.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(a.textDecoration="underline");return c};mxVmlCanvas2D.prototype.text=function(a,b,c,d,e,f,g,k,l,m,n,p,q){if(this.textEnabled&&null!=e){var u=this.state;if("html"==l){null!=u.rotation&&(b=this.rotatePoint(a,b,u.rotation,u.rotationCx,u.rotationCy),a=b.x,b=b.y);8!=document.documentMode||mxClient.IS_EM?(a*=u.scale,b*=u.scale):(a+=u.dx,b+=u.dy,g==mxConstants.ALIGN_TOP&&(b-=1));l=8!=document.documentMode||mxClient.IS_EM?this.createElement("div"):this.createVmlElement("group");l.style.position="absolute";l.style.display="inline";l.style.left=this.format(a)+"px";l.style.top=this.format(b)+"px";l.style.zoom=u.scale;var v=this.createElement("div");v.style.position="relative";v.style.display="inline";var y=mxUtils.getAlignmentAsPoint(f,g),z=y.x,y=y.y;e=this.createDiv(e,f,g,m);f=this.createElement("div");null!=q&&e.setAttribute("dir",q);k&&0<c?(n||(e.style.width=Math.round(c)+"px"),e.style.whiteSpace="normal"):e.style.whiteSpace="nowrap";p=u.rotation+(p||0);this.rotateHtml&&0!=p?(f.style.display="inline",f.style.zoom="1",f.appendChild(e),8!=document.documentMode||mxClient.IS_EM||"DIV"==this.root.nodeName?l.appendChild(f):(v.appendChild(f),l.appendChild(v))):8!=document.documentMode||mxClient.IS_EM?(e.style.display="inline",l.appendChild(e)):(v.appendChild(e),l.appendChild(v));"DIV"!=this.root.nodeName?(q=this.createVmlElement("rect"),q.stroked="false",q.filled="false",q.appendChild(l),this.root.appendChild(q)):this.root.appendChild(l);n?(e.style.overflow="hidden",e.style.width=Math.round(c)+"px",mxClient.IS_QUIRKS||(e.style.maxHeight=Math.round(d)+"px")):"fill"==m?(e.style.width=c+"px",e.style.height=d+"px"):"width"==m&&(e.style.width=c+"px",0<d&&(e.style.maxHeight=Math.round(d)+"px"));if(this.rotateHtml&&0!=p){var x=Math.PI/180*p;p=parseFloat(parseFloat(Math.cos(x)).toFixed(8));q=parseFloat(parseFloat(Math.sin(-x)).toFixed(8));x%=2*Math.PI;0>x&&(x+=2*Math.PI);x%=Math.PI;x>Math.PI/2&&(x=Math.PI-x);g=Math.cos(x);x=Math.sin(x);8==document.documentMode&&!mxClient.IS_EM&&(e.style.display="inline-block",f.style.display="inline-block",v.style.display="inline-block");e.style.visibility="hidden";e.style.position="absolute";document.body.appendChild(e);var B=e;null!=B.firstChild&&"DIV"==B.firstChild.nodeName&&(B=B.firstChild);v=B.offsetWidth+3;B=B.offsetHeight;n?(c=Math.min(c,v),B=Math.min(B,d)):c=v;k&&(e.style.width=c+"px");mxClient.IS_QUIRKS&&(n||"width"==m)&&B>d&&(B=d,e.style.height=B+"px");d=B;n=(d-d*g+c*-x)/2-q*c*(z+0.5)+p*d*(y+0.5);k=(c-c*g+d*-x)/2+p*c*(z+0.5)+q*d*(y+0.5);"group"==l.nodeName&&"DIV"==this.root.nodeName?(m=this.createElement("div"),
m.style.display="inline-block",m.style.position="absolute",m.style.left=this.format(a+(k-c/2)*u.scale)+"px",m.style.top=this.format(b+(n-d/2)*u.scale)+"px",l.parentNode.appendChild(m),m.appendChild(l)):(u=8!=document.documentMode||mxClient.IS_EM?u.scale:1,l.style.left=this.format(a+(k-c/2)*u)+"px",l.style.top=this.format(b+(n-d/2)*u)+"px");f.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+p+", M12="+q+", M21="+-q+", M22="+p+", sizingMethod='auto expand')";f.style.backgroundColor=this.rotatedHtmlBackground;1>this.state.alpha&&(f.style.filter+="alpha(opacity="+100*this.state.alpha+")");f.appendChild(e);e.style.position="";e.style.visibility=""}else 8!=document.documentMode||mxClient.IS_EM?(e.style.verticalAlign="top",1>this.state.alpha&&(l.style.filter="alpha(opacity="+100*this.state.alpha+")"),u=e.parentNode,e.style.visibility="hidden",document.body.appendChild(e),c=e.offsetWidth,B=e.offsetHeight,mxClient.IS_QUIRKS&&n&&B>d&&(B=d,e.style.height=B+"px"),d=B,e.style.visibility="",u.appendChild(e),l.style.left=this.format(a+c*z*this.state.scale)+"px",l.style.top=this.format(b+d*y*this.state.scale)+"px"):(1>this.state.alpha&&(e.style.filter="alpha(opacity="+100*this.state.alpha+")"),v.style.left=100*z+"%",v.style.top=100*y+"%")}else this.plainText(a,b,c,d,mxUtils.htmlEntities(e,!1),f,g,k,l,m,n,p,q)}};mxVmlCanvas2D.prototype.plainText=function(a,b,c,d,e,f,g,k,l,m,n,p,q){k=this.state;a=(a+k.dx)*k.scale;b=(b+k.dy)*k.scale;c=this.createVmlElement("shape");c.style.width="1px";c.style.height="1px";c.stroked="false";d=this.createVmlElement("fill");d.color=k.fontColor;d.opacity=100*k.alpha+"%";c.appendChild(d);d=this.createVmlElement("path");d.textpathok="true";d.v="m "+this.format(0)+" "+this.format(0)+" l "+this.format(1)+" "+this.format(0);c.appendChild(d);d=this.createVmlElement("textpath");d.style.cssText="v-text-align:"+f;d.style.align=f;d.style.fontFamily=k.fontFamily;d.string=e;d.on="true";f=Math.round(k.fontSize*k.scale/this.vmlScale);d.style.fontSize=f+"px";(k.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(d.style.fontWeight="bold");(k.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(d.style.fontStyle="italic");(k.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(d.style.textDecoration="underline");e=e.split("\n");k=f+(e.length-1)*f*mxConstants.LINE_HEIGHT;f=e=0;g==mxConstants.ALIGN_BOTTOM?f=-k/2:g!=mxConstants.ALIGN_MIDDLE&&(f=k/2);null!=p&&(c.style.rotation=p,g=Math.PI/180*p,e=Math.sin(g)*f,f*=Math.cos(g));c.appendChild(d);c.style.left=this.format(a-e)+"px";c.style.top=this.format(b+f)+"px";this.root.appendChild(c)};mxVmlCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)};mxVmlCanvas2D.prototype.fill=function(){this.addNode(!0,!1)};mxVmlCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};function mxGuide(a,b){this.graph=a;this.setStates(b)}mxGuide.prototype.graph=null;mxGuide.prototype.states=null;mxGuide.prototype.horizontal=!0;mxGuide.prototype.vertical=!0;mxGuide.prototype.guideX=null;mxGuide.prototype.guideY=null;mxGuide.prototype.setStates=function(a){this.states=a};mxGuide.prototype.isEnabledForEvent=function(a){return!0};mxGuide.prototype.getGuideTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};mxGuide.prototype.createGuideShape=function(a){a=new mxPolyline([],mxConstants.GUIDE_COLOR,mxConstants.GUIDE_STROKEWIDTH);a.isDashed=!0;return a};mxGuide.prototype.move=function(a,b,c){if(null!=this.states&&(this.horizontal||this.vertical)&&null!=a&&null!=b){var d=this.graph.getView().translate,e=this.graph.getView().scale,f=b.x,g=b.y,k=!1,l=null,m=null,n=!1,p=null,q=null,u=this.getGuideTolerance(),v=u,y=u,u=a.clone();u.x+=b.x;u.y+=b.y;var z=u.x,x=u.x+u.width,B=u.getCenterX(),A=u.y,D=u.y+u.height,E=u.getCenterY();b=function(b,c){b+=this.graph.panDx;var d=!1;Math.abs(b-B)<v?(f=b-a.getCenterX(),v=Math.abs(b-B),d=!0):Math.abs(b-z)<v?(f=b-a.x,v=Math.abs(b-z),d=!0):Math.abs(b-x)<v&&(f=b-a.x-a.width,v=Math.abs(b-x),d=!0);d&&(l=c,m=Math.round(b-this.graph.panDx),null==this.guideX&&(this.guideX=this.createGuideShape(!0),this.guideX.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane())));k=k||d};for(var u=function(b){b+=this.graph.panDy;var c=!1;Math.abs(b-E)<y?(g=b-a.getCenterY(),y=Math.abs(b-E),c=!0):Math.abs(b-
A)<y?(g=b-a.y,y=Math.abs(b-A),c=!0):Math.abs(b-D)<y&&(g=b-a.y-a.height,y=Math.abs(b-D),c=!0);c&&(p=C,q=Math.round(b-this.graph.panDy),null==this.guideY&&(this.guideY=this.createGuideShape(!1),this.guideY.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane())));n=n||c},G=0;G<this.states.length;G++){var C=this.states[G];null!=C&&(this.horizontal&&(b.call(this,C.getCenterX(),C),b.call(this,C.x,C),b.call(this,C.x+C.width,C)),this.vertical&&(u.call(this,C.getCenterY(),C),u.call(this,C.y,C),u.call(this,C.y+C.height,C)))}c&&(k||(c=a.x-(this.graph.snap(a.x/e-d.x)+d.x)*e,f=this.graph.snap(f/e)*e-c),n||(d=a.y-(this.graph.snap(a.y/e-d.y)+d.y)*e,g=this.graph.snap(g/e)*e-d));e=this.graph.container;k||null==this.guideX?null!=this.guideX&&(null!=l&&null!=a&&(minY=Math.min(a.y+g-this.graph.panDy,l.y),maxY=Math.max(a.y+a.height+g-this.graph.panDy,l.y+l.height)),this.guideX.points=null!=minY&&null!=maxY?[new mxPoint(m,minY),new mxPoint(m,maxY)]:[new mxPoint(m,-this.graph.panDy),new mxPoint(m,e.scrollHeight-3-this.graph.panDy)],this.guideX.node.style.visibility="visible",this.guideX.redraw()):this.guideX.node.style.visibility="hidden";n||null==this.guideY?null!=this.guideY&&(null!=p&&null!=a&&(minX=Math.min(a.x+f-this.graph.panDx,p.x),maxX=Math.max(a.x+a.width+f-this.graph.panDx,p.x+p.width)),this.guideY.points=null!=minX&&null!=maxX?[new mxPoint(minX,q),new mxPoint(maxX,q)]:[new mxPoint(-this.graph.panDx,q),new mxPoint(e.scrollWidth-3-this.graph.panDx,q)],this.guideY.node.style.visibility="visible",this.guideY.redraw()):this.guideY.node.style.visibility="hidden";b=new mxPoint(f,g)}return b};mxGuide.prototype.hide=function(){null!=this.guideX&&(this.guideX.node.style.visibility="hidden");null!=this.guideY&&(this.guideY.node.style.visibility="hidden")};mxGuide.prototype.destroy=function(){null!=this.guideX&&(this.guideX.destroy(),this.guideX=null);null!=this.guideY&&(this.guideY.destroy(),this.guideY=null)};function mxStencil(a){this.desc=a;this.parseDescription();this.parseConstraints()}mxStencil.defaultLocalized=!1;mxStencil.allowEval=!1;mxStencil.prototype.desc=null;mxStencil.prototype.constraints=null;mxStencil.prototype.aspect=null;mxStencil.prototype.w0=null;mxStencil.prototype.h0=null;mxStencil.prototype.bgNode=null;mxStencil.prototype.fgNode=null;mxStencil.prototype.strokewidth=null;mxStencil.prototype.parseDescription=function(){this.fgNode=this.desc.getElementsByTagName("foreground")[0];this.bgNode=this.desc.getElementsByTagName("background")[0];this.w0=Number(this.desc.getAttribute("w")||100);this.h0=Number(this.desc.getAttribute("h")||100);var a=this.desc.getAttribute("aspect");this.aspect=null!=a?a:"variable";a=this.desc.getAttribute("strokewidth");this.strokewidth=null!=a?a:"1"};mxStencil.prototype.parseConstraints=function(){var a=this.desc.getElementsByTagName("connections")[0];if(null!=a&&(a=mxUtils.getChildNodes(a),null!=a&&0<a.length)){this.constraints=[];for(var b=0;b<a.length;b++)this.constraints.push(this.parseConstraint(a[b]))}};mxStencil.prototype.parseConstraint=function(a){var b=Number(a.getAttribute("x")),c=Number(a.getAttribute("y"));a="1"==a.getAttribute("perimeter");return new mxConnectionConstraint(new mxPoint(b,c),a)};mxStencil.prototype.evaluateTextAttribute=function(a,b,c){b=this.evaluateAttribute(a,b,c);a=a.getAttribute("localized");if(mxStencil.defaultLocalized&&null==a||"1"==a)b=mxResources.get(b);return b};mxStencil.prototype.evaluateAttribute=function(a,b,c){b=a.getAttribute(b);null==b&&(a=mxUtils.getTextContent(a),null!=a&&mxStencil.allowEval&&(a=mxUtils.eval(a),"function"==typeof a&&(b=a(c))));return b};mxStencil.prototype.drawShape=function(a,b,c,d,e,f){this.drawChildren(a,b,c,d,e,f,this.bgNode,!1);this.drawChildren(a,b,c,d,e,f,this.fgNode,!0)};mxStencil.prototype.drawChildren=function(a,b,c,d,e,f,g,k){if(null!=g&&0<e&&0<f){var l=mxUtils.getValue(b.style,mxConstants.STYLE_DIRECTION,null);c=this.computeAspect(b.style,c,d,e,f,l);d=Math.min(c.width,c.height);d="inherit"==this.strokewidth?Number(mxUtils.getNumber(b.style,mxConstants.STYLE_STROKEWIDTH,1)):Number(this.strokewidth)*d;a.setStrokeWidth(d);for(g=g.firstChild;null!=g;)g.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(a,b,g,c,k),g=g.nextSibling}};mxStencil.prototype.computeAspect=function(a,b,c,d,e,f){a=b;b=d/this.w0;var g=e/this.h0;if(f=f==mxConstants.DIRECTION_NORTH||f==mxConstants.DIRECTION_SOUTH){g=d/this.h0;b=e/this.w0;var k=(d-e)/2;a+=k;c-=k}"fixed"==this.aspect&&(b=g=Math.min(b,g),f?(a+=(e-this.w0*b)/2,c+=(d-this.h0*g)/2):(a+=(d-this.w0*b)/2,c+=(e-this.h0*g)/2));return new mxRectangle(a,c,b,g)};
mxStencil.prototype.drawNode=function(a,b,c,d,e){var f=c.nodeName,g=d.x,k=d.y,l=d.width,m=d.height,n=Math.min(l,m);if("save"==f)a.save();else if("restore"==f)a.restore();else if("path"==f)for(a.begin(),c=c.firstChild;null!=c;)c.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(a,b,c,d,e),c=c.nextSibling;else if("close"==f)a.close();else if("move"==f)a.moveTo(g+Number(c.getAttribute("x"))*l,k+Number(c.getAttribute("y"))*m);else if("line"==f)a.lineTo(g+Number(c.getAttribute("x"))*l,k+Number(c.getAttribute("y"))*m);else if("quad"==f)a.quadTo(g+Number(c.getAttribute("x1"))*l,k+Number(c.getAttribute("y1"))*m,g+Number(c.getAttribute("x2"))*l,k+Number(c.getAttribute("y2"))*m);else if("curve"==f)a.curveTo(g+Number(c.getAttribute("x1"))*l,k+Number(c.getAttribute("y1"))*m,g+Number(c.getAttribute("x2"))*l,k+Number(c.getAttribute("y2"))*m,g+Number(c.getAttribute("x3"))*l,k+Number(c.getAttribute("y3"))*m);else if("arc"==f)a.arcTo(Number(c.getAttribute("rx"))*l,Number(c.getAttribute("ry"))*m,Number(c.getAttribute("x-axis-rotation")),Number(c.getAttribute("large-arc-flag")),Number(c.getAttribute("sweep-flag")),g+Number(c.getAttribute("x"))*l,k+Number(c.getAttribute("y"))*m);else if("rect"==f)a.rect(g+Number(c.getAttribute("x"))*l,k+Number(c.getAttribute("y"))*m,Number(c.getAttribute("w"))*l,Number(c.getAttribute("h"))*m);else if("roundrect"==f)b=Number(c.getAttribute("arcsize")),0==b&&(b=100*mxConstants.RECTANGLE_ROUNDING_FACTOR),n=Number(c.getAttribute("w"))*l,d=Number(c.getAttribute("h"))*m,b=Number(b)/100,b=Math.min(n*b,d*
b),a.roundrect(g+Number(c.getAttribute("x"))*l,k+Number(c.getAttribute("y"))*m,n,d,b,b);else if("ellipse"==f)a.ellipse(g+Number(c.getAttribute("x"))*l,k+Number(c.getAttribute("y"))*m,Number(c.getAttribute("w"))*l,Number(c.getAttribute("h"))*m);else if("image"==f)b.outline||(b=this.evaluateAttribute(c,"src",b),a.image(g+Number(c.getAttribute("x"))*l,k+Number(c.getAttribute("y"))*m,Number(c.getAttribute("w"))*l,Number(c.getAttribute("h"))*m,b,!1,"1"==c.getAttribute("flipH"),"1"==c.getAttribute("flipV")));else if("text"==f){if(!b.outline){n=this.evaluateTextAttribute(c,"str",b);d="1"==c.getAttribute("vertical")?-90:0;if("0"==c.getAttribute("align-shape")){var p=b.rotation,q=1==mxUtils.getValue(b.style,mxConstants.STYLE_FLIPH,0);b=1==mxUtils.getValue(b.style,mxConstants.STYLE_FLIPV,0);d=q&&b?d-p:q||b?d+p:d-p}d-=c.getAttribute("rotation");a.text(g+Number(c.getAttribute("x"))*l,k+Number(c.getAttribute("y"))*m,0,0,n,c.getAttribute("align")||"left",c.getAttribute("valign")||"top",!1,"",null,!1,d)}}else if("include-shape"==f)p=mxStencilRegistry.getStencil(c.getAttribute("name")),null!=p&&(g+=Number(c.getAttribute("x"))*l,k+=Number(c.getAttribute("y"))*m,n=Number(c.getAttribute("w"))*l,d=Number(c.getAttribute("h"))*m,p.drawShape(a,b,g,k,n,d));else if("fillstroke"==f)a.fillAndStroke();else if("fill"==f)a.fill();else if("stroke"==f)a.stroke();else if("strokewidth"==f)l="1"==c.getAttribute("fixed")?1:n,a.setStrokeWidth(Number(c.getAttribute("width"))*l);else if("dashed"==f)a.setDashed("1"==c.getAttribute("dashed"));else if("dashpattern"==f){if(c=c.getAttribute("pattern"),null!=c){c=c.split(" ");l=[];for(m=0;m<c.length;m++)0<c[m].length&&l.push(Number(c[m])*n);c=l.join(" ");a.setDashPattern(c)}}else"strokecolor"==f?a.setStrokeColor(c.getAttribute("color")):"linecap"==f?a.setLineCap(c.getAttribute("cap")):"linejoin"==f?a.setLineJoin(c.getAttribute("join")):"miterlimit"==f?a.setMiterLimit(Number(c.getAttribute("limit"))):"fillcolor"==f?a.setFillColor(c.getAttribute("color")):"alpha"==f?a.setAlpha(c.getAttribute("alpha")):"fontcolor"==f?a.setFontColor(c.getAttribute("color")):"fontstyle"==f?a.setFontStyle(c.getAttribute("style")):"fontfamily"==f?a.setFontFamily(c.getAttribute("family")):"fontsize"==f&&a.setFontSize(Number(c.getAttribute("size"))*n);e&&("fillstroke"==f||"fill"==f||"stroke"==f)&&a.setShadow(!1)};function mxShape(a){this.stencil=a;this.strokewidth=1;this.rotation=0;this.opacity=100;this.flipV=this.flipH=!1}mxShape.prototype.dialect=null;mxShape.prototype.scale=1;mxShape.prototype.antiAlias=!0;mxShape.prototype.bounds=null;mxShape.prototype.points=null;mxShape.prototype.node=null;mxShape.prototype.state=null;mxShape.prototype.style=null;mxShape.prototype.boundingBox=null;mxShape.prototype.stencil=null;mxShape.prototype.svgStrokeTolerance=8;mxShape.prototype.pointerEvents=!0;mxShape.prototype.svgPointerEvents="all";mxShape.prototype.shapePointerEvents=!1;mxShape.prototype.stencilPointerEvents=!1;mxShape.prototype.vmlScale=1;mxShape.prototype.outline=!1;mxShape.prototype.visible=!0;mxShape.prototype.init=function(a){null==this.node&&(this.node=this.create(a),null!=a&&a.appendChild(this.node))};mxShape.prototype.isParseVml=function(){return!0};mxShape.prototype.isHtmlAllowed=function(){return!1};mxShape.prototype.getSvgScreenOffset=function(){return 1==mxUtils.mod(Math.max(1,Math.round((this.stencil&&"inherit"!=this.stencil.strokewidth?Number(this.stencil.strokewidth):this.strokewidth)*this.scale)),2)?0.5:0};mxShape.prototype.create=function(a){return null!=a&&null!=a.ownerSVGElement?this.createSvg(a):8==document.documentMode||!mxClient.IS_VML||this.dialect!=mxConstants.DIALECT_VML&&this.isHtmlAllowed()?this.createHtml(a):this.createVml(a)};mxShape.prototype.createSvg=function(){return document.createElementNS(mxConstants.NS_SVG,"g")};mxShape.prototype.createVml=function(){var a=document.createElement(mxClient.VML_PREFIX+":group");a.style.position="absolute";return a};mxShape.prototype.createHtml=function(){var a=document.createElement("div");a.style.position="absolute";return a};mxShape.prototype.reconfigure=function(){this.redraw()};mxShape.prototype.redraw=function(){this.updateBoundsFromPoints();this.visible&&this.checkBounds()?(this.node.style.visibility="visible",this.clear(),"DIV"!=this.node.nodeName||!this.isHtmlAllowed()&&mxClient.IS_VML?this.redrawShape():this.redrawHtmlShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)};mxShape.prototype.clear=function(){if(null!=this.node.ownerSVGElement)for(;null!=this.node.lastChild;)this.node.removeChild(this.node.lastChild);else this.node.style.cssText="position:absolute;"+(null!=this.cursor?"cursor:"+this.cursor+";":""),this.node.innerHTML=""};mxShape.prototype.updateBoundsFromPoints=function(){var a=this.points;if(null!=a&&0<a.length&&null!=a[0]){this.bounds=new mxRectangle(Number(a[0].x),Number(a[0].y),1,1);for(var b=1;b<this.points.length;b++)null!=a[b]&&this.bounds.add(new mxRectangle(Number(a[b].x),Number(a[b].y),1,1))}};mxShape.prototype.getLabelBounds=function(a){return a};mxShape.prototype.checkBounds=function(){return null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)&&0<this.bounds.width&&0<this.bounds.height};mxShape.prototype.createVmlGroup=function(){var a=document.createElement(mxClient.VML_PREFIX+":group");a.style.position="absolute";a.style.width=this.node.style.width;a.style.height=this.node.style.height;return a};mxShape.prototype.redrawShape=function(){var a=this.createCanvas();null!=a&&(a.pointerEvents=this.pointerEvents,this.paint(a),this.node!=a.root&&this.node.insertAdjacentHTML("beforeend",a.root.outerHTML),"DIV"==this.node.nodeName&&8==document.documentMode&&(this.node.style.filter="",mxUtils.addTransparentBackgroundFilter(this.node)),this.destroyCanvas(a))};mxShape.prototype.createCanvas=function(){var a=null;null!=this.node.ownerSVGElement?a=this.createSvgCanvas():mxClient.IS_VML&&(this.updateVmlContainer(),a=this.createVmlCanvas());this.outline&&(a.setStrokeWidth(this.strokewidth),a.setStrokeColor(this.stroke),null!=this.isDashed&&a.setDashed(this.isDashed),a.setStrokeWidth=function(){},a.setStrokeColor=function(){},a.setFillColor=function(){},a.setGradient=function(){},a.setDashed=function(){});return a};mxShape.prototype.createSvgCanvas=function(){var a=new mxSvgCanvas2D(this.node,!1);a.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0;a.pointerEventsValue=this.svgPointerEvents;a.blockImagePointerEvents=mxClient.IS_FF;var b=this.getSvgScreenOffset();0!=b?this.node.setAttribute("transform","translate("+b+","+b+")"):this.node.removeAttribute("transform");this.antiAlias||(a.format=function(a){return Math.round(parseFloat(a))});return a};mxShape.prototype.createVmlCanvas=function(){var a=8==document.documentMode&&this.isParseVml()?this.createVmlGroup():this.node,b=new mxVmlCanvas2D(a,!1);if(""!=a.tagUrn){var c=Math.max(1,Math.round(this.bounds.width)),d=Math.max(1,Math.round(this.bounds.height));a.coordsize=c*this.vmlScale+","+d*this.vmlScale;b.scale(this.vmlScale);b.vmlScale=this.vmlScale}a=this.scale;b.translate(-Math.round(this.bounds.x/a),-Math.round(this.bounds.y/a));return b};mxShape.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";var a=Math.max(1,Math.round(this.bounds.width)),b=Math.max(1,Math.round(this.bounds.height));this.node.style.width=a+"px";this.node.style.height=b+"px";this.node.style.overflow="visible"};mxShape.prototype.redrawHtmlShape=function(){this.updateHtmlBounds(this.node);this.updateHtmlFilters(this.node);this.updateHtmlColors(this.node)};mxShape.prototype.updateHtmlFilters=function(a){var b="";100>this.opacity&&(b+="alpha(opacity="+this.opacity+")");this.isShadow&&(b+="progid:DXImageTransform.Microsoft.dropShadow (OffX='"+Math.round(mxConstants.SHADOW_OFFSET_X*this.scale)+"', OffY='"+Math.round(mxConstants.SHADOW_OFFSET_Y*this.scale)+"', Color='"+mxConstants.SHADOWCOLOR+"')");if(null!=this.fill&&this.fill!=mxConstants.NONE&&this.gradient&&this.gradient!=mxConstants.NONE){var c=this.fill,d=this.gradient,e="0",f={east:0,south:1,west:2,north:3},g=null!=this.direction?f[this.direction]:0;null!=this.gradientDirection&&(g=mxUtils.mod(g+f[this.gradientDirection]-1,4));1==g?(e="1",f=c,c=d,d=f):2==g?(f=c,c=d,d=f):3==g&&(e="1");b+="progid:DXImageTransform.Microsoft.gradient(startColorStr='"+c+"', endColorStr='"+d+"', gradientType='"+e+"')"}a.style.filter=b};mxShape.prototype.updateHtmlColors=function(a){var b=this.stroke;null!=b&&b!=mxConstants.NONE?(a.style.borderColor=b,this.isDashed?a.style.borderStyle="dashed":0<this.strokewidth&&(a.style.borderStyle="solid"),a.style.borderWidth=Math.max(1,Math.ceil(this.strokewidth*this.scale))+"px"):a.style.borderWidth="0px";b=this.outline?null:this.fill;null!=b&&b!=mxConstants.NONE?(a.style.backgroundColor=b,a.style.backgroundImage="none"):this.pointerEvents?a.style.backgroundColor="transparent":8==document.documentMode?mxUtils.addTransparentBackgroundFilter(a):this.setTransparentBackgroundImage(a)};mxShape.prototype.updateHtmlBounds=function(a){var b=9<=document.documentMode?0:Math.ceil(this.strokewidth*this.scale);a.style.borderWidth=Math.max(1,b)+"px";a.style.overflow="hidden";a.style.left=Math.round(this.bounds.x-b/2)+"px";a.style.top=Math.round(this.bounds.y-b/2)+"px";"CSS1Compat"==document.compatMode&&(b=-b);a.style.width=Math.round(Math.max(0,this.bounds.width+b))+"px";a.style.height=Math.round(Math.max(0,this.bounds.height+b))+"px"};mxShape.prototype.destroyCanvas=function(a){if(a instanceof mxSvgCanvas2D){for(var b in a.gradients){var c=a.gradients[b];null!=c&&(c.mxRefCount=(c.mxRefCount||0)+1)}this.releaseSvgGradients(this.oldGradients);this.oldGradients=a.gradients}};mxShape.prototype.paint=function(a){var b=this.scale,c=this.bounds.x/b,d=this.bounds.y/b,e=this.bounds.width/b,f=this.bounds.height/b;if(this.isPaintBoundsInverted())var g=(e-f)/2,c=c+g,d=d-g,g=e,e=f,f=g;this.updateTransform(a,c,d,e,f);this.configureCanvas(a,c,d,e,f);g=null;if(null==this.stencil&&null==this.points&&this.shapePointerEvents||null!=this.stencil&&this.stencilPointerEvents){var k=this.createBoundingBox();this.dialect==mxConstants.DIALECT_SVG?(g=this.createTransparentSvgRectangle(k.x,k.y,
k.width,k.height),this.node.appendChild(g)):(k=a.createRect("rect",k.x/b,k.y/b,k.width/b,k.height/b),k.appendChild(a.createTransparentFill()),k.stroked="false",a.root.appendChild(k))}if(null!=this.stencil)this.stencil.drawShape(a,this,c,d,e,f);else if(a.setStrokeWidth(this.strokewidth),null!=this.points){c=[];for(d=0;d<this.points.length;d++)null!=this.points[d]&&c.push(new mxPoint(this.points[d].x/b,this.points[d].y/b));this.paintEdgeShape(a,c)}else this.paintVertexShape(a,c,d,e,f);null!=g&&null!=a.state&&null!=a.state.transform&&g.setAttribute("transform",a.state.transform)};mxShape.prototype.configureCanvas=function(a,b,c,d,e){var f=null;null!=this.style&&(f=this.style.dashPattern);a.setAlpha(this.opacity/100);null!=this.isShadow&&a.setShadow(this.isShadow);null!=this.isDashed&&a.setDashed(this.isDashed);null!=f&&a.setDashPattern(f);null!=this.fill&&this.fill!=mxConstants.NONE&&this.gradient&&this.gradient!=mxConstants.NONE?(b=this.getGradientBounds(a,b,c,d,e),a.setGradient(this.fill,this.gradient,b.x,b.y,b.width,b.height,this.gradientDirection)):a.setFillColor(this.fill);a.setStrokeColor(this.stroke)};mxShape.prototype.getGradientBounds=function(a,b,c,d,e){return new mxRectangle(b,c,d,e)};mxShape.prototype.updateTransform=function(a,b,c,d,e){a.scale(this.scale);a.rotate(this.getShapeRotation(),this.flipH,this.flipV,b+d/2,c+e/2)};mxShape.prototype.paintVertexShape=function(a,b,c,d,e){this.paintBackground(a,b,c,d,e);a.setShadow(!1);this.paintForeground(a,b,c,d,e)};mxShape.prototype.paintBackground=function(a,b,c,d,e){};mxShape.prototype.paintForeground=function(a,b,c,d,e){};mxShape.prototype.paintEdgeShape=function(a,b){};mxShape.prototype.getArcSize=function(a,b){var c=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100;return Math.min(a*c,b*c)};
mxShape.prototype.paintGlassEffect=function(a,b,c,d,e,f){var g=Math.ceil(this.strokewidth/2);a.setGradient("#ffffff","#ffffff",b,c,d,0.6*e,"south",0.9,0.1);a.begin();f+=2*g;this.isRounded?(a.moveTo(b-g+f,c-g),a.quadTo(b-g,c-g,b-g,c-g+f),a.lineTo(b-g,c+0.4*e),a.quadTo(b+0.5*d,c+0.7*e,b+d+g,c+0.4*e),a.lineTo(b+d+g,c-g+f),a.quadTo(b+d+g,c-g,b+d+g-f,c-g)):(a.moveTo(b-g,c-g),a.lineTo(b-g,c+0.4*e),a.quadTo(b+0.5*d,c+0.7*e,b+d+g,c+0.4*e),a.lineTo(b+d+g,c-g));a.close();a.fill()};mxShape.prototype.addPoints=function(a,b,c,d,e){var f=b[b.length-1];if(e&&c){b=b.slice();var g=b[0],g=new mxPoint(f.x+(g.x-f.x)/2,f.y+(g.y-f.y)/2);b.splice(0,0,g)}var k=b[0],g=1;for(a.moveTo(k.x,k.y);g<(e?b.length:b.length-1);){var l=b[mxUtils.mod(g,b.length)],m=k.x-l.x,k=k.y-l.y;if(!c||0==m&&0==k)a.lineTo(l.x,l.y);else{var n=Math.sqrt(m*m+k*k),m=m*Math.min(d,n/2)/n,k=k*Math.min(d,n/2)/n;a.lineTo(l.x+m,l.y+k);for(k=b[mxUtils.mod(g+1,b.length)];g<b.length-2&&0==Math.round(k.x-l.x)&&0==Math.round(k.y-
l.y);)k=b[mxUtils.mod(g+2,b.length)],g++;m=k.x-l.x;k=k.y-l.y;n=Math.max(1,Math.sqrt(m*m+k*k));m=m*Math.min(d,n/2)/n;k=k*Math.min(d,n/2)/n;m=l.x+m;k=l.y+k;a.quadTo(l.x,l.y,m,k);l=new mxPoint(m,k)}k=l;g++}e?a.close():a.lineTo(f.x,f.y)};
mxShape.prototype.apply=function(a){this.state=a;this.style=a.style;if(null!=this.style){this.fill=mxUtils.getValue(this.style,mxConstants.STYLE_FILLCOLOR,this.fill);this.gradient=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENTCOLOR,this.gradient);this.gradientDirection=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENT_DIRECTION,this.gradientDirection);this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_OPACITY,this.opacity);this.stroke=mxUtils.getValue(this.style,mxConstants.STYLE_STROKECOLOR,this.stroke);this.strokewidth=mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth);this.arrowStrokewidth=mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth);this.spacing=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing);this.startSize=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,this.startSize);this.endSize=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,this.endSize);this.startArrow=mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,this.startArrow);this.endArrow=mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,this.endArrow);this.rotation=mxUtils.getValue(this.style,mxConstants.STYLE_ROTATION,this.rotation);this.direction=mxUtils.getValue(this.style,mxConstants.STYLE_DIRECTION,this.direction);this.flipH=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0);this.flipV=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0);null!=this.stencil&&(this.flipH=1==mxUtils.getValue(this.style,"stencilFlipH",0)||this.flipH,this.flipV=1==mxUtils.getValue(this.style,"stencilFlipV",0)||this.flipV);if(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)a=this.flipH,this.flipH=this.flipV,this.flipV=a;this.isShadow=1==mxUtils.getValue(this.style,mxConstants.STYLE_SHADOW,this.isShadow);this.isDashed=1==mxUtils.getValue(this.style,mxConstants.STYLE_DASHED,this.isDashed);this.isRounded=1==mxUtils.getValue(this.style,mxConstants.STYLE_ROUNDED,this.isRounded);this.glass=1==mxUtils.getValue(this.style,mxConstants.STYLE_GLASS,this.glass);this.fill==mxConstants.NONE&&(this.fill=null);this.gradient==mxConstants.NONE&&(this.gradient=null);this.stroke==mxConstants.NONE&&(this.stroke=null)}};mxShape.prototype.setCursor=function(a){null==a&&(a="");this.cursor=a;null!=this.node&&(this.node.style.cursor=a)};mxShape.prototype.getCursor=function(){return this.cursor};mxShape.prototype.updateBoundingBox=function(){if(null!=this.bounds){var a=this.createBoundingBox();if(null!=a){this.augmentBoundingBox(a);var b=this.getShapeRotation();0!=b&&(a=mxUtils.getBoundingBox(a,b))}this.boundingBox=a}};mxShape.prototype.createBoundingBox=function(){var a=this.bounds.clone();(null!=this.stencil&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)||this.isPaintBoundsInverted())&&a.rotate90();return a};mxShape.prototype.augmentBoundingBox=function(a){this.isShadow&&(a.width+=Math.ceil(mxConstants.SHADOW_OFFSET_X*this.scale),a.height+=Math.ceil(mxConstants.SHADOW_OFFSET_Y*this.scale));a.grow(this.strokewidth*this.scale/2)};mxShape.prototype.isPaintBoundsInverted=function(){return null==this.stencil&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)};mxShape.prototype.getRotation=function(){return null!=this.rotation?this.rotation:0};mxShape.prototype.getTextRotation=function(){var a=this.getRotation();1!=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)&&(a+=mxText.prototype.verticalTextRotation);return a};mxShape.prototype.getShapeRotation=function(){var a=this.getRotation();null!=this.direction&&(this.direction==mxConstants.DIRECTION_NORTH?a+=270:this.direction==mxConstants.DIRECTION_WEST?a+=180:this.direction==mxConstants.DIRECTION_SOUTH&&(a+=90));return a};mxShape.prototype.createTransparentSvgRectangle=function(a,b,c,d){var e=document.createElementNS(mxConstants.NS_SVG,"rect");e.setAttribute("x",a);e.setAttribute("y",b);e.setAttribute("width",c);e.setAttribute("height",d);e.setAttribute("fill","none");e.setAttribute("stroke","none");e.setAttribute("pointer-events","all");return e};mxShape.prototype.setTransparentBackgroundImage=function(a){a.style.backgroundImage="url('"+mxClient.imageBasePath+"/transparent.gif')"};mxShape.prototype.releaseSvgGradients=function(a){if(null!=a)for(var b in a){var c=a[b];null!=c&&(c.mxRefCount=(c.mxRefCount||0)-1,0==c.mxRefCount&&null!=c.parentNode&&c.parentNode.removeChild(c))}};mxShape.prototype.destroy=function(){null!=this.node&&(mxEvent.release(this.node),null!=this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node=null);this.releaseSvgGradients(this.oldGradients);this.oldGradients=null};var mxStencilRegistry={stencils:[],addStencil:function(a,b){mxStencilRegistry.stencils[a]=b},getStencil:function(a){return mxStencilRegistry.stencils[a]}},mxMarker={markers:[],addMarker:function(a,b){mxMarker.markers[a]=b},createMarker:function(a,b,c,d,e,f,g,k,l,m){var n=mxMarker.markers[c];return null!=n?n(a,b,c,d,e,f,g,k,l,m):null}};(function(){function a(a,b,e,f,g,k,l,m,n,p){b=1.118*g*n;m=1.118*k*n;g*=l+n;k*=l+n;var q=f.clone();q.x-=b;q.y-=m;l=e!=mxConstants.ARROW_CLASSIC?1:0.75;f.x+=-g*l-b;f.y+=-k*l-m;return function(){a.begin();a.moveTo(q.x,q.y);a.lineTo(q.x-g-k/2,q.y-k+g/2);e==mxConstants.ARROW_CLASSIC&&a.lineTo(q.x-3*g/4,q.y-3*k/4);a.lineTo(q.x+k/2-g,q.y-k-g/2);a.close();p?a.fillAndStroke():a.stroke()}}function b(a,b,e,f,g,k,l,m,n,p){m=e==mxConstants.ARROW_DIAMOND?0.7071:0.9862;b=g*n*m;m=m*k*n;g*=l+n;k*=l+n;var q=f.clone();q.x-=b;q.y-=m;f.x+=-g-b;f.y+=-k-m;var u=e==mxConstants.ARROW_DIAMOND?2:3.4;return function(){a.begin();a.moveTo(q.x,q.y);a.lineTo(q.x-g/2-k/u,q.y+g/u-k/2);a.lineTo(q.x-g,q.y-k);a.lineTo(q.x-g/2+k/u,q.y-k/2-g/u);a.close();p?a.fillAndStroke():a.stroke()}}mxMarker.addMarker("classic",a);mxMarker.addMarker("block",a);mxMarker.addMarker("open",function(a,b,e,f,g,k,l,m,n,p){b=1.118*g*n;e=1.118*k*n;g*=l+n;k*=l+n;var q=f.clone();q.x-=b;q.y-=e;f.x+=2*-b;f.y+=2*-e;return function(){a.begin();a.moveTo(q.x-g-
k/2,q.y-k+g/2);a.lineTo(q.x,q.y);a.lineTo(q.x+k/2-g,q.y-k-g/2);a.stroke()}});mxMarker.addMarker("oval",function(a,b,e,f,g,k,l,m,n,p){var q=l/2,u=f.clone();f.x-=g*q;f.y-=k*q;return function(){a.ellipse(u.x-q,u.y-q,l,l);p?a.fillAndStroke():a.stroke()}});mxMarker.addMarker("diamond",b);mxMarker.addMarker("diamondThin",b)})();function mxActor(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxActor,mxShape);mxActor.prototype.paintVertexShape=function(a,b,c,d,e){a.translate(b,c);a.begin();this.redrawPath(a,b,c,d,e);a.fillAndStroke()};mxActor.prototype.redrawPath=function(a,b,c,d,e){b=d/3;a.moveTo(0,e);a.curveTo(0,3*e/5,0,2*e/5,d/2,2*e/5);a.curveTo(d/2-b,2*e/5,d/2-b,0,d/2,0);a.curveTo(d/2+b,0,d/2+b,2*e/5,d/2,2*e/5);a.curveTo(d,2*e/5,d,3*e/5,d,e);a.close()};function mxCloud(a,b,c,d){mxActor.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxCloud,mxActor);mxCloud.prototype.redrawPath=function(a,b,c,d,e){a.moveTo(0.25*d,0.25*e);a.curveTo(0.05*d,0.25*e,0,0.5*e,0.16*d,0.55*e);a.curveTo(0,0.66*e,0.18*d,0.9*e,0.31*d,0.8*e);a.curveTo(0.4*d,e,0.7*d,e,0.8*d,0.8*e);a.curveTo(d,0.8*e,d,0.6*e,0.875*d,0.5*e);a.curveTo(d,0.3*e,0.8*d,0.1*e,0.625*d,0.2*e);a.curveTo(0.5*d,0.05*e,0.3*d,0.05*e,0.25*d,0.25*e);a.close()};function mxRectangleShape(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}
mxUtils.extend(mxRectangleShape,mxShape);mxRectangleShape.prototype.isHtmlAllowed=function(){var a=!0;null!=this.style&&(a="1"==mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1"));return!this.isRounded&&!this.glass&&0==this.rotation&&(a||null!=this.fill&&this.fill!=mxConstants.NONE)};mxRectangleShape.prototype.paintBackground=function(a,b,c,d,e){var f=!0;null!=this.style&&(f="1"==mxUtils.getValue(this.style,mxConstants.STYLE_POINTER_EVENTS,"1"));if(f||null!=this.fill&&this.fill!=mxConstants.NONE||null!=this.stroke&&this.stroke!=mxConstants.NONE)f||null!=this.fill&&this.fill!=mxConstants.NONE||(a.pointerEvents=!1),this.isRounded?(f=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100,f=Math.min(d*f,e*f),a.roundrect(b,c,d,e,f,f)):
a.rect(b,c,d,e),a.fillAndStroke()};mxRectangleShape.prototype.paintForeground=function(a,b,c,d,e){this.glass&&!this.outline&&null!=this.fill&&this.fill!=mxConstants.NONE&&this.paintGlassEffect(a,b,c,d,e,this.getArcSize(d+this.strokewidth,e+this.strokewidth))};function mxEllipse(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxEllipse,mxShape);mxEllipse.prototype.paintVertexShape=function(a,b,c,d,e){a.ellipse(b,c,d,e);a.fillAndStroke()};function mxDoubleEllipse(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxDoubleEllipse,mxShape);mxDoubleEllipse.prototype.vmlScale=10;mxDoubleEllipse.prototype.paintBackground=function(a,b,c,d,e){a.ellipse(b,c,d,e);a.fillAndStroke()};mxDoubleEllipse.prototype.paintForeground=function(a,b,c,d,e){if(!this.outline){var f=mxUtils.getValue(this.style,mxConstants.STYLE_MARGIN,Math.min(3+this.strokewidth,Math.min(d/5,e/5)));d-=2*f;e-=2*f;0<d&&0<e&&a.ellipse(b+f,c+f,d,e);a.stroke()}};mxDoubleEllipse.prototype.getLabelBounds=function(a){var b=mxUtils.getValue(this.style,mxConstants.STYLE_MARGIN,Math.min(3+this.strokewidth,Math.min(a.width/5/this.scale,a.height/5/this.scale)))*this.scale;return new mxRectangle(a.x+b,a.y+b,a.width-2*b,a.height-2*b)};function mxRhombus(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxRhombus,mxShape);mxRhombus.prototype.paintVertexShape=function(a,b,c,d,e){var f=d/2,g=e/2,k=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;a.begin();this.addPoints(a,[new mxPoint(b+f,c),new mxPoint(b+d,c+g),new mxPoint(b+f,c+e),new mxPoint(b,c+g)],this.isRounded,k,!0);a.fillAndStroke()};function mxPolyline(a,b,c){mxShape.call(this);this.points=a;this.stroke=b;this.strokewidth=null!=c?c:1}mxUtils.extend(mxPolyline,mxShape);mxPolyline.prototype.getRotation=function(){return 0};
mxPolyline.prototype.getShapeRotation=function(){return 0};mxPolyline.prototype.isPaintBoundsInverted=function(){return!1};mxPolyline.prototype.paintEdgeShape=function(a,b){null==this.style||1!=this.style[mxConstants.STYLE_CURVED]?this.paintLine(a,b,this.isRounded):this.paintCurvedLine(a,b)};mxPolyline.prototype.paintLine=function(a,b,c){var d=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;a.begin();this.addPoints(a,b,c,d,!1);a.stroke()};
mxPolyline.prototype.paintCurvedLine=function(a,b){a.begin();var c=b[0],d=b.length;a.moveTo(c.x,c.y);for(c=1;c<d-2;c++){var e=b[c],f=b[c+1];a.quadTo(e.x,e.y,(e.x+f.x)/2,(e.y+f.y)/2)}e=b[d-2];f=b[d-1];a.quadTo(e.x,e.y,f.x,f.y);a.stroke()};
function mxArrow(a,b,c,d,e,f,g){mxShape.call(this);this.points=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1;this.arrowWidth=null!=e?e:mxConstants.ARROW_WIDTH;this.spacing=null!=f?f:mxConstants.ARROW_SPACING;this.endSize=null!=g?g:mxConstants.ARROW_SIZE}mxUtils.extend(mxArrow,mxShape);mxArrow.prototype.augmentBoundingBox=function(a){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var b=Math.max(this.arrowWidth,this.endSize);a.grow((b/2+this.strokewidth)*this.scale)};mxArrow.prototype.paintEdgeShape=function(a,b){var c=mxConstants.ARROW_SPACING,d=mxConstants.ARROW_WIDTH,e=mxConstants.ARROW_SIZE,f=b[0],g=b[b.length-1],k=g.x-f.x,l=g.y-f.y,m=Math.sqrt(k*k+l*l),n=m-2*c-e,k=k/m,l=l/m,m=d*l/3,d=-d*k/3,e=f.x-m/2+c*k,f=f.y-d/2+c*l,p=e+m,q=f+d,u=p+n*k,n=q+n*l,v=u+m,y=n+d,z=v-3*m,x=y-3*d;a.begin();a.moveTo(e,f);a.lineTo(p,q);a.lineTo(u,n);a.lineTo(v,y);a.lineTo(g.x-c*k,g.y-c*l);a.lineTo(z,x);a.lineTo(z+m,x+d);a.close();a.fillAndStroke()};function mxArrowConnector(a,b,c,d,e,f,g){mxShape.call(this);this.points=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1;this.arrowWidth=null!=e?e:mxConstants.ARROW_WIDTH;this.spacing=null!=f?f:mxConstants.ARROW_SPACING;this.startSize=mxConstants.ARROW_SIZE/5;this.endSize=mxConstants.ARROW_SIZE/5}mxUtils.extend(mxArrowConnector,mxShape);mxArrowConnector.prototype.apply=function(a){mxShape.prototype.apply.apply(this,arguments);null!=this.style&&(this.startSize=3*mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.ARROW_SIZE/5),this.endSize=3*mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.ARROW_SIZE/5))};mxArrowConnector.prototype.augmentBoundingBox=function(a){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var b=this.getEdgeWidth();this.isMarkerStart()&&(b=Math.max(b,this.getStartArrowWidth()));this.isMarkerEnd()&&(b=Math.max(b,this.getEndArrowWidth()));a.grow((b/2+this.strokewidth)*this.scale)};mxArrowConnector.prototype.paintEdgeShape=function(a,b){var c=this.strokewidth;this.outline&&(c=Math.max(1,mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth)));for(var d=this.getStartArrowWidth()+c,e=this.getEndArrowWidth()+c,f=this.outline?this.getEdgeWidth()+c:this.getEdgeWidth(),g=this.isOpenEnded(),k=this.isMarkerStart(),l=this.isMarkerEnd(),m=g?0:this.spacing+c/2,n=this.startSize+c,c=this.endSize+c,p=this.isArrowRounded(),q=b[b.length-1],u=1;u<b.length-1&&b[u].x==b[0].x&&b[u].y==b[0].y;)u++;var v=b[u].x-b[0].x,u=b[u].y-b[0].y,y=Math.sqrt(v*v+u*u);if(0!=y){var z=v/y,x,B=z,A=u/y,D,E=A,y=f*A,G=-f*z,C=[];p?a.setLineJoin("round"):2<b.length&&a.setMiterLimit(1.42);a.begin();v=z;u=A;if(k&&!g)this.paintMarker(a,b[0].x,b[0].y,z,A,n,d,f,m,!0);else{x=b[0].x+y/2+m*z;D=b[0].y+G/2+m*A;var F=b[0].x-y/2+m*z,I=b[0].y-G/2+m*A;g?(a.moveTo(x,D),C.push(function(){a.lineTo(F,I)})):(a.moveTo(F,I),a.lineTo(x,D))}for(var H=D=x=0,y=0;y<b.length-2;y++){G=mxUtils.relativeCcw(b[y].x,b[y].y,b[y+
1].x,b[y+1].y,b[y+2].x,b[y+2].y);x=b[y+2].x-b[y+1].x;D=b[y+2].y-b[y+1].y;H=Math.sqrt(x*x+D*D);B=x/H;E=D/H;tmp=Math.max(Math.sqrt((z*B+A*E+1)/2),0.04);x=z+B;D=A+E;H=Math.sqrt(x*x+D*D);x/=H;D/=H;var H=Math.max(tmp,Math.min(this.strokewidth/200+0.04,0.35)),H=0!=G&&p?Math.max(0.1,H):Math.max(tmp,0.06),P=b[y+1].x+D*f/2/H,J=b[y+1].y-x*f/2/H;D=b[y+1].x-D*f/2/H;x=b[y+1].y+x*f/2/H;0!=G&&p?-1==G?(G=D+E*f,H=x-B*f,a.lineTo(D+A*f,x-z*f),a.quadTo(P,J,G,H),function(b,c){C.push(function(){a.lineTo(b,c)})}(D,x)):
(a.lineTo(P,J),function(b,c){var d=P-A*f,e=J+z*f,g=P-E*f,k=J+B*f;C.push(function(){a.quadTo(b,c,d,e)});C.push(function(){a.lineTo(g,k)})}(D,x)):(a.lineTo(P,J),function(b,c){C.push(function(){a.lineTo(b,c)})}(D,x));z=B;A=E}y=f*E;G=-f*B;if(l&&!g)this.paintMarker(a,q.x,q.y,-z,-A,c,e,f,m,!1);else{a.lineTo(q.x-m*B+y/2,q.y-m*E+G/2);var O=q.x-m*B-y/2,Q=q.y-m*E-G/2;g?(a.moveTo(O,Q),C.splice(0,0,function(){a.moveTo(O,Q)})):a.lineTo(O,Q)}for(y=C.length-1;0<=y;y--)C[y]();g?(a.end(),a.stroke()):(a.close(),a.fillAndStroke());a.setShadow(!1);a.setMiterLimit(4);p&&a.setLineJoin("flat");2<b.length&&(a.setMiterLimit(4),k&&!g&&(a.begin(),this.paintMarker(a,b[0].x,b[0].y,v,u,n,d,f,m,!0),a.stroke(),a.end()),l&&!g&&(a.begin(),this.paintMarker(a,q.x,q.y,-z,-A,c,e,f,m,!0),a.stroke(),a.end()))}};mxArrowConnector.prototype.paintMarker=function(a,b,c,d,e,f,g,k,l,m){g=k/g;var n=k*e/2;k=-k*d/2;var p=(l+f)*d;f=(l+f)*e;m?a.moveTo(b-n+p,c-k+f):a.lineTo(b-n+p,c-k+f);a.lineTo(b-n/g+p,c-k/g+f);a.lineTo(b+l*d,c+l*e);a.lineTo(b+n/g+p,c+k/g+f);a.lineTo(b+n+p,c+k+f)};mxArrowConnector.prototype.isArrowRounded=function(){return this.isRounded};mxArrowConnector.prototype.getStartArrowWidth=function(){return mxConstants.ARROW_WIDTH};mxArrowConnector.prototype.getEndArrowWidth=function(){return mxConstants.ARROW_WIDTH};mxArrowConnector.prototype.getEdgeWidth=function(){return mxConstants.ARROW_WIDTH/3};mxArrowConnector.prototype.isOpenEnded=function(){return!1};mxArrowConnector.prototype.isMarkerStart=function(){return mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE};mxArrowConnector.prototype.isMarkerEnd=function(){return mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE};function mxText(a,b,c,d,e,f,g,k,l,m,n,p,q,u,v,y,z,x,B,A,D){mxShape.call(this);this.value=a;this.bounds=b;this.color=null!=e?e:"black";this.align=null!=c?c:"";this.valign=null!=d?d:"";this.family=null!=f?f:mxConstants.DEFAULT_FONTFAMILY;this.size=null!=g?g:mxConstants.DEFAULT_FONTSIZE;this.fontStyle=null!=k?k:mxConstants.DEFAULT_FONTSTYLE;this.spacing=parseInt(l||2);this.spacingTop=this.spacing+parseInt(m||0);this.spacingRight=this.spacing+parseInt(n||0);this.spacingBottom=this.spacing+parseInt(p||0);this.spacingLeft=this.spacing+parseInt(q||0);this.horizontal=null!=u?u:!0;this.background=v;this.border=y;this.wrap=null!=z?z:!1;this.clipped=null!=x?x:!1;this.overflow=null!=B?B:"visible";this.labelPadding=null!=A?A:0;this.textDirection=D;this.rotation=0;this.updateMargin()}mxUtils.extend(mxText,mxShape);mxText.prototype.baseSpacingTop=0;mxText.prototype.baseSpacingBottom=0;mxText.prototype.baseSpacingLeft=0;mxText.prototype.baseSpacingRight=0;mxText.prototype.replaceLinefeeds=!0;mxText.prototype.verticalTextRotation=-90;mxText.prototype.ignoreClippedStringSize=!0;mxText.prototype.ignoreStringSize=!1;mxText.prototype.textWidthPadding=8!=document.documentMode||mxClient.IS_EM?3:4;mxText.prototype.isParseVml=function(){return!1};mxText.prototype.isHtmlAllowed=function(){return 8!=document.documentMode||mxClient.IS_EM};mxText.prototype.getSvgScreenOffset=function(){return 0};mxText.prototype.checkBounds=function(){return null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)};mxText.prototype.apply=function(a){mxShape.prototype.apply.apply(this,arguments);null!=this.style&&(this.fontStyle=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSTYLE,this.fontStyle),this.family=mxUtils.getValue(this.style,mxConstants.STYLE_FONTFAMILY,this.family),this.size=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSIZE,this.size),this.color=mxUtils.getValue(this.style,mxConstants.STYLE_FONTCOLOR,this.color),this.align=mxUtils.getValue(this.style,mxConstants.STYLE_ALIGN,this.align),this.valign=mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_ALIGN,this.valign),this.spacingTop=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_TOP,this.spacingTop),this.spacingRight=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_RIGHT,this.spacingRight),this.spacingBottom=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_BOTTOM,this.spacingBottom),this.spacingLeft=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_LEFT,this.spacingLeft),this.horizontal=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,this.horizontal),this.background=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,this.background),this.border=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BORDERCOLOR,this.border),this.textDirection=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION),this.updateMargin())};mxText.prototype.getAutoDirection=function(){var a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(this.value);return null!=a&&0<a.length&&"z"<a[0]?mxConstants.TEXT_DIRECTION_RTL:mxConstants.TEXT_DIRECTION_LTR};mxText.prototype.updateBoundingBox=function(){var a=this.node;this.boundingBox=this.bounds.clone();var b=this.getTextRotation(),c=null!=this.style?mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER):null,d=null!=this.style?mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE):null;if(this.ignoreStringSize||null==a||"fill"==this.overflow||this.clipped&&this.ignoreClippedStringSize&&c==mxConstants.ALIGN_CENTER&&d==mxConstants.ALIGN_MIDDLE)this.boundingBox.x+=this.margin.x*this.boundingBox.width,this.boundingBox.y+=this.margin.y*this.boundingBox.height;else{d=c=null;if(null!=a.ownerSVGElement)if(null!=a.firstChild&&null!=a.firstChild.firstChild&&"foreignObject"==a.firstChild.firstChild.nodeName)a=a.firstChild.firstChild,c=parseInt(a.getAttribute("width"))*this.scale,d=parseInt(a.getAttribute("height"))*this.scale;else try{var e=a.getBBox();if("string"==typeof this.value&&0==mxUtils.trim(this.value)||0==e.width&&0==e.height)return;this.boundingBox=new mxRectangle(e.x,e.y,e.width,e.height);b=0}catch(f){}else c=null!=this.state?this.state.view.textDiv:null,null!=this.offsetWidth&&null!=this.offsetHeight?(c=this.offsetWidth*this.scale,d=this.offsetHeight*this.scale):(null!=c&&(this.updateFont(c),this.updateSize(c,!1),this.updateInnerHtml(c),a=c),e=a,8!=document.documentMode||mxClient.IS_EM?null!=e.firstChild&&"DIV"==e.firstChild.nodeName&&(e=e.firstChild):(d=Math.round(this.bounds.width/this.scale),this.wrap&&0<d?(a.whiteSpace="normal",a=e.getElementsByTagName("div"),0<a.length&&(e=a[a.length-1]),c=e.offsetWidth+2,a=this.node.getElementsByTagName("div"),this.clipped&&(c=Math.min(d,c)),1<a.length&&(a[a.length-2].style.width=c+"px")):a.whiteSpace="nowrap"),c=(e.offsetWidth+this.textWidthPadding)*this.scale,d=e.offsetHeight*this.scale);null!=c&&null!=d&&(this.boundingBox=new mxRectangle(this.bounds.x+this.margin.x*c,this.bounds.y+this.margin.y*d,c,d))}null!=this.boundingBox&&0!=b&&(this.unrotatedBoundingBox=mxRectangle.fromRectangle(this.boundingBox),b=mxUtils.getBoundingBox(this.boundingBox,b),this.boundingBox.x=b.x,this.boundingBox.y=b.y,mxClient.IS_QUIRKS||(this.boundingBox.width=b.width,this.boundingBox.height=b.height))};mxText.prototype.getShapeRotation=function(){return 0};mxText.prototype.getTextRotation=function(){return null!=this.state&&null!=this.state.shape?this.state.shape.getTextRotation():0};mxText.prototype.isPaintBoundsInverted=function(){return!this.horizontal&&null!=this.state&&this.state.view.graph.model.isVertex(this.state.cell)};mxText.prototype.configureCanvas=function(a,b,c,d,e){mxShape.prototype.configureCanvas.apply(this,arguments);a.setFontColor(this.color);a.setFontBackgroundColor(this.background);a.setFontBorderColor(this.border);a.setFontFamily(this.family);a.setFontSize(this.size);a.setFontStyle(this.fontStyle)};mxText.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";this.node.style.width="1px";this.node.style.height="1px";this.node.style.overflow="visible"};mxText.prototype.paint=function(a){var b=this.scale,c=this.bounds.x/b,d=this.bounds.y/b,e=this.bounds.width/b,b=this.bounds.height/b;this.updateTransform(a,c,d,e,b);this.configureCanvas(a,c,d,e,b);var f=mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML,g=f||a instanceof mxVmlCanvas2D?"html":"",k=this.value;!f&&"html"==g&&(k=mxUtils.htmlEntities(k,!1));var k=!mxUtils.isNode(this.value)&&this.replaceLinefeeds&&"html"==g?k.replace(/\n/g,"<br/>"):k,l=this.textDirection;l==mxConstants.TEXT_DIRECTION_AUTO&&!f&&(l=this.getAutoDirection());l!=mxConstants.TEXT_DIRECTION_LTR&&l!=mxConstants.TEXT_DIRECTION_RTL&&(l=null);a.text(c,d,e,b,k,this.align,this.valign,this.wrap,g,this.overflow,this.clipped,this.getTextRotation(),l)};mxText.prototype.redrawHtmlShape=function(){var a=this.node.style;a.whiteSpace="normal";a.overflow="";a.width="";a.height="";this.updateValue();this.updateFont(this.node);this.updateSize(this.node,null==this.state||null==this.state.view.textDiv);this.offsetHeight=this.offsetWidth=null;mxClient.IS_IE&&(null==document.documentMode||8>=document.documentMode)?this.updateHtmlFilter():this.updateHtmlTransform()};mxText.prototype.updateHtmlTransform=function(){var a=this.getTextRotation(),b=this.node.style,c=this.margin.x,d=this.margin.y;0!=a?(mxUtils.setPrefixedStyle(b,"transformOrigin",100*-c+"% "+100*-d+"%"),mxUtils.setPrefixedStyle(b,"transform","translate("+100*c+"%,"+100*d+"%)scale("+this.scale+") rotate("+a+"deg)")):(mxUtils.setPrefixedStyle(b,"transformOrigin","0% 0%"),mxUtils.setPrefixedStyle(b,"transform","scale("+this.scale+")translate("+100*c+"%,"+100*d+"%)"));d=0;10<=document.documentMode&&this.valign!=mxConstants.ALIGN_TOP?d+=1:9==document.documentMode&&this.valign==mxConstants.ALIGN_BOTTOM?d+=1:mxClient.IS_MAC&&!mxClient.IS_OP&&mxClient.IS_GC?mxClient.IS_MAC?d=this.valign==mxConstants.ALIGN_BOTTOM?d+2:d+1:this.valign==mxConstants.ALIGN_BOTTOM&&(d+=1):mxClient.IS_MAC&&mxClient.IS_FF?this.valign==mxConstants.ALIGN_BOTTOM?d+=2:this.valign==mxConstants.ALIGN_MIDDLE&&(d+=1):mxClient.IS_MAC||!mxClient.IS_GC&&!mxClient.IS_FF||this.valign!=mxConstants.ALIGN_BOTTOM||(d+=1);b.left=Math.round(this.bounds.x)+"px";b.top=Math.round(this.bounds.y+d)+"px";b.opacity=100>this.opacity?this.opacity/100:""};mxText.prototype.updateInnerHtml=function(a){if(mxUtils.isNode(this.value))a.innerHTML=this.value.outerHTML;else{var b=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(b=mxUtils.htmlEntities(b,!1));b=this.replaceLinefeeds?b.replace(/\n/g,"<br/>"):b;a.innerHTML='<div style="display:inline-block;_display:inline;">'+b+"</div>"}};mxText.prototype.updateHtmlFilter=function(){var a=this.node.style,b=this.margin.x,c=this.margin.y,d=this.scale;mxUtils.setOpacity(this.node,this.opacity);var e=0,f=0,g=null!=this.state?this.state.view.textDiv:null,k=this.node;if(null!=g){g.style.overflow="";g.style.height="";g.style.width="";this.updateFont(g);this.updateSize(g,!1);this.updateInnerHtml(g);var l=Math.round(this.bounds.width/this.scale);this.wrap&&0<l?(g.whiteSpace="normal",e=l,this.clipped&&(e=Math.min(e,this.bounds.width)),g.style.width=e+"px"):g.whiteSpace="nowrap";k=g;null!=k.firstChild&&"DIV"==k.firstChild.nodeName&&(k=k.firstChild);!this.clipped&&this.wrap&&0<l&&(e=k.offsetWidth+this.textWidthPadding,g.style.width=e+"px");f=k.offsetHeight+2;mxClient.IS_QUIRKS&&null!=this.border&&this.border!=mxConstants.NONE&&(f+=3)}else null!=k.firstChild&&"DIV"==k.firstChild.nodeName&&(k=k.firstChild,f=k.offsetHeight);e=k.offsetWidth+this.textWidthPadding;this.clipped&&(f=Math.min(f,this.bounds.height));this.offsetWidth=e;this.offsetHeight=f;l=this.bounds.width/d;g=this.bounds.height/d;mxClient.IS_QUIRKS&&(this.clipped||"width"==this.overflow&&0<g)?(g=Math.min(g,f),a.height=Math.round(g)+"px"):g=f;"fill"!=this.overflow&&"width"!=this.overflow&&(this.clipped&&(e=Math.min(l,e)),l=e,mxClient.IS_QUIRKS&&this.clipped||this.wrap)&&(a.width=Math.round(l)+"px");var g=g*d,l=l*d,m=this.getTextRotation()*(Math.PI/180),e=parseFloat(parseFloat(Math.cos(m)).toFixed(8)),f=parseFloat(parseFloat(Math.sin(-m)).toFixed(8)),m=m%(2*Math.PI);0>m&&(m+=2*Math.PI);m%=Math.PI;m>Math.PI/2&&(m=Math.PI-m);var k=Math.cos(m),n=Math.sin(-m),b=l*-(b+0.5),p=g*-(c+0.5),q=(g-g*k+l*n)/2+f*b-e*p;0!=m&&(c="progid:DXImageTransform.Microsoft.Matrix(M11="+e+", M12="+f+", M21="+-f+", M22="+e+", sizingMethod='auto expand')",a.filter=null!=a.filter&&0<a.filter.length?a.filter+(" "+c):c);c=0;mxClient.IS_QUIRKS&&(c=this.valign==mxConstants.ALIGN_TOP?c-1:this.valign==mxConstants.ALIGN_BOTTOM?c+2:c+1);a.zoom=d;a.left=Math.round(this.bounds.x+((l-l*k+g*n)/2-e*b-f*p)-l/2)+
"px";a.top=Math.round(this.bounds.y+q-g/2+c)+"px"};mxText.prototype.updateValue=function(){if(mxUtils.isNode(this.value))this.node.innerHTML="",this.node.appendChild(this.value);else{var a=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(a=mxUtils.htmlEntities(a,!1));var a=this.replaceLinefeeds?a.replace(/\n/g,"<br/>"):a,b=null!=this.background&&this.background!=mxConstants.NONE?this.background:null,c=null!=this.border&&this.border!=mxConstants.NONE?this.border:null;if("fill"==this.overflow||"width"==this.overflow)null!=b&&(this.node.style.backgroundColor=b),null!=c&&(this.node.style.border="1px solid "+c);else{var d="";null!=b&&(d+="background-color:"+b+";");null!=c&&(d+="border:1px solid "+c+";");b=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(this.size*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;a='<div style="zoom:1;'+d+"display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:"+b+'">'+a+"</div>"}this.node.innerHTML=a;a=this.node.getElementsByTagName("div");0<a.length&&(d=this.textDirection,d==mxConstants.TEXT_DIRECTION_AUTO&&this.dialect!=mxConstants.DIALECT_STRICTHTML&&(d=this.getAutoDirection()),d==mxConstants.TEXT_DIRECTION_LTR||d==mxConstants.TEXT_DIRECTION_RTL?a[a.length-1].setAttribute("dir",d):a[a.length-1].removeAttribute("dir"))}};mxText.prototype.updateFont=function(a){a=a.style;a.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(this.size*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;a.fontSize=Math.round(this.size)+"px";a.fontFamily=this.family;a.verticalAlign="top";a.color=this.color;a.fontWeight=(this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?"bold":"";a.fontStyle=(this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?"italic":"";a.textDecoration=(this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE?"underline":"";a.textAlign=this.align==mxConstants.ALIGN_CENTER?"center":this.align==mxConstants.ALIGN_RIGHT?"right":"left"};mxText.prototype.updateSize=function(a,b){var c=Math.round(this.bounds.width/this.scale),d=Math.round(this.bounds.height/this.scale),e=a.style;this.clipped?(e.overflow="hidden",mxClient.IS_QUIRKS?e.width=c+"px":(e.maxHeight=d+"px",e.maxWidth=c+"px")):"fill"==this.overflow?(e.width=c+"px",e.height=d+"px"):"width"==this.overflow&&(e.width=c+"px",e.maxHeight=d+"px");this.wrap&&0<c?(e.whiteSpace="normal",e.width=c+"px",b&&(d=a,null!=d.firstChild&&"DIV"==d.firstChild.nodeName&&(d=d.firstChild),d=d.offsetWidth+
3,this.clipped&&(d=Math.min(d,c)),e.width=d+"px")):e.whiteSpace="nowrap"};mxText.prototype.updateMargin=function(){this.margin=mxUtils.getAlignmentAsPoint(this.align,this.valign)};mxText.prototype.getSpacing=function(){var a=0,b=0,a=this.align==mxConstants.ALIGN_CENTER?(this.spacingLeft-this.spacingRight)/2:this.align==mxConstants.ALIGN_RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,b=this.valign==mxConstants.ALIGN_MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign==mxConstants.ALIGN_BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop;return new mxPoint(a,b)};
function mxTriangle(){mxActor.call(this)}mxUtils.extend(mxTriangle,mxActor);mxTriangle.prototype.redrawPath=function(a,b,c,d,e){b=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;this.addPoints(a,[new mxPoint(0,0),new mxPoint(d,0.5*e),new mxPoint(0,e)],this.isRounded,b,!0)};function mxHexagon(){mxActor.call(this)}mxUtils.extend(mxHexagon,mxActor);
mxHexagon.prototype.redrawPath=function(a,b,c,d,e){b=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2;this.addPoints(a,[new mxPoint(0.25*d,0),new mxPoint(0.75*d,0),new mxPoint(d,0.5*e),new mxPoint(0.75*d,e),new mxPoint(0.25*d,e),new mxPoint(0,0.5*e)],this.isRounded,b,!0)};function mxLine(a,b,c){mxShape.call(this);this.bounds=a;this.stroke=b;this.strokewidth=null!=c?c:1}mxUtils.extend(mxLine,mxShape);
mxLine.prototype.paintVertexShape=function(a,b,c,d,e){c+=e/2;a.begin();a.moveTo(b,c);a.lineTo(b+d,c);a.stroke()};function mxImageShape(a,b,c,d,e){mxShape.call(this);this.bounds=a;this.image=b;this.fill=c;this.stroke=d;this.strokewidth=null!=e?e:1;this.shadow=!1}mxUtils.extend(mxImageShape,mxRectangleShape);mxImageShape.prototype.preserveImageAspect=!0;mxImageShape.prototype.getSvgScreenOffset=function(){return mxClient.IS_IE?0:0.5};mxImageShape.prototype.apply=function(a){mxShape.prototype.apply.apply(this,arguments);this.gradient=this.stroke=this.fill=null;null!=this.style&&(this.preserveImageAspect=1==mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_ASPECT,1),this.flipH=this.flipH||1==mxUtils.getValue(this.style,"imageFlipH",0),this.flipV=this.flipV||1==mxUtils.getValue(this.style,"imageFlipV",0))};mxImageShape.prototype.isHtmlAllowed=function(){return!this.preserveImageAspect};mxImageShape.prototype.createHtml=function(){var a=document.createElement("div");a.style.position="absolute";return a};mxImageShape.prototype.paintVertexShape=function(a,b,c,d,e){if(null!=this.image){var f=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,null),g=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null);null!=f&&(a.setFillColor(f),a.setStrokeColor(g),a.rect(b,c,d,e),a.fillAndStroke());a.image(b,c,d,e,this.image,this.preserveImageAspect,!1,!1);g=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null);null!=g&&(a.setShadow(!1),a.setStrokeColor(g),a.rect(b,c,d,e),a.stroke())}else mxRectangleShape.prototype.paintBackground.apply(this,arguments)};mxImageShape.prototype.redrawHtmlShape=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";this.node.style.width=Math.max(0,Math.round(this.bounds.width))+"px";this.node.style.height=Math.max(0,Math.round(this.bounds.height))+"px";this.node.innerHTML="";if(null!=this.image){var a=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,""),b=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,"");this.node.style.backgroundColor=a;this.node.style.borderColor=b;a=document.createElement(mxClient.IS_IE6||(null==document.documentMode||8>=document.documentMode)&&0!=this.rotation?mxClient.VML_PREFIX+":image":"img");a.style.position="absolute";a.src=this.image;b=100>this.opacity?"alpha(opacity="+this.opacity+")":"";this.node.style.filter=b;this.flipH&&this.flipV?b+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2)":this.flipH?b+="progid:DXImageTransform.Microsoft.BasicImage(mirror=1)":this.flipV&&(b+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)");a.style.filter!=b&&(a.style.filter=b);"image"==a.nodeName?a.style.rotation=this.rotation:0!=this.rotation?mxUtils.setPrefixedStyle(a.style,"transform","rotate("+this.rotation+"deg)"):mxUtils.setPrefixedStyle(a.style,"transform","");a.style.width=this.node.style.width;a.style.height=this.node.style.height;this.node.style.backgroundImage="";this.node.appendChild(a)}else this.setTransparentBackgroundImage(this.node)};function mxLabel(a,b,c,d){mxRectangleShape.call(this,a,b,c,d)}
mxUtils.extend(mxLabel,mxRectangleShape);mxLabel.prototype.imageSize=mxConstants.DEFAULT_IMAGESIZE;mxLabel.prototype.spacing=2;mxLabel.prototype.indicatorSize=10;mxLabel.prototype.indicatorSpacing=2;mxLabel.prototype.init=function(a){mxShape.prototype.init.apply(this,arguments);null!=this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))};mxLabel.prototype.redraw=function(){null!=this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorStrokeColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection);mxShape.prototype.redraw.apply(this,arguments)};mxLabel.prototype.isHtmlAllowed=function(){return mxRectangleShape.prototype.isHtmlAllowed.apply(this,arguments)&&null==this.indicatorColor&&null==this.indicatorShape};mxLabel.prototype.paintForeground=function(a,b,c,d,e){this.paintImage(a,b,c,d,e);this.paintIndicator(a,b,c,d,e);mxRectangleShape.prototype.paintForeground.apply(this,arguments)};mxLabel.prototype.paintImage=function(a,b,c,d,e){null!=this.image&&(b=this.getImageBounds(b,c,d,e),a.image(b.x,b.y,b.width,b.height,this.image,!1,!1,!1))};mxLabel.prototype.getImageBounds=function(a,b,c,d){var e=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),f=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),g=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_WIDTH,mxConstants.DEFAULT_IMAGESIZE),k=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_HEIGHT,mxConstants.DEFAULT_IMAGESIZE),l=mxUtils.getNumber(this.style,mxConstants.STYLE_SPACING,this.spacing)+5;a=e==mxConstants.ALIGN_CENTER?a+(c-g)/2:e==mxConstants.ALIGN_RIGHT?a+(c-g-l):a+l;b=f==mxConstants.ALIGN_TOP?b+l:f==mxConstants.ALIGN_BOTTOM?b+(d-k-l):b+(d-k)/2;return new mxRectangle(a,b,g,k)};mxLabel.prototype.paintIndicator=function(a,b,c,d,e){null!=this.indicator?(this.indicator.bounds=this.getIndicatorBounds(b,c,d,e),this.indicator.paint(a)):null!=this.indicatorImage&&(b=this.getIndicatorBounds(b,c,d,e),a.image(b.x,b.y,b.width,b.height,this.indicatorImage,!1,!1,!1))};
mxLabel.prototype.getIndicatorBounds=function(a,b,c,d){var e=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),f=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),g=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_WIDTH,this.indicatorSize),k=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_HEIGHT,this.indicatorSize),l=this.spacing+5;a=e==mxConstants.ALIGN_RIGHT?a+(c-g-l):e==mxConstants.ALIGN_CENTER?a+(c-g)/
2:a+l;b=f==mxConstants.ALIGN_BOTTOM?b+(d-k-l):f==mxConstants.ALIGN_TOP?b+l:b+(d-k)/2;return new mxRectangle(a,b,g,k)};
mxLabel.prototype.redrawHtmlShape=function(){for(mxRectangleShape.prototype.redrawHtmlShape.apply(this,arguments);this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);if(null!=this.image){var a=document.createElement("img");a.style.position="relative";a.setAttribute("border","0");var b=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);b.x-=this.bounds.x;b.y-=this.bounds.y;a.style.left=Math.round(b.x)+"px";a.style.top=Math.round(b.y)+"px";a.style.width=Math.round(b.width)+"px";a.style.height=Math.round(b.height)+"px";a.src=this.image;this.node.appendChild(a)}};function mxCylinder(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxCylinder,mxShape);mxCylinder.prototype.maxHeight=40;mxCylinder.prototype.svgStrokeTolerance=0;mxCylinder.prototype.paintVertexShape=function(a,b,c,d,e){a.translate(b,c);a.begin();this.redrawPath(a,b,c,d,e,!1);a.fillAndStroke();a.setShadow(!1);a.begin();this.redrawPath(a,b,c,d,e,!0);a.stroke()};mxCylinder.prototype.redrawPath=function(a,b,c,d,e,f){b=Math.min(this.maxHeight,Math.round(e/5));if(f&&null!=this.fill||!f&&null==this.fill)a.moveTo(0,b),a.curveTo(0,2*b,d,2*b,d,b),f||(a.stroke(),a.begin());f||(a.moveTo(0,b),a.curveTo(0,-b/3,d,-b/3,d,b),a.lineTo(d,e-b),a.curveTo(d,e+b/3,0,e+b/3,0,e-b),a.close())};function mxConnector(a,b,c){mxPolyline.call(this,a,b,c)}mxUtils.extend(mxConnector,mxPolyline);mxConnector.prototype.paintEdgeShape=function(a,b){var c=this.createMarker(a,b,!0),d=this.createMarker(a,b,!1);mxPolyline.prototype.paintEdgeShape.apply(this,arguments);a.setFillColor(this.stroke);a.setShadow(!1);a.setDashed(!1);null!=c&&c();null!=d&&d()};mxConnector.prototype.createMarker=function(a,b,c){var d=null,e=b.length,f=mxUtils.getValue(this.style,c?mxConstants.STYLE_STARTARROW:mxConstants.STYLE_ENDARROW),g=c?b[1]:b[e-2],k=c?b[0]:b[e-1];if(null!=f&&null!=g&&null!=k){for(d=1;d<e-1&&0==Math.round(g.x-k.x)&&0==Math.round(g.y-k.y);)g=c?b[1+d]:b[e-2-d],d++;b=k.x-g.x;e=k.y-g.y;d=Math.max(1,Math.sqrt(b*b+e*e));g=b/d;b=e/d;e=mxUtils.getNumber(this.style,c?mxConstants.STYLE_STARTSIZE:mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE);d=mxMarker.createMarker(a,this,f,k,g,b,e,c,this.arrowStrokewidth,0!=this.style[c?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL])}return d};mxConnector.prototype.augmentBoundingBox=function(a){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var b=0;mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE&&(b=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE)+1);mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE&&(b=Math.max(b,mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE))+
1);a.grow(Math.ceil(b*this.scale))};function mxSwimlane(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxSwimlane,mxShape);mxSwimlane.prototype.imageSize=16;mxSwimlane.prototype.getTitleSize=function(){return Math.max(0,mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE))};mxSwimlane.prototype.getLabelBounds=function(a){var b=this.getTitleSize();a=new mxRectangle(a.x,a.y,a.width,a.height);var c=this.isHorizontal(),d=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0),e=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0),f=this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH,c=c==!f,d=!c&&d!=(this.direction==mxConstants.DIRECTION_SOUTH||this.direction==mxConstants.DIRECTION_WEST),e=c&&e!=(this.direction==mxConstants.DIRECTION_SOUTH||this.direction==mxConstants.DIRECTION_WEST);if(f){b=Math.min(a.width,b*this.scale);if(d||e)a.x+=a.width-b;a.width=b}else{b=Math.min(a.height,b*this.scale);if(d||e)a.y+=a.height-b;a.height=b}return a};mxSwimlane.prototype.getGradientBounds=function(a,b,c,d,e){a=this.getTitleSize();if(this.isHorizontal())return a=Math.min(a,e),new mxRectangle(b,c,d,a);a=Math.min(a,d);return new mxRectangle(b,c,a,e)};mxSwimlane.prototype.getArcSize=function(a,b,c){a=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100;return 3*c*a};mxSwimlane.prototype.isHorizontal=function(){return 1==mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)};
mxSwimlane.prototype.paintVertexShape=function(a,b,c,d,e){var f=this.getTitleSize(),g=mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_FILLCOLOR,mxConstants.NONE),k=1==mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_LINE,1),l=0,f=this.isHorizontal()?Math.min(f,e):Math.min(f,d);a.translate(b,c);this.isRounded?(l=this.getArcSize(d,e,f),this.paintRoundedSwimlane(a,b,c,d,e,f,l,g,k)):this.paintSwimlane(a,b,c,d,e,f,g,k);g=mxUtils.getValue(this.style,mxConstants.STYLE_SEPARATORCOLOR,mxConstants.NONE);this.paintSeparator(a,b,c,d,e,f,g);null!=this.image&&(e=this.getImageBounds(b,c,d,e),a.image(e.x-b,e.y-c,e.width,e.height,this.image,!1,!1,!1));this.glass&&(a.setShadow(!1),this.paintGlassEffect(a,0,0,d,f,l))};mxSwimlane.prototype.paintSwimlane=function(a,b,c,d,e,f,g,k){g!=mxConstants.NONE&&(a.save(),a.setFillColor(g),a.rect(0,0,d,e),a.fillAndStroke(),a.restore(),a.setShadow(!1));a.begin();this.isHorizontal()?(a.moveTo(0,f),a.lineTo(0,0),a.lineTo(d,0),a.lineTo(d,f),k&&a.close(),a.fillAndStroke(),f<e&&g==mxConstants.NONE&&(a.pointerEvents=!1,a.begin(),a.moveTo(0,f),a.lineTo(0,e),a.lineTo(d,e),a.lineTo(d,f),a.stroke())):(a.moveTo(f,0),a.lineTo(0,0),a.lineTo(0,e),a.lineTo(f,e),k&&a.close(),a.fillAndStroke(),f<d&&g==mxConstants.NONE&&(a.pointerEvents=!1,a.begin(),a.moveTo(f,0),a.lineTo(d,0),a.lineTo(d,e),a.lineTo(f,e),a.stroke()))};mxSwimlane.prototype.paintRoundedSwimlane=function(a,b,c,d,e,f,g,k,l){k!=mxConstants.NONE&&(a.save(),a.setFillColor(k),a.roundrect(0,0,d,e,g,g),a.fillAndStroke(),a.restore(),a.setShadow(!1));a.begin();this.isHorizontal()?(a.moveTo(d,f),a.lineTo(d,g),a.quadTo(d,0,d-Math.min(d/2,g),0),a.lineTo(Math.min(d/2,g),0),a.quadTo(0,0,0,g),a.lineTo(0,f),l&&a.close(),a.fillAndStroke(),f<e&&k==mxConstants.NONE&&(a.pointerEvents=!1,a.begin(),a.moveTo(0,f),a.lineTo(0,e-g),a.quadTo(0,e,Math.min(d/2,g),e),a.lineTo(d-
Math.min(d/2,g),e),a.quadTo(d,e,d,e-g),a.lineTo(d,f),a.stroke())):(a.moveTo(f,0),a.lineTo(g,0),a.quadTo(0,0,0,Math.min(e/2,g)),a.lineTo(0,e-Math.min(e/2,g)),a.quadTo(0,e,g,e),a.lineTo(f,e),l&&a.close(),a.fillAndStroke(),f<d&&k==mxConstants.NONE&&(a.pointerEvents=!1,a.begin(),a.moveTo(f,e),a.lineTo(d-g,e),a.quadTo(d,e,d,e-Math.min(e/2,g)),a.lineTo(d,Math.min(e/2,g)),a.quadTo(d,0,d-g,0),a.lineTo(f,0),a.stroke()))};mxSwimlane.prototype.paintSeparator=function(a,b,c,d,e,f,g){g!=mxConstants.NONE&&(a.setStrokeColor(g),a.setDashed(!0),a.begin(),this.isHorizontal()?(a.moveTo(d,f),a.lineTo(d,e)):(a.moveTo(f,0),a.lineTo(d,0)),a.stroke(),a.setDashed(!1))};mxSwimlane.prototype.getImageBounds=function(a,b,c,d){return this.isHorizontal()?new mxRectangle(a+c-this.imageSize,b,this.imageSize,this.imageSize):new mxRectangle(a,b,this.imageSize,this.imageSize)};function mxGraphLayout(a){this.graph=a}
mxGraphLayout.prototype.graph=null;mxGraphLayout.prototype.useBoundingBox=!0;mxGraphLayout.prototype.parent=null;mxGraphLayout.prototype.moveCell=function(a,b,c){};mxGraphLayout.prototype.execute=function(a){};mxGraphLayout.prototype.getGraph=function(){return this.graph};mxGraphLayout.prototype.getConstraint=function(a,b,c,d){c=this.graph.view.getState(b);b=null!=c?c.style:this.graph.getCellStyle(b);return null!=b?b[a]:null};mxGraphLayout.traverse=function(a,b,c,d,e){if(null!=c&&null!=a){b=null!=b?b:!0;e=e||[];var f=mxCellPath.create(a);if(null==e[f]&&(e[f]=a,d=c(a,d),null==d||d)&&(d=this.graph.model.getEdgeCount(a),0<d))for(f=0;f<d;f++){var g=this.graph.model.getEdgeAt(a,f),k=this.graph.model.getTerminal(g,!0)==a;if(!b||k)k=this.graph.view.getVisibleTerminal(g,!k),this.traverse(k,b,c,g,e)}}};mxGraphLayout.prototype.isVertexMovable=function(a){return this.graph.isCellMovable(a)};mxGraphLayout.prototype.isVertexIgnored=function(a){return!this.graph.getModel().isVertex(a)||!this.graph.isCellVisible(a)};mxGraphLayout.prototype.isEdgeIgnored=function(a){var b=this.graph.getModel();return!b.isEdge(a)||!this.graph.isCellVisible(a)||null==b.getTerminal(a,!0)||null==b.getTerminal(a,!1)};mxGraphLayout.prototype.setEdgeStyleEnabled=function(a,b){this.graph.setCellStyles(mxConstants.STYLE_NOEDGESTYLE,b?"0":"1",[a])};mxGraphLayout.prototype.setOrthogonalEdge=function(a,b){this.graph.setCellStyles(mxConstants.STYLE_ORTHOGONAL,b?"1":"0",[a])};mxGraphLayout.prototype.getParentOffset=function(a){var b=new mxPoint;if(null!=a&&a!=this.parent){var c=this.graph.getModel();if(c.isAncestor(this.parent,a))for(var d=c.getGeometry(a);a!=this.parent;)b.x+=d.x,b.y+=d.y,a=c.getParent(a),d=c.getGeometry(a)}return b};mxGraphLayout.prototype.setEdgePoints=function(a,b){if(null!=a){var c=this.graph.model,d=c.getGeometry(a);null==d?(d=new mxGeometry,d.setRelative(!0)):d=d.clone();if(null!=this.parent&&null!=b)for(var e=c.getParent(a),e=this.getParentOffset(e),f=0;f<b.length;f++)b[f].x-=e.x,b[f].y-=e.y;d.points=b;c.setGeometry(a,d)}};mxGraphLayout.prototype.setVertexLocation=function(a,b,c){var d=this.graph.getModel(),e=d.getGeometry(a),f=null;if(null!=e){f=new mxRectangle(b,c,e.width,e.height);if(this.useBoundingBox){var g=this.graph.getView().getState(a);if(null!=g&&null!=g.text&&null!=g.text.boundingBox){var k=this.graph.getView().scale,l=g.text.boundingBox;g.text.boundingBox.x<g.x&&(b+=(g.x-l.x)/k,f.width=l.width);g.text.boundingBox.y<g.y&&(c+=(g.y-l.y)/k,f.height=l.height)}}null!=this.parent&&(g=d.getParent(a),null!=g&&g!=
this.parent&&(g=this.getParentOffset(g),b-=g.x,c-=g.y));if(e.x!=b||e.y!=c)e=e.clone(),e.x=b,e.y=c,d.setGeometry(a,e)}return f};mxGraphLayout.prototype.getVertexBounds=function(a){var b=this.graph.getModel().getGeometry(a);if(this.useBoundingBox){var c=this.graph.getView().getState(a);if(null!=c&&null!=c.text&&null!=c.text.boundingBox)var d=this.graph.getView().scale,e=c.text.boundingBox,f=Math.max(c.x-e.x,0)/d,g=Math.max(c.y-e.y,0)/d,k=Math.max(e.x+e.width-(c.x+c.width),0)/d,c=Math.max(e.y+e.height-(c.y+c.height),0)/d,b=new mxRectangle(b.x-f,b.y-g,b.width+f+k,b.height+g+c)}null!=this.parent&&(a=this.graph.getModel().getParent(a),
b=b.clone(),null!=a&&a!=this.parent&&(a=this.getParentOffset(a),b.x+=a.x,b.y+=a.y));return new mxRectangle(b.x,b.y,b.width,b.height)};mxGraphLayout.prototype.arrangeGroups=function(a,b,c,d,e,f){return this.graph.updateGroupBounds(a,b,!0,c,d,e,f)};function mxStackLayout(a,b,c,d,e,f){mxGraphLayout.call(this,a);this.horizontal=null!=b?b:!0;this.spacing=null!=c?c:0;this.x0=null!=d?d:0;this.y0=null!=e?e:0;this.border=null!=f?f:0}mxStackLayout.prototype=new mxGraphLayout;mxStackLayout.prototype.constructor=mxStackLayout;mxStackLayout.prototype.horizontal=null;mxStackLayout.prototype.spacing=null;mxStackLayout.prototype.x0=null;mxStackLayout.prototype.y0=null;mxStackLayout.prototype.border=0;mxStackLayout.prototype.marginTop=0;mxStackLayout.prototype.marginLeft=0;mxStackLayout.prototype.marginRight=0;mxStackLayout.prototype.marginBottom=0;mxStackLayout.prototype.keepFirstLocation=!1;mxStackLayout.prototype.fill=!1;mxStackLayout.prototype.resizeParent=!1;mxStackLayout.prototype.resizeParentMax=!1;mxStackLayout.prototype.resizeLast=!1;mxStackLayout.prototype.wrap=null;mxStackLayout.prototype.borderCollapse=!0;mxStackLayout.prototype.isHorizontal=function(){return this.horizontal};mxStackLayout.prototype.moveCell=function(a,b,c){var d=this.graph.getModel(),e=d.getParent(a),f=this.isHorizontal();if(null!=a&&null!=e){var g=0,k=0,l=d.getChildCount(e);b=f?b:c;g=this.graph.getView().getState(e);null!=g&&(b-=f?g.x:g.y);b/=this.graph.view.scale;for(g=0;g<l;g++)if(c=d.getChildAt(e,g),c!=a&&(c=d.getGeometry(c),null!=c)){c=f?c.x+c.width/2:c.y+c.height/2;if(k<b&&c>b)break;k=c}f=e.getIndex(a);f=Math.max(0,g-(g>f?1:0));d.add(e,a,f)}};mxStackLayout.prototype.getParentSize=function(a){var b=this.graph.getModel(),c=b.getGeometry(a);null!=this.graph.container&&(null==c&&b.isLayer(a)||a==this.graph.getView().currentRoot)&&(c=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1));return c};mxStackLayout.prototype.execute=function(a){if(null!=a){var b=this.getParentSize(a),c=this.isHorizontal(),d=this.graph.getModel(),e=null;null!=b&&(e=c?b.height-this.marginTop-this.marginBottom:b.width-this.marginLeft-this.marginRight);var e=e-(2*this.spacing+2*this.border),f=this.x0+this.border+this.marginLeft,g=this.y0+this.border+this.marginTop;if(this.graph.isSwimlane(a)){var k=this.graph.getCellStyle(a),l=mxUtils.getNumber(k,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE),k=1==mxUtils.getValue(k,mxConstants.STYLE_HORIZONTAL,!0);null!=b&&(l=k?Math.min(l,b.height):Math.min(l,b.width));c==k&&(e-=l);k?g+=l:f+=l}d.beginUpdate();try{for(var l=0,k=null,m=0,n=null,p=d.getChildCount(a),q=0;q<p;q++){var u=d.getChildAt(a,q);if(!this.isVertexIgnored(u)&&this.isVertexMovable(u)){var v=d.getGeometry(u);if(null!=v){v=v.clone();null!=this.wrap&&null!=k&&(c&&k.x+k.width+v.width+2*this.spacing>this.wrap||!c&&k.y+k.height+v.height+2*this.spacing>this.wrap)&&(k=null,c?g+=l+this.spacing:f+=l+this.spacing,l=0);var l=Math.max(l,c?v.height:v.width),y=0;if(!this.borderCollapse)var z=this.graph.getCellStyle(u),y=mxUtils.getNumber(z,mxConstants.STYLE_STROKEWIDTH,1);null!=k?c?v.x=m+this.spacing+Math.floor(y/2):v.y=m+this.spacing+Math.floor(y/2):this.keepFirstLocation||(c?v.x=f:v.y=g);c?v.y=g:v.x=f;this.fill&&null!=e&&(c?v.height=e:v.width=e);this.setChildGeometry(u,v);n=u;k=v;m=c?k.x+k.width+Math.floor(y/2):k.y+k.height+Math.floor(y/2)}}}this.resizeParent&&null!=b&&null!=k&&!this.graph.isCellCollapsed(a)?this.updateParentGeometry(a,b,k):this.resizeLast&&null!=b&&null!=k&&null!=n&&(c?k.width=b.width-k.x-this.spacing-this.marginRight-this.marginLeft:k.height=b.height-k.y-this.spacing-this.marginBottom,this.setChildGeometry(n,k))}finally{d.endUpdate()}}};mxStackLayout.prototype.setChildGeometry=function(a,b){var c=this.graph.getCellGeometry(a);null!=c&&b.x==c.x&&b.y==c.y&&b.width==c.width&&b.height==c.height||this.graph.getModel().setGeometry(a,b)};mxStackLayout.prototype.updateParentGeometry=function(a,b,c){var d=this.isHorizontal(),e=this.graph.getModel(),f=b.clone();d?(c=c.x+c.width+this.spacing+this.marginRight,f.width=this.resizeParentMax?Math.max(f.width,c):c):(c=c.y+c.height+this.spacing+this.marginBottom,f.height=this.resizeParentMax?Math.max(f.height,c):c);b.x==f.x&&b.y==f.y&&b.width==f.width&&b.height==f.height||e.setGeometry(a,f)};function mxPartitionLayout(a,b,c,d){mxGraphLayout.call(this,a);this.horizontal=null!=b?b:!0;this.spacing=c||0;this.border=d||0}mxPartitionLayout.prototype=new mxGraphLayout;mxPartitionLayout.prototype.constructor=mxPartitionLayout;mxPartitionLayout.prototype.horizontal=null;mxPartitionLayout.prototype.spacing=null;mxPartitionLayout.prototype.border=null;mxPartitionLayout.prototype.resizeVertices=!0;mxPartitionLayout.prototype.isHorizontal=function(){return this.horizontal};mxPartitionLayout.prototype.moveCell=function(a,b,c){c=this.graph.getModel();var d=c.getParent(a);if(null!=a&&null!=d){for(var e=0,f=0,g=c.getChildCount(d),e=0;e<g;e++){var k=c.getChildAt(d,e),k=this.getVertexBounds(k);if(null!=k){k=k.x+k.width/2;if(f<b&&k>b)break;f=k}}b=d.getIndex(a);b=Math.max(0,e-(e>b?1:0));c.add(d,a,b)}};mxPartitionLayout.prototype.execute=function(a){var b=this.isHorizontal(),c=this.graph.getModel(),d=c.getGeometry(a);null!=this.graph.container&&(null==d&&c.isLayer(a)||a==this.graph.getView().currentRoot)&&(d=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1));if(null!=d){for(var e=[],f=c.getChildCount(a),g=0;g<f;g++){var k=c.getChildAt(a,g);!this.isVertexIgnored(k)&&this.isVertexMovable(k)&&e.push(k)}f=e.length;if(0<f){var l=this.border,m=this.border,n=b?d.height:d.width,n=n-2*this.border;a=this.graph.isSwimlane(a)?this.graph.getStartSize(a):new mxRectangle;n-=b?a.height:a.width;l+=a.width;m+=a.height;a=this.border+(f-1)*this.spacing;d=b?(d.width-l-a)/f:(d.height-m-a)/f;if(0<d){c.beginUpdate();try{for(g=0;g<f;g++){var k=e[g],p=c.getGeometry(k);null!=p&&(p=p.clone(),p.x=l,p.y=m,b?(this.resizeVertices&&(p.width=d,p.height=n),l+=d+this.spacing):(this.resizeVertices&&(p.height=d,p.width=n),m+=d+this.spacing),c.setGeometry(k,p))}}finally{c.endUpdate()}}}}};
function mxCompactTreeLayout(a,b,c){mxGraphLayout.call(this,a);this.horizontal=null!=b?b:!0;this.invert=null!=c?c:!1}mxCompactTreeLayout.prototype=new mxGraphLayout;mxCompactTreeLayout.prototype.constructor=mxCompactTreeLayout;mxCompactTreeLayout.prototype.horizontal=null;mxCompactTreeLayout.prototype.invert=null;mxCompactTreeLayout.prototype.resizeParent=!0;mxCompactTreeLayout.prototype.maintainParentLocation=!1;mxCompactTreeLayout.prototype.groupPadding=10;mxCompactTreeLayout.prototype.groupPaddingTop=0;mxCompactTreeLayout.prototype.groupPaddingRight=0;mxCompactTreeLayout.prototype.groupPaddingBottom=0;mxCompactTreeLayout.prototype.groupPaddingLeft=0;mxCompactTreeLayout.prototype.parentsChanged=null;mxCompactTreeLayout.prototype.moveTree=!1;mxCompactTreeLayout.prototype.visited=null;mxCompactTreeLayout.prototype.levelDistance=10;mxCompactTreeLayout.prototype.nodeDistance=20;mxCompactTreeLayout.prototype.resetEdges=!0;mxCompactTreeLayout.prototype.prefHozEdgeSep=5;mxCompactTreeLayout.prototype.prefVertEdgeOff=4;mxCompactTreeLayout.prototype.minEdgeJetty=8;mxCompactTreeLayout.prototype.channelBuffer=4;mxCompactTreeLayout.prototype.edgeRouting=!0;mxCompactTreeLayout.prototype.sortEdges=!1;mxCompactTreeLayout.prototype.alignRanks=!1;mxCompactTreeLayout.prototype.maxRankHeight=null;mxCompactTreeLayout.prototype.root=null;mxCompactTreeLayout.prototype.node=null;mxCompactTreeLayout.prototype.isVertexIgnored=function(a){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(a).length};mxCompactTreeLayout.prototype.isHorizontal=function(){return this.horizontal};mxCompactTreeLayout.prototype.execute=function(a,b){this.parent=a;var c=this.graph.getModel();if(null==b)if(0<this.graph.getEdges(a,c.getParent(a),this.invert,!this.invert,!1).length)this.root=a;else{var d=this.graph.findTreeRoots(a,!0,this.invert);if(0<d.length)for(var e=0;e<d.length;e++)if(!this.isVertexIgnored(d[e])&&0<this.graph.getEdges(d[e],null,this.invert,!this.invert,!1).length){this.root=d[e];break}}else this.root=b;if(null!=this.root){this.parentsChanged=this.resizeParent?{}:null;this.parentY=this.parentX=null;if(a!=this.root&&null!=c.isVertex(a)&&this.maintainParentLocation){var f=this.graph.getCellGeometry(a);null!=f&&(this.parentX=f.x,this.parentY=f.y)}c.beginUpdate();try{if(this.visited={},this.node=this.dfs(this.root,a),this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(this.node,0),this.setCellHeights(this.node,0)),null!=this.node){this.layout(this.node);var g=this.graph.gridSize,d=g;if(!this.moveTree){var k=this.getVertexBounds(this.root);null!=k&&(g=k.x,d=k.y)}k=null;k=this.isHorizontal()?this.horizontalLayout(this.node,g,d):this.verticalLayout(this.node,null,g,d);if(null!=k){var l=e=0;0>k.x&&(e=Math.abs(g-k.x));0>k.y&&(l=Math.abs(d-k.y));0==e&&0==l||this.moveNode(this.node,e,l);this.resizeParent&&this.adjustParents();this.edgeRouting&&this.localEdgeProcessing(this.node)}null!=this.parentX&&null!=this.parentY&&(f=this.graph.getCellGeometry(a),null!=f&&(f=f.clone(),f.x=this.parentX,f.y=this.parentY,c.setGeometry(a,f)))}}finally{c.endUpdate()}}};mxCompactTreeLayout.prototype.moveNode=function(a,b,c){a.x+=b;a.y+=c;this.apply(a);for(a=a.child;null!=a;)this.moveNode(a,b,c),a=a.next};mxCompactTreeLayout.prototype.sortOutgoingEdges=function(a,b){var c=new mxDictionary;b.sort(function(b,e){var f=b.getTerminal(b.getTerminal(!1)==a),g=c.get(f);null==g&&(g=mxCellPath.create(f).split(mxCellPath.PATH_SEPARATOR),c.put(f,g));var f=e.getTerminal(e.getTerminal(!1)==a),k=c.get(f);null==k&&(k=mxCellPath.create(f).split(mxCellPath.PATH_SEPARATOR),c.put(f,k));return mxCellPath.compare(g,k)})};mxCompactTreeLayout.prototype.findRankHeights=function(a,b){if(null==this.maxRankHeight[b]||this.maxRankHeight[b]<a.height)this.maxRankHeight[b]=a.height;for(var c=a.child;null!=c;)this.findRankHeights(c,b+1),c=c.next};mxCompactTreeLayout.prototype.setCellHeights=function(a,b){null!=this.maxRankHeight[b]&&this.maxRankHeight[b]>a.height&&(a.height=this.maxRankHeight[b]);for(var c=a.child;null!=c;)this.setCellHeights(c,b+1),c=c.next};mxCompactTreeLayout.prototype.dfs=function(a,b){var c=mxCellPath.create(a),d=null;if(null!=a&&null==this.visited[c]&&!this.isVertexIgnored(a)){this.visited[c]=a;var d=this.createNode(a),c=this.graph.getModel(),e=null,f=this.graph.getEdges(a,b,this.invert,!this.invert,!1,!0),g=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(a,f);for(var k=0;k<f.length;k++){var l=f[k];if(!this.isEdgeIgnored(l)){this.resetEdges&&this.setEdgePoints(l,null);this.edgeRouting&&(this.setEdgeStyleEnabled(l,!1),this.setEdgePoints(l,null));var m=g.getState(l),l=null!=m?m.getVisibleTerminal(this.invert):g.getVisibleTerminal(l,this.invert),m=this.dfs(l,b);null!=m&&null!=c.getGeometry(l)&&(null==e?d.child=m:e.next=m,e=m)}}}return d};mxCompactTreeLayout.prototype.layout=function(a){if(null!=a){for(var b=a.child;null!=b;)this.layout(b),b=b.next;null!=a.child?this.attachParent(a,this.join(a)):this.layoutLeaf(a)}};mxCompactTreeLayout.prototype.horizontalLayout=function(a,b,c,d){a.x+=b+a.offsetX;a.y+=c+a.offsetY;d=this.apply(a,d);b=a.child;if(null!=b){d=this.horizontalLayout(b,a.x,a.y,d);c=a.y+b.offsetY;for(var e=b.next;null!=e;)d=this.horizontalLayout(e,a.x+b.offsetX,c,d),c+=e.offsetY,e=e.next}return d};mxCompactTreeLayout.prototype.verticalLayout=function(a,b,c,d,e){a.x+=c+a.offsetY;a.y+=d+a.offsetX;e=this.apply(a,e);b=a.child;if(null!=b)for(e=this.verticalLayout(b,a,a.x,a.y,e),c=a.x+b.offsetY,d=b.next;null!=d;)e=this.verticalLayout(d,a,c,a.y+b.offsetX,e),c+=d.offsetY,d=d.next;return e};mxCompactTreeLayout.prototype.attachParent=function(a,b){var c=this.nodeDistance+this.levelDistance,d=(b-a.width)/2-this.nodeDistance,e=d+a.width+2*this.nodeDistance-b;a.child.offsetX=c+a.height;a.child.offsetY=e;a.contour.upperHead=this.createLine(a.height,0,this.createLine(c,e,a.contour.upperHead));a.contour.lowerHead=this.createLine(a.height,0,this.createLine(c,d,a.contour.lowerHead))};
mxCompactTreeLayout.prototype.layoutLeaf=function(a){var b=2*this.nodeDistance;a.contour.upperTail=this.createLine(a.height+b,0);a.contour.upperHead=a.contour.upperTail;a.contour.lowerTail=this.createLine(0,-a.width-b);a.contour.lowerHead=this.createLine(a.height+b,0,a.contour.lowerTail)};mxCompactTreeLayout.prototype.join=function(a){var b=2*this.nodeDistance,c=a.child;a.contour=c.contour;for(var d=c.width+b,e=d,c=c.next;null!=c;){var f=this.merge(a.contour,c.contour);c.offsetY=f+d;c.offsetX=0;d=c.width+b;e+=f+d;c=c.next}return e};mxCompactTreeLayout.prototype.merge=function(a,b){for(var c=0,d=0,e=0,f=a.lowerHead,g=b.upperHead;null!=g&&null!=f;){var k=this.offset(c,d,g.dx,g.dy,f.dx,f.dy),d=d+k,e=e+k;c+g.dx<=f.dx?(c+=g.dx,d+=g.dy,g=g.next):(c-=f.dx,d-=f.dy,f=f.next)}null!=g?(c=this.bridge(a.upperTail,0,0,g,c,d),a.upperTail=null!=c.next?b.upperTail:c,a.lowerTail=b.lowerTail):(c=this.bridge(b.lowerTail,c,d,f,0,0),null==c.next&&(a.lowerTail=c));a.lowerHead=b.lowerHead;return e};mxCompactTreeLayout.prototype.offset=function(a,b,c,d,e,f){var g=0;if(e<=a||0>=a+c)return 0;g=0<e*d-c*f?0>a?a*d/c-b:0<a?a*f/e-b:-b:e<a+c?f-(b+(e-a)*d/c):e>a+c?(c+a)*f/e-(b+d):f-(b+d);return 0<g?g:0};mxCompactTreeLayout.prototype.bridge=function(a,b,c,d,e,f){b=e+d.dx-b;e=e=0;0==d.dx?e=d.dy:(e=b*d.dy,e/=d.dx);b=this.createLine(b,e,d.next);a.next=this.createLine(0,f+d.dy-e-c,b);return b};mxCompactTreeLayout.prototype.createNode=function(a){var b={};b.cell=a;b.x=0;b.y=0;b.width=0;b.height=0;a=this.getVertexBounds(a);null!=a&&(this.isHorizontal()?(b.width=a.height,b.height=a.width):(b.width=a.width,b.height=a.height));b.offsetX=0;b.offsetY=0;b.contour={};return b};mxCompactTreeLayout.prototype.apply=function(a,b){var c=this.graph.getModel(),d=a.cell,e=c.getGeometry(d);null!=d&&null!=e&&(this.isVertexMovable(d)&&(e=this.setVertexLocation(d,a.x,a.y),this.resizeParent&&(c=c.getParent(d),d=mxCellPath.create(c),null==this.parentsChanged[d]&&(this.parentsChanged[d]=c))),b=null==b?new mxRectangle(e.x,e.y,e.width,e.height):new mxRectangle(Math.min(b.x,e.x),Math.min(b.y,e.y),Math.max(b.x+b.width,e.x+e.width),Math.max(b.y+b.height,e.y+e.height)));return b};mxCompactTreeLayout.prototype.createLine=function(a,b,c){var d={};d.dx=a;d.dy=b;d.next=c;return d};mxCompactTreeLayout.prototype.adjustParents=function(){var a=[],b;for(b in this.parentsChanged)a.push(this.parentsChanged[b]);this.arrangeGroups(mxUtils.sortCells(a,!0),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)};mxCompactTreeLayout.prototype.localEdgeProcessing=function(a){this.processNodeOutgoing(a);for(a=a.child;null!=a;)this.localEdgeProcessing(a),a=a.next};mxCompactTreeLayout.prototype.processNodeOutgoing=function(a){for(var b=a.child,c=a.cell,d=0,e=[];null!=b;){d++;var f=b.x;this.horizontal&&(f=b.y);e.push(new WeightedCellSorter(b,f));b=b.next}e.sort(WeightedCellSorter.prototype.compare);var f=a.width,g=(d+1)*this.prefHozEdgeSep;f>g+2*this.prefHozEdgeSep&&(f-=2*this.prefHozEdgeSep);a=f/d;b=a/2;f>g+2*this.prefHozEdgeSep&&(b+=this.prefHozEdgeSep);for(var f=this.minEdgeJetty-this.prefVertEdgeOff,g=0,k=this.getVertexBounds(c),l=0;l<e.length;l++){for(var m=e[l].cell.cell,n=this.getVertexBounds(m),m=this.graph.getEdgesBetween(c,m,!1),p=[],q=0,u=0,v=0;v<m.length;v++)this.horizontal?(q=k.x+k.width,u=k.y+b,p.push(new mxPoint(q,u)),q=k.x+k.width+f,p.push(new mxPoint(q,u)),u=n.y+n.height/2):(q=k.x+b,u=k.y+k.height,p.push(new mxPoint(q,u)),u=k.y+k.height+f,p.push(new mxPoint(q,u)),q=n.x+n.width/2),p.push(new mxPoint(q,u)),this.setEdgePoints(m[v],p);l<d/2?f+=this.prefVertEdgeOff:l>d/2&&(f-=this.prefVertEdgeOff);b+=a;g=Math.max(g,f)}};function WeightedCellSorter(a,b){this.cell=a;this.weightedValue=b}WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.weightedValue>a.weightedValue?1:b.weightedValue<a.weightedValue?-1:b.nudge?1:-1:0};function mxRadialTreeLayout(a){mxCompactTreeLayout.call(this,a,!1)}
mxUtils.extend(mxRadialTreeLayout,mxCompactTreeLayout);mxRadialTreeLayout.prototype.angleOffset=0.5;mxRadialTreeLayout.prototype.rootx=0;mxRadialTreeLayout.prototype.rooty=0;mxRadialTreeLayout.prototype.levelDistance=10;mxRadialTreeLayout.prototype.nodeDistance=20;mxRadialTreeLayout.prototype.autoRadius=!1;mxRadialTreeLayout.prototype.sortEdges=!1;mxRadialTreeLayout.prototype.rowMinX=[];mxRadialTreeLayout.prototype.rowMaxX=[];mxRadialTreeLayout.prototype.rowMinCenX=[];mxRadialTreeLayout.prototype.rowMaxCenX=[];mxRadialTreeLayout.prototype.rowRadi=[];mxRadialTreeLayout.prototype.row=[];mxRadialTreeLayout.prototype.isVertexIgnored=function(a){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(a).length};mxRadialTreeLayout.prototype.execute=function(a,b){this.parent=a;this.edgeRouting=this.useBoundingBox=!1;this.levelDistance=120;this.nodeDistance=10;mxCompactTreeLayout.prototype.execute.apply(this,arguments);var c=null,d=this.getVertexBounds(this.root);this.centerX=d.x+d.width/2;this.centerY=d.y+d.height/2;for(var e in this.visited){var f=this.getVertexBounds(this.visited[e]),c=null!=c?c:f.clone();c.add(f)}this.calcRowDims([this.node],0);for(var g=0,k=0,c=0;c<this.row.length;c++)e=(this.rowMaxX[c]-
this.centerX-this.nodeDistance)/this.rowRadi[c],g=Math.max(g,(this.centerX-this.rowMinX[c]-this.nodeDistance)/this.rowRadi[c]),k=Math.max(k,e);for(c=0;c<this.row.length;c++){var l=this.centerX-this.nodeDistance-g*this.rowRadi[c],m=this.centerX+this.nodeDistance+k*this.rowRadi[c]-l;for(e=0;e<this.row[c].length;e++)f=this.row[c],d=f[e],f=this.getVertexBounds(d.cell),d.theta=(f.x+f.width/2-l)/m*Math.PI*2}for(c=this.row.length-2;0<=c;c--)for(f=this.row[c],e=0;e<f.length;e++){d=f[e];g=d.child;for(l=k=
0;null!=g;)l+=g.theta,k++,g=g.next;0<k&&(g=l/k,g>d.theta&&e<f.length-1?d.theta=Math.min(g,f[e+1].theta-Math.PI/10):g<d.theta&&0<e&&(d.theta=Math.max(g,f[e-1].theta+Math.PI/10)))}for(c=0;c<this.row.length;c++)for(e=0;e<this.row[c].length;e++)f=this.row[c],d=f[e],f=this.getVertexBounds(d.cell),this.setVertexLocation(d.cell,this.centerX-f.width/2+this.rowRadi[c]*Math.cos(d.theta),this.centerY-f.height/2+this.rowRadi[c]*Math.sin(d.theta))};mxRadialTreeLayout.prototype.calcRowDims=function(a,b){if(null!=a&&0!=a.length){this.rowMinX[b]=this.centerX;this.rowMaxX[b]=this.centerX;this.rowMinCenX[b]=this.centerX;this.rowMaxCenX[b]=this.centerX;this.row[b]=[];for(var c=!1,d=0;d<a.length;d++)for(var e=a[d].child;null!=e;)vertexBounds=this.getVertexBounds(e.cell),this.rowMinX[b]=Math.min(vertexBounds.x,this.rowMinX[b]),this.rowMaxX[b]=Math.max(vertexBounds.x+vertexBounds.width,this.rowMaxX[b]),this.rowMinCenX[b]=Math.min(vertexBounds.x+vertexBounds.width/
2,this.rowMinCenX[b]),this.rowMaxCenX[b]=Math.max(vertexBounds.x+vertexBounds.width/2,this.rowMaxCenX[b]),this.rowRadi[b]=vertexBounds.y-this.getVertexBounds(this.root).y,null!=e.child&&(c=!0),this.row[b].push(e),e=e.next;c&&this.calcRowDims(this.row[b],b+1)}};function mxFastOrganicLayout(a){mxGraphLayout.call(this,a)}mxFastOrganicLayout.prototype=new mxGraphLayout;mxFastOrganicLayout.prototype.constructor=mxFastOrganicLayout;mxFastOrganicLayout.prototype.useInputOrigin=!0;mxFastOrganicLayout.prototype.resetEdges=!0;mxFastOrganicLayout.prototype.disableEdgeStyle=!0;mxFastOrganicLayout.prototype.forceConstant=50;mxFastOrganicLayout.prototype.forceConstantSquared=0;mxFastOrganicLayout.prototype.minDistanceLimit=2;mxFastOrganicLayout.prototype.maxDistanceLimit=500;mxFastOrganicLayout.prototype.minDistanceLimitSquared=4;mxFastOrganicLayout.prototype.initialTemp=200;mxFastOrganicLayout.prototype.temperature=0;mxFastOrganicLayout.prototype.maxIterations=0;mxFastOrganicLayout.prototype.iteration=0;mxFastOrganicLayout.prototype.allowedToRun=!0;mxFastOrganicLayout.prototype.isVertexIgnored=function(a){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(a).length};mxFastOrganicLayout.prototype.execute=function(a){var b=this.graph.getModel();this.vertexArray=[];for(var c=this.graph.getChildVertices(a),d=0;d<c.length;d++)this.isVertexIgnored(c[d])||this.vertexArray.push(c[d]);var e=this.useInputOrigin?this.graph.getBoundingBoxFromGeometry(this.vertexArray):null,f=this.vertexArray.length;this.indices=[];this.dispX=[];this.dispY=[];this.cellLocation=[];this.isMoveable=[];this.neighbours=[];this.radius=[];this.radiusSquared=[];0.001>this.forceConstant&&(this.forceConstant=0.001);this.forceConstantSquared=this.forceConstant*this.forceConstant;for(d=0;d<this.vertexArray.length;d++){var g=this.vertexArray[d];this.cellLocation[d]=[];var k=mxCellPath.create(g);this.indices[k]=d;var l=this.getVertexBounds(g),m=l.width,n=l.height,p=l.x,q=l.y;this.cellLocation[d][0]=p+m/2;this.cellLocation[d][1]=q+n/2;this.radius[d]=Math.min(m,n);this.radiusSquared[d]=this.radius[d]*this.radius[d]}b.beginUpdate();try{for(d=0;d<f;d++){this.dispX[d]=0;this.dispY[d]=0;this.isMoveable[d]=this.isVertexMovable(this.vertexArray[d]);var u=this.graph.getConnections(this.vertexArray[d],a),c=this.graph.getOpposites(u,this.vertexArray[d]);this.neighbours[d]=[];for(m=0;m<c.length;m++){this.resetEdges&&this.graph.resetEdge(u[m]);this.disableEdgeStyle&&this.setEdgeStyleEnabled(u[m],!1);var k=mxCellPath.create(c[m]),v=this.indices[k];this.neighbours[d][m]=null!=v?v:d}}this.temperature=this.initialTemp;0==this.maxIterations&&(this.maxIterations=20*Math.sqrt(f));for(this.iteration=0;this.iteration<this.maxIterations;this.iteration++){if(!this.allowedToRun)return;this.calcRepulsion();this.calcAttraction();this.calcPositions();this.reduceTemperature()}a=c=null;for(d=0;d<this.vertexArray.length;d++)g=this.vertexArray[d],this.isVertexMovable(g)&&(l=this.getVertexBounds(g),null!=l&&(this.cellLocation[d][0]-=l.width/2,this.cellLocation[d][1]-=l.height/2,p=this.graph.snap(this.cellLocation[d][0]),q=this.graph.snap(this.cellLocation[d][1]),this.setVertexLocation(g,p,q),c=null==c?p:Math.min(c,p),a=null==a?q:Math.min(a,q)));d=-(c||0)+1;g=-(a||0)+1;null!=e&&(d+=e.x,g+=e.y);this.graph.moveCells(this.vertexArray,d,g)}finally{b.endUpdate()}};mxFastOrganicLayout.prototype.calcPositions=function(){for(var a=0;a<this.vertexArray.length;a++)if(this.isMoveable[a]){var b=Math.sqrt(this.dispX[a]*this.dispX[a]+this.dispY[a]*this.dispY[a]);0.001>b&&(b=0.001);var c=this.dispX[a]/b*Math.min(b,this.temperature),b=this.dispY[a]/b*Math.min(b,this.temperature);this.dispX[a]=0;this.dispY[a]=0;this.cellLocation[a][0]+=c;this.cellLocation[a][1]+=b}};mxFastOrganicLayout.prototype.calcAttraction=function(){for(var a=0;a<this.vertexArray.length;a++)for(var b=0;b<this.neighbours[a].length;b++){var c=this.neighbours[a][b];if(a!=c&&this.isMoveable[a]&&this.isMoveable[c]){var d=this.cellLocation[a][0]-this.cellLocation[c][0],e=this.cellLocation[a][1]-this.cellLocation[c][1],f=d*d+e*e-this.radiusSquared[a]-this.radiusSquared[c];f<this.minDistanceLimitSquared&&(f=this.minDistanceLimitSquared);var g=Math.sqrt(f),f=f/this.forceConstant,d=d/g*f,e=e/g*f;this.dispX[a]-=d;this.dispY[a]-=e;this.dispX[c]+=d;this.dispY[c]+=e}}};mxFastOrganicLayout.prototype.calcRepulsion=function(){for(var a=this.vertexArray.length,b=0;b<a;b++)for(var c=b;c<a;c++){if(!this.allowedToRun)return;if(c!=b&&this.isMoveable[b]&&this.isMoveable[c]){var d=this.cellLocation[b][0]-this.cellLocation[c][0],e=this.cellLocation[b][1]-this.cellLocation[c][1];0==d&&(d=0.01+Math.random());0==e&&(e=0.01+Math.random());var f=Math.sqrt(d*d+e*e),g=f-this.radius[b]-this.radius[c];g>this.maxDistanceLimit||(g<this.minDistanceLimit&&(g=this.minDistanceLimit),g=this.forceConstantSquared/
g,d=d/f*g,e=e/f*g,this.dispX[b]+=d,this.dispY[b]+=e,this.dispX[c]-=d,this.dispY[c]-=e)}}};mxFastOrganicLayout.prototype.reduceTemperature=function(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)};function mxCircleLayout(a,b){mxGraphLayout.call(this,a);this.radius=null!=b?b:100}mxCircleLayout.prototype=new mxGraphLayout;mxCircleLayout.prototype.constructor=mxCircleLayout;mxCircleLayout.prototype.radius=null;mxCircleLayout.prototype.moveCircle=!1;mxCircleLayout.prototype.x0=0;mxCircleLayout.prototype.y0=0;mxCircleLayout.prototype.resetEdges=!0;mxCircleLayout.prototype.disableEdgeStyle=!0;mxCircleLayout.prototype.execute=function(a){var b=this.graph.getModel();b.beginUpdate();try{for(var c=0,d=null,e=null,f=[],g=b.getChildCount(a),k=0;k<g;k++){var l=b.getChildAt(a,k);if(this.isVertexIgnored(l))this.isEdgeIgnored(l)||(this.resetEdges&&this.graph.resetEdge(l),this.disableEdgeStyle&&this.setEdgeStyleEnabled(l,!1));else{f.push(l);var m=this.getVertexBounds(l),d=null==d?m.y:Math.min(d,m.y),e=null==e?m.x:Math.min(e,m.x),c=Math.max(c,Math.max(m.width,m.height))}}var n=this.getRadius(f.length,c);this.moveCircle&&(e=this.x0,d=this.y0);this.circle(f,n,e,d)}finally{b.endUpdate()}};mxCircleLayout.prototype.getRadius=function(a,b){return Math.max(a*b/Math.PI,this.radius)};mxCircleLayout.prototype.circle=function(a,b,c,d){for(var e=a.length,f=2*Math.PI/e,g=0;g<e;g++)this.isVertexMovable(a[g])&&this.setVertexLocation(a[g],c+b+b*Math.sin(g*f),d+b+b*Math.cos(g*f))};function mxParallelEdgeLayout(a){mxGraphLayout.call(this,a)}mxParallelEdgeLayout.prototype=new mxGraphLayout;mxParallelEdgeLayout.prototype.constructor=mxParallelEdgeLayout;mxParallelEdgeLayout.prototype.spacing=20;mxParallelEdgeLayout.prototype.execute=function(a){a=this.findParallels(a);this.graph.model.beginUpdate();try{for(var b in a){var c=a[b];1<c.length&&this.layout(c)}}finally{this.graph.model.endUpdate()}};mxParallelEdgeLayout.prototype.findParallels=function(a){for(var b=this.graph.getModel(),c=[],d=b.getChildCount(a),e=0;e<d;e++){var f=b.getChildAt(a,e);if(!this.isEdgeIgnored(f)){var g=this.getEdgeId(f);null!=g&&(null==c[g]&&(c[g]=[]),c[g].push(f))}}return c};mxParallelEdgeLayout.prototype.getEdgeId=function(a){var b=this.graph.getView(),c=b.getVisibleTerminal(a,!0);a=b.getVisibleTerminal(a,!1);return null!=c&&null!=a?(c=mxCellPath.create(c),a=mxCellPath.create(a),c>a?a+"-"+c:c+"-"+a):null};mxParallelEdgeLayout.prototype.layout=function(a){var b=a[0],c=this.graph.getView(),d=this.graph.getModel(),e=d.getGeometry(c.getVisibleTerminal(b,!0)),d=d.getGeometry(c.getVisibleTerminal(b,!1));if(e==d)for(var b=e.x+e.width+this.spacing,c=e.y+e.height/2,f=0;f<a.length;f++)this.route(a[f],b,c),b+=this.spacing;else if(null!=e&&null!=d){var b=e.x+e.width/2,c=e.y+e.height/2,f=d.x+d.width/2-b,g=d.y+d.height/2-c,d=Math.sqrt(f*f+g*g);if(0<d)for(e=g*this.spacing/d,d=f*this.spacing/d,b=b+f/2+e*(a.length-
1)/2,c=c+g/2-d*(a.length-1)/2,f=0;f<a.length;f++)this.route(a[f],b,c),b-=e,c+=d}};mxParallelEdgeLayout.prototype.route=function(a,b,c){this.graph.isCellMovable(a)&&this.setEdgePoints(a,[new mxPoint(b,c)])};function mxCompositeLayout(a,b,c){mxGraphLayout.call(this,a);this.layouts=b;this.master=c}mxCompositeLayout.prototype=new mxGraphLayout;mxCompositeLayout.prototype.constructor=mxCompositeLayout;mxCompositeLayout.prototype.layouts=null;mxCompositeLayout.prototype.master=null;
mxCompositeLayout.prototype.moveCell=function(a,b,c){null!=this.master?this.master.move.apply(this.master,arguments):this.layouts[0].move.apply(this.layouts[0],arguments)};mxCompositeLayout.prototype.execute=function(a){var b=this.graph.getModel();b.beginUpdate();try{for(var c=0;c<this.layouts.length;c++)this.layouts[c].execute.apply(this.layouts[c],arguments)}finally{b.endUpdate()}};function mxEdgeLabelLayout(a,b){mxGraphLayout.call(this,a)}mxEdgeLabelLayout.prototype=new mxGraphLayout;mxEdgeLabelLayout.prototype.constructor=mxEdgeLabelLayout;mxEdgeLabelLayout.prototype.execute=function(a){for(var b=this.graph.view,c=this.graph.getModel(),d=[],e=[],f=c.getChildCount(a),g=0;g<f;g++){var k=c.getChildAt(a,g),l=b.getState(k);null!=l&&(this.isVertexIgnored(k)?this.isEdgeIgnored(k)||d.push(l):e.push(l))}this.placeLabels(e,d)};mxEdgeLabelLayout.prototype.placeLabels=function(a,b){var c=this.graph.getModel();c.beginUpdate();try{for(var d=0;d<b.length;d++){var e=b[d];if(null!=e&&null!=e.text&&null!=e.text.boundingBox)for(var f=0;f<a.length;f++){var g=a[f];null!=g&&this.avoid(e,g)}}}finally{c.endUpdate()}};mxEdgeLabelLayout.prototype.avoid=function(a,b){var c=this.graph.getModel(),d=a.text.boundingBox;if(mxUtils.intersects(d,b)){var e=-d.y-d.height+b.y,f=-d.y+b.y+b.height,e=Math.abs(e)<Math.abs(f)?e:f,f=-d.x-d.width+b.x,d=-d.x+b.x+b.width,d=Math.abs(f)<Math.abs(d)?f:d;Math.abs(d)<Math.abs(e)?e=0:d=0;f=c.getGeometry(a.cell);null!=f&&(f=f.clone(),null!=f.offset?(f.offset.x+=d,f.offset.y+=e):f.offset=new mxPoint(d,e),c.setGeometry(a.cell,f))}};function mxGraphAbstractHierarchyCell(){this.x=[];this.y=[];this.temp=[]}mxGraphAbstractHierarchyCell.prototype.maxRank=-1;mxGraphAbstractHierarchyCell.prototype.minRank=-1;mxGraphAbstractHierarchyCell.prototype.x=null;mxGraphAbstractHierarchyCell.prototype.y=null;mxGraphAbstractHierarchyCell.prototype.width=0;mxGraphAbstractHierarchyCell.prototype.height=0;mxGraphAbstractHierarchyCell.prototype.nextLayerConnectedCells=null;mxGraphAbstractHierarchyCell.prototype.previousLayerConnectedCells=null;mxGraphAbstractHierarchyCell.prototype.temp=null;mxGraphAbstractHierarchyCell.prototype.getNextLayerConnectedCells=function(a){return null};mxGraphAbstractHierarchyCell.prototype.getPreviousLayerConnectedCells=function(a){return null};mxGraphAbstractHierarchyCell.prototype.isEdge=function(){return!1};mxGraphAbstractHierarchyCell.prototype.isVertex=function(){return!1};mxGraphAbstractHierarchyCell.prototype.getGeneralPurposeVariable=function(a){return null};mxGraphAbstractHierarchyCell.prototype.setGeneralPurposeVariable=function(a,b){return null};mxGraphAbstractHierarchyCell.prototype.setX=function(a,b){this.isVertex()?this.x[0]=b:this.isEdge()&&(this.x[a-this.minRank-1]=b)};mxGraphAbstractHierarchyCell.prototype.getX=function(a){return this.isVertex()?this.x[0]:this.isEdge()?this.x[a-this.minRank-1]:0};mxGraphAbstractHierarchyCell.prototype.setY=function(a,b){this.isVertex()?this.y[0]=b:this.isEdge()&&(this.y[a-this.minRank-1]=b)};function mxGraphHierarchyNode(a){mxGraphAbstractHierarchyCell.apply(this,arguments);this.cell=a;this.id=mxObjectIdentity.get(a);this.connectsAsTarget=[];this.connectsAsSource=[]}mxGraphHierarchyNode.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyNode.prototype.constructor=mxGraphHierarchyNode;mxGraphHierarchyNode.prototype.cell=null;mxGraphHierarchyNode.prototype.id=null;mxGraphHierarchyNode.prototype.connectsAsTarget=null;mxGraphHierarchyNode.prototype.connectsAsSource=null;mxGraphHierarchyNode.prototype.hashCode=!1;mxGraphHierarchyNode.prototype.getRankValue=function(a){return this.maxRank};mxGraphHierarchyNode.prototype.getNextLayerConnectedCells=function(a){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];this.nextLayerConnectedCells[0]=[];for(var b=0;b<this.connectsAsTarget.length;b++){var c=this.connectsAsTarget[b];-1==c.maxRank||c.maxRank==a+1?this.nextLayerConnectedCells[0].push(c.source):this.nextLayerConnectedCells[0].push(c)}}return this.nextLayerConnectedCells[0]};mxGraphHierarchyNode.prototype.getPreviousLayerConnectedCells=function(a){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];this.previousLayerConnectedCells[0]=[];for(var b=0;b<this.connectsAsSource.length;b++){var c=this.connectsAsSource[b];-1==c.minRank||c.minRank==a-1?this.previousLayerConnectedCells[0].push(c.target):this.previousLayerConnectedCells[0].push(c)}}return this.previousLayerConnectedCells[0]};mxGraphHierarchyNode.prototype.isVertex=function(){return!0};mxGraphHierarchyNode.prototype.getGeneralPurposeVariable=function(a){return this.temp[0]};mxGraphHierarchyNode.prototype.setGeneralPurposeVariable=function(a,b){this.temp[0]=b};mxGraphHierarchyNode.prototype.isAncestor=function(a){if(null!=a&&null!=this.hashCode&&null!=a.hashCode&&this.hashCode.length<a.hashCode.length){if(this.hashCode==a.hashCode)return!0;if(null==this.hashCode||null==this.hashCode)return!1;for(var b=0;b<this.hashCode.length;b++)if(this.hashCode[b]!=a.hashCode[b])return!1;return!0}return!1};mxGraphHierarchyNode.prototype.getCoreCell=function(){return this.cell};function mxGraphHierarchyEdge(a){mxGraphAbstractHierarchyCell.apply(this,arguments);this.edges=a;this.ids=[];for(var b=0;b<a.length;b++)this.ids.push(mxObjectIdentity.get(a[b]))}mxGraphHierarchyEdge.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyEdge.prototype.constructor=mxGraphHierarchyEdge;mxGraphHierarchyEdge.prototype.edges=null;mxGraphHierarchyEdge.prototype.ids=null;mxGraphHierarchyEdge.prototype.source=null;mxGraphHierarchyEdge.prototype.target=null;mxGraphHierarchyEdge.prototype.isReversed=!1;mxGraphHierarchyEdge.prototype.invert=function(a){a=this.source;this.source=this.target;this.target=a;this.isReversed=!this.isReversed};mxGraphHierarchyEdge.prototype.getNextLayerConnectedCells=function(a){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];for(var b=0;b<this.temp.length;b++)this.nextLayerConnectedCells[b]=[],b==this.temp.length-1?this.nextLayerConnectedCells[b].push(this.source):this.nextLayerConnectedCells[b].push(this)}return this.nextLayerConnectedCells[a-this.minRank-1]};mxGraphHierarchyEdge.prototype.getPreviousLayerConnectedCells=function(a){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];for(var b=0;b<this.temp.length;b++)this.previousLayerConnectedCells[b]=[],0==b?this.previousLayerConnectedCells[b].push(this.target):this.previousLayerConnectedCells[b].push(this)}return this.previousLayerConnectedCells[a-this.minRank-1]};mxGraphHierarchyEdge.prototype.isEdge=function(){return!0};mxGraphHierarchyEdge.prototype.getGeneralPurposeVariable=function(a){return this.temp[a-this.minRank-1]};mxGraphHierarchyEdge.prototype.setGeneralPurposeVariable=function(a,b){this.temp[a-this.minRank-1]=b};mxGraphHierarchyEdge.prototype.getCoreCell=function(){return null!=this.edges&&0<this.edges.length?this.edges[0]:null};function mxGraphHierarchyModel(a,b,c,d,e){a.getGraph();this.tightenToSource=e;this.roots=c;this.parent=d;this.vertexMapper=new mxDictionary;this.edgeMapper=new mxDictionary;this.maxRank=0;c=[];null==b&&(b=this.graph.getChildVertices(d));this.maxRank=this.SOURCESCANSTARTRANK;this.createInternalCells(a,b,c);for(d=0;d<b.length;d++){e=c[d].connectsAsSource;for(var f=0;f<e.length;f++){var g=e[f],k=g.edges;if(null!=k&&0<k.length){var k=k[0],l=a.getVisibleTerminal(k,!1),l=this.vertexMapper.get(l);c[d]==l&&(l=a.getVisibleTerminal(k,!0),l=this.vertexMapper.get(l));null!=l&&c[d]!=l&&(g.target=l,0==l.connectsAsTarget.length&&(l.connectsAsTarget=[]),0>mxUtils.indexOf(l.connectsAsTarget,g)&&l.connectsAsTarget.push(g))}}c[d].temp[0]=1}}mxGraphHierarchyModel.prototype.maxRank=null;mxGraphHierarchyModel.prototype.vertexMapper=null;mxGraphHierarchyModel.prototype.edgeMapper=null;mxGraphHierarchyModel.prototype.ranks=null;mxGraphHierarchyModel.prototype.roots=null;mxGraphHierarchyModel.prototype.parent=null;mxGraphHierarchyModel.prototype.dfsCount=0;mxGraphHierarchyModel.prototype.SOURCESCANSTARTRANK=1E8;mxGraphHierarchyModel.prototype.tightenToSource=!1;mxGraphHierarchyModel.prototype.createInternalCells=function(a,b,c){for(var d=a.getGraph(),e=0;e<b.length;e++){c[e]=new mxGraphHierarchyNode(b[e]);this.vertexMapper.put(b[e],c[e]);var f=a.getEdges(b[e]);c[e].connectsAsSource=[];for(var g=0;g<f.length;g++){var k=a.getVisibleTerminal(f[g],!1);if(k!=b[e]&&a.graph.model.isVertex(k)&&!a.isVertexIgnored(k)){var l=a.getEdgesBetween(b[e],k,!1),k=a.getEdgesBetween(b[e],k,!0);if(null!=l&&0<l.length&&null==this.edgeMapper.get(l[0])&&2*k.length>=l.length){for(var k=new mxGraphHierarchyEdge(l),m=0;m<l.length;m++){var n=l[m];this.edgeMapper.put(n,k);d.resetEdge(n);a.disableEdgeStyle&&(a.setEdgeStyleEnabled(n,!1),a.setOrthogonalEdge(n,!0))}k.source=c[e];0>mxUtils.indexOf(c[e].connectsAsSource,k)&&c[e].connectsAsSource.push(k)}}}c[e].temp[0]=0}};mxGraphHierarchyModel.prototype.initialRank=function(){var a=[];if(null!=this.roots)for(var b=0;b<this.roots.length;b++){var c=this.vertexMapper.get(this.roots[b]);null!=c&&a.push(c)}for(var d=this.vertexMapper.getValues(),b=0;b<d.length;b++)d[b].temp[0]=-1;for(var e=a.slice();0<a.length;){var c=a[0],f,g;f=c.connectsAsTarget;g=c.connectsAsSource;for(var k=!0,l=this.SOURCESCANSTARTRANK,b=0;b<f.length;b++){var m=f[b];if(5270620==m.temp[0])m=m.source,l=Math.min(l,m.temp[0]-1);else{k=!1;break}}if(k){c.temp[0]=l;this.maxRank=Math.min(this.maxRank,l);if(null!=g)for(b=0;b<g.length;b++)m=g[b],m.temp[0]=5270620,m=m.target,-1==m.temp[0]&&(a.push(m),m.temp[0]=-2);a.shift()}else if(b=a.shift(),a.push(c),b==c&&1==a.length)break}for(b=0;b<d.length;b++)d[b].temp[0]-=this.maxRank;for(b=0;b<e.length;b++)for(c=e[b],a=0,f=c.connectsAsSource,d=0;d<f.length;d++)m=f[d],m=m.target,c.temp[0]=Math.max(a,m.temp[0]+1),a=c.temp[0];this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank};mxGraphHierarchyModel.prototype.fixRanks=function(){var a=[];this.ranks=[];for(var b=0;b<this.maxRank+1;b++)a[b]=[],this.ranks[b]=a[b];var c=null;if(null!=this.roots)for(var d=this.roots,c=[],b=0;b<d.length;b++){var e=this.vertexMapper.get(d[b]);c[b]=e}this.visit(function(b,c,d,e,m){0==m&&0>c.maxRank&&0>c.minRank&&(a[c.temp[0]].push(c),c.maxRank=c.temp[0],c.minRank=c.temp[0],c.temp[0]=a[c.maxRank].length-1);if(null!=b&&null!=d&&1<b.maxRank-c.maxRank)for(d.maxRank=b.maxRank,d.minRank=c.maxRank,d.temp=[],d.x=[],d.y=[],b=d.minRank+1;b<d.maxRank;b++)a[b].push(d),d.setGeneralPurposeVariable(b,a[b].length-1)},c,!1,null)};mxGraphHierarchyModel.prototype.visit=function(a,b,c,d){if(null!=b){for(var e=0;e<b.length;e++){var f=b[e];null!=f&&(null==d&&(d={}),c?(f.hashCode=[],f.hashCode[0]=this.dfsCount,f.hashCode[1]=e,this.extendedDfs(null,f,null,a,d,f.hashCode,e,0)):this.dfs(null,f,null,a,d,0))}this.dfsCount++}};mxGraphHierarchyModel.prototype.dfs=function(a,b,c,d,e,f){if(null!=b){var g=b.id;if(null==e[g])for(e[g]=b,d(a,b,c,f,0),a=b.connectsAsSource.slice(),c=0;c<a.length;c++)g=a[c],this.dfs(b,g.target,g,d,e,f+1);else d(a,b,c,f,1)}};mxGraphHierarchyModel.prototype.extendedDfs=function(a,b,c,d,e,f,g,k){if(null!=b)if(null==a||null!=b.hashCode&&b.hashCode[0]==a.hashCode[0]||(f=a.hashCode.length+1,b.hashCode=a.hashCode.slice(),b.hashCode[f-1]=g),g=b.id,null==e[g])for(e[g]=b,d(a,b,c,k,0),a=b.connectsAsSource.slice(),c=0;c<a.length;c++)g=a[c],this.extendedDfs(b,g.target,g,d,e,b.hashCode,c,k+1);else d(a,b,c,k,1)};function mxSwimlaneModel(a,b,c,d,e){a.getGraph();this.tightenToSource=e;this.roots=c;this.parent=d;this.vertexMapper={};this.edgeMapper={};this.maxRank=0;c=[];null==b&&(b=this.graph.getChildVertices(d));this.maxRank=this.SOURCESCANSTARTRANK;this.createInternalCells(a,b,c);for(d=0;d<b.length;d++){e=c[d].connectsAsSource;for(var f=0;f<e.length;f++){var g=e[f],k=g.edges;if(null!=k&&0<k.length){var k=k[0],l=a.getVisibleTerminal(k,!1),l=mxCellPath.create(l),l=this.vertexMapper[l];c[d]==l&&(l=a.getVisibleTerminal(k,!0),l=mxCellPath.create(l),l=this.vertexMapper[l]);null!=l&&c[d]!=l&&(g.target=l,0==l.connectsAsTarget.length&&(l.connectsAsTarget=[]),0>mxUtils.indexOf(l.connectsAsTarget,g)&&l.connectsAsTarget.push(g))}}c[d].temp[0]=1}}mxSwimlaneModel.prototype.maxRank=null;mxSwimlaneModel.prototype.vertexMapper=null;mxSwimlaneModel.prototype.edgeMapper=null;mxSwimlaneModel.prototype.ranks=null;mxSwimlaneModel.prototype.roots=null;mxSwimlaneModel.prototype.parent=null;mxSwimlaneModel.prototype.dfsCount=0;mxSwimlaneModel.prototype.SOURCESCANSTARTRANK=1E8;mxSwimlaneModel.prototype.ranksPerGroup=null;mxSwimlaneModel.prototype.createInternalCells=function(a,b,c){for(var d=a.getGraph(),e=a.swimlanes,f=0;f<b.length;f++){c[f]=new mxGraphHierarchyNode(b[f]);var g=mxCellPath.create(b[f]);this.vertexMapper[g]=c[f];c[f].swimlaneIndex=-1;for(g=0;g<e.length;g++)if(d.model.getParent(b[f])==e[g]){c[f].swimlaneIndex=g;break}g=a.getEdges(b[f]);c[f].connectsAsSource=[];for(var k=0;k<g.length;k++){var l=a.getVisibleTerminal(g[k],!1);if(l!=b[f]&&a.graph.model.isVertex(l)&&!a.isVertexIgnored(l)){var m=a.getEdgesBetween(b[f],l,!1),n=a.getEdgesBetween(b[f],l,!0),l=mxCellPath.create(m[0]);if(null!=m&&0<m.length&&null==this.edgeMapper[l]&&2*n.length>=m.length){for(var n=new mxGraphHierarchyEdge(m),p=0;p<m.length;p++){var q=m[p],l=mxCellPath.create(q);this.edgeMapper[l]=n;d.resetEdge(q);a.disableEdgeStyle&&(a.setEdgeStyleEnabled(q,!1),a.setOrthogonalEdge(q,!0))}n.source=c[f];0>mxUtils.indexOf(c[f].connectsAsSource,n)&&c[f].connectsAsSource.push(n)}}}c[f].temp[0]=0}};mxSwimlaneModel.prototype.initialRank=function(){this.ranksPerGroup=[];var a=[],b={};if(null!=this.roots)for(var c=0;c<this.roots.length;c++){var d=mxCellPath.create(this.roots[c]),d=this.vertexMapper[d];this.maxChainDfs(null,d,null,b,0);null!=d&&a.push(d)}d=[];b=[];for(c=this.ranksPerGroup.length-1;0<=c;c--)d[c]=c==this.ranksPerGroup.length-1?0:b[c+1]+1,b[c]=d[c]+this.ranksPerGroup[c];this.maxRank=b[0];for(var e in this.vertexMapper)d=this.vertexMapper[e],d.temp[0]=-1;for(a.slice();0<a.length;){var d=a[0],f;e=d.connectsAsTarget;f=d.connectsAsSource;for(var g=!0,k=b[0],c=0;c<e.length;c++){var l=e[c];if(5270620==l.temp[0])l=l.source,k=Math.min(k,l.temp[0]-1);else{g=!1;break}}if(g){k>b[d.swimlaneIndex]&&(k=b[d.swimlaneIndex]);d.temp[0]=k;if(null!=f)for(c=0;c<f.length;c++)l=f[c],l.temp[0]=5270620,l=l.target,-1==l.temp[0]&&(a.push(l),l.temp[0]=-2);a.shift()}else if(c=a.shift(),a.push(d),c==d&&1==a.length)break}};mxSwimlaneModel.prototype.maxChainDfs=function(a,b,c,d,e){if(null!=b&&(a=mxCellPath.create(b.cell),null==d[a])){d[a]=b;a=b.swimlaneIndex;if(null==this.ranksPerGroup[a]||this.ranksPerGroup[a]<e)this.ranksPerGroup[a]=e;a=b.connectsAsSource.slice();for(c=0;c<a.length;c++){var f=a[c],g=f.target;b.swimlaneIndex<g.swimlaneIndex?this.maxChainDfs(b,g,f,mxUtils.clone(d,null,!0),0):b.swimlaneIndex==g.swimlaneIndex&&this.maxChainDfs(b,g,f,mxUtils.clone(d,null,!0),e+1)}}};mxSwimlaneModel.prototype.fixRanks=function(){var a=[];this.ranks=[];for(var b=0;b<this.maxRank+1;b++)a[b]=[],this.ranks[b]=a[b];var c=null;if(null!=this.roots)for(var d=this.roots,c=[],b=0;b<d.length;b++){var e=mxCellPath.create(d[b]);c[b]=this.vertexMapper[e]}this.visit(function(b,c,d,e,m){0==m&&0>c.maxRank&&0>c.minRank&&(null==a[c.temp[0]]&&mxLog.show(),a[c.temp[0]].push(c),c.maxRank=c.temp[0],c.minRank=c.temp[0],c.temp[0]=a[c.maxRank].length-1);if(null!=b&&null!=d&&1<b.maxRank-c.maxRank)for(d.maxRank=b.maxRank,d.minRank=c.maxRank,d.temp=[],d.x=[],d.y=[],b=d.minRank+1;b<d.maxRank;b++)a[b].push(d),d.setGeneralPurposeVariable(b,a[b].length-1)},c,!1,null)};mxSwimlaneModel.prototype.visit=function(a,b,c,d){if(null!=b){for(var e=0;e<b.length;e++){var f=b[e];null!=f&&(null==d&&(d={}),c?(f.hashCode=[],f.hashCode[0]=this.dfsCount,f.hashCode[1]=e,this.extendedDfs(null,f,null,a,d,f.hashCode,e,0)):this.dfs(null,f,null,a,d,0))}this.dfsCount++}};mxSwimlaneModel.prototype.dfs=function(a,b,c,d,e,f){if(null!=b){var g=mxCellPath.create(b.cell);if(null==e[g])for(e[g]=b,d(a,b,c,f,0),a=b.connectsAsSource.slice(),c=0;c<a.length;c++)g=a[c],this.dfs(b,g.target,g,d,e,f+1);else d(a,b,c,f,1)}};mxSwimlaneModel.prototype.extendedDfs=function(a,b,c,d,e,f,g,k){if(null!=b)if(null==a||null!=b.hashCode&&b.hashCode[0]==a.hashCode[0]||(f=a.hashCode.length+1,b.hashCode=a.hashCode.slice(),b.hashCode[f-1]=g),g=mxCellPath.create(b.cell),null==e[g]){e[g]=b;d(a,b,c,k,0);a=b.connectsAsSource.slice();c=b.connectsAsTarget.slice();for(g=0;g<a.length;g++){f=a[g];var l=f.target;null==l&&mxLog.show();b.swimlaneIndex<=l.swimlaneIndex&&this.extendedDfs(b,l,f,d,e,b.hashCode,g,k+1)}for(g=0;g<c.length;g++)f=c[g],l=f.source,b.swimlaneIndex<l.swimlaneIndex&&this.extendedDfs(b,l,f,d,e,b.hashCode,g,k+1)}else d(a,b,c,k,1)};function mxHierarchicalLayoutStage(){}mxHierarchicalLayoutStage.prototype.execute=function(a){};function mxMedianHybridCrossingReduction(a){this.layout=a}mxMedianHybridCrossingReduction.prototype=new mxHierarchicalLayoutStage;mxMedianHybridCrossingReduction.prototype.constructor=mxMedianHybridCrossingReduction;mxMedianHybridCrossingReduction.prototype.layout=null;mxMedianHybridCrossingReduction.prototype.maxIterations=24;mxMedianHybridCrossingReduction.prototype.nestedBestRanks=null;mxMedianHybridCrossingReduction.prototype.currentBestCrossings=0;mxMedianHybridCrossingReduction.prototype.iterationsWithoutImprovement=0;mxMedianHybridCrossingReduction.prototype.maxNoImprovementIterations=2;mxMedianHybridCrossingReduction.prototype.execute=function(a){a=this.layout.getModel();this.nestedBestRanks=[];for(var b=0;b<a.ranks.length;b++)this.nestedBestRanks[b]=a.ranks[b].slice();for(var c=0,d=this.calculateCrossings(a),b=0;b<this.maxIterations&&c<this.maxNoImprovementIterations;b++){this.weightedMedian(b,a);this.transpose(b,a);var e=this.calculateCrossings(a);if(e<d)for(d=e,e=c=0;e<this.nestedBestRanks.length;e++)for(var f=a.ranks[e],g=0;g<f.length;g++){var k=f[g];this.nestedBestRanks[e][k.getGeneralPurposeVariable(e)]=k}else for(c++,e=0;e<this.nestedBestRanks.length;e++)for(f=a.ranks[e],g=0;g<f.length;g++)k=f[g],k.setGeneralPurposeVariable(e,g);if(0==d)break}c=[];d=[];for(b=0;b<a.maxRank+1;b++)d[b]=[],c[b]=d[b];for(b=0;b<this.nestedBestRanks.length;b++)for(e=0;e<this.nestedBestRanks[b].length;e++)d[b].push(this.nestedBestRanks[b][e]);a.ranks=c};mxMedianHybridCrossingReduction.prototype.calculateCrossings=function(a){for(var b=a.ranks.length,c=0,d=1;d<b;d++)c+=this.calculateRankCrossing(d,a);return c};mxMedianHybridCrossingReduction.prototype.calculateRankCrossing=function(a,b){for(var c=0,d=b.ranks[a],e=b.ranks[a-1],f=[],g=0;g<d.length;g++){for(var k=d[g],l=k.getGeneralPurposeVariable(a),k=k.getPreviousLayerConnectedCells(a),m=[],n=0;n<k.length;n++){var p=k[n].getGeneralPurposeVariable(a-1);m.push(p)}m.sort(function(a,b){return a-b});f[l]=m}d=[];for(g=0;g<f.length;g++)d=d.concat(f[g]);for(f=1;f<e.length;)f<<=1;l=2*f-1;f-=1;e=[];for(g=0;g<l;++g)e[g]=0;for(g=0;g<d.length;g++)for(l=d[g]+f,++e[l];0<l;)l%2&&(c+=e[l+1]),l=l-1>>1,++e[l];return c};mxMedianHybridCrossingReduction.prototype.transpose=function(a,b){for(var c=!0,d=0;c&&10>d++;)for(var e=1==a%2&&1==d%2,c=!1,f=0;f<b.ranks.length;f++){for(var g=b.ranks[f],k=[],l=0;l<g.length;l++){var m=g[l],n=m.getGeneralPurposeVariable(f);0>n&&(n=l);k[n]=m}for(var p=null,q=null,u=null,v=null,y=null,z=null,x=null,B=null,l=0;l<g.length-1;l++){if(0==l){for(var x=k[l],m=x.getNextLayerConnectedCells(f),n=x.getPreviousLayerConnectedCells(f),u=[],v=[],A=0;A<m.length;A++)u[A]=m[A].getGeneralPurposeVariable(f+
1);for(A=0;A<n.length;A++)v[A]=n[A].getGeneralPurposeVariable(f-1)}else m=p,n=q,u=y,v=z,x=B;B=k[l+1];p=B.getNextLayerConnectedCells(f);q=B.getPreviousLayerConnectedCells(f);y=[];z=[];for(A=0;A<p.length;A++)y[A]=p[A].getGeneralPurposeVariable(f+1);for(A=0;A<q.length;A++)z[A]=q[A].getGeneralPurposeVariable(f-1);for(var D=0,E=0,A=0;A<u.length;A++)for(var G=0;G<y.length;G++)u[A]>y[G]&&D++,u[A]<y[G]&&E++;for(A=0;A<v.length;A++)for(G=0;G<z.length;G++)v[A]>z[G]&&D++,v[A]<z[G]&&E++;if(E<D||E==D&&e)p=x.getGeneralPurposeVariable(f),x.setGeneralPurposeVariable(f,B.getGeneralPurposeVariable(f)),B.setGeneralPurposeVariable(f,p),p=m,q=n,y=u,z=v,B=x,e||(c=!0)}}};mxMedianHybridCrossingReduction.prototype.weightedMedian=function(a,b){var c=0==a%2;if(c)for(var d=b.maxRank-1;0<=d;d--)this.medianRank(d,c);else for(d=1;d<b.maxRank;d++)this.medianRank(d,c)};mxMedianHybridCrossingReduction.prototype.medianRank=function(a,b){for(var c=this.nestedBestRanks[a].length,d=[],e=[],f=0;f<c;f++){var g=this.nestedBestRanks[a][f],k=new MedianCellSorter;k.cell=g;var l;l=b?g.getNextLayerConnectedCells(a):g.getPreviousLayerConnectedCells(a);var m;m=b?a+1:a-1;null!=l&&0!=l.length?(k.medianValue=this.medianValue(l,m),d.push(k)):e[g.getGeneralPurposeVariable(a)]=!0}d.sort(MedianCellSorter.prototype.compare);for(f=0;f<c;f++)null==e[f]&&(g=d.shift().cell,g.setGeneralPurposeVariable(a,f))};mxMedianHybridCrossingReduction.prototype.medianValue=function(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e];c[d++]=f.getGeneralPurposeVariable(b)}c.sort(function(a,b){return a-b});if(1==d%2)return c[Math.floor(d/2)];if(2==d)return(c[0]+c[1])/2;e=d/2;f=c[e-1]-c[0];d=c[d-1]-c[e];return(c[e-1]*d+c[e]*f)/(f+d)};function MedianCellSorter(){}MedianCellSorter.prototype.medianValue=0;MedianCellSorter.prototype.cell=!1;
MedianCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.medianValue>a.medianValue?-1:b.medianValue<a.medianValue?1:0:0};function mxMinimumCycleRemover(a){this.layout=a}mxMinimumCycleRemover.prototype=new mxHierarchicalLayoutStage;mxMinimumCycleRemover.prototype.constructor=mxMinimumCycleRemover;mxMinimumCycleRemover.prototype.layout=null;mxMinimumCycleRemover.prototype.execute=function(a){a=this.layout.getModel();for(var b={},c=a.vertexMapper.getValues(),d={},e=0;e<c.length;e++)d[c[e].id]=c[e];c=null;if(null!=a.roots)for(var f=a.roots,c=[],e=0;e<f.length;e++)c[e]=a.vertexMapper.get(f[e]);a.visit(function(a,c,e,f,n){c.isAncestor(a)&&(e.invert(),mxUtils.remove(e,a.connectsAsSource),a.connectsAsTarget.push(e),mxUtils.remove(e,c.connectsAsTarget),c.connectsAsSource.push(e));b[c.id]=c;delete d[c.id]},c,!0,null);e=mxUtils.clone(b,null,!0);a.visit(function(a,c,e,f,n){c.isAncestor(a)&&(e.invert(),mxUtils.remove(e,a.connectsAsSource),c.connectsAsSource.push(e),a.connectsAsTarget.push(e),mxUtils.remove(e,c.connectsAsTarget));b[c.id]=c;delete d[c.id]},d,!0,e)};function mxCoordinateAssignment(a,b,c,d,e,f){this.layout=a;this.intraCellSpacing=b;this.interRankCellSpacing=c;this.orientation=d;this.initialX=e;this.parallelEdgeSpacing=f}mxCoordinateAssignment.prototype=new mxHierarchicalLayoutStage;mxCoordinateAssignment.prototype.constructor=mxCoordinateAssignment;mxCoordinateAssignment.prototype.layout=null;mxCoordinateAssignment.prototype.intraCellSpacing=30;mxCoordinateAssignment.prototype.interRankCellSpacing=100;mxCoordinateAssignment.prototype.parallelEdgeSpacing=10;mxCoordinateAssignment.prototype.maxIterations=8;mxCoordinateAssignment.prototype.prefHozEdgeSep=5;mxCoordinateAssignment.prototype.prefVertEdgeOff=2;mxCoordinateAssignment.prototype.minEdgeJetty=12;mxCoordinateAssignment.prototype.channelBuffer=4;mxCoordinateAssignment.prototype.jettyPositions=null;mxCoordinateAssignment.prototype.orientation=mxConstants.DIRECTION_NORTH;mxCoordinateAssignment.prototype.initialX=null;mxCoordinateAssignment.prototype.limitX=null;mxCoordinateAssignment.prototype.currentXDelta=null;mxCoordinateAssignment.prototype.widestRank=null;mxCoordinateAssignment.prototype.rankTopY=null;mxCoordinateAssignment.prototype.rankBottomY=null;mxCoordinateAssignment.prototype.widestRankValue=null;mxCoordinateAssignment.prototype.rankWidths=null;mxCoordinateAssignment.prototype.rankY=null;mxCoordinateAssignment.prototype.fineTuning=!0;mxCoordinateAssignment.prototype.nextLayerConnectedCache=null;mxCoordinateAssignment.prototype.previousLayerConnectedCache=null;mxCoordinateAssignment.prototype.groupPadding=10;mxCoordinateAssignment.prototype.printStatus=function(){var a=this.layout.getModel();mxLog.show();mxLog.writeln("======Coord assignment debug=======");for(var b=0;b<a.ranks.length;b++){mxLog.write("Rank ",b," : ");for(var c=a.ranks[b],d=0;d<c.length;d++)mxLog.write(c[d].getGeneralPurposeVariable(b),"  ");mxLog.writeln()}mxLog.writeln("====================================")};mxCoordinateAssignment.prototype.execute=function(a){this.jettyPositions={};a=this.layout.getModel();this.currentXDelta=0;this.initialCoords(this.layout.getGraph(),a);this.fineTuning&&this.minNode(a);var b=1E8;if(this.fineTuning)for(var c=0;c<this.maxIterations;c++){0!=c&&(this.medianPos(c,a),this.minNode(a));if(this.currentXDelta<b){for(var d=0;d<a.ranks.length;d++)for(var e=a.ranks[d],f=0;f<e.length;f++){var g=e[f];g.setX(d,g.getGeneralPurposeVariable(d))}b=this.currentXDelta}else for(d=0;d<a.ranks.length;d++)for(e=a.ranks[d],f=0;f<e.length;f++)g=e[f],g.setGeneralPurposeVariable(d,g.getX(d));this.minPath(this.layout.getGraph(),a);this.currentXDelta=0}this.setCellLocations(this.layout.getGraph(),a)};mxCoordinateAssignment.prototype.minNode=function(a){for(var b=[],c=new mxDictionary,d=[],e=0;e<=a.maxRank;e++){d[e]=a.ranks[e];for(var f=0;f<d[e].length;f++){var g=d[e][f],k=new WeightedCellSorter(g,e);k.rankIndex=f;k.visited=!0;b.push(k);c.put(g,k)}}a=10*b.length;for(f=0;0<b.length&&f<=a;){var g=b.shift(),e=g.cell,l=g.weightedValue,m=parseInt(g.rankIndex),k=e.getNextLayerConnectedCells(l),n=e.getPreviousLayerConnectedCells(l),p=k.length,q=n.length,u=this.medianXValue(k,l+1),v=this.medianXValue(n,l-1),y=p+q,z=e.getGeneralPurposeVariable(l),x=z;0<y&&(x=(u*p+v*q)/y);p=!1;x<z-1?0==m?(e.setGeneralPurposeVariable(l,x),p=!0):(m=d[l][m-1],z=m.getGeneralPurposeVariable(l),z=z+m.width/2+this.intraCellSpacing+e.width/2,z<x?(e.setGeneralPurposeVariable(l,x),p=!0):z<e.getGeneralPurposeVariable(l)-1&&(e.setGeneralPurposeVariable(l,z),p=!0)):x>z+1&&(m==d[l].length-1?(e.setGeneralPurposeVariable(l,x),p=!0):(m=d[l][m+1],z=m.getGeneralPurposeVariable(l),z=z-m.width/2-this.intraCellSpacing-e.width/2,z>x?(e.setGeneralPurposeVariable(l,
x),p=!0):z>e.getGeneralPurposeVariable(l)+1&&(e.setGeneralPurposeVariable(l,z),p=!0)));if(p){for(e=0;e<k.length;e++)l=k[e],l=c.get(l),null!=l&&!1==l.visited&&(l.visited=!0,b.push(l));for(e=0;e<n.length;e++)l=n[e],l=c.get(l),null!=l&&!1==l.visited&&(l.visited=!0,b.push(l))}g.visited=!1;f++}};mxCoordinateAssignment.prototype.medianPos=function(a,b){if(0==a%2)for(var c=b.maxRank;0<c;c--)this.rankMedianPosition(c-1,b,c);else for(c=0;c<b.maxRank-1;c++)this.rankMedianPosition(c+1,b,c)};mxCoordinateAssignment.prototype.rankMedianPosition=function(a,b,c){b=b.ranks[a];for(var d=[],e={},f=0;f<b.length;f++){var g=b[f];d[f]=new WeightedCellSorter;d[f].cell=g;d[f].rankIndex=f;e[g.id]=d[f];var k=null,k=c<a?g.getPreviousLayerConnectedCells(a):g.getNextLayerConnectedCells(a);d[f].weightedValue=this.calculatedWeightedValue(g,k)}d.sort(WeightedCellSorter.prototype.compare);for(f=0;f<d.length;f++){var l=0,g=d[f].cell,l=0,k=c<a?g.getPreviousLayerConnectedCells(a).slice():g.getNextLayerConnectedCells(a).slice();null!=k&&(l=k.length,l=0<l?this.medianXValue(k,c):g.getGeneralPurposeVariable(a));for(var m=0,k=-1E8,n=d[f].rankIndex-1;0<=n;){var p=e[b[n].id];if(null!=p){var q=p.cell;p.visited?(k=q.getGeneralPurposeVariable(a)+q.width/2+this.intraCellSpacing+m+g.width/2,n=-1):(m+=q.width+this.intraCellSpacing,n--)}}m=0;q=1E8;for(n=d[f].rankIndex+1;n<d.length;)if(p=e[b[n].id],null!=p){var u=p.cell;p.visited?(q=u.getGeneralPurposeVariable(a)-u.width/2-this.intraCellSpacing-m-g.width/2,n=d.length):(m+=u.width+this.intraCellSpacing,n++)}l>=k&&l<=q?g.setGeneralPurposeVariable(a,l):l<k?(g.setGeneralPurposeVariable(a,k),this.currentXDelta+=k-l):l>q&&(g.setGeneralPurposeVariable(a,q),this.currentXDelta+=l-q);d[f].visited=!0}};mxCoordinateAssignment.prototype.calculatedWeightedValue=function(a,b){for(var c=0,d=0;d<b.length;d++){var e=b[d];a.isVertex()&&e.isVertex()?c++:c=a.isEdge()&&e.isEdge()?c+8:c+2}return c};mxCoordinateAssignment.prototype.medianXValue=function(a,b){if(0==a.length)return 0;for(var c=[],d=0;d<a.length;d++)c[d]=a[d].getGeneralPurposeVariable(b);c.sort(function(a,b){return a-b});if(1==a.length%2)return c[Math.floor(a.length/2)];d=a.length/2;return(c[d-1]+c[d])/2};
mxCoordinateAssignment.prototype.initialCoords=function(a,b){this.calculateWidestRank(a,b);for(var c=this.widestRank;0<=c;c--)c<b.maxRank&&this.rankCoordinates(c,a,b);for(c=this.widestRank+1;c<=b.maxRank;c++)0<c&&this.rankCoordinates(c,a,b)};mxCoordinateAssignment.prototype.rankCoordinates=function(a,b,c){b=c.ranks[a];c=0;for(var d=this.initialX+(this.widestRankValue-this.rankWidths[a])/2,e=!1,f=0;f<b.length;f++){var g=b[f];if(g.isVertex()){var k=this.layout.getVertexBounds(g.cell);null!=k?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(g.width=k.width,g.height=k.height):(g.width=k.height,g.height=k.width):e=!0;c=Math.max(c,g.height)}else g.isEdge()&&(k=1,null!=g.edges?k=g.edges.length:mxLog.warn("edge.edges is null"),
g.width=(k-1)*this.parallelEdgeSpacing);d+=g.width/2;g.setX(a,d);g.setGeneralPurposeVariable(a,d);d+=g.width/2;d+=this.intraCellSpacing}!0==e&&mxLog.warn("At least one cell has no bounds")};mxCoordinateAssignment.prototype.calculateWidestRank=function(a,b){var c=-this.interRankCellSpacing,d=0;this.rankWidths=[];this.rankY=[];for(var e=b.maxRank;0<=e;e--){for(var f=0,g=b.ranks[e],k=this.initialX,l=!1,m=0;m<g.length;m++){var n=g[m];if(n.isVertex()){var p=this.layout.getVertexBounds(n.cell);null!=p?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(n.width=p.width,n.height=p.height):(n.width=p.height,n.height=p.width):l=!0;f=Math.max(f,n.height)}else n.isEdge()&&(p=1,null!=n.edges?p=n.edges.length:mxLog.warn("edge.edges is null"),n.width=(p-1)*this.parallelEdgeSpacing);k+=n.width/2;n.setX(e,k);n.setGeneralPurposeVariable(e,k);k+=n.width/2;k+=this.intraCellSpacing;k>this.widestRankValue&&(this.widestRankValue=k,this.widestRank=e);this.rankWidths[e]=k}!0==l&&mxLog.warn("At least one cell has no bounds");this.rankY[e]=c;k=f/2+d/2+this.interRankCellSpacing;d=f;c=this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_WEST?c+k:c-
k;for(m=0;m<g.length;m++)g[m].setY(e,c)}};mxCoordinateAssignment.prototype.minPath=function(a,b){for(var c=b.edgeMapper.getValues(),d=0;d<c.length;d++){var e=c[d];if(!(1>e.maxRank-e.minRank-1)){for(var f=e.getGeneralPurposeVariable(e.minRank+1),g=!0,k=0,l=e.minRank+2;l<e.maxRank;l++){var m=e.getGeneralPurposeVariable(l);f!=m?(g=!1,f=m):k++}if(!g){for(var g=f=0,m=[],n=[],p=e.getGeneralPurposeVariable(e.minRank+1),l=e.minRank+1;l<e.maxRank-1;l++){var q=e.getX(l+1);p==q?(m[l-e.minRank-1]=p,f++):this.repositionValid(b,e,l+1,p)?(m[l-e.minRank-
1]=p,f++):p=m[l-e.minRank-1]=q}p=e.getX(l);for(l=e.maxRank-1;l>e.minRank+1;l--)q=e.getX(l-1),p==q?(n[l-e.minRank-2]=p,g++):this.repositionValid(b,e,l-1,p)?(n[l-e.minRank-2]=p,g++):(n[l-e.minRank-2]=e.getX(l-1),p=q);if(g>k||f>k)if(g>=f)for(l=e.maxRank-2;l>e.minRank;l--)e.setX(l,n[l-e.minRank-1]);else if(f>g)for(l=e.minRank+2;l<e.maxRank;l++)e.setX(l,m[l-e.minRank-2])}}}};mxCoordinateAssignment.prototype.repositionValid=function(a,b,c,d){a=a.ranks[c];for(var e=-1,f=0;f<a.length;f++)if(b==a[f]){e=f;break}if(0>e)return!1;f=b.getGeneralPurposeVariable(c);if(d<f){if(0==e)return!0;a=a[e-1];c=a.getGeneralPurposeVariable(c);c=c+a.width/2+this.intraCellSpacing+b.width/2;if(!(c<=d))return!1}else if(d>f){if(e==a.length-1)return!0;a=a[e+1];c=a.getGeneralPurposeVariable(c);c=c-a.width/2-this.intraCellSpacing-b.width/2;if(!(c>=d))return!1}return!0};mxCoordinateAssignment.prototype.setCellLocations=function(a,b){this.rankTopY=[];this.rankBottomY=[];for(var c=0;c<b.ranks.length;c++)this.rankTopY[c]=Number.MAX_VALUE,this.rankBottomY[c]=-Number.MAX_VALUE;for(var d=b.vertexMapper.getValues(),c=0;c<d.length;c++)this.setVertexLocation(d[c]);this.layout.edgeStyle!=mxHierarchicalEdgeStyle.ORTHOGONAL&&this.layout.edgeStyle!=mxHierarchicalEdgeStyle.POLYLINE&&this.layout.edgeStyle!=mxHierarchicalEdgeStyle.CURVE||this.localEdgeProcessing(b);d=b.edgeMapper.getValues();for(c=0;c<d.length;c++)this.setEdgePosition(d[c])};mxCoordinateAssignment.prototype.localEdgeProcessing=function(a){for(var b=0;b<a.ranks.length;b++)for(var c=a.ranks[b],d=0;d<c.length;d++){var e=c[d];if(e.isVertex())for(var f=e.getPreviousLayerConnectedCells(b),g=b-1,k=0;2>k;k++){if(-1<g&&g<a.ranks.length&&null!=f&&0<f.length){for(var l=[],m=0;m<f.length;m++){var n=new WeightedCellSorter(f[m],f[m].getX(g));l.push(n)}l.sort(WeightedCellSorter.prototype.compare);for(var n=e.x[0]-e.width/2,p=n+e.width,q=f=0,g=[],m=0;m<l.length;m++){var u=l[m].cell,v;if(u.isVertex()){v=0==k?e.connectsAsSource:e.connectsAsTarget;for(var y=0;y<v.length;y++)if(v[y].source==u||v[y].target==u)f+=v[y].edges.length,q++,g.push(v[y])}else f+=u.edges.length,q++,g.push(u)}e.width>(f+1)*this.prefHozEdgeSep+2*this.prefHozEdgeSep&&(n+=this.prefHozEdgeSep,p-=this.prefHozEdgeSep);l=(p-n)/f;n+=l/2;p=this.minEdgeJetty-this.prefVertEdgeOff;for(m=q=0;m<g.length;m++){u=g[m].edges.length;v=this.jettyPositions[g[m].ids[0]];null==v&&(v=[],this.jettyPositions[g[m].ids[0]]=v);m<f/2?
p+=this.prefVertEdgeOff:m>f/2&&(p-=this.prefVertEdgeOff);for(y=0;y<u;y++)v[4*y+2*k]=n,n+=l,v[4*y+2*k+1]=p;q=Math.max(q,p)}}f=e.getNextLayerConnectedCells(b);g=b+1}}};mxCoordinateAssignment.prototype.setEdgePosition=function(a){var b=0;if(101207!=a.temp[0]){var c=a.maxRank,d=a.minRank;c==d&&(c=a.source.maxRank,d=a.target.minRank);for(var e=0,f=this.jettyPositions[a.ids[0]],g=a.isReversed?a.target.cell:a.source.cell,k=this.layout.graph,l=this.orientation==mxConstants.DIRECTION_EAST||this.orientation==mxConstants.DIRECTION_SOUTH,m=0;m<a.edges.length;m++){var n=a.edges[m],p=this.layout.getVisibleTerminal(n,!0),q=[],u=a.isReversed;p!=g&&(u=!u);if(null!=f){var v=u?2:0,y=u?l?this.rankBottomY[d]:this.rankTopY[d]:l?this.rankTopY[c]:this.rankBottomY[c],z=f[4*e+1+v];u!=l&&(z=-z);var y=y+z,v=f[4*e+v],x=k.model.getTerminal(n,!0);this.layout.isPort(x)&&k.model.getParent(x)==p&&(v=k.view.getState(x),v=null!=v?v.x:p.geometry.x+a.source.width*x.geometry.x);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(q.push(new mxPoint(v,y)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&q.push(new mxPoint(v,y+z))):(q.push(new mxPoint(y,v)),this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&q.push(new mxPoint(y+z,v)))}v=a.x.length-1;y=z=-1;p=a.maxRank-1;for(u&&(v=0,z=a.x.length,y=1,p=a.minRank+1);a.maxRank!=a.minRank&&v!=z;v+=y){var x=a.x[v]+b,B=(this.rankTopY[p]+this.rankBottomY[p+1])/2,A=(this.rankTopY[p-1]+this.rankBottomY[p])/2;if(u)var D=B,B=A,A=D;this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(q.push(new mxPoint(x,B)),q.push(new mxPoint(x,A))):(q.push(new mxPoint(B,x)),q.push(new mxPoint(A,
x)));this.limitX=Math.max(this.limitX,x);p+=y}null!=f&&(v=u?2:0,y=u?l?this.rankTopY[c]:this.rankBottomY[c]:l?this.rankBottomY[d]:this.rankTopY[d],z=f[4*e+3-v],u!=l&&(z=-z),y-=z,v=f[4*e+2-v],u=k.model.getTerminal(n,!1),p=this.layout.getVisibleTerminal(n,!1),this.layout.isPort(u)&&k.model.getParent(u)==p&&(v=k.view.getState(u),v=null!=v?v.x:p.geometry.x+a.target.width*u.geometry.x),this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&q.push(new mxPoint(v,y-z)),q.push(new mxPoint(v,y))):(this.layout.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&q.push(new mxPoint(y-z,v)),q.push(new mxPoint(y,v))));a.isReversed&&this.processReversedEdge(a,n);this.layout.setEdgePoints(n,q);b=0==b?this.parallelEdgeSpacing:0<b?-b:-b+this.parallelEdgeSpacing;e++}a.temp[0]=101207}};mxCoordinateAssignment.prototype.setVertexLocation=function(a){var b=a.cell,c=a.x[0]-a.width/2,d=a.y[0]-a.height/2;this.rankTopY[a.minRank]=Math.min(this.rankTopY[a.minRank],d);this.rankBottomY[a.minRank]=Math.max(this.rankBottomY[a.minRank],d+a.height);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?this.layout.setVertexLocation(b,c,d):this.layout.setVertexLocation(b,d,c);this.limitX=Math.max(this.limitX,c+a.width)};mxCoordinateAssignment.prototype.processReversedEdge=function(a,b){};function WeightedCellSorter(a,b){this.cell=a;this.weightedValue=b}WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.weightedValue>a.weightedValue?-1:b.weightedValue<a.weightedValue?1:b.nudge?-1:1:0};function mxSwimlaneOrdering(a){this.layout=a}mxSwimlaneOrdering.prototype=new mxHierarchicalLayoutStage;mxSwimlaneOrdering.prototype.constructor=mxSwimlaneOrdering;mxSwimlaneOrdering.prototype.layout=null;mxSwimlaneOrdering.prototype.execute=function(a){a=this.layout.getModel();var b=mxUtils.clone(a.vertexMapper,null,!0),c=null;if(null!=a.roots)for(var d=a.roots,c=[],e=0;e<d.length;e++){var f=mxCellPath.create(d[e]);c[e]=a.vertexMapper[f]}a.visit(function(a,c,d,e,f){e=null!=a&&a.swimlaneIndex==c.swimlaneIndex&&c.isAncestor(a);f=null!=a&&null!=d&&a.swimlaneIndex<c.swimlaneIndex&&d.source==c;e?(d.invert(),mxUtils.remove(d,a.connectsAsSource),c.connectsAsSource.push(d),a.connectsAsTarget.push(d),mxUtils.remove(d,c.connectsAsTarget)):f&&(d.invert(),mxUtils.remove(d,a.connectsAsTarget),c.connectsAsTarget.push(d),a.connectsAsSource.push(d),mxUtils.remove(d,c.connectsAsSource));a=mxCellPath.create(c.cell);delete b[a]},c,!0,null)};function mxHierarchicalLayout(a,b,c){mxGraphLayout.call(this,a);this.orientation=null!=b?b:mxConstants.DIRECTION_NORTH;this.deterministic=null!=c?c:!0}var mxHierarchicalEdgeStyle={ORTHOGONAL:1,POLYLINE:2,STRAIGHT:3,CURVE:4};mxHierarchicalLayout.prototype=new mxGraphLayout;mxHierarchicalLayout.prototype.constructor=mxHierarchicalLayout;mxHierarchicalLayout.prototype.roots=null;mxHierarchicalLayout.prototype.resizeParent=!1;mxCompactTreeLayout.prototype.maintainParentLocation=!1;mxHierarchicalLayout.prototype.moveParent=!1;mxHierarchicalLayout.prototype.parentBorder=0;mxHierarchicalLayout.prototype.intraCellSpacing=30;mxHierarchicalLayout.prototype.interRankCellSpacing=100;mxHierarchicalLayout.prototype.interHierarchySpacing=60;mxHierarchicalLayout.prototype.parallelEdgeSpacing=10;mxHierarchicalLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxHierarchicalLayout.prototype.fineTuning=!0;mxHierarchicalLayout.prototype.tightenToSource=!0;mxHierarchicalLayout.prototype.disableEdgeStyle=!0;mxHierarchicalLayout.prototype.traverseAncestors=!0;mxHierarchicalLayout.prototype.model=null;mxHierarchicalLayout.prototype.edgesCache=null;mxHierarchicalLayout.prototype.edgeSourceTermCache=null;mxHierarchicalLayout.prototype.edgesTargetTermCache=null;mxHierarchicalLayout.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE;mxHierarchicalLayout.prototype.getModel=function(){return this.model};mxHierarchicalLayout.prototype.execute=function(a,b){this.parent=a;var c=this.graph.model;this.edgesCache=new mxDictionary;this.edgeSourceTermCache=new mxDictionary;this.edgesTargetTermCache=new mxDictionary;null==b||b instanceof Array||(b=[b]);if(null!=b||null!=a){this.parentY=this.parentX=null;if(a!=this.root&&null!=c.isVertex(a)&&this.maintainParentLocation){var d=this.graph.getCellGeometry(a);null!=d&&(this.parentX=d.x,this.parentY=d.y)}if(null!=b){for(var e=[],f=0;f<b.length;f++)(null!=a?c.isAncestor(a,b[f]):1)&&c.isVertex(b[f])&&e.push(b[f]);this.roots=e}c.beginUpdate();try{this.run(a),this.resizeParent&&!this.graph.isCellCollapsed(a)&&this.graph.updateGroupBounds([a],this.parentBorder,this.moveParent),null!=this.parentX&&null!=this.parentY&&(d=this.graph.getCellGeometry(a),null!=d&&(d=d.clone(),d.x=this.parentX,d.y=this.parentY,c.setGeometry(a,d)))}finally{c.endUpdate()}}};mxHierarchicalLayout.prototype.findRoots=function(a,b){var c=[];if(null!=a&&null!=b){var d=this.graph.model,e=null,f=-1E5,g;for(g in b){var k=b[g];if(d.isVertex(k)&&this.graph.isCellVisible(k)){for(var l=this.getEdges(k),m=0,n=0,p=0;p<l.length;p++)this.getVisibleTerminal(l[p],!0)==k?m++:n++;0==n&&0<m&&c.push(k);l=m-n;l>f&&(f=l,e=k)}}0==c.length&&null!=e&&c.push(e)}return c};mxHierarchicalLayout.prototype.getEdges=function(a){var b=this.edgesCache.get(a);if(null!=b)return b;for(var c=this.graph.model,b=[],d=this.graph.isCellCollapsed(a),e=c.getChildCount(a),f=0;f<e;f++){var g=c.getChildAt(a,f);if(this.isPort(g))b=b.concat(c.getEdges(g,!0,!0));else if(d||!this.graph.isCellVisible(g))b=b.concat(c.getEdges(g,!0,!0))}b=b.concat(c.getEdges(a,!0,!0));c=[];for(f=0;f<b.length;f++)d=this.getVisibleTerminal(b[f],!0),e=this.getVisibleTerminal(b[f],!1),(d==e||d!=e&&(e==a&&(null==this.parent||this.graph.isValidAncestor(d,this.parent,this.traverseAncestors))||d==a&&(null==this.parent||this.graph.isValidAncestor(e,this.parent,this.traverseAncestors))))&&c.push(b[f]);this.edgesCache.put(a,c);return c};mxHierarchicalLayout.prototype.getVisibleTerminal=function(a,b){var c=this.edgesTargetTermCache;b&&(c=this.edgeSourceTermCache);var d=c.get(a);if(null!=d)return d;var d=this.graph.view.getState(a),e=null!=d?d.getVisibleTerminal(b):this.graph.view.getVisibleTerminal(a,b);null==e&&(e=null!=d?d.getVisibleTerminal(b):this.graph.view.getVisibleTerminal(a,b));null!=e&&(this.isPort(e)&&(e=this.graph.model.getParent(e)),c.put(a,e));return e};mxHierarchicalLayout.prototype.run=function(a){var b=[],c=[];if(null==this.roots&&null!=a){var d={};this.filterDescendants(a,d);this.roots=[];var e=!0,f;for(f in d)if(null!=d[f]){e=!1;break}for(;!e;){for(var g=this.findRoots(a,d),e=0;e<g.length;e++){var k={};b.push(k);this.traverse(g[e],!0,null,c,k,b,d)}for(e=0;e<g.length;e++)this.roots.push(g[e]);e=!0;for(f in d)if(null!=d[f]){e=!1;break}}}else for(e=0;e<this.roots.length;e++)k={},b.push(k),this.traverse(this.roots[e],!0,null,c,k,b,null);for(e=c=0;e<b.length;e++){k=b[e];d=[];for(f in k)d.push(k[f]);this.model=new mxGraphHierarchyModel(this,d,this.roots,a,this.tightenToSource);this.cycleStage(a);this.layeringStage();this.crossingStage(a);c=this.placementStage(c,a)}};mxHierarchicalLayout.prototype.filterDescendants=function(a,b){var c=this.graph.model;c.isVertex(a)&&a!=this.parent&&this.graph.isCellVisible(a)&&(b[mxObjectIdentity.get(a)]=a);if(this.traverseAncestors||a==this.parent&&this.graph.isCellVisible(a))for(var d=c.getChildCount(a),e=0;e<d;e++){var f=c.getChildAt(a,e);this.isPort(f)||this.filterDescendants(f,b)}};mxHierarchicalLayout.prototype.isPort=function(a){return a.geometry.relative?!0:!1};mxHierarchicalLayout.prototype.getEdgesBetween=function(a,b,c){c=null!=c?c:!1;for(var d=this.getEdges(a),e=[],f=0;f<d.length;f++){var g=this.getVisibleTerminal(d[f],!0),k=this.getVisibleTerminal(d[f],!1);(g==a&&k==b||!c&&g==b&&k==a)&&e.push(d[f])}return e};mxHierarchicalLayout.prototype.traverse=function(a,b,c,d,e,f,g){if(null!=a&&null!=d){var k=mxObjectIdentity.get(a);if(null==d[k]&&(null==g||null!=g[k])){null==e[k]&&(e[k]=a);null==d[k]&&(d[k]=a);null!==g&&delete g[k];var l=this.getEdges(a),k=[];for(c=0;c<l.length;c++)k[c]=this.getVisibleTerminal(l[c],!0)==a;for(c=0;c<l.length;c++)if(!b||k[c]){a=this.getVisibleTerminal(l[c],!k[c]);for(var m=1,n=0;n<l.length;n++)if(n!=c){var p=k[n];this.getVisibleTerminal(l[n],!p)==a&&(p?m++:m--)}0<=m&&(e=this.traverse(a,b,l[c],d,e,f,g))}}else if(null==e[k])for(c=0;c<f.length;c++)if(b=f[c],null!=b[k]){for(l in b)e[l]=b[l];f.splice(c,1);break}}return e};mxHierarchicalLayout.prototype.cycleStage=function(a){(new mxMinimumCycleRemover(this)).execute(a)};mxHierarchicalLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxHierarchicalLayout.prototype.crossingStage=function(a){(new mxMedianHybridCrossingReduction(this)).execute(a)};mxHierarchicalLayout.prototype.placementStage=function(a,b){var c=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,a,this.parallelEdgeSpacing);c.fineTuning=this.fineTuning;c.execute(b);return c.limitX+this.interHierarchySpacing};function mxSwimlaneLayout(a,b,c){mxGraphLayout.call(this,a);this.orientation=null!=b?b:mxConstants.DIRECTION_NORTH;this.deterministic=null!=c?c:!0}mxSwimlaneLayout.prototype=new mxGraphLayout;mxSwimlaneLayout.prototype.constructor=mxSwimlaneLayout;mxSwimlaneLayout.prototype.roots=null;mxSwimlaneLayout.prototype.swimlanes=null;mxSwimlaneLayout.prototype.dummyVertices=null;mxSwimlaneLayout.prototype.dummyVertexWidth=50;mxSwimlaneLayout.prototype.resizeParent=!1;mxSwimlaneLayout.prototype.moveParent=!1;mxSwimlaneLayout.prototype.parentBorder=30;mxSwimlaneLayout.prototype.intraCellSpacing=30;mxSwimlaneLayout.prototype.interRankCellSpacing=100;mxSwimlaneLayout.prototype.interHierarchySpacing=60;mxSwimlaneLayout.prototype.parallelEdgeSpacing=10;mxSwimlaneLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxSwimlaneLayout.prototype.fineTuning=!0;mxSwimlaneLayout.prototype.tightenToSource=!0;mxSwimlaneLayout.prototype.disableEdgeStyle=!0;mxSwimlaneLayout.prototype.traverseAncestors=!0;mxSwimlaneLayout.prototype.model=null;mxSwimlaneLayout.prototype.edgesCache=null;mxSwimlaneLayout.prototype.getModel=function(){return this.model};mxSwimlaneLayout.prototype.execute=function(a,b){this.parent=a;var c=this.graph.model;this.edgesCache={};if(!(null==b||1>b.length)){null==a&&(a=c.getParent(b[0]));this.swimlanes=b;this.dummyVertices=[];for(var d=0;d<b.length;d++){var e=this.graph.getChildCells(b[d]);if(null==e||0==e.length)e=this.graph.insertVertex(b[d],null,null,0,0,this.dummyVertexWidth,0),this.dummyVertices.push(e)}c.beginUpdate();try{this.run(a),this.resizeParent&&!this.graph.isCellCollapsed(a)&&this.graph.updateGroupBounds([a],this.parentBorder,this.moveParent),this.graph.removeCells(this.dummyVertices)}finally{c.endUpdate()}}};mxSwimlaneLayout.prototype.updateGroupBounds=function(){var a=[],b=this.model,c;for(c in b.edgeMapper)for(var d=b.edgeMapper[c],e=0;e<d.edges.length;e++)a.push(d.edges[e]);a=this.graph.getBoundingBoxFromGeometry(a,!0);b=[];for(e=0;e<this.swimlanes.length;e++){var f=this.swimlanes[e];c=this.graph.getCellGeometry(f);if(null!=c){var g=this.graph.getChildCells(f),d=this.graph.isSwimlane(f)?this.graph.getStartSize(f):new mxRectangle,f=this.graph.getBoundingBoxFromGeometry(g);b[e]=f;d=f.y+c.y-d.height-
this.parentBorder;c=f.y+c.y+f.height;null==a?a=new mxRectangle(0,d,0,c-d):(a.y=Math.min(a.y,d),c=Math.max(a.y+a.height,c),a.height=c-a.y)}}for(e=0;e<this.swimlanes.length;e++)if(f=this.swimlanes[e],c=this.graph.getCellGeometry(f),null!=c){var g=this.graph.getChildCells(f),d=this.graph.isSwimlane(f)?this.graph.getStartSize(f):new mxRectangle,k=c.clone(),l=0==e?this.parentBorder:this.interRankCellSpacing/2;k.x+=b[e].x-d.width-l;k.y=k.y+a.y-c.y-this.parentBorder;k.width=b[e].width+d.width+this.interRankCellSpacing/
2+l;k.height=a.height+d.height+2*this.parentBorder;this.graph.model.setGeometry(f,k);this.graph.moveCells(g,-b[e].x+d.width+l,c.y-a.y+this.parentBorder)}};mxSwimlaneLayout.prototype.findRoots=function(a,b){var c=[];if(null!=a&&null!=b){var d=this.graph.model,e=null,f=-1E5,g;for(g in b){var k=b[g];if(null!=k&&d.isVertex(k)&&this.graph.isCellVisible(k)&&d.isAncestor(a,k)){for(var l=this.getEdges(k),m=0,n=0,p=0;p<l.length;p++){var q=this.getVisibleTerminal(l[p],!0);q==k?(q=this.getVisibleTerminal(l[p],!1),d.isAncestor(a,q)&&m++):d.isAncestor(a,q)&&n++}0==n&&0<m&&c.push(k);l=m-n;l>f&&(f=l,e=k)}}0==c.length&&null!=e&&c.push(e)}return c};mxSwimlaneLayout.prototype.getEdges=function(a){var b=mxCellPath.create(a);if(null!=this.edgesCache[b])return this.edgesCache[b];for(var c=this.graph.model,d=[],e=this.graph.isCellCollapsed(a),f=c.getChildCount(a),g=0;g<f;g++){var k=c.getChildAt(a,g);if(this.isPort(k))d=d.concat(c.getEdges(k,!0,!0));else if(e||!this.graph.isCellVisible(k))d=d.concat(c.getEdges(k,!0,!0))}d=d.concat(c.getEdges(a,!0,!0));c=[];for(g=0;g<d.length;g++)e=this.getVisibleTerminal(d[g],!0),f=this.getVisibleTerminal(d[g],!1),(e==f||e!=f&&(f==a&&(null==this.parent||this.graph.isValidAncestor(e,this.parent,this.traverseAncestors))||e==a&&(null==this.parent||this.graph.isValidAncestor(f,this.parent,this.traverseAncestors))))&&c.push(d[g]);return this.edgesCache[b]=c};mxSwimlaneLayout.prototype.getVisibleTerminal=function(a,b){var c=this.graph.view.getState(a),c=null!=c?c.getVisibleTerminal(b):this.graph.view.getVisibleTerminal(a,b);this.isPort(c)&&(c=this.graph.model.getParent(c));return c};mxSwimlaneLayout.prototype.run=function(a){var b=[],c=[];if(null!=this.swimlanes&&0<this.swimlanes.length&&null!=a){for(var d={},e=0;e<this.swimlanes.length;e++)this.filterDescendants(this.swimlanes[e],d);this.roots=[];var e=!0,f;for(f in d)if(null!=d[f]){e=!1;break}for(var g=0;!e&&g<this.swimlanes.length;){var k=this.findRoots(this.swimlanes[g],d);if(0==k.length)g++;else{for(e=0;e<k.length;e++){var l={};b.push(l);this.traverse(k[e],!0,null,c,l,b,d,g)}for(e=0;e<k.length;e++)this.roots.push(k[e]);e=!0;for(f in d)if(null!=d[f]){e=!1;break}}}}else for(e=0;e<this.roots.length;e++)l={},b.push(l),this.traverse(this.roots[e],!0,null,c,l,b,null);b=[];for(f in c)b.push(c[f]);this.model=new mxSwimlaneModel(this,b,this.roots,a,this.tightenToSource);this.cycleStage(a);this.layeringStage();this.crossingStage(a);initialX=this.placementStage(0,a)};mxSwimlaneLayout.prototype.filterDescendants=function(a,b){var c=this.graph.model;c.isVertex(a)&&a!=this.parent&&c.getParent(a)!=this.parent&&this.graph.isCellVisible(a)&&(b[mxCellPath.create(a)]=a);if(this.traverseAncestors||a==this.parent&&this.graph.isCellVisible(a))for(var d=c.getChildCount(a),e=0;e<d;e++){var f=c.getChildAt(a,e);this.isPort(f)||this.filterDescendants(f,b)}};mxSwimlaneLayout.prototype.isPort=function(a){return a.geometry.relative?!0:!1};mxSwimlaneLayout.prototype.getEdgesBetween=function(a,b,c){c=null!=c?c:!1;for(var d=this.getEdges(a),e=[],f=0;f<d.length;f++){var g=this.getVisibleTerminal(d[f],!0),k=this.getVisibleTerminal(d[f],!1);(g==a&&k==b||!c&&g==b&&k==a)&&e.push(d[f])}return e};mxSwimlaneLayout.prototype.traverse=function(a,b,c,d,e,f,g,k){if(null!=a&&null!=d){var l=mxCellPath.create(a);if(null==d[l]&&(null==g||null!=g[l])){null==e[l]&&(e[l]=a);null==d[l]&&(d[l]=a);null!==g&&delete g[l];var m=this.getEdges(a),l=this.graph.model;for(c=0;c<m.length;c++){var n=this.getVisibleTerminal(m[c],!0),p=n==a;p&&(n=this.getVisibleTerminal(m[c],!1));for(var q=0,q=0;q<this.swimlanes.length&&!l.isAncestor(this.swimlanes[q],n);q++);q>=this.swimlanes.length||!(q>k||(!b||p)&&q==k)||(e=this.traverse(n,b,m[c],d,e,f,g,q))}}else if(null==e[l])for(c=0;c<f.length;c++)if(a=f[c],null!=a[l]){for(m in a)e[m]=a[m];f.splice(c,1);break}}return e};mxSwimlaneLayout.prototype.cycleStage=function(a){(new mxSwimlaneOrdering(this)).execute(a)};mxSwimlaneLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxSwimlaneLayout.prototype.crossingStage=function(a){(new mxMedianHybridCrossingReduction(this)).execute(a)};mxSwimlaneLayout.prototype.placementStage=function(a,b){var c=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,a,this.parallelEdgeSpacing);c.fineTuning=this.fineTuning;c.execute(b);return c.limitX+this.interHierarchySpacing};function mxGraphModel(a){this.currentEdit=this.createUndoableEdit();null!=a?this.setRoot(a):this.clear()}mxGraphModel.prototype=new mxEventSource;mxGraphModel.prototype.constructor=mxGraphModel;mxGraphModel.prototype.root=null;mxGraphModel.prototype.cells=null;mxGraphModel.prototype.maintainEdgeParent=!0;mxGraphModel.prototype.createIds=!0;mxGraphModel.prototype.prefix="";mxGraphModel.prototype.postfix="";mxGraphModel.prototype.nextId=0;mxGraphModel.prototype.currentEdit=null;mxGraphModel.prototype.updateLevel=0;mxGraphModel.prototype.endingUpdate=!1;mxGraphModel.prototype.clear=function(){this.setRoot(this.createRoot())};mxGraphModel.prototype.isCreateIds=function(){return this.createIds};mxGraphModel.prototype.setCreateIds=function(a){this.createIds=a};mxGraphModel.prototype.createRoot=function(){var a=new mxCell;a.insert(new mxCell);return a};mxGraphModel.prototype.getCell=function(a){return null!=this.cells?this.cells[a]:null};mxGraphModel.prototype.filterCells=function(a,b){var c=null;if(null!=a)for(var c=[],d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c};mxGraphModel.prototype.getDescendants=function(a){return this.filterDescendants(null,a)};mxGraphModel.prototype.filterDescendants=function(a,b){var c=[];b=b||this.getRoot();(null==a||a(b))&&c.push(b);for(var d=this.getChildCount(b),e=0;e<d;e++)var f=this.getChildAt(b,e),c=c.concat(this.filterDescendants(a,f));return c};mxGraphModel.prototype.getRoot=function(a){var b=a||this.root;if(null!=a)for(;null!=a;)b=a,a=this.getParent(a);return b};mxGraphModel.prototype.setRoot=function(a){this.execute(new mxRootChange(this,a));return a};mxGraphModel.prototype.rootChanged=function(a){var b=this.root;this.root=a;this.nextId=0;this.cells=null;this.cellAdded(a);return b};mxGraphModel.prototype.isRoot=function(a){return null!=a&&this.root==a};mxGraphModel.prototype.isLayer=function(a){return this.isRoot(this.getParent(a))};mxGraphModel.prototype.isAncestor=function(a,b){for(;null!=b&&b!=a;)b=this.getParent(b);return b==a};mxGraphModel.prototype.contains=function(a){return this.isAncestor(this.root,a)};mxGraphModel.prototype.getParent=function(a){return null!=a?a.getParent():null};mxGraphModel.prototype.add=function(a,b,c){if(b!=a&&null!=a&&null!=b){null==c&&(c=this.getChildCount(a));var d=a!=this.getParent(b);this.execute(new mxChildChange(this,a,b,c));this.maintainEdgeParent&&d&&this.updateEdgeParents(b)}return b};mxGraphModel.prototype.cellAdded=function(a){if(null!=a){null==a.getId()&&this.createIds&&a.setId(this.createId(a));if(null!=a.getId()){var b=this.getCell(a.getId());if(b!=a){for(;null!=b;)a.setId(this.createId(a)),b=this.getCell(a.getId());null==this.cells&&(this.cells={});this.cells[a.getId()]=a}}mxUtils.isNumeric(a.getId())&&(this.nextId=Math.max(this.nextId,a.getId()));for(var b=this.getChildCount(a),c=0;c<b;c++)this.cellAdded(this.getChildAt(a,c))}};mxGraphModel.prototype.createId=function(a){a=this.nextId;this.nextId++;return this.prefix+a+this.postfix};mxGraphModel.prototype.updateEdgeParents=function(a,b){b=b||this.getRoot(a);for(var c=this.getChildCount(a),d=0;d<c;d++){var e=this.getChildAt(a,d);this.updateEdgeParents(e,b)}e=this.getEdgeCount(a);c=[];for(d=0;d<e;d++)c.push(this.getEdgeAt(a,d));for(d=0;d<c.length;d++)e=c[d],this.isAncestor(b,e)&&this.updateEdgeParent(e,b)};mxGraphModel.prototype.updateEdgeParent=function(a,b){for(var c=this.getTerminal(a,!0),d=this.getTerminal(a,!1),e=null;null!=c&&!this.isEdge(c)&&null!=c.geometry&&c.geometry.relative;)c=this.getParent(c);for(;null!=d&&!this.isEdge(d)&&null!=d.geometry&&d.geometry.relative;)d=this.getParent(d);if(this.isAncestor(b,c)&&this.isAncestor(b,d)&&(e=c==d?this.getParent(c):this.getNearestCommonAncestor(c,d),null!=e&&(this.getParent(e)!=this.root||this.isAncestor(e,a))&&this.getParent(a)!=e)){c=this.getGeometry(a);if(null!=c){var f=this.getOrigin(this.getParent(a)),g=this.getOrigin(e),d=g.x-f.x,f=g.y-f.y,c=c.clone();c.translate(-d,-f);this.setGeometry(a,c)}this.add(e,a,this.getChildCount(e))}};mxGraphModel.prototype.getOrigin=function(a){var b=null;null!=a?(b=this.getOrigin(this.getParent(a)),this.isEdge(a)||(a=this.getGeometry(a),null!=a&&(b.x+=a.x,b.y+=a.y))):b=new mxPoint;return b};mxGraphModel.prototype.getNearestCommonAncestor=function(a,b){if(null!=a&&null!=b){var c=mxCellPath.create(b);if(null!=c&&0<c.length){var d=a,e=mxCellPath.create(d);if(c.length<e.length)var d=b,f=e,e=c,c=f;for(;null!=d;){f=this.getParent(d);if(0==c.indexOf(e+mxCellPath.PATH_SEPARATOR)&&null!=f)return d;e=mxCellPath.getParentPath(e);d=f}}}return null};mxGraphModel.prototype.remove=function(a){a==this.root?this.setRoot(null):null!=this.getParent(a)&&this.execute(new mxChildChange(this,null,a));return a};mxGraphModel.prototype.cellRemoved=function(a){if(null!=a&&null!=this.cells){for(var b=this.getChildCount(a)-1;0<=b;b--)this.cellRemoved(this.getChildAt(a,b));null!=this.cells&&null!=a.getId()&&delete this.cells[a.getId()]}};mxGraphModel.prototype.parentForCellChanged=function(a,b,c){var d=this.getParent(a);null!=b?(b!=d||d.getIndex(a)!=c)&&b.insert(a,c):null!=d&&(c=d.getIndex(a),d.remove(c));this.contains(d)||null==b?null==b&&this.cellRemoved(a):this.cellAdded(a);return d};mxGraphModel.prototype.getChildCount=function(a){return null!=a?a.getChildCount():0};mxGraphModel.prototype.getChildAt=function(a,b){return null!=a?a.getChildAt(b):null};mxGraphModel.prototype.getChildren=function(a){return null!=a?a.children:null};mxGraphModel.prototype.getChildVertices=function(a){return this.getChildCells(a,!0,!1)};mxGraphModel.prototype.getChildEdges=function(a){return this.getChildCells(a,!1,!0)};mxGraphModel.prototype.getChildCells=function(a,b,c){b=null!=b?b:!1;c=null!=c?c:!1;for(var d=this.getChildCount(a),e=[],f=0;f<d;f++){var g=this.getChildAt(a,f);(!c&&!b||c&&this.isEdge(g)||b&&this.isVertex(g))&&e.push(g)}return e};mxGraphModel.prototype.getTerminal=function(a,b){return null!=a?a.getTerminal(b):null};mxGraphModel.prototype.setTerminal=function(a,b,c){var d=b!=this.getTerminal(a,c);this.execute(new mxTerminalChange(this,a,b,c));this.maintainEdgeParent&&d&&this.updateEdgeParent(a,this.getRoot());return b};mxGraphModel.prototype.setTerminals=function(a,b,c){this.beginUpdate();try{this.setTerminal(a,b,!0),this.setTerminal(a,c,!1)}finally{this.endUpdate()}};mxGraphModel.prototype.terminalForCellChanged=function(a,b,c){var d=this.getTerminal(a,c);null!=b?b.insertEdge(a,c):null!=d&&d.removeEdge(a,c);return d};mxGraphModel.prototype.getEdgeCount=function(a){return null!=a?a.getEdgeCount():0};mxGraphModel.prototype.getEdgeAt=function(a,b){return null!=a?a.getEdgeAt(b):null};mxGraphModel.prototype.getDirectedEdgeCount=function(a,b,c){for(var d=0,e=this.getEdgeCount(a),f=0;f<e;f++){var g=this.getEdgeAt(a,f);g!=c&&this.getTerminal(g,b)==a&&d++}return d};mxGraphModel.prototype.getConnections=function(a){return this.getEdges(a,!0,!0,!1)};mxGraphModel.prototype.getIncomingEdges=function(a){return this.getEdges(a,!0,!1,!1)};mxGraphModel.prototype.getOutgoingEdges=function(a){return this.getEdges(a,!1,!0,!1)};mxGraphModel.prototype.getEdges=function(a,b,c,d){b=null!=b?b:!0;c=null!=c?c:!0;d=null!=d?d:!0;for(var e=this.getEdgeCount(a),f=[],g=0;g<e;g++){var k=this.getEdgeAt(a,g),l=this.getTerminal(k,!0),m=this.getTerminal(k,!1);(d&&l==m||l!=m&&(b&&m==a||c&&l==a))&&f.push(k)}return f};mxGraphModel.prototype.getEdgesBetween=function(a,b,c){c=null!=c?c:!1;var d=this.getEdgeCount(a),e=this.getEdgeCount(b),f=a,g=d;e<d&&(g=e,f=b);d=[];for(e=0;e<g;e++){var k=this.getEdgeAt(f,e),l=this.getTerminal(k,!0),m=this.getTerminal(k,!1),n=m==a&&l==b;(l==a&&m==b||!c&&n)&&d.push(k)}return d};mxGraphModel.prototype.getOpposites=function(a,b,c,d){c=null!=c?c:!0;d=null!=d?d:!0;var e=[];if(null!=a)for(var f=0;f<a.length;f++){var g=this.getTerminal(a[f],!0),k=this.getTerminal(a[f],!1);g==b&&null!=k&&k!=b&&d?e.push(k):k==b&&null!=g&&g!=b&&c&&e.push(g)}return e};mxGraphModel.prototype.getTopmostCells=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=!0,f=this.getParent(d);null!=f;){if(0<=mxUtils.indexOf(a,f)){e=!1;break}f=this.getParent(f)}e&&b.push(d)}return b};mxGraphModel.prototype.isVertex=function(a){return null!=a?a.isVertex():!1};mxGraphModel.prototype.isEdge=function(a){return null!=a?a.isEdge():!1};mxGraphModel.prototype.isConnectable=function(a){return null!=a?a.isConnectable():!1};mxGraphModel.prototype.getValue=function(a){return null!=a?a.getValue():null};mxGraphModel.prototype.setValue=function(a,b){this.execute(new mxValueChange(this,a,b));return b};mxGraphModel.prototype.valueForCellChanged=function(a,b){return a.valueChanged(b)};mxGraphModel.prototype.getGeometry=function(a){return null!=a?a.getGeometry():null};mxGraphModel.prototype.setGeometry=function(a,b){b!=this.getGeometry(a)&&this.execute(new mxGeometryChange(this,a,b));return b};mxGraphModel.prototype.geometryForCellChanged=function(a,b){var c=this.getGeometry(a);a.setGeometry(b);return c};mxGraphModel.prototype.getStyle=function(a){return null!=a?a.getStyle():null};mxGraphModel.prototype.setStyle=function(a,b){b!=this.getStyle(a)&&this.execute(new mxStyleChange(this,a,b));return b};mxGraphModel.prototype.styleForCellChanged=function(a,b){var c=this.getStyle(a);a.setStyle(b);return c};mxGraphModel.prototype.isCollapsed=function(a){return null!=a?a.isCollapsed():!1};mxGraphModel.prototype.setCollapsed=function(a,b){b!=this.isCollapsed(a)&&this.execute(new mxCollapseChange(this,a,b));return b};mxGraphModel.prototype.collapsedStateForCellChanged=function(a,b){var c=this.isCollapsed(a);a.setCollapsed(b);return c};mxGraphModel.prototype.isVisible=function(a){return null!=a?a.isVisible():!1};mxGraphModel.prototype.setVisible=function(a,b){b!=this.isVisible(a)&&this.execute(new mxVisibleChange(this,a,b));return b};mxGraphModel.prototype.visibleStateForCellChanged=function(a,b){var c=this.isVisible(a);a.setVisible(b);return c};mxGraphModel.prototype.execute=function(a){a.execute();this.beginUpdate();this.currentEdit.add(a);this.fireEvent(new mxEventObject(mxEvent.EXECUTE,"change",a));this.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",a));this.endUpdate()};mxGraphModel.prototype.beginUpdate=function(){this.updateLevel++;this.fireEvent(new mxEventObject(mxEvent.BEGIN_UPDATE));1==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.START_EDIT))};mxGraphModel.prototype.endUpdate=function(){this.updateLevel--;0==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.END_EDIT));if(!this.endingUpdate){this.endingUpdate=0==this.updateLevel;this.fireEvent(new mxEventObject(mxEvent.END_UPDATE,"edit",this.currentEdit));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new mxEventObject(mxEvent.BEFORE_UNDO,"edit",this.currentEdit));var a=this.currentEdit;this.currentEdit=this.createUndoableEdit();a.notify();this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",a))}}finally{this.endingUpdate=!1}}};mxGraphModel.prototype.createUndoableEdit=function(){var a=new mxUndoableEdit(this,!0);a.notify=function(){a.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",a,"changes",a.changes));a.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",a,"changes",a.changes))};return a};mxGraphModel.prototype.mergeChildren=function(a,b,c){c=null!=c?c:!0;this.beginUpdate();try{var d={};this.mergeChildrenImpl(a,b,c,d);for(var e in d){var f=d[e],g=this.getTerminal(f,!0);null!=g&&(g=d[mxCellPath.create(g)],this.setTerminal(f,g,!0));g=this.getTerminal(f,!1);null!=g&&(g=d[mxCellPath.create(g)],this.setTerminal(f,g,!1))}}finally{this.endUpdate()}};mxGraphModel.prototype.mergeChildrenImpl=function(a,b,c,d){this.beginUpdate();try{for(var e=a.getChildCount(),f=0;f<e;f++){var g=a.getChildAt(f);if("function"==typeof g.getId){var k=g.getId(),l=null==k||this.isEdge(g)&&c?null:this.getCell(k);if(null==l){var m=g.clone();m.setId(k);m.setTerminal(g.getTerminal(!0),!0);m.setTerminal(g.getTerminal(!1),!1);l=b.insert(m);this.cellAdded(l)}d[mxCellPath.create(g)]=l;this.mergeChildrenImpl(g,l,c,d)}}}finally{this.endUpdate()}};mxGraphModel.prototype.getParents=function(a){var b=[];if(null!=a)for(var c={},d=0;d<a.length;d++){var e=this.getParent(a[d]);if(null!=e){var f=mxCellPath.create(e);null==c[f]&&(c[f]=e,b.push(e))}}return b};mxGraphModel.prototype.cloneCell=function(a){return null!=a?this.cloneCells([a],!0)[0]:null};mxGraphModel.prototype.cloneCells=function(a,b){for(var c={},d=[],e=0;e<a.length;e++)null!=a[e]?d.push(this.cloneCellImpl(a[e],c,b)):d.push(null);for(e=0;e<d.length;e++)null!=d[e]&&this.restoreClone(d[e],a[e],c);return d};mxGraphModel.prototype.cloneCellImpl=function(a,b,c){var d=this.cellCloned(a);b[mxObjectIdentity.get(a)]=d;if(c){c=this.getChildCount(a);for(var e=0;e<c;e++){var f=this.cloneCellImpl(this.getChildAt(a,e),b,!0);d.insert(f)}}return d};mxGraphModel.prototype.cellCloned=function(a){return a.clone()};mxGraphModel.prototype.restoreClone=function(a,b,c){var d=this.getTerminal(b,!0);null!=d&&(d=c[mxObjectIdentity.get(d)],null!=d&&d.insertEdge(a,!0));d=this.getTerminal(b,!1);null!=d&&(d=c[mxObjectIdentity.get(d)],null!=d&&d.insertEdge(a,!1));for(var d=this.getChildCount(a),e=0;e<d;e++)this.restoreClone(this.getChildAt(a,e),this.getChildAt(b,e),c)};function mxRootChange(a,b){this.model=a;this.previous=this.root=b}mxRootChange.prototype.execute=function(){this.root=this.previous;this.previous=this.model.rootChanged(this.previous)};function mxChildChange(a,b,c,d){this.model=a;this.previous=this.parent=b;this.child=c;this.previousIndex=this.index=d}
mxChildChange.prototype.execute=function(){var a=this.model.getParent(this.child),b=null!=a?a.getIndex(this.child):0;null==this.previous&&this.connect(this.child,!1);a=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex);null!=this.previous&&this.connect(this.child,!0);this.parent=this.previous;this.previous=a;this.index=this.previousIndex;this.previousIndex=b};mxChildChange.prototype.connect=function(a,b){b=null!=b?b:!0;var c=a.getTerminal(!0),d=a.getTerminal(!1);null!=c&&(b?this.model.terminalForCellChanged(a,c,!0):this.model.terminalForCellChanged(a,null,!0));null!=d&&(b?this.model.terminalForCellChanged(a,d,!1):this.model.terminalForCellChanged(a,null,!1));a.setTerminal(c,!0);a.setTerminal(d,!1);c=this.model.getChildCount(a);for(d=0;d<c;d++)this.connect(this.model.getChildAt(a,d),b)};function mxTerminalChange(a,b,c,d){this.model=a;this.cell=b;this.previous=this.terminal=c;this.source=d}mxTerminalChange.prototype.execute=function(){this.terminal=this.previous;this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)};function mxValueChange(a,b,c){this.model=a;this.cell=b;this.previous=this.value=c}mxValueChange.prototype.execute=function(){this.value=this.previous;this.previous=this.model.valueForCellChanged(this.cell,this.previous)};function mxStyleChange(a,b,c){this.model=a;this.cell=b;this.previous=this.style=c}mxStyleChange.prototype.execute=function(){this.style=this.previous;this.previous=this.model.styleForCellChanged(this.cell,this.previous)};function mxGeometryChange(a,b,c){this.model=a;this.cell=b;this.previous=this.geometry=c}mxGeometryChange.prototype.execute=function(){this.geometry=this.previous;this.previous=this.model.geometryForCellChanged(this.cell,this.previous)};function mxCollapseChange(a,b,c){this.model=a;this.cell=b;this.previous=this.collapsed=c}mxCollapseChange.prototype.execute=function(){this.collapsed=this.previous;this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)};function mxVisibleChange(a,b,c){this.model=a;this.cell=b;this.previous=this.visible=c}mxVisibleChange.prototype.execute=function(){this.visible=this.previous;this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)};function mxCellAttributeChange(a,b,c){this.cell=a;this.attribute=b;this.previous=this.value=c}mxCellAttributeChange.prototype.execute=function(){var a=this.cell.getAttribute(this.attribute);null==this.previous?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous);this.previous=a};function mxCell(a,b,c){this.value=a;this.setGeometry(b);this.setStyle(c);if(null!=this.onInit)this.onInit()}mxCell.prototype.id=null;mxCell.prototype.value=null;mxCell.prototype.geometry=null;mxCell.prototype.style=null;mxCell.prototype.vertex=!1;mxCell.prototype.edge=!1;mxCell.prototype.connectable=!0;mxCell.prototype.visible=!0;mxCell.prototype.collapsed=!1;mxCell.prototype.parent=null;mxCell.prototype.source=null;mxCell.prototype.target=null;mxCell.prototype.children=null;mxCell.prototype.edges=null;mxCell.prototype.mxTransient="id value parent source target children edges".split(" ");mxCell.prototype.getId=function(){return this.id};mxCell.prototype.setId=function(a){this.id=a};mxCell.prototype.getValue=function(){return this.value};mxCell.prototype.setValue=function(a){this.value=a};mxCell.prototype.valueChanged=function(a){var b=this.getValue();this.setValue(a);return b};mxCell.prototype.getGeometry=function(){return this.geometry};mxCell.prototype.setGeometry=function(a){this.geometry=a};mxCell.prototype.getStyle=function(){return this.style};mxCell.prototype.setStyle=function(a){this.style=a};mxCell.prototype.isVertex=function(){return 0!=this.vertex};mxCell.prototype.setVertex=function(a){this.vertex=a};mxCell.prototype.isEdge=function(){return 0!=this.edge};mxCell.prototype.setEdge=function(a){this.edge=a};mxCell.prototype.isConnectable=function(){return 0!=this.connectable};mxCell.prototype.setConnectable=function(a){this.connectable=a};mxCell.prototype.isVisible=function(){return 0!=this.visible};mxCell.prototype.setVisible=function(a){this.visible=a};mxCell.prototype.isCollapsed=function(){return 0!=this.collapsed};mxCell.prototype.setCollapsed=function(a){this.collapsed=a};mxCell.prototype.getParent=function(){return this.parent};mxCell.prototype.setParent=function(a){this.parent=a};mxCell.prototype.getTerminal=function(a){return a?this.source:this.target};mxCell.prototype.setTerminal=function(a,b){b?this.source=a:this.target=a;return a};mxCell.prototype.getChildCount=function(){return null==this.children?0:this.children.length};mxCell.prototype.getIndex=function(a){return mxUtils.indexOf(this.children,a)};mxCell.prototype.getChildAt=function(a){return null==this.children?null:this.children[a]};mxCell.prototype.insert=function(a,b){null!=a&&(null==b&&(b=this.getChildCount(),a.getParent()==this&&b--),a.removeFromParent(),a.setParent(this),null==this.children?(this.children=[],this.children.push(a)):this.children.splice(b,0,a));return a};mxCell.prototype.remove=function(a){var b=null;null!=this.children&&0<=a&&(b=this.getChildAt(a),null!=b&&(this.children.splice(a,1),b.setParent(null)));return b};mxCell.prototype.removeFromParent=function(){if(null!=this.parent){var a=this.parent.getIndex(this);this.parent.remove(a)}};mxCell.prototype.getEdgeCount=function(){return null==this.edges?0:this.edges.length};mxCell.prototype.getEdgeIndex=function(a){return mxUtils.indexOf(this.edges,a)};mxCell.prototype.getEdgeAt=function(a){return null==this.edges?null:this.edges[a]};mxCell.prototype.insertEdge=function(a,b){null!=a&&(a.removeFromTerminal(b),a.setTerminal(this,b),null==this.edges||a.getTerminal(!b)!=this||0>mxUtils.indexOf(this.edges,a))&&(null==this.edges&&(this.edges=[]),this.edges.push(a));return a};mxCell.prototype.removeEdge=function(a,b){if(null!=a){if(a.getTerminal(!b)!=this&&null!=this.edges){var c=this.getEdgeIndex(a);0<=c&&this.edges.splice(c,1)}a.setTerminal(null,b)}return a};mxCell.prototype.removeFromTerminal=function(a){var b=this.getTerminal(a);null!=b&&b.removeEdge(this,a)};mxCell.prototype.getAttribute=function(a,b){var c=this.getValue();return(null!=c&&c.nodeType==mxConstants.NODETYPE_ELEMENT?c.getAttribute(a):null)||b};mxCell.prototype.setAttribute=function(a,b){var c=this.getValue();null!=c&&c.nodeType==mxConstants.NODETYPE_ELEMENT&&c.setAttribute(a,b)};mxCell.prototype.clone=function(){var a=mxUtils.clone(this,this.mxTransient);a.setValue(this.cloneValue());return a};mxCell.prototype.cloneValue=function(){var a=this.getValue();null!=a&&("function"==typeof a.clone?a=a.clone():isNaN(a.nodeType)||(a=a.cloneNode(!0)));return a};function mxGeometry(a,b,c,d){mxRectangle.call(this,a,b,c,d)}mxGeometry.prototype=new mxRectangle;mxGeometry.prototype.constructor=mxGeometry;mxGeometry.prototype.TRANSLATE_CONTROL_POINTS=!0;mxGeometry.prototype.alternateBounds=null;mxGeometry.prototype.sourcePoint=null;mxGeometry.prototype.targetPoint=null;mxGeometry.prototype.points=null;mxGeometry.prototype.offset=null;mxGeometry.prototype.relative=!1;mxGeometry.prototype.swap=function(){if(null!=this.alternateBounds){var a=new mxRectangle(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x;this.y=this.alternateBounds.y;this.width=this.alternateBounds.width;this.height=this.alternateBounds.height;this.alternateBounds=a}};mxGeometry.prototype.getTerminalPoint=function(a){return a?this.sourcePoint:this.targetPoint};mxGeometry.prototype.setTerminalPoint=function(a,b){b?this.sourcePoint=a:this.targetPoint=a;return a};mxGeometry.prototype.rotate=function(a,b){var c=mxUtils.toRadians(a),d=Math.cos(c),c=Math.sin(c);if(!this.relative){var e=new mxPoint(this.getCenterX(),this.getCenterY()),e=mxUtils.getRotatedPoint(e,d,c,b);this.x=Math.round(e.x-this.width/2);this.y=Math.round(e.y-this.height/2)}null!=this.sourcePoint&&(e=mxUtils.getRotatedPoint(this.sourcePoint,d,c,b),this.sourcePoint.x=Math.round(e.x),this.sourcePoint.y=Math.round(e.y));null!=this.targetPoint&&(e=mxUtils.getRotatedPoint(this.targetPoint,d,c,b),this.targetPoint.x=Math.round(e.x),this.targetPoint.y=Math.round(e.y));if(null!=this.points)for(var f=0;f<this.points.length;f++)null!=this.points[f]&&(e=mxUtils.getRotatedPoint(this.points[f],d,c,b),this.points[f].x=Math.round(e.x),this.points[f].y=Math.round(e.y))};mxGeometry.prototype.translate=function(a,b){a=parseFloat(a);b=parseFloat(b);this.relative||(this.x=parseFloat(this.x)+a,this.y=parseFloat(this.y)+b);null!=this.sourcePoint&&(this.sourcePoint.x=parseFloat(this.sourcePoint.x)+a,this.sourcePoint.y=parseFloat(this.sourcePoint.y)+b);null!=this.targetPoint&&(this.targetPoint.x=parseFloat(this.targetPoint.x)+a,this.targetPoint.y=parseFloat(this.targetPoint.y)+b);if(this.TRANSLATE_CONTROL_POINTS&&null!=this.points)for(var c=0;c<this.points.length;c++)null!=this.points[c]&&(this.points[c].x=parseFloat(this.points[c].x)+a,this.points[c].y=parseFloat(this.points[c].y)+b)};mxGeometry.prototype.scale=function(a,b,c){a=parseFloat(a);b=parseFloat(b);null!=this.sourcePoint&&(this.sourcePoint.x=parseFloat(this.sourcePoint.x)*a,this.sourcePoint.y=parseFloat(this.sourcePoint.y)*b);null!=this.targetPoint&&(this.targetPoint.x=parseFloat(this.targetPoint.x)*a,this.targetPoint.y=parseFloat(this.targetPoint.y)*b);if(null!=this.points)for(var d=0;d<this.points.length;d++)null!=this.points[d]&&(this.points[d].x=parseFloat(this.points[d].x)*a,this.points[d].y=parseFloat(this.points[d].y)*b);this.relative||(this.x=parseFloat(this.x)*a,this.y=parseFloat(this.y)*b,c&&(b=a=Math.min(a,b)),this.width=parseFloat(this.width)*a,this.height=parseFloat(this.height)*b)};mxGeometry.prototype.equals=function(a){return mxRectangle.prototype.equals.apply(this,arguments)&&this.relative==a.relative&&(null==this.sourcePoint&&null==a.sourcePoint||null!=this.sourcePoint&&this.sourcePoint.equals(a.sourcePoint))&&(null==this.targetPoint&&null==a.targetPoint||null!=this.targetPoint&&this.targetPoint.equals(a.targetPoint))&&(null==this.points&&null==a.points||null!=this.points&&mxUtils.equalPoints(this.points,a.points))&&(null==this.alternateBounds&&null==a.alternateBounds||null!=this.alternateBounds&&this.alternateBounds.equals(a.alternateBounds))&&(null==this.offset&&null==a.offset||null!=this.offset&&this.offset.equals(a.offset))};var mxCellPath={PATH_SEPARATOR:".",create:function(a){var b="";if(null!=a)for(var c=a.getParent();null!=c;)b=c.getIndex(a)+mxCellPath.PATH_SEPARATOR+b,a=c,c=a.getParent();a=b.length;1<a&&(b=b.substring(0,a-1));return b},getParentPath:function(a){if(null!=a){var b=a.lastIndexOf(mxCellPath.PATH_SEPARATOR);if(0<=b)return a.substring(0,b);if(0<a.length)return""}return null},resolve:function(a,b){var c=a;if(null!=b)for(var d=b.split(mxCellPath.PATH_SEPARATOR),e=0;e<d.length;e++)c=c.getChildAt(parseInt(d[e]));return c},compare:function(a,b){for(var c=Math.min(a.length,b.length),d=0,e=0;e<c;e++)if(a[e]!=b[e]){0==a[e].length||0==b[e].length?d=a[e]==b[e]?0:a[e]>b[e]?1:-1:(c=parseInt(a[e]),e=parseInt(b[e]),d=c==e?0:c>e?1:-1);break}0==d&&(c=a.length,e=b.length,c!=e&&(d=c>e?1:-1));return d}},mxPerimeter={RectanglePerimeter:function(a,b,c,d){b=a.getCenterX();var e=a.getCenterY(),f=Math.atan2(c.y-e,c.x-b),g=new mxPoint(0,0),k=Math.PI,l=Math.PI/2-f,m=Math.atan2(a.height,a.width);f<-k+m||f>k-m?(g.x=a.x,g.y=e-a.width*Math.tan(f)/2):f<-m?(g.y=a.y,g.x=b-a.height*Math.tan(l)/2):f<m?(g.x=a.x+a.width,g.y=e+a.width*Math.tan(f)/2):(g.y=a.y+a.height,g.x=b+a.height*Math.tan(l)/2);d&&(c.x>=a.x&&c.x<=a.x+a.width?g.x=c.x:c.y>=a.y&&c.y<=a.y+a.height&&(g.y=c.y),c.x<a.x?g.x=a.x:c.x>a.x+a.width&&(g.x=a.x+a.width),c.y<a.y?g.y=a.y:c.y>a.y+a.height&&(g.y=a.y+a.height));return g},EllipsePerimeter:function(a,b,c,d){var e=a.x,f=a.y,g=a.width/2,k=a.height/2,l=e+g,m=f+k;b=c.x;c=c.y;var n=parseInt(b-l),p=parseInt(c-m);if(0==n&&0!=p)return new mxPoint(l,
m+k*p/Math.abs(p));if(0==n&&0==p)return new mxPoint(b,c);if(d){if(c>=f&&c<=f+a.height)return a=c-m,a=Math.sqrt(g*g*(1-a*a/(k*k)))||0,b<=e&&(a=-a),new mxPoint(l+a,c);if(b>=e&&b<=e+a.width)return a=b-l,a=Math.sqrt(k*k*(1-a*a/(g*g)))||0,c<=f&&(a=-a),new mxPoint(b,m+a)}e=p/n;m-=e*l;f=g*g*e*e+k*k;a=-2*l*f;k=Math.sqrt(a*a-4*f*(g*g*e*e*l*l+k*k*l*l-g*g*k*k));g=(-a+k)/(2*f);k=(-a-k)/(2*f);l=e*g+m;m=e*k+m;e=Math.sqrt(Math.pow(g-b,2)+Math.pow(l-c,2));b=Math.sqrt(Math.pow(k-b,2)+Math.pow(m-c,2));f=c=0;e<b?(c=
g,f=l):(c=k,f=m);return new mxPoint(c,f)},RhombusPerimeter:function(a,b,c,d){b=a.x;var e=a.y,f=a.width;a=a.height;var g=b+f/2,k=e+a/2,l=c.x;c=c.y;if(g==l)return k>c?new mxPoint(g,e):new mxPoint(g,e+a);if(k==c)return g>l?new mxPoint(b,k):new mxPoint(b+f,k);var m=g,n=k;d&&(l>=b&&l<=b+f?m=l:c>=e&&c<=e+a&&(n=c));return l<g?c<k?mxUtils.intersection(l,c,m,n,g,e,b,k):mxUtils.intersection(l,c,m,n,g,e+a,b,k):c<k?mxUtils.intersection(l,c,m,n,g,e,b+f,k):mxUtils.intersection(l,c,m,n,g,e+a,b+f,k)},TrianglePerimeter:function(a,b,c,d){b=null!=b?b.style[mxConstants.STYLE_DIRECTION]:null;var e=b==mxConstants.DIRECTION_NORTH||b==mxConstants.DIRECTION_SOUTH,f=a.x,g=a.y,k=a.width;a=a.height;var l=f+k/2,m=g+a/2,n=new mxPoint(f,g),p=new mxPoint(f+k,m),q=new mxPoint(f,g+a);b==mxConstants.DIRECTION_NORTH?(n=q,p=new mxPoint(l,g),q=new mxPoint(f+k,g+a)):b==mxConstants.DIRECTION_SOUTH?(p=new mxPoint(l,g+a),q=new mxPoint(f+k,g)):b==mxConstants.DIRECTION_WEST&&(n=new mxPoint(f+k,g),p=new mxPoint(f,m),q=new mxPoint(f+k,g+a));var u=c.x-
l,v=c.y-m,u=e?Math.atan2(u,v):Math.atan2(v,u),y=e?Math.atan2(k,a):Math.atan2(a,k),v=b==mxConstants.DIRECTION_NORTH||b==mxConstants.DIRECTION_WEST?u>-y&&u<y:u<-Math.PI+y||u>Math.PI-y,y=null;v?y=d&&(e&&c.x>=n.x&&c.x<=q.x||!e&&c.y>=n.y&&c.y<=q.y)?e?new mxPoint(c.x,n.y):new mxPoint(n.x,c.y):b==mxConstants.DIRECTION_NORTH?new mxPoint(f+k/2+a*Math.tan(u)/2,g+a):b==mxConstants.DIRECTION_SOUTH?new mxPoint(f+k/2-a*Math.tan(u)/2,g):b==mxConstants.DIRECTION_WEST?new mxPoint(f+k,g+a/2+k*Math.tan(u)/2):new mxPoint(f,
g+a/2-k*Math.tan(u)/2):(d&&(d=new mxPoint(l,m),c.y>=g&&c.y<=g+a?(d.x=e?l:b==mxConstants.DIRECTION_WEST?f+k:f,d.y=c.y):c.x>=f&&c.x<=f+k&&(d.x=c.x,d.y=e?b==mxConstants.DIRECTION_NORTH?g+a:g:m),l=d.x,m=d.y),y=e&&c.x<=f+k/2||!e&&c.y<=g+a/2?mxUtils.intersection(c.x,c.y,l,m,n.x,n.y,p.x,p.y):mxUtils.intersection(c.x,c.y,l,m,p.x,p.y,q.x,q.y));null==y&&(y=new mxPoint(l,m));return y},HexagonPerimeter:function(a,b,c,d){var e=a.x,f=a.y,g=a.width,k=a.height,l=a.getCenterX();a=a.getCenterY();var m=c.x,n=c.y,p=
-Math.atan2(n-a,m-l),q=Math.PI,u=Math.PI/2,v=new mxPoint(l,a);b=null!=b?mxUtils.getValue(b.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST):mxConstants.DIRECTION_EAST;var y=b==mxConstants.DIRECTION_NORTH||b==mxConstants.DIRECTION_SOUTH;b=new mxPoint;v=new mxPoint;if(m<e&&n<f||m<e&&n>f+k||m>e+g&&n<f||m>e+g&&n>f+k)d=!1;if(d){if(y){if(m==l){if(n<=f)return new mxPoint(l,f);if(n>=f+k)return new mxPoint(l,f+k)}else if(m<e){if(n==f+k/4)return new mxPoint(e,f+k/4);if(n==f+3*k/4)return new mxPoint(e,f+3*k/4)}else if(m>e+g){if(n==f+k/4)return new mxPoint(e+g,f+k/4);if(n==f+3*k/4)return new mxPoint(e+g,f+3*k/4)}else if(m==e){if(n<a)return new mxPoint(e,f+k/4);if(n>a)return new mxPoint(e,f+3*k/4)}else if(m==e+g){if(n<a)return new mxPoint(e+g,f+k/4);if(n>a)return new mxPoint(e+g,f+3*k/4)}if(n==f)return new mxPoint(l,f);if(n==f+k)return new mxPoint(l,f+k);m<l?n>f+k/4&&n<f+3*k/4?(b=new mxPoint(e,f),v=new mxPoint(e,f+k)):n<f+k/4?(b=new mxPoint(e-Math.floor(0.5*g),f+Math.floor(0.5*k)),v=new mxPoint(e+
g,f-Math.floor(0.25*k))):n>f+3*k/4&&(b=new mxPoint(e-Math.floor(0.5*g),f+Math.floor(0.5*k)),v=new mxPoint(e+g,f+Math.floor(1.25*k))):m>l&&(n>f+k/4&&n<f+3*k/4?(b=new mxPoint(e+g,f),v=new mxPoint(e+g,f+k)):n<f+k/4?(b=new mxPoint(e,f-Math.floor(0.25*k)),v=new mxPoint(e+Math.floor(1.5*g),f+Math.floor(0.5*k))):n>f+3*k/4&&(b=new mxPoint(e+Math.floor(1.5*g),f+Math.floor(0.5*k)),v=new mxPoint(e,f+Math.floor(1.25*k))))}else{if(n==a){if(m<=e)return new mxPoint(e,f+k/2);if(m>=e+g)return new mxPoint(e+g,f+k/
2)}else if(n<f){if(m==e+g/4)return new mxPoint(e+g/4,f);if(m==e+3*g/4)return new mxPoint(e+3*g/4,f)}else if(n>f+k){if(m==e+g/4)return new mxPoint(e+g/4,f+k);if(m==e+3*g/4)return new mxPoint(e+3*g/4,f+k)}else if(n==f){if(m<l)return new mxPoint(e+g/4,f);if(m>l)return new mxPoint(e+3*g/4,f)}else if(n==f+k){if(m<l)return new mxPoint(e+g/4,f+k);if(n>a)return new mxPoint(e+3*g/4,f+k)}if(m==e)return new mxPoint(e,a);if(m==e+g)return new mxPoint(e+g,a);n<a?m>e+g/4&&m<e+3*g/4?(b=new mxPoint(e,f),v=new mxPoint(e+
g,f)):m<e+g/4?(b=new mxPoint(e-Math.floor(0.25*g),f+k),v=new mxPoint(e+Math.floor(0.5*g),f-Math.floor(0.5*k))):m>e+3*g/4&&(b=new mxPoint(e+Math.floor(0.5*g),f-Math.floor(0.5*k)),v=new mxPoint(e+Math.floor(1.25*g),f+k)):n>a&&(m>e+g/4&&m<e+3*g/4?(b=new mxPoint(e,f+k),v=new mxPoint(e+g,f+k)):m<e+g/4?(b=new mxPoint(e-Math.floor(0.25*g),f),v=new mxPoint(e+Math.floor(0.5*g),f+Math.floor(1.5*k))):m>e+3*g/4&&(b=new mxPoint(e+Math.floor(0.5*g),f+Math.floor(1.5*k)),v=new mxPoint(e+Math.floor(1.25*g),f)))}d=l;p=a;m>=e&&m<=e+g?(d=m,p=n<a?f+k:f):n>=f&&n<=f+k&&(p=n,d=m<l?e+g:e);v=mxUtils.intersection(d,p,c.x,c.y,b.x,b.y,v.x,v.y)}else{if(y){m=Math.atan2(k/4,g/2);if(p==m)return new mxPoint(e+g,f+Math.floor(0.25*k));if(p==u)return new mxPoint(e+Math.floor(0.5*g),f);if(p==q-m)return new mxPoint(e,f+Math.floor(0.25*k));if(p==-m)return new mxPoint(e+g,f+Math.floor(0.75*k));if(p==-u)return new mxPoint(e+Math.floor(0.5*g),f+k);if(p==-q+m)return new mxPoint(e,f+Math.floor(0.75*k));p<m&&p>-m?(b=new mxPoint(e+g,f),v=new mxPoint(e+g,f+k)):p>m&&p<u?(b=new mxPoint(e,f-Math.floor(0.25*k)),v=new mxPoint(e+Math.floor(1.5*g),f+Math.floor(0.5*k))):p>u&&p<q-m?(b=new mxPoint(e-Math.floor(0.5*g),f+Math.floor(0.5*k)),v=new mxPoint(e+g,f-Math.floor(0.25*k))):p>q-m&&p<=q||p<-q+m&&p>=-q?(b=new mxPoint(e,f),v=new mxPoint(e,f+k)):p<-m&&p>-u?(b=new mxPoint(e+Math.floor(1.5*g),f+Math.floor(0.5*k)),v=new mxPoint(e,f+Math.floor(1.25*k))):p<-u&&p>-q+m&&(b=new mxPoint(e-Math.floor(0.5*g),f+Math.floor(0.5*k)),v=new mxPoint(e+g,f+
Math.floor(1.25*k)))}else{m=Math.atan2(k/2,g/4);if(p==m)return new mxPoint(e+Math.floor(0.75*g),f);if(p==q-m)return new mxPoint(e+Math.floor(0.25*g),f);if(p==q||p==-q)return new mxPoint(e,f+Math.floor(0.5*k));if(0==p)return new mxPoint(e+g,f+Math.floor(0.5*k));if(p==-m)return new mxPoint(e+Math.floor(0.75*g),f+k);if(p==-q+m)return new mxPoint(e+Math.floor(0.25*g),f+k);0<p&&p<m?(b=new mxPoint(e+Math.floor(0.5*g),f-Math.floor(0.5*k)),v=new mxPoint(e+Math.floor(1.25*g),f+k)):p>m&&p<q-m?(b=new mxPoint(e,f),v=new mxPoint(e+g,f)):p>q-m&&p<q?(b=new mxPoint(e-Math.floor(0.25*g),f+k),v=new mxPoint(e+Math.floor(0.5*g),f-Math.floor(0.5*k))):0>p&&p>-m?(b=new mxPoint(e+Math.floor(0.5*g),f+Math.floor(1.5*k)),v=new mxPoint(e+Math.floor(1.25*g),f)):p<-m&&p>-q+m?(b=new mxPoint(e,f+k),v=new mxPoint(e+g,f+k)):p<-q+m&&p>-q&&(b=new mxPoint(e-Math.floor(0.25*g),f),v=new mxPoint(e+Math.floor(0.5*g),f+Math.floor(1.5*k)))}v=mxUtils.intersection(l,a,c.x,c.y,b.x,b.y,v.x,v.y)}return null==v?new mxPoint(l,a):v}};function mxPrintPreview(a,b,c,d,e,f,g,k,l){this.graph=a;this.scale=null!=b?b:1/a.pageScale;this.border=null!=d?d:0;this.pageFormat=null!=c?c:a.pageFormat;this.title=null!=k?k:"Printer-friendly version";this.x0=null!=e?e:0;this.y0=null!=f?f:0;this.borderColor=g;this.pageSelector=null!=l?l:!0}mxPrintPreview.prototype.graph=null;mxPrintPreview.prototype.pageFormat=null;mxPrintPreview.prototype.scale=null;mxPrintPreview.prototype.border=0;mxPrintPreview.prototype.x0=0;mxPrintPreview.prototype.y0=0;mxPrintPreview.prototype.autoOrigin=!0;mxPrintPreview.prototype.printOverlays=!1;mxPrintPreview.prototype.printControls=!1;mxPrintPreview.prototype.printBackgroundImage=!1;mxPrintPreview.prototype.borderColor=null;mxPrintPreview.prototype.title=null;mxPrintPreview.prototype.pageSelector=null;mxPrintPreview.prototype.wnd=null;mxPrintPreview.prototype.pageCount=0;mxPrintPreview.prototype.getWindow=function(){return this.wnd};mxPrintPreview.prototype.getDoctype=function(){var a="";5==document.documentMode?a='<meta http-equiv="X-UA-Compatible" content="IE=5">':8==document.documentMode?a='<meta http-equiv="X-UA-Compatible" content="IE=8">':8<document.documentMode&&(a='\x3c!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--\x3e');return a};mxPrintPreview.prototype.open=function(a){var b=this.graph.cellRenderer.initializeOverlay,c=null;try{this.printOverlays&&(this.graph.cellRenderer.initializeOverlay=function(a,b){b.init(a.view.getDrawPane())});this.printControls&&(this.graph.cellRenderer.initControl=function(a,b,c,d){b.dialect=a.view.graph.dialect;b.init(a.view.getDrawPane())});if(null==this.wnd){this.wnd=window.open();var d=this.wnd.document,e=this.getDoctype();null!=e&&0<e.length&&d.writeln(e);mxClient.IS_VML?d.writeln('<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">'):("CSS1Compat"===document.compatMode&&d.writeln("<!DOCTYPE html>"),d.writeln("<html>"));d.writeln("<head>");this.writeHead(d,a);d.writeln("</head>");d.writeln('<body class="mxPage">');var f=this.graph.getGraphBounds().clone(),g=this.graph.getView().getScale(),k=g/this.scale,l=this.graph.getView().getTranslate();this.autoOrigin||(this.x0-=l.x*this.scale,this.y0-=l.y*this.scale,f.width+=f.x,f.height+=f.y,f.x=0,this.border=f.y=0);f.width/=k;f.height/=k;var m=this.pageFormat.width-2*this.border,n=this.pageFormat.height-
2*this.border,p=Math.max(1,Math.ceil((f.width+this.x0)/m)),q=Math.max(1,Math.ceil((f.height+this.y0)/n));this.pageCount=p*q;var u=mxUtils.bind(this,function(){if(this.pageSelector&&(1<q||1<p)){var a=this.createPageSelector(q,p);d.body.appendChild(a);if(mxClient.IS_IE&&null==d.documentMode||5==d.documentMode||8==d.documentMode||7==d.documentMode){a.style.position="absolute";var b=function(){a.style.top=(d.body.scrollTop||d.documentElement.scrollTop)+10+"px"};mxEvent.addListener(this.wnd,"scroll",function(a){b()});
mxEvent.addListener(this.wnd,"resize",function(a){b()})}}});a=function(a,b){null!=this.borderColor&&(a.style.borderColor=this.borderColor,a.style.borderStyle="solid",a.style.borderWidth="1px");a.style.background="white";b&&(a.style.pageBreakAfter="always");mxClient.IS_IE||11<=document.documentMode?(d.writeln(a.outerHTML),a.parentNode.removeChild(a)):(a.parentNode.removeChild(a),d.body.appendChild(a));if(b){var c=d.createElement("hr");c.className="mxPageBreak";d.body.appendChild(c)}};var v=this.getCoverPages(this.pageFormat.width,this.pageFormat.height);if(null!=v)for(var y=0;y<v.length;y++)a(v[y],!0);for(var z=this.getAppendices(this.pageFormat.width,this.pageFormat.height),y=0;y<q;y++)for(var x=y*n/this.scale-this.y0/this.scale+(f.y-l.y*g)/g,v=0;v<p;v++){if(null==this.wnd)return null;var B=v*m/this.scale-this.x0/this.scale+(f.x-l.x*g)/g,A=y*p+v+1,D=new mxRectangle(B,x,this.pageFormat.width,this.pageFormat.height),c=this.renderPage(this.pageFormat.width,this.pageFormat.height,0,0,mxUtils.bind(this,function(a){this.addGraphFragment(-B,
-x,this.scale,A,a,D);this.printBackgroundImage&&this.insertBackgroundImage(a,-B,-x)}));c.setAttribute("id","mxPage-"+A);a(c,null!=z||y<q-1||v<p-1)}if(null!=z)for(y=0;y<z.length;y++)a(z[y],y<z.length);d.writeln("</body>");d.writeln("</html>");d.close();u();mxEvent.release(d.body)}this.wnd.focus()}catch(E){null!=c&&null!=c.parentNode&&c.parentNode.removeChild(c)}finally{this.graph.cellRenderer.initializeOverlay=b}return this.wnd};mxPrintPreview.prototype.writeHead=function(a,b){null!=this.title&&a.writeln("<title>"+this.title+"</title>");mxClient.IS_VML&&a.writeln('<style type="text/css">v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}</style>');mxClient.link("stylesheet",mxClient.basePath+"/css/common.css",a);a.writeln('<style type="text/css">');a.writeln("@media print {");a.writeln("  table.mxPageSelector { display: none; }");a.writeln("  hr.mxPageBreak { display: none; }");a.writeln("}");a.writeln("@media screen {");a.writeln("  table.mxPageSelector { position: fixed; right: 10px; top: 10px;font-family: Arial; font-size:10pt; border: solid 1px darkgray;background: white; border-collapse:collapse; }");a.writeln("  table.mxPageSelector td { border: solid 1px gray; padding:4px; }");a.writeln("  body.mxPage { background: gray; }");a.writeln("}");null!=b&&a.writeln(b);a.writeln("</style>")};mxPrintPreview.prototype.createPageSelector=function(a,b){var c=this.wnd.document,d=c.createElement("table");d.className="mxPageSelector";d.setAttribute("border","0");for(var e=c.createElement("tbody"),f=0;f<a;f++){for(var g=c.createElement("tr"),k=0;k<b;k++){var l=f*b+k+1,m=c.createElement("td"),n=c.createElement("a");n.setAttribute("href","#mxPage-"+l);mxClient.IS_NS&&!mxClient.IS_SF&&!mxClient.IS_GC&&n.setAttribute("onclick","var page = document.getElementById('mxPage-"+l+"');page.scrollIntoView(true);event.preventDefault();");mxUtils.write(n,l,c);m.appendChild(n);g.appendChild(m)}e.appendChild(g)}d.appendChild(e);return d};mxPrintPreview.prototype.renderPage=function(a,b,c,d,e){var f=this.wnd.document,g=document.createElement("div"),k=null;try{if(0!=c||0!=d){g.style.position="relative";g.style.width=a+"px";g.style.height=b+"px";g.style.pageBreakInside="avoid";var l=document.createElement("div");l.style.position="relative";l.style.top=this.border+"px";l.style.left=this.border+"px";l.style.width=a-2*this.border+"px";l.style.height=b-2*this.border+"px";l.style.overflow="hidden";var m=document.createElement("div");m.style.position="relative";m.style.marginLeft=c+"px";m.style.marginTop=d+"px";8==f.documentMode&&(l.style.position="absolute",m.style.position="absolute");10==f.documentMode&&(m.style.width="100%",m.style.height="100%");l.appendChild(m);g.appendChild(l);document.body.appendChild(g);k=m}else g.style.width=a+"px",g.style.height=b+"px",g.style.overflow="hidden",g.style.pageBreakInside="avoid",8==f.documentMode&&(g.style.position="relative"),l=document.createElement("div"),l.style.width=a-2*this.border+"px",l.style.height=b-2*this.border+"px",l.style.overflow="hidden",!mxClient.IS_IE||null!=f.documentMode&&5!=f.documentMode&&8!=f.documentMode&&7!=f.documentMode?(l.style.top=this.border+"px",l.style.left=this.border+"px"):(l.style.marginTop=this.border+"px",l.style.marginLeft=this.border+"px"),this.graph.dialect==mxConstants.DIALECT_VML&&(l.style.position="absolute"),g.appendChild(l),document.body.appendChild(g),k=l}catch(n){throw g.parentNode.removeChild(g),n;}e(k);return g};mxPrintPreview.prototype.getRoot=function(){var a=this.graph.view.currentRoot;null==a&&(a=this.graph.getModel().getRoot());return a};mxPrintPreview.prototype.addGraphFragment=function(a,b,c,d,e,f){d=this.graph.getView();f=this.graph.container;this.graph.container=e;var g=d.getCanvas(),k=d.getBackgroundPane(),l=d.getDrawPane(),m=d.getOverlayPane();this.graph.dialect==mxConstants.DIALECT_SVG?d.createSvg():this.graph.dialect==mxConstants.DIALECT_VML?d.createVml():d.createHtml();var n=d.isEventsEnabled();d.setEventsEnabled(!1);var p=this.graph.isEnabled();this.graph.setEnabled(!1);var q=d.getTranslate();d.translate=new mxPoint(a,b);a=null;try{var u=[this.getRoot()];a=new mxTemporaryCellStates(d,c,u)}finally{if(mxClient.IS_IE)d.overlayPane.innerHTML="";else for(c=e.firstChild;null!=c;)u=c.nextSibling,b=c.nodeName.toLowerCase(),"svg"==b?(c.setAttribute("width",parseInt(e.style.width)),c.setAttribute("height",parseInt(e.style.height))):"default"!=c.style.cursor&&"div"!=b&&c.parentNode.removeChild(c),c=u;this.printBackgroundImage&&(e=e.getElementsByTagName("svg"),0<e.length&&(e[0].style.position="absolute"));d.overlayPane.parentNode.removeChild(d.overlayPane);this.graph.setEnabled(p);this.graph.container=f;d.canvas=g;d.backgroundPane=k;d.drawPane=l;d.overlayPane=m;d.translate=q;a.destroy();d.setEventsEnabled(n)}};mxPrintPreview.prototype.insertBackgroundImage=function(a,b,c){var d=this.graph.backgroundImage;if(null!=d){var e=document.createElement("img");e.style.position="absolute";e.style.marginLeft=Math.round(b*this.scale)+"px";e.style.marginTop=Math.round(c*this.scale)+"px";e.setAttribute("width",Math.round(this.scale*d.width));e.setAttribute("height",Math.round(this.scale*d.height));e.src=d.src;a.insertBefore(e,a.firstChild)}};mxPrintPreview.prototype.getCoverPages=function(){return null};mxPrintPreview.prototype.getAppendices=function(){return null};mxPrintPreview.prototype.print=function(a){a=this.open(a);null!=a&&a.print()};mxPrintPreview.prototype.close=function(){null!=this.wnd&&(this.wnd.close(),this.wnd=null)};function mxStylesheet(){this.styles={};this.putDefaultVertexStyle(this.createDefaultVertexStyle());this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}
mxStylesheet.prototype.createDefaultVertexStyle=function(){var a={};a[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_RECTANGLE;a[mxConstants.STYLE_PERIMETER]=mxPerimeter.RectanglePerimeter;a[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;a[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;a[mxConstants.STYLE_FILLCOLOR]="#C3D9FF";a[mxConstants.STYLE_STROKECOLOR]="#6482B9";a[mxConstants.STYLE_FONTCOLOR]="#774400";return a};mxStylesheet.prototype.createDefaultEdgeStyle=function(){var a={};a[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_CONNECTOR;a[mxConstants.STYLE_ENDARROW]=mxConstants.ARROW_CLASSIC;a[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;a[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;a[mxConstants.STYLE_STROKECOLOR]="#6482B9";a[mxConstants.STYLE_FONTCOLOR]="#446299";return a};mxStylesheet.prototype.putDefaultVertexStyle=function(a){this.putCellStyle("defaultVertex",a)};mxStylesheet.prototype.putDefaultEdgeStyle=function(a){this.putCellStyle("defaultEdge",a)};mxStylesheet.prototype.getDefaultVertexStyle=function(){return this.styles.defaultVertex};mxStylesheet.prototype.getDefaultEdgeStyle=function(){return this.styles.defaultEdge};mxStylesheet.prototype.putCellStyle=function(a,b){this.styles[a]=b};mxStylesheet.prototype.getCellStyle=function(a,b){var c=b;if(null!=a&&0<a.length)for(var d=a.split(";"),c=null!=c&&";"!=a.charAt(0)?mxUtils.clone(c):{},e=0;e<d.length;e++){var f=d[e],g=f.indexOf("=");if(0<=g){var k=f.substring(0,g),f=f.substring(g+1);f==mxConstants.NONE?delete c[k]:mxUtils.isNumeric(f)?c[k]=parseFloat(f):c[k]=f}else if(f=this.styles[f],null!=f)for(k in f)c[k]=f[k]}return c};function mxCellState(a,b,c){this.view=a;this.cell=b;this.style=c;this.origin=new mxPoint;this.absoluteOffset=new mxPoint}mxCellState.prototype=new mxRectangle;mxCellState.prototype.constructor=mxCellState;mxCellState.prototype.view=null;mxCellState.prototype.cell=null;mxCellState.prototype.style=null;mxCellState.prototype.invalid=!0;mxCellState.prototype.origin=null;mxCellState.prototype.absolutePoints=null;mxCellState.prototype.absoluteOffset=null;mxCellState.prototype.visibleSourceState=null;mxCellState.prototype.visibleTargetState=null;mxCellState.prototype.terminalDistance=0;mxCellState.prototype.length=0;mxCellState.prototype.segments=null;mxCellState.prototype.shape=null;mxCellState.prototype.text=null;mxCellState.prototype.getPerimeterBounds=function(a,b){a=a||0;b=null!=b?b:new mxRectangle(this.x,this.y,this.width,this.height);if(null!=this.shape&&null!=this.shape.stencil&&"fixed"==this.shape.stencil.aspect){var c=this.shape.stencil.computeAspect(this.style,b.x,b.y,b.width,b.height);b.x=c.x;b.y=c.y;b.width=this.shape.stencil.w0*c.width;b.height=this.shape.stencil.h0*c.height}0!=a&&b.grow(a);return b};mxCellState.prototype.setAbsoluteTerminalPoint=function(a,b){b?(null==this.absolutePoints&&(this.absolutePoints=[]),0==this.absolutePoints.length?this.absolutePoints.push(a):this.absolutePoints[0]=a):null==this.absolutePoints?(this.absolutePoints=[],this.absolutePoints.push(null),this.absolutePoints.push(a)):1==this.absolutePoints.length?this.absolutePoints.push(a):this.absolutePoints[this.absolutePoints.length-1]=a};mxCellState.prototype.setCursor=function(a){null!=this.shape&&this.shape.setCursor(a);null!=this.text&&this.text.setCursor(a)};mxCellState.prototype.getVisibleTerminal=function(a){a=this.getVisibleTerminalState(a);return null!=a?a.cell:null};mxCellState.prototype.getVisibleTerminalState=function(a){return a?this.visibleSourceState:this.visibleTargetState};mxCellState.prototype.setVisibleTerminalState=function(a,b){b?this.visibleSourceState=a:this.visibleTargetState=a};mxCellState.prototype.getCellBounds=function(){return this.cellBounds};mxCellState.prototype.getPaintBounds=function(){return this.paintBounds};mxCellState.prototype.updateCachedBounds=function(){var a=this.view.translate,b=this.view.scale;this.cellBounds=new mxRectangle(this.x/b-a.x,this.y/b-a.y,this.width/b,this.height/b);this.paintBounds=mxRectangle.fromRectangle(this.cellBounds);null!=this.shape&&this.shape.isPaintBoundsInverted()&&this.paintBounds.rotate90()};mxCellState.prototype.destroy=function(){this.view.graph.cellRenderer.destroy(this)};mxCellState.prototype.clone=function(){var a=new mxCellState(this.view,this.cell,this.style);if(null!=this.absolutePoints){a.absolutePoints=[];for(var b=0;b<this.absolutePoints.length;b++)a.absolutePoints[b]=this.absolutePoints[b].clone()}null!=this.origin&&(a.origin=this.origin.clone());null!=this.absoluteOffset&&(a.absoluteOffset=this.absoluteOffset.clone());null!=this.boundingBox&&(a.boundingBox=this.boundingBox.clone());a.terminalDistance=this.terminalDistance;a.segments=this.segments;a.length=this.length;a.x=this.x;a.y=this.y;a.width=this.width;a.height=this.height;return a};function mxGraphSelectionModel(a){this.graph=a;this.cells=[]}mxGraphSelectionModel.prototype=new mxEventSource;mxGraphSelectionModel.prototype.constructor=mxGraphSelectionModel;mxGraphSelectionModel.prototype.doneResource="none"!=mxClient.language?"done":"";mxGraphSelectionModel.prototype.updatingSelectionResource="none"!=mxClient.language?"updatingSelection":"";mxGraphSelectionModel.prototype.graph=null;mxGraphSelectionModel.prototype.singleSelection=!1;mxGraphSelectionModel.prototype.isSingleSelection=function(){return this.singleSelection};mxGraphSelectionModel.prototype.setSingleSelection=function(a){this.singleSelection=a};mxGraphSelectionModel.prototype.isSelected=function(a){return null!=a?0<=mxUtils.indexOf(this.cells,a):!1};mxGraphSelectionModel.prototype.isEmpty=function(){return 0==this.cells.length};mxGraphSelectionModel.prototype.clear=function(){this.changeSelection(null,this.cells)};mxGraphSelectionModel.prototype.setCell=function(a){null!=a&&this.setCells([a])};mxGraphSelectionModel.prototype.setCells=function(a){if(null!=a){this.singleSelection&&(a=[this.getFirstSelectableCell(a)]);for(var b=[],c=0;c<a.length;c++)this.graph.isCellSelectable(a[c])&&b.push(a[c]);this.changeSelection(b,this.cells)}};mxGraphSelectionModel.prototype.getFirstSelectableCell=function(a){if(null!=a)for(var b=0;b<a.length;b++)if(this.graph.isCellSelectable(a[b]))return a[b];return null};
mxGraphSelectionModel.prototype.addCell=function(a){null!=a&&this.addCells([a])};mxGraphSelectionModel.prototype.addCells=function(a){if(null!=a){var b=null;this.singleSelection&&(b=this.cells,a=[this.getFirstSelectableCell(a)]);for(var c=[],d=0;d<a.length;d++)!this.isSelected(a[d])&&this.graph.isCellSelectable(a[d])&&c.push(a[d]);this.changeSelection(c,b)}};mxGraphSelectionModel.prototype.removeCell=function(a){null!=a&&this.removeCells([a])};
mxGraphSelectionModel.prototype.removeCells=function(a){if(null!=a){for(var b=[],c=0;c<a.length;c++)this.isSelected(a[c])&&b.push(a[c]);this.changeSelection(null,b)}};mxGraphSelectionModel.prototype.changeSelection=function(a,b){if(null!=a&&0<a.length&&null!=a[0]||null!=b&&0<b.length&&null!=b[0]){var c=new mxSelectionChange(this,a,b);c.execute();var d=new mxUndoableEdit(this,!1);d.add(c);this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",d))}};
mxGraphSelectionModel.prototype.cellAdded=function(a){null!=a&&!this.isSelected(a)&&this.cells.push(a)};mxGraphSelectionModel.prototype.cellRemoved=function(a){null!=a&&(a=mxUtils.indexOf(this.cells,a),0<=a&&this.cells.splice(a,1))};function mxSelectionChange(a,b,c){this.selectionModel=a;this.added=null!=b?b.slice():null;this.removed=null!=c?c.slice():null}
mxSelectionChange.prototype.execute=function(){var a=mxLog.enter("mxSelectionChange.execute");window.status=mxResources.get(this.selectionModel.updatingSelectionResource)||this.selectionModel.updatingSelectionResource;if(null!=this.removed)for(var b=0;b<this.removed.length;b++)this.selectionModel.cellRemoved(this.removed[b]);if(null!=this.added)for(b=0;b<this.added.length;b++)this.selectionModel.cellAdded(this.added[b]);b=this.added;this.added=this.removed;this.removed=b;window.status=mxResources.get(this.selectionModel.doneResource)||
this.selectionModel.doneResource;mxLog.leave("mxSelectionChange.execute",a);this.selectionModel.fireEvent(new mxEventObject(mxEvent.CHANGE,"added",this.added,"removed",this.removed))};function mxCellEditor(a){this.graph=a}mxCellEditor.prototype.graph=null;mxCellEditor.prototype.textarea=null;mxCellEditor.prototype.editingCell=null;mxCellEditor.prototype.trigger=null;mxCellEditor.prototype.modified=!1;mxCellEditor.prototype.autoSize=!0;mxCellEditor.prototype.selectText=!0;
mxCellEditor.prototype.emptyLabelText="";mxCellEditor.prototype.textNode="";mxCellEditor.prototype.zIndex=5;mxCellEditor.prototype.minResize=new mxRectangle(0,20);mxCellEditor.prototype.init=function(){this.textarea=document.createElement("textarea");this.textarea.className="mxCellEditor";this.textarea.style.position="absolute";this.textarea.style.overflow="visible";this.textarea.setAttribute("cols","20");this.textarea.setAttribute("rows","4");mxClient.IS_NS&&(this.textarea.style.resize="none");this.installListeners(this.textarea)};
mxCellEditor.prototype.installListeners=function(a){mxEvent.addListener(a,"blur",mxUtils.bind(this,function(a){this.focusLost(a)}));mxEvent.addListener(a,"change",mxUtils.bind(this,function(a){this.setModified(!0)}));mxEvent.addListener(a,"keydown",mxUtils.bind(this,function(b){mxEvent.isConsumed(b)||(this.isStopEditingEvent(b)?(this.graph.stopEditing(!1),mxEvent.consume(b)):27==b.keyCode?(this.graph.stopEditing(!0),mxEvent.consume(b)):(this.clearOnChange&&a.value==this.getEmptyLabelText()&&(this.clearOnChange=
!1,a.value=""),this.setModified(!0)))}));this.changeHandler=mxUtils.bind(this,function(a){null!=this.editingCell&&null==this.graph.getView().getState(this.editingCell)&&this.stopEditing(!0)});this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler);mxEvent.addListener(a,mxClient.IS_IE11||mxClient.IS_IE&&!(9<=document.documentMode)?"keypress":"input",mxUtils.bind(this,function(a){this.autoSize&&!mxEvent.isConsumed(a)&&setTimeout(mxUtils.bind(this,function(){this.resize()}),0)}))};
mxCellEditor.prototype.isStopEditingEvent=function(a){return 113==a.keyCode||this.graph.isEnterStopsCellEditing()&&13==a.keyCode&&!mxEvent.isControlDown(a)&&!mxEvent.isShiftDown(a)};mxCellEditor.prototype.isEventSource=function(a){return mxEvent.getSource(a)==this.textarea};
mxCellEditor.prototype.resize=function(){if(null!=this.textDiv){var a=this.graph.getView().getState(this.editingCell);if(null==a)this.stopEditing(!0);else{var b=this.graph.getModel().isEdge(a.cell);if(b||"fill"!=a.style[mxConstants.STYLE_OVERFLOW]){var c=this.graph.getView().scale,d=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_WIDTH,null),e=null!=a.text?a.text.margin:null;null==e&&(e=mxUtils.getAlignmentAsPoint(mxUtils.getValue(a.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),mxUtils.getValue(a.style,
mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)));if(b)this.bounds.x=a.absoluteOffset.x,this.bounds.y=a.absoluteOffset.y,this.bounds.width=0,this.bounds.height=0,null!=d&&(d=(parseFloat(d)+2)*c,this.bounds.width=d,this.bounds.x+=e.x*d);else if(null!=this.bounds){var f=mxRectangle.fromRectangle(a),g=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),k=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),f=null!=a.shape&&
g==mxConstants.ALIGN_CENTER&&k==mxConstants.ALIGN_MIDDLE?a.shape.getLabelBounds(f):f;null!=d&&(f.width=parseFloat(d)*c);if(!a.view.graph.cellRenderer.legacySpacing||"width"!=a.style[mxConstants.STYLE_OVERFLOW])var g=parseInt(a.style[mxConstants.STYLE_SPACING]||2)*c,l=(parseInt(a.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*c+g,m=(parseInt(a.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*c+g,n=(parseInt(a.style[mxConstants.STYLE_SPACING_BOTTOM]||
0)+mxText.prototype.baseSpacingBottom)*c+g,p=(parseInt(a.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*c+g,g=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),k=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),f=new mxRectangle(f.x+p,f.y+l,f.width-(g==mxConstants.ALIGN_CENTER&&null==d?p+m:0),f.height-(k==mxConstants.ALIGN_MIDDLE?l+n:0));this.bounds.x=f.x+a.absoluteOffset.x-1;this.bounds.y=f.y+
a.absoluteOffset.y;this.bounds.width=f.width+2;this.bounds.height=f.height}if(d=this.graph.isWrapping(a.cell)&&(2<=this.bounds.width||2<=this.bounds.height))this.textDiv.style.whiteSpace="normal",mxClient.IS_QUIRKS?this.textDiv.style.width=Math.ceil(this.bounds.width)+"px":this.textDiv.style.maxWidth=Math.ceil(this.bounds.width)+"px";f=this.getCurrentHtmlValue();this.textDiv.innerHTML=0<f.length?f:"&nbsp;";a=mxUtils.getValue(a.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)*c;c=this.textDiv.offsetWidth+
a;f=this.textDiv.offsetHeight+16;null!=this.minResize&&(c=Math.max(c,this.minResize.width),f=Math.max(f,this.minResize.height));d&&(c=Math.min(this.bounds.width,c));this.textarea.style.left=Math.max(0,Math.ceil(this.bounds.x-e.x*(this.bounds.width-c-3)))+"px";this.textarea.style.top=b?Math.max(0,Math.round(this.bounds.y-e.y*this.bounds.height+e.y*f-4*e.y)+6)+"px":Math.max(0,Math.floor(this.bounds.y-e.y*(this.bounds.height-f+0.1*a+8)))+"px";this.textarea.style.width=Math.ceil(c+this.textarea.offsetWidth-
this.textarea.clientWidth)+"px";this.textarea.style.height=Math.ceil(f)+"px"}}}};mxCellEditor.prototype.isModified=function(){return this.modified};mxCellEditor.prototype.setModified=function(a){this.modified=a};mxCellEditor.prototype.focusLost=function(){this.stopEditing(!this.graph.isInvokesStopCellEditing())};
mxCellEditor.prototype.startEditing=function(a,b){null==this.textarea&&this.init();this.stopEditing(!0);var c=this.graph.getView().getState(a);if(null!=c){this.editingCell=a;this.trigger=b;this.textNode=null;null!=c.text&&this.isHideLabel(c)&&(this.textNode=c.text.node,this.textNode.style.visibility="hidden");var d=this.graph.getView().scale,d=mxUtils.getValue(c.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)*d,e=mxUtils.getValue(c.style,mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY),
f=mxUtils.getValue(c.style,mxConstants.STYLE_FONTCOLOR,"black"),g=mxUtils.getValue(c.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT),k=(mxUtils.getValue(c.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD,l=(mxUtils.getValue(c.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC,m=(mxUtils.getValue(c.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE;this.textarea.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?
Math.round(d*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;this.textarea.style.textDecoration=m?"underline":"";this.textarea.style.fontWeight=k?"bold":"normal";this.textarea.style.fontStyle=l?"italic":"";this.textarea.style.fontSize=Math.round(d)+"px";this.textarea.style.fontFamily=e;this.textarea.style.textAlign=g;this.textarea.style.overflow="auto";this.textarea.style.outline="none";this.textarea.style.color=f;this.textarea.style.lineHeight=mxConstants.ABSOLUTE_LINE_HEIGHT?Math.round(d*
mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;d=this.textDirection=mxUtils.getValue(c.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION);d==mxConstants.TEXT_DIRECTION_AUTO&&null!=c&&null!=c.text&&c.text.dialect!=mxConstants.DIALECT_STRICTHTML&&!mxUtils.isNode(c.text.value)&&(d=c.text.getAutoDirection());d==mxConstants.TEXT_DIRECTION_LTR||d==mxConstants.TEXT_DIRECTION_RTL?this.textarea.setAttribute("dir",d):this.textarea.removeAttribute("dir");this.bounds=d=this.getEditorBounds(c);
this.textarea.style.left=d.x+"px";this.textarea.style.top=d.y+"px";this.textarea.style.width=d.width+"px";this.textarea.style.height=d.height+"px";this.textarea.style.zIndex=this.zIndex;c=this.getInitialValue(c,b);null==c||0==c.length?(c=this.getEmptyLabelText(),this.clearOnChange=0<c.length):this.clearOnChange=!1;this.setModified(!1);this.textarea.value=c;this.graph.container.appendChild(this.textarea);"none"!=this.textarea.style.display&&(this.autoSize&&(this.textDiv=this.createTextDiv(),document.body.appendChild(this.textDiv),
this.resize()),this.textarea.focus(),this.isSelectText()&&0<this.textarea.value.length&&(mxClient.IS_IOS?document.execCommand("selectAll"):this.textarea.select()))}};mxCellEditor.prototype.isSelectText=function(){return this.selectText};
mxCellEditor.prototype.createTextDiv=function(){var a=document.createElement("div"),b=a.style;b.position="absolute";b.whiteSpace="nowrap";b.visibility="hidden";b.padding="0px";b.margin="0px";b.display=mxClient.IS_QUIRKS?"inline":"inline-block";b.zoom="1";b.verticalAlign="top";b.lineHeight=this.textarea.style.lineHeight;b.fontSize=this.textarea.style.fontSize;b.fontFamily=this.textarea.style.fontFamily;b.fontWeight=this.textarea.style.fontWeight;b.textAlign=this.textarea.style.textAlign;b.fontStyle=
this.textarea.style.fontStyle;b.textDecoration=this.textarea.style.textDecoration;return a};mxCellEditor.prototype.stopEditing=function(a){null!=this.editingCell&&(null!=this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null),a||this.applyValue(),null!=this.textDiv&&(document.body.removeChild(this.textDiv),this.textDiv=null),this.bounds=this.trigger=this.editingCell=null,this.textarea.blur(),null!=this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea))};
mxCellEditor.prototype.applyValue=function(){this.isModified()&&this.graph.labelChanged(this.editingCell,this.getCurrentValue(),this.trigger)};mxCellEditor.prototype.getInitialValue=function(a,b){return this.graph.getEditingValue(a.cell,b)};mxCellEditor.prototype.getCurrentValue=function(){return this.textarea.value.replace(/\r/g,"")};
mxCellEditor.prototype.getCurrentHtmlValue=function(){var a=this.getCurrentValue();if("\n"==a.charAt(a.length-1)||""==a)a+="&nbsp;";return mxUtils.htmlEntities(a,!1).replace(/\n/g,"<br/>")};mxCellEditor.prototype.isHideLabel=function(a){return!0};mxCellEditor.prototype.getMinimumSize=function(a){var b=this.graph.getView().scale;return new mxRectangle(0,0,null==a.text?30:a.text.size*b+20,"left"==this.textarea.style.textAlign?120:40)};
mxCellEditor.prototype.getEditorBounds=function(a){var b=this.graph.getModel().isEdge(a.cell),c=this.graph.getView().scale,d=this.getMinimumSize(a),e=d.width,d=d.height,f=null;if(!b&&a.view.graph.cellRenderer.legacySpacing&&"fill"==a.style[mxConstants.STYLE_OVERFLOW])f=a.shape.getLabelBounds(mxRectangle.fromRectangle(a));else{var g=parseInt(a.style[mxConstants.STYLE_SPACING]||0)*c,k=(parseInt(a.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*c+g,f=(parseInt(a.style[mxConstants.STYLE_SPACING_RIGHT]||
0)+mxText.prototype.baseSpacingRight)*c+g,l=(parseInt(a.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*c+g,c=(parseInt(a.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*c+g,f=new mxRectangle(a.x,a.y,Math.max(e,a.width-c-f),Math.max(d,a.height-k-l)),l=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),g=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),f=null!=a.shape&&
l==mxConstants.ALIGN_CENTER&&g==mxConstants.ALIGN_MIDDLE?a.shape.getLabelBounds(f):f;b?(f.x=a.absoluteOffset.x,f.y=a.absoluteOffset.y,null!=a.text&&null!=a.text.boundingBox&&(0<a.text.boundingBox.x&&(f.x=a.text.boundingBox.x),0<a.text.boundingBox.y&&(f.y=a.text.boundingBox.y))):null!=a.text&&null!=a.text.boundingBox&&(f.x=Math.min(f.x,a.text.boundingBox.x),f.y=Math.min(f.y,a.text.boundingBox.y));f.x+=c;f.y+=k;null!=a.text&&null!=a.text.boundingBox&&(b?(f.width=Math.max(e,a.text.boundingBox.width),
f.height=Math.max(d,a.text.boundingBox.height)):(f.width=Math.max(f.width,a.text.boundingBox.width),f.height=Math.max(f.height,a.text.boundingBox.height)));this.graph.getModel().isVertex(a.cell)&&(b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),b==mxConstants.ALIGN_LEFT?f.x-=a.width:b==mxConstants.ALIGN_RIGHT&&(f.x+=a.width),b=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),b==mxConstants.ALIGN_TOP?f.y-=a.height:b==
mxConstants.ALIGN_BOTTOM&&(f.y+=a.height))}return new mxRectangle(Math.round(f.x),Math.round(f.y),Math.round(f.width),Math.round(f.height))};mxCellEditor.prototype.getEmptyLabelText=function(a){return this.emptyLabelText};mxCellEditor.prototype.getEditingCell=function(){return this.editingCell};
mxCellEditor.prototype.destroy=function(){null!=this.textarea&&(mxEvent.release(this.textarea),null!=this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null,null!=this.changeHandler&&(this.graph.getModel().removeListener(this.changeHandler),this.changeHandler=null))};function mxCellRenderer(){}mxCellRenderer.prototype.defaultEdgeShape=mxConnector;mxCellRenderer.prototype.defaultVertexShape=mxRectangleShape;mxCellRenderer.prototype.defaultTextShape=mxText;
mxCellRenderer.prototype.legacyControlPosition=!0;mxCellRenderer.prototype.legacySpacing=!0;mxCellRenderer.prototype.defaultShapes={};mxCellRenderer.prototype.antiAlias=!0;mxCellRenderer.registerShape=function(a,b){mxCellRenderer.prototype.defaultShapes[a]=b};mxCellRenderer.registerShape(mxConstants.SHAPE_RECTANGLE,mxRectangleShape);mxCellRenderer.registerShape(mxConstants.SHAPE_ELLIPSE,mxEllipse);mxCellRenderer.registerShape(mxConstants.SHAPE_RHOMBUS,mxRhombus);
mxCellRenderer.registerShape(mxConstants.SHAPE_CYLINDER,mxCylinder);mxCellRenderer.registerShape(mxConstants.SHAPE_CONNECTOR,mxConnector);mxCellRenderer.registerShape(mxConstants.SHAPE_ACTOR,mxActor);mxCellRenderer.registerShape(mxConstants.SHAPE_TRIANGLE,mxTriangle);mxCellRenderer.registerShape(mxConstants.SHAPE_HEXAGON,mxHexagon);mxCellRenderer.registerShape(mxConstants.SHAPE_CLOUD,mxCloud);mxCellRenderer.registerShape(mxConstants.SHAPE_LINE,mxLine);
mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW,mxArrow);mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW_CONNECTOR,mxArrowConnector);mxCellRenderer.registerShape(mxConstants.SHAPE_DOUBLE_ELLIPSE,mxDoubleEllipse);mxCellRenderer.registerShape(mxConstants.SHAPE_SWIMLANE,mxSwimlane);mxCellRenderer.registerShape(mxConstants.SHAPE_IMAGE,mxImageShape);mxCellRenderer.registerShape(mxConstants.SHAPE_LABEL,mxLabel);
mxCellRenderer.prototype.initializeShape=function(a){a.shape.dialect=a.view.graph.dialect;this.configureShape(a);a.shape.init(a.view.getDrawPane())};mxCellRenderer.prototype.createShape=function(a){var b=null;null!=a.style&&(b=mxStencilRegistry.getStencil(a.style[mxConstants.STYLE_SHAPE]),b=null!=b?new mxShape(b):new (this.getShapeConstructor(a)));return b};mxCellRenderer.prototype.createIndicatorShape=function(a){a.shape.indicatorShape=this.getShape(a.view.graph.getIndicatorShape(a))};
mxCellRenderer.prototype.getShape=function(a){return null!=a?mxCellRenderer.prototype.defaultShapes[a]:null};mxCellRenderer.prototype.getShapeConstructor=function(a){var b=this.getShape(a.style[mxConstants.STYLE_SHAPE]);null==b&&(b=a.view.graph.getModel().isEdge(a.cell)?this.defaultEdgeShape:this.defaultVertexShape);return b};
mxCellRenderer.prototype.configureShape=function(a){a.shape.apply(a);a.shape.image=a.view.graph.getImage(a);a.shape.indicatorColor=a.view.graph.getIndicatorColor(a);a.shape.indicatorStrokeColor=a.style[mxConstants.STYLE_INDICATOR_STROKECOLOR];a.shape.indicatorGradientColor=a.view.graph.getIndicatorGradientColor(a);a.shape.indicatorDirection=a.style[mxConstants.STYLE_INDICATOR_DIRECTION];a.shape.indicatorImage=a.view.graph.getIndicatorImage(a);this.postConfigureShape(a)};
mxCellRenderer.prototype.postConfigureShape=function(a){null!=a.shape&&(this.resolveColor(a,"indicatorColor",mxConstants.STYLE_FILLCOLOR),this.resolveColor(a,"indicatorGradientColor",mxConstants.STYLE_GRADIENTCOLOR),this.resolveColor(a,"fill",mxConstants.STYLE_FILLCOLOR),this.resolveColor(a,"stroke",mxConstants.STYLE_STROKECOLOR),this.resolveColor(a,"gradient",mxConstants.STYLE_GRADIENTCOLOR))};
mxCellRenderer.prototype.resolveColor=function(a,b,c){var d=a.shape[b],e=a.view.graph,f=null;"inherit"==d?f=e.model.getParent(a.cell):"swimlane"==d?(f=null!=e.model.getTerminal(a.cell,!1)?e.model.getTerminal(a.cell,!1):a.cell,f=e.getSwimlane(f),c=e.swimlaneIndicatorColorAttribute):"indicated"==d&&(a.shape[b]=a.shape.indicatorColor);null!=f&&(d=e.getView().getState(f),a.shape[b]=null,null!=d&&(a.shape[b]=null!=d.shape&&"indicatorColor"!=b?d.shape[b]:d.style[c]))};
mxCellRenderer.prototype.getLabelValue=function(a){return a.view.graph.getLabel(a.cell)};
mxCellRenderer.prototype.createLabel=function(a,b){var c=a.view.graph;c.getModel().isEdge(a.cell);if(0<a.style[mxConstants.STYLE_FONTSIZE]||null==a.style[mxConstants.STYLE_FONTSIZE]){var d=c.isHtmlLabel(a.cell)||null!=b&&mxUtils.isNode(b);a.text=new this.defaultTextShape(b,new mxRectangle,a.style[mxConstants.STYLE_ALIGN]||mxConstants.ALIGN_CENTER,c.getVerticalAlign(a),a.style[mxConstants.STYLE_FONTCOLOR],a.style[mxConstants.STYLE_FONTFAMILY],a.style[mxConstants.STYLE_FONTSIZE],a.style[mxConstants.STYLE_FONTSTYLE],
a.style[mxConstants.STYLE_SPACING],a.style[mxConstants.STYLE_SPACING_TOP],a.style[mxConstants.STYLE_SPACING_RIGHT],a.style[mxConstants.STYLE_SPACING_BOTTOM],a.style[mxConstants.STYLE_SPACING_LEFT],a.style[mxConstants.STYLE_HORIZONTAL],a.style[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR],a.style[mxConstants.STYLE_LABEL_BORDERCOLOR],c.isWrapping(a.cell)&&c.isHtmlLabel(a.cell),c.isLabelClipped(a.cell),a.style[mxConstants.STYLE_OVERFLOW],a.style[mxConstants.STYLE_LABEL_PADDING],mxUtils.getValue(a.style,mxConstants.STYLE_TEXT_DIRECTION,
mxConstants.DEFAULT_TEXT_DIRECTION));a.text.opacity=mxUtils.getValue(a.style,mxConstants.STYLE_TEXT_OPACITY,100);a.text.dialect=d?mxConstants.DIALECT_STRICTHTML:a.view.graph.dialect;a.text.style=a.style;a.text.state=a;this.initializeLabel(a,a.text);var e=!1,f=function(b){var d=a;if(mxClient.IS_TOUCH||e)d=mxEvent.getClientX(b),b=mxEvent.getClientY(b),b=mxUtils.convertPoint(c.container,d,b),d=c.view.getState(c.getCellAt(b.x,b.y));return d};mxEvent.addGestureListeners(a.text.node,mxUtils.bind(this,function(b){this.isLabelEvent(a,
b)&&(c.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b,a)),e=c.dialect!=mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(b).nodeName)}),mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&c.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,f(b)))}),mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&(c.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b,f(b))),e=!1)}));c.nativeDblClickEnabled&&mxEvent.addListener(a.text.node,"dblclick",mxUtils.bind(this,function(b){this.isLabelEvent(a,
b)&&(c.dblClick(b,a.cell),mxEvent.consume(b))}))}};mxCellRenderer.prototype.initializeLabel=function(a,b){mxClient.IS_SVG&&mxClient.NO_FO&&b.dialect!=mxConstants.DIALECT_SVG?b.init(a.view.graph.container):b.init(a.view.getDrawPane())};
mxCellRenderer.prototype.createCellOverlays=function(a){var b=a.view.graph.getCellOverlays(a.cell),c=null;if(null!=b)for(var c=new mxDictionary,d=0;d<b.length;d++){var e=null!=a.overlays?a.overlays.remove(b[d]):null;null==e&&(e=new mxImageShape(new mxRectangle,b[d].image.src),e.dialect=a.view.graph.dialect,e.preserveImageAspect=!1,e.overlay=b[d],this.initializeOverlay(a,e),this.installCellOverlayListeners(a,b[d],e),null!=b[d].cursor&&(e.node.style.cursor=b[d].cursor));c.put(b[d],e)}null!=a.overlays&&
a.overlays.visit(function(a,b){b.destroy()});a.overlays=c};mxCellRenderer.prototype.initializeOverlay=function(a,b){b.init(a.view.getOverlayPane())};
mxCellRenderer.prototype.installCellOverlayListeners=function(a,b,c){var d=a.view.graph;mxEvent.addListener(c.node,"click",function(c){d.isEditing()&&d.stopEditing(!d.isInvokesStopCellEditing());b.fireEvent(new mxEventObject(mxEvent.CLICK,"event",c,"cell",a.cell))});mxEvent.addGestureListeners(c.node,function(a){mxEvent.consume(a)},function(b){d.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,a))});mxClient.IS_TOUCH&&mxEvent.addListener(c.node,"touchend",function(c){b.fireEvent(new mxEventObject(mxEvent.CLICK,
"event",c,"cell",a.cell))})};mxCellRenderer.prototype.createControl=function(a){var b=a.view.graph,c=b.getFoldingImage(a);if(b.foldingEnabled&&null!=c){if(null==a.control){var d=new mxRectangle(0,0,c.width,c.height);a.control=new mxImageShape(d,c.src);a.control.preserveImageAspect=!1;a.control.dialect=b.dialect;this.initControl(a,a.control,!0,this.createControlClickHandler(a))}}else null!=a.control&&(a.control.destroy(),a.control=null)};
mxCellRenderer.prototype.createControlClickHandler=function(a){var b=a.view.graph;return function(c){if(b.isEnabled()){var d=!b.isCellCollapsed(a.cell);b.foldCells(d,!1,[a.cell],null,c);mxEvent.consume(c)}}};
mxCellRenderer.prototype.initControl=function(a,b,c,d){var e=a.view.graph;e.isHtmlLabel(a.cell)&&mxClient.NO_FO&&e.dialect==mxConstants.DIALECT_SVG?(b.dialect=mxConstants.DIALECT_PREFERHTML,b.init(e.container),b.node.style.zIndex=1):b.init(a.view.getOverlayPane());b=b.innerNode||b.node;d&&(e.isEnabled()&&(b.style.cursor="pointer"),mxEvent.addListener(b,"click",d));c&&mxEvent.addGestureListeners(b,function(b){e.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b,a));mxEvent.consume(b)},function(b){e.fireMouseEvent(mxEvent.MOUSE_MOVE,
new mxMouseEvent(b,a))});return b};mxCellRenderer.prototype.isShapeEvent=function(a,b){return!0};mxCellRenderer.prototype.isLabelEvent=function(a,b){return!0};
mxCellRenderer.prototype.installListeners=function(a){var b=a.view.graph,c=function(c){var e=a;if(b.dialect!=mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(c).nodeName||mxClient.IS_TOUCH)e=mxEvent.getClientX(c),c=mxEvent.getClientY(c),c=mxUtils.convertPoint(b.container,e,c),e=b.view.getState(b.getCellAt(c.x,c.y));return e};mxEvent.addGestureListeners(a.shape.node,mxUtils.bind(this,function(c){this.isShapeEvent(a,c)&&b.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(c,a))}),mxUtils.bind(this,
function(d){this.isShapeEvent(a,d)&&b.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(d,c(d)))}),mxUtils.bind(this,function(d){this.isShapeEvent(a,d)&&b.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(d,c(d)))}));b.nativeDblClickEnabled&&mxEvent.addListener(a.shape.node,"dblclick",mxUtils.bind(this,function(c){this.isShapeEvent(a,c)&&(b.dblClick(c,a.cell),mxEvent.consume(c))}))};
mxCellRenderer.prototype.redrawLabel=function(a,b){var c=this.getLabelValue(a);null==a.text&&null!=c&&(mxUtils.isNode(c)||0<c.length)?this.createLabel(a,c):null==a.text||null!=c&&0!=c.length||(a.text.destroy(),a.text=null);if(null!=a.text){var d=a.view.graph,e=d.isWrapping(a.cell),d=d.isLabelClipped(a.cell),f=this.getLabelBounds(a),g=a.view.graph.isHtmlLabel(a.cell)||null!=c&&mxUtils.isNode(c)?mxConstants.DIALECT_STRICTHTML:a.view.graph.dialect;if(b||a.text.value!=c||a.text.isWrapping!=e||a.text.isClipping!=
d||a.text.scale!=a.view.scale||a.text.dialect!=g||!a.text.bounds.equals(f))a.text.dialect=g,a.text.value=c,a.text.bounds=f,a.text.scale=this.getTextScale(a),a.text.isWrapping=e,a.text.isClipping=d,a.text.redraw()}};mxCellRenderer.prototype.getTextScale=function(a){return a.view.scale};
mxCellRenderer.prototype.getLabelBounds=function(a){var b=a.view.graph,c=a.view.scale,d=b.getModel().isEdge(a.cell),e=new mxRectangle(a.absoluteOffset.x,a.absoluteOffset.y);if(d){var f=a.text.getSpacing();e.x+=f.x*c;e.y+=f.y*c;b=b.getCellGeometry(a.cell);null!=b&&(e.width=Math.max(0,b.width*c),e.height=Math.max(0,b.height*c))}else a.text.isPaintBoundsInverted()&&(b=e.x,e.x=e.y,e.y=b),e.x+=a.x,e.y+=a.y,e.width=Math.max(1,a.width),e.height=Math.max(1,a.height),b=mxUtils.getValue(a.style,mxConstants.STYLE_STROKECOLOR,
mxConstants.NONE),b!=mxConstants.NONE&&""!=b&&(b=parseFloat(mxUtils.getValue(a.style,mxConstants.STYLE_STROKEWIDTH,1))*c/2,f=2*b+0.5,e.x+=b,e.y+=b,e.width-=f,e.height-=f);a.text.isPaintBoundsInverted()&&(b=(a.width-a.height)/2,e.x+=b,e.y-=b,b=e.width,e.width=e.height,e.height=b);null!=a.shape&&(b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),f=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),b==mxConstants.ALIGN_CENTER&&
f==mxConstants.ALIGN_MIDDLE&&(e=a.shape.getLabelBounds(e)));b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_WIDTH,null);null!=b&&(e.width=parseFloat(b)*c);d||this.rotateLabelBounds(a,e);return e};
mxCellRenderer.prototype.rotateLabelBounds=function(a,b){b.x-=a.text.margin.x*b.width;b.y-=a.text.margin.y*b.height;if(!this.legacySpacing||"fill"!=a.style[mxConstants.STYLE_OVERFLOW]&&"width"!=a.style[mxConstants.STYLE_OVERFLOW]){var c=a.view.scale,d=a.text.getSpacing();b.x+=d.x*c;b.y+=d.y*c;var d=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),e=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),f=mxUtils.getValue(a.style,
mxConstants.STYLE_LABEL_WIDTH,null);b.width=Math.max(0,b.width-(d==mxConstants.ALIGN_CENTER&&null==f?a.text.spacingLeft*c+a.text.spacingRight*c:0));b.height=Math.max(0,b.height-(e==mxConstants.ALIGN_MIDDLE?a.text.spacingTop*c+a.text.spacingBottom*c:0))}e=a.text.getTextRotation();0!=e&&null!=a&&a.view.graph.model.isVertex(a.cell)&&(c=a.getCenterX(),d=a.getCenterY(),b.x!=c||b.y!=d)&&(e*=Math.PI/180,pt=mxUtils.getRotatedPoint(new mxPoint(b.x,b.y),Math.cos(e),Math.sin(e),new mxPoint(c,d)),b.x=pt.x,b.y=
pt.y)};
mxCellRenderer.prototype.redrawCellOverlays=function(a,b){this.createCellOverlays(a);if(null!=a.overlays){var c=mxUtils.mod(mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0),90),d=mxUtils.toRadians(c),e=Math.cos(d),f=Math.sin(d);a.overlays.visit(function(d,k){var l=k.overlay.getBounds(a);if(!a.view.graph.getModel().isEdge(a.cell)&&null!=a.shape&&0!=c){var m=l.getCenterX(),n=l.getCenterY(),n=mxUtils.getRotatedPoint(new mxPoint(m,n),e,f,new mxPoint(a.getCenterX(),a.getCenterY())),m=n.x,n=n.y;l.x=
Math.round(m-l.width/2);l.y=Math.round(n-l.height/2)}if(b||null==k.bounds||k.scale!=a.view.scale||!k.bounds.equals(l))k.bounds=l,k.scale=a.view.scale,k.redraw()})}};
mxCellRenderer.prototype.redrawControl=function(a,b){var c=a.view.graph.getFoldingImage(a);if(null!=a.control&&null!=c){var c=this.getControlBounds(a,c.width,c.height),d=this.legacyControlPosition?mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0):a.shape.getTextRotation(),e=a.view.scale;if(b||a.control.scale!=e||!a.control.bounds.equals(c)||a.control.rotation!=d)a.control.rotation=d,a.control.bounds=c,a.control.scale=e,a.control.redraw()}};
mxCellRenderer.prototype.getControlBounds=function(a,b,c){if(null!=a.control){var d=a.view.scale,e=a.getCenterX(),f=a.getCenterY();if(!a.view.graph.getModel().isEdge(a.cell)&&(e=a.x+b*d,f=a.y+c*d,null!=a.shape)){var g=a.shape.getShapeRotation();if(this.legacyControlPosition)g=mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0);else if(a.shape.isPaintBoundsInverted())var k=(a.width-a.height)/2,e=e+k,f=f-k;0!=g&&(k=mxUtils.toRadians(g),g=Math.cos(k),k=Math.sin(k),f=mxUtils.getRotatedPoint(new mxPoint(e,
f),g,k,new mxPoint(a.getCenterX(),a.getCenterY())),e=f.x,f=f.y)}return a.view.graph.getModel().isEdge(a.cell),new mxRectangle(Math.round(e-b/2*d),Math.round(f-c/2*d),Math.round(b*d),Math.round(c*d))}return null};
mxCellRenderer.prototype.insertStateAfter=function(a,b,c){for(var d=this.getShapesForState(a),e=0;e<d.length;e++)if(null!=d[e]){var f=d[e].node.parentNode!=a.view.getDrawPane(),g=f?c:b;if(null!=g&&g.nextSibling!=d[e].node)null==g.nextSibling?g.parentNode.appendChild(d[e].node):g.parentNode.insertBefore(d[e].node,g.nextSibling);else if(null==g)if(d[e].node.parentNode==a.view.graph.container){for(g=a.view.canvas;null!=g&&g.parentNode!=a.view.graph.container;)g=g.parentNode;null!=g&&null!=g.nextSibling&&
g.nextSibling!=d[e].node?d[e].node.parentNode.insertBefore(d[e].node,g.nextSibling):d[e].node.parentNode.appendChild(d[e].node)}else null!=d[e].node.parentNode.firstChild&&d[e].node.parentNode.firstChild!=d[e].node&&d[e].node.parentNode.insertBefore(d[e].node,d[e].node.parentNode.firstChild);f?c=d[e].node:b=d[e].node}return[b,c]};mxCellRenderer.prototype.getShapesForState=function(a){return[a.shape,a.text]};
mxCellRenderer.prototype.redraw=function(a,b,c){b=this.redrawShape(a,b,c);null==a.shape||null!=c&&!c||(this.redrawLabel(a,b),this.redrawCellOverlays(a,b),this.redrawControl(a,b))};
mxCellRenderer.prototype.redrawShape=function(a,b,c){var d=!1;null!=a.shape&&(null==a.shape.node&&(this.createIndicatorShape(a),this.initializeShape(a),this.createCellOverlays(a),this.installListeners(a)),this.createControl(a),mxUtils.equalEntries(a.shape.style,a.style)||(this.configureShape(a),b=!0),b||null==a.shape.bounds||a.shape.scale!=a.view.scale||null==a.absolutePoints&&!a.shape.bounds.equals(a)||null!=a.absolutePoints&&!mxUtils.equalPoints(a.shape.points,a.absolutePoints))&&(null!=a.absolutePoints?
(a.shape.points=a.absolutePoints.slice(),a.shape.bounds=null):(a.shape.points=null,a.shape.bounds=new mxRectangle(a.x,a.y,a.width,a.height)),a.shape.scale=a.view.scale,null==c||c?a.shape.redraw():a.shape.updateBoundingBox(),d=!0);return d};
mxCellRenderer.prototype.destroy=function(a){null!=a.shape&&(null!=a.text&&(a.text.destroy(),a.text=null),null!=a.overlays&&(a.overlays.visit(function(a,c){c.destroy()}),a.overlays=null),null!=a.control&&(a.control.destroy(),a.control=null),a.shape.destroy(),a.shape=null)};
var mxEdgeStyle={EntityRelation:function(a,b,c,d,e){var f=a.view,g=f.graph;d=mxUtils.getValue(a.style,mxConstants.STYLE_SEGMENT,mxConstants.ENTITY_SEGMENT)*f.scale;var k=a.absolutePoints,l=k[0],m=k[k.length-1],k=!1;if(null!=l)b=new mxCellState,b.x=l.x,b.y=l.y;else if(null!=b){var n=mxUtils.getPortConstraints(b,a,!0,mxConstants.DIRECTION_MASK_NONE);n!=mxConstants.DIRECTION_MASK_NONE?k=n==mxConstants.DIRECTION_MASK_WEST:(l=g.getCellGeometry(b.cell),l.relative?k=0.5>=l.x:null!=c&&(k=c.x+c.width<b.x))}else return;
l=!0;null!=m?(c=new mxCellState,c.x=m.x,c.y=m.y):null!=c&&(n=mxUtils.getPortConstraints(c,a,!1,mxConstants.DIRECTION_MASK_NONE),n!=mxConstants.DIRECTION_MASK_NONE?l=n==mxConstants.DIRECTION_MASK_WEST:(a=g.getCellGeometry(c.cell),a.relative?l=0.5>=a.x:null!=b&&(l=b.x+b.width<c.x)));null!=b&&null!=c&&(a=k?b.x:b.x+b.width,b=f.getRoutingCenterY(b),g=l?c.x:c.x+c.width,c=f.getRoutingCenterY(c),f=new mxPoint(a+(k?-d:d),b),m=new mxPoint(g+(l?-d:d),c),k==l?(d=k?Math.min(a,g)-d:Math.max(a,g)+d,e.push(new mxPoint(d,
b)),e.push(new mxPoint(d,c))):(f.x<m.x==k?(d=b+(c-b)/2,e.push(f),e.push(new mxPoint(f.x,d)),e.push(new mxPoint(m.x,d))):e.push(f),e.push(m)))},Loop:function(a,b,c,d,e){c=a.absolutePoints;var f=c[c.length-1];if(null!=c[0]&&null!=f){if(null!=d&&0<d.length)for(b=0;b<d.length;b++)c=d[b],c=a.view.transformControlPoint(a,c),e.push(new mxPoint(c.x,c.y))}else if(null!=b){var f=a.view,g=f.graph;c=null!=d&&0<d.length?d[0]:null;null!=c&&(c=f.transformControlPoint(a,c),mxUtils.contains(b,c.x,c.y)&&(c=null));
var k=d=0,l=0,m=0,g=mxUtils.getValue(a.style,mxConstants.STYLE_SEGMENT,g.gridSize)*f.scale;a=mxUtils.getValue(a.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_WEST);a==mxConstants.DIRECTION_NORTH||a==mxConstants.DIRECTION_SOUTH?(d=f.getRoutingCenterX(b),k=g):(l=f.getRoutingCenterY(b),m=g);null==c||c.x<b.x||c.x>b.x+b.width?null!=c?(d=c.x,m=Math.max(Math.abs(l-c.y),m)):a==mxConstants.DIRECTION_NORTH?l=b.y-2*k:a==mxConstants.DIRECTION_SOUTH?l=b.y+b.height+2*k:d=a==mxConstants.DIRECTION_EAST?
b.x-2*m:b.x+b.width+2*m:null!=c&&(d=f.getRoutingCenterX(b),k=Math.max(Math.abs(d-c.x),m),l=c.y,m=0);e.push(new mxPoint(d-k,l-m));e.push(new mxPoint(d+k,l+m))}},ElbowConnector:function(a,b,c,d,e){var f=null!=d&&0<d.length?d[0]:null,g=!1,k=!1;if(null!=b&&null!=c)if(null!=f)var l=Math.min(b.x,c.x),m=Math.max(b.x+b.width,c.x+c.width),k=Math.min(b.y,c.y),n=Math.max(b.y+b.height,c.y+c.height),f=a.view.transformControlPoint(a,f),g=f.y<k||f.y>n,k=f.x<l||f.x>m;else l=Math.max(b.x,c.x),m=Math.min(b.x+b.width,
c.x+c.width),(g=l==m)||(k=Math.max(b.y,c.y),n=Math.min(b.y+b.height,c.y+c.height),k=k==n);k||!g&&a.style[mxConstants.STYLE_ELBOW]!=mxConstants.ELBOW_VERTICAL?mxEdgeStyle.SideToSide(a,b,c,d,e):mxEdgeStyle.TopToBottom(a,b,c,d,e)},SideToSide:function(a,b,c,d,e){var f=a.view;d=null!=d&&0<d.length?d[0]:null;var g=a.absolutePoints,k=g[0],g=g[g.length-1];null!=d&&(d=f.transformControlPoint(a,d));null!=k&&(b=new mxCellState,b.x=k.x,b.y=k.y);null!=g&&(c=new mxCellState,c.x=g.x,c.y=g.y);null!=b&&null!=c&&(a=
Math.max(b.x,c.x),k=Math.min(b.x+b.width,c.x+c.width),a=null!=d?d.x:k+(a-k)/2,k=f.getRoutingCenterY(b),f=f.getRoutingCenterY(c),null!=d&&(d.y>=b.y&&d.y<=b.y+b.height&&(k=d.y),d.y>=c.y&&d.y<=c.y+c.height&&(f=d.y)),!mxUtils.contains(c,a,k)&&!mxUtils.contains(b,a,k)&&e.push(new mxPoint(a,k)),!mxUtils.contains(c,a,f)&&!mxUtils.contains(b,a,f)&&e.push(new mxPoint(a,f)),1==e.length&&(null!=d?!mxUtils.contains(c,a,d.y)&&!mxUtils.contains(b,a,d.y)&&e.push(new mxPoint(a,d.y)):(f=Math.max(b.y,c.y),b=Math.min(b.y+
b.height,c.y+c.height),e.push(new mxPoint(a,f+(b-f)/2)))))},TopToBottom:function(a,b,c,d,e){var f=a.view;d=null!=d&&0<d.length?d[0]:null;var g=a.absolutePoints,k=g[0],g=g[g.length-1];null!=d&&(d=f.transformControlPoint(a,d));null!=k&&(b=new mxCellState,b.x=k.x,b.y=k.y);null!=g&&(c=new mxCellState,c.x=g.x,c.y=g.y);null!=b&&null!=c&&(k=Math.max(b.y,c.y),g=Math.min(b.y+b.height,c.y+c.height),a=f.getRoutingCenterX(b),null!=d&&d.x>=b.x&&d.x<=b.x+b.width&&(a=d.x),k=null!=d?d.y:g+(k-g)/2,!mxUtils.contains(c,
a,k)&&!mxUtils.contains(b,a,k)&&e.push(new mxPoint(a,k)),a=null!=d&&d.x>=c.x&&d.x<=c.x+c.width?d.x:f.getRoutingCenterX(c),!mxUtils.contains(c,a,k)&&!mxUtils.contains(b,a,k)&&e.push(new mxPoint(a,k)),1==e.length&&(null!=d&&1==e.length?!mxUtils.contains(c,d.x,k)&&!mxUtils.contains(b,d.x,k)&&e.push(new mxPoint(d.x,k)):(f=Math.max(b.x,c.x),b=Math.min(b.x+b.width,c.x+c.width),e.push(new mxPoint(f+(b-f)/2,k)))))},SegmentConnector:function(a,b,c,d,e){function f(a){if(null==l||Math.abs(l.x-a.x)>k||Math.abs(l.y-
a.y)>k)e.push(a),l=a;return l}var g=a.absolutePoints,k=Math.max(1,2*a.view.scale),l=0<e.length?e[0]:null,m=!0,n=null,p=g[0];null==p&&null!=b?p=new mxPoint(a.view.getRoutingCenterX(b),a.view.getRoutingCenterY(b)):null!=p&&(p=p.clone());p.x=Math.round(p.x);p.y=Math.round(p.y);var q=g.length-1;if(null!=d&&0<d.length){for(var n=[],u=0;u<d.length;u++)n[u]=a.view.transformControlPoint(a,d[u]),n[u].x=Math.round(n[u].x),n[u].y=Math.round(n[u].y);d=n;null!=p&&null!=d[0]&&(Math.abs(d[0].x-p.x)<=k&&(d[0].x=
p.x),Math.abs(d[0].y-p.y)<=k&&(d[0].y=p.y));var v=g[q];null!=v&&null!=d[d.length-1]&&(Math.abs(d[d.length-1].x-v.x)<=k&&(d[d.length-1].x=v.x),Math.abs(d[d.length-1].y-v.y)<=k&&(d[d.length-1].y=v.y));var n=d[0],y=b,z=g[0],x=!1,B=!1,x=n;null!=z&&(z.x=Math.round(z.x),z.y=Math.round(z.y),y=null);for(u=0;2>u;u++){var A=null!=z&&z.x==x.x,D=null!=z&&z.y==x.y,E=null!=y&&x.y>=y.y&&x.y<=y.y+y.height,y=null!=y&&x.x>=y.x&&x.x<=y.x+y.width,x=D||null==z&&E,B=A||null==z&&y;if(0!=u||!(x&&B||A&&D)){if(null!=z&&!D&&
!A&&(E||y)){m=E?!1:!0;break}if(B||x){m=x;1==u&&(m=0==d.length%2?x:B);break}}y=c;z=g[q];null!=z&&(z.x=Math.round(z.x),z.y=Math.round(z.y),y=null);x=d[d.length-1];A&&D&&(d=d.slice(1))}m&&(null!=g[0]&&g[0].y!=n.y||null==g[0]&&null!=b&&(n.y<b.y||n.y>b.y+b.height))?f(new mxPoint(p.x,n.y)):!m&&(null!=g[0]&&g[0].x!=n.x||null==g[0]&&null!=b&&(n.x<b.x||n.x>b.x+b.width))&&f(new mxPoint(n.x,p.y));m?p.y=n.y:p.x=n.x;for(u=0;u<d.length;u++)m=!m,n=d[u],m?p.y=n.y:p.x=n.x,f(p.clone())}else n=p,m=!0;p=g[q];null==p&&
null!=c&&(p=new mxPoint(a.view.getRoutingCenterX(c),a.view.getRoutingCenterY(c)));null!=p&&(p.x=Math.round(p.x),p.y=Math.round(p.y),null!=n&&(m&&(null!=g[q]&&g[q].y!=n.y||null==g[q]&&null!=c&&(n.y<c.y||n.y>c.y+c.height))?f(new mxPoint(p.x,n.y)):!m&&(null!=g[q]&&g[q].x!=n.x||null==g[q]&&null!=c&&(n.x<c.x||n.x>c.x+c.width))&&f(new mxPoint(n.x,p.y))));if(null==g[0]&&null!=b)for(;1<e.length&&null!=e[1]&&mxUtils.contains(b,e[1].x,e[1].y);)e.splice(1,1);if(null==g[q]&&null!=c)for(;1<e.length&&null!=e[e.length-
1]&&mxUtils.contains(c,e[e.length-1].x,e[e.length-1].y);)e.splice(e.length-1,1);null!=v&&null!=e[e.length-1]&&Math.abs(v.x-e[e.length-1].x)<=k&&Math.abs(v.y-e[e.length-1].y)<=k&&(e.splice(e.length-1,1),null!=e[e.length-1]&&(Math.abs(e[e.length-1].x-v.x)<=k&&(e[e.length-1].x=v.x),Math.abs(e[e.length-1].y-v.y)<=k&&(e[e.length-1].y=v.y)))},orthBuffer:10,orthPointsFallback:!0,dirVectors:[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],wayPoints1:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,
0],[0,0],[0,0]],routePatterns:[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],inlineRoutePatterns:[[null,
[2114,2568],null,null],[null,[514,2081,2114,2568],null,null],[null,[2114,2561],null,null],[[2081,2562],[1057,2114,2568],[2184,2562],null]],vertexSeperations:[],limits:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],LEFT_MASK:32,TOP_MASK:64,RIGHT_MASK:128,BOTTOM_MASK:256,LEFT:1,TOP:2,RIGHT:4,BOTTOM:8,SIDE_MASK:480,CENTER_MASK:512,SOURCE_MASK:1024,TARGET_MASK:2048,VERTEX_MASK:3072,OrthConnector:function(a,b,c,d,e){var f=a.view.graph,g=null==b?!1:f.getModel().isEdge(b.cell),f=null==c?!1:f.getModel().isEdge(c.cell);
if(mxEdgeStyle.orthPointsFallback&&null!=d&&0<d.length||g||f)mxEdgeStyle.SegmentConnector(a,b,c,d,e);else{d=a.absolutePoints;var k=d[0],l=d[d.length-1];d=null!=b?b.x:k.x;var g=null!=b?b.y:k.y,m=null!=b?b.width:0,n=null!=b?b.height:0,p=null!=c?c.x:l.x,q=null!=c?c.y:l.y,u=null!=c?c.width:0,v=null!=c?c.height:0,f=a.view.scale*mxEdgeStyle.orthBuffer,y=[mxConstants.DIRECTION_MASK_ALL,mxConstants.DIRECTION_MASK_ALL],z=0;null!=b&&(y[0]=mxUtils.getPortConstraints(b,a,!0,mxConstants.DIRECTION_MASK_ALL),z=
mxUtils.getValue(b.style,mxConstants.STYLE_ROTATION,0),0!=z&&(z=mxUtils.getBoundingBox(new mxRectangle(d,g,m,n),z),d=z.x,g=z.y,m=z.width,n=z.height));null!=c&&(y[1]=mxUtils.getPortConstraints(c,a,!1,mxConstants.DIRECTION_MASK_ALL),z=mxUtils.getValue(c.style,mxConstants.STYLE_ROTATION,0),0!=z&&(z=mxUtils.getBoundingBox(new mxRectangle(p,q,u,v),z),p=z.x,q=z.y,u=z.width,v=z.height));a=[0,0];d=[[d,g,m,n],[p,q,u,v]];for(m=0;2>m;m++)mxEdgeStyle.limits[m][1]=d[m][0]-f,mxEdgeStyle.limits[m][2]=d[m][1]-f,
mxEdgeStyle.limits[m][4]=d[m][0]+d[m][2]+f,mxEdgeStyle.limits[m][8]=d[m][1]+d[m][3]+f;m=d[0][0]+d[0][2]/2-(d[1][0]+d[1][2]/2);n=d[0][1]+d[0][3]/2-(d[1][1]+d[1][3]/2);g=0;0>m?g=0>n?2:1:0>=n&&(g=3,0==m&&(g=2));n=null;null!=b&&(n=k);b=[[0.5,0.5],[0.5,0.5]];for(m=0;2>m;m++)null!=n&&(b[m][0]=(n.x-d[m][0])/d[m][2],0.01>b[m][0]?a[m]=mxConstants.DIRECTION_MASK_WEST:0.99<b[m][0]&&(a[m]=mxConstants.DIRECTION_MASK_EAST),b[m][1]=(n.y-d[m][1])/d[m][3],0.01>b[m][1]?a[m]=mxConstants.DIRECTION_MASK_NORTH:0.99<b[m][1]&&
(a[m]=mxConstants.DIRECTION_MASK_SOUTH)),n=null,null!=c&&(n=l);m=d[0][1]-(d[1][1]+d[1][3]);n=d[0][0]-(d[1][0]+d[1][2]);p=d[1][1]-(d[0][1]+d[0][3]);q=d[1][0]-(d[0][0]+d[0][2]);mxEdgeStyle.vertexSeperations[1]=Math.max(n-2*f,0);mxEdgeStyle.vertexSeperations[2]=Math.max(m-2*f,0);mxEdgeStyle.vertexSeperations[4]=Math.max(p-2*f,0);mxEdgeStyle.vertexSeperations[3]=Math.max(q-2*f,0);c=[];k=[];l=[];k[0]=n>=q?mxConstants.DIRECTION_MASK_WEST:mxConstants.DIRECTION_MASK_EAST;l[0]=m>=p?mxConstants.DIRECTION_MASK_NORTH:
mxConstants.DIRECTION_MASK_SOUTH;k[1]=mxUtils.reversePortConstraints(k[0]);l[1]=mxUtils.reversePortConstraints(l[0]);n=n>=q?n:q;p=m>=p?m:p;q=[[0,0],[0,0]];u=!1;for(m=0;2>m;m++)0==a[m]&&(0==(k[m]&y[m])&&(k[m]=mxUtils.reversePortConstraints(k[m])),0==(l[m]&y[m])&&(l[m]=mxUtils.reversePortConstraints(l[m])),q[m][0]=l[m],q[m][1]=k[m]);p>2*f&&n>2*f&&(0<(k[0]&y[0])&&0<(l[1]&y[1])?(q[0][0]=k[0],q[0][1]=l[0],q[1][0]=l[1],q[1][1]=k[1],u=!0):0<(l[0]&y[0])&&0<(k[1]&y[1])&&(q[0][0]=l[0],q[0][1]=k[0],q[1][0]=
k[1],q[1][1]=l[1],u=!0));p>2*f&&!u&&(q[0][0]=l[0],q[0][1]=k[0],q[1][0]=l[1],q[1][1]=k[1],u=!0);n>2*f&&!u&&(q[0][0]=k[0],q[0][1]=l[0],q[1][0]=k[1],q[1][1]=l[1]);for(m=0;2>m;m++)0==a[m]&&(0==(q[m][0]&y[m])&&(q[m][0]=q[m][1]),c[m]=q[m][0]&y[m],c[m]|=(q[m][1]&y[m])<<8,c[m]|=(q[1-m][m]&y[m])<<16,c[m]|=(q[1-m][1-m]&y[m])<<24,0==(c[m]&15)&&(c[m]<<=8),0==(c[m]&3840)&&(c[m]=c[m]&15|c[m]>>8),0==(c[m]&983040)&&(c[m]=c[m]&65535|(c[m]&251658240)>>8),a[m]=c[m]&15,y[m]==mxConstants.DIRECTION_MASK_WEST||y[m]==mxConstants.DIRECTION_MASK_NORTH||
y[m]==mxConstants.DIRECTION_MASK_EAST||y[m]==mxConstants.DIRECTION_MASK_SOUTH)&&(a[m]=y[m]);y=a[0]==mxConstants.DIRECTION_MASK_EAST?3:a[0];m=a[1]==mxConstants.DIRECTION_MASK_EAST?3:a[1];y-=g;m-=g;1>y&&(y+=4);1>m&&(m+=4);y=mxEdgeStyle.routePatterns[y-1][m-1];mxEdgeStyle.wayPoints1[0][0]=d[0][0];mxEdgeStyle.wayPoints1[0][1]=d[0][1];switch(a[0]){case mxConstants.DIRECTION_MASK_WEST:mxEdgeStyle.wayPoints1[0][0]-=f;mxEdgeStyle.wayPoints1[0][1]+=b[0][1]*d[0][3];break;case mxConstants.DIRECTION_MASK_SOUTH:mxEdgeStyle.wayPoints1[0][0]+=
b[0][0]*d[0][2];mxEdgeStyle.wayPoints1[0][1]+=d[0][3]+f;break;case mxConstants.DIRECTION_MASK_EAST:mxEdgeStyle.wayPoints1[0][0]+=d[0][2]+f;mxEdgeStyle.wayPoints1[0][1]+=b[0][1]*d[0][3];break;case mxConstants.DIRECTION_MASK_NORTH:mxEdgeStyle.wayPoints1[0][0]+=b[0][0]*d[0][2],mxEdgeStyle.wayPoints1[0][1]-=f}f=0;k=c=0<(a[0]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))?0:1;for(m=0;m<y.length;m++)l=y[m]&15,v=l==mxConstants.DIRECTION_MASK_EAST?3:l,v+=g,4<v&&(v-=4),n=mxEdgeStyle.dirVectors[v-
1],l=0<v%2?0:1,l!=c&&(f++,mxEdgeStyle.wayPoints1[f][0]=mxEdgeStyle.wayPoints1[f-1][0],mxEdgeStyle.wayPoints1[f][1]=mxEdgeStyle.wayPoints1[f-1][1]),z=0<(y[m]&mxEdgeStyle.TARGET_MASK),u=0<(y[m]&mxEdgeStyle.SOURCE_MASK),p=(y[m]&mxEdgeStyle.SIDE_MASK)>>5,p<<=g,15<p&&(p>>=4),q=0<(y[m]&mxEdgeStyle.CENTER_MASK),(u||z)&&9>p?(u=u?0:1,v=q&&0==l?d[u][0]+b[u][0]*d[u][2]:q?d[u][1]+b[u][1]*d[u][3]:mxEdgeStyle.limits[u][p],0==l?(p=(v-mxEdgeStyle.wayPoints1[f][0])*n[0],0<p&&(mxEdgeStyle.wayPoints1[f][0]+=n[0]*p)):
(p=(v-mxEdgeStyle.wayPoints1[f][1])*n[1],0<p&&(mxEdgeStyle.wayPoints1[f][1]+=n[1]*p))):q&&(mxEdgeStyle.wayPoints1[f][0]+=n[0]*Math.abs(mxEdgeStyle.vertexSeperations[v]/2),mxEdgeStyle.wayPoints1[f][1]+=n[1]*Math.abs(mxEdgeStyle.vertexSeperations[v]/2)),0<f&&mxEdgeStyle.wayPoints1[f][l]==mxEdgeStyle.wayPoints1[f-1][l]?f--:c=l;for(m=0;m<=f&&(m!=f||((0<(a[1]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))?0:1)==k?0:1)==(f+1)%2);m++)e.push(new mxPoint(Math.round(mxEdgeStyle.wayPoints1[m][0]),
Math.round(mxEdgeStyle.wayPoints1[m][1])))}},getRoutePattern:function(a,b,c,d){var e=a[0]==mxConstants.DIRECTION_MASK_EAST?3:a[0];a=a[1]==mxConstants.DIRECTION_MASK_EAST?3:a[1];e-=b;a-=b;1>e&&(e+=4);1>a&&(a+=4);b=routePatterns[e-1][a-1];0!=c&&0!=d||null==inlineRoutePatterns[e-1][a-1]||(b=inlineRoutePatterns[e-1][a-1]);return b}},mxStyleRegistry={values:[],putValue:function(a,b){mxStyleRegistry.values[a]=b},getValue:function(a){return mxStyleRegistry.values[a]},getName:function(a){for(var b in mxStyleRegistry.values)if(mxStyleRegistry.values[b]==
a)return b;return null}};mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ELBOW,mxEdgeStyle.ElbowConnector);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ENTITY_RELATION,mxEdgeStyle.EntityRelation);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_LOOP,mxEdgeStyle.Loop);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SIDETOSIDE,mxEdgeStyle.SideToSide);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_TOPTOBOTTOM,mxEdgeStyle.TopToBottom);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ORTHOGONAL,mxEdgeStyle.OrthConnector);
mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SEGMENT,mxEdgeStyle.SegmentConnector);mxStyleRegistry.putValue(mxConstants.PERIMETER_ELLIPSE,mxPerimeter.EllipsePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RECTANGLE,mxPerimeter.RectanglePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RHOMBUS,mxPerimeter.RhombusPerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_TRIANGLE,mxPerimeter.TrianglePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_HEXAGON,mxPerimeter.HexagonPerimeter);
function mxGraphView(a){this.graph=a;this.translate=new mxPoint;this.graphBounds=new mxRectangle;this.states=new mxDictionary}mxGraphView.prototype=new mxEventSource;mxGraphView.prototype.constructor=mxGraphView;mxGraphView.prototype.EMPTY_POINT=new mxPoint;mxGraphView.prototype.doneResource="none"!=mxClient.language?"done":"";mxGraphView.prototype.updatingDocumentResource="none"!=mxClient.language?"updatingDocument":"";mxGraphView.prototype.allowEval=!1;
mxGraphView.prototype.captureDocumentGesture=!0;mxGraphView.prototype.optimizeVmlReflows=!0;mxGraphView.prototype.rendering=!0;mxGraphView.prototype.graph=null;mxGraphView.prototype.currentRoot=null;mxGraphView.prototype.graphBounds=null;mxGraphView.prototype.scale=1;mxGraphView.prototype.translate=null;mxGraphView.prototype.updateStyle=!1;mxGraphView.prototype.lastNode=null;mxGraphView.prototype.lastHtmlNode=null;mxGraphView.prototype.lastForegroundNode=null;
mxGraphView.prototype.lastForegroundHtmlNode=null;mxGraphView.prototype.getGraphBounds=function(){return this.graphBounds};mxGraphView.prototype.setGraphBounds=function(a){this.graphBounds=a};mxGraphView.prototype.getBounds=function(a){var b=null;if(null!=a&&0<a.length)for(var c=this.graph.getModel(),d=0;d<a.length;d++)if(c.isVertex(a[d])||c.isEdge(a[d])){var e=this.getState(a[d]);null!=e&&(null==b?b=mxRectangle.fromRectangle(e):b.add(e))}return b};
mxGraphView.prototype.setCurrentRoot=function(a){if(this.currentRoot!=a){var b=new mxCurrentRootChange(this,a);b.execute();var c=new mxUndoableEdit(this,!1);c.add(b);this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",c));this.graph.sizeDidChange()}return a};
mxGraphView.prototype.scaleAndTranslate=function(a,b,c){var d=this.scale,e=new mxPoint(this.translate.x,this.translate.y);if(this.scale!=a||this.translate.x!=b||this.translate.y!=c)this.scale=a,this.translate.x=b,this.translate.y=c,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange());this.fireEvent(new mxEventObject(mxEvent.SCALE_AND_TRANSLATE,"scale",a,"previousScale",d,"translate",this.translate,"previousTranslate",e))};mxGraphView.prototype.getScale=function(){return this.scale};
mxGraphView.prototype.setScale=function(a){var b=this.scale;this.scale!=a&&(this.scale=a,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange()));this.fireEvent(new mxEventObject(mxEvent.SCALE,"scale",a,"previousScale",b))};mxGraphView.prototype.getTranslate=function(){return this.translate};
mxGraphView.prototype.setTranslate=function(a,b){var c=new mxPoint(this.translate.x,this.translate.y);if(this.translate.x!=a||this.translate.y!=b)this.translate.x=a,this.translate.y=b,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange());this.fireEvent(new mxEventObject(mxEvent.TRANSLATE,"translate",this.translate,"previousTranslate",c))};mxGraphView.prototype.refresh=function(){null!=this.currentRoot&&this.clear();this.revalidate()};
mxGraphView.prototype.revalidate=function(){this.invalidate();this.validate()};mxGraphView.prototype.clear=function(a,b,c){var d=this.graph.getModel();a=a||d.getRoot();b=null!=b?b:!1;c=null!=c?c:!0;this.removeState(a);if(c&&(b||a!=this.currentRoot)){c=d.getChildCount(a);for(var e=0;e<c;e++)this.clear(d.getChildAt(a,e),b)}else this.invalidate(a)};
mxGraphView.prototype.invalidate=function(a,b,c){var d=this.graph.getModel();a=a||d.getRoot();b=null!=b?b:!0;c=null!=c?c:!0;var e=this.getState(a);null!=e&&(e.invalid=!0);if(!a.invalidating){a.invalidating=!0;if(b)for(var f=d.getChildCount(a),e=0;e<f;e++){var g=d.getChildAt(a,e);this.invalidate(g,b,c)}if(c)for(f=d.getEdgeCount(a),e=0;e<f;e++)this.invalidate(d.getEdgeAt(a,e),b,c);delete a.invalidating}};
mxGraphView.prototype.validate=function(a){var b=mxLog.enter("mxGraphView.validate");window.status=mxResources.get(this.updatingDocumentResource)||this.updatingDocumentResource;this.resetValidationState();var c=null;this.optimizeVmlReflows&&null!=this.canvas&&null==this.textDiv&&(8==document.documentMode&&!mxClient.IS_EM||mxClient.IS_QUIRKS)&&(this.placeholder=document.createElement("div"),this.placeholder.style.position="absolute",this.placeholder.style.width=this.canvas.clientWidth+"px",this.placeholder.style.height=
this.canvas.clientHeight+"px",this.canvas.parentNode.appendChild(this.placeholder),c=this.drawPane.style.display,this.canvas.style.display="none",this.textDiv=document.createElement("div"),this.textDiv.style.position="absolute",this.textDiv.style.whiteSpace="nowrap",this.textDiv.style.visibility="hidden",this.textDiv.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",this.textDiv.style.zoom="1",document.body.appendChild(this.textDiv));a=this.getBoundingBox(this.validateCellState(this.validateCell(a||
(null!=this.currentRoot?this.currentRoot:this.graph.getModel().getRoot()))));this.setGraphBounds(null!=a?a:this.getEmptyBounds());this.validateBackground();null!=c&&(this.canvas.style.display=c,this.textDiv.parentNode.removeChild(this.textDiv),null!=this.placeholder&&this.placeholder.parentNode.removeChild(this.placeholder),this.textDiv=null);this.resetValidationState();window.status=mxResources.get(this.doneResource)||this.doneResource;mxLog.leave("mxGraphView.validate",b)};
mxGraphView.prototype.getEmptyBounds=function(){return new mxRectangle(this.translate.x*this.scale,this.translate.y*this.scale)};
mxGraphView.prototype.getBoundingBox=function(a,b){b=null!=b?b:!0;var c=null;if(null!=a&&(null!=a.shape&&null!=a.shape.boundingBox&&(c=a.shape.boundingBox.clone()),null!=a.text&&null!=a.text.boundingBox&&(null!=c?c.add(a.text.boundingBox):c=a.text.boundingBox.clone()),b))for(var d=this.graph.getModel(),e=d.getChildCount(a.cell),f=0;f<e;f++){var g=this.getBoundingBox(this.getState(d.getChildAt(a.cell,f)));null!=g&&(null==c?c=g:c.add(g))}return c};
mxGraphView.prototype.createBackgroundPageShape=function(a){return new mxRectangleShape(a,"white","black")};mxGraphView.prototype.validateBackground=function(){this.validateBackgroundImage();this.validateBackgroundPage()};
mxGraphView.prototype.validateBackgroundImage=function(){var a=this.graph.getBackgroundImage();if(null!=a){if(null==this.backgroundImage||this.backgroundImage.image!=a.src){null!=this.backgroundImage&&this.backgroundImage.destroy();var b=new mxRectangle(0,0,1,1);this.backgroundImage=new mxImageShape(b,a.src);this.backgroundImage.dialect=this.graph.dialect;this.backgroundImage.init(this.backgroundPane);this.backgroundImage.redraw();8==document.documentMode&&!mxClient.IS_EM&&mxEvent.addGestureListeners(this.backgroundImage.node,
mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a))}))}this.redrawBackgroundImage(this.backgroundImage,a)}else null!=this.backgroundImage&&(this.backgroundImage.destroy(),this.backgroundImage=null)};
mxGraphView.prototype.validateBackgroundPage=function(){if(this.graph.pageVisible){var a=this.getBackgroundPageBounds();null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(a),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),this.graph.nativeDblClickEnabled&&mxEvent.addListener(this.backgroundPageShape.node,
"dblclick",mxUtils.bind(this,function(a){this.graph.dblClick(a)})),mxEvent.addGestureListeners(this.backgroundPageShape.node,mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){null!=this.graph.tooltipHandler&&this.graph.tooltipHandler.isHideOnHover()&&this.graph.tooltipHandler.hide();this.graph.isMouseDown&&!mxEvent.isConsumed(a)&&this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,
new mxMouseEvent(a))}))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=a,this.backgroundPageShape.redraw())}else null!=this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)};mxGraphView.prototype.getBackgroundPageBounds=function(){var a=this.graph.pageFormat,b=this.scale*this.graph.pageScale;return new mxRectangle(this.scale*this.translate.x,this.scale*this.translate.y,a.width*b,a.height*b)};
mxGraphView.prototype.redrawBackgroundImage=function(a,b){a.scale=this.scale;a.bounds.x=this.scale*this.translate.x;a.bounds.y=this.scale*this.translate.y;a.bounds.width=this.scale*b.width;a.bounds.height=this.scale*b.height;a.redraw()};
mxGraphView.prototype.validateCell=function(a,b){if(null!=a)if(b=(null!=b?b:!0)&&this.graph.isCellVisible(a),null==this.getState(a,b)||b)for(var c=this.graph.getModel(),d=c.getChildCount(a),e=0;e<d;e++)this.validateCell(c.getChildAt(a,e),b&&(!this.isCellCollapsed(a)||a==this.currentRoot));else this.removeState(a);return a};
mxGraphView.prototype.validateCellState=function(a,b){b=null!=b?b:!0;var c=null;if(null!=a&&(c=this.getState(a),null!=c)){var d=this.graph.getModel();c.invalid&&(c.invalid=!1,a!=this.currentRoot&&this.validateCellState(d.getParent(a),!1),c.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(a,!0),!1),!0),c.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(a,!1),!1),!1),this.updateCellState(c),a!=this.currentRoot&&this.graph.cellRenderer.redraw(c,!1,this.isRendering()));
if(b){c.updateCachedBounds();null!=c.shape&&this.stateValidated(c);for(var e=d.getChildCount(a),f=0;f<e;f++)this.validateCellState(d.getChildAt(a,f))}}return c};
mxGraphView.prototype.updateCellState=function(a){a.absoluteOffset.x=0;a.absoluteOffset.y=0;a.origin.x=0;a.origin.y=0;a.length=0;if(a.cell!=this.currentRoot){var b=this.graph.getModel(),c=this.getState(b.getParent(a.cell));null!=c&&c.cell!=this.currentRoot&&(a.origin.x+=c.origin.x,a.origin.y+=c.origin.y);var d=this.graph.getChildOffsetForCell(a.cell);null!=d&&(a.origin.x+=d.x,a.origin.y+=d.y);var e=this.graph.getCellGeometry(a.cell);null!=e&&(b.isEdge(a.cell)||(d=e.offset||this.EMPTY_POINT,e.relative&&
null!=c?b.isEdge(c.cell)?(d=this.getPoint(c,e),null!=d&&(a.origin.x+=d.x/this.scale-c.origin.x-this.translate.x,a.origin.y+=d.y/this.scale-c.origin.y-this.translate.y)):(a.origin.x+=e.x*c.width/this.scale+d.x,a.origin.y+=e.y*c.height/this.scale+d.y):(a.absoluteOffset.x=this.scale*d.x,a.absoluteOffset.y=this.scale*d.y,a.origin.x+=e.x,a.origin.y+=e.y)),a.x=this.scale*(this.translate.x+a.origin.x),a.y=this.scale*(this.translate.y+a.origin.y),a.width=this.scale*e.width,a.height=this.scale*e.height,b.isVertex(a.cell)&&
this.updateVertexState(a,e),b.isEdge(a.cell)&&this.updateEdgeState(a,e))}};mxGraphView.prototype.isCellCollapsed=function(a){return this.graph.isCellCollapsed(a)};
mxGraphView.prototype.updateVertexState=function(a,b){var c=this.graph.getModel(),d=this.getState(c.getParent(a.cell));if(b.relative&&null!=d&&!c.isEdge(d.cell)){var e=mxUtils.toRadians(d.style[mxConstants.STYLE_ROTATION]||"0");if(0!=e){var c=Math.cos(e),e=Math.sin(e),f=new mxPoint(a.getCenterX(),a.getCenterY()),d=new mxPoint(d.getCenterX(),d.getCenterY()),d=mxUtils.getRotatedPoint(f,c,e,d);a.x=d.x-a.width/2;a.y=d.y-a.height/2}}this.updateVertexLabelOffset(a)};
mxGraphView.prototype.updateEdgeState=function(a,b){var c=a.getVisibleTerminalState(!0),d=a.getVisibleTerminalState(!1);null!=this.graph.model.getTerminal(a.cell,!0)&&null==c||null==c&&null==b.getTerminalPoint(!0)||null!=this.graph.model.getTerminal(a.cell,!1)&&null==d||null==d&&null==b.getTerminalPoint(!1)?this.clear(a.cell,!0):(this.updateFixedTerminalPoints(a,c,d),this.updatePoints(a,b.points,c,d),this.updateFloatingTerminalPoints(a,c,d),c=a.absolutePoints,a.cell!=this.currentRoot&&(null==c||2>
c.length||null==c[0]||null==c[c.length-1])?this.clear(a.cell,!0):(this.updateEdgeBounds(a),this.updateEdgeLabelOffset(a)))};
mxGraphView.prototype.updateVertexLabelOffset=function(a){var b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);if(b==mxConstants.ALIGN_LEFT)b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_WIDTH,null),b=null!=b?b*this.scale:a.width,a.absoluteOffset.x-=b;else if(b==mxConstants.ALIGN_RIGHT)a.absoluteOffset.x+=a.width;else if(b==mxConstants.ALIGN_CENTER&&(b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_WIDTH,null),null!=b)){var c=mxUtils.getValue(a.style,mxConstants.STYLE_ALIGN,
mxConstants.ALIGN_CENTER),d=0;c==mxConstants.ALIGN_CENTER?d=0.5:c==mxConstants.ALIGN_RIGHT&&(d=1);0!=d&&(a.absoluteOffset.x-=(b*this.scale-a.width)*d)}b=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);b==mxConstants.ALIGN_TOP?a.absoluteOffset.y-=a.height:b==mxConstants.ALIGN_BOTTOM&&(a.absoluteOffset.y+=a.height)};mxGraphView.prototype.resetValidationState=function(){this.lastForegroundHtmlNode=this.lastForegroundNode=this.lastHtmlNode=this.lastNode=null};
mxGraphView.prototype.stateValidated=function(a){var b=this.graph.getModel().isEdge(a.cell)&&this.graph.keepEdgesInForeground||this.graph.getModel().isVertex(a.cell)&&this.graph.keepEdgesInBackground;a=this.graph.cellRenderer.insertStateAfter(a,b?this.lastForegroundNode||this.lastNode:this.lastNode,b?this.lastForegroundHtmlNode||this.lastHtmlNode:this.lastHtmlNode);b?(this.lastForegroundHtmlNode=a[1],this.lastForegroundNode=a[0]):(this.lastHtmlNode=a[1],this.lastNode=a[0])};
mxGraphView.prototype.updateFixedTerminalPoints=function(a,b,c){this.updateFixedTerminalPoint(a,b,!0,this.graph.getConnectionConstraint(a,b,!0));this.updateFixedTerminalPoint(a,c,!1,this.graph.getConnectionConstraint(a,c,!1))};mxGraphView.prototype.updateFixedTerminalPoint=function(a,b,c,d){a.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(a,b,c,d),c)};
mxGraphView.prototype.getFixedTerminalPoint=function(a,b,c,d){var e=null;null!=d&&(e=this.graph.getConnectionPoint(b,d));if(null==e&&null==b){b=this.scale;d=this.translate;var f=a.origin,e=this.graph.getCellGeometry(a.cell).getTerminalPoint(c);null!=e&&(e=new mxPoint(b*(d.x+e.x+f.x),b*(d.y+e.y+f.y)))}return e};
mxGraphView.prototype.updateBoundsFromStencil=function(a){var b=null;if(null!=a&&null!=a.shape&&null!=a.shape.stencil&&"fixed"==a.shape.stencil.aspect){var b=mxRectangle.fromRectangle(a),c=a.shape.stencil.computeAspect(a.style,a.x,a.y,a.width,a.height);a.setRect(c.x,c.y,a.shape.stencil.w0*c.width,a.shape.stencil.h0*c.height)}return b};
mxGraphView.prototype.updatePoints=function(a,b,c,d){if(null!=a){var e=[];e.push(a.absolutePoints[0]);var f=this.getEdgeStyle(a,b,c,d);if(null!=f){c=this.getTerminalPort(a,c,!0);d=this.getTerminalPort(a,d,!1);var g=this.updateBoundsFromStencil(c),k=this.updateBoundsFromStencil(d);f(a,c,d,b,e);null!=g&&c.setRect(g.x,g.y,g.width,g.height);null!=k&&d.setRect(k.x,k.y,k.width,k.height)}else if(null!=b)for(f=0;f<b.length;f++)null!=b[f]&&(c=mxUtils.clone(b[f]),e.push(this.transformControlPoint(a,c)));b=
a.absolutePoints;e.push(b[b.length-1]);a.absolutePoints=e}};mxGraphView.prototype.transformControlPoint=function(a,b){if(null!=a&&null!=b){var c=a.origin;return new mxPoint(this.scale*(b.x+this.translate.x+c.x),this.scale*(b.y+this.translate.y+c.y))}return null};
mxGraphView.prototype.getEdgeStyle=function(a,b,c,d){a=null!=c&&c==d?mxUtils.getValue(a.style,mxConstants.STYLE_LOOP,this.graph.defaultLoopStyle):mxUtils.getValue(a.style,mxConstants.STYLE_NOEDGESTYLE,!1)?null:a.style[mxConstants.STYLE_EDGE];"string"==typeof a&&(b=mxStyleRegistry.getValue(a),null==b&&this.isAllowEval()&&(b=mxUtils.eval(a)),a=b);return"function"==typeof a?a:null};
mxGraphView.prototype.updateFloatingTerminalPoints=function(a,b,c){var d=a.absolutePoints,e=d[0];null==d[d.length-1]&&null!=c&&this.updateFloatingTerminalPoint(a,c,b,!1);null==e&&null!=b&&this.updateFloatingTerminalPoint(a,b,c,!0)};mxGraphView.prototype.updateFloatingTerminalPoint=function(a,b,c,d){a.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(a,b,c,d),d)};
mxGraphView.prototype.getFloatingTerminalPoint=function(a,b,c,d){b=this.getTerminalPort(a,b,d);var e=this.getNextPoint(a,c,d),f=this.graph.isOrthogonal(a);c=mxUtils.toRadians(Number(b.style[mxConstants.STYLE_ROTATION]||"0"));var g=new mxPoint(b.getCenterX(),b.getCenterY());if(0!=c)var k=Math.cos(-c),l=Math.sin(-c),e=mxUtils.getRotatedPoint(e,k,l,g);k=parseFloat(a.style[mxConstants.STYLE_PERIMETER_SPACING]||0);k+=parseFloat(a.style[d?mxConstants.STYLE_SOURCE_PERIMETER_SPACING:mxConstants.STYLE_TARGET_PERIMETER_SPACING]||
0);a=this.getPerimeterPoint(b,e,0==c&&f,k);0!=c&&(k=Math.cos(c),l=Math.sin(c),a=mxUtils.getRotatedPoint(a,k,l,g));return a};mxGraphView.prototype.getTerminalPort=function(a,b,c){a=mxUtils.getValue(a.style,c?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT);null!=a&&(a=this.getState(this.graph.getModel().getCell(a)),null!=a&&(b=a));return b};
mxGraphView.prototype.getPerimeterPoint=function(a,b,c,d){var e=null;if(null!=a){var f=this.getPerimeterFunction(a);null!=f&&null!=b&&(d=this.getPerimeterBounds(a,d),0<d.width||0<d.height)&&(e=f(d,a,b,c),null!=e&&(e.x=Math.round(e.x),e.y=Math.round(e.y)));null==e&&(e=this.getPoint(a))}return e};mxGraphView.prototype.getRoutingCenterX=function(a){var b=null!=a.style?parseFloat(a.style[mxConstants.STYLE_ROUTING_CENTER_X])||0:0;return a.getCenterX()+b*a.width};
mxGraphView.prototype.getRoutingCenterY=function(a){var b=null!=a.style?parseFloat(a.style[mxConstants.STYLE_ROUTING_CENTER_Y])||0:0;return a.getCenterY()+b*a.height};mxGraphView.prototype.getPerimeterBounds=function(a,b){b=null!=b?b:0;null!=a&&(b+=parseFloat(a.style[mxConstants.STYLE_PERIMETER_SPACING]||0));return a.getPerimeterBounds(b*this.scale)};
mxGraphView.prototype.getPerimeterFunction=function(a){a=a.style[mxConstants.STYLE_PERIMETER];if("string"==typeof a){var b=mxStyleRegistry.getValue(a);null==b&&this.isAllowEval()&&(b=mxUtils.eval(a));a=b}return"function"==typeof a?a:null};mxGraphView.prototype.getNextPoint=function(a,b,c){a=a.absolutePoints;var d=null;null!=a&&2<=a.length&&(d=a.length,d=a[c?Math.min(1,d-1):Math.max(0,d-2)]);null==d&&null!=b&&(d=new mxPoint(b.getCenterX(),b.getCenterY()));return d};
mxGraphView.prototype.getVisibleTerminal=function(a,b){for(var c=this.graph.getModel(),d=c.getTerminal(a,b),e=d;null!=d&&d!=this.currentRoot;){if(!this.graph.isCellVisible(e)||this.isCellCollapsed(d))e=d;d=c.getParent(d)}c.getParent(e)==c.getRoot()&&(e=null);return e};
mxGraphView.prototype.updateEdgeBounds=function(a){var b=a.absolutePoints,c=b[0],d=b[b.length-1];if(c.x!=d.x||c.y!=d.y){var e=d.x-c.x,f=d.y-c.y;a.terminalDistance=Math.sqrt(e*e+f*f)}else a.terminalDistance=0;var d=0,g=[],f=c;if(null!=f){for(var c=f.x,k=f.y,l=c,m=k,n=1;n<b.length;n++){var p=b[n];null!=p&&(e=f.x-p.x,f=f.y-p.y,e=Math.sqrt(e*e+f*f),g.push(e),d+=e,f=p,c=Math.min(f.x,c),k=Math.min(f.y,k),l=Math.max(f.x,l),m=Math.max(f.y,m))}a.length=d;a.segments=g;a.x=c;a.y=k;a.width=Math.max(1,l-c);a.height=
Math.max(1,m-k)}};
mxGraphView.prototype.getPoint=function(a,b){var c=a.getCenterX(),d=a.getCenterY();if(null==a.segments||null!=b&&!b.relative)null!=b&&(m=b.offset,null!=m&&(c+=m.x,d+=m.y));else{for(var e=a.absolutePoints.length,f=((null!=b?b.x/2:0)+0.5)*a.length,g=a.segments[0],k=0,l=1;f>k+g&&l<e-1;)k+=g,g=a.segments[l++];e=0==g?0:(f-k)/g;f=a.absolutePoints[l-1];l=a.absolutePoints[l];if(null!=f&&null!=l){k=c=d=0;if(null!=b){var d=b.y,m=b.offset;null!=m&&(c=m.x,k=m.y)}m=l.x-f.x;l=l.y-f.y;c=f.x+m*e+((0==g?0:l/g)*d+
c)*this.scale;d=f.y+l*e-((0==g?0:m/g)*d-k)*this.scale}}return new mxPoint(c,d)};
mxGraphView.prototype.getRelativePoint=function(a,b,c){var d=this.graph.getModel().getGeometry(a.cell);if(null!=d){var e=a.absolutePoints.length;if(d.relative&&1<e){for(var d=a.length,f=a.segments,g=a.absolutePoints[0],k=a.absolutePoints[1],l=mxUtils.ptSegDistSq(g.x,g.y,k.x,k.y,b,c),m=0,n=0,p=0,q=2;q<e;q++)n+=f[q-2],k=a.absolutePoints[q],g=mxUtils.ptSegDistSq(g.x,g.y,k.x,k.y,b,c),g<=l&&(l=g,m=q-1,p=n),g=k;e=f[m];g=a.absolutePoints[m];k=a.absolutePoints[m+1];l=k.x;f=k.y;a=g.x-l;m=g.y-f;l=a-(b-l);f=
m-(c-f);f=l*a+f*m;a=Math.sqrt(0>=f?0:f*f/(a*a+m*m));a>e&&(a=e);e=Math.sqrt(mxUtils.ptSegDistSq(g.x,g.y,k.x,k.y,b,c));-1==mxUtils.relativeCcw(g.x,g.y,k.x,k.y,b,c)&&(e=-e);return new mxPoint((d/2-p-a)/d*-2,e/this.scale)}}return new mxPoint};
mxGraphView.prototype.updateEdgeLabelOffset=function(a){var b=a.absolutePoints;a.absoluteOffset.x=a.getCenterX();a.absoluteOffset.y=a.getCenterY();if(null!=b&&0<b.length&&null!=a.segments){var c=this.graph.getCellGeometry(a.cell);if(c.relative){var d=this.getPoint(a,c);null!=d&&(a.absoluteOffset=d)}else{var d=b[0],e=b[b.length-1];if(null!=d&&null!=e){var b=e.x-d.x,f=e.y-d.y,g=e=0,c=c.offset;null!=c&&(e=c.x,g=c.y);c=d.y+f/2+g*this.scale;a.absoluteOffset.x=d.x+b/2+e*this.scale;a.absoluteOffset.y=c}}}};
mxGraphView.prototype.getState=function(a,b){b=b||!1;var c=null;null!=a&&(c=this.states.get(a),b&&(null==c||this.updateStyle)&&this.graph.isCellVisible(a))&&(null==c?(c=this.createState(a),this.states.put(a,c)):c.style=this.graph.getCellStyle(a));return c};mxGraphView.prototype.isRendering=function(){return this.rendering};mxGraphView.prototype.setRendering=function(a){this.rendering=a};mxGraphView.prototype.isAllowEval=function(){return this.allowEval};
mxGraphView.prototype.setAllowEval=function(a){this.allowEval=a};mxGraphView.prototype.getStates=function(){return this.states};mxGraphView.prototype.setStates=function(a){this.states=a};mxGraphView.prototype.getCellStates=function(a){if(null==a)return this.states;for(var b=[],c=0;c<a.length;c++){var d=this.getState(a[c]);null!=d&&b.push(d)}return b};
mxGraphView.prototype.removeState=function(a){var b=null;null!=a&&(b=this.states.remove(a),null!=b&&(this.graph.cellRenderer.destroy(b),b.destroy()));return b};mxGraphView.prototype.createState=function(a){a=new mxCellState(this,a,this.graph.getCellStyle(a));var b=this.graph.getModel();null!=a.view.graph.container&&a.cell!=a.view.currentRoot&&(b.isVertex(a.cell)||b.isEdge(a.cell))&&(a.shape=this.graph.cellRenderer.createShape(a),a.shape.antiAlias=this.graph.cellRenderer.antiAlias);return a};
mxGraphView.prototype.getCanvas=function(){return this.canvas};mxGraphView.prototype.getBackgroundPane=function(){return this.backgroundPane};mxGraphView.prototype.getDrawPane=function(){return this.drawPane};mxGraphView.prototype.getOverlayPane=function(){return this.overlayPane};mxGraphView.prototype.getDecoratorPane=function(){return this.decoratorPane};
mxGraphView.prototype.isContainerEvent=function(a){a=mxEvent.getSource(a);return a==this.graph.container||a.parentNode==this.backgroundPane||null!=a.parentNode&&a.parentNode.parentNode==this.backgroundPane||a==this.canvas.parentNode||a==this.canvas||a==this.backgroundPane||a==this.drawPane||a==this.overlayPane||a==this.decoratorPane};
mxGraphView.prototype.isScrollEvent=function(a){var b=mxUtils.getOffset(this.graph.container);a=new mxPoint(a.clientX-b.x,a.clientY-b.y);var b=this.graph.container.offsetWidth,c=this.graph.container.clientWidth;if(b>c&&a.x>c+2&&a.x<=b)return!0;b=this.graph.container.offsetHeight;c=this.graph.container.clientHeight;return b>c&&a.y>c+2&&a.y<=b?!0:!1};
mxGraphView.prototype.init=function(){this.installListeners();var a=this.graph;a.dialect==mxConstants.DIALECT_SVG?this.createSvg():a.dialect==mxConstants.DIALECT_VML?this.createVml():this.createHtml()};
mxGraphView.prototype.installListeners=function(){var a=this.graph,b=a.container;if(null!=b){mxClient.IS_TOUCH&&(mxEvent.addListener(b,"gesturestart",mxUtils.bind(this,function(b){a.fireGestureEvent(b);mxEvent.consume(b)})),mxEvent.addListener(b,"gesturechange",mxUtils.bind(this,function(b){a.fireGestureEvent(b);mxEvent.consume(b)})),mxEvent.addListener(b,"gestureend",mxUtils.bind(this,function(b){a.fireGestureEvent(b);mxEvent.consume(b)})));mxEvent.addGestureListeners(b,mxUtils.bind(this,function(b){!this.isContainerEvent(b)||
(mxClient.IS_IE||mxClient.IS_IE11||mxClient.IS_GC||mxClient.IS_OP||mxClient.IS_SF)&&this.isScrollEvent(b)||a.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b))}),mxUtils.bind(this,function(b){this.isContainerEvent(b)&&a.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b))}),mxUtils.bind(this,function(b){this.isContainerEvent(b)&&a.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b))}));mxEvent.addListener(b,"dblclick",mxUtils.bind(this,function(b){this.isContainerEvent(b)&&a.dblClick(b)}));
var c=function(c){var e=null;mxClient.IS_TOUCH&&(e=mxEvent.getClientX(c),c=mxEvent.getClientY(c),c=mxUtils.convertPoint(b,e,c),e=a.view.getState(a.getCellAt(c.x,c.y)));return e};a.addMouseListener({mouseDown:function(b,c){a.popupMenuHandler.hideMenu()},mouseMove:function(){},mouseUp:function(){}});this.moveHandler=mxUtils.bind(this,function(b){null!=a.tooltipHandler&&a.tooltipHandler.isHideOnHover()&&a.tooltipHandler.hide();this.captureDocumentGesture&&a.isMouseDown&&null!=a.container&&!this.isContainerEvent(b)&&
"none"!=a.container.style.display&&"hidden"!=a.container.style.visibility&&!mxEvent.isConsumed(b)&&a.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,c(b)))});this.endHandler=mxUtils.bind(this,function(b){this.captureDocumentGesture&&a.isMouseDown&&null!=a.container&&!this.isContainerEvent(b)&&"none"!=a.container.style.display&&"hidden"!=a.container.style.visibility&&a.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b))});mxEvent.addGestureListeners(document,null,this.moveHandler,this.endHandler)}};
mxGraphView.prototype.createHtml=function(){var a=this.graph.container;null!=a&&(this.canvas=this.createHtmlPane("100%","100%"),this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),a.appendChild(this.canvas),
mxClient.IS_QUIRKS&&(a=mxUtils.bind(this,function(a){a=this.getGraphBounds();this.updateHtmlCanvasSize(a.x+a.width+this.graph.border,a.y+a.height+this.graph.border)}),mxEvent.addListener(window,"resize",a)))};mxGraphView.prototype.updateHtmlCanvasSize=function(a,b){if(null!=this.graph.container){var c=this.graph.container.offsetHeight;this.canvas.style.width=this.graph.container.offsetWidth<a?a+"px":"100%";this.canvas.style.height=c<b?b+"px":"100%"}};
mxGraphView.prototype.createHtmlPane=function(a,b){var c=document.createElement("DIV");null!=a&&null!=b?(c.style.position="absolute",c.style.left="0px",c.style.top="0px",c.style.width=a,c.style.height=b):c.style.position="relative";return c};
mxGraphView.prototype.createVml=function(){var a=this.graph.container;if(null!=a){var b=a.offsetWidth,c=a.offsetHeight;this.canvas=this.createVmlPane(b,c);this.backgroundPane=this.createVmlPane(b,c);this.drawPane=this.createVmlPane(b,c);this.overlayPane=this.createVmlPane(b,c);this.decoratorPane=this.createVmlPane(b,c);this.canvas.appendChild(this.backgroundPane);this.canvas.appendChild(this.drawPane);this.canvas.appendChild(this.overlayPane);this.canvas.appendChild(this.decoratorPane);a.appendChild(this.canvas)}};
mxGraphView.prototype.createVmlPane=function(a,b){var c=document.createElement(mxClient.VML_PREFIX+":group");c.style.position="absolute";c.style.left="0px";c.style.top="0px";c.style.width=a+"px";c.style.height=b+"px";c.setAttribute("coordsize",a+","+b);c.setAttribute("coordorigin","0,0");return c};
mxGraphView.prototype.createSvg=function(){var a=this.graph.container;this.canvas=document.createElementNS(mxConstants.NS_SVG,"g");this.backgroundPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.backgroundPane);this.drawPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.drawPane);this.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.overlayPane);this.decoratorPane=document.createElementNS(mxConstants.NS_SVG,
"g");this.canvas.appendChild(this.decoratorPane);var b=document.createElementNS(mxConstants.NS_SVG,"svg");b.style.width="100%";b.style.height="100%";b.style.display="block";b.appendChild(this.canvas);null!=a&&(a.appendChild(b),this.updateContainerStyle(a))};mxGraphView.prototype.updateContainerStyle=function(a){var b=mxUtils.getCurrentStyle(a);null!=b&&"static"==b.position&&(a.style.position="relative");mxClient.IS_POINTER&&(a.style.msTouchAction="none")};
mxGraphView.prototype.destroy=function(){var a=null!=this.canvas?this.canvas.ownerSVGElement:null;null==a&&(a=this.canvas);null!=a&&null!=a.parentNode&&(this.clear(this.currentRoot,!0),mxEvent.removeGestureListeners(document,null,this.moveHandler,this.endHandler),mxEvent.release(this.graph.container),a.parentNode.removeChild(a),this.decoratorPane=this.overlayPane=this.drawPane=this.backgroundPane=this.canvas=this.endHandler=this.moveHandler=null)};
function mxCurrentRootChange(a,b){this.view=a;this.previous=this.root=b;this.isUp=null==b;if(!this.isUp)for(var c=this.view.currentRoot,d=this.view.graph.getModel();null!=c;){if(c==b){this.isUp=!0;break}c=d.getParent(c)}}
mxCurrentRootChange.prototype.execute=function(){var a=this.view.currentRoot;this.view.currentRoot=this.previous;this.previous=a;a=this.view.graph.getTranslateForRoot(this.view.currentRoot);null!=a&&(this.view.translate=new mxPoint(-a.x,-a.y));this.isUp?(this.view.clear(this.view.currentRoot,!0),this.view.validate()):this.view.refresh();this.view.fireEvent(new mxEventObject(this.isUp?mxEvent.UP:mxEvent.DOWN,"root",this.view.currentRoot,"previous",this.previous));this.isUp=!this.isUp};
function mxGraph(a,b,c,d){this.mouseListeners=null;this.renderHint=c;this.dialect=mxClient.IS_SVG?mxConstants.DIALECT_SVG:c==mxConstants.RENDERING_HINT_EXACT&&mxClient.IS_VML?mxConstants.DIALECT_VML:c==mxConstants.RENDERING_HINT_FASTEST?mxConstants.DIALECT_STRICTHTML:c==mxConstants.RENDERING_HINT_FASTER?mxConstants.DIALECT_PREFERHTML:mxConstants.DIALECT_MIXEDHTML;this.model=null!=b?b:new mxGraphModel;this.multiplicities=[];this.imageBundles=[];this.cellRenderer=this.createCellRenderer();this.setSelectionModel(this.createSelectionModel());
this.setStylesheet(null!=d?d:this.createStylesheet());this.view=this.createGraphView();this.graphModelChangeListener=mxUtils.bind(this,function(a,b){this.graphModelChanged(b.getProperty("edit").changes)});this.model.addListener(mxEvent.CHANGE,this.graphModelChangeListener);this.createHandlers();null!=a&&this.init(a);this.view.revalidate()}mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/graph");mxGraph.prototype=new mxEventSource;mxGraph.prototype.constructor=mxGraph;
mxGraph.prototype.EMPTY_ARRAY=[];mxGraph.prototype.mouseListeners=null;mxGraph.prototype.isMouseDown=!1;mxGraph.prototype.model=null;mxGraph.prototype.view=null;mxGraph.prototype.stylesheet=null;mxGraph.prototype.selectionModel=null;mxGraph.prototype.cellEditor=null;mxGraph.prototype.cellRenderer=null;mxGraph.prototype.multiplicities=null;mxGraph.prototype.renderHint=null;mxGraph.prototype.dialect=null;mxGraph.prototype.gridSize=10;mxGraph.prototype.gridEnabled=!0;mxGraph.prototype.portsEnabled=!0;
mxGraph.prototype.nativeDblClickEnabled=!0;mxGraph.prototype.doubleTapEnabled=!0;mxGraph.prototype.doubleTapTimeout=500;mxGraph.prototype.doubleTapTolerance=25;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchTime=0;mxGraph.prototype.tapAndHoldEnabled=!0;mxGraph.prototype.tapAndHoldDelay=500;mxGraph.prototype.tapAndHoldInProgress=!1;mxGraph.prototype.tapAndHoldValid=!1;mxGraph.prototype.initialTouchX=0;mxGraph.prototype.initialTouchY=0;
mxGraph.prototype.tolerance=4;mxGraph.prototype.defaultOverlap=0.5;mxGraph.prototype.defaultParent=null;mxGraph.prototype.alternateEdgeStyle=null;mxGraph.prototype.backgroundImage=null;mxGraph.prototype.pageVisible=!1;mxGraph.prototype.pageBreaksVisible=!1;mxGraph.prototype.pageBreakColor="gray";mxGraph.prototype.pageBreakDashed=!0;mxGraph.prototype.minPageBreakDist=20;mxGraph.prototype.preferPageSize=!1;mxGraph.prototype.pageFormat=mxConstants.PAGE_FORMAT_A4_PORTRAIT;
mxGraph.prototype.pageScale=1.5;mxGraph.prototype.enabled=!0;mxGraph.prototype.escapeEnabled=!0;mxGraph.prototype.invokesStopCellEditing=!0;mxGraph.prototype.enterStopsCellEditing=!1;mxGraph.prototype.useScrollbarsForPanning=!0;mxGraph.prototype.exportEnabled=!0;mxGraph.prototype.importEnabled=!0;mxGraph.prototype.cellsLocked=!1;mxGraph.prototype.cellsCloneable=!0;mxGraph.prototype.foldingEnabled=!0;mxGraph.prototype.cellsEditable=!0;mxGraph.prototype.cellsDeletable=!0;
mxGraph.prototype.cellsMovable=!0;mxGraph.prototype.edgeLabelsMovable=!0;mxGraph.prototype.vertexLabelsMovable=!1;mxGraph.prototype.dropEnabled=!1;mxGraph.prototype.splitEnabled=!0;mxGraph.prototype.cellsResizable=!0;mxGraph.prototype.cellsBendable=!0;mxGraph.prototype.cellsSelectable=!0;mxGraph.prototype.cellsDisconnectable=!0;mxGraph.prototype.autoSizeCells=!1;mxGraph.prototype.autoSizeCellsOnAdd=!1;mxGraph.prototype.autoScroll=!0;mxGraph.prototype.timerAutoScroll=!1;
mxGraph.prototype.allowAutoPanning=!1;mxGraph.prototype.ignoreScrollbars=!1;mxGraph.prototype.autoExtend=!0;mxGraph.prototype.maximumGraphBounds=null;mxGraph.prototype.minimumGraphSize=null;mxGraph.prototype.minimumContainerSize=null;mxGraph.prototype.maximumContainerSize=null;mxGraph.prototype.resizeContainer=!1;mxGraph.prototype.border=0;mxGraph.prototype.keepEdgesInForeground=!1;mxGraph.prototype.keepEdgesInBackground=!1;mxGraph.prototype.allowNegativeCoordinates=!0;
mxGraph.prototype.constrainChildren=!0;mxGraph.prototype.constrainChildrenOnResize=!1;mxGraph.prototype.extendParents=!0;mxGraph.prototype.extendParentsOnAdd=!0;mxGraph.prototype.extendParentsOnMove=!1;mxGraph.prototype.recursiveResize=!1;mxGraph.prototype.collapseToPreferredSize=!0;mxGraph.prototype.zoomFactor=1.2;mxGraph.prototype.keepSelectionVisibleOnZoom=!1;mxGraph.prototype.centerZoom=!0;mxGraph.prototype.resetViewOnRootChange=!0;mxGraph.prototype.resetEdgesOnResize=!1;
mxGraph.prototype.resetEdgesOnMove=!1;mxGraph.prototype.resetEdgesOnConnect=!0;mxGraph.prototype.allowLoops=!1;mxGraph.prototype.defaultLoopStyle=mxEdgeStyle.Loop;mxGraph.prototype.multigraph=!0;mxGraph.prototype.connectableEdges=!1;mxGraph.prototype.allowDanglingEdges=!0;mxGraph.prototype.cloneInvalidEdges=!1;mxGraph.prototype.disconnectOnMove=!0;mxGraph.prototype.labelsVisible=!0;mxGraph.prototype.htmlLabels=!1;mxGraph.prototype.swimlaneSelectionEnabled=!0;mxGraph.prototype.swimlaneNesting=!0;
mxGraph.prototype.swimlaneIndicatorColorAttribute=mxConstants.STYLE_FILLCOLOR;mxGraph.prototype.imageBundles=null;mxGraph.prototype.minFitScale=0.1;mxGraph.prototype.maxFitScale=8;mxGraph.prototype.panDx=0;mxGraph.prototype.panDy=0;mxGraph.prototype.collapsedImage=new mxImage(mxClient.imageBasePath+"/collapsed.gif",9,9);mxGraph.prototype.expandedImage=new mxImage(mxClient.imageBasePath+"/expanded.gif",9,9);
mxGraph.prototype.warningImage=new mxImage(mxClient.imageBasePath+"/warning"+(mxClient.IS_MAC?".png":".gif"),16,16);mxGraph.prototype.alreadyConnectedResource="none"!=mxClient.language?"alreadyConnected":"";mxGraph.prototype.containsValidationErrorsResource="none"!=mxClient.language?"containsValidationErrors":"";mxGraph.prototype.collapseExpandResource="none"!=mxClient.language?"collapse-expand":"";
mxGraph.prototype.init=function(a){this.container=a;this.cellEditor=this.createCellEditor();this.view.init();this.sizeDidChange();mxEvent.addListener(a,"mouseleave",mxUtils.bind(this,function(){null!=this.tooltipHandler&&this.tooltipHandler.hide()}));mxClient.IS_IE&&(mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})),mxEvent.addListener(a,"selectstart",mxUtils.bind(this,function(a){return this.isEditing()||!this.isMouseDown&&!mxEvent.isShiftDown(a)})));8==document.documentMode&&
a.insertAdjacentHTML("beforeend",'<v:group style="DISPLAY: none;"></v:group>')};
mxGraph.prototype.createHandlers=function(){this.tooltipHandler=this.createTooltipHandler();this.tooltipHandler.setEnabled(!1);this.selectionCellsHandler=this.createSelectionCellsHandler();this.connectionHandler=this.createConnectionHandler();this.connectionHandler.setEnabled(!1);this.graphHandler=this.createGraphHandler();this.panningHandler=this.createPanningHandler();this.panningHandler.panningEnabled=!1;this.popupMenuHandler=this.createPopupMenuHandler()};
mxGraph.prototype.createTooltipHandler=function(){return new mxTooltipHandler(this)};mxGraph.prototype.createSelectionCellsHandler=function(){return new mxSelectionCellsHandler(this)};mxGraph.prototype.createConnectionHandler=function(){return new mxConnectionHandler(this)};mxGraph.prototype.createGraphHandler=function(){return new mxGraphHandler(this)};mxGraph.prototype.createPanningHandler=function(){return new mxPanningHandler(this)};mxGraph.prototype.createPopupMenuHandler=function(){return new mxPopupMenuHandler(this)};
mxGraph.prototype.createSelectionModel=function(){return new mxGraphSelectionModel(this)};mxGraph.prototype.createStylesheet=function(){return new mxStylesheet};mxGraph.prototype.createGraphView=function(){return new mxGraphView(this)};mxGraph.prototype.createCellRenderer=function(){return new mxCellRenderer};mxGraph.prototype.createCellEditor=function(){return new mxCellEditor(this)};mxGraph.prototype.getModel=function(){return this.model};mxGraph.prototype.getView=function(){return this.view};
mxGraph.prototype.getStylesheet=function(){return this.stylesheet};mxGraph.prototype.setStylesheet=function(a){this.stylesheet=a};mxGraph.prototype.getSelectionModel=function(){return this.selectionModel};mxGraph.prototype.setSelectionModel=function(a){this.selectionModel=a};
mxGraph.prototype.getSelectionCellsForChanges=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d.constructor!=mxRootChange){var e=null;d instanceof mxChildChange&&null==d.previous?e=d.child:null!=d.cell&&d.cell instanceof mxCell&&(e=d.cell);null!=e&&0>mxUtils.indexOf(b,e)&&b.push(e)}}return this.getModel().getTopmostCells(b)};
mxGraph.prototype.graphModelChanged=function(a){for(var b=0;b<a.length;b++)this.processChange(a[b]);this.removeSelectionCells(this.getRemovedCellsForChanges(a));this.view.validate();this.sizeDidChange()};mxGraph.prototype.getRemovedCellsForChanges=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d instanceof mxRootChange)break;else d instanceof mxChildChange?null!=d.previous&&null==d.parent&&(b=b.concat(this.model.getDescendants(d.child))):d instanceof mxVisibleChange&&(b=b.concat(this.model.getDescendants(d.cell)))}return b};
mxGraph.prototype.processChange=function(a){if(a instanceof mxRootChange)this.clearSelection(),this.removeStateForCell(a.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new mxEventObject(mxEvent.ROOT));else if(a instanceof mxChildChange){var b=this.model.getParent(a.child);this.view.invalidate(a.child,!0,!0);if(null==b||this.isCellCollapsed(b))this.view.invalidate(a.child,!0,!0),this.removeStateForCell(a.child),this.view.currentRoot==
a.child&&this.home();b!=a.previous&&(null!=b&&this.view.invalidate(b,!1,!1),null!=a.previous&&this.view.invalidate(a.previous,!1,!1))}else a instanceof mxTerminalChange||a instanceof mxGeometryChange?(a instanceof mxTerminalChange||null==a.previous&&null!=a.geometry||null!=a.previous&&!a.previous.equals(a.geometry))&&this.view.invalidate(a.cell):a instanceof mxValueChange?this.view.invalidate(a.cell,!1,!1):a instanceof mxStyleChange?(this.view.invalidate(a.cell,!0,!0),this.view.removeState(a.cell)):
null!=a.cell&&a.cell instanceof mxCell&&this.removeStateForCell(a.cell)};mxGraph.prototype.removeStateForCell=function(a){for(var b=this.model.getChildCount(a),c=0;c<b;c++)this.removeStateForCell(this.model.getChildAt(a,c));this.view.invalidate(a,!1,!0);this.view.removeState(a)};
mxGraph.prototype.addCellOverlay=function(a,b){null==a.overlays&&(a.overlays=[]);a.overlays.push(b);var c=this.view.getState(a);null!=c&&this.cellRenderer.redraw(c);this.fireEvent(new mxEventObject(mxEvent.ADD_OVERLAY,"cell",a,"overlay",b));return b};mxGraph.prototype.getCellOverlays=function(a){return a.overlays};
mxGraph.prototype.removeCellOverlay=function(a,b){if(null==b)this.removeCellOverlays(a);else{var c=mxUtils.indexOf(a.overlays,b);0<=c?(a.overlays.splice(c,1),0==a.overlays.length&&(a.overlays=null),c=this.view.getState(a),null!=c&&this.cellRenderer.redraw(c),this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",a,"overlay",b))):b=null}return b};
mxGraph.prototype.removeCellOverlays=function(a){var b=a.overlays;if(null!=b){a.overlays=null;var c=this.view.getState(a);null!=c&&this.cellRenderer.redraw(c);for(c=0;c<b.length;c++)this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",a,"overlay",b[c]))}return b};mxGraph.prototype.clearCellOverlays=function(a){a=null!=a?a:this.model.getRoot();this.removeCellOverlays(a);for(var b=this.model.getChildCount(a),c=0;c<b;c++){var d=this.model.getChildAt(a,c);this.clearCellOverlays(d)}};
mxGraph.prototype.setCellWarning=function(a,b,c,d){if(null!=b&&0<b.length)return c=null!=c?c:this.warningImage,b=new mxCellOverlay(c,"<font color=red>"+b+"</font>"),d&&b.addListener(mxEvent.CLICK,mxUtils.bind(this,function(b,c){this.isEnabled()&&this.setSelectionCell(a)})),this.addCellOverlay(a,b);this.removeCellOverlays(a);return null};mxGraph.prototype.startEditing=function(a){this.startEditingAtCell(null,a)};
mxGraph.prototype.startEditingAtCell=function(a,b){null!=b&&mxEvent.isMultiTouchEvent(b)||(null==a&&(a=this.getSelectionCell(),null!=a&&!this.isCellEditable(a)&&(a=null)),null!=a&&(this.fireEvent(new mxEventObject(mxEvent.START_EDITING,"cell",a,"event",b)),this.cellEditor.startEditing(a,b),this.fireEvent(new mxEventObject(mxEvent.EDITING_STARTED,"cell",a,"event",b))))};mxGraph.prototype.getEditingValue=function(a,b){return this.convertValueToString(a)};
mxGraph.prototype.stopEditing=function(a){this.cellEditor.stopEditing(a);this.fireEvent(new mxEventObject(mxEvent.EDITING_STOPPED,"cancel",a))};mxGraph.prototype.labelChanged=function(a,b,c){this.model.beginUpdate();try{var d=a.value;this.cellLabelChanged(a,b,this.isAutoSizeCell(a));this.fireEvent(new mxEventObject(mxEvent.LABEL_CHANGED,"cell",a,"value",b,"old",d,"event",c))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellLabelChanged=function(a,b,c){this.model.beginUpdate();try{this.model.setValue(a,b),c&&this.cellSizeUpdated(a,!1)}finally{this.model.endUpdate()}};mxGraph.prototype.escape=function(a){this.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",a))};
mxGraph.prototype.click=function(a){var b=a.getEvent(),c=a.getCell(),d=new mxEventObject(mxEvent.CLICK,"event",b,"cell",c);a.isConsumed()&&d.consume();this.fireEvent(d);this.isEnabled()&&!mxEvent.isConsumed(b)&&!d.isConsumed()&&(null!=c?this.selectCellForEvent(c,b):(c=null,this.isSwimlaneSelectionEnabled()&&(c=this.getSwimlaneAt(a.getGraphX(),a.getGraphY())),null!=c?this.selectCellForEvent(c,b):this.isToggleEvent(b)||this.clearSelection()))};
mxGraph.prototype.dblClick=function(a,b){var c=new mxEventObject(mxEvent.DOUBLE_CLICK,"event",a,"cell",b);this.fireEvent(c);this.isEnabled()&&!mxEvent.isConsumed(a)&&!c.isConsumed()&&null!=b&&this.isCellEditable(b)&&!this.isEditing(b)&&(this.startEditingAtCell(b,a),mxEvent.consume(a))};
mxGraph.prototype.tapAndHold=function(a){var b=a.getEvent(),c=new mxEventObject(mxEvent.TAP_AND_HOLD,"event",b,"cell",a.getCell());this.fireEvent(c);c.isConsumed()&&(this.panningHandler.panningTrigger=!1);this.isEnabled()&&!mxEvent.isConsumed(b)&&!c.isConsumed()&&this.connectionHandler.isEnabled()&&(b=this.view.getState(this.connectionHandler.marker.getCell(a)),null!=b&&(this.connectionHandler.marker.currentColor=this.connectionHandler.marker.validColor,this.connectionHandler.marker.markedState=b,
this.connectionHandler.marker.mark(),this.connectionHandler.first=new mxPoint(a.getGraphX(),a.getGraphY()),this.connectionHandler.edgeState=this.connectionHandler.createEdgeState(a),this.connectionHandler.previous=b,this.connectionHandler.fireEvent(new mxEventObject(mxEvent.START,"state",this.connectionHandler.previous))))};
mxGraph.prototype.scrollPointToVisible=function(a,b,c,d){if(this.timerAutoScroll||!this.ignoreScrollbars&&!mxUtils.hasScrollbars(this.container))this.allowAutoPanning&&!this.panningHandler.isActive()&&(null==this.panningManager&&(this.panningManager=this.createPanningManager()),this.panningManager.panTo(a+this.panDx,b+this.panDy));else{var e=this.container;d=null!=d?d:20;if(a>=e.scrollLeft&&b>=e.scrollTop&&a<=e.scrollLeft+e.clientWidth&&b<=e.scrollTop+e.clientHeight){var f=e.scrollLeft+e.clientWidth-
a;if(f<d){if(a=e.scrollLeft,e.scrollLeft+=d-f,c&&a==e.scrollLeft){if(this.dialect==mxConstants.DIALECT_SVG){a=this.view.getDrawPane().ownerSVGElement;var g=this.container.scrollWidth+d-f}else g=Math.max(e.clientWidth,e.scrollWidth)+d-f,a=this.view.getCanvas();a.style.width=g+"px";e.scrollLeft+=d-f}}else f=a-e.scrollLeft,f<d&&(e.scrollLeft-=d-f);f=e.scrollTop+e.clientHeight-b;f<d?(a=e.scrollTop,e.scrollTop+=d-f,a==e.scrollTop&&c&&(this.dialect==mxConstants.DIALECT_SVG?(a=this.view.getDrawPane().ownerSVGElement,
b=this.container.scrollHeight+d-f):(b=Math.max(e.clientHeight,e.scrollHeight)+d-f,a=this.view.getCanvas()),a.style.height=b+"px",e.scrollTop+=d-f)):(f=b-e.scrollTop,f<d&&(e.scrollTop-=d-f))}}};mxGraph.prototype.createPanningManager=function(){return new mxPanningManager(this)};
mxGraph.prototype.getBorderSizes=function(){function a(a){var b=0,b="thin"==a?2:"medium"==a?4:"thick"==a?6:parseInt(a);isNaN(b)&&(b=0);return b}var b=mxUtils.getCurrentStyle(this.container),c=new mxRectangle;c.x=a(b.borderLeftWidth)+parseInt(b.paddingLeft||0);c.y=a(b.borderTopWidth)+parseInt(b.paddingTop||0);c.width=a(b.borderRightWidth)+parseInt(b.paddingRight||0);c.height=a(b.borderBottomWidth)+parseInt(b.paddingBottom||0);return c};
mxGraph.prototype.getPreferredPageSize=function(a,b,c){a=this.view.scale;var d=this.view.translate,e=this.pageFormat,f=a*this.pageScale,e=new mxRectangle(0,0,e.width*f,e.height*f);b=this.pageBreaksVisible?Math.ceil(b/e.width):1;c=this.pageBreaksVisible?Math.ceil(c/e.height):1;return new mxRectangle(0,0,b*e.width+2+d.x/a,c*e.height+2+d.y/a)};
mxGraph.prototype.sizeDidChange=function(){var a=this.getGraphBounds();if(null!=this.container){var b=this.getBorder(),c=Math.max(0,a.x+a.width+1+b),b=Math.max(0,a.y+a.height+1+b);null!=this.minimumContainerSize&&(c=Math.max(c,this.minimumContainerSize.width),b=Math.max(b,this.minimumContainerSize.height));this.resizeContainer&&this.doResizeContainer(c,b);if(this.preferPageSize||!mxClient.IS_IE&&this.pageVisible){var d=this.getPreferredPageSize(a,c,b);null!=d&&(c=d.width,b=d.height)}null!=this.minimumGraphSize&&
(c=Math.max(c,this.minimumGraphSize.width*this.view.scale),b=Math.max(b,this.minimumGraphSize.height*this.view.scale));c=Math.ceil(c-1);b=Math.ceil(b-1);this.dialect==mxConstants.DIALECT_SVG?(d=this.view.getDrawPane().ownerSVGElement,d.style.minWidth=Math.max(1,c)+"px",d.style.minHeight=Math.max(1,b)+"px",d.style.width="100%",d.style.height="100%"):mxClient.IS_QUIRKS?this.view.updateHtmlCanvasSize(Math.max(1,c),Math.max(1,b)):(this.view.canvas.style.minWidth=Math.max(1,c)+"px",this.view.canvas.style.minHeight=
Math.max(1,b)+"px");this.updatePageBreaks(this.pageBreaksVisible,c-1,b-1)}this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",a))};
mxGraph.prototype.doResizeContainer=function(a,b){if(9<=document.documentMode)a+=3,b+=5;else if(mxClient.IS_IE)if(mxClient.IS_QUIRKS){var c=this.getBorderSizes();a+=Math.max(2,c.x+c.width+1);b+=Math.max(2,c.y+c.height+1)}else a+=1,b+=1;else b+=1;null!=this.maximumContainerSize&&(a=Math.min(this.maximumContainerSize.width,a),b=Math.min(this.maximumContainerSize.height,b));this.container.style.width=Math.ceil(a)+"px";this.container.style.height=Math.ceil(b)+"px"};
mxGraph.prototype.updatePageBreaks=function(a,b,c){var d=this.view.scale,e=this.view.translate,f=this.pageFormat,g=d*this.pageScale,d=new mxRectangle(d*e.x,d*e.y,f.width*g,f.height*g);a=a&&Math.min(d.width,d.height)>this.minPageBreakDist;d.x=mxUtils.mod(d.x,d.width);d.y=mxUtils.mod(d.y,d.height);e=a?Math.ceil((b-d.x)/d.width):0;a=a?Math.ceil((c-d.y)/d.height):0;null==this.horizontalPageBreaks&&0<e&&(this.horizontalPageBreaks=[]);if(null!=this.horizontalPageBreaks){for(f=0;f<=e;f++)g=[new mxPoint(d.x+
f*d.width,1),new mxPoint(d.x+f*d.width,c)],null!=this.horizontalPageBreaks[f]?(this.horizontalPageBreaks[f].points=g,this.horizontalPageBreaks[f].redraw()):(g=new mxPolyline(g,this.pageBreakColor),g.dialect=this.dialect,g.pointerEvents=!1,g.isDashed=this.pageBreakDashed,g.init(this.view.backgroundPane),g.redraw(),this.horizontalPageBreaks[f]=g);for(f=e;f<this.horizontalPageBreaks.length;f++)this.horizontalPageBreaks[f].destroy();this.horizontalPageBreaks.splice(e,this.horizontalPageBreaks.length-
e)}null==this.verticalPageBreaks&&0<a&&(this.verticalPageBreaks=[]);if(null!=this.verticalPageBreaks){for(f=0;f<=a;f++)g=[new mxPoint(1,d.y+f*d.height),new mxPoint(b,d.y+f*d.height)],null!=this.verticalPageBreaks[f]?(this.verticalPageBreaks[f].points=g,this.verticalPageBreaks[f].redraw()):(g=new mxPolyline(g,this.pageBreakColor),g.dialect=this.dialect,g.pointerEvents=!1,g.isDashed=this.pageBreakDashed,g.init(this.view.backgroundPane),g.redraw(),this.verticalPageBreaks[f]=g);for(f=a;f<this.verticalPageBreaks.length;f++)this.verticalPageBreaks[f].destroy();
this.verticalPageBreaks.splice(a,this.verticalPageBreaks.length-a)}};mxGraph.prototype.getCellStyle=function(a){var b=this.model.getStyle(a),c=null,c=this.model.isEdge(a)?this.stylesheet.getDefaultEdgeStyle():this.stylesheet.getDefaultVertexStyle();null!=b&&(c=this.postProcessCellStyle(this.stylesheet.getCellStyle(b,c)));null==c&&(c=mxGraph.prototype.EMPTY_ARRAY);return c};
mxGraph.prototype.postProcessCellStyle=function(a){if(null!=a){var b=a[mxConstants.STYLE_IMAGE],c=this.getImageFromBundles(b);null!=c?a[mxConstants.STYLE_IMAGE]=c:c=b;null!=c&&"data:image/"==c.substring(0,11)&&("data:image/svg+xml,<"==c.substring(0,20)?c=c.substring(0,19)+encodeURIComponent(c.substring(19)):"data:image/svg+xml,%3C"!=c.substring(0,22)&&(b=c.indexOf(","),0<b&&(c=c.substring(0,b)+";base64,"+c.substring(b+1))),a[mxConstants.STYLE_IMAGE]=c)}return a};
mxGraph.prototype.setCellStyle=function(a,b){b=b||this.getSelectionCells();if(null!=b){this.model.beginUpdate();try{for(var c=0;c<b.length;c++)this.model.setStyle(b[c],a)}finally{this.model.endUpdate()}}};mxGraph.prototype.toggleCellStyle=function(a,b,c){c=c||this.getSelectionCell();return this.toggleCellStyles(a,b,[c])};
mxGraph.prototype.toggleCellStyles=function(a,b,c){b=null!=b?b:!1;c=c||this.getSelectionCells();var d=null;if(null!=c&&0<c.length){var e=this.view.getState(c[0]),e=null!=e?e.style:this.getCellStyle(c[0]);null!=e&&(d=mxUtils.getValue(e,a,b)?0:1,this.setCellStyles(a,d,c))}return d};mxGraph.prototype.setCellStyles=function(a,b,c){c=c||this.getSelectionCells();mxUtils.setCellStyles(this.model,c,a,b)};mxGraph.prototype.toggleCellStyleFlags=function(a,b,c){this.setCellStyleFlags(a,b,null,c)};
mxGraph.prototype.setCellStyleFlags=function(a,b,c,d){d=d||this.getSelectionCells();if(null!=d&&0<d.length){if(null==c){var e=this.view.getState(d[0]),e=null!=e?e.style:this.getCellStyle(d[0]);null!=e&&(c=(parseInt(e[a]||0)&b)!=b)}mxUtils.setCellStyleFlags(this.model,d,a,b,c)}};
mxGraph.prototype.alignCells=function(a,b,c){null==b&&(b=this.getSelectionCells());if(null!=b&&1<b.length){if(null==c)for(var d=0;d<b.length;d++){var e=this.view.getState(b[d]);if(null!=e&&!this.model.isEdge(b[d]))if(null==c)if(a==mxConstants.ALIGN_CENTER){c=e.x+e.width/2;break}else if(a==mxConstants.ALIGN_RIGHT)c=e.x+e.width;else if(a==mxConstants.ALIGN_TOP)c=e.y;else if(a==mxConstants.ALIGN_MIDDLE){c=e.y+e.height/2;break}else c=a==mxConstants.ALIGN_BOTTOM?e.y+e.height:e.x;else c=a==mxConstants.ALIGN_RIGHT?
Math.max(c,e.x+e.width):a==mxConstants.ALIGN_TOP?Math.min(c,e.y):a==mxConstants.ALIGN_BOTTOM?Math.max(c,e.y+e.height):Math.min(c,e.x)}if(null!=c){var f=this.view.scale;this.model.beginUpdate();try{for(d=0;d<b.length;d++)if(e=this.view.getState(b[d]),null!=e){var g=this.getCellGeometry(b[d]);null!=g&&!this.model.isEdge(b[d])&&(g=g.clone(),a==mxConstants.ALIGN_CENTER?g.x+=(c-e.x-e.width/2)/f:a==mxConstants.ALIGN_RIGHT?g.x+=(c-e.x-e.width)/f:a==mxConstants.ALIGN_TOP?g.y+=(c-e.y)/f:a==mxConstants.ALIGN_MIDDLE?
g.y+=(c-e.y-e.height/2)/f:a==mxConstants.ALIGN_BOTTOM?g.y+=(c-e.y-e.height)/f:g.x+=(c-e.x)/f,this.resizeCell(b[d],g))}this.fireEvent(new mxEventObject(mxEvent.ALIGN_CELLS,"align",a,"cells",b))}finally{this.model.endUpdate()}}}return b};
mxGraph.prototype.flipEdge=function(a){if(null!=a&&null!=this.alternateEdgeStyle){this.model.beginUpdate();try{var b=this.model.getStyle(a);null==b||0==b.length?this.model.setStyle(a,this.alternateEdgeStyle):this.model.setStyle(a,null);this.resetEdge(a);this.fireEvent(new mxEventObject(mxEvent.FLIP_EDGE,"edge",a))}finally{this.model.endUpdate()}}return a};mxGraph.prototype.addImageBundle=function(a){this.imageBundles.push(a)};
mxGraph.prototype.removeImageBundle=function(a){for(var b=[],c=0;c<this.imageBundles.length;c++)this.imageBundles[c]!=a&&b.push(this.imageBundles[c]);this.imageBundles=b};mxGraph.prototype.getImageFromBundles=function(a){if(null!=a)for(var b=0;b<this.imageBundles.length;b++){var c=this.imageBundles[b].getImage(a);if(null!=c)return c}return null};
mxGraph.prototype.orderCells=function(a,b){null==b&&(b=mxUtils.sortCells(this.getSelectionCells(),!0));this.model.beginUpdate();try{this.cellsOrdered(b,a),this.fireEvent(new mxEventObject(mxEvent.ORDER_CELLS,"back",a,"cells",b))}finally{this.model.endUpdate()}return b};
mxGraph.prototype.cellsOrdered=function(a,b){if(null!=a){this.model.beginUpdate();try{for(var c=0;c<a.length;c++){var d=this.model.getParent(a[c]);b?this.model.add(d,a[c],c):this.model.add(d,a[c],this.model.getChildCount(d)-1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ORDERED,"back",b,"cells",a))}finally{this.model.endUpdate()}}};
mxGraph.prototype.groupCells=function(a,b,c){null==c&&(c=mxUtils.sortCells(this.getSelectionCells(),!0));c=this.getCellsForGroup(c);null==a&&(a=this.createGroupCell(c));var d=this.getBoundsForGroup(a,c,b);if(0<c.length&&null!=d){var e=this.model.getParent(a);null==e&&(e=this.model.getParent(c[0]));this.model.beginUpdate();try{null==this.getCellGeometry(a)&&this.model.setGeometry(a,new mxGeometry);var f=this.model.getChildCount(e);this.cellsAdded([a],e,f,null,null,!1);f=this.model.getChildCount(a);
this.cellsAdded(c,a,f,null,null,!1,!1);this.cellsMoved(c,-d.x,-d.y,!1,!0);this.cellsResized([a],[d],!1);this.fireEvent(new mxEventObject(mxEvent.GROUP_CELLS,"group",a,"border",b,"cells",c))}finally{this.model.endUpdate()}}return a};mxGraph.prototype.getCellsForGroup=function(a){var b=[];if(null!=a&&0<a.length){var c=this.model.getParent(a[0]);b.push(a[0]);for(var d=1;d<a.length;d++)this.model.getParent(a[d])==c&&b.push(a[d])}return b};
mxGraph.prototype.getBoundsForGroup=function(a,b,c){b=this.getBoundingBoxFromGeometry(b,!0);null!=b&&(this.isSwimlane(a)&&(a=this.getStartSize(a),b.x-=a.width,b.y-=a.height,b.width+=a.width,b.height+=a.height),null!=c&&(b.x-=c,b.y-=c,b.width+=2*c,b.height+=2*c));return b};mxGraph.prototype.createGroupCell=function(a){a=new mxCell("");a.setVertex(!0);a.setConnectable(!1);return a};
mxGraph.prototype.ungroupCells=function(a){var b=[];if(null==a){a=this.getSelectionCells();for(var c=[],d=0;d<a.length;d++)0<this.model.getChildCount(a[d])&&c.push(a[d]);a=c}if(null!=a&&0<a.length){this.model.beginUpdate();try{for(d=0;d<a.length;d++){var e=this.model.getChildren(a[d]);if(null!=e&&0<e.length){var e=e.slice(),f=this.model.getParent(a[d]),g=this.model.getChildCount(f);this.cellsAdded(e,f,g,null,null,!0);b=b.concat(e)}}this.cellsRemoved(this.addAllEdges(a));this.fireEvent(new mxEventObject(mxEvent.UNGROUP_CELLS,
"cells",a))}finally{this.model.endUpdate()}}return b};mxGraph.prototype.removeCellsFromParent=function(a){null==a&&(a=this.getSelectionCells());this.model.beginUpdate();try{var b=this.getDefaultParent(),c=this.model.getChildCount(b);this.cellsAdded(a,b,c,null,null,!0);this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS_FROM_PARENT,"cells",a))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.updateGroupBounds=function(a,b,c,d,e,f,g){null==a&&(a=this.getSelectionCells());b=null!=b?b:0;c=null!=c?c:!1;d=null!=d?d:0;e=null!=e?e:0;f=null!=f?f:0;g=null!=g?g:0;this.model.beginUpdate();try{for(var k=a.length-1;0<=k;k--){var l=this.getCellGeometry(a[k]);if(null!=l){var m=this.getChildCells(a[k]);if(null!=m&&0<m.length){var n=this.getBoundingBoxFromGeometry(m,!0);if(null!=n&&0<n.width&&0<n.height){var p=0,q=0;if(this.isSwimlane(a[k]))var u=this.getStartSize(a[k]),p=u.width,q=
u.height;l=l.clone();c&&(l.x=l.x+n.x-b-p-g,l.y=l.y+n.y-b-q-d);l.width=n.width+2*b+p+g+e;l.height=n.height+2*b+q+d+f;this.model.setGeometry(a[k],l);this.moveCells(m,b+p-n.x+g,b+q-n.y+d)}}}}}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cloneCells=function(a,b){b=null!=b?b:!0;var c=null;if(null!=a){for(var d={},c=[],e=0;e<a.length;e++){var f=mxCellPath.create(a[e]);d[f]=a[e];c.push(a[e])}if(0<c.length)for(var f=this.view.scale,g=this.view.translate,c=this.model.cloneCells(a,!0),e=0;e<a.length;e++)if(!b&&this.model.isEdge(c[e])&&null!=this.getEdgeValidationError(c[e],this.model.getTerminal(c[e],!0),this.model.getTerminal(c[e],!1)))c[e]=null;else{var k=this.model.getGeometry(c[e]);if(null!=k){var l=this.view.getState(a[e]),
m=this.view.getState(this.model.getParent(a[e]));if(null!=l&&null!=m){var n=m.origin.x,m=m.origin.y;if(this.model.isEdge(c[e])){for(var l=l.absolutePoints,p=this.model.getTerminal(a[e],!0),q=mxCellPath.create(p);null!=p&&null==d[q];)p=this.model.getParent(p),q=mxCellPath.create(p);null==p&&k.setTerminalPoint(new mxPoint(l[0].x/f-g.x,l[0].y/f-g.y),!0);p=this.model.getTerminal(a[e],!1);for(q=mxCellPath.create(p);null!=p&&null==d[q];)p=this.model.getParent(p),q=mxCellPath.create(p);null==p&&(p=l.length-
1,k.setTerminalPoint(new mxPoint(l[p].x/f-g.x,l[p].y/f-g.y),!1));k=k.points;if(null!=k)for(l=0;l<k.length;l++)k[l].x+=n,k[l].y+=m}else k.translate(n,m)}}}else c=[]}return c};mxGraph.prototype.insertVertex=function(a,b,c,d,e,f,g,k,l){b=this.createVertex(a,b,c,d,e,f,g,k,l);return this.addCell(b,a)};mxGraph.prototype.createVertex=function(a,b,c,d,e,f,g,k,l){a=new mxGeometry(d,e,f,g);a.relative=null!=l?l:!1;c=new mxCell(c,a,k);c.setId(b);c.setVertex(!0);c.setConnectable(!0);return c};
mxGraph.prototype.insertEdge=function(a,b,c,d,e,f){b=this.createEdge(a,b,c,d,e,f);return this.addEdge(b,a,d,e)};mxGraph.prototype.createEdge=function(a,b,c,d,e,f){a=new mxCell(c,new mxGeometry,f);a.setId(b);a.setEdge(!0);a.geometry.relative=!0;return a};mxGraph.prototype.addEdge=function(a,b,c,d,e){return this.addCell(a,b,e,c,d)};mxGraph.prototype.addCell=function(a,b,c,d,e){return this.addCells([a],b,c,d,e)[0]};
mxGraph.prototype.addCells=function(a,b,c,d,e){null==b&&(b=this.getDefaultParent());null==c&&(c=this.model.getChildCount(b));this.model.beginUpdate();try{this.cellsAdded(a,b,c,d,e,!1,!0),this.fireEvent(new mxEventObject(mxEvent.ADD_CELLS,"cells",a,"parent",b,"index",c,"source",d,"target",e))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellsAdded=function(a,b,c,d,e,f,g){if(null!=a&&null!=b&&null!=c){this.model.beginUpdate();try{for(var k=f?this.view.getState(b):null,l=null!=k?k.origin:null,m=new mxPoint(0,0),k=0;k<a.length;k++)if(null==a[k])c--;else{var n=this.model.getParent(a[k]);if(null!=l&&a[k]!=b&&b!=n){var p=this.view.getState(n),q=null!=p?p.origin:m,u=this.model.getGeometry(a[k]);if(null!=u){var v=q.x-l.x,y=q.y-l.y,u=u.clone();u.translate(v,y);!u.relative&&this.model.isVertex(a[k])&&!this.isAllowNegativeCoordinates()&&
(u.x=Math.max(0,u.x),u.y=Math.max(0,u.y));this.model.setGeometry(a[k],u)}}b==n&&c+k>this.model.getChildCount(b)&&c--;this.model.add(b,a[k],c+k);this.autoSizeCellsOnAdd&&this.autoSizeCell(a[k],!0);this.isExtendParentsOnAdd(a[k])&&this.isExtendParent(a[k])&&this.extendParent(a[k]);(null==g||g)&&this.constrainChild(a[k]);null!=d&&this.cellConnected(a[k],d,!0);null!=e&&this.cellConnected(a[k],e,!1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ADDED,"cells",a,"parent",b,"index",c,"source",d,"target",
e,"absolute",f))}finally{this.model.endUpdate()}}};mxGraph.prototype.autoSizeCell=function(a,b){if(null!=b?b:1)for(var c=this.model.getChildCount(a),d=0;d<c;d++)this.autoSizeCell(this.model.getChildAt(a,d));this.getModel().isVertex(a)&&this.isAutoSizeCell(a)&&this.updateCellSize(a)};
mxGraph.prototype.removeCells=function(a,b){b=null!=b?b:!0;null==a&&(a=this.getDeletableCells(this.getSelectionCells()));b&&(a=this.getDeletableCells(this.addAllEdges(a)));this.model.beginUpdate();try{this.cellsRemoved(a),this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS,"cells",a,"includeEdges",b))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellsRemoved=function(a){if(null!=a&&0<a.length){var b=this.view.scale,c=this.view.translate;this.model.beginUpdate();try{for(var d={},e=0;e<a.length;e++){var f=mxCellPath.create(a[e]);d[f]=a[e]}for(e=0;e<a.length;e++){for(var g=this.getConnections(a[e]),k=0;k<g.length;k++)if(f=mxCellPath.create(g[k]),null==d[f]){var l=this.model.getGeometry(g[k]);if(null!=l){var m=this.view.getState(g[k]);if(null!=m){var l=l.clone(),n=m.getVisibleTerminal(!0)==a[e],p=m.absolutePoints,q=n?0:p.length-
1;l.setTerminalPoint(new mxPoint(p[q].x/b-c.x,p[q].y/b-c.y),n);this.model.setTerminal(g[k],null,n);this.model.setGeometry(g[k],l)}}}this.model.remove(a[e])}this.fireEvent(new mxEventObject(mxEvent.CELLS_REMOVED,"cells",a))}finally{this.model.endUpdate()}}};
mxGraph.prototype.splitEdge=function(a,b,c,d,e){d=d||0;e=e||0;null==c&&(c=this.cloneCells([a])[0]);var f=this.model.getParent(a),g=this.model.getTerminal(a,!0);this.model.beginUpdate();try{this.cellsMoved(b,d,e,!1,!1),this.cellsAdded(b,f,this.model.getChildCount(f),null,null,!0),this.cellsAdded([c],f,this.model.getChildCount(f),g,b[0],!1),this.cellConnected(a,b[0],!0),this.fireEvent(new mxEventObject(mxEvent.SPLIT_EDGE,"edge",a,"cells",b,"newEdge",c,"dx",d,"dy",e))}finally{this.model.endUpdate()}return c};
mxGraph.prototype.toggleCells=function(a,b,c){null==b&&(b=this.getSelectionCells());c&&(b=this.addAllEdges(b));this.model.beginUpdate();try{this.cellsToggled(b,a),this.fireEvent(new mxEventObject(mxEvent.TOGGLE_CELLS,"show",a,"cells",b,"includeEdges",c))}finally{this.model.endUpdate()}return b};mxGraph.prototype.cellsToggled=function(a,b){if(null!=a&&0<a.length){this.model.beginUpdate();try{for(var c=0;c<a.length;c++)this.model.setVisible(a[c],b)}finally{this.model.endUpdate()}}};
mxGraph.prototype.foldCells=function(a,b,c,d,e){b=null!=b?b:!1;null==c&&(c=this.getFoldableCells(this.getSelectionCells(),a));this.stopEditing(!1);this.model.beginUpdate();try{this.cellsFolded(c,a,b,d),this.fireEvent(new mxEventObject(mxEvent.FOLD_CELLS,"collapse",a,"recurse",b,"cells",c))}finally{this.model.endUpdate()}return c};
mxGraph.prototype.cellsFolded=function(a,b,c,d){if(null!=a&&0<a.length){this.model.beginUpdate();try{for(var e=0;e<a.length;e++)if((!d||this.isCellFoldable(a[e],b))&&b!=this.isCellCollapsed(a[e])){this.model.setCollapsed(a[e],b);this.swapBounds(a[e],b);this.isExtendParent(a[e])&&this.extendParent(a[e]);if(c){var f=this.model.getChildren(a[e]);this.foldCells(f,b,c)}this.isConstrainChildrenOnResize()&&this.constrainChild(a[e])}this.fireEvent(new mxEventObject(mxEvent.CELLS_FOLDED,"cells",a,"collapse",
b,"recurse",c))}finally{this.model.endUpdate()}}};mxGraph.prototype.swapBounds=function(a,b){if(null!=a){var c=this.model.getGeometry(a);null!=c&&(c=c.clone(),this.updateAlternateBounds(a,c,b),c.swap(),this.model.setGeometry(a,c))}};
mxGraph.prototype.updateAlternateBounds=function(a,b,c){if(null!=a&&null!=b){c=this.view.getState(a);c=null!=c?c.style:this.getCellStyle(a);if(null==b.alternateBounds){var d=b;this.collapseToPreferredSize&&(a=this.getPreferredSizeForCell(a),null!=a&&(d=a,a=mxUtils.getValue(c,mxConstants.STYLE_STARTSIZE),0<a&&(d.height=Math.max(d.height,a))));b.alternateBounds=new mxRectangle(0,0,d.width,d.height)}if(null!=b.alternateBounds){b.alternateBounds.x=b.x;b.alternateBounds.y=b.y;var e=mxUtils.toRadians(c[mxConstants.STYLE_ROTATION]||
0);0!=e&&(a=b.alternateBounds.getCenterX()-b.getCenterX(),c=b.alternateBounds.getCenterY()-b.getCenterY(),d=Math.cos(e),e=Math.sin(e),b.alternateBounds.x+=d*a-e*c-a,b.alternateBounds.y+=e*a+d*c-c)}}};mxGraph.prototype.addAllEdges=function(a){return a.slice().concat(this.getAllEdges(a))};mxGraph.prototype.getAllEdges=function(a){var b=[];if(null!=a)for(var c=0;c<a.length;c++){for(var d=this.model.getEdgeCount(a[c]),e=0;e<d;e++)b.push(this.model.getEdgeAt(a[c],e));d=this.model.getChildren(a[c]);b=b.concat(this.getAllEdges(d))}return b};
mxGraph.prototype.updateCellSize=function(a,b){b=null!=b?b:!1;this.model.beginUpdate();try{this.cellSizeUpdated(a,b),this.fireEvent(new mxEventObject(mxEvent.UPDATE_CELL_SIZE,"cell",a,"ignoreChildren",b))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellSizeUpdated=function(a,b){if(null!=a){this.model.beginUpdate();try{var c=this.getPreferredSizeForCell(a),d=this.model.getGeometry(a);if(null!=c&&null!=d){var e=this.isCellCollapsed(a),d=d.clone();if(this.isSwimlane(a)){var f=this.view.getState(a),g=null!=f?f.style:this.getCellStyle(a),k=this.model.getStyle(a);null==k&&(k="");mxUtils.getValue(g,mxConstants.STYLE_HORIZONTAL,!0)?(k=mxUtils.setStyle(k,mxConstants.STYLE_STARTSIZE,c.height+8),e&&(d.height=c.height+8),d.width=c.width):
(k=mxUtils.setStyle(k,mxConstants.STYLE_STARTSIZE,c.width+8),e&&(d.width=c.width+8),d.height=c.height);this.model.setStyle(a,k)}else d.width=c.width,d.height=c.height;if(!b&&!e){var l=this.view.getBounds(this.model.getChildren(a));if(null!=l){var m=this.view.translate,n=this.view.scale,p=(l.y+l.height)/n-d.y-m.y;d.width=Math.max(d.width,(l.x+l.width)/n-d.x-m.x);d.height=Math.max(d.height,p)}}this.cellsResized([a],[d],!1)}}finally{this.model.endUpdate()}}};
mxGraph.prototype.getPreferredSizeForCell=function(a){var b=null;if(null!=a){var c=this.view.getState(a)||this.view.createState(a),d=c.style;if(!this.model.isEdge(a)){var e=d[mxConstants.STYLE_FONTSIZE]||mxConstants.DEFAULT_FONTSIZE;a=b=0;null==this.getImage(c)&&null==d[mxConstants.STYLE_IMAGE]||d[mxConstants.STYLE_SHAPE]!=mxConstants.SHAPE_LABEL||(d[mxConstants.STYLE_VERTICAL_ALIGN]==mxConstants.ALIGN_MIDDLE&&(b+=parseFloat(d[mxConstants.STYLE_IMAGE_WIDTH])||mxLabel.prototype.imageSize),d[mxConstants.STYLE_ALIGN]!=
mxConstants.ALIGN_CENTER&&(a+=parseFloat(d[mxConstants.STYLE_IMAGE_HEIGHT])||mxLabel.prototype.imageSize));b+=2*(d[mxConstants.STYLE_SPACING]||0);b+=d[mxConstants.STYLE_SPACING_LEFT]||0;b+=d[mxConstants.STYLE_SPACING_RIGHT]||0;a+=2*(d[mxConstants.STYLE_SPACING]||0);a+=d[mxConstants.STYLE_SPACING_TOP]||0;a+=d[mxConstants.STYLE_SPACING_BOTTOM]||0;var f=this.getFoldingImage(c);null!=f&&(b+=f.width+8);f=this.cellRenderer.getLabelValue(c);null!=f&&0<f.length?(this.isHtmlLabel(c.cell)||(f=mxUtils.htmlEntities(f)),
f=f.replace(/\n/g,"<br>"),e=mxUtils.getSizeForString(f,e,d[mxConstants.STYLE_FONTFAMILY]),c=e.width+b,a=e.height+a,mxUtils.getValue(d,mxConstants.STYLE_HORIZONTAL,!0)||(d=a,a=c,c=d),this.gridEnabled&&(c=this.snap(c+this.gridSize/2),a=this.snap(a+this.gridSize/2)),b=new mxRectangle(0,0,c,a)):(d=4*this.gridSize,b=new mxRectangle(0,0,d,d))}}return b};mxGraph.prototype.resizeCell=function(a,b,c){return this.resizeCells([a],[b],c)[0]};
mxGraph.prototype.resizeCells=function(a,b,c){c=null!=c?c:this.isRecursiveResize();this.model.beginUpdate();try{this.cellsResized(a,b,c),this.fireEvent(new mxEventObject(mxEvent.RESIZE_CELLS,"cells",a,"bounds",b))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellsResized=function(a,b,c){c=null!=c?c:!1;if(null!=a&&null!=b&&a.length==b.length){this.model.beginUpdate();try{for(var d=0;d<a.length;d++)this.cellResized(a[d],b[d],!1,c),this.isExtendParent(a[d])&&this.extendParent(a[d]),this.isConstrainChildrenOnResize()&&this.constrainChild(a[d]);this.resetEdgesOnResize&&this.resetEdges(a);this.fireEvent(new mxEventObject(mxEvent.CELLS_RESIZED,"cells",a,"bounds",b))}finally{this.model.endUpdate()}}};
mxGraph.prototype.cellResized=function(a,b,c,d){var e=this.model.getGeometry(a);if(null!=e&&(e.x!=b.x||e.y!=b.y||e.width!=b.width||e.height!=b.height)){e=e.clone();!c&&e.relative?(c=e.offset,null!=c&&(c.x+=b.x-e.x,c.y+=b.y-e.y)):(e.x=b.x,e.y=b.y);e.width=b.width;e.height=b.height;!e.relative&&this.model.isVertex(a)&&!this.isAllowNegativeCoordinates()&&(e.x=Math.max(0,e.x),e.y=Math.max(0,e.y));this.model.beginUpdate();try{d&&this.resizeChildCells(a,e),this.model.setGeometry(a,e),this.isConstrainChildrenOnResize()&&
this.constrainChildCells(a)}finally{this.model.endUpdate()}}};mxGraph.prototype.resizeChildCells=function(a,b){for(var c=this.model.getGeometry(a),d=b.width/c.width,c=b.height/c.height,e=this.model.getChildCount(a),f=0;f<e;f++)this.scaleCell(this.model.getChildAt(a,f),d,c,!0)};mxGraph.prototype.constrainChildCells=function(a){for(var b=this.model.getChildCount(a),c=0;c<b;c++)this.constrainChild(this.model.getChildAt(a,c))};
mxGraph.prototype.scaleCell=function(a,b,c,d){var e=this.model.getGeometry(a);if(null!=e&&this.isCellMovable(a)&&this.isCellResizable(a)){var f=this.view.getState(a);null!=f||this.getCellStyle(a);e=e.clone();e.scale(b,c,"fixed"==f.style[mxConstants.STYLE_ASPECT]);this.model.isVertex(a)?this.cellResized(a,e,!0,d):this.model.setGeometry(a,e)}};
mxGraph.prototype.extendParent=function(a){if(null!=a){var b=this.model.getParent(a),c=this.getCellGeometry(b);null==b||null==c||this.isCellCollapsed(b)||(a=this.getCellGeometry(a),null==a||a.relative||!(c.width<a.x+a.width||c.height<a.y+a.height))||(c=c.clone(),c.width=Math.max(c.width,a.x+a.width),c.height=Math.max(c.height,a.y+a.height),this.cellsResized([b],[c],!1))}};mxGraph.prototype.importCells=function(a,b,c,d,e){return this.moveCells(a,b,c,!0,d,e)};
mxGraph.prototype.moveCells=function(a,b,c,d,e,f){b=null!=b?b:0;c=null!=c?c:0;d=null!=d?d:!1;if(null!=a&&(0!=b||0!=c||d||null!=e)){this.model.beginUpdate();try{d&&(a=this.cloneCells(a,this.isCloneInvalidEdges()),null==e&&(e=this.getDefaultParent()));var g=this.isAllowNegativeCoordinates();null!=e&&this.setAllowNegativeCoordinates(!0);this.cellsMoved(a,b,c,!d&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),null==e,this.isExtendParentsOnMove()&&null==e);this.setAllowNegativeCoordinates(g);if(null!=
e){var k=this.model.getChildCount(e);this.cellsAdded(a,e,k,null,null,!0)}this.fireEvent(new mxEventObject(mxEvent.MOVE_CELLS,"cells",a,"dx",b,"dy",c,"clone",d,"target",e,"event",f))}finally{this.model.endUpdate()}}return a};
mxGraph.prototype.cellsMoved=function(a,b,c,d,e,f){if(null!=a&&(0!=b||0!=c)){f=null!=f?f:!1;a=this.model.getTopmostCells(a);this.model.beginUpdate();try{d&&this.disconnectGraph(a);for(var g=0;g<a.length;g++)this.translateCell(a[g],b,c),f&&this.isExtendParent(a[g])?this.extendParent(a[g]):e&&this.constrainChild(a[g]);this.resetEdgesOnMove&&this.resetEdges(a);this.fireEvent(new mxEventObject(mxEvent.CELLS_MOVED,"cells",a,"dx",b,"dy",c,"disconnect",d))}finally{this.model.endUpdate()}}};
mxGraph.prototype.translateCell=function(a,b,c){var d=this.model.getGeometry(a);if(null!=d){b=parseFloat(b);c=parseFloat(c);d=d.clone();d.translate(b,c);!d.relative&&this.model.isVertex(a)&&!this.isAllowNegativeCoordinates()&&(d.x=Math.max(0,parseFloat(d.x)),d.y=Math.max(0,parseFloat(d.y)));if(d.relative&&!this.model.isEdge(a)){var e=this.model.getParent(a),f=0;this.model.isVertex(e)&&(f=this.view.getState(e),e=null!=f?f.style:this.getCellStyle(e),f=mxUtils.getValue(e,mxConstants.STYLE_ROTATION,0));
0!=f&&(f=mxUtils.toRadians(-f),e=Math.cos(f),f=Math.sin(f),c=mxUtils.getRotatedPoint(new mxPoint(b,c),e,f,new mxPoint(0,0)),b=c.x,c=c.y);null==d.offset?d.offset=new mxPoint(b,c):(d.offset.x=parseFloat(d.offset.x)+b,d.offset.y=parseFloat(d.offset.y)+c)}this.model.setGeometry(a,d)}};
mxGraph.prototype.getCellContainmentArea=function(a){if(null!=a&&!this.model.isEdge(a)){var b=this.model.getParent(a);if(b==this.getDefaultParent()||b==this.getCurrentRoot())return this.getMaximumGraphBounds();if(null!=b&&b!=this.getDefaultParent()){var c=this.model.getGeometry(b);if(null!=c){var d=a=0,e=c.width,c=c.height;if(this.isSwimlane(b)){var f=this.getStartSize(b),g=this.view.getState(b),k=null!=g?g.style:this.getCellStyle(b),b=mxUtils.getValue(k,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_EAST),
g=1==mxUtils.getValue(k,mxConstants.STYLE_FLIPH,0),k=1==mxUtils.getValue(k,mxConstants.STYLE_FLIPV,0);if(b==mxConstants.DIRECTION_SOUTH||b==mxConstants.DIRECTION_NORTH){var l=f.width;f.width=f.height;f.height=l}if(b==mxConstants.DIRECTION_EAST&&!k||b==mxConstants.DIRECTION_NORTH&&!g||b==mxConstants.DIRECTION_WEST&&k||b==mxConstants.DIRECTION_SOUTH&&g)a=f.width,d=f.height;e-=f.width;c-=f.height}return new mxRectangle(a,d,e,c)}}}return null};mxGraph.prototype.getMaximumGraphBounds=function(){return this.maximumGraphBounds};
mxGraph.prototype.constrainChild=function(a){if(null!=a){var b=this.getCellGeometry(a),c=this.getMaximumGraphBounds(),d=this.isConstrainChild(a)?this.getCellContainmentArea(a):c;if(null!=b&&!b.relative&&null!=d){var e=[a];if(!this.isCellCollapsed(a))for(var f=this.model.getDescendants(a),g=0;g<f.length;g++)this.isCellVisible(f[g])&&e.push(f[g]);e=this.getBoundingBoxFromGeometry(e,!1);if(null!=e){f=d==c?0:this.getOverlap(a);g=d==c;if(null!=c){for(var c=mxRectangle.fromRectangle(c),k=this.model.getParent(a);this.model.isVertex(k);){var l=
this.getCellGeometry(k);null!=l&&(c.x-=l.x,c.y-=l.y);k=this.model.getParent(k)}g&&(d=c)}k=d.x-e.width*f;g=d.y-e.height*f;l=d.x+d.width+e.width*f;f=d.y+d.height+e.height*f;d!=c&&null!=c&&(k=Math.max(k,c.x),g=Math.max(g,c.y));if(e.x<k||e.x+e.width>l||e.y<g||e.y+e.height>f)b=b.clone(),e.x<k?(c=k-e.x,b.x+=c):0<d.width&&e.x+e.width>l&&(c=e.x+e.width-l,b.x-=c),e.y<g?(c=g-e.y,b.y+=c):0<d.height&&e.y+e.height>f&&(c=e.y+e.height-f,b.y-=c),b.width=Math.min(b.width,d.width+b.width-e.width),b.height=Math.min(b.height,
d.height+b.height-e.height),this.model.setGeometry(a,b)}}}};
mxGraph.prototype.resetEdges=function(a){if(null!=a){for(var b={},c=0;c<a.length;c++){var d=mxCellPath.create(a[c]);b[d]=a[c]}this.model.beginUpdate();try{for(c=0;c<a.length;c++){var e=this.model.getEdges(a[c]);if(null!=e)for(d=0;d<e.length;d++){var f=this.view.getState(e[d]),g=null!=f?f.getVisibleTerminal(!0):this.view.getVisibleTerminal(e[d],!0),k=null!=f?f.getVisibleTerminal(!1):this.view.getVisibleTerminal(e[d],!1),l=mxCellPath.create(g),m=mxCellPath.create(k);null!=b[l]&&null!=b[m]||this.resetEdge(e[d])}this.resetEdges(this.model.getChildren(a[c]))}}finally{this.model.endUpdate()}}};
mxGraph.prototype.resetEdge=function(a){var b=this.model.getGeometry(a);null!=b&&null!=b.points&&0<b.points.length&&(b=b.clone(),b.points=[],this.model.setGeometry(a,b));return a};
mxGraph.prototype.getOutlineConstraint=function(a,b,c){if(null!=b.shape){c=this.view.getPerimeterBounds(b);var d=b.style[mxConstants.STYLE_DIRECTION];if(d==mxConstants.DIRECTION_NORTH||d==mxConstants.DIRECTION_SOUTH){c.x+=c.width/2-c.height/2;c.y+=c.height/2-c.width/2;var e=c.width;c.width=c.height;c.height=e}var f=mxUtils.toRadians(b.shape.getShapeRotation());if(0!=f){var e=Math.cos(-f),f=Math.sin(-f),g=new mxPoint(c.getCenterX(),c.getCenterY());a=mxUtils.getRotatedPoint(a,e,f,g)}var g=f=1,k=0,l=
0;if(this.getModel().isVertex(b.cell)){var m=b.style[mxConstants.STYLE_FLIPH],n=b.style[mxConstants.STYLE_FLIPV];null!=b.shape&&null!=b.shape.stencil&&(m=1==mxUtils.getValue(b.style,"stencilFlipH",0)||m,n=1==mxUtils.getValue(b.style,"stencilFlipV",0)||n);if(d==mxConstants.DIRECTION_NORTH||d==mxConstants.DIRECTION_SOUTH)e=m,m=n,n=e;m&&(f=-1,k=-c.width);n&&(g=-1,l=-c.height)}a=new mxPoint((a.x-c.x)*f-k+c.x,(a.y-c.y)*g-l+c.y);b=Math.round(1E3*(a.x-c.x)/c.width)/1E3;a=Math.round(1E3*(a.y-c.y)/c.height)/
1E3;return new mxConnectionConstraint(new mxPoint(b,a),!1)}return null};mxGraph.prototype.getAllConnectionConstraints=function(a,b){return null!=a&&null!=a.shape&&null!=a.shape.stencil?a.shape.stencil.constraints:null};
mxGraph.prototype.getConnectionConstraint=function(a,b,c){b=null;var d=a.style[c?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X];if(null!=d){var e=a.style[c?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y];null!=e&&(b=new mxPoint(parseFloat(d),parseFloat(e)))}d=!1;null!=b&&(d=mxUtils.getValue(a.style,c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,!0));return new mxConnectionConstraint(b,d)};
mxGraph.prototype.setConnectionConstraint=function(a,b,c,d){if(null!=d){this.model.beginUpdate();try{null==d||null==d.point?(this.setCellStyles(c?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,null,[a]),this.setCellStyles(c?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,null,[a]),this.setCellStyles(c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[a])):null!=d.point&&(this.setCellStyles(c?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,d.point.x,[a]),this.setCellStyles(c?
mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,d.point.y,[a]),d.perimeter?this.setCellStyles(c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[a]):this.setCellStyles(c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,"0",[a]))}finally{this.model.endUpdate()}}};
mxGraph.prototype.getConnectionPoint=function(a,b){var c=null;if(null!=a&&null!=b.point){var d=this.view.getPerimeterBounds(a),e=new mxPoint(d.getCenterX(),d.getCenterY()),f=a.style[mxConstants.STYLE_DIRECTION],g=0;null==f||(f==mxConstants.DIRECTION_NORTH?g+=270:f==mxConstants.DIRECTION_WEST?g+=180:f==mxConstants.DIRECTION_SOUTH&&(g+=90),f!=mxConstants.DIRECTION_NORTH&&f!=mxConstants.DIRECTION_SOUTH||d.rotate90());if(null!=b.point){var k=c=1,l=0,m=0;if(this.getModel().isVertex(a.cell)){var n=a.style[mxConstants.STYLE_FLIPH],
p=a.style[mxConstants.STYLE_FLIPV];null!=a.shape&&null!=a.shape.stencil&&(n=1==mxUtils.getValue(a.style,"stencilFlipH",0)||n,p=1==mxUtils.getValue(a.style,"stencilFlipV",0)||p);if(f==mxConstants.DIRECTION_NORTH||f==mxConstants.DIRECTION_SOUTH)f=n,n=p,p=f;n&&(c=-1,l=-d.width);p&&(k=-1,m=-d.height)}c=new mxPoint(d.x+b.point.x*d.width*c-l,d.y+b.point.y*d.height*k-m)}f=a.style[mxConstants.STYLE_ROTATION]||0;b.perimeter?(0!=g&&null!=c&&(k=d=0,90==g?k=1:180==g?d=-1:270==g&&(k=-1),c=mxUtils.getRotatedPoint(c,
d,k,e)),null!=c&&b.perimeter&&(c=this.view.getPerimeterPoint(a,c,!1))):f+=g;0!=f&&null!=c&&(g=mxUtils.toRadians(f),d=Math.cos(g),k=Math.sin(g),c=mxUtils.getRotatedPoint(c,d,k,e))}null!=c&&(c.x=Math.round(c.x),c.y=Math.round(c.y));return c};mxGraph.prototype.connectCell=function(a,b,c,d){this.model.beginUpdate();try{var e=this.model.getTerminal(a,c);this.cellConnected(a,b,c,d);this.fireEvent(new mxEventObject(mxEvent.CONNECT_CELL,"edge",a,"terminal",b,"source",c,"previous",e))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellConnected=function(a,b,c,d){if(null!=a){this.model.beginUpdate();try{var e=this.model.getTerminal(a,c);this.setConnectionConstraint(a,b,c,d);this.isPortsEnabled()&&(d=null,this.isPort(b)&&(d=b.getId(),b=this.getTerminalForPort(b,c)),this.setCellStyles(c?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT,d,[a]));this.model.setTerminal(a,b,c);this.resetEdgesOnConnect&&this.resetEdge(a);this.fireEvent(new mxEventObject(mxEvent.CELL_CONNECTED,"edge",a,"terminal",b,"source",
c,"previous",e))}finally{this.model.endUpdate()}}};
mxGraph.prototype.disconnectGraph=function(a){if(null!=a){this.model.beginUpdate();try{for(var b=this.view.scale,c=this.view.translate,d={},e=0;e<a.length;e++){var f=mxCellPath.create(a[e]);d[f]=a[e]}for(e=0;e<a.length;e++)if(this.model.isEdge(a[e])){var g=this.model.getGeometry(a[e]);if(null!=g){var k=this.view.getState(a[e]),l=this.view.getState(this.model.getParent(a[e]));if(null!=k&&null!=l){var g=g.clone(),m=-l.origin.x,n=-l.origin.y,p=k.absolutePoints,q=this.model.getTerminal(a[e],!0);if(null!=
q&&this.isCellDisconnectable(a[e],q,!0)){for(var u=mxCellPath.create(q);null!=q&&null==d[u];)q=this.model.getParent(q),u=mxCellPath.create(q);null==q&&(g.setTerminalPoint(new mxPoint(p[0].x/b-c.x+m,p[0].y/b-c.y+n),!0),this.model.setTerminal(a[e],null,!0))}var v=this.model.getTerminal(a[e],!1);if(null!=v&&this.isCellDisconnectable(a[e],v,!1)){for(var y=mxCellPath.create(v);null!=v&&null==d[y];)v=this.model.getParent(v),y=mxCellPath.create(v);if(null==v){var z=p.length-1;g.setTerminalPoint(new mxPoint(p[z].x/
b-c.x+m,p[z].y/b-c.y+n),!1);this.model.setTerminal(a[e],null,!1)}}this.model.setGeometry(a[e],g)}}}}finally{this.model.endUpdate()}}};mxGraph.prototype.getCurrentRoot=function(){return this.view.currentRoot};mxGraph.prototype.getTranslateForRoot=function(a){return null};mxGraph.prototype.isPort=function(a){return!1};mxGraph.prototype.getTerminalForPort=function(a,b){return this.model.getParent(a)};mxGraph.prototype.getChildOffsetForCell=function(a){return null};
mxGraph.prototype.enterGroup=function(a){a=a||this.getSelectionCell();null!=a&&this.isValidRoot(a)&&(this.view.setCurrentRoot(a),this.clearSelection())};mxGraph.prototype.exitGroup=function(){var a=this.model.getRoot(),b=this.getCurrentRoot();if(null!=b){for(var c=this.model.getParent(b);c!=a&&!this.isValidRoot(c)&&this.model.getParent(c)!=a;)c=this.model.getParent(c);c==a||this.model.getParent(c)==a?this.view.setCurrentRoot(null):this.view.setCurrentRoot(c);null!=this.view.getState(b)&&this.setSelectionCell(b)}};
mxGraph.prototype.home=function(){var a=this.getCurrentRoot();null!=a&&(this.view.setCurrentRoot(null),null!=this.view.getState(a)&&this.setSelectionCell(a))};mxGraph.prototype.isValidRoot=function(a){return null!=a};mxGraph.prototype.getGraphBounds=function(){return this.view.getGraphBounds()};
mxGraph.prototype.getCellBounds=function(a,b,c){var d=[a];b&&(d=d.concat(this.model.getEdges(a)));d=this.view.getBounds(d);if(c){c=this.model.getChildCount(a);for(var e=0;e<c;e++){var f=this.getCellBounds(this.model.getChildAt(a,e),b,!0);null!=d?d.add(f):d=f}}return d};
mxGraph.prototype.getBoundingBoxFromGeometry=function(a,b){b=null!=b?b:!1;var c=null;if(null!=a)for(var d=0;d<a.length;d++)if(b||this.model.isVertex(a[d])){var e=this.getCellGeometry(a[d]);if(null!=e){var f=null;if(this.model.isEdge(a[d])){var g=e.points;if(null!=g&&0<g.length){for(var k=new mxRectangle(g[0].x,g[0].y,0,0),f=function(a){null!=a&&k.add(new mxRectangle(a.x,a.y,0,0))},l=1;l<g.length;l++)f(g[l]);f(e.getTerminalPoint(!0));f(e.getTerminalPoint(!1));f=k}}else g=this.model.getParent(a[d]),
e.relative?this.model.isVertex(g)&&g!=this.view.currentRoot&&(k=this.getBoundingBoxFromGeometry([g],!1),null!=k&&(f=new mxRectangle(k.x+e.x*k.width,k.y+e.y*k.height,e.width,e.height))):(f=mxRectangle.fromRectangle(e),this.model.isVertex(g)&&0<=mxUtils.indexOf(a,g)&&(k=this.getBoundingBoxFromGeometry([g],!1),null!=k&&(f.x+=k.x,f.y+=k.y))),null!=f&&null!=e.offset&&(f.x+=e.offset.x,f.y+=e.offset.y);null!=f&&(null==c?c=mxRectangle.fromRectangle(f):c.add(f))}}return c};
mxGraph.prototype.refresh=function(a){this.view.clear(a,null==a);this.view.validate();this.sizeDidChange();this.fireEvent(new mxEventObject(mxEvent.REFRESH))};mxGraph.prototype.snap=function(a){this.gridEnabled&&(a=Math.round(a/this.gridSize)*this.gridSize);return a};
mxGraph.prototype.panGraph=function(a,b){if(this.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.container))this.container.scrollLeft=-a,this.container.scrollTop=-b;else{var c=this.view.getCanvas();if(this.dialect==mxConstants.DIALECT_SVG)if(0==a&&0==b){if(mxClient.IS_IE?c.setAttribute("transform","translate("+a+","+b+")"):c.removeAttribute("transform"),null!=this.shiftPreview1){for(var d=this.shiftPreview1.firstChild;null!=d;){var e=d.nextSibling;this.container.appendChild(d);d=e}null!=this.shiftPreview1.parentNode&&
this.shiftPreview1.parentNode.removeChild(this.shiftPreview1);this.shiftPreview1=null;this.container.appendChild(c.parentNode);for(d=this.shiftPreview2.firstChild;null!=d;)e=d.nextSibling,this.container.appendChild(d),d=e;null!=this.shiftPreview2.parentNode&&this.shiftPreview2.parentNode.removeChild(this.shiftPreview2);this.shiftPreview2=null}}else{c.setAttribute("transform","translate("+a+","+b+")");if(null==this.shiftPreview1){this.shiftPreview1=document.createElement("div");this.shiftPreview1.style.position=
"absolute";this.shiftPreview1.style.overflow="visible";this.shiftPreview2=document.createElement("div");this.shiftPreview2.style.position="absolute";this.shiftPreview2.style.overflow="visible";for(var f=this.shiftPreview1,d=this.container.firstChild;null!=d;)e=d.nextSibling,d!=c.parentNode?f.appendChild(d):f=this.shiftPreview2,d=e;null!=this.shiftPreview1.firstChild&&this.container.insertBefore(this.shiftPreview1,c.parentNode);null!=this.shiftPreview2.firstChild&&this.container.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=
a+"px";this.shiftPreview1.style.top=b+"px";this.shiftPreview2.style.left=a+"px";this.shiftPreview2.style.top=b+"px"}else c.style.left=a+"px",c.style.top=b+"px";this.panDx=a;this.panDy=b;this.fireEvent(new mxEventObject(mxEvent.PAN))}};mxGraph.prototype.zoomIn=function(){this.zoom(this.zoomFactor)};mxGraph.prototype.zoomOut=function(){this.zoom(1/this.zoomFactor)};
mxGraph.prototype.zoomActual=function(){1==this.view.scale?this.view.setTranslate(0,0):(this.view.translate.x=0,this.view.translate.y=0,this.view.setScale(1))};mxGraph.prototype.zoomTo=function(a,b){this.zoom(a/this.view.scale,b)};
mxGraph.prototype.center=function(a,b){a=null!=a?a:!0;b=null!=b?b:!0;var c=mxUtils.hasScrollbars(this.container),d=this.container.clientWidth,e=this.container.clientHeight,f=this.getGraphBounds(),g=this.view.translate,k=this.view.scale,l=a?d-f.width:0,m=b?e-f.height:0;c?(f.x-=g.x,f.y-=g.y,c=this.container.scrollWidth,g=this.container.scrollHeight,c>d&&(l=0),g>e&&(m=0),this.view.setTranslate(Math.floor(l/2-f.x),Math.floor(m/2-f.y)),this.container.scrollLeft=(c-d)/2,this.container.scrollTop=(g-e)/2):
this.view.setTranslate(a?Math.floor(g.x-f.x/k+l/(2*k)):g.x,b?Math.floor(g.y-f.y/k+m/(2*k)):g.y)};
mxGraph.prototype.zoom=function(a,b){b=null!=b?b:this.centerZoom;var c=Math.round(100*this.view.scale*a)/100,d=this.view.getState(this.getSelectionCell());a=c/this.view.scale;if(this.keepSelectionVisibleOnZoom&&null!=d)d=new mxRectangle(d.x*a,d.y*a,d.width*a,d.height*a),this.view.scale=c,this.scrollRectToVisible(d)||(this.view.revalidate(),this.view.setScale(c));else if(d=mxUtils.hasScrollbars(this.container),b&&!d){var d=this.container.offsetWidth,e=this.container.offsetHeight;if(1<a)var f=(a-1)/
(2*c),d=d*-f,e=e*-f;else f=(1/a-1)/(2*this.view.scale),d*=f,e*=f;this.view.scaleAndTranslate(c,this.view.translate.x+d,this.view.translate.y+e)}else{var f=this.view.translate.x,g=this.view.translate.y,k=this.container.scrollLeft,l=this.container.scrollTop;this.view.setScale(c);d&&(e=d=0,b&&(d=this.container.offsetWidth*(a-1)/2,e=this.container.offsetHeight*(a-1)/2),this.container.scrollLeft=(this.view.translate.x-f)*this.view.scale+Math.round(k*a+d),this.container.scrollTop=(this.view.translate.y-
g)*this.view.scale+Math.round(l*a+e))}};
mxGraph.prototype.zoomToRect=function(a){var b=this.container.clientWidth/a.width/(this.container.clientHeight/a.height);a.x=Math.max(0,a.x);a.y=Math.max(0,a.y);var c=Math.min(this.container.scrollWidth,a.x+a.width),d=Math.min(this.container.scrollHeight,a.y+a.height);a.width=c-a.x;a.height=d-a.y;1>b?(b=a.height/b,c=(b-a.height)/2,a.height=b,b=Math.min(a.y,c),a.y-=b,d=Math.min(this.container.scrollHeight,a.y+a.height),a.height=d-a.y):(b*=a.width,c=(b-a.width)/2,a.width=b,b=Math.min(a.x,c),a.x-=b,
c=Math.min(this.container.scrollWidth,a.x+a.width),a.width=c-a.x);b=this.container.clientWidth/a.width;c=this.view.scale*b;mxUtils.hasScrollbars(this.container)?(this.view.setScale(c),this.container.scrollLeft=Math.round(a.x*b),this.container.scrollTop=Math.round(a.y*b)):this.view.scaleAndTranslate(c,this.view.translate.x-a.x/this.view.scale,this.view.translate.y-a.y/this.view.scale)};
mxGraph.prototype.fit=function(a,b){if(null!=this.container){a=null!=a?a:0;b=null!=b?b:!1;var c=9<=document.documentMode?4:0,d=this.container.clientWidth-c,e=this.container.clientHeight-c,c=this.view.getGraphBounds();b&&null!=c.x&&null!=c.y&&(c.width+=c.x,c.height+=c.y,c.x=0,c.y=0);var f=this.view.scale,g=c.width/f,k=c.height/f;null!=this.backgroundImage&&(g=Math.max(g,this.backgroundImage.width-c.x/f),k=Math.max(k,this.backgroundImage.height-c.y/f));var l=b?a:2*a,d=Math.floor(100*Math.min(d/(g+l),
e/(k+l)))/100;null!=this.minFitScale&&(d=Math.max(d,this.minFitScale));null!=this.maxFitScale&&(d=Math.min(d,this.maxFitScale));b?this.view.scale!=d&&this.view.setScale(d):mxUtils.hasScrollbars(this.container)?(this.view.setScale(d),d=this.getGraphBounds(),null!=d.x&&(this.container.scrollLeft=d.x),null!=d.y&&(this.container.scrollTop=d.y)):this.view.scaleAndTranslate(d,null!=c.x?Math.floor(this.view.translate.x-c.x/f+a+1):a,null!=c.y?Math.floor(this.view.translate.y-c.y/f+a+1):a)}return this.view.scale};
mxGraph.prototype.scrollCellToVisible=function(a,b){var c=-this.view.translate.x,d=-this.view.translate.y,e=this.view.getState(a);null!=e&&(c=new mxRectangle(c+e.x,d+e.y,e.width,e.height),b&&null!=this.container&&(d=this.container.clientWidth,e=this.container.clientHeight,c.x=c.getCenterX()-d/2,c.width=d,c.y=c.getCenterY()-e/2,c.height=e),this.scrollRectToVisible(c)&&this.view.setTranslate(this.view.translate.x,this.view.translate.y))};
mxGraph.prototype.scrollRectToVisible=function(a){var b=!1;if(null!=a){var c=this.container.offsetWidth,d=this.container.offsetHeight,e=Math.min(c,a.width),f=Math.min(d,a.height);if(mxUtils.hasScrollbars(this.container)){c=this.container;a.x+=this.view.translate.x;a.y+=this.view.translate.y;var g=c.scrollLeft-a.x,d=Math.max(g-c.scrollLeft,0);0<g?c.scrollLeft-=g+2:(g=a.x+e-c.scrollLeft-c.clientWidth,0<g&&(c.scrollLeft+=g+2));e=c.scrollTop-a.y;g=Math.max(0,e-c.scrollTop);0<e?c.scrollTop-=e+2:(e=a.y+
f-c.scrollTop-c.clientHeight,0<e&&(c.scrollTop+=e+2));this.useScrollbarsForPanning||0==d&&0==g||this.view.setTranslate(d,g)}else{var g=-this.view.translate.x,k=-this.view.translate.y,l=this.view.scale;a.x+e>g+c&&(this.view.translate.x-=(a.x+e-c-g)/l,b=!0);a.y+f>k+d&&(this.view.translate.y-=(a.y+f-d-k)/l,b=!0);a.x<g&&(this.view.translate.x+=(g-a.x)/l,b=!0);a.y<k&&(this.view.translate.y+=(k-a.y)/l,b=!0);b&&(this.view.refresh(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.refresh())}}return b};
mxGraph.prototype.getCellGeometry=function(a){return this.model.getGeometry(a)};mxGraph.prototype.isCellVisible=function(a){return this.model.isVisible(a)};mxGraph.prototype.isCellCollapsed=function(a){return this.model.isCollapsed(a)};mxGraph.prototype.isCellConnectable=function(a){return this.model.isConnectable(a)};
mxGraph.prototype.isOrthogonal=function(a){var b=a.style[mxConstants.STYLE_ORTHOGONAL];if(null!=b)return b;a=this.view.getEdgeStyle(a);return a==mxEdgeStyle.SegmentConnector||a==mxEdgeStyle.ElbowConnector||a==mxEdgeStyle.SideToSide||a==mxEdgeStyle.TopToBottom||a==mxEdgeStyle.EntityRelation||a==mxEdgeStyle.OrthConnector};mxGraph.prototype.isLoop=function(a){var b=a.getVisibleTerminalState(!0);a=a.getVisibleTerminalState(!1);return null!=b&&b==a};mxGraph.prototype.isCloneEvent=function(a){return mxEvent.isControlDown(a)};
mxGraph.prototype.isToggleEvent=function(a){return mxClient.IS_MAC?mxEvent.isMetaDown(a):mxEvent.isControlDown(a)};mxGraph.prototype.isGridEnabledEvent=function(a){return null!=a&&!mxEvent.isAltDown(a)};mxGraph.prototype.isConstrainedEvent=function(a){return mxEvent.isShiftDown(a)};mxGraph.prototype.validationAlert=function(a){mxUtils.alert(a)};mxGraph.prototype.isEdgeValid=function(a,b,c){return null==this.getEdgeValidationError(a,b,c)};
mxGraph.prototype.getEdgeValidationError=function(a,b,c){if(null!=a&&!this.isAllowDanglingEdges()&&(null==b||null==c))return"";if(null!=a&&null==this.model.getTerminal(a,!0)&&null==this.model.getTerminal(a,!1))return null;if(!this.allowLoops&&b==c&&null!=b||!this.isValidConnection(b,c))return"";if(null!=b&&null!=c){var d="";if(!this.multigraph){var e=this.model.getEdgesBetween(b,c,!0);if(1<e.length||1==e.length&&e[0]!=a)d+=(mxResources.get(this.alreadyConnectedResource)||this.alreadyConnectedResource)+
"\n"}var e=this.model.getDirectedEdgeCount(b,!0,a),f=this.model.getDirectedEdgeCount(c,!1,a);if(null!=this.multiplicities)for(var g=0;g<this.multiplicities.length;g++){var k=this.multiplicities[g].check(this,a,b,c,e,f);null!=k&&(d+=k)}k=this.validateEdge(a,b,c);null!=k&&(d+=k);return 0<d.length?d:null}return this.allowDanglingEdges?null:""};mxGraph.prototype.validateEdge=function(a,b,c){return null};
mxGraph.prototype.validateGraph=function(a,b){a=null!=a?a:this.model.getRoot();b=null!=b?b:{};for(var c=!0,d=this.model.getChildCount(a),e=0;e<d;e++){var f=this.model.getChildAt(a,e),g=b;this.isValidRoot(f)&&(g={});g=this.validateGraph(f,g);null!=g?this.setCellWarning(f,g.replace(/\n/g,"<br>")):this.setCellWarning(f,null);c=c&&null==g}d="";this.isCellCollapsed(a)&&!c&&(d+=(mxResources.get(this.containsValidationErrorsResource)||this.containsValidationErrorsResource)+"\n");d=this.model.isEdge(a)?d+
(this.getEdgeValidationError(a,this.model.getTerminal(a,!0),this.model.getTerminal(a,!1))||""):d+(this.getCellValidationError(a)||"");e=this.validateCell(a,b);null!=e&&(d+=e);null==this.model.getParent(a)&&this.view.validate();return 0<d.length||!c?d:null};
mxGraph.prototype.getCellValidationError=function(a){var b=this.model.getDirectedEdgeCount(a,!0),c=this.model.getDirectedEdgeCount(a,!1);a=this.model.getValue(a);var d="";if(null!=this.multiplicities)for(var e=0;e<this.multiplicities.length;e++){var f=this.multiplicities[e];f.source&&mxUtils.isNode(a,f.type,f.attr,f.value)&&(0==f.max&&0<b||1==f.min&&0==b||1==f.max&&1<b)?d+=f.countError+"\n":!f.source&&mxUtils.isNode(a,f.type,f.attr,f.value)&&(0==f.max&&0<c||1==f.min&&0==c||1==f.max&&1<c)&&(d+=f.countError+
"\n")}return 0<d.length?d:null};mxGraph.prototype.validateCell=function(a,b){return null};mxGraph.prototype.getBackgroundImage=function(){return this.backgroundImage};mxGraph.prototype.setBackgroundImage=function(a){this.backgroundImage=a};mxGraph.prototype.getFoldingImage=function(a){if(null!=a&&this.foldingEnabled&&!this.getModel().isEdge(a.cell)){var b=this.isCellCollapsed(a.cell);if(this.isCellFoldable(a.cell,!b))return b?this.collapsedImage:this.expandedImage}return null};
mxGraph.prototype.convertValueToString=function(a){a=this.model.getValue(a);if(null!=a){if(mxUtils.isNode(a))return a.nodeName;if("function"==typeof a.toString)return a.toString()}return""};mxGraph.prototype.getLabel=function(a){var b="";if(this.labelsVisible&&null!=a){var c=this.view.getState(a),c=null!=c?c.style:this.getCellStyle(a);mxUtils.getValue(c,mxConstants.STYLE_NOLABEL,!1)||(b=this.convertValueToString(a))}return b};mxGraph.prototype.isHtmlLabel=function(a){return this.isHtmlLabels()};
mxGraph.prototype.isHtmlLabels=function(){return this.htmlLabels};mxGraph.prototype.setHtmlLabels=function(a){this.htmlLabels=a};mxGraph.prototype.isWrapping=function(a){var b=this.view.getState(a);a=null!=b?b.style:this.getCellStyle(a);return null!=a?"wrap"==a[mxConstants.STYLE_WHITE_SPACE]:!1};mxGraph.prototype.isLabelClipped=function(a){var b=this.view.getState(a);a=null!=b?b.style:this.getCellStyle(a);return null!=a?"hidden"==a[mxConstants.STYLE_OVERFLOW]:!1};
mxGraph.prototype.getTooltip=function(a,b,c,d){var e=null;null!=a&&(null==a.control||b!=a.control.node&&b.parentNode!=a.control.node||(e=this.collapseExpandResource,e=mxResources.get(e)||e),null==e&&null!=a.overlays&&a.overlays.visit(function(a,c){null!=e||b!=c.node&&b.parentNode!=c.node||(e=c.overlay.toString())}),null==e&&(c=this.selectionCellsHandler.getHandler(a.cell),null!=c&&"function"==typeof c.getTooltipForNode&&(e=c.getTooltipForNode(b))),null==e&&(e=this.getTooltipForCell(a.cell)));return e};
mxGraph.prototype.getTooltipForCell=function(a){return null!=a&&null!=a.getTooltip?a.getTooltip():this.convertValueToString(a)};mxGraph.prototype.getCursorForMouseEvent=function(a){return this.getCursorForCell(a.getCell())};mxGraph.prototype.getCursorForCell=function(a){return null};
mxGraph.prototype.getStartSize=function(a){var b=new mxRectangle,c=this.view.getState(a);a=null!=c?c.style:this.getCellStyle(a);null!=a&&(c=parseInt(mxUtils.getValue(a,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE)),mxUtils.getValue(a,mxConstants.STYLE_HORIZONTAL,!0)?b.height=c:b.width=c);return b};mxGraph.prototype.getImage=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_IMAGE]:null};
mxGraph.prototype.getVerticalAlign=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_VERTICAL_ALIGN]||mxConstants.ALIGN_MIDDLE:null};mxGraph.prototype.getIndicatorColor=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_COLOR]:null};mxGraph.prototype.getIndicatorGradientColor=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_GRADIENTCOLOR]:null};
mxGraph.prototype.getIndicatorShape=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_SHAPE]:null};mxGraph.prototype.getIndicatorImage=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_IMAGE]:null};mxGraph.prototype.getBorder=function(){return this.border};mxGraph.prototype.setBorder=function(a){this.border=a};
mxGraph.prototype.isSwimlane=function(a){if(null!=a&&this.model.getParent(a)!=this.model.getRoot()){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);if(null!=b&&!this.model.isEdge(a))return b[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_SWIMLANE}return!1};mxGraph.prototype.isResizeContainer=function(){return this.resizeContainer};mxGraph.prototype.setResizeContainer=function(a){this.resizeContainer=a};mxGraph.prototype.isEnabled=function(){return this.enabled};
mxGraph.prototype.setEnabled=function(a){this.enabled=a};mxGraph.prototype.isEscapeEnabled=function(){return this.escapeEnabled};mxGraph.prototype.setEscapeEnabled=function(a){this.escapeEnabled=a};mxGraph.prototype.isInvokesStopCellEditing=function(){return this.invokesStopCellEditing};mxGraph.prototype.setInvokesStopCellEditing=function(a){this.invokesStopCellEditing=a};mxGraph.prototype.isEnterStopsCellEditing=function(){return this.enterStopsCellEditing};
mxGraph.prototype.setEnterStopsCellEditing=function(a){this.enterStopsCellEditing=a};mxGraph.prototype.isCellLocked=function(a){var b=this.model.getGeometry(a);return this.isCellsLocked()||null!=b&&this.model.isVertex(a)&&b.relative};mxGraph.prototype.isCellsLocked=function(){return this.cellsLocked};mxGraph.prototype.setCellsLocked=function(a){this.cellsLocked=a};mxGraph.prototype.getCloneableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellCloneable(a)}))};
mxGraph.prototype.isCellCloneable=function(a){var b=this.view.getState(a);a=null!=b?b.style:this.getCellStyle(a);return this.isCellsCloneable()&&0!=a[mxConstants.STYLE_CLONEABLE]};mxGraph.prototype.isCellsCloneable=function(){return this.cellsCloneable};mxGraph.prototype.setCellsCloneable=function(a){this.cellsCloneable=a};mxGraph.prototype.getExportableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.canExportCell(a)}))};
mxGraph.prototype.canExportCell=function(a){return this.exportEnabled};mxGraph.prototype.getImportableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.canImportCell(a)}))};mxGraph.prototype.canImportCell=function(a){return this.importEnabled};mxGraph.prototype.isCellSelectable=function(a){return this.isCellsSelectable()};mxGraph.prototype.isCellsSelectable=function(){return this.cellsSelectable};
mxGraph.prototype.setCellsSelectable=function(a){this.cellsSelectable=a};mxGraph.prototype.getDeletableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellDeletable(a)}))};mxGraph.prototype.isCellDeletable=function(a){var b=this.view.getState(a);a=null!=b?b.style:this.getCellStyle(a);return this.isCellsDeletable()&&0!=a[mxConstants.STYLE_DELETABLE]};mxGraph.prototype.isCellsDeletable=function(){return this.cellsDeletable};
mxGraph.prototype.setCellsDeletable=function(a){this.cellsDeletable=a};mxGraph.prototype.isLabelMovable=function(a){return!this.isCellLocked(a)&&(this.model.isEdge(a)&&this.edgeLabelsMovable||this.model.isVertex(a)&&this.vertexLabelsMovable)};mxGraph.prototype.isCellRotatable=function(a){var b=this.view.getState(a);return 0!=(null!=b?b.style:this.getCellStyle(a))[mxConstants.STYLE_ROTATABLE]};mxGraph.prototype.getMovableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellMovable(a)}))};
mxGraph.prototype.isCellMovable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsMovable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_MOVABLE]};mxGraph.prototype.isCellsMovable=function(){return this.cellsMovable};mxGraph.prototype.setCellsMovable=function(a){this.cellsMovable=a};mxGraph.prototype.isGridEnabled=function(){return this.gridEnabled};mxGraph.prototype.setGridEnabled=function(a){this.gridEnabled=a};mxGraph.prototype.isPortsEnabled=function(){return this.portsEnabled};
mxGraph.prototype.setPortsEnabled=function(a){this.portsEnabled=a};mxGraph.prototype.getGridSize=function(){return this.gridSize};mxGraph.prototype.setGridSize=function(a){this.gridSize=a};mxGraph.prototype.getTolerance=function(){return this.tolerance};mxGraph.prototype.setTolerance=function(a){this.tolerance=a};mxGraph.prototype.isVertexLabelsMovable=function(){return this.vertexLabelsMovable};mxGraph.prototype.setVertexLabelsMovable=function(a){this.vertexLabelsMovable=a};
mxGraph.prototype.isEdgeLabelsMovable=function(){return this.edgeLabelsMovable};mxGraph.prototype.setEdgeLabelsMovable=function(a){this.edgeLabelsMovable=a};mxGraph.prototype.isSwimlaneNesting=function(){return this.swimlaneNesting};mxGraph.prototype.setSwimlaneNesting=function(a){this.swimlaneNesting=a};mxGraph.prototype.isSwimlaneSelectionEnabled=function(){return this.swimlaneSelectionEnabled};mxGraph.prototype.setSwimlaneSelectionEnabled=function(a){this.swimlaneSelectionEnabled=a};
mxGraph.prototype.isMultigraph=function(){return this.multigraph};mxGraph.prototype.setMultigraph=function(a){this.multigraph=a};mxGraph.prototype.isAllowLoops=function(){return this.allowLoops};mxGraph.prototype.setAllowDanglingEdges=function(a){this.allowDanglingEdges=a};mxGraph.prototype.isAllowDanglingEdges=function(){return this.allowDanglingEdges};mxGraph.prototype.setConnectableEdges=function(a){this.connectableEdges=a};mxGraph.prototype.isConnectableEdges=function(){return this.connectableEdges};
mxGraph.prototype.setCloneInvalidEdges=function(a){this.cloneInvalidEdges=a};mxGraph.prototype.isCloneInvalidEdges=function(){return this.cloneInvalidEdges};mxGraph.prototype.setAllowLoops=function(a){this.allowLoops=a};mxGraph.prototype.isDisconnectOnMove=function(){return this.disconnectOnMove};mxGraph.prototype.setDisconnectOnMove=function(a){this.disconnectOnMove=a};mxGraph.prototype.isDropEnabled=function(){return this.dropEnabled};
mxGraph.prototype.setDropEnabled=function(a){this.dropEnabled=a};mxGraph.prototype.isSplitEnabled=function(){return this.splitEnabled};mxGraph.prototype.setSplitEnabled=function(a){this.splitEnabled=a};mxGraph.prototype.isCellResizable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsResizable()&&!this.isCellLocked(a)&&"0"!=mxUtils.getValue(b,mxConstants.STYLE_RESIZABLE,"1")};mxGraph.prototype.isCellsResizable=function(){return this.cellsResizable};
mxGraph.prototype.setCellsResizable=function(a){this.cellsResizable=a};mxGraph.prototype.isTerminalPointMovable=function(a,b){return!0};mxGraph.prototype.isCellBendable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsBendable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_BENDABLE]};mxGraph.prototype.isCellsBendable=function(){return this.cellsBendable};mxGraph.prototype.setCellsBendable=function(a){this.cellsBendable=a};
mxGraph.prototype.isCellEditable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsEditable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_EDITABLE]};mxGraph.prototype.isCellsEditable=function(){return this.cellsEditable};mxGraph.prototype.setCellsEditable=function(a){this.cellsEditable=a};mxGraph.prototype.isCellDisconnectable=function(a,b,c){return this.isCellsDisconnectable()&&!this.isCellLocked(a)};mxGraph.prototype.isCellsDisconnectable=function(){return this.cellsDisconnectable};
mxGraph.prototype.setCellsDisconnectable=function(a){this.cellsDisconnectable=a};mxGraph.prototype.isValidSource=function(a){return null==a&&this.allowDanglingEdges||null!=a&&(!this.model.isEdge(a)||this.connectableEdges)&&this.isCellConnectable(a)};mxGraph.prototype.isValidTarget=function(a){return this.isValidSource(a)};mxGraph.prototype.isValidConnection=function(a,b){return this.isValidSource(a)&&this.isValidTarget(b)};mxGraph.prototype.setConnectable=function(a){this.connectionHandler.setEnabled(a)};
mxGraph.prototype.isConnectable=function(a){return this.connectionHandler.isEnabled()};mxGraph.prototype.setTooltips=function(a){this.tooltipHandler.setEnabled(a)};mxGraph.prototype.setPanning=function(a){this.panningHandler.panningEnabled=a};mxGraph.prototype.isEditing=function(a){if(null!=this.cellEditor){var b=this.cellEditor.getEditingCell();return null==a?null!=b:a==b}return!1};
mxGraph.prototype.isAutoSizeCell=function(a){var b=this.view.getState(a);a=null!=b?b.style:this.getCellStyle(a);return this.isAutoSizeCells()||1==a[mxConstants.STYLE_AUTOSIZE]};mxGraph.prototype.isAutoSizeCells=function(){return this.autoSizeCells};mxGraph.prototype.setAutoSizeCells=function(a){this.autoSizeCells=a};mxGraph.prototype.isExtendParent=function(a){return!this.getModel().isEdge(a)&&this.isExtendParents()};mxGraph.prototype.isExtendParents=function(){return this.extendParents};
mxGraph.prototype.setExtendParents=function(a){this.extendParents=a};mxGraph.prototype.isExtendParentsOnAdd=function(a){return this.extendParentsOnAdd};mxGraph.prototype.setExtendParentsOnAdd=function(a){this.extendParentsOnAdd=a};mxGraph.prototype.isExtendParentsOnMove=function(){return this.extendParentsOnMove};mxGraph.prototype.setExtendParentsOnMove=function(a){this.extendParentsOnMove=a};mxGraph.prototype.isRecursiveResize=function(a){return this.recursiveResize};
mxGraph.prototype.setRecursiveResize=function(a){this.recursiveResize=a};mxGraph.prototype.isConstrainChild=function(a){return this.isConstrainChildren()&&!this.getModel().isEdge(this.getModel().getParent(a))};mxGraph.prototype.isConstrainChildren=function(){return this.constrainChildren};mxGraph.prototype.setConstrainChildren=function(a){this.constrainChildren=a};mxGraph.prototype.setConstrainChildrenOnResize=function(a){this.constrainChildrenOnResize=a};
mxGraph.prototype.isConstrainChildrenOnResize=function(){return this.constrainChildrenOnResize};mxGraph.prototype.isAllowNegativeCoordinates=function(){return this.allowNegativeCoordinates};mxGraph.prototype.setAllowNegativeCoordinates=function(a){this.allowNegativeCoordinates=a};mxGraph.prototype.getOverlap=function(a){return this.isAllowOverlapParent(a)?this.defaultOverlap:0};mxGraph.prototype.isAllowOverlapParent=function(a){return!1};
mxGraph.prototype.getFoldableCells=function(a,b){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellFoldable(a,b)}))};mxGraph.prototype.isCellFoldable=function(a,b){var c=this.view.getState(a),c=null!=c?c.style:this.getCellStyle(a);return 0<this.model.getChildCount(a)&&0!=c[mxConstants.STYLE_FOLDABLE]};
mxGraph.prototype.isValidDropTarget=function(a,b,c){return null!=a&&(this.isSplitEnabled()&&this.isSplitTarget(a,b,c)||!this.model.isEdge(a)&&(this.isSwimlane(a)||0<this.model.getChildCount(a)&&!this.isCellCollapsed(a)))};
mxGraph.prototype.isSplitTarget=function(a,b,c){return this.model.isEdge(a)&&null!=b&&1==b.length&&this.isCellConnectable(b[0])&&null==this.getEdgeValidationError(a,this.model.getTerminal(a,!0),b[0])?(c=this.model.getTerminal(a,!0),a=this.model.getTerminal(a,!1),!this.model.isAncestor(b[0],c)&&!this.model.isAncestor(b[0],a)):!1};
mxGraph.prototype.getDropTarget=function(a,b,c,d){if(!this.isSwimlaneNesting())for(var e=0;e<a.length;e++)if(this.isSwimlane(a[e]))return null;e=mxUtils.convertPoint(this.container,mxEvent.getClientX(b),mxEvent.getClientY(b));e.x-=this.panDx;e.y-=this.panDy;e=this.getSwimlaneAt(e.x,e.y);if(null==c)c=e;else if(null!=e){for(var f=this.model.getParent(e);null!=f&&this.isSwimlane(f)&&f!=c;)f=this.model.getParent(f);f==c&&(c=e)}for(;null!=c&&!this.isValidDropTarget(c,a,b)&&!this.model.isLayer(c);)c=this.model.getParent(c);
if(null==d||!d)for(var g=c;null!=g&&0>mxUtils.indexOf(a,g);)g=this.model.getParent(g);return this.model.isLayer(c)||null!=g?null:c};mxGraph.prototype.getDefaultParent=function(){var a=this.getCurrentRoot();null==a&&(a=this.defaultParent,null==a&&(a=this.model.getRoot(),a=this.model.getChildAt(a,0)));return a};mxGraph.prototype.setDefaultParent=function(a){this.defaultParent=a};mxGraph.prototype.getSwimlane=function(a){for(;null!=a&&!this.isSwimlane(a);)a=this.model.getParent(a);return a};
mxGraph.prototype.getSwimlaneAt=function(a,b,c){c=c||this.getDefaultParent();if(null!=c)for(var d=this.model.getChildCount(c),e=0;e<d;e++){var f=this.model.getChildAt(c,e),g=this.getSwimlaneAt(a,b,f);if(null!=g)return g;if(this.isSwimlane(f)&&(g=this.view.getState(f),this.intersects(g,a,b)))return f}return null};
mxGraph.prototype.getCellAt=function(a,b,c,d,e,f){d=null!=d?d:!0;e=null!=e?e:!0;null==c&&(c=this.getCurrentRoot(),null==c&&(c=this.getModel().getRoot()));if(null!=c)for(var g=this.model.getChildCount(c)-1;0<=g;g--){var k=this.model.getChildAt(c,g),l=this.getCellAt(a,b,k,d,e,f);if(null!=l)return l;if(this.isCellVisible(k)&&(e&&this.model.isEdge(k)||d&&this.model.isVertex(k))&&(l=this.view.getState(k),null!=l&&(null==f||!f(l,a,b))&&this.intersects(l,a,b)))return k}return null};
mxGraph.prototype.intersects=function(a,b,c){if(null!=a){var d=a.absolutePoints;if(null!=d){a=this.tolerance*this.tolerance;for(var e=d[0],f=1;f<d.length;f++){var g=d[f];if(mxUtils.ptSegDistSq(e.x,e.y,g.x,g.y,b,c)<=a)return!0;e=g}}else if(e=mxUtils.toRadians(mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION)||0),0!=e&&(d=Math.cos(-e),e=Math.sin(-e),f=new mxPoint(a.getCenterX(),a.getCenterY()),e=mxUtils.getRotatedPoint(new mxPoint(b,c),d,e,f),b=e.x,c=e.y),mxUtils.contains(a,b,c))return!0}return!1};
mxGraph.prototype.hitsSwimlaneContent=function(a,b,c){var d=this.getView().getState(a);a=this.getStartSize(a);if(null!=d){var e=this.getView().getScale();b-=d.x;c-=d.y;if(0<a.width&&0<b&&b>a.width*e||0<a.height&&0<c&&c>a.height*e)return!0}return!1};mxGraph.prototype.getChildVertices=function(a){return this.getChildCells(a,!0,!1)};mxGraph.prototype.getChildEdges=function(a){return this.getChildCells(a,!1,!0)};
mxGraph.prototype.getChildCells=function(a,b,c){a=null!=a?a:this.getDefaultParent();a=this.model.getChildCells(a,null!=b?b:!1,null!=c?c:!1);b=[];for(c=0;c<a.length;c++)this.isCellVisible(a[c])&&b.push(a[c]);return b};mxGraph.prototype.getConnections=function(a,b){return this.getEdges(a,b,!0,!0,!1)};mxGraph.prototype.getIncomingEdges=function(a,b){return this.getEdges(a,b,!0,!1,!1)};mxGraph.prototype.getOutgoingEdges=function(a,b){return this.getEdges(a,b,!1,!0,!1)};
mxGraph.prototype.getEdges=function(a,b,c,d,e,f){c=null!=c?c:!0;d=null!=d?d:!0;e=null!=e?e:!0;f=null!=f?f:!1;for(var g=[],k=this.isCellCollapsed(a),l=this.model.getChildCount(a),m=0;m<l;m++){var n=this.model.getChildAt(a,m);if(k||!this.isCellVisible(n))g=g.concat(this.model.getEdges(n,c,d))}g=g.concat(this.model.getEdges(a,c,d));k=[];for(m=0;m<g.length;m++)n=this.view.getState(g[m]),l=null!=n?n.getVisibleTerminal(!0):this.view.getVisibleTerminal(g[m],!0),n=null!=n?n.getVisibleTerminal(!1):this.view.getVisibleTerminal(g[m],
!1),(e&&l==n||l!=n&&(c&&n==a&&(null==b||this.isValidAncestor(l,b,f))||d&&l==a&&(null==b||this.isValidAncestor(n,b,f))))&&k.push(g[m]);return k};mxGraph.prototype.isValidAncestor=function(a,b,c){return c?this.model.isAncestor(b,a):this.model.getParent(a)==b};
mxGraph.prototype.getOpposites=function(a,b,c,d){c=null!=c?c:!0;d=null!=d?d:!0;var e=[],f={};if(null!=a)for(var g=0;g<a.length;g++){var k=this.view.getState(a[g]),l=null!=k?k.getVisibleTerminal(!0):this.view.getVisibleTerminal(a[g],!0),k=null!=k?k.getVisibleTerminal(!1):this.view.getVisibleTerminal(a[g],!1);if(l==b&&null!=k&&k!=b&&d){var m=mxCellPath.create(k);null==f[m]&&(f[m]=k,e.push(k))}else k==b&&null!=l&&l!=b&&c&&(m=mxCellPath.create(l),null==f[m]&&(f[m]=l,e.push(l)))}return e};
mxGraph.prototype.getEdgesBetween=function(a,b,c){c=null!=c?c:!1;for(var d=this.getEdges(a),e=[],f=0;f<d.length;f++){var g=this.view.getState(d[f]),k=null!=g?g.getVisibleTerminal(!0):this.view.getVisibleTerminal(d[f],!0),g=null!=g?g.getVisibleTerminal(!1):this.view.getVisibleTerminal(d[f],!1);(k==a&&g==b||!c&&k==b&&g==a)&&e.push(d[f])}return e};
mxGraph.prototype.getPointForEvent=function(a,b){var c=mxUtils.convertPoint(this.container,mxEvent.getClientX(a),mxEvent.getClientY(a)),d=this.view.scale,e=this.view.translate,f=!1!=b?this.gridSize/2:0;c.x=this.snap(c.x/d-e.x-f);c.y=this.snap(c.y/d-e.y-f);return c};
mxGraph.prototype.getCells=function(a,b,c,d,e,f){f=null!=f?f:[];if(0<c||0<d){var g=this.getModel(),k=a+c,l=b+d;null==e&&(e=this.getCurrentRoot(),null==e&&(e=g.getRoot()));if(null!=e)for(var m=g.getChildCount(e),n=0;n<m;n++){var p=g.getChildAt(e,n),q=this.view.getState(p);if(null!=q&&this.isCellVisible(p)){var u=mxUtils.getValue(q.style,mxConstants.STYLE_ROTATION)||0;0!=u&&(q=mxUtils.getBoundingBox(q,u));(g.isEdge(p)||g.isVertex(p))&&q.x>=a&&q.y+q.height<=l&&q.y>=b&&q.x+q.width<=k?f.push(p):this.getCells(a,
b,c,d,p,f)}}}return f};mxGraph.prototype.getCellsBeyond=function(a,b,c,d,e){var f=[];if(d||e)if(null==c&&(c=this.getDefaultParent()),null!=c)for(var g=this.model.getChildCount(c),k=0;k<g;k++){var l=this.model.getChildAt(c,k),m=this.view.getState(l);this.isCellVisible(l)&&null!=m&&(!d||m.x>=a)&&(!e||m.y>=b)&&f.push(l)}return f};
mxGraph.prototype.findTreeRoots=function(a,b,c){b=null!=b?b:!1;c=null!=c?c:!1;var d=[];if(null!=a){for(var e=this.getModel(),f=e.getChildCount(a),g=null,k=0,l=0;l<f;l++){var m=e.getChildAt(a,l);if(this.model.isVertex(m)&&this.isCellVisible(m)){for(var n=this.getConnections(m,b?a:null),p=0,q=0,u=0;u<n.length;u++)this.view.getVisibleTerminal(n[u],!0)==m?p++:q++;(c&&0==p&&0<q||!c&&0==q&&0<p)&&d.push(m);n=c?q-p:p-q;n>k&&(k=n,g=m)}}0==d.length&&null!=g&&d.push(g)}return d};
mxGraph.prototype.traverse=function(a,b,c,d,e){if(null!=c&&null!=a){b=null!=b?b:!0;e=e||[];var f=mxCellPath.create(a);if(null==e[f]&&(e[f]=a,d=c(a,d),null==d||d)&&(d=this.model.getEdgeCount(a),0<d))for(f=0;f<d;f++){var g=this.model.getEdgeAt(a,f),k=this.model.getTerminal(g,!0)==a;if(!b||k)k=this.model.getTerminal(g,!k),this.traverse(k,b,c,g,e)}}};mxGraph.prototype.isCellSelected=function(a){return this.getSelectionModel().isSelected(a)};mxGraph.prototype.isSelectionEmpty=function(){return this.getSelectionModel().isEmpty()};
mxGraph.prototype.clearSelection=function(){return this.getSelectionModel().clear()};mxGraph.prototype.getSelectionCount=function(){return this.getSelectionModel().cells.length};mxGraph.prototype.getSelectionCell=function(){return this.getSelectionModel().cells[0]};mxGraph.prototype.getSelectionCells=function(){return this.getSelectionModel().cells.slice()};mxGraph.prototype.setSelectionCell=function(a){this.getSelectionModel().setCell(a)};mxGraph.prototype.setSelectionCells=function(a){this.getSelectionModel().setCells(a)};
mxGraph.prototype.addSelectionCell=function(a){this.getSelectionModel().addCell(a)};mxGraph.prototype.addSelectionCells=function(a){this.getSelectionModel().addCells(a)};mxGraph.prototype.removeSelectionCell=function(a){this.getSelectionModel().removeCell(a)};mxGraph.prototype.removeSelectionCells=function(a){this.getSelectionModel().removeCells(a)};mxGraph.prototype.selectRegion=function(a,b){var c=this.getCells(a.x,a.y,a.width,a.height);this.selectCellsForEvent(c,b);return c};
mxGraph.prototype.selectNextCell=function(){this.selectCell(!0)};mxGraph.prototype.selectPreviousCell=function(){this.selectCell()};mxGraph.prototype.selectParentCell=function(){this.selectCell(!1,!0)};mxGraph.prototype.selectChildCell=function(){this.selectCell(!1,!1,!0)};
mxGraph.prototype.selectCell=function(a,b,c){var d=this.selectionModel,e=0<d.cells.length?d.cells[0]:null;1<d.cells.length&&d.clear();var d=null!=e?this.model.getParent(e):this.getDefaultParent(),f=this.model.getChildCount(d);null==e&&0<f?(a=this.model.getChildAt(d,0),this.setSelectionCell(a)):null!=e&&!b||null==this.view.getState(d)||null==this.model.getGeometry(d)?null!=e&&c?0<this.model.getChildCount(e)&&(a=this.model.getChildAt(e,0),this.setSelectionCell(a)):0<f&&(b=d.getIndex(e),a?(b++,a=this.model.getChildAt(d,
b%f)):(b--,a=this.model.getChildAt(d,0>b?f-1:b)),this.setSelectionCell(a)):this.getCurrentRoot()!=d&&this.setSelectionCell(d)};mxGraph.prototype.selectAll=function(a){a=a||this.getDefaultParent();a=this.model.getChildren(a);null!=a&&this.setSelectionCells(a)};mxGraph.prototype.selectVertices=function(a){this.selectCells(!0,!1,a)};mxGraph.prototype.selectEdges=function(a){this.selectCells(!1,!0,a)};
mxGraph.prototype.selectCells=function(a,b,c){c=c||this.getDefaultParent();var d=mxUtils.bind(this,function(c){return null!=this.view.getState(c)&&(0==this.model.getChildCount(c)&&this.model.isVertex(c)&&a||this.model.isEdge(c)&&b)});c=this.model.filterDescendants(d,c);this.setSelectionCells(c)};mxGraph.prototype.selectCellForEvent=function(a,b){var c=this.isCellSelected(a);this.isToggleEvent(b)?c?this.removeSelectionCell(a):this.addSelectionCell(a):(!c||1!=this.getSelectionCount())&&this.setSelectionCell(a)};
mxGraph.prototype.selectCellsForEvent=function(a,b){this.isToggleEvent(b)?this.addSelectionCells(a):this.setSelectionCells(a)};
mxGraph.prototype.createHandler=function(a){var b=null;null!=a&&(this.model.isEdge(a.cell)?(b=this.view.getEdgeStyle(a),b=this.isLoop(a)||b==mxEdgeStyle.ElbowConnector||b==mxEdgeStyle.SideToSide||b==mxEdgeStyle.TopToBottom?this.createElbowEdgeHandler(a):b==mxEdgeStyle.SegmentConnector||b==mxEdgeStyle.OrthConnector?this.createEdgeSegmentHandler(a):this.createEdgeHandler(a)):b=this.createVertexHandler(a));return b};mxGraph.prototype.createVertexHandler=function(a){return new mxVertexHandler(a)};
mxGraph.prototype.createEdgeHandler=function(a){return new mxEdgeHandler(a)};mxGraph.prototype.createEdgeSegmentHandler=function(a){return new mxEdgeSegmentHandler(a)};mxGraph.prototype.createElbowEdgeHandler=function(a){return new mxElbowEdgeHandler(a)};mxGraph.prototype.addMouseListener=function(a){null==this.mouseListeners&&(this.mouseListeners=[]);this.mouseListeners.push(a)};
mxGraph.prototype.removeMouseListener=function(a){if(null!=this.mouseListeners)for(var b=0;b<this.mouseListeners.length;b++)if(this.mouseListeners[b]==a){this.mouseListeners.splice(b,1);break}};
mxGraph.prototype.updateMouseEvent=function(a,b){if(null==a.graphX||null==a.graphY){var c=mxUtils.convertPoint(this.container,a.getX(),a.getY());a.graphX=c.x-this.panDx;a.graphY=c.y-this.panDy;null==a.getCell()&&this.isMouseDown&&b==mxEvent.MOUSE_MOVE&&(a.state=this.view.getState(this.getCellAt(c.x,c.y,null,null,null,function(a){return null==a.shape||a.shape.paintBackground!=mxRectangleShape.prototype.paintBackground||"1"==mxUtils.getValue(a.style,mxConstants.STYLE_POINTER_EVENTS,"1")||null!=a.shape.fill&&
a.shape.fill!=mxConstants.NONE})))}return a};mxGraph.prototype.getStateForTouchEvent=function(a){var b=mxEvent.getClientX(a);a=mxEvent.getClientY(a);b=mxUtils.convertPoint(this.container,b,a);return this.view.getState(this.getCellAt(b.x,b.y))};
mxGraph.prototype.isEventIgnored=function(a,b,c){var d=mxEvent.isMouseEvent(b.getEvent()),e=this.isEditing();b.getEvent()==this.lastEvent?e=!0:this.lastEvent=b.getEvent();null!=this.eventSource&&a!=mxEvent.MOUSE_MOVE?(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.eventSource=this.mouseUpRedirect=this.mouseMoveRedirect=null):null!=this.eventSource&&b.getSource()!=this.eventSource?e=!0:mxClient.IS_TOUCH&&a==mxEvent.MOUSE_DOWN&&!d&&(this.eventSource=
b.getSource(),this.mouseMoveRedirect=mxUtils.bind(this,function(a){this.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,this.getStateForTouchEvent(a)))}),this.mouseUpRedirect=mxUtils.bind(this,function(a){this.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a,this.getStateForTouchEvent(a)))}),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect));this.isSyntheticEventIgnored(a,b,c)&&(e=!0);if(!mxEvent.isPopupTrigger(this.lastEvent)&&a!=mxEvent.MOUSE_MOVE&&
2==this.lastEvent.detail)return!0;a==mxEvent.MOUSE_UP&&this.isMouseDown?this.isMouseDown=!1:a!=mxEvent.MOUSE_DOWN||this.isMouseDown?!e&&((!mxClient.IS_FF||a!=mxEvent.MOUSE_MOVE)&&this.isMouseDown&&this.isMouseTrigger!=d||a==mxEvent.MOUSE_DOWN&&this.isMouseDown||a==mxEvent.MOUSE_UP&&!this.isMouseDown)&&(e=!0):(this.isMouseDown=!0,this.isMouseTrigger=d);!e&&a==mxEvent.MOUSE_DOWN&&(this.lastMouseX=b.getX(),this.lastMouseY=b.getY());return e};
mxGraph.prototype.isSyntheticEventIgnored=function(a,b,c){c=!1;b=mxEvent.isMouseEvent(b.getEvent());this.ignoreMouseEvents&&b&&a!=mxEvent.MOUSE_MOVE?(this.ignoreMouseEvents=a!=mxEvent.MOUSE_UP,c=!0):mxClient.IS_FF&&!b&&a==mxEvent.MOUSE_UP&&(this.ignoreMouseEvents=!0);return c};
mxGraph.prototype.isEventSourceIgnored=function(a,b){var c=b.getSource(),d=null!=c.nodeName?c.nodeName.toLowerCase():"",e=!mxEvent.isMouseEvent(b.getEvent())||mxEvent.isLeftMouseButton(b.getEvent());return a==mxEvent.MOUSE_DOWN&&e&&("select"==d||"option"==d||"input"==d&&"checkbox"!=c.type&&"radio"!=c.type&&"button"!=c.type&&"submit"!=c.type&&"file"!=c.type)};mxGraph.prototype.getEventState=function(a){return a};
mxGraph.prototype.fireMouseEvent=function(a,b,c){if(this.isEventSourceIgnored(a,b))null!=this.tooltipHandler&&this.tooltipHandler.hide();else{null==c&&(c=this);b=this.updateMouseEvent(b,a);a==mxEvent.MOUSE_DOWN&&this.isEditing()&&!this.cellEditor.isEventSource(b.getEvent())&&this.stopEditing(!this.isInvokesStopCellEditing());if(!this.nativeDblClickEnabled&&!mxEvent.isPopupTrigger(b.getEvent())||this.doubleTapEnabled&&mxClient.IS_TOUCH&&mxEvent.isTouchEvent(b.getEvent())){var d=(new Date).getTime();
if(!mxClient.IS_QUIRKS&&a==mxEvent.MOUSE_DOWN||mxClient.IS_QUIRKS&&a==mxEvent.MOUSE_UP&&!this.fireDoubleClick)if(null!=this.lastTouchEvent&&this.lastTouchEvent!=b.getEvent()&&d-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-b.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-b.getY())<this.doubleTapTolerance&&2>this.doubleClickCounter){if(this.doubleClickCounter++,d=!1,a==mxEvent.MOUSE_UP?b.getCell()==this.lastTouchCell&&null!=this.lastTouchCell&&(this.lastTouchTime=0,
d=this.lastTouchCell,this.lastTouchCell=null,mxClient.IS_QUIRKS&&b.getSource().fireEvent("ondblclick"),this.dblClick(b.getEvent(),d),d=!0):(this.fireDoubleClick=!0,this.lastTouchTime=0),!mxClient.IS_QUIRKS||d){mxEvent.consume(b.getEvent());return}}else{if(null==this.lastTouchEvent||this.lastTouchEvent!=b.getEvent())this.lastTouchCell=b.getCell(),this.lastTouchX=b.getX(),this.lastTouchY=b.getY(),this.lastTouchTime=d,this.lastTouchEvent=b.getEvent(),this.doubleClickCounter=0}else if((this.isMouseDown||
a==mxEvent.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;d=this.lastTouchCell;this.lastTouchCell=null;this.isMouseDown=!1;(null!=d||mxEvent.isTouchEvent(b.getEvent())&&(mxClient.IS_GC||mxClient.IS_SF))&&Math.abs(this.lastTouchX-b.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-b.getY())<this.doubleTapTolerance?this.dblClick(b.getEvent(),d):mxEvent.consume(b.getEvent());return}}if(!this.isEventIgnored(a,b,c)){b.state=this.getEventState(b.getState());this.fireEvent(new mxEventObject(mxEvent.FIRE_MOUSE_EVENT,
"eventName",a,"event",b));if(mxClient.IS_OP||mxClient.IS_SF||mxClient.IS_GC||mxClient.IS_IE&&mxClient.IS_SVG||b.getEvent().target!=this.container){a==mxEvent.MOUSE_MOVE&&this.isMouseDown&&this.autoScroll&&!mxEvent.isMultiTouchEvent(b.getEvent)&&this.scrollPointToVisible(b.getGraphX(),b.getGraphY(),this.autoExtend);if(null!=this.mouseListeners){d=[c,b];b.getEvent().preventDefault||(b.getEvent().returnValue=!0);for(var e=0;e<this.mouseListeners.length;e++){var f=this.mouseListeners[e];a==mxEvent.MOUSE_DOWN?
f.mouseDown.apply(f,d):a==mxEvent.MOUSE_MOVE?f.mouseMove.apply(f,d):a==mxEvent.MOUSE_UP&&f.mouseUp.apply(f,d)}}a==mxEvent.MOUSE_UP&&this.click(b)}mxEvent.isTouchEvent(b.getEvent())&&a==mxEvent.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress?(this.tapAndHoldInProgress=!0,this.initialTouchX=b.getGraphX(),this.initialTouchY=b.getGraphY(),this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(mxUtils.bind(this,function(){this.tapAndHoldValid&&
this.tapAndHold(b);this.tapAndHoldValid=this.tapAndHoldInProgress=!1}),this.tapAndHoldDelay),this.tapAndHoldValid=!0):a==mxEvent.MOUSE_UP?this.tapAndHoldValid=this.tapAndHoldInProgress=!1:this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-b.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-b.getGraphY())<this.tolerance);this.consumeMouseEvent(a,b,c)}}};mxGraph.prototype.consumeMouseEvent=function(a,b,c){a==mxEvent.MOUSE_DOWN&&mxEvent.isTouchEvent(b.getEvent())&&b.consume(!1)};
mxGraph.prototype.fireGestureEvent=function(a,b){this.lastTouchTime=0;this.fireEvent(new mxEventObject(mxEvent.GESTURE,"event",a,"cell",b))};
mxGraph.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tooltipHandler&&this.tooltipHandler.destroy(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.destroy(),null!=this.panningHandler&&this.panningHandler.destroy(),null!=this.popupMenuHandler&&this.popupMenuHandler.destroy(),null!=this.connectionHandler&&this.connectionHandler.destroy(),null!=this.graphHandler&&this.graphHandler.destroy(),null!=this.cellEditor&&this.cellEditor.destroy(),null!=this.view&&this.view.destroy(),
null!=this.model&&null!=this.graphModelChangeListener&&(this.model.removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null),this.container=null)};function mxCellOverlay(a,b,c,d,e,f){this.image=a;this.tooltip=b;this.align=null!=c?c:this.align;this.verticalAlign=null!=d?d:this.verticalAlign;this.offset=null!=e?e:new mxPoint;this.cursor=null!=f?f:"help"}mxCellOverlay.prototype=new mxEventSource;mxCellOverlay.prototype.constructor=mxCellOverlay;mxCellOverlay.prototype.image=null;
mxCellOverlay.prototype.tooltip=null;mxCellOverlay.prototype.align=mxConstants.ALIGN_RIGHT;mxCellOverlay.prototype.verticalAlign=mxConstants.ALIGN_BOTTOM;mxCellOverlay.prototype.offset=null;mxCellOverlay.prototype.cursor=null;mxCellOverlay.prototype.defaultOverlap=0.5;
mxCellOverlay.prototype.getBounds=function(a){var b=a.view.graph.getModel().isEdge(a.cell),c=a.view.scale,d=null,e=this.image.width,f=this.image.height;b?(b=a.absolutePoints,1==b.length%2?d=b[Math.floor(b.length/2)]:(d=b.length/2,a=b[d-1],b=b[d],d=new mxPoint(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2))):(d=new mxPoint,d.x=this.align==mxConstants.ALIGN_LEFT?a.x:this.align==mxConstants.ALIGN_CENTER?a.x+a.width/2:a.x+a.width,d.y=this.verticalAlign==mxConstants.ALIGN_TOP?a.y:this.verticalAlign==mxConstants.ALIGN_MIDDLE?
a.y+a.height/2:a.y+a.height);return new mxRectangle(Math.round(d.x-(e*this.defaultOverlap-this.offset.x)*c),Math.round(d.y-(f*this.defaultOverlap-this.offset.y)*c),e*c,f*c)};mxCellOverlay.prototype.toString=function(){return this.tooltip};function mxOutline(a,b){this.source=a;null!=b&&this.init(b)}mxOutline.prototype.source=null;mxOutline.prototype.outline=null;mxOutline.prototype.graphRenderHint=mxConstants.RENDERING_HINT_FASTER;mxOutline.prototype.enabled=!0;mxOutline.prototype.showViewport=!0;
mxOutline.prototype.border=10;mxOutline.prototype.sizerSize=8;mxOutline.prototype.labelsVisible=!1;mxOutline.prototype.updateOnPan=!1;mxOutline.prototype.sizerImage=null;mxOutline.prototype.suspended=!1;mxOutline.prototype.forceVmlHandles=8==document.documentMode;mxOutline.prototype.createGraph=function(a){a=new mxGraph(a,this.source.getModel(),this.graphRenderHint,this.source.getStylesheet());a.foldingEnabled=!1;a.autoScroll=!1;return a};
mxOutline.prototype.init=function(a){this.outline=this.createGraph(a);var b=this.outline.graphModelChanged;this.outline.graphModelChanged=mxUtils.bind(this,function(a){!this.suspended&&null!=this.outline&&b.apply(this.outline,arguments)});mxClient.IS_SVG&&(a=this.outline.getView().getCanvas().parentNode,a.setAttribute("shape-rendering","optimizeSpeed"),a.setAttribute("image-rendering","optimizeSpeed"));this.outline.labelsVisible=this.labelsVisible;this.outline.setEnabled(!1);this.updateHandler=mxUtils.bind(this,
function(a,b){this.suspended||this.active||this.update()});this.source.getModel().addListener(mxEvent.CHANGE,this.updateHandler);this.outline.addMouseListener(this);a=this.source.getView();a.addListener(mxEvent.SCALE,this.updateHandler);a.addListener(mxEvent.TRANSLATE,this.updateHandler);a.addListener(mxEvent.SCALE_AND_TRANSLATE,this.updateHandler);a.addListener(mxEvent.DOWN,this.updateHandler);a.addListener(mxEvent.UP,this.updateHandler);mxEvent.addListener(this.source.container,"scroll",this.updateHandler);
this.panHandler=mxUtils.bind(this,function(a){this.updateOnPan&&this.updateHandler.apply(this,arguments)});this.source.addListener(mxEvent.PAN,this.panHandler);this.refreshHandler=mxUtils.bind(this,function(a){this.outline.setStylesheet(this.source.getStylesheet());this.outline.refresh()});this.source.addListener(mxEvent.REFRESH,this.refreshHandler);this.bounds=new mxRectangle(0,0,0,0);this.selectionBorder=new mxRectangleShape(this.bounds,null,mxConstants.OUTLINE_COLOR,mxConstants.OUTLINE_STROKEWIDTH);
this.selectionBorder.dialect=this.outline.dialect;this.forceVmlHandles&&(this.selectionBorder.isHtmlAllowed=function(){return!1});this.selectionBorder.init(this.outline.getView().getOverlayPane());a=mxUtils.bind(this,function(a){var b=mxEvent.getSource(a),e=mxUtils.bind(this,function(a){this.outline.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a))}),f=mxUtils.bind(this,function(a){mxEvent.removeGestureListeners(b,null,e,f);this.outline.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a))});
mxEvent.addGestureListeners(b,null,e,f);this.outline.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a))});mxEvent.addGestureListeners(this.selectionBorder.node,a);this.sizer=this.createSizer();this.forceVmlHandles&&(this.sizer.isHtmlAllowed=function(){return!1});this.sizer.init(this.outline.getView().getOverlayPane());this.enabled&&(this.sizer.node.style.cursor="nwse-resize");mxEvent.addGestureListeners(this.sizer.node,a);this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=
this.selectionBorder.node.style.display;this.selectionBorder.node.style.cursor="move";this.update(!1)};mxOutline.prototype.isEnabled=function(){return this.enabled};mxOutline.prototype.setEnabled=function(a){this.enabled=a};mxOutline.prototype.setZoomEnabled=function(a){this.sizer.node.style.visibility=a?"visible":"hidden"};mxOutline.prototype.refresh=function(){this.update(!0)};
mxOutline.prototype.createSizer=function(){var a=null!=this.sizerImage?new mxImageShape(new mxRectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src):new mxRectangleShape(new mxRectangle(0,0,this.sizerSize,this.sizerSize),mxConstants.OUTLINE_HANDLE_FILLCOLOR,mxConstants.OUTLINE_HANDLE_STROKECOLOR);a.dialect=this.outline.dialect;return a};mxOutline.prototype.getSourceContainerSize=function(){return new mxRectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)};
mxOutline.prototype.getOutlineOffset=function(a){return null};mxOutline.prototype.getSourceGraphBounds=function(){return this.source.getGraphBounds()};
mxOutline.prototype.update=function(a){if(null!=this.source&&null!=this.outline){var b=this.source.view.scale,c=this.getSourceGraphBounds(),c=new mxRectangle(c.x/b+this.source.panDx,c.y/b+this.source.panDy,c.width/b,c.height/b),d=new mxRectangle(0,0,this.source.container.clientWidth/b,this.source.container.clientHeight/b),e=c.clone();e.add(d);var f=this.getSourceContainerSize(),d=Math.max(f.width/b,e.width),b=Math.max(f.height/b,e.height),e=Math.max(0,this.outline.container.clientWidth-this.border),
f=Math.max(0,this.outline.container.clientHeight-this.border),d=Math.min(e/d,f/b),e=Math.floor(100*d)/100;if(0<e){this.outline.getView().scale!=e&&(this.outline.getView().scale=e,a=!0);d=this.outline.getView();d.currentRoot!=this.source.getView().currentRoot&&d.setCurrentRoot(this.source.getView().currentRoot);var b=this.source.view.translate,f=b.x+this.source.panDx,g=b.y+this.source.panDy,e=this.getOutlineOffset(e);null!=e&&(f+=e.x,g+=e.y);0>c.x&&(f-=c.x);0>c.y&&(g-=c.y);if(d.translate.x!=f||d.translate.y!=
g)d.translate.x=f,d.translate.y=g,a=!0;var c=d.translate,e=this.source.getView().scale,f=e/d.scale,g=1/d.scale,k=this.source.container;this.bounds=new mxRectangle((c.x-b.x-this.source.panDx)/g,(c.y-b.y-this.source.panDy)/g,k.clientWidth/f,k.clientHeight/f);this.bounds.x+=this.source.container.scrollLeft*d.scale/e;this.bounds.y+=this.source.container.scrollTop*d.scale/e;c=this.selectionBorder.bounds;if(c.x!=this.bounds.x||c.y!=this.bounds.y||c.width!=this.bounds.width||c.height!=this.bounds.height)this.selectionBorder.bounds=
this.bounds,this.selectionBorder.redraw();c=this.sizer.bounds;d=new mxRectangle(this.bounds.x+this.bounds.width-c.width/2,this.bounds.y+this.bounds.height-c.height/2,c.width,c.height);if(c.x!=d.x||c.y!=d.y||c.width!=d.width||c.height!=d.height)this.sizer.bounds=d,"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw();a&&this.outline.view.revalidate()}}};
mxOutline.prototype.mouseDown=function(a,b){if(this.enabled&&this.showViewport){var c=mxEvent.isMouseEvent(b.getEvent())?0:this.source.tolerance,c=this.source.allowHandleBoundsCheck&&(mxClient.IS_IE||0<c)?new mxRectangle(b.getGraphX()-c,b.getGraphY()-c,2*c,2*c):null;this.zoom=b.isSource(this.sizer)||null!=c&&mxUtils.intersects(shape.bounds,c);this.startX=b.getX();this.startY=b.getY();this.active=!0;this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)?(this.dx0=this.source.container.scrollLeft,
this.dy0=this.source.container.scrollTop):this.dy0=this.dx0=0}b.consume()};
mxOutline.prototype.mouseMove=function(a,b){if(this.active){this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;var c=this.getTranslateForEvent(b),d=c.x,e=c.y;if(this.zoom)c=this.source.container,e=d/(c.clientWidth/c.clientHeight),c=new mxRectangle(this.bounds.x,this.bounds.y,Math.max(1,this.bounds.width+d),Math.max(1,this.bounds.height+e)),this.selectionBorder.bounds=c,this.selectionBorder.redraw();else{var f=this.outline.getView().scale,
c=new mxRectangle(this.bounds.x+d,this.bounds.y+e,this.bounds.width,this.bounds.height);this.selectionBorder.bounds=c;this.selectionBorder.redraw();d=d/f*this.source.getView().scale;e=e/f*this.source.getView().scale;this.source.panGraph(-d-this.dx0,-e-this.dy0)}d=this.sizer.bounds;this.sizer.bounds=new mxRectangle(c.x+c.width-d.width/2,c.y+c.height-d.height/2,d.width,d.height);"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw();b.consume()}};
mxOutline.prototype.getTranslateForEvent=function(a){return new mxPoint(a.getX()-this.startX,a.getY()-this.startY)};
mxOutline.prototype.mouseUp=function(a,b){if(this.active){var c=this.getTranslateForEvent(b),d=c.x,c=c.y;if(0<Math.abs(d)||0<Math.abs(c)){if(this.zoom){var c=this.selectionBorder.bounds.width,e=this.source.getView().scale;this.source.zoomTo(e-d*e/c,!1)}else this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)||(this.source.panGraph(0,0),d/=this.outline.getView().scale,c/=this.outline.getView().scale,e=this.source.getView().translate,this.source.getView().setTranslate(e.x-
d,e.y-c));this.update();b.consume()}this.index=null;this.active=!1}};
mxOutline.prototype.destroy=function(){null!=this.source&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),mxEvent.addListener(this.source.container,"scroll",this.updateHandler),this.source=null);null!=this.outline&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null);null!=this.selectionBorder&&(this.selectionBorder.destroy(),
this.selectionBorder=null);null!=this.sizer&&(this.sizer.destroy(),this.sizer=null)};function mxMultiplicity(a,b,c,d,e,f,g,k,l,m){this.source=a;this.type=b;this.attr=c;this.value=d;this.min=null!=e?e:0;this.max=null!=f?f:"n";this.validNeighbors=g;this.countError=mxResources.get(k)||k;this.typeError=mxResources.get(l)||l;this.validNeighborsAllowed=null!=m?m:!0}mxMultiplicity.prototype.type=null;mxMultiplicity.prototype.attr=null;mxMultiplicity.prototype.value=null;mxMultiplicity.prototype.source=null;
mxMultiplicity.prototype.min=null;mxMultiplicity.prototype.max=null;mxMultiplicity.prototype.validNeighbors=null;mxMultiplicity.prototype.validNeighborsAllowed=!0;mxMultiplicity.prototype.countError=null;mxMultiplicity.prototype.typeError=null;
mxMultiplicity.prototype.check=function(a,b,c,d,e,f){var g="";if(this.source&&this.checkTerminal(a,c,b)||!this.source&&this.checkTerminal(a,d,b))null!=this.countError&&(this.source&&(0==this.max||e>=this.max)||!this.source&&(0==this.max||f>=this.max))&&(g+=this.countError+"\n"),null!=this.validNeighbors&&null!=this.typeError&&0<this.validNeighbors.length&&(this.checkNeighbors(a,b,c,d)||(g+=this.typeError+"\n"));return 0<g.length?g:null};
mxMultiplicity.prototype.checkNeighbors=function(a,b,c,d){b=a.model.getValue(c);d=a.model.getValue(d);c=!this.validNeighborsAllowed;for(var e=this.validNeighbors,f=0;f<e.length;f++)if(this.source&&this.checkType(a,d,e[f])){c=this.validNeighborsAllowed;break}else if(!this.source&&this.checkType(a,b,e[f])){c=this.validNeighborsAllowed;break}return c};mxMultiplicity.prototype.checkTerminal=function(a,b,c){b=a.model.getValue(b);return this.checkType(a,b,this.type,this.attr,this.value)};
mxMultiplicity.prototype.checkType=function(a,b,c,d,e){return null!=b?isNaN(b.nodeType)?b==c:mxUtils.isNode(b,c,d,e):!1};function mxLayoutManager(a){this.undoHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.beforeUndo(c.getProperty("edit"))});this.moveHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.cellsMoved(c.getProperty("cells"),c.getProperty("event"))});this.setGraph(a)}mxLayoutManager.prototype=new mxEventSource;mxLayoutManager.prototype.constructor=mxLayoutManager;
mxLayoutManager.prototype.graph=null;mxLayoutManager.prototype.bubbling=!0;mxLayoutManager.prototype.enabled=!0;mxLayoutManager.prototype.updateHandler=null;mxLayoutManager.prototype.moveHandler=null;mxLayoutManager.prototype.isEnabled=function(){return this.enabled};mxLayoutManager.prototype.setEnabled=function(a){this.enabled=a};mxLayoutManager.prototype.isBubbling=function(){return this.bubbling};mxLayoutManager.prototype.setBubbling=function(a){this.bubbling=a};
mxLayoutManager.prototype.getGraph=function(){return this.graph};mxLayoutManager.prototype.setGraph=function(a){if(null!=this.graph){var b=this.graph.getModel();b.removeListener(this.undoHandler);this.graph.removeListener(this.moveHandler)}this.graph=a;null!=this.graph&&(b=this.graph.getModel(),b.addListener(mxEvent.BEFORE_UNDO,this.undoHandler),this.graph.addListener(mxEvent.MOVE_CELLS,this.moveHandler))};mxLayoutManager.prototype.getLayout=function(a){return null};
mxLayoutManager.prototype.beforeUndo=function(a){a=this.getCellsForChanges(a.changes);for(var b=this.getGraph().getModel(),c=[],d=0;d<a.length;d++)c=c.concat(b.getDescendants(a[d]));a=c;if(this.isBubbling())for(c=b.getParents(a);0<c.length;)a=a.concat(c),c=b.getParents(c);this.executeLayoutForCells(a)};mxLayoutManager.prototype.executeLayoutForCells=function(a){a=mxUtils.sortCells(a,!0);a=a.concat(a.slice().reverse());this.layoutCells(a)};
mxLayoutManager.prototype.cellsMoved=function(a,b){if(null!=a&&null!=b)for(var c=mxUtils.convertPoint(this.getGraph().container,mxEvent.getClientX(b),mxEvent.getClientY(b)),d=this.getGraph().getModel(),e=0;e<a.length;e++){var f=this.getLayout(d.getParent(a[e]));null!=f&&f.moveCell(a[e],c.x,c.y)}};
mxLayoutManager.prototype.getCellsForChanges=function(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d];if(e instanceof mxRootChange)return[];for(var e=this.getCellsForChange(e),f=0;f<e.length;f++)if(null!=e[f]){var g=mxCellPath.create(e[f]);null==c[g]&&(c[g]=e[f],b.push(e[f]))}}return b};
mxLayoutManager.prototype.getCellsForChange=function(a){var b=this.getGraph().getModel();return a instanceof mxChildChange?[a.child,a.previous,b.getParent(a.child)]:a instanceof mxTerminalChange||a instanceof mxGeometryChange?[a.cell,b.getParent(a.cell)]:a instanceof mxVisibleChange||a instanceof mxStyleChange?[a.cell]:[]};
mxLayoutManager.prototype.layoutCells=function(a){if(0<a.length){var b=this.getGraph().getModel();b.beginUpdate();try{for(var c=null,d=0;d<a.length;d++)a[d]!=b.getRoot()&&a[d]!=c&&this.executeLayout(this.getLayout(a[d]),a[d])&&(c=a[d]);this.fireEvent(new mxEventObject(mxEvent.LAYOUT_CELLS,"cells",a))}finally{b.endUpdate()}}};mxLayoutManager.prototype.executeLayout=function(a,b){var c=!1;null!=a&&null!=b&&(a.execute(b),c=!0);return c};mxLayoutManager.prototype.destroy=function(){this.setGraph(null)};
function mxSwimlaneManager(a,b,c,d){this.horizontal=null!=b?b:!0;this.addEnabled=null!=c?c:!0;this.resizeEnabled=null!=d?d:!0;this.addHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.isAddEnabled()&&this.cellsAdded(b.getProperty("cells"))});this.resizeHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.isResizeEnabled()&&this.cellsResized(b.getProperty("cells"))});this.setGraph(a)}mxSwimlaneManager.prototype=new mxEventSource;mxSwimlaneManager.prototype.constructor=mxSwimlaneManager;
mxSwimlaneManager.prototype.graph=null;mxSwimlaneManager.prototype.enabled=!0;mxSwimlaneManager.prototype.horizontal=!0;mxSwimlaneManager.prototype.addEnabled=!0;mxSwimlaneManager.prototype.resizeEnabled=!0;mxSwimlaneManager.prototype.addHandler=null;mxSwimlaneManager.prototype.resizeHandler=null;mxSwimlaneManager.prototype.isEnabled=function(){return this.enabled};mxSwimlaneManager.prototype.setEnabled=function(a){this.enabled=a};mxSwimlaneManager.prototype.isHorizontal=function(){return this.horizontal};
mxSwimlaneManager.prototype.setHorizontal=function(a){this.horizontal=a};mxSwimlaneManager.prototype.isAddEnabled=function(){return this.addEnabled};mxSwimlaneManager.prototype.setAddEnabled=function(a){this.addEnabled=a};mxSwimlaneManager.prototype.isResizeEnabled=function(){return this.resizeEnabled};mxSwimlaneManager.prototype.setResizeEnabled=function(a){this.resizeEnabled=a};mxSwimlaneManager.prototype.getGraph=function(){return this.graph};
mxSwimlaneManager.prototype.setGraph=function(a){null!=this.graph&&(this.graph.removeListener(this.addHandler),this.graph.removeListener(this.resizeHandler));this.graph=a;null!=this.graph&&(this.graph.addListener(mxEvent.ADD_CELLS,this.addHandler),this.graph.addListener(mxEvent.CELLS_RESIZED,this.resizeHandler))};mxSwimlaneManager.prototype.isSwimlaneIgnored=function(a){return!this.getGraph().isSwimlane(a)};
mxSwimlaneManager.prototype.isCellHorizontal=function(a){return this.graph.isSwimlane(a)?(a=this.graph.getCellStyle(a),1==mxUtils.getValue(a,mxConstants.STYLE_HORIZONTAL,1)):!this.isHorizontal()};mxSwimlaneManager.prototype.cellsAdded=function(a){if(null!=a){var b=this.getGraph().getModel();b.beginUpdate();try{for(var c=0;c<a.length;c++)this.isSwimlaneIgnored(a[c])||this.swimlaneAdded(a[c])}finally{b.endUpdate()}}};
mxSwimlaneManager.prototype.swimlaneAdded=function(a){for(var b=this.getGraph().getModel(),c=b.getParent(a),d=b.getChildCount(c),e=null,f=0;f<d;f++){var g=b.getChildAt(c,f);if(g!=a&&!this.isSwimlaneIgnored(g)&&(e=b.getGeometry(g),null!=e))break}null!=e&&(b=null!=c?this.isCellHorizontal(c):this.horizontal,this.resizeSwimlane(a,e.width,e.height,b))};
mxSwimlaneManager.prototype.cellsResized=function(a){if(null!=a){var b=this.getGraph().getModel();b.beginUpdate();try{for(var c=0;c<a.length;c++)if(!this.isSwimlaneIgnored(a[c])){var d=b.getGeometry(a[c]);if(null!=d){for(var e=new mxRectangle(0,0,d.width,d.height),f=a[c],g=f;null!=g;){var f=g,g=b.getParent(g),k=this.graph.isSwimlane(g)?this.graph.getStartSize(g):new mxRectangle;e.width+=k.width;e.height+=k.height}var l=null!=g?this.isCellHorizontal(g):this.horizontal;this.resizeSwimlane(f,e.width,
e.height,l)}}}finally{b.endUpdate()}}};
mxSwimlaneManager.prototype.resizeSwimlane=function(a,b,c,d){var e=this.getGraph().getModel();e.beginUpdate();try{var f=this.isCellHorizontal(a);if(!this.isSwimlaneIgnored(a)){var g=e.getGeometry(a);null!=g&&(d&&g.height!=c||!d&&g.width!=b)&&(g=g.clone(),d?g.height=c:g.width=b,e.setGeometry(a,g))}var k=this.graph.isSwimlane(a)?this.graph.getStartSize(a):new mxRectangle;b-=k.width;c-=k.height;var l=e.getChildCount(a);for(d=0;d<l;d++){var m=e.getChildAt(a,d);this.resizeSwimlane(m,b,c,f)}}finally{e.endUpdate()}};
mxSwimlaneManager.prototype.destroy=function(){this.setGraph(null)};
function mxTemporaryCellStates(a,b,c,d){b=null!=b?b:1;this.view=a;this.oldValidateCellState=a.validateCellState;this.oldBounds=a.getGraphBounds();this.oldStates=a.getStates();this.oldScale=a.getScale();var e=this;a.validateCellState=function(b,c){return null==b||null==d||d(b)?e.oldValidateCellState.apply(a,arguments):null};a.setStates(new mxDictionary);a.setScale(b);if(null!=c){a.resetValidationState();b=null;for(var f=0;f<c.length;f++){var g=a.getBoundingBox(a.validateCellState(a.validateCell(c[f])));
null==b?b=g:b.add(g)}a.setGraphBounds(b||new mxRectangle)}}mxTemporaryCellStates.prototype.view=null;mxTemporaryCellStates.prototype.oldStates=null;mxTemporaryCellStates.prototype.oldBounds=null;mxTemporaryCellStates.prototype.oldScale=null;mxTemporaryCellStates.prototype.destroy=function(){this.view.setScale(this.oldScale);this.view.setStates(this.oldStates);this.view.setGraphBounds(this.oldBounds);this.view.validateCellState=this.oldValidateCellState};
function mxCellStatePreview(a){this.deltas=new mxDictionary;this.graph=a}mxCellStatePreview.prototype.graph=null;mxCellStatePreview.prototype.deltas=null;mxCellStatePreview.prototype.count=0;mxCellStatePreview.prototype.isEmpty=function(){return 0==this.count};
mxCellStatePreview.prototype.moveState=function(a,b,c,d,e){d=null!=d?d:!0;e=null!=e?e:!0;var f=this.deltas.get(a.cell);null==f?(f={point:new mxPoint(b,c),state:a},this.deltas.put(a.cell,f),this.count++):d?(f.point.x+=b,f.point.y+=c):(f.point.x=b,f.point.y=c);e&&this.addEdges(a);return f.point};
mxCellStatePreview.prototype.show=function(a){this.deltas.visit(mxUtils.bind(this,function(a,c){this.translateState(c.state,c.point.x,c.point.y)}));this.deltas.visit(mxUtils.bind(this,function(b,c){this.revalidateState(c.state,c.point.x,c.point.y,a)}))};
mxCellStatePreview.prototype.translateState=function(a,b,c){if(null!=a){var d=this.graph.getModel();if(d.isVertex(a.cell)){a.view.updateCellState(a);var e=d.getGeometry(a.cell);0==b&&0==c||null==e||e.relative&&null==this.deltas.get(a.cell)||(a.x+=b,a.y+=c)}for(var e=d.getChildCount(a.cell),f=0;f<e;f++)this.translateState(a.view.getState(d.getChildAt(a.cell,f)),b,c)}};
mxCellStatePreview.prototype.revalidateState=function(a,b,c,d){if(null!=a){var e=this.graph.getModel();e.isEdge(a.cell)&&a.view.updateCellState(a);var f=this.graph.getCellGeometry(a.cell),g=a.view.getState(e.getParent(a.cell));0==b&&0==c||null==f||!f.relative||!e.isVertex(a.cell)||null!=g&&!e.isVertex(g.cell)&&null==this.deltas.get(a.cell)||(a.x+=b,a.y+=c);this.graph.cellRenderer.redraw(a);null!=d&&d(a);f=e.getChildCount(a.cell);for(g=0;g<f;g++)this.revalidateState(this.graph.view.getState(e.getChildAt(a.cell,
g)),b,c,d)}};mxCellStatePreview.prototype.addEdges=function(a){for(var b=this.graph.getModel(),c=b.getEdgeCount(a.cell),d=0;d<c;d++){var e=a.view.getState(b.getEdgeAt(a.cell,d));null!=e&&this.moveState(e,0,0)}};function mxConnectionConstraint(a,b){this.point=a;this.perimeter=null!=b?b:!0}mxConnectionConstraint.prototype.point=null;mxConnectionConstraint.prototype.perimeter=null;
function mxGraphHandler(a){this.graph=a;this.graph.addMouseListener(this);this.panHandler=mxUtils.bind(this,function(){this.updatePreviewShape();this.updateHint()});this.graph.addListener(mxEvent.PAN,this.panHandler);this.escapeHandler=mxUtils.bind(this,function(a,c){this.reset()});this.graph.addListener(mxEvent.ESCAPE,this.escapeHandler)}mxGraphHandler.prototype.graph=null;mxGraphHandler.prototype.maxCells=mxClient.IS_IE?20:50;mxGraphHandler.prototype.enabled=!0;
mxGraphHandler.prototype.highlightEnabled=!0;mxGraphHandler.prototype.cloneEnabled=!0;mxGraphHandler.prototype.moveEnabled=!0;mxGraphHandler.prototype.guidesEnabled=!1;mxGraphHandler.prototype.guide=null;mxGraphHandler.prototype.currentDx=null;mxGraphHandler.prototype.currentDy=null;mxGraphHandler.prototype.updateCursor=!0;mxGraphHandler.prototype.selectEnabled=!0;mxGraphHandler.prototype.removeCellsFromParent=!0;mxGraphHandler.prototype.connectOnDrop=!1;mxGraphHandler.prototype.scrollOnMove=!0;
mxGraphHandler.prototype.minimumSize=6;mxGraphHandler.prototype.previewColor="black";mxGraphHandler.prototype.htmlPreview=!1;mxGraphHandler.prototype.shape=null;mxGraphHandler.prototype.scaleGrid=!1;mxGraphHandler.prototype.rotationEnabled=!0;mxGraphHandler.prototype.isEnabled=function(){return this.enabled};mxGraphHandler.prototype.setEnabled=function(a){this.enabled=a};mxGraphHandler.prototype.isCloneEnabled=function(){return this.cloneEnabled};
mxGraphHandler.prototype.setCloneEnabled=function(a){this.cloneEnabled=a};mxGraphHandler.prototype.isMoveEnabled=function(){return this.moveEnabled};mxGraphHandler.prototype.setMoveEnabled=function(a){this.moveEnabled=a};mxGraphHandler.prototype.isSelectEnabled=function(){return this.selectEnabled};mxGraphHandler.prototype.setSelectEnabled=function(a){this.selectEnabled=a};mxGraphHandler.prototype.isRemoveCellsFromParent=function(){return this.removeCellsFromParent};
mxGraphHandler.prototype.setRemoveCellsFromParent=function(a){this.removeCellsFromParent=a};mxGraphHandler.prototype.getInitialCellForEvent=function(a){return a.getCell()};mxGraphHandler.prototype.isDelayedSelection=function(a,b){return this.graph.isCellSelected(a)};
mxGraphHandler.prototype.mouseDown=function(a,b){if(!b.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null!=b.getState()&&!mxEvent.isMultiTouchEvent(b.getEvent())){var c=this.getInitialCellForEvent(b);this.delayedSelection=this.isDelayedSelection(c,b);this.cell=null;this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(c,b.getEvent());if(this.isMoveEnabled()){var d=this.graph.model,e=d.getGeometry(c);this.graph.isCellMovable(c)&&(!d.isEdge(c)||1<this.graph.getSelectionCount()||
null!=e.points&&0<e.points.length||null==d.getTerminal(c,!0)||null==d.getTerminal(c,!1)||this.graph.allowDanglingEdges||this.graph.isCloneEvent(b.getEvent())&&this.graph.isCellsCloneable())&&this.start(c,b.getX(),b.getY());this.cellWasClicked=!0;b.consume()}}};
mxGraphHandler.prototype.getGuideStates=function(){var a=this.graph.getDefaultParent(),b=this.graph.getModel(),c=mxUtils.bind(this,function(a){return null!=this.graph.view.getState(a)&&b.isVertex(a)&&null!=b.getGeometry(a)&&!b.getGeometry(a).relative});return this.graph.view.getCellStates(b.filterDescendants(c,a))};mxGraphHandler.prototype.getCells=function(a){return!this.delayedSelection&&this.graph.isCellMovable(a)?[a]:this.graph.getMovableCells(this.graph.getSelectionCells())};
mxGraphHandler.prototype.getPreviewBounds=function(a){a=this.getBoundingBox(a);null!=a&&(a.width=Math.max(0,a.width-1),a.height=Math.max(0,a.height-1),a.width<this.minimumSize?(a.x-=(this.minimumSize-a.width)/2,a.width=this.minimumSize):(a.x=Math.floor(a.x),a.width=Math.ceil(a.width)),a.height<this.minimumSize?(a.y-=(this.minimumSize-a.height)/2,a.height=this.minimumSize):(a.y=Math.floor(a.y),a.height=Math.ceil(a.height)));return a};
mxGraphHandler.prototype.getBoundingBox=function(a){var b=null;if(null!=a&&0<a.length)for(var c=this.graph.getModel(),d=0;d<a.length;d++)if(c.isVertex(a[d])||c.isEdge(a[d])){var e=this.graph.view.getState(a[d]);if(null!=e){var f=e;c.isVertex(a[d])&&null!=e.shape&&null!=e.shape.boundingBox&&(f=e.shape.boundingBox);null==b?b=mxRectangle.fromRectangle(f):b.add(f)}}return b};
mxGraphHandler.prototype.createPreviewShape=function(a){a=new mxRectangleShape(a,null,this.previewColor);a.isDashed=!0;this.htmlPreview?(a.dialect=mxConstants.DIALECT_STRICTHTML,a.init(this.graph.container)):(a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,a.init(this.graph.getView().getOverlayPane()),a.pointerEvents=!1,mxClient.IS_IOS&&(a.getSvgScreenOffset=function(){return 0}));return a};
mxGraphHandler.prototype.start=function(a,b,c){this.cell=a;this.first=mxUtils.convertPoint(this.graph.container,b,c);this.cells=this.getCells(this.cell);this.bounds=this.graph.getView().getBounds(this.cells);this.pBounds=this.getPreviewBounds(this.cells);this.guidesEnabled&&(this.guide=new mxGuide(this.graph,this.getGuideStates()))};mxGraphHandler.prototype.useGuidesForEvent=function(a){return null!=this.guide?this.guide.isEnabledForEvent(a.getEvent()):!0};
mxGraphHandler.prototype.snap=function(a){var b=this.scaleGrid?this.graph.view.scale:1;a.x=this.graph.snap(a.x/b)*b;a.y=this.graph.snap(a.y/b)*b;return a};mxGraphHandler.prototype.getDelta=function(a){a=mxUtils.convertPoint(this.graph.container,a.getX(),a.getY());var b=this.graph.view.scale;return new mxPoint(this.roundLength((a.x-this.first.x)/b)*b,this.roundLength((a.y-this.first.y)/b)*b)};mxGraphHandler.prototype.updateHint=function(a){};mxGraphHandler.prototype.removeHint=function(){};
mxGraphHandler.prototype.roundLength=function(a){return Math.round(a)};
mxGraphHandler.prototype.mouseMove=function(a,b){var c=this.graph;if(!b.isConsumed()&&c.isMouseDown&&null!=this.cell&&null!=this.first&&null!=this.bounds)if(mxEvent.isMultiTouchEvent(b.getEvent()))this.reset();else{var d=this.getDelta(b),e=d.x,d=d.y,f=c.tolerance;if(null!=this.shape||Math.abs(e)>f||Math.abs(d)>f){null==this.highlight&&(this.highlight=new mxCellHighlight(this.graph,mxConstants.DROP_TARGET_COLOR,3));null==this.shape&&(this.shape=this.createPreviewShape(this.bounds));var g=c.isGridEnabledEvent(b.getEvent()),
f=!0;if(null!=this.guide&&this.useGuidesForEvent(b))d=this.guide.move(this.bounds,new mxPoint(e,d),g),f=!1,e=d.x,d=d.y;else if(g)var k=c.getView().translate,l=c.getView().scale,g=this.bounds.x-(c.snap(this.bounds.x/l-k.x)+k.x)*l,k=this.bounds.y-(c.snap(this.bounds.y/l-k.y)+k.y)*l,d=this.snap(new mxPoint(e,d)),e=d.x-g,d=d.y-k;null!=this.guide&&f&&this.guide.hide();c.isConstrainedEvent(b.getEvent())&&(Math.abs(e)>Math.abs(d)?d=0:e=0);this.currentDx=e;this.currentDy=d;this.updatePreviewShape();f=null;
d=b.getCell();g=c.isCloneEvent(b.getEvent())&&c.isCellsCloneable()&&this.isCloneEnabled();c.isDropEnabled()&&this.highlightEnabled&&(f=c.getDropTarget(this.cells,b.getEvent(),d,g));e=c.getView().getState(f);k=!1;null==e||c.model.getParent(this.cell)==f&&!g?(this.target=null,this.connectOnDrop&&null!=d&&1==this.cells.length&&c.getModel().isVertex(d)&&c.isCellConnectable(d)&&(e=c.getView().getState(d),null!=e&&(c=null==c.getEdgeValidationError(null,this.cell,d)?mxConstants.VALID_COLOR:mxConstants.INVALID_CONNECT_TARGET_COLOR,
this.setHighlightColor(c),k=!0))):(this.target!=f&&(this.target=f,this.setHighlightColor(mxConstants.DROP_TARGET_COLOR)),k=!0);null!=e&&k?this.highlight.highlight(e):this.highlight.hide()}this.updateHint(b);b.consume();mxEvent.consume(b.getEvent())}else!this.isMoveEnabled()&&!this.isCloneEnabled()||!this.updateCursor||b.isConsumed()||null==b.getState()||c.isMouseDown||(e=c.getCursorForMouseEvent(b),null==e&&c.isEnabled()&&c.isCellMovable(b.getCell())&&(e=c.getModel().isEdge(b.getCell())?mxConstants.CURSOR_MOVABLE_EDGE:
mxConstants.CURSOR_MOVABLE_VERTEX),null!=b.sourceState&&b.sourceState.setCursor(e))};mxGraphHandler.prototype.updatePreviewShape=function(){null!=this.shape&&(this.shape.bounds=new mxRectangle(Math.round(this.pBounds.x+this.currentDx-this.graph.panDx),Math.round(this.pBounds.y+this.currentDy-this.graph.panDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())};mxGraphHandler.prototype.setHighlightColor=function(a){null!=this.highlight&&this.highlight.setHighlightColor(a)};
mxGraphHandler.prototype.mouseUp=function(a,b){if(!b.isConsumed()){var c=this.graph;if(null!=this.cell&&null!=this.first&&null!=this.shape&&null!=this.currentDx&&null!=this.currentDy){var d=b.getCell();if(this.connectOnDrop&&null==this.target&&null!=d&&c.getModel().isVertex(d)&&c.isCellConnectable(d)&&c.isEdgeValid(null,this.cell,d))c.connectionHandler.connect(this.cell,d,b.getEvent());else{var d=c.isCloneEvent(b.getEvent())&&c.isCellsCloneable()&&this.isCloneEnabled(),e=c.getView().scale,f=this.roundLength(this.currentDx/
e),e=this.roundLength(this.currentDy/e),g=this.target;c.isSplitEnabled()&&c.isSplitTarget(g,this.cells,b.getEvent())?c.splitEdge(g,this.cells,null,f,e):this.moveCells(this.cells,f,e,d,this.target,b.getEvent())}}else this.isSelectEnabled()&&this.delayedSelection&&null!=this.cell&&this.selectDelayed(b)}this.cellWasClicked&&b.consume();this.reset()};
mxGraphHandler.prototype.selectDelayed=function(a){this.graph.isCellSelected(this.cell)&&this.graph.popupMenuHandler.isPopupTrigger(a)||this.graph.selectCellForEvent(this.cell,a.getEvent())};mxGraphHandler.prototype.reset=function(){this.destroyShapes();this.removeHint();this.delayedSelection=this.cellWasClicked=!1;this.target=this.cell=this.first=this.guides=this.currentDy=this.currentDx=null};
mxGraphHandler.prototype.shouldRemoveCellsFromParent=function(a,b,c){if(this.graph.getModel().isVertex(a)){a=this.graph.getView().getState(a);c=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(c),mxEvent.getClientY(c));var d=mxUtils.toRadians(mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION)||0);if(0!=d){b=Math.cos(-d);var d=Math.sin(-d),e=new mxPoint(a.getCenterX(),a.getCenterY());c=mxUtils.getRotatedPoint(c,b,d,e)}return null!=a&&!mxUtils.contains(a,c.x,c.y)}return!1};
mxGraphHandler.prototype.moveCells=function(a,b,c,d,e,f){d&&(a=this.graph.getCloneableCells(a));null==e&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(this.graph.getModel().getParent(this.cell),a,f)&&(e=this.graph.getDefaultParent());a=this.graph.moveCells(a,b-this.graph.panDx/this.graph.view.scale,c-this.graph.panDy/this.graph.view.scale,d,e,f);this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(a[0]);d&&this.graph.setSelectionCells(a)};
mxGraphHandler.prototype.destroyShapes=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.guide&&(this.guide.destroy(),this.guide=null);null!=this.highlight&&(this.highlight.destroy(),this.highlight=null)};mxGraphHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.panHandler);null!=this.escapeHandler&&(this.graph.removeListener(this.escapeHandler),this.escapeHandler=null);this.destroyShapes();this.removeHint()};
function mxPanningHandler(a){null!=a&&(this.graph=a,this.graph.addMouseListener(this),this.forcePanningHandler=mxUtils.bind(this,function(a,c){var d=c.getProperty("eventName"),e=c.getProperty("event");d==mxEvent.MOUSE_DOWN&&this.isForcePanningEvent(e)&&(this.start(e),this.active=!0,this.fireEvent(new mxEventObject(mxEvent.PAN_START,"event",e)),e.consume())}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forcePanningHandler),this.gestureHandler=mxUtils.bind(this,function(a,c){if(this.isPinchEnabled()){var d=
c.getProperty("event");mxEvent.isConsumed(d)||"gesturestart"!=d.type?"gestureend"==d.type&&null==this.initialScale&&(this.initialScale=null):(this.initialScale=this.graph.view.scale,!this.active&&null!=this.mouseDownEvent&&(this.start(this.mouseDownEvent),this.mouseDownEvent=null));if(null!=this.initialScale){var e=Math.round(100*this.initialScale*d.scale)/100;null!=this.minScale&&(e=Math.max(this.minScale,e));null!=this.maxScale&&(e=Math.min(this.maxScale,e));this.graph.view.scale!=e&&(this.graph.zoomTo(e),
mxEvent.consume(d))}}}),this.graph.addListener(mxEvent.GESTURE,this.gestureHandler))}mxPanningHandler.prototype=new mxEventSource;mxPanningHandler.prototype.constructor=mxPanningHandler;mxPanningHandler.prototype.graph=null;mxPanningHandler.prototype.useLeftButtonForPanning=!1;mxPanningHandler.prototype.usePopupTrigger=!0;mxPanningHandler.prototype.ignoreCell=!1;mxPanningHandler.prototype.previewEnabled=!0;mxPanningHandler.prototype.useGrid=!1;mxPanningHandler.prototype.panningEnabled=!0;
mxPanningHandler.prototype.pinchEnabled=!0;mxPanningHandler.prototype.maxScale=8;mxPanningHandler.prototype.minScale=0.01;mxPanningHandler.prototype.dx=null;mxPanningHandler.prototype.dy=null;mxPanningHandler.prototype.startX=0;mxPanningHandler.prototype.startY=0;mxPanningHandler.prototype.isActive=function(){return this.active||null!=this.initialScale};mxPanningHandler.prototype.isPanningEnabled=function(){return this.panningEnabled};
mxPanningHandler.prototype.setPanningEnabled=function(a){this.panningEnabled=a};mxPanningHandler.prototype.isPinchEnabled=function(){return this.pinchEnabled};mxPanningHandler.prototype.setPinchEnabled=function(a){this.pinchEnabled=a};mxPanningHandler.prototype.isPanningTrigger=function(a){var b=a.getEvent();return this.useLeftButtonForPanning&&null==a.getState()&&mxEvent.isLeftMouseButton(b)||mxEvent.isControlDown(b)&&mxEvent.isShiftDown(b)||this.usePopupTrigger&&mxEvent.isPopupTrigger(b)};
mxPanningHandler.prototype.isForcePanningEvent=function(a){return this.ignoreCell||mxEvent.isMultiTouchEvent(a.getEvent())};mxPanningHandler.prototype.mouseDown=function(a,b){this.mouseDownEvent=b;!b.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(b)&&(this.start(b),this.consumePanningTrigger(b))};
mxPanningHandler.prototype.start=function(a){this.dx0=-this.graph.container.scrollLeft;this.dy0=-this.graph.container.scrollTop;this.startX=a.getX();this.startY=a.getY();this.dy=this.dx=null;this.panningTrigger=!0};mxPanningHandler.prototype.consumePanningTrigger=function(a){a.consume()};
mxPanningHandler.prototype.mouseMove=function(a,b){this.dx=b.getX()-this.startX;this.dy=b.getY()-this.startY;if(this.active)this.previewEnabled&&(this.useGrid&&(this.dx=this.graph.snap(this.dx),this.dy=this.graph.snap(this.dy)),this.graph.panGraph(this.dx+this.dx0,this.dy+this.dy0)),this.fireEvent(new mxEventObject(mxEvent.PAN,"event",b));else if(this.panningTrigger){var c=this.active;this.active=Math.abs(this.dx)>this.graph.tolerance||Math.abs(this.dy)>this.graph.tolerance;!c&&this.active&&this.fireEvent(new mxEventObject(mxEvent.PAN_START,
"event",b))}(this.active||this.panningTrigger)&&b.consume()};
mxPanningHandler.prototype.mouseUp=function(a,b){if(this.active){if(null!=this.dx&&null!=this.dy){if(!this.graph.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.graph.container)){var c=this.graph.getView().scale,d=this.graph.getView().translate;this.graph.panGraph(0,0);this.panGraph(d.x+this.dx/c,d.y+this.dy/c)}b.consume()}this.fireEvent(new mxEventObject(mxEvent.PAN_END,"event",b))}this.panningTrigger=!1;this.mouseDownEvent=null;this.active=!1;this.dy=this.dx=null};
mxPanningHandler.prototype.panGraph=function(a,b){this.graph.getView().setTranslate(a,b)};mxPanningHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.forcePanningHandler);this.graph.removeListener(this.gestureHandler)};
function mxPopupMenuHandler(a,b){null!=a&&(this.graph=a,this.factoryMethod=b,this.graph.addMouseListener(this),this.gestureHandler=mxUtils.bind(this,function(a,b){this.inTolerance=!1}),this.graph.addListener(mxEvent.GESTURE,this.gestureHandler),this.init())}mxPopupMenuHandler.prototype=new mxPopupMenu;mxPopupMenuHandler.prototype.constructor=mxPopupMenuHandler;mxPopupMenuHandler.prototype.graph=null;mxPopupMenuHandler.prototype.selectOnPopup=!0;
mxPopupMenuHandler.prototype.clearSelectionOnBackground=!0;mxPopupMenuHandler.prototype.triggerX=null;mxPopupMenuHandler.prototype.triggerY=null;mxPopupMenuHandler.prototype.screenX=null;mxPopupMenuHandler.prototype.screenY=null;mxPopupMenuHandler.prototype.init=function(){mxPopupMenu.prototype.init.apply(this);mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(a){this.graph.tooltipHandler.hide()}))};mxPopupMenuHandler.prototype.isSelectOnPopup=function(a){return this.selectOnPopup};
mxPopupMenuHandler.prototype.mouseDown=function(a,b){this.isEnabled()&&!mxEvent.isMultiTouchEvent(b.getEvent())&&(this.hideMenu(),this.triggerX=b.getGraphX(),this.triggerY=b.getGraphY(),this.screenX=mxEvent.getMainEvent(b.getEvent()).screenX,this.screenY=mxEvent.getMainEvent(b.getEvent()).screenY,this.popupTrigger=this.isPopupTrigger(b),this.inTolerance=!0)};
mxPopupMenuHandler.prototype.mouseMove=function(a,b){this.inTolerance&&null!=this.screenX&&null!=this.screenY&&(Math.abs(mxEvent.getMainEvent(b.getEvent()).screenX-this.screenX)>this.graph.tolerance||Math.abs(mxEvent.getMainEvent(b.getEvent()).screenY-this.screenY)>this.graph.tolerance)&&(this.inTolerance=!1)};
mxPopupMenuHandler.prototype.mouseUp=function(a,b){if(this.popupTrigger&&this.inTolerance&&null!=this.triggerX&&null!=this.triggerY){var c=this.getCellForPopupEvent(b);this.graph.isEnabled()&&this.isSelectOnPopup(b)&&null!=c&&!this.graph.isCellSelected(c)?this.graph.setSelectionCell(c):this.clearSelectionOnBackground&&null==c&&this.graph.clearSelection();this.graph.tooltipHandler.hide();var d=mxUtils.getScrollOrigin();this.popup(b.getX()+d.x+1,b.getY()+d.y+1,c,b.getEvent());b.consume()}this.inTolerance=
this.popupTrigger=!1};mxPopupMenuHandler.prototype.getCellForPopupEvent=function(a){return a.getCell()};mxPopupMenuHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.gestureHandler);mxPopupMenu.prototype.destroy.apply(this)};
function mxCellMarker(a,b,c,d){mxEventSource.call(this);null!=a&&(this.graph=a,this.validColor=null!=b?b:mxConstants.DEFAULT_VALID_COLOR,this.invalidColor=null!=b?c:mxConstants.DEFAULT_INVALID_COLOR,this.hotspot=null!=d?d:mxConstants.DEFAULT_HOTSPOT,this.highlight=new mxCellHighlight(a))}mxUtils.extend(mxCellMarker,mxEventSource);mxCellMarker.prototype.graph=null;mxCellMarker.prototype.enabled=!0;mxCellMarker.prototype.hotspot=mxConstants.DEFAULT_HOTSPOT;mxCellMarker.prototype.hotspotEnabled=!1;
mxCellMarker.prototype.validColor=null;mxCellMarker.prototype.invalidColor=null;mxCellMarker.prototype.currentColor=null;mxCellMarker.prototype.validState=null;mxCellMarker.prototype.markedState=null;mxCellMarker.prototype.setEnabled=function(a){this.enabled=a};mxCellMarker.prototype.isEnabled=function(){return this.enabled};mxCellMarker.prototype.setHotspot=function(a){this.hotspot=a};mxCellMarker.prototype.getHotspot=function(){return this.hotspot};
mxCellMarker.prototype.setHotspotEnabled=function(a){this.hotspotEnabled=a};mxCellMarker.prototype.isHotspotEnabled=function(){return this.hotspotEnabled};mxCellMarker.prototype.hasValidState=function(){return null!=this.validState};mxCellMarker.prototype.getValidState=function(){return this.validState};mxCellMarker.prototype.getMarkedState=function(){return this.markedState};mxCellMarker.prototype.reset=function(){this.validState=null;null!=this.markedState&&(this.markedState=null,this.unmark())};
mxCellMarker.prototype.process=function(a){var b=null;this.isEnabled()&&(b=this.getState(a),this.setCurrentState(b,a));return b};mxCellMarker.prototype.setCurrentState=function(a,b,c){var d=null!=a?this.isValidState(a):!1;c=null!=c?c:this.getMarkerColor(b.getEvent(),a,d);this.validState=d?a:null;if(a!=this.markedState||c!=this.currentColor)this.currentColor=c,null!=a&&null!=this.currentColor?(this.markedState=a,this.mark()):null!=this.markedState&&(this.markedState=null,this.unmark())};
mxCellMarker.prototype.markCell=function(a,b){var c=this.graph.getView().getState(a);null!=c&&(this.currentColor=null!=b?b:this.validColor,this.markedState=c,this.mark())};mxCellMarker.prototype.mark=function(){this.highlight.setHighlightColor(this.currentColor);this.highlight.highlight(this.markedState);this.fireEvent(new mxEventObject(mxEvent.MARK,"state",this.markedState))};mxCellMarker.prototype.unmark=function(){this.mark()};mxCellMarker.prototype.isValidState=function(a){return!0};
mxCellMarker.prototype.getMarkerColor=function(a,b,c){return c?this.validColor:this.invalidColor};mxCellMarker.prototype.getState=function(a){var b=this.graph.getView();cell=this.getCell(a);b=this.getStateToMark(b.getState(cell));return null!=b&&this.intersects(b,a)?b:null};mxCellMarker.prototype.getCell=function(a){return a.getCell()};mxCellMarker.prototype.getStateToMark=function(a){return a};
mxCellMarker.prototype.intersects=function(a,b){return this.hotspotEnabled?mxUtils.intersectsHotspot(a,b.getGraphX(),b.getGraphY(),this.hotspot,mxConstants.MIN_HOTSPOT_SIZE,mxConstants.MAX_HOTSPOT_SIZE):!0};mxCellMarker.prototype.destroy=function(){this.graph.getView().removeListener(this.resetHandler);this.graph.getModel().removeListener(this.resetHandler);this.highlight.destroy()};
function mxSelectionCellsHandler(a){mxEventSource.call(this);this.graph=a;this.handlers=new mxDictionary;this.graph.addMouseListener(this);this.refreshHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.refresh()});this.graph.getSelectionModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getView().addListener(mxEvent.SCALE,this.refreshHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.refreshHandler);
this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.refreshHandler);this.graph.getView().addListener(mxEvent.DOWN,this.refreshHandler);this.graph.getView().addListener(mxEvent.UP,this.refreshHandler)}mxUtils.extend(mxSelectionCellsHandler,mxEventSource);mxSelectionCellsHandler.prototype.graph=null;mxSelectionCellsHandler.prototype.enabled=!0;mxSelectionCellsHandler.prototype.refreshHandler=null;mxSelectionCellsHandler.prototype.maxHandlers=100;
mxSelectionCellsHandler.prototype.handlers=null;mxSelectionCellsHandler.prototype.isEnabled=function(){return this.enabled};mxSelectionCellsHandler.prototype.setEnabled=function(a){this.enabled=a};mxSelectionCellsHandler.prototype.getHandler=function(a){return this.handlers.get(a)};mxSelectionCellsHandler.prototype.reset=function(){this.handlers.visit(function(a,b){b.reset.apply(b)})};
mxSelectionCellsHandler.prototype.refresh=function(){var a=this.handlers;this.handlers=new mxDictionary;for(var b=this.graph.getSelectionCells(),c=0;c<b.length;c++){var d=this.graph.view.getState(b[c]);if(null!=d){var e=a.remove(b[c]);null!=e&&(e.state!=d?(e.destroy(),e=null):(null!=e.refresh&&e.refresh(),e.redraw()));null==e&&(e=this.graph.createHandler(d),this.fireEvent(new mxEventObject(mxEvent.ADD,"state",d)));null!=e&&this.handlers.put(b[c],e)}}a.visit(mxUtils.bind(this,function(a,b){this.fireEvent(new mxEventObject(mxEvent.REMOVE,
"state",b.state));b.destroy()}))};mxSelectionCellsHandler.prototype.mouseDown=function(a,b){if(this.graph.isEnabled()&&this.isEnabled()){var c=[a,b];this.handlers.visit(function(a,b){b.mouseDown.apply(b,c)})}};mxSelectionCellsHandler.prototype.mouseMove=function(a,b){if(this.graph.isEnabled()&&this.isEnabled()){var c=[a,b];this.handlers.visit(function(a,b){b.mouseMove.apply(b,c)})}};
mxSelectionCellsHandler.prototype.mouseUp=function(a,b){if(this.graph.isEnabled()&&this.isEnabled()){var c=[a,b];this.handlers.visit(function(a,b){b.mouseUp.apply(b,c)})}};mxSelectionCellsHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);null!=this.refreshHandler&&(this.graph.getSelectionModel().removeListener(this.refreshHandler),this.graph.getModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler),this.refreshHandler=null)};
function mxConnectionHandler(a,b){mxEventSource.call(this);null!=a&&(this.graph=a,this.factoryMethod=b,this.init(),this.escapeHandler=mxUtils.bind(this,function(a,b){this.reset()}),this.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}mxUtils.extend(mxConnectionHandler,mxEventSource);mxConnectionHandler.prototype.graph=null;mxConnectionHandler.prototype.factoryMethod=!0;mxConnectionHandler.prototype.moveIconFront=!1;mxConnectionHandler.prototype.moveIconBack=!1;
mxConnectionHandler.prototype.connectImage=null;mxConnectionHandler.prototype.targetConnectImage=!1;mxConnectionHandler.prototype.enabled=!0;mxConnectionHandler.prototype.select=!0;mxConnectionHandler.prototype.createTarget=!1;mxConnectionHandler.prototype.marker=null;mxConnectionHandler.prototype.constraintHandler=null;mxConnectionHandler.prototype.error=null;mxConnectionHandler.prototype.waypointsEnabled=!1;mxConnectionHandler.prototype.ignoreMouseDown=!1;mxConnectionHandler.prototype.first=null;
mxConnectionHandler.prototype.connectIconOffset=new mxPoint(0,mxConstants.TOOLTIP_VERTICAL_OFFSET);mxConnectionHandler.prototype.edgeState=null;mxConnectionHandler.prototype.changeHandler=null;mxConnectionHandler.prototype.drillHandler=null;mxConnectionHandler.prototype.mouseDownCounter=0;mxConnectionHandler.prototype.movePreviewAway=mxClient.IS_VML;mxConnectionHandler.prototype.outlineConnect=!1;mxConnectionHandler.prototype.isEnabled=function(){return this.enabled};
mxConnectionHandler.prototype.setEnabled=function(a){this.enabled=a};mxConnectionHandler.prototype.isCreateTarget=function(){return this.createTarget};mxConnectionHandler.prototype.setCreateTarget=function(a){this.createTarget=a};
mxConnectionHandler.prototype.createShape=function(){var a=new mxPolyline([],mxConstants.INVALID_COLOR);a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;a.pointerEvents=!1;a.isDashed=!0;a.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(a.node,this.graph,null);return a};
mxConnectionHandler.prototype.init=function(){this.graph.addMouseListener(this);this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.changeHandler=mxUtils.bind(this,function(a){null!=this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell));null!=this.iconState?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.reset()});this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE,
this.changeHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.changeHandler);this.drillHandler=mxUtils.bind(this,function(a){this.reset()});this.graph.addListener(mxEvent.START_EDITING,this.drillHandler);this.graph.getView().addListener(mxEvent.DOWN,this.drillHandler);this.graph.getView().addListener(mxEvent.UP,this.drillHandler)};mxConnectionHandler.prototype.isConnectableCell=function(a){return!0};
mxConnectionHandler.prototype.createMarker=function(){var a=new mxCellMarker(this.graph);a.hotspotEnabled=!0;a.getCell=mxUtils.bind(this,function(b,c){c=mxCellMarker.prototype.getCell.apply(a,arguments);var d=this.graph.view.scale,d=new mxPoint(this.graph.snap(b.getGraphX()/d)*d,this.graph.snap(b.getGraphY()/d)*d);this.error=null;null==c&&(c=this.getCellAt(d.x,d.y));if(this.graph.isSwimlane(c)&&this.graph.hitsSwimlaneContent(c,d.x,d.y)||!this.isConnectableCell(c))c=null;null!=c?this.isConnecting()?
null!=this.previous&&(this.error=this.validateConnection(this.previous.cell,c),null!=this.error&&0==this.error.length&&(c=null,this.isCreateTarget()&&(this.error=null))):this.isValidSource(c,b)||(c=null):this.isConnecting()&&!this.isCreateTarget()&&!this.graph.allowDanglingEdges&&(this.error="");return c});a.isValidState=mxUtils.bind(this,function(b){return this.isConnecting()?null==this.error:mxCellMarker.prototype.isValidState.apply(a,arguments)});a.getMarkerColor=mxUtils.bind(this,function(b,c,
d){return null==this.connectImage||this.isConnecting()?mxCellMarker.prototype.getMarkerColor.apply(a,arguments):null});a.intersects=mxUtils.bind(this,function(b,c){return null!=this.connectImage||this.isConnecting()?!0:mxCellMarker.prototype.intersects.apply(a,arguments)});return a};
mxConnectionHandler.prototype.start=function(a,b,c,d){this.previous=a;this.first=new mxPoint(b,c);this.edgeState=null!=d?d:this.createEdgeState(null);this.marker.currentColor=this.marker.validColor;this.marker.markedState=a;this.marker.mark();this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous))};mxConnectionHandler.prototype.getCellAt=function(a,b){return this.outlineConnect?null:this.graph.getCellAt(a,b)};
mxConnectionHandler.prototype.isConnecting=function(){return null!=this.first&&null!=this.shape};mxConnectionHandler.prototype.isValidSource=function(a,b){return this.graph.isValidSource(a)};mxConnectionHandler.prototype.isValidTarget=function(a){return!0};mxConnectionHandler.prototype.validateConnection=function(a,b){return this.isValidTarget(b)?this.graph.getEdgeValidationError(null,a,b):""};mxConnectionHandler.prototype.getConnectImage=function(a){return this.connectImage};
mxConnectionHandler.prototype.isMoveIconToFrontForState=function(a){return null!=a.text&&a.text.node.parentNode==this.graph.container?!0:this.moveIconFront};
mxConnectionHandler.prototype.createIcons=function(a){var b=this.getConnectImage(a);if(null!=b&&null!=a){this.iconState=a;var c=[],d=new mxRectangle(0,0,b.width,b.height),e=new mxImageShape(d,b.src,null,null,0);e.preserveImageAspect=!1;this.isMoveIconToFrontForState(a)?(e.dialect=mxConstants.DIALECT_STRICTHTML,e.init(this.graph.container)):(e.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,e.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&
null!=e.node.previousSibling&&e.node.parentNode.insertBefore(e.node,e.node.parentNode.firstChild));e.node.style.cursor=mxConstants.CURSOR_CONNECT;var f=mxUtils.bind(this,function(){return null!=this.currentState?this.currentState:a}),b=mxUtils.bind(this,function(a){mxEvent.isConsumed(a)||(this.icon=e,this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a,f())))});mxEvent.redirectMouseEvents(e.node,this.graph,f,b);c.push(e);this.redrawIcons(c,this.iconState);return c}return null};
mxConnectionHandler.prototype.redrawIcons=function(a,b){if(null!=a&&null!=a[0]&&null!=b){var c=this.getIconPosition(a[0],b);a[0].bounds.x=c.x;a[0].bounds.y=c.y;a[0].redraw()}};
mxConnectionHandler.prototype.getIconPosition=function(a,b){var c=this.graph.getView().scale,d=b.getCenterX(),e=b.getCenterY();if(this.graph.isSwimlane(b.cell)){var f=this.graph.getStartSize(b.cell),d=0!=f.width?b.x+f.width*c/2:d,e=0!=f.height?b.y+f.height*c/2:e,f=mxUtils.toRadians(mxUtils.getValue(b.style,mxConstants.STYLE_ROTATION)||0);if(0!=f)var c=Math.cos(f),f=Math.sin(f),g=new mxPoint(b.getCenterX(),b.getCenterY()),e=mxUtils.getRotatedPoint(new mxPoint(d,e),c,f,g),d=e.x,e=e.y}return new mxPoint(d-
a.bounds.width/2,e-a.bounds.height/2)};mxConnectionHandler.prototype.destroyIcons=function(){if(null!=this.icons){for(var a=0;a<this.icons.length;a++)this.icons[a].destroy();this.iconState=this.selectedIcon=this.icon=this.icons=null}};mxConnectionHandler.prototype.isStartEvent=function(a){return null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint||null!=this.previous&&null==this.error&&(null==this.icons||null!=this.icons&&null!=this.icon)};
mxConnectionHandler.prototype.mouseDown=function(a,b){this.mouseDownCounter++;if(this.isEnabled()&&this.graph.isEnabled()&&!b.isConsumed()&&!this.isConnecting()&&this.isStartEvent(b)){null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new mxPoint(b.getGraphX(),
b.getGraphY());this.edgeState=this.createEdgeState(b);this.mouseDownCounter=1;this.waypointsEnabled&&null==this.shape&&(this.waypoints=null,this.shape=this.createShape(),null!=this.edgeState&&this.shape.apply(this.edgeState));if(null==this.previous&&null!=this.edgeState){var c=this.graph.getPointForEvent(b.getEvent());this.edgeState.cell.geometry.setTerminalPoint(c,!0)}this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous));b.consume()}this.selectedIcon=this.icon;this.icon=null};
mxConnectionHandler.prototype.isImmediateConnectSource=function(a){return!this.graph.isCellMovable(a.cell)};mxConnectionHandler.prototype.createEdgeState=function(a){return null};mxConnectionHandler.prototype.isOutlineConnectEvent=function(a){return this.outlineConnect&&!mxEvent.isShiftDown(a.getEvent())&&(a.isSource(this.marker.highlight.shape)||mxEvent.isAltDown(a.getEvent()))};
mxConnectionHandler.prototype.updateCurrentState=function(a,b){this.constraintHandler.update(a,null==this.first);if(null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint)this.marker.reset(),null!=this.previous&&(this.error=this.validateConnection(this.previous.cell,this.constraintHandler.currentFocus.cell),null==this.error?this.currentState=this.constraintHandler.currentFocus:this.constraintHandler.reset());else if(this.marker.process(a),this.currentState=this.marker.getValidState(),
null!=this.currentState&&this.isOutlineConnectEvent(a)){var c=this.graph.getOutlineConstraint(b,this.currentState,a);this.constraintHandler.currentConstraint=c;this.constraintHandler.currentFocus=this.currentState;this.constraintHandler.currentPoint=b}this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape&&(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus?(this.marker.highlight.shape.stroke=mxConstants.OUTLINE_HIGHLIGHT_COLOR,this.marker.highlight.shape.strokewidth=
mxConstants.OUTLINE_HIGHLIGHT_STROKEWIDTH/this.graph.view.scale/this.graph.view.scale,this.marker.highlight.repaint()):this.marker.hasValidState()&&(this.marker.highlight.shape.stroke=mxConstants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.HIGHLIGHT_STROKEWIDTH/this.graph.view.scale/this.graph.view.scale,this.marker.highlight.repaint()))};
mxConnectionHandler.prototype.convertWaypoint=function(a){var b=this.graph.getView().getScale(),c=this.graph.getView().getTranslate();a.x=a.x/b-c.x;a.y=a.y/b-c.y};mxConnectionHandler.prototype.snapToPreview=function(a,b){if(!mxEvent.isAltDown(a.getEvent())&&null!=this.shape&&null!=this.shape.points&&0<this.shape.points.length){var c=this.graph.gridSize*this.graph.view.scale/2,d=this.shape.points[0];Math.abs(d.x-a.getGraphX())<c&&(b.x=d.x);Math.abs(d.y-a.getGraphY())<c&&(b.y=d.y)}};
mxConnectionHandler.prototype.mouseMove=function(a,b){if(b.isConsumed()||!this.ignoreMouseDown&&null==this.first&&this.graph.isMouseDown)this.constraintHandler.reset();else{!this.isEnabled()&&null!=this.currentState&&(this.destroyIcons(),this.currentState=null);var c=this.graph.getView(),d=c.scale,e=c.translate,c=new mxPoint(b.getGraphX(),b.getGraphY());this.error=null;this.graph.isGridEnabledEvent(b.getEvent())&&(c=new mxPoint((this.graph.snap(c.x/d-e.x)+e.x)*d,(this.graph.snap(c.y/d-e.y)+e.y)*d));
this.snapToPreview(b,c);this.currentPoint=c;(null!=this.first||this.isEnabled()&&this.graph.isEnabled())&&this.updateCurrentState(b,c);if(null!=this.first){var f=null,d=c;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?(f=this.constraintHandler.currentConstraint,d=this.constraintHandler.currentPoint.clone()):null!=this.previous&&mxEvent.isShiftDown(b.getEvent())&&(Math.abs(this.previous.getCenterX()-c.x)<Math.abs(this.previous.getCenterY()-
c.y)?c.x=this.previous.getCenterX():c.y=this.previous.getCenterY());e=this.first;if(null!=this.selectedIcon){var g=this.selectedIcon.bounds.width,k=this.selectedIcon.bounds.height;null!=this.currentState&&this.targetConnectImage?(g=this.getIconPosition(this.selectedIcon,this.currentState),this.selectedIcon.bounds.x=g.x,this.selectedIcon.bounds.y=g.y):(g=new mxRectangle(b.getGraphX()+this.connectIconOffset.x,b.getGraphY()+this.connectIconOffset.y,g,k),this.selectedIcon.bounds=g);this.selectedIcon.redraw()}if(null!=
this.edgeState){this.edgeState.absolutePoints=[null,null!=this.currentState?null:d];this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint);null!=this.currentState&&(null==f&&(f=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,f));e=null;if(null!=this.waypoints)for(e=[],d=0;d<this.waypoints.length;d++)f=this.waypoints[d].clone(),
this.convertWaypoint(f),e[d]=f;this.graph.view.updatePoints(this.edgeState,e,this.previous,this.currentState);this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState);d=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1];e=this.edgeState.absolutePoints[0]}else null!=this.currentState&&null==this.constraintHandler.currentConstraint&&(g=this.getTargetPerimeterPoint(this.currentState,b),null!=g&&(d=g)),null==this.sourceConstraint&&null!=this.previous&&
(g=this.getSourcePerimeterPoint(this.previous,null!=this.waypoints&&0<this.waypoints.length?this.waypoints[0]:d,b),null!=g&&(e=g));if(null==this.currentState&&this.movePreviewAway){g=e;null!=this.edgeState&&2<this.edgeState.absolutePoints.length&&(f=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2],null!=f&&(g=f));f=d.x-g.x;g=d.y-g.y;k=Math.sqrt(f*f+g*g);if(0==k)return;d.x-=4*f/k;d.y-=4*g/k}null==this.shape&&(f=Math.abs(c.x-this.first.x),g=Math.abs(c.y-this.first.y),f>this.graph.tolerance||
g>this.graph.tolerance)&&(this.shape=this.createShape(),null!=this.edgeState&&this.shape.apply(this.edgeState),this.updateCurrentState(b,c));null!=this.shape&&(null!=this.edgeState?this.shape.points=this.edgeState.absolutePoints:(c=[e],null!=this.waypoints&&(c=c.concat(this.waypoints)),c.push(d),this.shape.points=c),this.drawPreview());mxEvent.consume(b.getEvent());b.consume()}else this.isEnabled()&&this.graph.isEnabled()?this.previous!=this.currentState&&null==this.edgeState?(this.destroyIcons(),
null!=this.currentState&&null==this.error&&null==this.constraintHandler.currentConstraint&&(this.icons=this.createIcons(this.currentState),null==this.icons&&(this.currentState.setCursor(mxConstants.CURSOR_CONNECT),b.consume())),this.previous=this.currentState):this.previous==this.currentState&&null!=this.currentState&&null==this.icons&&!this.graph.isMouseDown&&b.consume():this.constraintHandler.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){c=!1;e=b.getSource();for(d=
0;d<this.icons.length&&!c;d++)c=e==this.icons[d].node||e.parentNode==this.icons[d].node;c||this.updateIcons(this.currentState,this.icons,b)}}};
mxConnectionHandler.prototype.getTargetPerimeterPoint=function(a,b){var c=null,d=a.view,e=d.getPerimeterFunction(a);if(null!=e){var f=null!=this.waypoints&&0<this.waypoints.length?this.waypoints[this.waypoints.length-1]:new mxPoint(this.previous.getCenterX(),this.previous.getCenterY()),d=e(d.getPerimeterBounds(a),this.edgeState,f,!1);null!=d&&(c=d)}else c=new mxPoint(a.getCenterX(),a.getCenterY());return c};
mxConnectionHandler.prototype.getSourcePerimeterPoint=function(a,b,c){c=null;var d=a.view,e=d.getPerimeterFunction(a),f=new mxPoint(a.getCenterX(),a.getCenterY());if(null!=e){var g=mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0),k=Math.PI/180*-g;0!=g&&(b=mxUtils.getRotatedPoint(new mxPoint(b.x,b.y),Math.cos(k),Math.sin(k),f));a=e(d.getPerimeterBounds(a),a,b,!1);null!=a&&(0!=g&&(a=mxUtils.getRotatedPoint(new mxPoint(a.x,a.y),Math.cos(-k),Math.sin(-k),f)),c=a)}else c=f;return c};
mxConnectionHandler.prototype.updateIcons=function(a,b,c){};mxConnectionHandler.prototype.isStopEvent=function(a){return null!=a.getState()};
mxConnectionHandler.prototype.addWaypointForEvent=function(a){var b=mxUtils.convertPoint(this.graph.container,a.getX(),a.getY()),c=Math.abs(b.x-this.first.x),b=Math.abs(b.y-this.first.y);if(null!=this.waypoints||1<this.mouseDownCounter&&(c>this.graph.tolerance||b>this.graph.tolerance))null==this.waypoints&&(this.waypoints=[]),c=this.graph.view.scale,b=new mxPoint(this.graph.snap(a.getGraphX()/c)*c,this.graph.snap(a.getGraphY()/c)*c),this.waypoints.push(b)};
mxConnectionHandler.prototype.mouseUp=function(a,b){if(!b.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(b)){this.addWaypointForEvent(b);b.consume();return}if(null==this.error){var c=null!=this.previous?this.previous.cell:null,d=null;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(d=this.constraintHandler.currentFocus.cell);null==d&&this.marker.hasValidState()&&(d=this.marker.validState.cell);this.connect(c,d,b.getEvent(),
b.getCell())}else null!=this.previous&&null!=this.marker.validState&&this.previous.cell==this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.source,evt),0<this.error.length&&this.graph.validationAlert(this.error);this.destroyIcons();b.consume()}null!=this.first&&this.reset()};
mxConnectionHandler.prototype.reset=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null);this.destroyIcons();this.marker.reset();this.constraintHandler.reset();this.sourceConstraint=this.error=this.previous=this.edgeState=null;this.mouseDownCounter=0;this.first=null;this.fireEvent(new mxEventObject(mxEvent.RESET))};mxConnectionHandler.prototype.drawPreview=function(){var a=null==this.error;this.shape.strokewidth=this.getEdgeWidth(a);a=this.getEdgeColor(a);this.shape.stroke=a;this.shape.redraw()};
mxConnectionHandler.prototype.getEdgeColor=function(a){return a?mxConstants.VALID_COLOR:mxConstants.INVALID_COLOR};mxConnectionHandler.prototype.getEdgeWidth=function(a){return a?3:1};
mxConnectionHandler.prototype.connect=function(a,b,c,d){if(null!=b||this.isCreateTarget()||this.graph.allowDanglingEdges){var e=this.graph.getModel(),f=!1,g=null;e.beginUpdate();try{if(null!=a&&null==b&&this.isCreateTarget()&&(b=this.createTargetVertex(c,a),null!=b)){d=this.graph.getDropTarget([b],c,d);f=!0;if(null!=d&&this.graph.getModel().isEdge(d))d=this.graph.getDefaultParent();else{var k=this.graph.getView().getState(d);if(null!=k){var l=e.getGeometry(b);l.x-=k.origin.x;l.y-=k.origin.y}}this.graph.addCell(b,
d)}var m=this.graph.getDefaultParent();null!=a&&null!=b&&e.getParent(a)==e.getParent(b)&&e.getParent(e.getParent(a))!=e.getRoot()&&(m=e.getParent(a),null!=a.geometry&&a.geometry.relative&&null!=b.geometry&&b.geometry.relative&&(m=e.getParent(m)));l=k=null;null!=this.edgeState&&(k=this.edgeState.cell.value,l=this.edgeState.cell.style);g=this.insertEdge(m,null,k,a,b,l);if(null!=g){this.graph.setConnectionConstraint(g,a,!0,this.sourceConstraint);this.graph.setConnectionConstraint(g,b,!1,this.constraintHandler.currentConstraint);
null!=this.edgeState&&e.setGeometry(g,this.edgeState.cell.geometry);var n=e.getGeometry(g);null==n&&(n=new mxGeometry,n.relative=!0,e.setGeometry(g,n));if(null!=this.waypoints&&0<this.waypoints.length){var p=this.graph.view.scale,q=this.graph.view.translate;n.points=[];for(a=0;a<this.waypoints.length;a++){var u=this.waypoints[a];n.points.push(new mxPoint(u.x/p-q.x,u.y/p-q.y))}}if(null==b){var v=this.graph.view.translate,p=this.graph.view.scale,u=new mxPoint(this.currentPoint.x/p-v.x,this.currentPoint.y/
p-v.y);u.x-=this.graph.panDx/this.graph.view.scale;u.y-=this.graph.panDy/this.graph.view.scale;n.setTerminalPoint(u,!1)}this.fireEvent(new mxEventObject(mxEvent.CONNECT,"cell",g,"terminal",b,"event",c,"target",d,"terminalInserted",f))}}catch(y){mxLog.show(),mxLog.debug(y.message)}finally{e.endUpdate()}this.select&&this.selectCells(g,f?b:null)}};mxConnectionHandler.prototype.selectCells=function(a,b){this.graph.setSelectionCell(a)};
mxConnectionHandler.prototype.insertEdge=function(a,b,c,d,e,f){if(null==this.factoryMethod)return this.graph.insertEdge(a,b,c,d,e,f);b=this.createEdge(c,d,e,f);return this.graph.addEdge(b,a,d,e)};
mxConnectionHandler.prototype.createTargetVertex=function(a,b){for(var c=this.graph.getCellGeometry(b);null!=c&&c.relative;)b=this.graph.getModel().getParent(b),c=this.graph.getCellGeometry(b);var d=this.graph.cloneCells([b])[0],c=this.graph.getModel().getGeometry(d);if(null!=c){var e=this.graph.view.translate,f=this.graph.view.scale,g=new mxPoint(this.currentPoint.x/f-e.x,this.currentPoint.y/f-e.y);c.x=Math.round(g.x-c.width/2-this.graph.panDx/f);c.y=Math.round(g.y-c.height/2-this.graph.panDy/f);
g=this.getAlignmentTolerance();if(0<g){var k=this.graph.view.getState(b);if(null!=k){var l=k.x/f-e.x,e=k.y/f-e.y;Math.abs(l-c.x)<=g&&(c.x=Math.round(l));Math.abs(e-c.y)<=g&&(c.y=Math.round(e))}}}return d};mxConnectionHandler.prototype.getAlignmentTolerance=function(a){return this.graph.isGridEnabled()?this.graph.gridSize/2:this.graph.tolerance};
mxConnectionHandler.prototype.createEdge=function(a,b,c,d){var e=null;null!=this.factoryMethod&&(e=this.factoryMethod(b,c,d));null==e&&(e=new mxCell(a||""),e.setEdge(!0),e.setStyle(d),a=new mxGeometry,a.relative=!0,e.setGeometry(a));return e};
mxConnectionHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.marker&&(this.marker.destroy(),this.marker=null);null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=null);null!=this.changeHandler&&(this.graph.getModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler),this.changeHandler=null);null!=this.drillHandler&&(this.graph.removeListener(this.drillHandler),
this.graph.getView().removeListener(this.drillHandler),this.drillHandler=null);null!=this.escapeHandler&&(this.graph.removeListener(this.escapeHandler),this.escapeHandler=null)};function mxConstraintHandler(a){this.graph=a}mxConstraintHandler.prototype.pointImage=new mxImage(mxClient.imageBasePath+"/point.gif",5,5);mxConstraintHandler.prototype.graph=null;mxConstraintHandler.prototype.enabled=!0;mxConstraintHandler.prototype.highlightColor=mxConstants.DEFAULT_VALID_COLOR;
mxConstraintHandler.prototype.isEnabled=function(){return this.enabled};mxConstraintHandler.prototype.setEnabled=function(a){this.enabled=a};mxConstraintHandler.prototype.reset=function(){if(null!=this.focusIcons){for(var a=0;a<this.focusIcons.length;a++)this.focusIcons[a].destroy();this.focusIcons=null}null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null);this.focusPoints=this.currentFocus=this.currentPoint=this.currentFocusArea=this.currentConstraint=null};
mxConstraintHandler.prototype.getTolerance=function(a){return this.graph.getTolerance()};mxConstraintHandler.prototype.getImageForConstraint=function(a,b,c){return this.pointImage};mxConstraintHandler.prototype.isEventIgnored=function(a,b){return!1};mxConstraintHandler.prototype.isStateIgnored=function(a,b){return!1};
mxConstraintHandler.prototype.destroyIcons=function(){if(null!=this.focusIcons){for(var a=0;a<this.focusIcons.length;a++)this.focusIcons[a].destroy();this.focusPoints=this.focusIcons=null}};mxConstraintHandler.prototype.destroyFocusHighlight=function(){null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)};mxConstraintHandler.prototype.isKeepFocusEvent=function(a){return mxEvent.isShiftDown(a.getEvent())};
mxConstraintHandler.prototype.update=function(a,b){if(this.isEnabled()&&!this.isEventIgnored(a)){var c=this.getTolerance(a),d=new mxRectangle(a.getGraphX()-c,a.getGraphY()-c,2*c,2*c),e=null!=a.getState()&&!this.isStateIgnored(a.getState(),b)&&this.graph.isCellConnectable(a.getCell())?this.graph.getAllConnectionConstraints(a.getState(),b):null;if(!this.isKeepFocusEvent(a)&&(null==this.currentFocusArea||null==this.currentFocus||null!=a.getState()&&null!=e||!this.graph.getModel().isVertex(this.currentFocus.cell)||
!mxUtils.intersects(this.currentFocusArea,d))&&a.getState()!=this.currentFocus)if(this.currentFocus=this.currentFocusArea=null,this.constraints=e,null!=this.constraints){this.currentFocus=a.getState();this.currentFocusArea=new mxRectangle(a.getState().x,a.getState().y,a.getState().width,a.getState().height);if(null!=this.focusIcons){for(e=0;e<this.focusIcons.length;e++)this.focusIcons[e].destroy();this.focusPoints=this.focusIcons=null}this.focusIcons=[];this.focusPoints=[];for(e=0;e<this.constraints.length;e++){var f=
this.graph.getConnectionPoint(a.getState(),this.constraints[e]),g=this.getImageForConstraint(a.getState(),this.constraints[e],f),k=g.src,g=new mxRectangle(f.x-g.width/2,f.y-g.height/2,g.width,g.height),g=new mxImageShape(g,k);g.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;g.preserveImageAspect=!1;g.init(this.graph.getView().getDecoratorPane());(mxClient.IS_QUIRKS||8==document.documentMode)&&mxEvent.addListener(g.node,"dragstart",function(a){mxEvent.consume(a);
return!1});null!=g.node.previousSibling&&g.node.parentNode.insertBefore(g.node,g.node.parentNode.firstChild);k=mxUtils.bind(this,function(){return null!=this.currentFocus?this.currentFocus:a.getState()});g.redraw();mxEvent.redirectMouseEvents(g.node,this.graph,k);this.currentFocusArea.add(g.bounds);this.focusIcons.push(g);this.focusPoints.push(f)}this.currentFocusArea.grow(c)}else this.destroyIcons(),this.destroyFocusHighlight();c=this.currentPoint=this.currentConstraint=null;if(null!=this.focusIcons&&
null!=this.constraints&&(null==a.getState()||this.currentFocus==a.getState()))for(e=0;e<this.focusIcons.length;e++)if(f=a.getGraphX()-this.focusIcons[e].bounds.getCenterX(),k=a.getGraphY()-this.focusIcons[e].bounds.getCenterY(),f=f*f+k*k,mxUtils.intersects(this.focusIcons[e].bounds,d)&&(null==c||f<c))this.currentConstraint=this.constraints[e],this.currentPoint=this.focusPoints[e],c=f,f=this.focusIcons[e].bounds.clone(),f.grow(mxClient.IS_IE?3:2),mxClient.IS_IE&&(f.width-=1,f.height-=1),null==this.focusHighlight?
(f=new mxRectangleShape(f,null,this.highlightColor,3),f.pointerEvents=!1,f.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,f.init(this.graph.getView().getOverlayPane()),this.focusHighlight=f,k=mxUtils.bind(this,function(){return null!=this.currentFocus?this.currentFocus:a.getState()}),mxEvent.redirectMouseEvents(f.node,this.graph,k)):(this.focusHighlight.bounds=f,this.focusHighlight.redraw());null==this.currentConstraint&&this.destroyFocusHighlight()}else this.currentPoint=
this.currentFocus=this.currentConstraint=null};mxConstraintHandler.prototype.destroy=function(){this.reset()};
function mxRubberband(a){null!=a&&(this.graph=a,this.graph.addMouseListener(this),this.forceRubberbandHandler=mxUtils.bind(this,function(a,c){var d=c.getProperty("eventName"),e=c.getProperty("event");if(d==mxEvent.MOUSE_DOWN&&this.isForceRubberbandEvent(e)){var d=mxUtils.getOffset(this.graph.container),f=mxUtils.getScrollOrigin(this.graph.container);f.x-=d.x;f.y-=d.y;this.start(e.getX()+f.x,e.getY()+f.y);e.consume(!1)}}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),
this.panHandler=mxUtils.bind(this,function(){this.repaint()}),this.graph.addListener(mxEvent.PAN,this.panHandler),this.gestureHandler=mxUtils.bind(this,function(a,c){null!=this.first&&this.reset()}),this.graph.addListener(mxEvent.GESTURE,this.gestureHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}mxRubberband.prototype.defaultOpacity=20;mxRubberband.prototype.enabled=!0;mxRubberband.prototype.div=null;mxRubberband.prototype.sharedDiv=null;
mxRubberband.prototype.currentX=0;mxRubberband.prototype.currentY=0;mxRubberband.prototype.isEnabled=function(){return this.enabled};mxRubberband.prototype.setEnabled=function(a){this.enabled=a};mxRubberband.prototype.isForceRubberbandEvent=function(a){return mxEvent.isAltDown(a.getEvent())};
mxRubberband.prototype.mouseDown=function(a,b){if(!b.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null==b.getState()&&!mxEvent.isMultiTouchEvent(b.getEvent())){var c=mxUtils.getOffset(this.graph.container),d=mxUtils.getScrollOrigin(this.graph.container);d.x-=c.x;d.y-=c.y;this.start(b.getX()+d.x,b.getY()+d.y);b.consume(!1)}};
mxRubberband.prototype.start=function(a,b){function c(a){a=new mxMouseEvent(a);var b=mxUtils.convertPoint(d,a.getX(),a.getY());a.graphX=b.x;a.graphY=b.y;return a}this.first=new mxPoint(a,b);var d=this.graph.container;this.dragHandler=mxUtils.bind(this,function(a){this.mouseMove(this.graph,c(a))});this.dropHandler=mxUtils.bind(this,function(a){this.mouseUp(this.graph,c(a))});mxClient.IS_FF&&mxEvent.addGestureListeners(document,null,this.dragHandler,this.dropHandler)};
mxRubberband.prototype.mouseMove=function(a,b){if(!b.isConsumed()&&null!=this.first){var c=mxUtils.getScrollOrigin(this.graph.container),d=mxUtils.getOffset(this.graph.container);c.x-=d.x;c.y-=d.y;var d=b.getX()+c.x,c=b.getY()+c.y,e=this.first.x-d,f=this.first.y-c,g=this.graph.tolerance;if(null!=this.div||Math.abs(e)>g||Math.abs(f)>g)null==this.div&&(this.div=this.createShape()),mxUtils.clearSelection(),this.update(d,c),b.consume()}};
mxRubberband.prototype.createShape=function(){null==this.sharedDiv&&(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",mxUtils.setOpacity(this.sharedDiv,this.defaultOpacity));this.graph.container.appendChild(this.sharedDiv);return this.sharedDiv};mxRubberband.prototype.mouseUp=function(a,b){var c=null!=this.div&&"none"!=this.div.style.display;this.reset();c&&(c=new mxRectangle(this.x,this.y,this.width,this.height),this.graph.selectRegion(c,b.getEvent()),b.consume())};
mxRubberband.prototype.reset=function(){null!=this.div&&this.div.parentNode.removeChild(this.div);mxEvent.removeGestureListeners(document,null,this.dragHandler,this.dropHandler);this.dropHandler=this.dragHandler=null;this.currentY=this.currentX=0;this.div=this.first=null};mxRubberband.prototype.update=function(a,b){this.currentX=a;this.currentY=b;this.repaint()};
mxRubberband.prototype.repaint=function(){if(null!=this.div){var a=this.currentX-this.graph.panDx,b=this.currentY-this.graph.panDy;this.x=Math.min(this.first.x,a);this.y=Math.min(this.first.y,b);this.width=Math.max(this.first.x,a)-this.x;this.height=Math.max(this.first.y,b)-this.y;a=mxClient.IS_VML?this.graph.panDy:0;this.div.style.left=this.x+(mxClient.IS_VML?this.graph.panDx:0)+"px";this.div.style.top=this.y+a+"px";this.div.style.width=Math.max(1,this.width)+"px";this.div.style.height=Math.max(1,
this.height)+"px"}};mxRubberband.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),null!=this.sharedDiv&&(this.sharedDiv=null))};function mxHandle(a,b,c){this.graph=a.view.graph;this.state=a;this.cursor=null!=b?b:this.cursor;this.image=null!=c?c:this.image;this.init()}mxHandle.prototype.cursor="default";mxHandle.prototype.image=null;
mxHandle.prototype.ignoreGrid=!1;mxHandle.prototype.getPosition=function(a){};mxHandle.prototype.setPosition=function(a,b,c){};mxHandle.prototype.execute=function(){};mxHandle.prototype.copyStyle=function(a){this.graph.setCellStyles(a,this.state.style[a],[this.state.cell])};
mxHandle.prototype.processEvent=function(a){var b=this.graph.view.scale,c=this.graph.view.translate,c=new mxPoint(a.getGraphX()/b-c.x,a.getGraphY()/b-c.y);null!=this.shape&&null!=this.shape.bounds&&(c.x-=this.shape.bounds.width/b/4,c.y-=this.shape.bounds.height/b/4);var b=-mxUtils.toRadians(this.getRotation()),d=-mxUtils.toRadians(this.getTotalRotation())-b,c=this.flipPoint(this.rotatePoint(this.snapPoint(this.rotatePoint(c,b),this.ignoreGrid||!this.graph.isGridEnabledEvent(a.getEvent())),d));this.setPosition(this.state.getPaintBounds(),
c,a);this.positionChanged();this.redraw()};mxHandle.prototype.positionChanged=function(){null!=this.state.text&&this.state.text.apply(this.state);null!=this.state.shape&&this.state.shape.apply(this.state);this.graph.cellRenderer.redraw(this.state,!0)};mxHandle.prototype.getRotation=function(){return null!=this.state.shape?this.state.shape.getRotation():0};mxHandle.prototype.getTotalRotation=function(){return null!=this.state.shape?this.state.shape.getShapeRotation():0};
mxHandle.prototype.init=function(){var a=this.isHtmlRequired();null!=this.image?(this.shape=new mxImageShape(new mxRectangle(0,0,this.image.width,this.image.height),this.image.src),this.shape.preserveImageAspect=!1):this.shape=this.createShape(a);this.initShape(a)};mxHandle.prototype.createShape=function(a){a=new mxRectangle(0,0,mxConstants.HANDLE_SIZE,mxConstants.HANDLE_SIZE);return new mxRectangleShape(a,mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};
mxHandle.prototype.initShape=function(a){a&&this.shape.isHtmlAllowed()?(this.shape.dialect=mxConstants.DIALECT_STRICTHTML,this.shape.init(this.graph.container)):(this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,null!=this.cursor&&this.shape.init(this.graph.getView().getOverlayPane()));mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state);this.shape.node.style.cursor=this.cursor};
mxHandle.prototype.redraw=function(){if(null!=this.shape&&null!=this.state.shape){var a=this.getPosition(this.state.getPaintBounds());if(null!=a){var b=mxUtils.toRadians(this.getTotalRotation()),a=this.rotatePoint(this.flipPoint(a),b),b=this.graph.view.scale,c=this.graph.view.translate;this.shape.bounds.x=Math.floor((a.x+c.x)*b-this.shape.bounds.width/2);this.shape.bounds.y=Math.floor((a.y+c.y)*b-this.shape.bounds.height/2);this.shape.redraw()}}};
mxHandle.prototype.isHtmlRequired=function(){return null!=this.state.text&&this.state.text.node.parentNode==this.graph.container};mxHandle.prototype.rotatePoint=function(a,b){var c=this.state.getCellBounds(),c=new mxPoint(c.getCenterX(),c.getCenterY()),d=Math.cos(b),e=Math.sin(b);return mxUtils.getRotatedPoint(a,d,e,c)};
mxHandle.prototype.flipPoint=function(a){if(null!=this.state.shape){var b=this.state.getCellBounds();this.state.shape.flipH&&(a.x=2*b.x+b.width-a.x);this.state.shape.flipV&&(a.y=2*b.y+b.height-a.y)}return a};mxHandle.prototype.snapPoint=function(a,b){b||(a.x=this.graph.snap(a.x),a.y=this.graph.snap(a.y));return a};mxHandle.prototype.setVisible=function(a){null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display=a?"":"none")};
mxHandle.prototype.reset=function(){this.setVisible(!0);this.state.style=this.graph.getCellStyle(this.state.cell);this.positionChanged()};mxHandle.prototype.destroy=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null)};
function mxVertexHandler(a){null!=a&&(this.state=a,this.init(),this.escapeHandler=mxUtils.bind(this,function(a,c){this.livePreview&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate());this.reset()}),this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}mxVertexHandler.prototype.graph=null;mxVertexHandler.prototype.state=null;mxVertexHandler.prototype.singleSizer=!1;
mxVertexHandler.prototype.index=null;mxVertexHandler.prototype.allowHandleBoundsCheck=!0;mxVertexHandler.prototype.handleImage=null;mxVertexHandler.prototype.tolerance=0;mxVertexHandler.prototype.rotationEnabled=!1;mxVertexHandler.prototype.parentHighlightEnabled=!1;mxVertexHandler.prototype.rotationRaster=!0;mxVertexHandler.prototype.rotationCursor="crosshair";mxVertexHandler.prototype.livePreview=!1;mxVertexHandler.prototype.manageSizers=!1;mxVertexHandler.prototype.constrainGroupByChildren=!1;
mxVertexHandler.prototype.rotationHandleVSpacing=-16;mxVertexHandler.prototype.horizontalOffset=0;mxVertexHandler.prototype.verticalOffset=0;
mxVertexHandler.prototype.init=function(){this.graph=this.state.view.graph;this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.selectionBorder=this.createSelectionShape(this.bounds);this.selectionBorder.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.selectionBorder.pointerEvents=!1;this.selectionBorder.rotation=
Number(this.state.style[mxConstants.STYLE_ROTATION]||"0");this.selectionBorder.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state);this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(mxConstants.CURSOR_MOVABLE_VERTEX);if(0>=mxGraphHandler.prototype.maxCells||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells){var a=this.graph.isCellResizable(this.state.cell);this.sizers=[];if(a||this.graph.isLabelMovable(this.state.cell)&&
2<=this.state.width&&2<=this.state.height){var b=0;a&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",b++)),this.sizers.push(this.createSizer("n-resize",b++)),this.sizers.push(this.createSizer("ne-resize",b++)),this.sizers.push(this.createSizer("w-resize",b++)),this.sizers.push(this.createSizer("e-resize",b++)),this.sizers.push(this.createSizer("sw-resize",b++)),this.sizers.push(this.createSizer("s-resize",b++))),this.sizers.push(this.createSizer("se-resize",b++)));a=this.graph.model.getGeometry(this.state.cell);
null!=a&&!a.relative&&!this.graph.isSwimlane(this.state.cell)&&this.graph.isLabelMovable(this.state.cell)&&(this.labelShape=this.createSizer(mxConstants.CURSOR_LABEL_HANDLE,mxEvent.LABEL_HANDLE,mxConstants.LABEL_HANDLE_SIZE,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&2>this.state.width&&2>this.state.height&&(this.labelShape=this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,mxEvent.LABEL_HANDLE,
null,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,mxEvent.ROTATION_HANDLE,mxConstants.HANDLE_SIZE+3,mxConstants.HANDLE_FILLCOLOR),this.sizers.push(this.rotationShape));this.customHandles=this.createCustomHandles();this.redraw();this.constrainGroupByChildren&&this.updateMinBounds()};
mxVertexHandler.prototype.isRotationHandleVisible=function(){return this.graph.isEnabled()&&this.rotationEnabled&&this.graph.isCellRotatable(this.state.cell)&&(0>=mxGraphHandler.prototype.maxCells||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells)&&2<=this.state.width&&2<=this.state.height};mxVertexHandler.prototype.isConstrainedEvent=function(a){return mxEvent.isShiftDown(a.getEvent())||"fixed"==this.state.style[mxConstants.STYLE_ASPECT]};
mxVertexHandler.prototype.createCustomHandles=function(){return null};
mxVertexHandler.prototype.updateMinBounds=function(){var a=this.graph.getChildCells(this.state.cell);if(0<a.length&&(this.minBounds=this.graph.view.getBounds(a),null!=this.minBounds)){var a=this.state.view.scale,b=this.state.view.translate;this.minBounds.x-=this.state.x;this.minBounds.y-=this.state.y;this.minBounds.x/=a;this.minBounds.y/=a;this.minBounds.width/=a;this.minBounds.height/=a;this.x0=this.state.x/a-b.x;this.y0=this.state.y/a-b.y}};
mxVertexHandler.prototype.getSelectionBounds=function(a){return new mxRectangle(Math.round(a.x),Math.round(a.y),Math.round(a.width),Math.round(a.height))};mxVertexHandler.prototype.createParentHighlightShape=function(a){return this.createSelectionShape(a)};mxVertexHandler.prototype.createSelectionShape=function(a){a=new mxRectangleShape(a,null,this.getSelectionColor());a.strokewidth=this.getSelectionStrokeWidth();a.isDashed=this.isSelectionDashed();return a};
mxVertexHandler.prototype.getSelectionColor=function(){return mxConstants.VERTEX_SELECTION_COLOR};mxVertexHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.VERTEX_SELECTION_STROKEWIDTH};mxVertexHandler.prototype.isSelectionDashed=function(){return mxConstants.VERTEX_SELECTION_DASHED};
mxVertexHandler.prototype.createSizer=function(a,b,c,d){c=c||mxConstants.HANDLE_SIZE;c=new mxRectangle(0,0,c,c);d=this.createSizerShape(c,b,d);d.isHtmlAllowed()&&null!=this.state.text&&this.state.text.node.parentNode==this.graph.container?(d.bounds.height-=1,d.bounds.width-=1,d.dialect=mxConstants.DIALECT_STRICTHTML,d.init(this.graph.container)):(d.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,d.init(this.graph.getView().getOverlayPane()));
mxEvent.redirectMouseEvents(d.node,this.graph,this.state);this.graph.isEnabled()&&d.setCursor(a);this.isSizerVisible(b)||(d.node.style.visibility="hidden");return d};mxVertexHandler.prototype.isSizerVisible=function(a){return!0};
mxVertexHandler.prototype.createSizerShape=function(a,b,c){return null!=this.handleImage?(a=new mxRectangle(a.x,a.y,this.handleImage.width,this.handleImage.height),a=new mxImageShape(a,this.handleImage.src),a.preserveImageAspect=!1,a):b==mxEvent.ROTATION_HANDLE?new mxEllipse(a,c||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR):new mxRectangleShape(a,c||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};
mxVertexHandler.prototype.moveSizerTo=function(a,b,c){null!=a&&(a.bounds.x=Math.round(b-a.bounds.width/2),a.bounds.y=Math.round(c-a.bounds.height/2),null!=a.node&&"none"!=a.node.style.display&&a.redraw())};
mxVertexHandler.prototype.getHandleForEvent=function(a){function b(b){return null!=b&&(a.isSource(b)||null!=d&&mxUtils.intersects(b.bounds,d)&&"none"!=b.node.style.display&&"hidden"!=b.node.style.visibility)}var c=mxEvent.isMouseEvent(a.getEvent())?1:this.tolerance,d=this.allowHandleBoundsCheck&&(mxClient.IS_IE||0<c)?new mxRectangle(a.getGraphX()-c,a.getGraphY()-c,2*c,2*c):null;if(null!=this.customHandles&&this.isCustomHandleEvent(a))for(c=this.customHandles.length-1;0<=c;c--)if(b(this.customHandles[c].shape))return mxEvent.CUSTOM_HANDLE-
c;if(b(this.rotationShape))return mxEvent.ROTATION_HANDLE;if(b(this.labelShape))return mxEvent.LABEL_HANDLE;if(null!=this.sizers)for(c=0;c<this.sizers.length;c++)if(b(this.sizers[c]))return c;return null};mxVertexHandler.prototype.isCustomHandleEvent=function(a){return!0};
mxVertexHandler.prototype.mouseDown=function(a,b){var c=mxEvent.isMouseEvent(b.getEvent())?0:this.tolerance;!b.isConsumed()&&this.graph.isEnabled()&&(0<c||b.getState()==this.state)&&(c=this.getHandleForEvent(b),null!=c&&(this.start(b.getGraphX(),b.getGraphY(),c),b.consume()))};mxVertexHandler.prototype.isLivePreviewBorder=function(){return null!=this.state.shape&&null==this.state.shape.fill&&null==this.state.shape.stroke};
mxVertexHandler.prototype.start=function(a,b,c){this.inTolerance=!0;this.childOffsetY=this.childOffsetX=0;this.index=c;this.startX=a;this.startY=b;a=this.state.view.graph.model;b=a.getParent(this.state.cell);this.state.view.currentRoot!=b&&(a.isVertex(b)||a.isEdge(b))&&(this.parentState=this.state.view.graph.view.getState(b));this.selectionBorder.node.style.display=c==mxEvent.ROTATION_HANDLE?"inline":"none";if(!this.livePreview||this.isLivePreviewBorder())this.preview=this.createSelectionShape(this.bounds),
mxClient.IS_SVG&&0!=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")||null==this.state.text||this.state.text.node.parentNode!=this.graph.container?(this.preview.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.preview.init(this.graph.view.getOverlayPane())):(this.preview.dialect=mxConstants.DIALECT_STRICTHTML,this.preview.init(this.graph.container));if(this.livePreview)for(this.hideSizers(),c==mxEvent.ROTATION_HANDLE?this.rotationShape.node.style.display=
"":null!=this.sizers&&null!=this.sizers[c]?this.sizers[c].node.style.display="":c<=mxEvent.CUSTOM_HANDLE&&null!=this.customHandles&&this.customHandles[mxEvent.CUSTOM_HANDLE-c].setVisible(!0),c=this.graph.getEdges(this.state.cell),this.edgeHandlers=[],a=0;a<c.length;a++)b=this.graph.selectionCellsHandler.getHandler(c[a]),null!=b&&this.edgeHandlers.push(b)};
mxVertexHandler.prototype.setHandlesVisible=function(a){if(null!=this.sizers)for(var b=0;b<this.sizers.length;b++)this.sizers[b].node.style.display=a?"":"none";if(null!=this.customHandles)for(b=0;b<this.customHandles.length;b++)this.customHandles[b].setVisible(a)};mxVertexHandler.prototype.hideSizers=function(){this.setHandlesVisible(!1)};
mxVertexHandler.prototype.checkTolerance=function(a){this.inTolerance&&null!=this.startX&&null!=this.startY&&(mxEvent.isMouseEvent(a.getEvent())||Math.abs(a.getGraphX()-this.startX)>this.graph.tolerance||Math.abs(a.getGraphY()-this.startY)>this.graph.tolerance)&&(this.inTolerance=!1)};mxVertexHandler.prototype.updateHint=function(a){};mxVertexHandler.prototype.removeHint=function(){};mxVertexHandler.prototype.roundAngle=function(a){return Math.round(10*a)/10};
mxVertexHandler.prototype.roundLength=function(a){return Math.round(a)};
mxVertexHandler.prototype.mouseMove=function(a,b){b.isConsumed()||null==this.index?!this.graph.isMouseDown&&null!=this.getHandleForEvent(b)&&b.consume(!1):(this.checkTolerance(b),this.inTolerance||(this.index<=mxEvent.CUSTOM_HANDLE?null!=this.customHandles&&this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(b):this.index==mxEvent.LABEL_HANDLE?this.moveLabel(b):this.index==mxEvent.ROTATION_HANDLE?this.rotateVertex(b):this.resizeVertex(b),this.updateHint(b)),b.consume())};
mxVertexHandler.prototype.moveLabel=function(a){var b=new mxPoint(a.getGraphX(),a.getGraphY()),c=this.graph.view.translate,d=this.graph.view.scale;this.graph.isGridEnabledEvent(a.getEvent())&&(b.x=(this.graph.snap(b.x/d-c.x)+c.x)*d,b.y=(this.graph.snap(b.y/d-c.y)+c.y)*d);this.moveSizerTo(this.sizers[this.sizers.length-1],b.x,b.y)};
mxVertexHandler.prototype.rotateVertex=function(a){var b=new mxPoint(a.getGraphX(),a.getGraphY()),c=this.state.x+this.state.width/2-b.x,d=this.state.y+this.state.height/2-b.y;this.currentAlpha=0!=c?180*Math.atan(d/c)/Math.PI+90:0>d?180:0;0<c&&(this.currentAlpha-=180);this.rotationRaster&&this.graph.isGridEnabledEvent(a.getEvent())?(c=b.x-this.state.getCenterX(),d=b.y-this.state.getCenterY(),a=3*Math.abs(Math.sqrt(c*c+d*d)-20),a=Math.max(1,5*Math.min(3,Math.max(0,Math.round(80/Math.abs(a))))),this.currentAlpha=
Math.round(this.currentAlpha/a)*a):this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha;this.selectionBorder.redraw();this.livePreview&&this.redrawHandles()};
mxVertexHandler.prototype.resizeVertex=function(a){var b=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),c=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),d=new mxPoint(a.getGraphX(),a.getGraphY()),e=this.graph.view.translate,f=this.graph.view.scale,g=Math.cos(-c),k=Math.sin(-c),l=d.x-this.startX,d=d.y-this.startY,m=k*l+g*d,l=g*l-k*d,d=m,g=this.graph.getCellGeometry(this.state.cell);this.unscaledBounds=this.union(g,l/f,d/f,this.index,this.graph.isGridEnabledEvent(a.getEvent()),
1,new mxPoint(0,0),this.isConstrainedEvent(a));this.bounds=new mxRectangle((null!=this.parentState?this.parentState.x:e.x*f)+this.unscaledBounds.x*f,(null!=this.parentState?this.parentState.y:e.y*f)+this.unscaledBounds.y*f,this.unscaledBounds.width*f,this.unscaledBounds.height*f);g.relative&&null!=this.parentState&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y);g=Math.cos(c);k=Math.sin(c);c=new mxPoint(this.bounds.getCenterX(),this.bounds.getCenterY());
l=c.x-b.x;d=c.y-b.y;b=g*l-k*d-l;l=k*l+g*d-d;e=this.bounds.x-this.state.x;d=this.bounds.y-this.state.y;c=g*e-k*d;g=k*e+g*d;this.bounds.x+=b;this.bounds.y+=l;this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+b/f);this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+l/f);this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width);this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height);this.graph.isCellCollapsed(this.state.cell)||0==b&&0==l?this.childOffsetY=
this.childOffsetX=0:(this.childOffsetX=this.state.x-this.bounds.x+c,this.childOffsetY=this.state.y-this.bounds.y+g);this.livePreview&&this.updateLivePreview(a);null!=this.preview&&this.drawPreview()};
mxVertexHandler.prototype.updateLivePreview=function(a){var b=this.graph.view.scale,c=this.graph.view.translate;a=new mxRectangle(this.state.x,this.state.y,this.state.width,this.state.height);var d=this.state.origin;this.state.x=this.bounds.x;this.state.y=this.bounds.y;this.state.origin=new mxPoint(this.state.x/b-c.x,this.state.y/b-c.y);this.state.width=this.bounds.width;this.state.height=this.bounds.height;b=this.state.absoluteOffset;b=new mxPoint(b.x,b.y);this.state.absoluteOffset.x=0;this.state.absoluteOffset.y=
0;c=this.graph.getCellGeometry(this.state.cell);if(null!=c){var e=c.offset||this.EMPTY_POINT;null!=e&&!c.relative&&(this.state.absoluteOffset.x=this.state.view.scale*e.x,this.state.absoluteOffset.y=this.state.view.scale*e.y);this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,!0);this.state.view.invalidate(this.state.cell);this.state.invalid=!1;this.state.view.validate();this.redrawHandles();this.state.x=a.x;this.state.y=a.y;this.state.width=a.width;
this.state.height=a.height;this.state.origin=d;this.state.absoluteOffset=b};
mxVertexHandler.prototype.mouseUp=function(a,b){if(null!=this.index&&null!=this.state){var c=new mxPoint(b.getGraphX(),b.getGraphY());this.graph.getModel().beginUpdate();try{if(this.index<=mxEvent.CUSTOM_HANDLE)null!=this.customHandles&&this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].execute();else if(this.index==mxEvent.ROTATION_HANDLE)if(null!=this.currentAlpha){var d=this.currentAlpha-(this.state.style[mxConstants.STYLE_ROTATION]||0);0!=d&&this.rotateCell(this.state.cell,d)}else this.rotateClick();
else{var e=this.graph.isGridEnabledEvent(b.getEvent()),f=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),g=Math.cos(-f),k=Math.sin(-f),l=c.x-this.startX,m=c.y-this.startY,c=k*l+g*m,l=g*l-k*m,m=c,n=this.graph.view.scale,p=this.isRecursiveResize(this.state,b);this.resizeCell(this.state.cell,this.roundLength(l/n),this.roundLength(m/n),this.index,e,this.isConstrainedEvent(b),p)}}finally{this.graph.getModel().endUpdate()}b.consume();this.reset()}};
mxVertexHandler.prototype.isRecursiveResize=function(a,b){return this.graph.isRecursiveResize(this.state)};mxVertexHandler.prototype.rotateClick=function(){};
mxVertexHandler.prototype.rotateCell=function(a,b,c){if(0!=b){var d=this.graph.getModel();if(d.isVertex(a)||d.isEdge(a)){if(!d.isEdge(a)){var e=this.graph.view.getState(a),e=null!=e?e.style:this.graph.getCellStyle(a);null!=e&&this.graph.setCellStyles(mxConstants.STYLE_ROTATION,(e[mxConstants.STYLE_ROTATION]||0)+b,[a])}e=this.graph.getCellGeometry(a);if(null!=e){var f=this.graph.getCellGeometry(c);null!=f&&!d.isEdge(c)&&(e=e.clone(),e.rotate(b,new mxPoint(f.width/2,f.height/2)),d.setGeometry(a,e));
if(d.isVertex(a)&&!e.relative||d.isEdge(a))for(c=d.getChildCount(a),e=0;e<c;e++)this.rotateCell(d.getChildAt(a,e),b,a)}}}};
mxVertexHandler.prototype.reset=function(){null!=this.sizers&&null!=this.index&&null!=this.sizers[this.index]&&"none"==this.sizers[this.index].node.style.display&&(this.sizers[this.index].node.style.display="");this.index=this.inTolerance=this.currentAlpha=null;null!=this.preview&&(this.preview.destroy(),this.preview=null);if(this.livePreview&&null!=this.sizers)for(var a=0;a<this.sizers.length;a++)null!=this.sizers[a]&&(this.sizers[a].node.style.display="");if(null!=this.customHandles)for(a=0;a<this.customHandles.length;a++)this.customHandles[a].reset();
null!=this.selectionBorder&&(this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview());this.removeHint();this.redrawHandles();this.unscaledBounds=this.edgeHandlers=null};
mxVertexHandler.prototype.resizeCell=function(a,b,c,d,e,f,g){e=this.graph.model.getGeometry(a);null!=e&&(d==mxEvent.LABEL_HANDLE?(c=this.graph.view.scale,b=Math.round((this.labelShape.bounds.getCenterX()-this.startX)/c),c=Math.round((this.labelShape.bounds.getCenterY()-this.startY)/c),e=e.clone(),null==e.offset?e.offset=new mxPoint(b,c):(e.offset.x+=b,e.offset.y+=c),this.graph.model.setGeometry(a,e)):null!=this.unscaledBounds&&(c=this.graph.view.scale,(0!=this.childOffsetX||0!=this.childOffsetY)&&
this.moveChildren(a,Math.round(this.childOffsetX/c),Math.round(this.childOffsetY/c)),this.graph.resizeCell(a,this.unscaledBounds,g)))};mxVertexHandler.prototype.moveChildren=function(a,b,c){for(var d=this.graph.getModel(),e=d.getChildCount(a),f=0;f<e;f++){var g=d.getChildAt(a,f),k=this.graph.getCellGeometry(g);null!=k&&(k=k.clone(),k.translate(b,c),d.setGeometry(g,k))}};
mxVertexHandler.prototype.union=function(a,b,c,d,e,f,g,k){if(this.singleSizer)return d=a.x+a.width+b,g=a.y+a.height+c,e&&(d=this.graph.snap(d/f)*f,g=this.graph.snap(g/f)*f),f=new mxRectangle(a.x,a.y,0,0),f.add(new mxRectangle(d,g,0,0)),f;var l=a.x-g.x*f,m=l+a.width,n=a.y-g.y*f;a=n+a.height;4<d?(a+=c,e&&(a=this.graph.snap(a/f)*f)):3>d&&(n+=c,e&&(n=this.graph.snap(n/f)*f));if(0==d||3==d||5==d)l+=b,e&&(l=this.graph.snap(l/f)*f);else if(2==d||4==d||7==d)m+=b,e&&(m=this.graph.snap(m/f)*f);e=m-l;c=a-n;
k&&(k=this.graph.getCellGeometry(this.state.cell),null!=k&&(k=k.width/k.height,1==d||2==d||7==d||6==d?e=c*k:c=e/k,0==d&&(l=m-e,n=a-c)));0>e&&(l+=e,e=Math.abs(e));0>c&&(n+=c,c=Math.abs(c));d=new mxRectangle(l+g.x*f,n+g.y*f,e,c);null!=this.minBounds&&(d.width=Math.max(d.width,this.minBounds.x*f+this.minBounds.width*f+Math.max(0,this.x0*f-d.x)),d.height=Math.max(d.height,this.minBounds.y*f+this.minBounds.height*f+Math.max(0,this.y0*f-d.y)));return d};
mxVertexHandler.prototype.redraw=function(){this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.redrawHandles();this.drawPreview()};
mxVertexHandler.prototype.redrawHandles=function(){this.verticalOffset=this.horizontalOffset=0;var a=this.bounds;if(null!=this.sizers&&0<this.sizers.length){if(null==this.index&&this.manageSizers&&8<=this.sizers.length){var b=this.tolerance;if(a.width<2*this.sizers[0].bounds.width+2*b||a.height<2*this.sizers[0].bounds.height+2*b)a=new mxRectangle(a.x,a.y,a.width,a.height),b/=2,this.horizontalOffset=this.sizers[0].bounds.width+b,this.verticalOffset=this.sizers[0].bounds.height+b,a.x-=this.horizontalOffset/
2,a.width+=this.horizontalOffset,a.y-=this.verticalOffset/2,a.height+=this.verticalOffset;8<=this.sizers.length&&(a.width<2*this.sizers[0].bounds.width+2*b||a.height<2*this.sizers[0].bounds.height+2*b?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=
""))}var b=a.x+a.width,c=a.y+a.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],b,c);else{var d=a.x+a.width/2,e=a.y+a.height/2;if(8<=this.sizers.length){var f="nw-resize n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize".split(" "),g=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),k=Math.cos(g),l=Math.sin(g),g=Math.round(4*g/Math.PI),m=new mxPoint(a.getCenterX(),a.getCenterY()),n=mxUtils.getRotatedPoint(new mxPoint(a.x,a.y),k,l,m);this.moveSizerTo(this.sizers[0],
n.x,n.y);this.sizers[0].setCursor(f[mxUtils.mod(0+g,f.length)]);n.x=d;n.y=a.y;n=mxUtils.getRotatedPoint(n,k,l,m);this.moveSizerTo(this.sizers[1],n.x,n.y);this.sizers[1].setCursor(f[mxUtils.mod(1+g,f.length)]);n.x=b;n.y=a.y;n=mxUtils.getRotatedPoint(n,k,l,m);this.moveSizerTo(this.sizers[2],n.x,n.y);this.sizers[2].setCursor(f[mxUtils.mod(2+g,f.length)]);n.x=a.x;n.y=e;n=mxUtils.getRotatedPoint(n,k,l,m);this.moveSizerTo(this.sizers[3],n.x,n.y);this.sizers[3].setCursor(f[mxUtils.mod(7+g,f.length)]);n.x=
b;n.y=e;n=mxUtils.getRotatedPoint(n,k,l,m);this.moveSizerTo(this.sizers[4],n.x,n.y);this.sizers[4].setCursor(f[mxUtils.mod(3+g,f.length)]);n.x=a.x;n.y=c;n=mxUtils.getRotatedPoint(n,k,l,m);this.moveSizerTo(this.sizers[5],n.x,n.y);this.sizers[5].setCursor(f[mxUtils.mod(6+g,f.length)]);n.x=d;n.y=c;n=mxUtils.getRotatedPoint(n,k,l,m);this.moveSizerTo(this.sizers[6],n.x,n.y);this.sizers[6].setCursor(f[mxUtils.mod(5+g,f.length)]);n.x=b;n.y=c;n=mxUtils.getRotatedPoint(n,k,l,m);this.moveSizerTo(this.sizers[7],
n.x,n.y);this.sizers[7].setCursor(f[mxUtils.mod(4+g,f.length)]);this.moveSizerTo(this.sizers[8],d+this.state.absoluteOffset.x,e+this.state.absoluteOffset.y)}else 2<=this.state.width&&2<=this.state.height?this.moveSizerTo(this.sizers[0],d+this.state.absoluteOffset.x,e+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y)}}null!=this.rotationShape&&(g=mxUtils.toRadians(null!=this.currentAlpha?this.currentAlpha:this.state.style[mxConstants.STYLE_ROTATION]||"0"),k=Math.cos(g),
l=Math.sin(g),m=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),n=mxUtils.getRotatedPoint(new mxPoint(a.x+a.width/2,a.y+this.rotationHandleVSpacing),k,l,m),null!=this.rotationShape.node&&this.moveSizerTo(this.rotationShape,n.x,n.y));null!=this.selectionBorder&&(this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"));if(null!=this.edgeHandlers)for(a=0;a<this.edgeHandlers.length;a++)this.edgeHandlers[a].redraw();if(null!=this.customHandles)for(a=0;a<this.customHandles.length;a++)this.customHandles[a].redraw();
this.updateParentHighlight()};
mxVertexHandler.prototype.updateParentHighlight=function(){if(null!=this.selectionBorder)if(null!=this.parentHighlight){var a=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(a)){var a=this.graph.view.getState(a),b=this.parentHighlight.bounds;null==a||b.x==a.x&&b.y==a.y&&b.width==a.width&&b.height==a.height||(this.parentHighlight.bounds=a,this.parentHighlight.redraw())}else this.parentHighlight.destroy(),this.parentHighlight=null}else this.parentHighlightEnabled&&(a=this.graph.model.getParent(this.state.cell),
this.graph.model.isVertex(a)&&(a=this.graph.view.getState(a),null!=a&&(this.parentHighlight=this.createParentHighlightShape(a),this.parentHighlight.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=Number(a.style[mxConstants.STYLE_ROTATION]||"0"),this.parentHighlight.init(this.graph.getView().getOverlayPane()))))};
mxVertexHandler.prototype.drawPreview=function(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode==this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.preview.redraw());this.selectionBorder.bounds=this.bounds;this.selectionBorder.redraw();null!=this.parentHighlight&&this.parentHighlight.redraw()};
mxVertexHandler.prototype.destroy=function(){null!=this.escapeHandler&&(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=null);null!=this.preview&&(this.preview.destroy(),this.preview=null);null!=this.parentHighlight&&(this.parentHighlight.destroy(),this.parentHighlight=null);this.selectionBorder.destroy();this.labelShape=this.selectionBorder=null;this.removeHint();if(null!=this.sizers){for(var a=0;a<this.sizers.length;a++)this.sizers[a].destroy();this.sizers=null}if(null!=
this.customHandles){for(a=0;a<this.customHandles.length;a++)this.customHandles[a].destroy();this.customHandles=null}};function mxEdgeHandler(a){null!=a&&(this.state=a,this.init(),this.escapeHandler=mxUtils.bind(this,function(a,c){this.reset()}),this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler))}mxEdgeHandler.prototype.graph=null;mxEdgeHandler.prototype.state=null;mxEdgeHandler.prototype.marker=null;mxEdgeHandler.prototype.constraintHandler=null;mxEdgeHandler.prototype.error=null;
mxEdgeHandler.prototype.shape=null;mxEdgeHandler.prototype.bends=null;mxEdgeHandler.prototype.labelShape=null;mxEdgeHandler.prototype.cloneEnabled=!0;mxEdgeHandler.prototype.addEnabled=!1;mxEdgeHandler.prototype.removeEnabled=!1;mxEdgeHandler.prototype.dblClickRemoveEnabled=!1;mxEdgeHandler.prototype.mergeRemoveEnabled=!1;mxEdgeHandler.prototype.straightRemoveEnabled=!1;mxEdgeHandler.prototype.virtualBendsEnabled=!1;mxEdgeHandler.prototype.virtualBendOpacity=20;
mxEdgeHandler.prototype.parentHighlightEnabled=!1;mxEdgeHandler.prototype.preferHtml=!1;mxEdgeHandler.prototype.allowHandleBoundsCheck=!0;mxEdgeHandler.prototype.snapToTerminals=!1;mxEdgeHandler.prototype.handleImage=null;mxEdgeHandler.prototype.tolerance=0;mxEdgeHandler.prototype.outlineConnect=!1;mxEdgeHandler.prototype.manageLabelHandle=!1;
mxEdgeHandler.prototype.init=function(){this.graph=this.state.view.graph;this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.points=[];this.abspoints=this.getSelectionPoints(this.state);this.shape=this.createSelectionShape(this.abspoints);this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;this.shape.init(this.graph.getView().getOverlayPane());this.shape.pointerEvents=!1;this.shape.setCursor(mxConstants.CURSOR_MOVABLE_EDGE);
mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state);this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode==this.graph.container;if(!this.preferHtml){var a=this.state.getVisibleTerminalState(!0);null!=a&&(this.preferHtml=null!=a.text&&a.text.node.parentNode==this.graph.container);this.preferHtml||(a=this.state.getVisibleTerminalState(!1),null!=a&&(this.preferHtml=null!=a.text&&a.text.node.parentNode==this.graph.container))}this.parentHighlightEnabled&&(a=this.graph.model.getParent(this.state.cell),
this.graph.model.isVertex(a)&&(a=this.graph.view.getState(a),null!=a&&(this.parentHighlight=this.createParentHighlightShape(a),this.parentHighlight.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=Number(a.style[mxConstants.STYLE_ROTATION]||"0"),this.parentHighlight.init(this.graph.getView().getOverlayPane()))));if(this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells||
0>=mxGraphHandler.prototype.maxCells)this.bends=this.createBends(),this.isVirtualBendsEnabled()&&(this.virtualBends=this.createVirtualBends());this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y);this.labelShape=this.createLabelHandleShape();this.initBend(this.labelShape);this.labelShape.setCursor(mxConstants.CURSOR_LABEL_HANDLE);this.customHandles=this.createCustomHandles();this.redraw()};mxEdgeHandler.prototype.createCustomHandles=function(){return null};
mxEdgeHandler.prototype.isVirtualBendsEnabled=function(a){return this.virtualBendsEnabled&&(null==this.state.style[mxConstants.STYLE_EDGE]||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.NONE||1==this.state.style[mxConstants.STYLE_NOEDGESTYLE])&&"arrow"!=mxUtils.getValue(this.state.style,mxConstants.STYLE_SHAPE,null)};mxEdgeHandler.prototype.isAddPointEvent=function(a){return mxEvent.isShiftDown(a)};mxEdgeHandler.prototype.isRemovePointEvent=function(a){return mxEvent.isShiftDown(a)};
mxEdgeHandler.prototype.getSelectionPoints=function(a){return a.absolutePoints};mxEdgeHandler.prototype.createParentHighlightShape=function(a){a=new mxRectangleShape(a,null,this.getSelectionColor());a.strokewidth=this.getSelectionStrokeWidth();a.isDashed=this.isSelectionDashed();return a};mxEdgeHandler.prototype.createSelectionShape=function(a){a=new this.state.shape.constructor;a.outline=!0;a.apply(this.state);a.isDashed=this.isSelectionDashed();a.stroke=this.getSelectionColor();a.isShadow=!1;return a};
mxEdgeHandler.prototype.getSelectionColor=function(){return mxConstants.EDGE_SELECTION_COLOR};mxEdgeHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.EDGE_SELECTION_STROKEWIDTH};mxEdgeHandler.prototype.isSelectionDashed=function(){return mxConstants.EDGE_SELECTION_DASHED};mxEdgeHandler.prototype.isConnectableCell=function(a){return!0};mxEdgeHandler.prototype.getCellAt=function(a,b){return this.outlineConnect?null:this.graph.getCellAt(a,b)};
mxEdgeHandler.prototype.createMarker=function(){var a=new mxCellMarker(this.graph),b=this;a.getCell=function(a){var d=mxCellMarker.prototype.getCell.apply(this,arguments),e=b.getPointForEvent(a);if(d==b.state.cell||null==d)d=b.getCellAt(e.x,e.y),b.state.cell==d&&(d=null);var f=b.graph.getModel();if(this.graph.isSwimlane(d)&&this.graph.hitsSwimlaneContent(d,e.x,e.y)||!b.isConnectableCell(d)||d==b.state.cell||null!=d&&!b.graph.connectableEdges&&f.isEdge(d)||f.isAncestor(b.state.cell,d))d=null;return d};
a.isValidState=function(a){var d=b.graph.getModel(),d=b.graph.view.getTerminalPort(a,b.graph.view.getState(d.getTerminal(b.state.cell,!b.isSource)),!b.isSource),d=null!=d?d.cell:null;b.error=b.validateConnection(b.isSource?a.cell:d,b.isSource?d:a.cell);return null==b.error};return a};mxEdgeHandler.prototype.validateConnection=function(a,b){return this.graph.getEdgeValidationError(this.state.cell,a,b)};
mxEdgeHandler.prototype.createBends=function(){for(var a=this.state.cell,b=[],c=0;c<this.abspoints.length;c++)if(this.isHandleVisible(c)){var d=c==this.abspoints.length-1,e=0==c||d;(e||this.graph.isCellBendable(a))&&mxUtils.bind(this,function(a){var d=this.createHandleShape(a);this.initBend(d,mxUtils.bind(this,mxUtils.bind(this,function(){this.dblClickRemoveEnabled&&this.removePoint(this.state,a)})));this.isHandleEnabled(c)&&d.setCursor(e?mxConstants.CURSOR_TERMINAL_HANDLE:mxConstants.CURSOR_BEND_HANDLE);
b.push(d);e||(this.points.push(new mxPoint(0,0)),d.node.style.visibility="hidden")})(c)}return b};mxEdgeHandler.prototype.createVirtualBends=function(){var a=[];if(this.graph.isCellBendable(this.state.cell))for(var b=1;b<this.abspoints.length;b++){var c=this.createHandleShape(b);this.initBend(c);c.setCursor(mxConstants.CURSOR_VIRTUAL_BEND_HANDLE);a.push(c)}return a};mxEdgeHandler.prototype.isHandleEnabled=function(a){return!0};
mxEdgeHandler.prototype.isHandleVisible=function(a){var b=this.state.getVisibleTerminalState(!0),c=this.state.getVisibleTerminalState(!1),d=this.graph.getCellGeometry(this.state.cell);return(null!=d?this.graph.view.getEdgeStyle(this.state,d.points,b,c):null)!=mxEdgeStyle.EntityRelation||0==a||a==this.abspoints.length-1};
mxEdgeHandler.prototype.createHandleShape=function(a){if(null!=this.handleImage)return a=new mxImageShape(new mxRectangle(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src),a.preserveImageAspect=!1,a;a=mxConstants.HANDLE_SIZE;this.preferHtml&&(a-=1);return new mxRectangleShape(new mxRectangle(0,0,a,a),mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};
mxEdgeHandler.prototype.createLabelHandleShape=function(){if(null!=this.labelHandleImage){var a=new mxImageShape(new mxRectangle(0,0,this.labelHandleImage.width,this.labelHandleImage.height),this.labelHandleImage.src);a.preserveImageAspect=!1;return a}a=mxConstants.LABEL_HANDLE_SIZE;return new mxRectangleShape(new mxRectangle(0,0,a,a),mxConstants.LABEL_HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};
mxEdgeHandler.prototype.initBend=function(a,b){this.preferHtml?(a.dialect=mxConstants.DIALECT_STRICTHTML,a.init(this.graph.container)):(a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,a.init(this.graph.getView().getOverlayPane()));mxEvent.redirectMouseEvents(a.node,this.graph,this.state,null,null,null,b);(mxClient.IS_QUIRKS||8==document.documentMode)&&mxEvent.addListener(a.node,"dragstart",function(a){mxEvent.consume(a);return!1});mxClient.IS_TOUCH&&
a.node.setAttribute("pointer-events","none")};
mxEdgeHandler.prototype.getHandleForEvent=function(a){function b(b){if(null!=b&&"none"!=b.node.style.display&&"hidden"!=b.node.style.visibility&&(a.isSource(b)||null!=d&&mxUtils.intersects(b.bounds,d))){var c=a.getGraphX()-b.bounds.getCenterX();b=a.getGraphY()-b.bounds.getCenterY();c=c*c+b*b;if(null==e||c<=e)return e=c,!0}return!1}var c=mxEvent.isMouseEvent(a.getEvent())?1:this.tolerance,d=this.allowHandleBoundsCheck&&(mxClient.IS_IE||0<c)?new mxRectangle(a.getGraphX()-c,a.getGraphY()-c,2*c,2*c):
null,e=null,c=null;if(null!=this.customHandles&&this.isCustomHandleEvent(a))for(var f=this.customHandles.length-1;0<=f;f--)if(b(this.customHandles[f].shape))return mxEvent.CUSTOM_HANDLE-f;if(a.isSource(this.state.text)||b(this.labelShape))c=mxEvent.LABEL_HANDLE;if(null!=this.bends)for(f=0;f<this.bends.length;f++)b(this.bends[f])&&(c=f);if(null!=this.virtualBends&&this.isAddVirtualBendEvent(a))for(f=0;f<this.virtualBends.length;f++)b(this.virtualBends[f])&&(c=mxEvent.VIRTUAL_HANDLE-f);return c};
mxEdgeHandler.prototype.isAddVirtualBendEvent=function(a){return!0};mxEdgeHandler.prototype.isCustomHandleEvent=function(a){return!0};
mxEdgeHandler.prototype.mouseDown=function(a,b){var c=this.getHandleForEvent(b);if(null!=this.bends&&null!=this.bends[c]){var d=this.bends[c].bounds;this.snapPoint=new mxPoint(d.getCenterX(),d.getCenterY())}if(this.addEnabled&&null==c&&this.isAddPointEvent(b.getEvent()))this.addPoint(this.state,b.getEvent());else if(null!=c&&!b.isConsumed()&&this.graph.isEnabled()){if(this.removeEnabled&&this.isRemovePointEvent(b.getEvent()))this.removePoint(this.state,c);else if(c!=mxEvent.LABEL_HANDLE||this.graph.isLabelMovable(b.getCell()))c<=
mxEvent.VIRTUAL_HANDLE&&mxUtils.setOpacity(this.virtualBends[mxEvent.VIRTUAL_HANDLE-c].node,100),this.start(b.getX(),b.getY(),c);b.consume()}};
mxEdgeHandler.prototype.start=function(a,b,c){this.startX=a;this.startY=b;this.isSource=null==this.bends?!1:0==c;this.isTarget=null==this.bends?!1:c==this.bends.length-1;this.isLabel=c==mxEvent.LABEL_HANDLE;if(this.isSource||this.isTarget){if(a=this.state.cell,b=this.graph.model.getTerminal(a,this.isSource),null==b&&this.graph.isTerminalPointMovable(a,this.isSource)||null!=b&&this.graph.isCellDisconnectable(a,b,this.isSource))this.index=c}else this.index=c;if(this.index<=mxEvent.CUSTOM_HANDLE&&this.index>
mxEvent.VIRTUAL_HANDLE&&null!=this.customHandles)for(c=0;c<this.customHandles.length;c++)c!=mxEvent.CUSTOM_HANDLE-this.index&&this.customHandles[c].setVisible(!1)};mxEdgeHandler.prototype.clonePreviewState=function(a,b){return this.state.clone()};mxEdgeHandler.prototype.getSnapToTerminalTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};mxEdgeHandler.prototype.updateHint=function(a,b){};mxEdgeHandler.prototype.removeHint=function(){};mxEdgeHandler.prototype.roundLength=function(a){return Math.round(a)};
mxEdgeHandler.prototype.isSnapToTerminalsEvent=function(a){return this.snapToTerminals&&!mxEvent.isAltDown(a.getEvent())};
mxEdgeHandler.prototype.getPointForEvent=function(a){var b=this.graph.getView(),c=b.scale,d=new mxPoint(this.roundLength(a.getGraphX()/c)*c,this.roundLength(a.getGraphY()/c)*c),e=this.getSnapToTerminalTolerance(),f=!1,g=!1;if(0<e&&this.isSnapToTerminalsEvent(a)){var k=function(a){if(null!=a){var b=a.x;Math.abs(d.x-b)<e&&(d.x=b,f=!0);a=a.y;Math.abs(d.y-a)<e&&(d.y=a,g=!0)}},l=function(a){null!=a&&k.call(this,new mxPoint(b.getRoutingCenterX(a),b.getRoutingCenterY(a)))};l.call(this,this.state.getVisibleTerminalState(!0));
l.call(this,this.state.getVisibleTerminalState(!1));if(null!=this.state.absolutePoints)for(l=0;l<this.state.absolutePoints.length;l++)k.call(this,this.state.absolutePoints[l])}this.graph.isGridEnabledEvent(a.getEvent())&&(a=b.translate,f||(d.x=(this.graph.snap(d.x/c-a.x)+a.x)*c),g||(d.y=(this.graph.snap(d.y/c-a.y)+a.y)*c));return d};
mxEdgeHandler.prototype.getPreviewTerminalState=function(a){this.constraintHandler.update(a,this.isSource);if(null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint)return this.marker.reset(),a=this.graph.getModel(),a=this.graph.view.getTerminalPort(this.state,this.graph.view.getState(a.getTerminal(this.state.cell,!this.isSource)),!this.isSource),a=null!=a?a.cell:null,this.error=this.validateConnection(this.isSource?this.constraintHandler.currentFocus.cell:a,this.isSource?
a:this.constraintHandler.currentFocus.cell),a=null,null==this.error?a=this.constraintHandler.currentFocus:this.constraintHandler.reset(),a;this.marker.process(a);return this.marker.getValidState()};
mxEdgeHandler.prototype.getPreviewPoints=function(a,b){var c=this.graph.getCellGeometry(this.state.cell),c=null!=c.points?c.points.slice():null,d=new mxPoint(a.x,a.y),e=null;if(this.isSource||this.isTarget)this.graph.resetEdgesOnConnect&&(c=null);else if(this.convertPoint(d,!1),null==c)c=[d];else{this.index<=mxEvent.VIRTUAL_HANDLE&&c.splice(mxEvent.VIRTUAL_HANDLE-this.index,0,d);if(!this.isSource&&!this.isTarget){for(var f=0;f<this.bends.length;f++)if(f!=this.index){var g=this.bends[f];null!=g&&mxUtils.contains(g.bounds,
a.x,a.y)&&(this.index<=mxEvent.VIRTUAL_HANDLE?c.splice(mxEvent.VIRTUAL_HANDLE-this.index,1):c.splice(this.index-1,1),e=c)}if(null==e&&this.straightRemoveEnabled&&(null==b||!mxEvent.isAltDown(b.getEvent()))){f=this.graph.tolerance*this.graph.tolerance;g=this.state.absolutePoints.slice();g[this.index]=a;var k=this.state.getVisibleTerminalState(!0);if(null!=k){var l=this.graph.getConnectionConstraint(this.state,k,!0);if(null==l||null==this.graph.getConnectionPoint(k,l))g[0]=new mxPoint(k.view.getRoutingCenterX(k),
k.view.getRoutingCenterY(k))}k=this.state.getVisibleTerminalState(!1);null!=k&&(l=this.graph.getConnectionConstraint(this.state,k,!1),null==l||null==this.graph.getConnectionPoint(k,l))&&(g[g.length-1]=new mxPoint(k.view.getRoutingCenterX(k),k.view.getRoutingCenterY(k)));l=this.index;0<l&&l<g.length-1&&mxUtils.ptSegDistSq(g[l-1].x,g[l-1].y,g[l+1].x,g[l+1].y,a.x,a.y)<f&&(c.splice(l-1,1),e=c)}}null==e&&this.index>mxEvent.VIRTUAL_HANDLE&&(c[this.index-1]=d)}return null!=e?e:c};
mxEdgeHandler.prototype.isOutlineConnectEvent=function(a){return this.outlineConnect&&!mxEvent.isShiftDown(a.getEvent())&&(a.isSource(this.marker.highlight.shape)||mxEvent.isAltDown(a.getEvent()))};
mxEdgeHandler.prototype.updatePreviewState=function(a,b,c,d){var e=this.isSource?c:this.state.getVisibleTerminalState(!0),f=this.isTarget?c:this.state.getVisibleTerminalState(!1),g=this.graph.getConnectionConstraint(a,e,!0),k=this.graph.getConnectionConstraint(a,f,!1),l=this.constraintHandler.currentConstraint;null==l&&(null!=c&&this.isOutlineConnectEvent(d)?(l=this.graph.getOutlineConstraint(b,c,d),this.constraintHandler.currentConstraint=l,this.constraintHandler.currentFocus=c,this.constraintHandler.currentPoint=
b):l=new mxConnectionConstraint);this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape&&(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus?(this.marker.highlight.shape.stroke=mxConstants.OUTLINE_HIGHLIGHT_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.OUTLINE_HIGHLIGHT_STROKEWIDTH/this.state.view.scale/this.state.view.scale,this.marker.highlight.repaint()):this.marker.hasValidState()&&(this.marker.highlight.shape.stroke=
mxConstants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokewidth=mxConstants.HIGHLIGHT_STROKEWIDTH/this.state.view.scale/this.state.view.scale,this.marker.highlight.repaint()));this.isSource?g=l:this.isTarget&&(k=l);a.setVisibleTerminalState(e,!0);a.setVisibleTerminalState(f,!1);this.isSource&&null==e||a.view.updateFixedTerminalPoint(a,e,!0,g);this.isTarget&&null==f||a.view.updateFixedTerminalPoint(a,f,!1,k);(this.isSource||this.isTarget)&&null==c&&(a.setAbsoluteTerminalPoint(b,this.isSource),
null==this.marker.getMarkedState()&&(this.error=this.graph.allowDanglingEdges?null:""));a.view.updatePoints(a,this.points,e,f);a.view.updateFloatingTerminalPoints(a,e,f)};
mxEdgeHandler.prototype.mouseMove=function(a,b){if(null!=this.index&&null!=this.marker){var c=this.getPointForEvent(b);this.error=null;mxEvent.isShiftDown(b.getEvent())&&null!=this.snapPoint&&(Math.abs(this.snapPoint.x-c.x)<Math.abs(this.snapPoint.y-c.y)?c.x=this.snapPoint.x:c.y=this.snapPoint.y);if(this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE)null!=this.customHandles&&this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(b);else if(this.isLabel)this.label.x=c.x,
this.label.y=c.y;else{this.points=this.getPreviewPoints(c,b);var d=this.isSource||this.isTarget?this.getPreviewTerminalState(b):null,e=this.clonePreviewState(c,null!=d?d.cell:null);this.updatePreviewState(e,c,d,b);this.setPreviewColor(null==this.error?this.marker.validColor:this.marker.invalidColor);this.abspoints=e.absolutePoints;this.active=!0}this.drawPreview();this.updateHint(b,c);mxEvent.consume(b.getEvent());b.consume()}else mxClient.IS_IE&&null!=this.getHandleForEvent(b)&&b.consume(!1)};
mxEdgeHandler.prototype.mouseUp=function(a,b){if(null!=this.index&&null!=this.marker){var c=this.state.cell;if(b.getX()!=this.startX||b.getY()!=this.startY){var d=this.graph.isCloneEvent(b.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable();if(null!=this.error)0<this.error.length&&this.graph.validationAlert(this.error);else if(this.index<=mxEvent.CUSTOM_HANDLE&&this.index>mxEvent.VIRTUAL_HANDLE){if(null!=this.customHandles){d=this.graph.getModel();d.beginUpdate();try{this.customHandles[mxEvent.CUSTOM_HANDLE-
this.index].execute()}finally{d.endUpdate()}}}else if(this.isLabel)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){var e=null;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(e=this.constraintHandler.currentFocus.cell);null==e&&this.marker.hasValidState()&&(e=this.marker.validState.cell);if(null!=e)c=this.connect(c,e,this.isSource,d,b);else if(this.graph.isAllowDanglingEdges()){e=this.abspoints[this.isSource?0:this.abspoints.length-
1];e.x=this.roundLength(e.x/this.graph.view.scale-this.graph.view.translate.x);e.y=this.roundLength(e.y/this.graph.view.scale-this.graph.view.translate.y);var f=this.graph.getView().getState(this.graph.getModel().getParent(c));null!=f&&(e.x-=f.origin.x,e.y-=f.origin.y);e.x-=this.graph.panDx/this.graph.view.scale;e.y-=this.graph.panDy/this.graph.view.scale;c=this.changeTerminalPoint(c,e,this.isSource,d)}}else this.active?c=this.changePoints(c,this.points,d):(this.graph.getView().invalidate(this.state.cell),
this.graph.getView().validate(this.state.cell))}null!=this.marker&&(this.reset(),c!=this.state.cell&&this.graph.setSelectionCell(c));b.consume()}};
mxEdgeHandler.prototype.reset=function(){this.snapPoint=this.points=this.label=this.index=this.error=null;this.isTarget=this.isSource=this.isLabel=this.active=!1;if(this.livePreview&&null!=this.sizers)for(var a=0;a<this.sizers.length;a++)null!=this.sizers[a]&&(this.sizers[a].node.style.display="");null!=this.marker&&this.marker.reset();null!=this.constraintHandler&&this.constraintHandler.reset();if(null!=this.customHandles)for(a=0;a<this.customHandles.length;a++)this.customHandles[a].reset();this.setPreviewColor(mxConstants.EDGE_SELECTION_COLOR);
this.removeHint();this.redraw()};mxEdgeHandler.prototype.setPreviewColor=function(a){null!=this.shape&&(this.shape.stroke=a)};mxEdgeHandler.prototype.convertPoint=function(a,b){var c=this.graph.getView().getScale(),d=this.graph.getView().getTranslate();b&&(a.x=this.graph.snap(a.x),a.y=this.graph.snap(a.y));a.x=Math.round(a.x/c-d.x);a.y=Math.round(a.y/c-d.y);c=this.graph.getView().getState(this.graph.getModel().getParent(this.state.cell));null!=c&&(a.x-=c.origin.x,a.y-=c.origin.y);return a};
mxEdgeHandler.prototype.moveLabel=function(a,b,c){var d=this.graph.getModel(),e=d.getGeometry(a.cell);if(null!=e){var f=this.graph.getView().scale,e=e.clone();if(e.relative){var g=this.graph.getView().getRelativePoint(a,b,c);e.x=Math.round(1E4*g.x)/1E4;e.y=Math.round(g.y);e.offset=new mxPoint(0,0);g=this.graph.view.getPoint(a,e);e.offset=new mxPoint(Math.round((b-g.x)/f),Math.round((c-g.y)/f))}else{var k=a.absolutePoints,g=k[0],k=k[k.length-1];if(null!=g&&null!=k){var l=g.y+(k.y-g.y)/2;e.offset=new mxPoint(Math.round((b-
(g.x+(k.x-g.x)/2))/f),Math.round((c-l)/f));e.x=0;e.y=0}}d.setGeometry(a.cell,e)}};mxEdgeHandler.prototype.connect=function(a,b,c,d,e){e=this.graph.getModel();var f=e.getParent(a);e.beginUpdate();try{if(d){var g=this.graph.cloneCells([a])[0];e.add(f,g,e.getChildCount(f));var k=e.getTerminal(a,!c);this.graph.connectCell(g,k,!c);a=g}var l=this.constraintHandler.currentConstraint;null==l&&(l=new mxConnectionConstraint);this.graph.connectCell(a,b,c,l)}finally{e.endUpdate()}return a};
mxEdgeHandler.prototype.changeTerminalPoint=function(a,b,c,d){var e=this.graph.getModel();e.beginUpdate();try{if(d){var f=e.getParent(a),g=e.getTerminal(a,!c);a=this.graph.cloneCells([a])[0];e.add(f,a,e.getChildCount(f));e.setTerminal(a,g,!c)}var k=e.getGeometry(a);null!=k&&(k=k.clone(),k.setTerminalPoint(b,c),e.setGeometry(a,k),this.graph.connectCell(a,null,c,new mxConnectionConstraint))}finally{e.endUpdate()}return a};
mxEdgeHandler.prototype.changePoints=function(a,b,c){var d=this.graph.getModel();d.beginUpdate();try{if(c){var e=d.getParent(a),f=d.getTerminal(a,!0),g=d.getTerminal(a,!1);a=this.graph.cloneCells([a])[0];d.add(e,a,d.getChildCount(e));d.setTerminal(a,f,!0);d.setTerminal(a,g,!1)}var k=d.getGeometry(a);null!=k&&(k=k.clone(),k.points=b,d.setGeometry(a,k))}finally{d.endUpdate()}return a};
mxEdgeHandler.prototype.addPoint=function(a,b){var c=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(b),mxEvent.getClientY(b)),d=this.graph.isGridEnabledEvent(b);this.convertPoint(c,d);this.addPointAt(a,c.x,c.y);mxEvent.consume(b)};
mxEdgeHandler.prototype.addPointAt=function(a,b,c){var d=this.graph.getCellGeometry(a.cell);b=new mxPoint(b,c);if(null!=d){var d=d.clone(),e=this.graph.view.translate;c=this.graph.view.scale;var e=new mxPoint(e.x*c,e.y*c),f=this.graph.model.getParent(this.state.cell);this.graph.model.isVertex(f)&&(e=this.graph.view.getState(f),e=new mxPoint(e.x,e.y));c=mxUtils.findNearestSegment(a,b.x*c+e.x,b.y*c+e.y);null==d.points?d.points=[b]:d.points.splice(c,0,b);this.graph.getModel().setGeometry(a.cell,d);this.refresh();
this.redraw()}};mxEdgeHandler.prototype.removePoint=function(a,b){if(0<b&&b<this.abspoints.length-1){var c=this.graph.getCellGeometry(this.state.cell);null!=c&&null!=c.points&&(c=c.clone(),c.points.splice(b-1,1),this.graph.getModel().setGeometry(a.cell,c),this.refresh(),this.redraw())}};
mxEdgeHandler.prototype.getHandleFillColor=function(a){a=0==a;var b=this.state.cell,c=this.graph.getModel().getTerminal(b,a),d=mxConstants.HANDLE_FILLCOLOR;null!=c&&!this.graph.isCellDisconnectable(b,c,a)||null==c&&!this.graph.isTerminalPointMovable(b,a)?d=mxConstants.LOCKED_HANDLE_FILLCOLOR:null!=c&&this.graph.isCellDisconnectable(b,c,a)&&(d=mxConstants.CONNECT_HANDLE_FILLCOLOR);return d};
mxEdgeHandler.prototype.redraw=function(){this.abspoints=this.state.absolutePoints.slice();this.redrawHandles();var a=this.graph.getModel().getGeometry(this.state.cell).points;if(null!=this.bends&&0<this.bends.length&&null!=a){null==this.points&&(this.points=[]);for(var b=1;b<this.bends.length-1;b++)null!=this.bends[b]&&null!=this.abspoints[b]&&(this.points[b-1]=a[b-1])}this.drawPreview()};
mxEdgeHandler.prototype.redrawHandles=function(){var a=this.state.cell,b=this.labelShape.bounds;this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y);this.labelShape.bounds=new mxRectangle(Math.round(this.label.x-b.width/2),Math.round(this.label.y-b.height/2),b.width,b.height);b=this.graph.getLabel(a);this.labelShape.visible=null!=b&&0<b.length&&this.graph.isLabelMovable(a);if(null!=this.bends&&0<this.bends.length){var c=this.abspoints.length-1,a=this.abspoints[0],d=a.x,
e=a.y,b=this.bends[0].bounds;this.bends[0].bounds=new mxRectangle(Math.round(d-b.width/2),Math.round(e-b.height/2),b.width,b.height);this.bends[0].fill=this.getHandleFillColor(0);this.bends[0].redraw();this.manageLabelHandle&&this.checkLabelHandle(this.bends[0].bounds);var c=this.abspoints[c],d=c.x,e=c.y,f=this.bends.length-1,b=this.bends[f].bounds;this.bends[f].bounds=new mxRectangle(Math.round(d-b.width/2),Math.round(e-b.height/2),b.width,b.height);this.bends[f].fill=this.getHandleFillColor(f);
this.bends[f].redraw();this.manageLabelHandle&&this.checkLabelHandle(this.bends[f].bounds);this.redrawInnerBends(a,c)}if(null!=this.abspoints&&null!=this.virtualBends&&0<this.virtualBends.length)for(a=this.abspoints[0],c=0;c<this.virtualBends.length;c++)null!=this.virtualBends[c]&&null!=this.abspoints[c+1]&&(d=this.abspoints[c+1],b=this.virtualBends[c],e=a.y+(d.y-a.y)/2,b.bounds=new mxRectangle(Math.round(a.x+(d.x-a.x)/2-b.bounds.width/2),Math.round(e-b.bounds.height/2),b.bounds.width,b.bounds.height),
b.redraw(),mxUtils.setOpacity(b.node,this.virtualBendOpacity),a=d,this.manageLabelHandle&&this.checkLabelHandle(b.bounds));null!=this.labelShape&&this.labelShape.redraw();if(null!=this.customHandles)for(c=0;c<this.customHandles.length;c++)this.customHandles[c].redraw()};
mxEdgeHandler.prototype.setHandlesVisible=function(a){if(null!=this.bends)for(var b=0;b<this.bends.length;b++)this.bends[b].node.style.display=a?"":"none";if(null!=this.virtualBends)for(b=0;b<this.virtualBends.length;b++)this.virtualBends[b].node.style.display=a?"":"none";null!=this.labelShape&&(this.labelShape.node.style.display=a?"":"none");if(null!=this.customHandles)for(b=0;b<this.customHandles.length;b++)this.customHandles[b].setVisible(a)};
mxEdgeHandler.prototype.redrawInnerBends=function(a,b){for(var c=1;c<this.bends.length-1;c++)if(null!=this.bends[c])if(null!=this.abspoints[c]){var d=this.abspoints[c].x,e=this.abspoints[c].y,f=this.bends[c].bounds;this.bends[c].node.style.visibility="visible";this.bends[c].bounds=new mxRectangle(Math.round(d-f.width/2),Math.round(e-f.height/2),f.width,f.height);this.manageLabelHandle?this.checkLabelHandle(this.bends[c].bounds):null==this.handleImage&&this.labelShape.visible&&mxUtils.intersects(this.bends[c].bounds,
this.labelShape.bounds)&&(w=mxConstants.HANDLE_SIZE+3,h=mxConstants.HANDLE_SIZE+3,this.bends[c].bounds=new mxRectangle(Math.round(d-w/2),Math.round(e-h/2),w,h));this.bends[c].redraw()}else this.bends[c].destroy(),this.bends[c]=null};mxEdgeHandler.prototype.checkLabelHandle=function(a){if(null!=this.labelShape){var b=this.labelShape.bounds;mxUtils.intersects(a,b)&&(a.getCenterY()<b.getCenterY()?b.y=a.y+a.height:b.y=a.y-b.height)}};
mxEdgeHandler.prototype.drawPreview=function(){if(this.isLabel){var a=this.labelShape.bounds,a=new mxRectangle(Math.round(this.label.x-a.width/2),Math.round(this.label.y-a.height/2),a.width,a.height);this.labelShape.bounds=a;this.labelShape.redraw()}else null!=this.shape&&(this.shape.apply(this.state),this.shape.points=this.abspoints,this.shape.scale=this.state.view.scale,this.shape.isDashed=this.isSelectionDashed(),this.shape.stroke=this.getSelectionColor(),this.shape.strokewidth=this.getSelectionStrokeWidth()/
this.shape.scale/this.shape.scale,this.shape.arrowStrokewidth=this.getSelectionStrokeWidth(),this.shape.isShadow=!1,this.shape.redraw());null!=this.parentHighlight&&this.parentHighlight.redraw()};
mxEdgeHandler.prototype.refresh=function(){this.abspoints=this.getSelectionPoints(this.state);this.points=[];null!=this.shape&&(this.shape.points=this.abspoints);null!=this.bends&&(this.destroyBends(this.bends),this.bends=this.createBends());null!=this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=this.createVirtualBends());null!=this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=this.createCustomHandles());null!=this.labelShape&&null!=this.labelShape.node&&
null!=this.labelShape.node.parentNode&&this.labelShape.node.parentNode.appendChild(this.labelShape.node)};mxEdgeHandler.prototype.destroyBends=function(a){if(null!=a)for(var b=0;b<a.length;b++)null!=a[b]&&a[b].destroy()};
mxEdgeHandler.prototype.destroy=function(){null!=this.escapeHandler&&(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=null);null!=this.marker&&(this.marker.destroy(),this.marker=null);null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.parentHighlight&&(this.parentHighlight.destroy(),this.parentHighlight=null);null!=this.labelShape&&(this.labelShape.destroy(),this.labelShape=null);null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=
null);this.destroyBends(this.virtualBends);this.virtualBends=null;this.destroyBends(this.customHandles);this.customHandles=null;this.destroyBends(this.bends);this.bends=null;this.removeHint()};function mxElbowEdgeHandler(a){mxEdgeHandler.call(this,a)}mxUtils.extend(mxElbowEdgeHandler,mxEdgeHandler);mxElbowEdgeHandler.prototype=new mxEdgeHandler;mxElbowEdgeHandler.prototype.constructor=mxElbowEdgeHandler;mxElbowEdgeHandler.prototype.flipEnabled=!0;
mxElbowEdgeHandler.prototype.doubleClickOrientationResource="none"!=mxClient.language?"doubleClickOrientation":"";
mxElbowEdgeHandler.prototype.createBends=function(){var a=[],b=this.createHandleShape(0);this.initBend(b);b.setCursor(mxConstants.CURSOR_BEND_HANDLE);a.push(b);a.push(this.createVirtualBend(mxUtils.bind(this,function(a){!mxEvent.isConsumed(a)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell,a),mxEvent.consume(a))})));this.points.push(new mxPoint(0,0));b=this.createHandleShape(2);this.initBend(b);b.setCursor(mxConstants.CURSOR_BEND_HANDLE);a.push(b);return a};
mxElbowEdgeHandler.prototype.createVirtualBend=function(a){var b=this.createHandleShape();this.initBend(b,a);b.setCursor(this.getCursorForBend());this.graph.isCellBendable(this.state.cell)||(b.node.style.display="none");return b};
mxElbowEdgeHandler.prototype.getCursorForBend=function(){return this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.TopToBottom||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_TOPTOBOTTOM||(this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.ElbowConnector||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_ELBOW)&&this.state.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL?"row-resize":"col-resize"};
mxElbowEdgeHandler.prototype.getTooltipForNode=function(a){var b=null;null==this.bends||null==this.bends[1]||a!=this.bends[1].node&&a.parentNode!=this.bends[1].node||(b=this.doubleClickOrientationResource,b=mxResources.get(b)||b);return b};
mxElbowEdgeHandler.prototype.convertPoint=function(a,b){var c=this.graph.getView().getScale(),d=this.graph.getView().getTranslate(),e=this.state.origin;b&&(a.x=this.graph.snap(a.x),a.y=this.graph.snap(a.y));a.x=Math.round(a.x/c-d.x-e.x);a.y=Math.round(a.y/c-d.y-e.y);return a};
mxElbowEdgeHandler.prototype.redrawInnerBends=function(a,b){var c=this.graph.getModel().getGeometry(this.state.cell),d=this.state.absolutePoints,e=null;1<d.length?(a=d[1],b=d[d.length-2]):null!=c.points&&0<c.points.length&&(e=d[0]);e=null==e?new mxPoint(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2):new mxPoint(this.graph.getView().scale*(e.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(e.y+this.graph.getView().translate.y+this.state.origin.y));d=this.bends[1].bounds;c=d.width;
d=d.height;c=new mxRectangle(Math.round(e.x-c/2),Math.round(e.y-d/2),c,d);this.manageLabelHandle?this.checkLabelHandle(c):null==this.handleImage&&this.labelShape.visible&&mxUtils.intersects(c,this.labelShape.bounds)&&(c=mxConstants.HANDLE_SIZE+3,d=mxConstants.HANDLE_SIZE+3,c=new mxRectangle(Math.round(e.x-c/2),Math.round(e.y-d/2),c,d));this.bends[1].bounds=c;this.bends[1].redraw();this.manageLabelHandle&&this.checkLabelHandle(this.bends[1].bounds)};
function mxEdgeSegmentHandler(a){mxEdgeHandler.call(this,a)}mxUtils.extend(mxEdgeSegmentHandler,mxEdgeHandler);mxEdgeSegmentHandler.prototype=new mxElbowEdgeHandler;mxEdgeSegmentHandler.prototype.constructor=mxEdgeSegmentHandler;
mxEdgeSegmentHandler.prototype.getCurrentPoints=function(){var a=this.state.absolutePoints;if(null!=a&&(2==a.length||3==a.length&&(a[0].x==a[1].x&&a[1].x==a[2].x||a[0].y==a[1].y&&a[1].y==a[2].y)))var b=a[0].x+(a[a.length-1].x-a[0].x)/2,c=a[0].y+(a[a.length-1].y-a[0].y)/2,a=[a[0],new mxPoint(b,c),new mxPoint(b,c),a[a.length-1]];return a};
mxEdgeSegmentHandler.prototype.getPreviewPoints=function(a){if(this.isSource||this.isTarget)return mxElbowEdgeHandler.prototype.getPreviewPoints.apply(this,arguments);var b=this.getCurrentPoints(),c=this.convertPoint(b[0].clone(),!1);a=this.convertPoint(a.clone(),!1);for(var d=[],e=1;e<b.length;e++){var f=this.convertPoint(b[e].clone(),!1);e==this.index&&(0==Math.round(c.x-f.x)&&(c.x=a.x,f.x=a.x),0==Math.round(c.y-f.y)&&(c.y=a.y,f.y=a.y));e<b.length-1&&d.push(f);c=f}if(1==d.length){var b=this.state.getVisibleTerminalState(!0),
c=this.state.getVisibleTerminalState(!1),f=this.state.view.getScale(),g=this.state.view.getTranslate(),e=d[0].x*f+g.x,f=d[0].y*f+g.y;if(null!=b&&mxUtils.contains(b,e,f)||null!=c&&mxUtils.contains(c,e,f))d=[a,a]}return d};
mxEdgeSegmentHandler.prototype.updatePreviewState=function(a,b,c,d){mxEdgeHandler.prototype.updatePreviewState.apply(this,arguments);if(!this.isSource&&!this.isTarget){b=this.convertPoint(b.clone(),!1);for(var e=a.absolutePoints,f=e[0],g=e[1],k=[],l=2;l<e.length;l++){var m=e[l];0==Math.round(f.x-g.x)&&0==Math.round(g.x-m.x)||0==Math.round(f.y-g.y)&&0==Math.round(g.y-m.y)||k.push(this.convertPoint(g.clone(),!1));f=g;g=m}f=this.state.getVisibleTerminalState(!0);g=this.state.getVisibleTerminalState(!1);
l=this.state.absolutePoints;if(0==k.length&&(0==Math.round(e[0].x-e[e.length-1].x)||0==Math.round(e[0].y-e[e.length-1].y)))k=[b,b];else if(5==e.length&&2==k.length&&null!=f&&null!=g&&null!=l&&0==Math.round(l[0].x-l[l.length-1].x)){var k=this.graph.getView(),l=k.getScale(),m=k.getTranslate(),e=k.getRoutingCenterY(f)/l-m.y,n=this.graph.getConnectionConstraint(a,f,!0);null!=n&&(n=this.graph.getConnectionPoint(f,n),null!=n&&(this.convertPoint(n,!1),e=n.y));k=k.getRoutingCenterY(g)/l-m.y;if(l=this.graph.getConnectionConstraint(a,
g,!1))n=this.graph.getConnectionPoint(g,l),null!=n&&(this.convertPoint(n,!1),k=n.y);k=[new mxPoint(b.x,e),new mxPoint(b.x,k)]}this.points=k;a.view.updateFixedTerminalPoints(a,f,g);a.view.updatePoints(a,this.points,f,g);a.view.updateFloatingTerminalPoints(a,f,g)}};
mxEdgeSegmentHandler.prototype.connect=function(a,b,c,d,e){for(var f=this.abspoints,g=f[0],k=f[1],l=[],m=2;m<f.length;m++){var n=f[m];0==Math.round(g.x-k.x)&&0==Math.round(k.x-n.x)||0==Math.round(g.y-k.y)&&0==Math.round(k.y-n.y)||l.push(this.convertPoint(k.clone(),!1));g=k;k=n}f=this.graph.getModel();f.beginUpdate();try{a=mxEdgeHandler.prototype.connect.apply(this,arguments);var p=f.getGeometry(a);null!=p&&(p=p.clone(),p.points=l,f.setGeometry(a,p))}finally{f.endUpdate()}return a};
mxEdgeSegmentHandler.prototype.getTooltipForNode=function(a){return null};mxEdgeSegmentHandler.prototype.start=function(a,b,c){mxEdgeHandler.prototype.start.apply(this,arguments);null==this.bends[c]||this.isSource||this.isTarget||mxUtils.setOpacity(this.bends[c].node,100)};
mxEdgeSegmentHandler.prototype.createBends=function(){var a=[],b=this.createHandleShape(0);this.initBend(b);b.setCursor(mxConstants.CURSOR_BEND_HANDLE);a.push(b);var c=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(var d=0;d<c.length-1;d++){b=this.createVirtualBend();a.push(b);var e=0==Math.round(c[d].x-c[d+1].x);0==Math.round(c[d].y-c[d+1].y)&&d<c.length-2&&(e=0==Math.round(c[d].x-c[d+2].x));b.setCursor(e?"col-resize":"row-resize");
this.points.push(new mxPoint(0,0))}}b=this.createHandleShape(c.length);this.initBend(b);b.setCursor(mxConstants.CURSOR_BEND_HANDLE);a.push(b);return a};mxEdgeSegmentHandler.prototype.redraw=function(){this.refresh();mxEdgeHandler.prototype.redraw.apply(this,arguments)};
mxEdgeSegmentHandler.prototype.redrawInnerBends=function(a,b){if(this.graph.isCellBendable(this.state.cell)){var c=this.getCurrentPoints();if(null!=c&&1<c.length){var d=!1;if(4==c.length&&0==Math.round(c[1].x-c[2].x)&&0==Math.round(c[1].y-c[2].y))if(d=!0,0==Math.round(c[0].y-c[c.length-1].y)){var e=c[0].x+(c[c.length-1].x-c[0].x)/2;c[1]=new mxPoint(e,c[1].y);c[2]=new mxPoint(e,c[2].y)}else e=c[0].y+(c[c.length-1].y-c[0].y)/2,c[1]=new mxPoint(c[1].x,e),c[2]=new mxPoint(c[2].x,e);for(e=0;e<c.length-
1;e++)if(null!=this.bends[e+1]){a=c[e];b=c[e+1];var f=new mxPoint(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2),g=this.bends[e+1].bounds;this.bends[e+1].bounds=new mxRectangle(Math.round(f.x-g.width/2),Math.round(f.y-g.height/2),g.width,g.height);this.bends[e+1].redraw();this.manageLabelHandle&&this.checkLabelHandle(this.bends[e+1].bounds)}d&&(mxUtils.setOpacity(this.bends[1].node,this.virtualBendOpacity),mxUtils.setOpacity(this.bends[3].node,this.virtualBendOpacity))}}};
function mxKeyHandler(a,b){null!=a&&(this.graph=a,this.target=b||document.documentElement,this.normalKeys=[],this.shiftKeys=[],this.controlKeys=[],this.controlShiftKeys=[],this.keydownHandler=mxUtils.bind(this,function(a){this.keyDown(a)}),mxEvent.addListener(this.target,"keydown",this.keydownHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}mxKeyHandler.prototype.graph=null;mxKeyHandler.prototype.target=null;
mxKeyHandler.prototype.normalKeys=null;mxKeyHandler.prototype.shiftKeys=null;mxKeyHandler.prototype.controlKeys=null;mxKeyHandler.prototype.controlShiftKeys=null;mxKeyHandler.prototype.enabled=!0;mxKeyHandler.prototype.isEnabled=function(){return this.enabled};mxKeyHandler.prototype.setEnabled=function(a){this.enabled=a};mxKeyHandler.prototype.bindKey=function(a,b){this.normalKeys[a]=b};mxKeyHandler.prototype.bindShiftKey=function(a,b){this.shiftKeys[a]=b};
mxKeyHandler.prototype.bindControlKey=function(a,b){this.controlKeys[a]=b};mxKeyHandler.prototype.bindControlShiftKey=function(a,b){this.controlShiftKeys[a]=b};mxKeyHandler.prototype.isControlDown=function(a){return mxEvent.isControlDown(a)};mxKeyHandler.prototype.getFunction=function(a){return null!=a?this.isControlDown(a)?mxEvent.isShiftDown(a)?this.controlShiftKeys[a.keyCode]:this.controlKeys[a.keyCode]:mxEvent.isShiftDown(a)?this.shiftKeys[a.keyCode]:this.normalKeys[a.keyCode]:null};
mxKeyHandler.prototype.isGraphEvent=function(a){var b=mxEvent.getSource(a);return b==this.target||b.parentNode==this.target||null!=this.graph.cellEditor&&this.graph.cellEditor.isEventSource(a)?!0:mxUtils.isAncestorNode(this.graph.container,b)};mxKeyHandler.prototype.keyDown=function(a){if(this.graph.isEnabled()&&!mxEvent.isConsumed(a)&&this.isGraphEvent(a)&&this.isEnabled())if(27==a.keyCode)this.escape(a);else if(!this.isEventIgnored(a)){var b=this.getFunction(a);null!=b&&(b(a),mxEvent.consume(a))}};
mxKeyHandler.prototype.isEventIgnored=function(a){return this.graph.isEditing()};mxKeyHandler.prototype.escape=function(a){this.graph.isEscapeEnabled()&&this.graph.escape(a)};mxKeyHandler.prototype.destroy=function(){null!=this.target&&null!=this.keydownHandler&&(mxEvent.removeListener(this.target,"keydown",this.keydownHandler),this.keydownHandler=null);this.target=null};function mxTooltipHandler(a,b){null!=a&&(this.graph=a,this.delay=b||500,this.graph.addMouseListener(this))}
mxTooltipHandler.prototype.zIndex=10005;mxTooltipHandler.prototype.graph=null;mxTooltipHandler.prototype.delay=null;mxTooltipHandler.prototype.ignoreTouchEvents=!0;mxTooltipHandler.prototype.hideOnHover=!1;mxTooltipHandler.prototype.destroyed=!1;mxTooltipHandler.prototype.enabled=!0;mxTooltipHandler.prototype.isEnabled=function(){return this.enabled};mxTooltipHandler.prototype.setEnabled=function(a){this.enabled=a};mxTooltipHandler.prototype.isHideOnHover=function(){return this.hideOnHover};
mxTooltipHandler.prototype.setHideOnHover=function(a){this.hideOnHover=a};mxTooltipHandler.prototype.init=function(){null!=document.body&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(a){this.hideTooltip()})))};mxTooltipHandler.prototype.mouseDown=function(a,b){this.reset(b,!1);this.hideTooltip()};
mxTooltipHandler.prototype.mouseMove=function(a,b){if(b.getX()!=this.lastX||b.getY()!=this.lastY)this.reset(b,!0),(this.isHideOnHover()||b.getState()!=this.state||b.getSource()!=this.node&&(!this.stateSource||null!=b.getState()&&this.stateSource==(b.isSource(b.getState().shape)||!b.isSource(b.getState().text))))&&this.hideTooltip();this.lastX=b.getX();this.lastY=b.getY()};mxTooltipHandler.prototype.mouseUp=function(a,b){this.reset(b,!0);this.hideTooltip()};
mxTooltipHandler.prototype.resetTimer=function(){null!=this.thread&&(window.clearTimeout(this.thread),this.thread=null)};
mxTooltipHandler.prototype.reset=function(a,b){if(!this.ignoreTouchEvents||mxEvent.isMouseEvent(a.getEvent()))if(this.resetTimer(),b&&this.isEnabled()&&null!=a.getState()&&(null==this.div||"hidden"==this.div.style.visibility)){var c=a.getState(),d=a.getSource(),e=a.getX(),f=a.getY(),g=a.isSource(c.shape)||a.isSource(c.text);this.thread=window.setTimeout(mxUtils.bind(this,function(){if(!this.graph.isEditing()&&!this.graph.popupMenuHandler.isMenuShowing()&&!this.graph.isMouseDown){var a=this.graph.getTooltip(c,
d,e,f);this.show(a,e,f);this.state=c;this.node=d;this.stateSource=g}}),this.delay)}};mxTooltipHandler.prototype.hide=function(){this.resetTimer();this.hideTooltip()};mxTooltipHandler.prototype.hideTooltip=function(){null!=this.div&&(this.div.style.visibility="hidden")};
mxTooltipHandler.prototype.show=function(a,b,c){if(!this.destroyed&&null!=a&&0<a.length){null==this.div&&this.init();var d=mxUtils.getScrollOrigin();this.div.style.zIndex=this.zIndex;this.div.style.left=b+d.x+"px";this.div.style.top=c+mxConstants.TOOLTIP_VERTICAL_OFFSET+d.y+"px";mxUtils.isNode(a)?(this.div.innerHTML="",this.div.appendChild(a)):this.div.innerHTML=a.replace(/\n/g,"<br>");this.div.style.visibility="";mxUtils.fit(this.div)}};
mxTooltipHandler.prototype.destroy=function(){this.destroyed||(this.graph.removeMouseListener(this),mxEvent.release(this.div),null!=this.div&&null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.destroyed=!0,this.div=null)};function mxCellTracker(a,b,c){mxCellMarker.call(this,a,b);this.graph.addMouseListener(this);null!=c&&(this.getCell=c);mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}mxUtils.extend(mxCellTracker,mxCellMarker);
mxCellTracker.prototype.mouseDown=function(a,b){};mxCellTracker.prototype.mouseMove=function(a,b){this.isEnabled()&&this.process(b)};mxCellTracker.prototype.mouseUp=function(a,b){this.reset()};mxCellTracker.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),mxCellMarker.prototype.destroy.apply(this))};
function mxCellHighlight(a,b,c,d){null!=a&&(this.graph=a,this.highlightColor=null!=b?b:mxConstants.DEFAULT_VALID_COLOR,this.strokeWidth=null!=c?c:mxConstants.HIGHLIGHT_STROKEWIDTH,this.dashed=null!=d?d:!1,this.repaintHandler=mxUtils.bind(this,function(){if(null!=this.state){var a=this.graph.view.getState(this.state.cell);null==a?this.hide():(this.state=a,this.repaint())}}),this.graph.getView().addListener(mxEvent.SCALE,this.repaintHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.repaintHandler),
this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getModel().addListener(mxEvent.CHANGE,this.repaintHandler),this.resetHandler=mxUtils.bind(this,function(){this.hide()}),this.graph.getView().addListener(mxEvent.DOWN,this.resetHandler),this.graph.getView().addListener(mxEvent.UP,this.resetHandler))}mxCellHighlight.prototype.keepOnTop=!1;mxCellHighlight.prototype.graph=!0;mxCellHighlight.prototype.state=null;mxCellHighlight.prototype.spacing=2;
mxCellHighlight.prototype.resetHandler=null;mxCellHighlight.prototype.setHighlightColor=function(a){this.highlightColor=a;null!=this.shape&&(this.shape.stroke=a)};mxCellHighlight.prototype.drawHighlight=function(){this.shape=this.createShape();this.repaint();!this.keepOnTop&&this.shape.node.parentNode.firstChild!=this.shape.node&&this.shape.node.parentNode.insertBefore(this.shape.node,this.shape.node.parentNode.firstChild)};
mxCellHighlight.prototype.createShape=function(){var a=this.graph.cellRenderer.createShape(this.state);a.scale=this.state.view.scale;a.outline=!0;a.points=this.state.absolutePoints;a.apply(this.state);a.strokewidth=this.strokeWidth/this.state.view.scale/this.state.view.scale;a.arrowStrokewidth=this.strokeWidth;a.stroke=this.highlightColor;a.isDashed=this.dashed;a.isShadow=!1;a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;a.init(this.graph.getView().getOverlayPane());
mxEvent.redirectMouseEvents(a.node,this.graph,this.state);this.graph.dialect!=mxConstants.DIALECT_SVG?a.pointerEvents=!1:a.svgPointerEvents="stroke";return a};
mxCellHighlight.prototype.repaint=function(){null!=this.state&&null!=this.shape&&(this.graph.model.isEdge(this.state.cell)?this.shape.points=this.state.absolutePoints:(this.shape.bounds=new mxRectangle(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")),null!=this.state.shape&&this.shape.setCursor(this.state.shape.getCursor()),this.shape.redraw())};
mxCellHighlight.prototype.hide=function(){this.highlight(null)};mxCellHighlight.prototype.highlight=function(a){this.state!=a&&(null!=this.shape&&(this.shape.destroy(),this.shape=null),this.state=a,null!=this.state&&this.drawHighlight())};
mxCellHighlight.prototype.destroy=function(){this.graph.getView().removeListener(this.resetHandler);this.graph.getView().removeListener(this.repaintHandler);this.graph.getModel().removeListener(this.repaintHandler);null!=this.shape&&(this.shape.destroy(),this.shape=null)};
function mxDefaultKeyHandler(a){if(null!=a){this.editor=a;this.handler=new mxKeyHandler(a.graph);var b=this.handler.escape;this.handler.escape=function(c){b.apply(this,arguments);a.hideProperties();a.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",c))}}}mxDefaultKeyHandler.prototype.editor=null;mxDefaultKeyHandler.prototype.handler=null;
mxDefaultKeyHandler.prototype.bindAction=function(a,b,c){var d=mxUtils.bind(this,function(){this.editor.execute(b)});c?this.handler.bindControlKey(a,d):this.handler.bindKey(a,d)};mxDefaultKeyHandler.prototype.destroy=function(){this.handler.destroy();this.handler=null};function mxDefaultPopupMenu(a){this.config=a}mxDefaultPopupMenu.prototype.imageBasePath=null;mxDefaultPopupMenu.prototype.config=null;
mxDefaultPopupMenu.prototype.createMenu=function(a,b,c,d){if(null!=this.config){var e=this.createConditions(a,c,d);this.addItems(a,b,c,d,e,this.config.firstChild,null)}};
mxDefaultPopupMenu.prototype.addItems=function(a,b,c,d,e,f,g){for(var k=!1;null!=f;){if("add"==f.nodeName){var l=f.getAttribute("if");if(null==l||e[l]){var l=f.getAttribute("as"),l=mxResources.get(l)||l,m=mxUtils.eval(mxUtils.getTextContent(f)),n=f.getAttribute("action"),p=f.getAttribute("icon"),q=f.getAttribute("iconCls"),u=f.getAttribute("enabled-if"),u=null==u||e[u];k&&(b.addSeparator(g),k=!1);null!=p&&this.imageBasePath&&(p=this.imageBasePath+p);l=this.addAction(b,a,l,p,m,n,c,g,q,u);this.addItems(a,
b,c,d,e,f.firstChild,l)}}else"separator"==f.nodeName&&(k=!0);f=f.nextSibling}};mxDefaultPopupMenu.prototype.addAction=function(a,b,c,d,e,f,g,k,l,m){return a.addItem(c,d,function(a){"function"==typeof e&&e.call(b,b,g,a);null!=f&&b.execute(f,g,a)},k,l,m)};
mxDefaultPopupMenu.prototype.createConditions=function(a,b,c){var d=a.graph.getModel(),e=d.getChildCount(b),f=[];f.nocell=null==b;f.ncells=1<a.graph.getSelectionCount();f.notRoot=d.getRoot()!=d.getParent(a.graph.getDefaultParent());f.cell=null!=b;d=null!=b&&1==a.graph.getSelectionCount();f.nonEmpty=d&&0<e;f.expandable=d&&a.graph.isCellFoldable(b,!1);f.collapsable=d&&a.graph.isCellFoldable(b,!0);f.validRoot=d&&a.graph.isValidRoot(b);f.emptyValidRoot=f.validRoot&&0==e;f.swimlane=d&&a.graph.isSwimlane(b);
e=this.config.getElementsByTagName("condition");for(d=0;d<e.length;d++){var g=mxUtils.eval(mxUtils.getTextContent(e[d])),k=e[d].getAttribute("name");null!=k&&"function"==typeof g&&(f[k]=g(a,b,c))}return f};function mxDefaultToolbar(a,b){this.editor=b;null!=a&&null!=b&&this.init(a)}mxDefaultToolbar.prototype.editor=null;mxDefaultToolbar.prototype.toolbar=null;mxDefaultToolbar.prototype.resetHandler=null;mxDefaultToolbar.prototype.spacing=4;mxDefaultToolbar.prototype.connectOnDrop=!1;
mxDefaultToolbar.prototype.init=function(a){null!=a&&(this.toolbar=new mxToolbar(a),this.toolbar.addListener(mxEvent.SELECT,mxUtils.bind(this,function(a,c){var d=c.getProperty("function");this.editor.insertFunction=null!=d?mxUtils.bind(this,function(){d.apply(this,arguments);this.toolbar.resetMode()}):null})),this.resetHandler=mxUtils.bind(this,function(){null!=this.toolbar&&this.toolbar.resetMode(!0)}),this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(mxEvent.ESCAPE,
this.resetHandler))};mxDefaultToolbar.prototype.addItem=function(a,b,c,d){var e=mxUtils.bind(this,function(){null!=c&&0<c.length&&this.editor.execute(c)});return this.toolbar.addItem(a,b,e,d)};mxDefaultToolbar.prototype.addSeparator=function(a){a=a||mxClient.imageBasePath+"/separator.gif";this.toolbar.addSeparator(a)};mxDefaultToolbar.prototype.addCombo=function(){return this.toolbar.addCombo()};mxDefaultToolbar.prototype.addActionCombo=function(a){return this.toolbar.addActionCombo(a)};
mxDefaultToolbar.prototype.addActionOption=function(a,b,c){var d=mxUtils.bind(this,function(){this.editor.execute(c)});this.addOption(a,b,d)};mxDefaultToolbar.prototype.addOption=function(a,b,c){return this.toolbar.addOption(a,b,c)};mxDefaultToolbar.prototype.addMode=function(a,b,c,d,e){var f=mxUtils.bind(this,function(){this.editor.setMode(c);null!=e&&e(this.editor)});return this.toolbar.addSwitchMode(a,b,f,d)};
mxDefaultToolbar.prototype.addPrototype=function(a,b,c,d,e,f){var g=mxUtils.bind(this,function(){return"function"==typeof c?c():null!=c?this.editor.graph.cloneCells([c])[0]:null}),k=mxUtils.bind(this,function(a,b){"function"==typeof e?e(this.editor,g(),a,b):this.drop(g(),a,b);this.toolbar.resetMode();mxEvent.consume(a)});a=this.toolbar.addMode(a,b,k,d,null,f);this.installDropHandler(a,function(a,b,c){k(b,c)});return a};
mxDefaultToolbar.prototype.drop=function(a,b,c){var d=this.editor.graph,e=d.getModel();if(null!=c&&!e.isEdge(c)&&this.connectOnDrop&&d.isCellConnectable(c))this.connect(a,b,c);else{for(;null!=c&&!d.isValidDropTarget(c,[a],b);)c=e.getParent(c);this.insert(a,b,c)}};
mxDefaultToolbar.prototype.insert=function(a,b,c){var d=this.editor.graph;if(d.canImportCell(a)){var e=mxEvent.getClientX(b),f=mxEvent.getClientY(b),e=mxUtils.convertPoint(d.container,e,f);return d.isSplitEnabled()&&d.isSplitTarget(c,[a],b)?d.splitEdge(c,[a],null,e.x,e.y):this.editor.addVertex(c,a,e.x,e.y)}return null};
mxDefaultToolbar.prototype.connect=function(a,b,c){b=this.editor.graph;var d=b.getModel();if(null!=c&&b.isCellConnectable(a)&&b.isEdgeValid(null,c,a)){var e=null;d.beginUpdate();try{var f=d.getGeometry(c),g=d.getGeometry(a).clone();g.x=f.x+(f.width-g.width)/2;g.y=f.y+(f.height-g.height)/2;var k=this.spacing*b.gridSize,l=20*d.getDirectedEdgeCount(c,!0);this.editor.horizontalFlow?g.x+=(g.width+f.width)/2+k+l:g.y+=(g.height+f.height)/2+k+l;a.setGeometry(g);var m=d.getParent(c);b.addCell(a,m);b.constrainChild(a);
e=this.editor.createEdge(c,a);if(null==d.getGeometry(e)){var n=new mxGeometry;n.relative=!0;d.setGeometry(e,n)}b.addEdge(e,m,c,a)}finally{d.endUpdate()}b.setSelectionCells([a,e]);b.scrollCellToVisible(a)}};
mxDefaultToolbar.prototype.installDropHandler=function(a,b){var c=document.createElement("img");c.setAttribute("src",a.getAttribute("src"));var d=mxUtils.bind(this,function(e){c.style.width=2*a.offsetWidth+"px";c.style.height=2*a.offsetHeight+"px";mxUtils.makeDraggable(a,this.editor.graph,b,c);mxEvent.removeListener(c,"load",d)});mxClient.IS_IE?d():mxEvent.addListener(c,"load",d)};
mxDefaultToolbar.prototype.destroy=function(){null!=this.resetHandler&&(this.editor.graph.removeListener("dblclick",this.resetHandler),this.editor.removeListener("escape",this.resetHandler),this.resetHandler=null);null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null)};
function mxEditor(a){this.actions=[];this.addActions();if(null!=document.body){this.cycleAttributeValues=[];this.popupHandler=new mxDefaultPopupMenu;this.undoManager=new mxUndoManager;this.graph=this.createGraph();this.toolbar=this.createToolbar();this.keyHandler=new mxDefaultKeyHandler(this);this.configure(a);this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName;if(null!=this.onInit)this.onInit();mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}}
mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/editor");mxEditor.prototype=new mxEventSource;mxEditor.prototype.constructor=mxEditor;mxEditor.prototype.askZoomResource="none"!=mxClient.language?"askZoom":"";mxEditor.prototype.lastSavedResource="none"!=mxClient.language?"lastSaved":"";mxEditor.prototype.currentFileResource="none"!=mxClient.language?"currentFile":"";mxEditor.prototype.propertiesResource="none"!=mxClient.language?"properties":"";
mxEditor.prototype.tasksResource="none"!=mxClient.language?"tasks":"";mxEditor.prototype.helpResource="none"!=mxClient.language?"help":"";mxEditor.prototype.outlineResource="none"!=mxClient.language?"outline":"";mxEditor.prototype.outline=null;mxEditor.prototype.graph=null;mxEditor.prototype.graphRenderHint=null;mxEditor.prototype.toolbar=null;mxEditor.prototype.status=null;mxEditor.prototype.popupHandler=null;mxEditor.prototype.undoManager=null;mxEditor.prototype.keyHandler=null;
mxEditor.prototype.actions=null;mxEditor.prototype.dblClickAction="edit";mxEditor.prototype.swimlaneRequired=!1;mxEditor.prototype.disableContextMenu=!0;mxEditor.prototype.insertFunction=null;mxEditor.prototype.forcedInserting=!1;mxEditor.prototype.templates=null;mxEditor.prototype.defaultEdge=null;mxEditor.prototype.defaultEdgeStyle=null;mxEditor.prototype.defaultGroup=null;mxEditor.prototype.groupBorderSize=null;mxEditor.prototype.filename=null;mxEditor.prototype.linefeed="&#xa;";
mxEditor.prototype.postParameterName="xml";mxEditor.prototype.escapePostData=!0;mxEditor.prototype.urlPost=null;mxEditor.prototype.urlImage=null;mxEditor.prototype.horizontalFlow=!1;mxEditor.prototype.layoutDiagram=!1;mxEditor.prototype.swimlaneSpacing=0;mxEditor.prototype.maintainSwimlanes=!1;mxEditor.prototype.layoutSwimlanes=!1;mxEditor.prototype.cycleAttributeValues=null;mxEditor.prototype.cycleAttributeIndex=0;mxEditor.prototype.cycleAttributeName="fillColor";mxEditor.prototype.tasks=null;
mxEditor.prototype.tasksWindowImage=null;mxEditor.prototype.tasksTop=20;mxEditor.prototype.help=null;mxEditor.prototype.helpWindowImage=null;mxEditor.prototype.urlHelp=null;mxEditor.prototype.helpWidth=300;mxEditor.prototype.helpHeight=260;mxEditor.prototype.propertiesWidth=240;mxEditor.prototype.propertiesHeight=null;mxEditor.prototype.movePropertiesDialog=!1;mxEditor.prototype.validating=!1;mxEditor.prototype.modified=!1;mxEditor.prototype.isModified=function(){return this.modified};
mxEditor.prototype.setModified=function(a){this.modified=a};
mxEditor.prototype.addActions=function(){this.addAction("save",function(a){a.save()});this.addAction("print",function(a){(new mxPrintPreview(a.graph,1)).open()});this.addAction("show",function(a){mxUtils.show(a.graph,null,10,10)});this.addAction("exportImage",function(a){var b=a.getUrlImage();if(null==b||mxClient.IS_LOCAL)a.execute("show");else{var c=mxUtils.getViewXml(a.graph,1),c=mxUtils.getXml(c,"\n");mxUtils.submit(b,a.postParameterName+"="+encodeURIComponent(c),document,"_blank")}});this.addAction("refresh",
function(a){a.graph.refresh()});this.addAction("cut",function(a){a.graph.isEnabled()&&mxClipboard.cut(a.graph)});this.addAction("copy",function(a){a.graph.isEnabled()&&mxClipboard.copy(a.graph)});this.addAction("paste",function(a){a.graph.isEnabled()&&mxClipboard.paste(a.graph)});this.addAction("delete",function(a){a.graph.isEnabled()&&a.graph.removeCells()});this.addAction("group",function(a){a.graph.isEnabled()&&a.graph.setSelectionCell(a.groupCells())});this.addAction("ungroup",function(a){a.graph.isEnabled()&&
a.graph.setSelectionCells(a.graph.ungroupCells())});this.addAction("removeFromParent",function(a){a.graph.isEnabled()&&a.graph.removeCellsFromParent()});this.addAction("undo",function(a){a.graph.isEnabled()&&a.undo()});this.addAction("redo",function(a){a.graph.isEnabled()&&a.redo()});this.addAction("zoomIn",function(a){a.graph.zoomIn()});this.addAction("zoomOut",function(a){a.graph.zoomOut()});this.addAction("actualSize",function(a){a.graph.zoomActual()});this.addAction("fit",function(a){a.graph.fit()});
this.addAction("showProperties",function(a,b){a.showProperties(b)});this.addAction("selectAll",function(a){a.graph.isEnabled()&&a.graph.selectAll()});this.addAction("selectNone",function(a){a.graph.isEnabled()&&a.graph.clearSelection()});this.addAction("selectVertices",function(a){a.graph.isEnabled()&&a.graph.selectVertices()});this.addAction("selectEdges",function(a){a.graph.isEnabled()&&a.graph.selectEdges()});this.addAction("edit",function(a,b){a.graph.isEnabled()&&a.graph.isCellEditable(b)&&a.graph.startEditingAtCell(b)});
this.addAction("toBack",function(a,b){a.graph.isEnabled()&&a.graph.orderCells(!0)});this.addAction("toFront",function(a,b){a.graph.isEnabled()&&a.graph.orderCells(!1)});this.addAction("enterGroup",function(a,b){a.graph.enterGroup(b)});this.addAction("exitGroup",function(a){a.graph.exitGroup()});this.addAction("home",function(a){a.graph.home()});this.addAction("selectPrevious",function(a){a.graph.isEnabled()&&a.graph.selectPreviousCell()});this.addAction("selectNext",function(a){a.graph.isEnabled()&&
a.graph.selectNextCell()});this.addAction("selectParent",function(a){a.graph.isEnabled()&&a.graph.selectParentCell()});this.addAction("selectChild",function(a){a.graph.isEnabled()&&a.graph.selectChildCell()});this.addAction("collapse",function(a){a.graph.isEnabled()&&a.graph.foldCells(!0)});this.addAction("collapseAll",function(a){if(a.graph.isEnabled()){var b=a.graph.getChildVertices();a.graph.foldCells(!0,!1,b)}});this.addAction("expand",function(a){a.graph.isEnabled()&&a.graph.foldCells(!1)});
this.addAction("expandAll",function(a){if(a.graph.isEnabled()){var b=a.graph.getChildVertices();a.graph.foldCells(!1,!1,b)}});this.addAction("bold",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD)});this.addAction("italic",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC)});this.addAction("underline",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,
mxConstants.FONT_UNDERLINE)});this.addAction("alignCellsLeft",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_LEFT)});this.addAction("alignCellsCenter",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_CENTER)});this.addAction("alignCellsRight",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_RIGHT)});this.addAction("alignCellsTop",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_TOP)});this.addAction("alignCellsMiddle",
function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_MIDDLE)});this.addAction("alignCellsBottom",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_BOTTOM)});this.addAction("alignFontLeft",function(a){a.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT)});this.addAction("alignFontCenter",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER)});this.addAction("alignFontRight",function(a){a.graph.isEnabled()&&
a.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT)});this.addAction("alignFontTop",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_TOP)});this.addAction("alignFontMiddle",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)});this.addAction("alignFontBottom",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_BOTTOM)});
this.addAction("zoom",function(a){var b=100*a.graph.getView().scale,b=parseFloat(mxUtils.prompt(mxResources.get(a.askZoomResource)||a.askZoomResource,b))/100;isNaN(b)||a.graph.getView().setScale(b)});this.addAction("toggleTasks",function(a){null!=a.tasks?a.tasks.setVisible(!a.tasks.isVisible()):a.showTasks()});this.addAction("toggleHelp",function(a){null!=a.help?a.help.setVisible(!a.help.isVisible()):a.showHelp()});this.addAction("toggleOutline",function(a){null==a.outline?a.showOutline():a.outline.setVisible(!a.outline.isVisible())});
this.addAction("toggleConsole",function(a){mxLog.setVisible(!mxLog.isVisible())})};mxEditor.prototype.configure=function(a){null!=a&&((new mxCodec(a.ownerDocument)).decode(a,this),this.resetHistory())};mxEditor.prototype.resetFirstTime=function(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"};mxEditor.prototype.resetHistory=function(){this.lastSnapshot=(new Date).getTime();this.undoManager.clear();this.ignoredChanges=0;this.setModified(!1)};
mxEditor.prototype.addAction=function(a,b){this.actions[a]=b};mxEditor.prototype.execute=function(a,b,c){var d=this.actions[a];if(null!=d)try{var e=arguments;e[0]=this;d.apply(this,e)}catch(f){throw mxUtils.error("Cannot execute "+a+": "+f.message,280,!0),f;}else mxUtils.error("Cannot find action "+a,280,!0)};mxEditor.prototype.addTemplate=function(a,b){this.templates[a]=b};mxEditor.prototype.getTemplate=function(a){return this.templates[a]};
mxEditor.prototype.createGraph=function(){var a=new mxGraph(null,null,this.graphRenderHint);a.setTooltips(!0);a.setPanning(!0);this.installDblClickHandler(a);this.installUndoHandler(a);this.installDrillHandler(a);this.installChangeHandler(a);this.installInsertHandler(a);a.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(a,c,d){return this.createPopupMenu(a,c,d)});a.connectionHandler.factoryMethod=mxUtils.bind(this,function(a,c){return this.createEdge(a,c)});this.createSwimlaneManager(a);
this.createLayoutManager(a);return a};mxEditor.prototype.createSwimlaneManager=function(a){a=new mxSwimlaneManager(a,!1);a.isHorizontal=mxUtils.bind(this,function(){return this.horizontalFlow});a.isEnabled=mxUtils.bind(this,function(){return this.maintainSwimlanes});return a};
mxEditor.prototype.createLayoutManager=function(a){var b=new mxLayoutManager(a),c=this;b.getLayout=function(b){var e=null,f=c.graph.getModel();null!=f.getParent(b)&&(c.layoutSwimlanes&&a.isSwimlane(b)?(null==c.swimlaneLayout&&(c.swimlaneLayout=c.createSwimlaneLayout()),e=c.swimlaneLayout):c.layoutDiagram&&(a.isValidRoot(b)||null==f.getParent(f.getParent(b)))&&(null==c.diagramLayout&&(c.diagramLayout=c.createDiagramLayout()),e=c.diagramLayout));return e};return b};
mxEditor.prototype.setGraphContainer=function(a){null==this.graph.container&&(this.graph.init(a),this.rubberband=new mxRubberband(this.graph),this.disableContextMenu&&mxEvent.disableContextMenu(a),mxClient.IS_QUIRKS&&new mxDivResizer(a))};mxEditor.prototype.installDblClickHandler=function(a){a.addListener(mxEvent.DOUBLE_CLICK,mxUtils.bind(this,function(b,c){var d=c.getProperty("cell");null!=d&&a.isEnabled()&&null!=this.dblClickAction&&(this.execute(this.dblClickAction,d),c.consume())}))};
mxEditor.prototype.installUndoHandler=function(a){var b=mxUtils.bind(this,function(a,b){var e=b.getProperty("edit");this.undoManager.undoableEditHappened(e)});a.getModel().addListener(mxEvent.UNDO,b);a.getView().addListener(mxEvent.UNDO,b);b=function(b,d){var e=d.getProperty("edit").changes;a.setSelectionCells(a.getSelectionCellsForChanges(e))};this.undoManager.addListener(mxEvent.UNDO,b);this.undoManager.addListener(mxEvent.REDO,b)};
mxEditor.prototype.installDrillHandler=function(a){var b=mxUtils.bind(this,function(a){this.fireEvent(new mxEventObject(mxEvent.ROOT))});a.getView().addListener(mxEvent.DOWN,b);a.getView().addListener(mxEvent.UP,b)};
mxEditor.prototype.installChangeHandler=function(a){var b=mxUtils.bind(this,function(b,d){this.setModified(!0);!0==this.validating&&a.validateGraph();for(var e=d.getProperty("edit").changes,f=0;f<e.length;f++){var g=e[f];if(g instanceof mxRootChange||g instanceof mxValueChange&&g.cell==this.graph.model.root||g instanceof mxCellAttributeChange&&g.cell==this.graph.model.root){this.fireEvent(new mxEventObject(mxEvent.ROOT));break}}});a.getModel().addListener(mxEvent.CHANGE,b)};
mxEditor.prototype.installInsertHandler=function(a){var b=this;a.addMouseListener({mouseDown:function(a,d){null==b.insertFunction||d.isPopupTrigger()||!b.forcedInserting&&null!=d.getState()||(b.graph.clearSelection(),b.insertFunction(d.getEvent(),d.getCell()),this.isActive=!0,d.consume())},mouseMove:function(a,b){this.isActive&&b.consume()},mouseUp:function(a,b){this.isActive&&(this.isActive=!1,b.consume())}})};
mxEditor.prototype.createDiagramLayout=function(){var a=this.graph.gridSize,b=new mxStackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*a,2*a);b.isVertexIgnored=function(a){return!b.graph.isSwimlane(a)};return b};mxEditor.prototype.createSwimlaneLayout=function(){return new mxCompactTreeLayout(this.graph,this.horizontalFlow)};mxEditor.prototype.createToolbar=function(){return new mxDefaultToolbar(null,this)};
mxEditor.prototype.setToolbarContainer=function(a){this.toolbar.init(a);mxClient.IS_QUIRKS&&new mxDivResizer(a)};
mxEditor.prototype.setStatusContainer=function(a){null==this.status&&(this.status=a,this.addListener(mxEvent.SAVE,mxUtils.bind(this,function(){var a=(new Date).toLocaleString();this.setStatus((mxResources.get(this.lastSavedResource)||this.lastSavedResource)+": "+a)})),this.addListener(mxEvent.OPEN,mxUtils.bind(this,function(){this.setStatus((mxResources.get(this.currentFileResource)||this.currentFileResource)+": "+this.filename)})),mxClient.IS_QUIRKS&&new mxDivResizer(a))};
mxEditor.prototype.setStatus=function(a){null!=this.status&&null!=a&&(this.status.innerHTML=a)};mxEditor.prototype.setTitleContainer=function(a){this.addListener(mxEvent.ROOT,mxUtils.bind(this,function(b){a.innerHTML=this.getTitle()}));mxClient.IS_QUIRKS&&new mxDivResizer(a)};mxEditor.prototype.treeLayout=function(a,b){null!=a&&(new mxCompactTreeLayout(this.graph,b)).execute(a)};
mxEditor.prototype.getTitle=function(){for(var a="",b=this.graph,c=b.getCurrentRoot();null!=c&&null!=b.getModel().getParent(b.getModel().getParent(c));)b.isValidRoot(c)&&(a=" > "+b.convertValueToString(c)+a),c=b.getModel().getParent(c);return this.getRootTitle()+a};mxEditor.prototype.getRootTitle=function(){var a=this.graph.getModel().getRoot();return this.graph.convertValueToString(a)};mxEditor.prototype.undo=function(){this.undoManager.undo()};mxEditor.prototype.redo=function(){this.undoManager.redo()};
mxEditor.prototype.groupCells=function(){var a=null!=this.groupBorderSize?this.groupBorderSize:this.graph.gridSize;return this.graph.groupCells(this.createGroup(),a)};mxEditor.prototype.createGroup=function(){return this.graph.getModel().cloneCell(this.defaultGroup)};mxEditor.prototype.open=function(a){if(null!=a){var b=mxUtils.load(a).getXml();this.readGraphModel(b.documentElement);this.filename=a;this.fireEvent(new mxEventObject(mxEvent.OPEN,"filename",a))}};
mxEditor.prototype.readGraphModel=function(a){(new mxCodec(a.ownerDocument)).decode(a,this.graph.getModel());this.resetHistory()};mxEditor.prototype.save=function(a,b){a=a||this.getUrlPost();if(null!=a&&0<a.length){var c=this.writeGraphModel(b);this.postDiagram(a,c);this.setModified(!1)}this.fireEvent(new mxEventObject(mxEvent.SAVE,"url",a))};
mxEditor.prototype.postDiagram=function(a,b){this.escapePostData&&(b=encodeURIComponent(b));mxUtils.post(a,this.postParameterName+"="+b,mxUtils.bind(this,function(c){this.fireEvent(new mxEventObject(mxEvent.POST,"request",c,"url",a,"data",b))}))};mxEditor.prototype.writeGraphModel=function(a){a=null!=a?a:this.linefeed;var b=(new mxCodec).encode(this.graph.getModel());return mxUtils.getXml(b,a)};mxEditor.prototype.getUrlPost=function(){return this.urlPost};mxEditor.prototype.getUrlImage=function(){return this.urlImage};
mxEditor.prototype.swapStyles=function(a,b){var c=this.graph.getStylesheet().styles[b];this.graph.getView().getStylesheet().putCellStyle(b,this.graph.getStylesheet().styles[a]);this.graph.getStylesheet().putCellStyle(a,c);this.graph.refresh()};
mxEditor.prototype.showProperties=function(a){a=a||this.graph.getSelectionCell();null==a&&(a=this.graph.getCurrentRoot(),null==a&&(a=this.graph.getModel().getRoot()));if(null!=a){this.graph.stopEditing(!0);var b=mxUtils.getOffset(this.graph.container),c=b.x+10,b=b.y;if(null==this.properties||this.movePropertiesDialog){var d=this.graph.getCellBounds(a);null!=d&&(c+=d.x+Math.min(200,d.width),b+=d.y)}else c=this.properties.getX(),b=this.properties.getY();this.hideProperties();a=this.createProperties(a);
null!=a&&(this.properties=new mxWindow(mxResources.get(this.propertiesResource)||this.propertiesResource,a,c,b,this.propertiesWidth,this.propertiesHeight,!1),this.properties.setVisible(!0))}};mxEditor.prototype.isPropertiesVisible=function(){return null!=this.properties};
mxEditor.prototype.createProperties=function(a){var b=this.graph.getModel(),c=b.getValue(a);if(mxUtils.isNode(c)){var d=new mxForm("properties");d.addText("ID",a.getId()).setAttribute("readonly","true");var e=null,f=null,g=null,k=null,l=null;b.isVertex(a)&&(e=b.getGeometry(a),null!=e&&(f=d.addText("top",e.y),g=d.addText("left",e.x),k=d.addText("width",e.width),l=d.addText("height",e.height)));for(var m=b.getStyle(a),n=d.addText("Style",m||""),p=c.attributes,q=[],c=0;c<p.length;c++)q[c]=d.addTextarea(p[c].nodeName,
p[c].value,"label"==p[c].nodeName?4:2);c=mxUtils.bind(this,function(){this.hideProperties();b.beginUpdate();try{null!=e&&(e=e.clone(),e.x=parseFloat(g.value),e.y=parseFloat(f.value),e.width=parseFloat(k.value),e.height=parseFloat(l.value),b.setGeometry(a,e));0<n.value.length?b.setStyle(a,n.value):b.setStyle(a,null);for(var c=0;c<p.length;c++){var d=new mxCellAttributeChange(a,p[c].nodeName,q[c].value);b.execute(d)}this.graph.isAutoSizeCell(a)&&this.graph.updateCellSize(a)}finally{b.endUpdate()}});
m=mxUtils.bind(this,function(){this.hideProperties()});d.addButtons(c,m);return d.table}return null};mxEditor.prototype.hideProperties=function(){null!=this.properties&&(this.properties.destroy(),this.properties=null)};
mxEditor.prototype.showTasks=function(){if(null==this.tasks){var a=document.createElement("div");a.style.padding="4px";a.style.paddingLeft="20px";var b=document.body.clientWidth,b=new mxWindow(mxResources.get(this.tasksResource)||this.tasksResource,a,b-220,this.tasksTop,200);b.setClosable(!0);b.destroyOnClose=!1;var c=mxUtils.bind(this,function(b){mxEvent.release(a);a.innerHTML="";this.createTasks(a)});this.graph.getModel().addListener(mxEvent.CHANGE,c);this.graph.getSelectionModel().addListener(mxEvent.CHANGE,
c);this.graph.addListener(mxEvent.ROOT,c);null!=this.tasksWindowImage&&b.setImage(this.tasksWindowImage);this.tasks=b;this.createTasks(a)}this.tasks.setVisible(!0)};mxEditor.prototype.refreshTasks=function(a){null!=this.tasks&&(a=this.tasks.content,mxEvent.release(a),a.innerHTML="",this.createTasks(a))};mxEditor.prototype.createTasks=function(a){};
mxEditor.prototype.showHelp=function(a){if(null==this.help){var b=document.createElement("iframe");b.setAttribute("src",mxResources.get("urlHelp")||this.urlHelp);b.setAttribute("height","100%");b.setAttribute("width","100%");b.setAttribute("frameBorder","0");b.style.backgroundColor="white";a=document.body.clientWidth;var c=document.body.clientHeight||document.documentElement.clientHeight,d=new mxWindow(mxResources.get(this.helpResource)||this.helpResource,b,(a-this.helpWidth)/2,(c-this.helpHeight)/
3,this.helpWidth,this.helpHeight);d.setMaximizable(!0);d.setClosable(!0);d.destroyOnClose=!1;d.setResizable(!0);null!=this.helpWindowImage&&d.setImage(this.helpWindowImage);mxClient.IS_NS&&(a=function(a){b.setAttribute("height",d.div.offsetHeight-26+"px")},d.addListener(mxEvent.RESIZE_END,a),d.addListener(mxEvent.MAXIMIZE,a),d.addListener(mxEvent.NORMALIZE,a),d.addListener(mxEvent.SHOW,a));this.help=d}this.help.setVisible(!0)};
mxEditor.prototype.showOutline=function(){if(null==this.outline){var a=document.createElement("div");a.style.overflow="hidden";a.style.position="relative";a.style.width="100%";a.style.height="100%";a.style.background="white";a.style.cursor="move";8==document.documentMode&&(a.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=100)");var b=new mxWindow(mxResources.get(this.outlineResource)||this.outlineResource,a,600,480,200,200,!1),c=new mxOutline(this.graph,a);b.setClosable(!0);b.setResizable(!0);
b.destroyOnClose=!1;b.addListener(mxEvent.RESIZE_END,function(){c.update()});this.outline=b;this.outline.outline=c}this.outline.setVisible(!0);this.outline.outline.update(!0)};mxEditor.prototype.setMode=function(a){"select"==a?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!1)):"connect"==a?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!0)):"pan"==a&&(this.graph.panningHandler.useLeftButtonForPanning=!0,this.graph.setConnectable(!1))};
mxEditor.prototype.createPopupMenu=function(a,b,c){this.popupHandler.createMenu(this,a,b,c)};mxEditor.prototype.createEdge=function(a,b){var c=null;if(null!=this.defaultEdge)c=this.graph.getModel().cloneCell(this.defaultEdge);else{c=new mxCell("");c.setEdge(!0);var d=new mxGeometry;d.relative=!0;c.setGeometry(d)}d=this.getEdgeStyle();null!=d&&c.setStyle(d);return c};mxEditor.prototype.getEdgeStyle=function(){return this.defaultEdgeStyle};
mxEditor.prototype.consumeCycleAttribute=function(a){return null!=this.cycleAttributeValues&&0<this.cycleAttributeValues.length&&this.graph.isSwimlane(a)?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null};mxEditor.prototype.cycleAttribute=function(a){if(null!=this.cycleAttributeName){var b=this.consumeCycleAttribute(a);null!=b&&a.setStyle(a.getStyle()+";"+this.cycleAttributeName+"="+b)}};
mxEditor.prototype.addVertex=function(a,b,c,d){for(var e=this.graph.getModel();null!=a&&!this.graph.isValidDropTarget(a);)a=e.getParent(a);a=null!=a?a:this.graph.getSwimlaneAt(c,d);var f=this.graph.getView().scale,g=e.getGeometry(b),k=e.getGeometry(a);if(this.graph.isSwimlane(b)&&!this.graph.swimlaneNesting)a=null;else{if(null==a&&this.swimlaneRequired)return null;if(null!=a&&null!=k){var l=this.graph.getView().getState(a);if(null!=l){if(c-=l.origin.x*f,d-=l.origin.y*f,this.graph.isConstrainedMoving){var k=
g.width,m=g.height,n=l.x+l.width;c+k>n&&(c-=c+k-n);n=l.y+l.height;d+m>n&&(d-=d+m-n)}}else null!=k&&(c-=k.x*f,d-=k.y*f)}}g=g.clone();g.x=this.graph.snap(c/f-this.graph.getView().translate.x-this.graph.gridSize/2);g.y=this.graph.snap(d/f-this.graph.getView().translate.y-this.graph.gridSize/2);b.setGeometry(g);null==a&&(a=this.graph.getDefaultParent());this.cycleAttribute(b);this.fireEvent(new mxEventObject(mxEvent.BEFORE_ADD_VERTEX,"vertex",b,"parent",a));e.beginUpdate();try{b=this.graph.addCell(b,
a),null!=b&&(this.graph.constrainChild(b),this.fireEvent(new mxEventObject(mxEvent.ADD_VERTEX,"vertex",b)))}finally{e.endUpdate()}null!=b&&(this.graph.setSelectionCell(b),this.graph.scrollCellToVisible(b),this.fireEvent(new mxEventObject(mxEvent.AFTER_ADD_VERTEX,"vertex",b)));return b};
mxEditor.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tasks&&this.tasks.destroy(),null!=this.outline&&this.outline.destroy(),null!=this.properties&&this.properties.destroy(),null!=this.keyHandler&&this.keyHandler.destroy(),null!=this.rubberband&&this.rubberband.destroy(),null!=this.toolbar&&this.toolbar.destroy(),null!=this.graph&&this.graph.destroy(),this.templates=this.status=null)};
var mxCodecRegistry={codecs:[],aliases:[],register:function(a){if(null!=a){var b=a.getName();mxCodecRegistry.codecs[b]=a;var c=mxUtils.getFunctionName(a.template.constructor);c!=b&&mxCodecRegistry.addAlias(c,b)}return a},addAlias:function(a,b){mxCodecRegistry.aliases[a]=b},getCodec:function(a){var b=null;if(null!=a){var b=mxUtils.getFunctionName(a),c=mxCodecRegistry.aliases[b];null!=c&&(b=c);b=mxCodecRegistry.codecs[b];if(null==b)try{b=new mxObjectCodec(new a),mxCodecRegistry.register(b)}catch(d){}}return b}};
function mxCodec(a){this.document=a||mxUtils.createXmlDocument();this.objects=[]}mxCodec.prototype.document=null;mxCodec.prototype.objects=null;mxCodec.prototype.elements=null;mxCodec.prototype.encodeDefaults=!1;mxCodec.prototype.putObject=function(a,b){return this.objects[a]=b};mxCodec.prototype.getObject=function(a){var b=null;null!=a&&(b=this.objects[a],null==b&&(b=this.lookup(a),null==b&&(a=this.getElementById(a),null!=a&&(b=this.decode(a)))));return b};mxCodec.prototype.lookup=function(a){return null};
mxCodec.prototype.getElementById=function(a){null==this.elements&&(this.elements={},this.addElement(this.document.documentElement));return this.elements[a]};mxCodec.prototype.addElement=function(a){if(a.nodeType==mxConstants.NODETYPE_ELEMENT){var b=a.getAttribute("id");null!=b&&null==this.elements[b]&&(this.elements[b]=a)}for(a=a.firstChild;null!=a;)this.addElement(a),a=a.nextSibling};
mxCodec.prototype.getId=function(a){var b=null;null!=a&&(b=this.reference(a),null==b&&a instanceof mxCell&&(b=a.getId(),null==b&&(b=mxCellPath.create(a),0==b.length&&(b="root"))));return b};mxCodec.prototype.reference=function(a){return null};mxCodec.prototype.encode=function(a){var b=null;if(null!=a&&null!=a.constructor){var c=mxCodecRegistry.getCodec(a.constructor);null!=c?b=c.encode(this,a):mxUtils.isNode(a)?b=mxUtils.importNode(this.document,a,!0):mxLog.warn("mxCodec.encode: No codec for "+mxUtils.getFunctionName(a.constructor))}return b};
mxCodec.prototype.decode=function(a,b){var c=null;if(null!=a&&a.nodeType==mxConstants.NODETYPE_ELEMENT){c=null;try{c=window[a.nodeName]}catch(d){}c=mxCodecRegistry.getCodec(c);null!=c?c=c.decode(this,a,b):(c=a.cloneNode(!0),c.removeAttribute("as"))}return c};mxCodec.prototype.encodeCell=function(a,b,c){b.appendChild(this.encode(a));if(null==c||c){c=a.getChildCount();for(var d=0;d<c;d++)this.encodeCell(a.getChildAt(d),b)}};
mxCodec.prototype.isCellCodec=function(a){return null!=a&&"function"==typeof a.isCellCodec?a.isCellCodec():!1};mxCodec.prototype.decodeCell=function(a,b){b=null!=b?b:!0;var c=null;if(null!=a&&a.nodeType==mxConstants.NODETYPE_ELEMENT){c=mxCodecRegistry.getCodec(a.nodeName);if(!this.isCellCodec(c))for(var d=a.firstChild;null!=d&&!this.isCellCodec(c);)c=mxCodecRegistry.getCodec(d.nodeName),d=d.nextSibling;this.isCellCodec(c)||(c=mxCodecRegistry.getCodec(mxCell));c=c.decode(this,a);b&&this.insertIntoGraph(c)}return c};
mxCodec.prototype.insertIntoGraph=function(a){var b=a.parent,c=a.getTerminal(!0),d=a.getTerminal(!1);a.setTerminal(null,!1);a.setTerminal(null,!0);a.parent=null;null!=b&&b.insert(a);null!=c&&c.insertEdge(a,!0);null!=d&&d.insertEdge(a,!1)};mxCodec.prototype.setAttribute=function(a,b,c){null!=b&&null!=c&&a.setAttribute(b,c)};
function mxObjectCodec(a,b,c,d){this.template=a;this.exclude=null!=b?b:[];this.idrefs=null!=c?c:[];this.mapping=null!=d?d:[];this.reverse={};for(var e in this.mapping)this.reverse[this.mapping[e]]=e}mxObjectCodec.allowEval=!1;mxObjectCodec.prototype.template=null;mxObjectCodec.prototype.exclude=null;mxObjectCodec.prototype.idrefs=null;mxObjectCodec.prototype.mapping=null;mxObjectCodec.prototype.reverse=null;mxObjectCodec.prototype.getName=function(){return mxUtils.getFunctionName(this.template.constructor)};
mxObjectCodec.prototype.cloneTemplate=function(){return new this.template.constructor};mxObjectCodec.prototype.getFieldName=function(a){if(null!=a){var b=this.reverse[a];null!=b&&(a=b)}return a};mxObjectCodec.prototype.getAttributeName=function(a){if(null!=a){var b=this.mapping[a];null!=b&&(a=b)}return a};mxObjectCodec.prototype.isExcluded=function(a,b,c,d){return b==mxObjectIdentity.FIELD_NAME||0<=mxUtils.indexOf(this.exclude,b)};
mxObjectCodec.prototype.isReference=function(a,b,c,d){return 0<=mxUtils.indexOf(this.idrefs,b)};mxObjectCodec.prototype.encode=function(a,b){var c=a.document.createElement(this.getName());b=this.beforeEncode(a,b,c);this.encodeObject(a,b,c);return this.afterEncode(a,b,c)};mxObjectCodec.prototype.encodeObject=function(a,b,c){a.setAttribute(c,"id",a.getId(b));for(var d in b){var e=d,f=b[e];null!=f&&!this.isExcluded(b,e,f,!0)&&(mxUtils.isInteger(e)&&(e=null),this.encodeValue(a,b,e,f,c))}};
mxObjectCodec.prototype.encodeValue=function(a,b,c,d,e){if(null!=d){if(this.isReference(b,c,d,!0)){var f=a.getId(d);if(null==f){mxLog.warn("mxObjectCodec.encode: No ID for "+this.getName()+"."+c+"="+d);return}d=f}f=this.template[c];if(null==c||a.encodeDefaults||f!=d)c=this.getAttributeName(c),this.writeAttribute(a,b,c,d,e)}};mxObjectCodec.prototype.writeAttribute=function(a,b,c,d,e){"object"!=typeof d?this.writePrimitiveAttribute(a,b,c,d,e):this.writeComplexAttribute(a,b,c,d,e)};
mxObjectCodec.prototype.writePrimitiveAttribute=function(a,b,c,d,e){d=this.convertAttributeToXml(a,b,c,d,e);null==c?(b=a.document.createElement("add"),"function"==typeof d?b.appendChild(a.document.createTextNode(d)):a.setAttribute(b,"value",d),e.appendChild(b)):"function"!=typeof d&&a.setAttribute(e,c,d)};
mxObjectCodec.prototype.writeComplexAttribute=function(a,b,c,d,e){a=a.encode(d);null!=a?(null!=c&&a.setAttribute("as",c),e.appendChild(a)):mxLog.warn("mxObjectCodec.encode: No node for "+this.getName()+"."+c+": "+d)};mxObjectCodec.prototype.convertAttributeToXml=function(a,b,c,d){this.isBooleanAttribute(a,b,c,d)&&(d=!0==d?"1":"0");return d};mxObjectCodec.prototype.isBooleanAttribute=function(a,b,c,d){return"undefined"==typeof d.length&&(!0==d||!1==d)};
mxObjectCodec.prototype.convertAttributeFromXml=function(a,b,c){var d=b.value;this.isNumericAttribute(a,b,c)&&(d=parseFloat(d));return d};mxObjectCodec.prototype.isNumericAttribute=function(a,b,c){return mxUtils.isNumeric(b.value)};mxObjectCodec.prototype.beforeEncode=function(a,b,c){return b};mxObjectCodec.prototype.afterEncode=function(a,b,c){return c};
mxObjectCodec.prototype.decode=function(a,b,c){var d=b.getAttribute("id"),e=a.objects[d];null==e&&(e=c||this.cloneTemplate(),null!=d&&a.putObject(d,e));b=this.beforeDecode(a,b,e);this.decodeNode(a,b,e);return this.afterDecode(a,b,e)};mxObjectCodec.prototype.decodeNode=function(a,b,c){null!=b&&(this.decodeAttributes(a,b,c),this.decodeChildren(a,b,c))};mxObjectCodec.prototype.decodeAttributes=function(a,b,c){b=b.attributes;if(null!=b)for(var d=0;d<b.length;d++)this.decodeAttribute(a,b[d],c)};
mxObjectCodec.prototype.decodeAttribute=function(a,b,c){var d=b.nodeName;if("as"!=d&&"id"!=d){b=this.convertAttributeFromXml(a,b,c);var e=this.getFieldName(d);if(this.isReference(c,e,b,!1)){a=a.getObject(b);if(null==a){mxLog.warn("mxObjectCodec.decode: No object for "+this.getName()+"."+d+"="+b);return}b=a}this.isExcluded(c,d,b,!1)||(c[d]=b)}};
mxObjectCodec.prototype.decodeChildren=function(a,b,c){for(b=b.firstChild;null!=b;){var d=b.nextSibling;b.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(a,b,c)&&this.decodeChild(a,b,c);b=d}};
mxObjectCodec.prototype.decodeChild=function(a,b,c){var d=this.getFieldName(b.getAttribute("as"));if(null==d||!this.isExcluded(c,d,b,!1)){var e=this.getFieldTemplate(c,d,b),f=null;"add"==b.nodeName?(f=b.getAttribute("value"),null==f&&mxObjectCodec.allowEval&&(f=mxUtils.eval(mxUtils.getTextContent(b)))):f=a.decode(b,e);this.addObjectValue(c,d,f,e)}};mxObjectCodec.prototype.getFieldTemplate=function(a,b,c){a=a[b];a instanceof Array&&0<a.length&&(a=null);return a};
mxObjectCodec.prototype.addObjectValue=function(a,b,c,d){null!=c&&c!=d&&(null!=b&&0<b.length?a[b]=c:a.push(c))};mxObjectCodec.prototype.processInclude=function(a,b,c){if("include"==b.nodeName){b=b.getAttribute("name");if(null!=b)try{var d=mxUtils.load(b).getDocumentElement();null!=d&&a.decode(d,c)}catch(e){}return!0}return!1};mxObjectCodec.prototype.beforeDecode=function(a,b,c){return b};mxObjectCodec.prototype.afterDecode=function(a,b,c){return c};
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxCell,["children","edges","overlays","mxTransient"],["parent","source","target"]);a.isCellCodec=function(){return!0};a.isNumericAttribute=function(a,c,d){return"value"!==c.nodeName&&mxObjectCodec.prototype.isNumericAttribute.apply(this,arguments)};a.isExcluded=function(a,c,d,e){return mxObjectCodec.prototype.isExcluded.apply(this,arguments)||e&&"value"==c&&d.nodeType==mxConstants.NODETYPE_ELEMENT};a.afterEncode=function(a,c,d){if(null!=
c.value&&c.value.nodeType==mxConstants.NODETYPE_ELEMENT){var e=d;d=mxUtils.importNode(a.document,c.value,!0);d.appendChild(e);a=e.getAttribute("id");d.setAttribute("id",a);e.removeAttribute("id")}return d};a.beforeDecode=function(a,c,d){var e=c,f=this.getName();c.nodeName!=f?(e=c.getElementsByTagName(f)[0],null!=e&&e.parentNode==c?(mxUtils.removeWhitespace(e,!0),mxUtils.removeWhitespace(e,!1),e.parentNode.removeChild(e)):e=null,d.value=c.cloneNode(!0),c=d.value.getAttribute("id"),null!=c&&(d.setId(c),
d.value.removeAttribute("id"))):d.setId(c.getAttribute("id"));if(null!=e)for(c=0;c<this.idrefs.length;c++){var f=this.idrefs[c],g=e.getAttribute(f);if(null!=g){e.removeAttribute(f);var k=a.objects[g]||a.lookup(g);null==k&&(g=a.getElementById(g),null!=g&&(k=(mxCodecRegistry.codecs[g.nodeName]||this).decode(a,g)));d[f]=k}}return e};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxGraphModel);a.encodeObject=function(a,c,d){var e=a.document.createElement("root");a.encodeCell(c.getRoot(),e);d.appendChild(e)};a.decodeChild=function(a,c,d){"root"==c.nodeName?this.decodeRoot(a,c,d):mxObjectCodec.prototype.decodeChild.apply(this,arguments)};a.decodeRoot=function(a,c,d){var e=null;for(c=c.firstChild;null!=c;){var f=a.decodeCell(c);null!=f&&null==f.getParent()&&(e=f);c=c.nextSibling}null!=e&&d.setRoot(e)};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxRootChange,["model","previous","root"]);a.afterEncode=function(a,c,d){a.encodeCell(c.root,d);return d};a.beforeDecode=function(a,c,d){if(null!=c.firstChild&&c.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){c=c.cloneNode(!0);var e=c.firstChild;d.root=a.decodeCell(e,!1);d=e.nextSibling;e.parentNode.removeChild(e);for(e=d;null!=e;)d=e.nextSibling,a.decodeCell(e),e.parentNode.removeChild(e),e=d}return c};a.afterDecode=function(a,c,
d){d.previous=d.root;return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxChildChange,["model","child","previousIndex"],["parent","previous"]);a.isReference=function(a,c,d,e){return"child"!=c||null==a.previous&&e?0<=mxUtils.indexOf(this.idrefs,c):!0};a.afterEncode=function(a,c,d){this.isReference(c,"child",c.child,!0)?d.setAttribute("child",a.getId(c.child)):a.encodeCell(c.child,d);return d};a.beforeDecode=function(a,c,d){if(null!=c.firstChild&&c.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){c=c.cloneNode(!0);
var e=c.firstChild;d.child=a.decodeCell(e,!1);d=e.nextSibling;e.parentNode.removeChild(e);for(e=d;null!=e;){d=e.nextSibling;if(e.nodeType==mxConstants.NODETYPE_ELEMENT){var f=e.getAttribute("id");null==a.lookup(f)&&a.decodeCell(e)}e.parentNode.removeChild(e);e=d}}else e=c.getAttribute("child"),d.child=a.getObject(e);return c};a.afterDecode=function(a,c,d){d.child.parent=d.previous;d.previous=d.parent;d.previousIndex=d.index;return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxTerminalChange,["model","previous"],["cell","terminal"]);a.afterDecode=function(a,c,d){d.previous=d.terminal;return d};return a}());var mxGenericChangeCodec=function(a,b){var c=new mxObjectCodec(a,["model","previous"],["cell"]);c.afterDecode=function(a,c,f){mxUtils.isNode(f.cell)&&(f.cell=a.decodeCell(f.cell,!1));f.previous=f[b];return f};return c};mxCodecRegistry.register(mxGenericChangeCodec(new mxValueChange,"value"));
mxCodecRegistry.register(mxGenericChangeCodec(new mxStyleChange,"style"));mxCodecRegistry.register(mxGenericChangeCodec(new mxGeometryChange,"geometry"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCollapseChange,"collapsed"));mxCodecRegistry.register(mxGenericChangeCodec(new mxVisibleChange,"visible"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCellAttributeChange,"value"));mxCodecRegistry.register(function(){return new mxObjectCodec(new mxGraph,"graphListeners eventListeners view container cellRenderer editor selection".split(" "))}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxGraphView);a.encode=function(a,c){return this.encodeCell(a,c,c.graph.getModel().getRoot())};a.encodeCell=function(a,c,d){var e=c.graph.getModel(),f=c.getState(d),g=e.getParent(d);if(null==g||null!=f){var k=e.getChildCount(d),l=c.graph.getCellGeometry(d),m=null;g==e.getRoot()?m="layer":null==g?m="graph":e.isEdge(d)?m="edge":0<k&&null!=l?m="group":e.isVertex(d)&&(m="vertex");if(null!=m){var n=a.document.createElement(m);null!=c.graph.getLabel(d)&&
(n.setAttribute("label",c.graph.getLabel(d)),c.graph.isHtmlLabel(d)&&n.setAttribute("html",!0));if(null==g){var p=c.getGraphBounds();null!=p&&(n.setAttribute("x",Math.round(p.x)),n.setAttribute("y",Math.round(p.y)),n.setAttribute("width",Math.round(p.width)),n.setAttribute("height",Math.round(p.height)));n.setAttribute("scale",c.scale)}else if(null!=f&&null!=l){for(p in f.style)g=f.style[p],"function"==typeof g&&"object"==typeof g&&(g=mxStyleRegistry.getName(g)),null!=g&&"function"!=typeof g&&"object"!=
typeof g&&n.setAttribute(p,g);g=f.absolutePoints;if(null!=g&&0<g.length){l=Math.round(g[0].x)+","+Math.round(g[0].y);for(p=1;p<g.length;p++)l+=" "+Math.round(g[p].x)+","+Math.round(g[p].y);n.setAttribute("points",l)}else n.setAttribute("x",Math.round(f.x)),n.setAttribute("y",Math.round(f.y)),n.setAttribute("width",Math.round(f.width)),n.setAttribute("height",Math.round(f.height));p=f.absoluteOffset;null!=p&&(0!=p.x&&n.setAttribute("dx",Math.round(p.x)),0!=p.y&&n.setAttribute("dy",Math.round(p.y)))}for(p=
0;p<k;p++)f=this.encodeCell(a,c,e.getChildAt(d,p)),null!=f&&n.appendChild(f)}}return n};return a}());
var mxStylesheetCodec=mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxStylesheet);a.encode=function(a,c){var d=a.document.createElement(this.getName()),e;for(e in c.styles){var f=c.styles[e],g=a.document.createElement("add");if(null!=e){g.setAttribute("as",e);for(var k in f){var l=this.getStringValue(k,f[k]);if(null!=l){var m=a.document.createElement("add");m.setAttribute("value",l);m.setAttribute("as",k);g.appendChild(m)}}0<g.childNodes.length&&d.appendChild(g)}}return d};a.getStringValue=
function(a,c){var d=typeof c;"function"==d?c=mxStyleRegistry.getName(style[j]):"object"==d&&(c=null);return c};a.decode=function(a,c,d){d=d||new this.template.constructor;var e=c.getAttribute("id");null!=e&&(a.objects[e]=d);for(c=c.firstChild;null!=c;){if(!this.processInclude(a,c,d)&&"add"==c.nodeName&&(e=c.getAttribute("as"),null!=e)){var f=c.getAttribute("extend"),g=null!=f?mxUtils.clone(d.styles[f]):null;null==g&&(null!=f&&mxLog.warn("mxStylesheetCodec.decode: stylesheet "+f+" not found to extend"),
g={});for(f=c.firstChild;null!=f;){if(f.nodeType==mxConstants.NODETYPE_ELEMENT){var k=f.getAttribute("as");if("add"==f.nodeName){var l=mxUtils.getTextContent(f),m=null;null!=l&&0<l.length&&mxStylesheetCodec.allowEval?m=mxUtils.eval(l):(m=f.getAttribute("value"),mxUtils.isNumeric(m)&&(m=parseFloat(m)));null!=m&&(g[k]=m)}else"remove"==f.nodeName&&delete g[k]}f=f.nextSibling}d.putCellStyle(e,g)}c=c.nextSibling}return d};return a}());mxStylesheetCodec.allowEval=!0;
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultKeyHandler);a.encode=function(a,c){return null};a.decode=function(a,c,d){if(null!=d)for(c=c.firstChild;null!=c;){if(!this.processInclude(a,c,d)&&"add"==c.nodeName){var e=c.getAttribute("as"),f=c.getAttribute("action"),g=c.getAttribute("control");d.bindAction(e,f,g)}c=c.nextSibling}return d};return a}());
var mxDefaultToolbarCodec=mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultToolbar);a.encode=function(a,c){return null};a.decode=function(a,c,d){if(null!=d){var e=d.editor;for(c=c.firstChild;null!=c;){if(c.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(a,c,d))if("separator"==c.nodeName)d.addSeparator();else if("br"==c.nodeName)d.toolbar.addBreak();else if("hr"==c.nodeName)d.toolbar.addLine();else if("add"==c.nodeName){var f=c.getAttribute("as"),f=mxResources.get(f)||
f,g=c.getAttribute("icon"),k=c.getAttribute("pressedIcon"),l=c.getAttribute("action"),m=c.getAttribute("mode"),n=c.getAttribute("template"),p="0"!=c.getAttribute("toggle"),q=mxUtils.getTextContent(c),u=null;if(null!=l)u=d.addItem(f,g,l,k);else if(null!=m)var v=mxDefaultToolbarCodec.allowEval?mxUtils.eval(q):null,u=d.addMode(f,g,m,k,v);else if(null!=n||null!=q&&0<q.length)u=e.templates[n],n=c.getAttribute("style"),null!=u&&null!=n&&(u=e.graph.cloneCells([u])[0],u.setStyle(n)),n=null,null!=q&&0<q.length&&
mxDefaultToolbarCodec.allowEval&&(n=mxUtils.eval(q)),u=d.addPrototype(f,g,u,k,n,p);else if(k=mxUtils.getChildNodes(c),0<k.length)if(null==g)for(n=d.addActionCombo(f),f=0;f<k.length;f++)p=k[f],"separator"==p.nodeName?d.addOption(n,"---"):"add"==p.nodeName&&(g=p.getAttribute("as"),p=p.getAttribute("action"),d.addActionOption(n,g,p));else{var y=null,z=d.addPrototype(f,g,function(){var a=e.templates[y.value];if(null!=a){var a=a.clone(),b=y.options[y.selectedIndex].cellStyle;null!=b&&a.setStyle(b);return a}mxLog.warn("Template "+
a+" not found");return null},null,null,p),y=d.addCombo();mxEvent.addListener(y,"change",function(){d.toolbar.selectMode(z,function(a){a=mxUtils.convertPoint(e.graph.container,mxEvent.getClientX(a),mxEvent.getClientY(a));return e.addVertex(null,v(),a.x,a.y)});d.toolbar.noReset=!1});for(f=0;f<k.length;f++)p=k[f],"separator"==p.nodeName?d.addOption(y,"---"):"add"==p.nodeName&&(g=p.getAttribute("as"),q=p.getAttribute("template"),d.addOption(y,g,q||n).cellStyle=p.getAttribute("style"))}null!=u&&(n=c.getAttribute("id"),
null!=n&&0<n.length&&u.setAttribute("id",n))}c=c.nextSibling}}return d};return a}());mxDefaultToolbarCodec.allowEval=!0;mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultPopupMenu);a.encode=function(a,c){return null};a.decode=function(a,c,d){var e=c.getElementsByTagName("include")[0];null!=e?this.processInclude(a,e,d):null!=d&&(d.config=c);return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxEditor,"modified lastSnapshot ignoredChanges undoManager graphContainer toolbarContainer".split(" "));a.afterDecode=function(a,c,d){a=c.getAttribute("defaultEdge");null!=a&&(c.removeAttribute("defaultEdge"),d.defaultEdge=d.templates[a]);a=c.getAttribute("defaultGroup");null!=a&&(c.removeAttribute("defaultGroup"),d.defaultGroup=d.templates[a]);return d};a.decodeChild=function(a,c,d){if("Array"==c.nodeName){if("templates"==c.getAttribute("as")){this.decodeTemplates(a,
c,d);return}}else if("ui"==c.nodeName){this.decodeUi(a,c,d);return}mxObjectCodec.prototype.decodeChild.apply(this,arguments)};a.decodeUi=function(a,c,d){for(a=c.firstChild;null!=a;){if("add"==a.nodeName){c=a.getAttribute("as");var e=a.getAttribute("element"),f=a.getAttribute("style"),g=null;if(null!=e)g=document.getElementById(e),null!=g&&null!=f&&(g.style.cssText+=";"+f);else{var e=parseInt(a.getAttribute("x")),k=parseInt(a.getAttribute("y")),l=a.getAttribute("width"),m=a.getAttribute("height"),
g=document.createElement("div");g.style.cssText=f;(new mxWindow(mxResources.get(c)||c,g,e,k,l,m,!1,!0)).setVisible(!0)}"graph"==c?d.setGraphContainer(g):"toolbar"==c?d.setToolbarContainer(g):"title"==c?d.setTitleContainer(g):"status"==c?d.setStatusContainer(g):"map"==c&&d.setMapContainer(g)}else"resource"==a.nodeName?mxResources.add(a.getAttribute("basename")):"stylesheet"==a.nodeName&&mxClient.link("stylesheet",a.getAttribute("name"));a=a.nextSibling}};a.decodeTemplates=function(a,c,d){null==d.templates&&
(d.templates=[]);c=mxUtils.getChildNodes(c);for(var e=0;e<c.length;e++){for(var f=c[e].getAttribute("as"),g=c[e].firstChild;null!=g&&1!=g.nodeType;)g=g.nextSibling;null!=g&&(d.templates[f]=a.decodeCell(g))}};return a}());var CSS_PROP_BIT_QUANTITY=1,CSS_PROP_BIT_HASH_VALUE=2,CSS_PROP_BIT_NEGATIVE_QUANTITY=4,CSS_PROP_BIT_QSTRING_CONTENT=8,CSS_PROP_BIT_QSTRING_URL=16,CSS_PROP_BIT_HISTORY_INSENSITIVE=32,CSS_PROP_BIT_Z_INDEX=64,CSS_PROP_BIT_ALLOWED_IN_LINK=128,cssSchema=function(){var a=["rgb(?:\\(\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)|a\\(\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0(?:\\.\\d+)?|\\.\\d+|1(?:\\.0+)?|0|\\d+(?:\\.\\d+)?%)) *\\)"],
b=[/^ *$/i,RegExp("^ *(?:\\s*"+a[0]+"|(?:\\s*"+a[0]+")?)+ *$","i"),RegExp("^ *\\s*"+a[0]+" *$","i"),RegExp("^ *\\s*"+a[0]+"\\s*"+a[0]+" *$","i")],c=["aliceblue antiquewhite aqua aquamarine azure beige bisque black blanchedalmond blue blueviolet brown burlywood cadetblue chartreuse chocolate coral cornflowerblue cornsilk crimson cyan darkblue darkcyan darkgoldenrod darkgray darkgreen darkkhaki darkmagenta darkolivegreen darkorange darkorchid darkred darksalmon darkseagreen darkslateblue darkslategray darkturquoise darkviolet deeppink deepskyblue dimgray dodgerblue firebrick floralwhite forestgreen fuchsia gainsboro ghostwhite gold goldenrod gray green greenyellow honeydew hotpink indianred indigo ivory khaki lavender lavenderblush lawngreen lemonchiffon lightblue lightcoral lightcyan lightgoldenrodyellow lightgreen lightgrey lightpink lightsalmon lightseagreen lightskyblue lightslategray lightsteelblue lightyellow lime limegreen linen magenta maroon mediumaquamarine mediumblue mediumorchid mediumpurple mediumseagreen mediumslateblue mediumspringgreen mediumturquoise mediumvioletred midnightblue mintcream mistyrose moccasin navajowhite navy oldlace olive olivedrab orange orangered orchid palegoldenrod palegreen paleturquoise palevioletred papayawhip peachpuff peru pink plum powderblue purple red rosybrown royalblue saddlebrown salmon sandybrown seagreen seashell sienna silver skyblue slateblue slategray snow springgreen steelblue tan teal thistle tomato turquoise violet wheat white whitesmoke yellow yellowgreen".split(" "),
"all-scroll col-resize crosshair default e-resize hand help move n-resize ne-resize no-drop not-allowed nw-resize pointer progress row-resize s-resize se-resize sw-resize text vertical-text w-resize wait".split(" "),"-moz-inline-box -moz-inline-stack block inline inline-block inline-table list-item run-in table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group".split(" "),"armenian circle decimal decimal-leading-zero disc georgian lower-alpha lower-greek lower-latin lower-roman square upper-alpha upper-latin upper-roman".split(" "),
"100 200 300 400 500 600 700 800 900 bold bolder lighter".split(" "),"condensed expanded extra-condensed extra-expanded narrower semi-condensed semi-expanded ultra-condensed ultra-expanded wider".split(" "),"behind center-left center-right far-left far-right left-side leftwards right-side rightwards".split(" "),"large larger small smaller x-large x-small xx-large xx-small".split(" "),"-moz-pre-wrap -o-pre-wrap -pre-wrap nowrap pre pre-line pre-wrap".split(" "),"dashed dotted double groove outset ridge solid".split(" "),
"baseline middle sub super text-bottom text-top".split(" "),"caption icon menu message-box small-caption status-bar".split(" "),"fast faster slow slower x-fast x-slow".split(" "),["above","below","higher","level","lower"],["border-box","contain","content-box","cover","padding-box"],["cursive","fantasy","monospace","sans-serif","serif"],["loud","silent","soft","x-loud","x-soft"],["no-repeat","repeat-x","repeat-y","round","space"],["blink","line-through","overline","underline"],["high","low","x-high",
"x-low"],["absolute","relative","static"],["capitalize","lowercase","uppercase"],["child","female","male"],["bidi-override","embed"],["bottom","top"],["clip","ellipsis"],["continuous","digits"],["hide","show"],["inside","outside"],["italic","oblique"],["left","right"],["ltr","rtl"],["no-content","no-display"],["suppress","unrestricted"],["thick","thin"],[","],["/"],["always"],["auto"],["avoid"],["both"],["break-word"],["center"],["code"],["collapse"],["fixed"],["hidden"],["inherit"],["inset"],["invert"],
["justify"],["local"],["medium"],["mix"],["none"],["normal"],["once"],["repeat"],["scroll"],["separate"],["small-caps"],["spell-out"],["transparent"],["visible"]];return{"-moz-border-radius":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[36]]},"-moz-border-radius-bottomleft":{cssExtra:b[0],cssPropBits:5},"-moz-border-radius-bottomright":{cssExtra:b[0],cssPropBits:5},"-moz-border-radius-topleft":{cssExtra:b[0],cssPropBits:5},"-moz-border-radius-topright":{cssExtra:b[0],cssPropBits:5},"-moz-box-shadow":{cssExtra:b[1],
cssAlternates:["boxShadow"],cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},"-moz-opacity":{cssPropBits:1,cssLitGroup:[c[47]]},"-moz-outline":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[49],c[52],c[54]]},"-moz-outline-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[49]]},"-moz-outline-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"-moz-outline-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"-o-text-overflow":{cssPropBits:0,
cssLitGroup:[c[25]]},"-webkit-border-bottom-left-radius":{cssExtra:b[0],cssPropBits:5},"-webkit-border-bottom-right-radius":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[36]]},"-webkit-border-radius-bottom-left":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius-bottom-right":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius-top-left":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius-top-right":{cssExtra:b[0],cssPropBits:5},"-webkit-border-top-left-radius":{cssExtra:b[0],
cssPropBits:5},"-webkit-border-top-right-radius":{cssExtra:b[0],cssPropBits:5},"-webkit-box-shadow":{cssExtra:b[1],cssAlternates:["boxShadow"],cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},azimuth:{cssPropBits:5,cssLitGroup:[c[6],c[30],c[42],c[47]]},background:{cssExtra:RegExp("^ *(?:\\s*"+a[0]+"){0,2} *$","i"),cssPropBits:23,cssLitGroup:[c[0],c[14],c[17],c[24],c[30],c[35],c[36],c[38],c[42],c[45],c[47],c[51],c[54],c[57],c[58],c[62]]},"background-attachment":{cssExtra:b[0],cssPropBits:0,cssLitGroup:[c[35],
c[45],c[51],c[58]]},"background-color":{cssExtra:b[2],cssPropBits:130,cssLitGroup:[c[0],c[47],c[62]]},"background-image":{cssExtra:b[0],cssPropBits:16,cssLitGroup:[c[35],c[54]]},"background-position":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[24],c[30],c[35],c[42]]},"background-repeat":{cssExtra:b[0],cssPropBits:0,cssLitGroup:[c[17],c[35],c[57]]},border:{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-bottom":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],
c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-bottom-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-bottom-left-radius":{cssExtra:b[0],cssPropBits:5},"border-bottom-right-radius":{cssExtra:b[0],cssPropBits:5},"border-bottom-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-bottom-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-collapse":{cssPropBits:0,cssLitGroup:[c[44],c[47],c[59]]},"border-color":{cssExtra:RegExp("^ *(?:\\s*"+
a[0]+"){1,4} *$","i"),cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-left":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-left-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-left-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-left-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-radius":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[36]]},"border-right":{cssExtra:b[3],
cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-right-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-right-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-right-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-spacing":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[47]]},"border-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-top":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],
c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-top-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-top-left-radius":{cssExtra:b[0],cssPropBits:5},"border-top-right-radius":{cssExtra:b[0],cssPropBits:5},"border-top-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-top-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},bottom:{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"box-shadow":{cssExtra:b[1],
cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},"caption-side":{cssPropBits:0,cssLitGroup:[c[24],c[47]]},clear:{cssPropBits:0,cssLitGroup:[c[30],c[40],c[47],c[54]]},clip:{cssExtra:/^ *\s*rect\(\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto) *\) *$/i,cssPropBits:0,cssLitGroup:[c[38],c[47]]},color:{cssExtra:b[2],
cssPropBits:130,cssLitGroup:[c[0],c[47]]},content:{cssPropBits:0},"counter-increment":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[47],c[54]]},"counter-reset":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[47],c[54]]},cue:{cssPropBits:16,cssLitGroup:[c[47],c[54]]},"cue-after":{cssPropBits:16,cssLitGroup:[c[47],c[54]]},"cue-before":{cssPropBits:16,cssLitGroup:[c[47],c[54]]},cursor:{cssExtra:b[0],cssPropBits:144,cssLitGroup:[c[1],c[35],c[38],c[47]]},direction:{cssPropBits:0,cssLitGroup:[c[31],c[47]]},display:{cssPropBits:32,
cssLitGroup:[c[2],c[47],c[54]]},elevation:{cssPropBits:5,cssLitGroup:[c[13],c[47]]},"empty-cells":{cssPropBits:0,cssLitGroup:[c[27],c[47]]},filter:{cssExtra:/^ *(?:\s*alpha\(\s*opacity\s*=\s*(?:0|\d+(?:\.\d+)?%|[+\-]?\d+(?:\.\d+)?) *\))+ *$/i,cssPropBits:32},"float":{cssAlternates:["cssFloat","styleFloat"],cssPropBits:32,cssLitGroup:[c[30],c[47],c[54]]},font:{cssExtra:b[0],cssPropBits:9,cssLitGroup:[c[4],c[7],c[11],c[15],c[29],c[35],c[36],c[47],c[52],c[55],c[60]]},"font-family":{cssExtra:b[0],cssPropBits:8,
cssLitGroup:[c[15],c[35],c[47]]},"font-size":{cssPropBits:1,cssLitGroup:[c[7],c[47],c[52]]},"font-stretch":{cssPropBits:0,cssLitGroup:[c[5],c[55]]},"font-style":{cssPropBits:0,cssLitGroup:[c[29],c[47],c[55]]},"font-variant":{cssPropBits:0,cssLitGroup:[c[47],c[55],c[60]]},"font-weight":{cssPropBits:0,cssLitGroup:[c[4],c[47],c[55]]},height:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},left:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},"letter-spacing":{cssPropBits:5,cssLitGroup:[c[47],c[55]]},"line-height":{cssPropBits:1,
cssLitGroup:[c[47],c[55]]},"list-style":{cssPropBits:16,cssLitGroup:[c[3],c[28],c[47],c[54]]},"list-style-image":{cssPropBits:16,cssLitGroup:[c[47],c[54]]},"list-style-position":{cssPropBits:0,cssLitGroup:[c[28],c[47]]},"list-style-type":{cssPropBits:0,cssLitGroup:[c[3],c[47],c[54]]},margin:{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"margin-bottom":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"margin-left":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"margin-right":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},
"margin-top":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"max-height":{cssPropBits:1,cssLitGroup:[c[38],c[47],c[54]]},"max-width":{cssPropBits:1,cssLitGroup:[c[38],c[47],c[54]]},"min-height":{cssPropBits:1,cssLitGroup:[c[38],c[47]]},"min-width":{cssPropBits:1,cssLitGroup:[c[38],c[47]]},opacity:{cssPropBits:33,cssLitGroup:[c[47]]},outline:{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[49],c[52],c[54]]},"outline-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],
c[49]]},"outline-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"outline-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},overflow:{cssPropBits:32,cssLitGroup:[c[38],c[46],c[47],c[58],c[63]]},"overflow-x":{cssPropBits:0,cssLitGroup:[c[32],c[38],c[46],c[58],c[63]]},"overflow-y":{cssPropBits:0,cssLitGroup:[c[32],c[38],c[46],c[58],c[63]]},padding:{cssPropBits:1,cssLitGroup:[c[47]]},"padding-bottom":{cssPropBits:33,cssLitGroup:[c[47]]},"padding-left":{cssPropBits:33,cssLitGroup:[c[47]]},
"padding-right":{cssPropBits:33,cssLitGroup:[c[47]]},"padding-top":{cssPropBits:33,cssLitGroup:[c[47]]},"page-break-after":{cssPropBits:0,cssLitGroup:[c[30],c[37],c[38],c[39],c[47]]},"page-break-before":{cssPropBits:0,cssLitGroup:[c[30],c[37],c[38],c[39],c[47]]},"page-break-inside":{cssPropBits:0,cssLitGroup:[c[38],c[39],c[47]]},pause:{cssPropBits:5,cssLitGroup:[c[47]]},"pause-after":{cssPropBits:5,cssLitGroup:[c[47]]},"pause-before":{cssPropBits:5,cssLitGroup:[c[47]]},pitch:{cssPropBits:5,cssLitGroup:[c[19],
c[47],c[52]]},"pitch-range":{cssPropBits:5,cssLitGroup:[c[47]]},"play-during":{cssExtra:b[0],cssPropBits:16,cssLitGroup:[c[38],c[47],c[53],c[54],c[57]]},position:{cssPropBits:32,cssLitGroup:[c[20],c[47]]},quotes:{cssExtra:b[0],cssPropBits:0,cssLitGroup:[c[47],c[54]]},richness:{cssPropBits:5,cssLitGroup:[c[47]]},right:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},speak:{cssPropBits:0,cssLitGroup:[c[47],c[54],c[55],c[61]]},"speak-header":{cssPropBits:0,cssLitGroup:[c[37],c[47],c[56]]},"speak-numeral":{cssPropBits:0,
cssLitGroup:[c[26],c[47]]},"speak-punctuation":{cssPropBits:0,cssLitGroup:[c[43],c[47],c[54]]},"speech-rate":{cssPropBits:5,cssLitGroup:[c[12],c[47],c[52]]},stress:{cssPropBits:5,cssLitGroup:[c[47]]},"table-layout":{cssPropBits:0,cssLitGroup:[c[38],c[45],c[47]]},"text-align":{cssPropBits:0,cssLitGroup:[c[30],c[42],c[47],c[50]]},"text-decoration":{cssPropBits:0,cssLitGroup:[c[18],c[47],c[54]]},"text-indent":{cssPropBits:5,cssLitGroup:[c[47]]},"text-overflow":{cssPropBits:0,cssLitGroup:[c[25]]},"text-shadow":{cssExtra:b[1],
cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},"text-transform":{cssPropBits:0,cssLitGroup:[c[21],c[47],c[54]]},"text-wrap":{cssPropBits:0,cssLitGroup:[c[33],c[54],c[55]]},top:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},"unicode-bidi":{cssPropBits:0,cssLitGroup:[c[23],c[47],c[55]]},"vertical-align":{cssPropBits:5,cssLitGroup:[c[10],c[24],c[47]]},visibility:{cssPropBits:32,cssLitGroup:[c[44],c[46],c[47],c[63]]},"voice-family":{cssExtra:b[0],cssPropBits:8,cssLitGroup:[c[22],c[35],c[47]]},volume:{cssPropBits:1,
cssLitGroup:[c[16],c[47],c[52]]},"white-space":{cssPropBits:0,cssLitGroup:[c[8],c[47],c[55]]},width:{cssPropBits:33,cssLitGroup:[c[38],c[47]]},"word-spacing":{cssPropBits:5,cssLitGroup:[c[47],c[55]]},"word-wrap":{cssPropBits:0,cssLitGroup:[c[41],c[55]]},"z-index":{cssPropBits:69,cssLitGroup:[c[38],c[47]]},zoom:{cssPropBits:1,cssLitGroup:[c[55]]}}}(),decodeCss,html,html4,html_sanitize,lexCss,parseCssDeclarations,parseCssStylesheet,sanitizeCssProperty,sanitizeStylesheet;
"undefined"!==typeof window&&(window.cssSchema=cssSchema);
(function(){function a(a){var b=parseInt(a.substring(1),16);return 65535<b?(b-=65536,String.fromCharCode(55296+(b>>10),56320+(b&1023))):b==b?String.fromCharCode(b):" ">a[1]?"":a[1]}function b(a,b){return'"'+a.replace(/[\u0000-\u001f\\\"\x3c\x3e]/g,b)+'"'}function c(a){return f[a]||(f[a]="\\"+a.charCodeAt(0).toString(16)+" ")}function d(a){return g[a]||(g[a]=("\u0010">a?"%0":"%")+a.charCodeAt(0).toString(16))}var e,f,g;f={"\\":"\\\\"};g={"\\":"%5c"};e=RegExp("\\uFEFF|U[+][0-9A-F?]{1,6}(?:-[0-9A-F]{1,6})?|url[(][\\t\\n\\f ]*(?:\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|(?:[\\t\\x21\\x23-\\x26\\x28-\\x5b\\x5d-\\x7e]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)[\\t\\n\\f ]*[)]|(?!url[(])-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*[(]|(?:@?-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))|#)(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*|\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|[-+]?(?:[0-9]+(?:[.][0-9]+)?|[.][0-9]+)(?:%|-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)?|\x3c!--|--\x3e|[\\t\\n\\f ]+|/(?:[*][^*]*[*]+(?:[^/][^*]*[*]+)*/|/[^\\n\\f]*)|[~|^$*]=|[^\"'\\\\/]|/(?![/*])",
"gi");decodeCss=function(b){return b.replace(RegExp("\\\\(?:(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff])|[\\n\\f])","g"),a)};lexCss=function(a){var f,g,n,p,q,u,v;v=(""+a).replace(/\r\n?/g,"\n").match(e)||[];g=0;n=" ";f=0;for(q=v.length;f<q;++f)u=decodeCss(v[f]),p=u.length,a=u.charCodeAt(0),u=34==a||39==a?b(u.substring(1,p-1),c):47==a&&1<p||"\\"==u||"--\x3e"==u||"\x3c!--"==u||"\ufeff"==u||32>=a?" ":/url\(/i.test(u)?"url("+b(u.replace(RegExp("^url\\([\\t\\n\\f ]*[\"']?|[\"']?[\\t\\n\\f ]*\\)$",
"gi"),""),d)+")":u,n==u&&" "==u||(v[g++]=n=u);return v.length=g,v}})();"undefined"!==typeof window&&(window.lexCss=lexCss,window.decodeCss=decodeCss);
sanitizeCssProperty=function(){function a(a){return"string"===typeof a?'url("'+a.replace(e,b)+'")':d}function b(a){return f[a]}function c(a,b,c){var d;return c?(d=(""+a).match(l),!d||d[1]&&!k.test(d[1])?null:c(a,b)):null}var d='url("about:blank")',e=/[\n\f\r\"\'()*\x3c\x3e]/g,f={"\n":"%0a","\f":"%0c","\r":"%0d",'"':"%22","'":"%27","(":"%28",")":"%29","*":"%2a","<":"%3c",">":"%3e"},g,k,l;l=/^(?:([^:/?# ]+):)?/;k=/^(?:https?|mailto)$/i;return g={},function(b,e,f,k){for(var l=e.cssPropBits,v=l&(CSS_PROP_BIT_QSTRING_CONTENT|
CSS_PROP_BIT_QSTRING_URL),y=NaN,z=0,x=0,B,A,D,E,G,C,F,I;z<f.length;++z){E=f[z].toLowerCase();B=E.charCodeAt(0);if(32===B)E="";else if(34===B)E=v===CSS_PROP_BIT_QSTRING_URL&&k?a(c(decodeCss(f[z].substring(1,E.length-1)),b,k)):v===CSS_PROP_BIT_QSTRING_CONTENT?E:"";else if(35===B&&/^#(?:[0-9a-f]{3}){1,2}$/.test(E))E=l&CSS_PROP_BIT_HASH_VALUE?E:"";else if(48<=B&&57>=B)E=l&CSS_PROP_BIT_QUANTITY?l&CSS_PROP_BIT_Z_INDEX?E.match(/^\d{1,7}$/)?E:"":E:"";else if(A=E.charCodeAt(1),D=E.charCodeAt(2),G=48<=A&&57>=
A,C=48<=D&&57>=D,43===B&&(G||46===A&&C))E=l&CSS_PROP_BIT_QUANTITY?l&CSS_PROP_BIT_Z_INDEX?E.match(/^\+\d{1,7}$/)?E:"":(G?"":"0")+E.substring(1):"";else if(45===B&&(G||46===A&&C))E=l&CSS_PROP_BIT_NEGATIVE_QUANTITY?l&CSS_PROP_BIT_Z_INDEX?E.match(/^\-\d{1,7}$/)?E:"":(G?"-":"-0")+E.substring(1):l&CSS_PROP_BIT_QUANTITY?"0":"";else if(46===B&&G)E=l&CSS_PROP_BIT_QUANTITY?"0"+E:"";else if("url("===E.substring(0,4))E=k&&v&CSS_PROP_BIT_QSTRING_URL?a(c(f[z].substring(5,E.length-2),b,k)):"";else{if("("===E.charAt(E.length-
1)){E=1;B=z+1;F=f.length;for(var H=void 0;B<F&&E;)H=f[B++],E+="("===H?1:")"===H?-1:0;E=B;f.splice(z,E-z,E=f.slice(z,E).join(" "))}if(F=e.cssLitGroup){if(!(B=e.cssLitMap)){B=e;for(var H={},P=void 0,J=void 0,O=void 0,J=F.length;0<=--J;)for(P=F[J],O=P.length;0<=--O;)H[P[O]]=g;B=B.cssLitMap=H}}else B=g;E=(I=B,I[E]===g||e.cssExtra&&e.cssExtra.test(E))?E:/^\w+$/.test(E)&&v===CSS_PROP_BIT_QSTRING_CONTENT?y+1===x?(f[y]=f[y].substring(0,f[y].length-1)+" "+E+'"',""):(y=x,'"'+E+'"'):""}E&&(f[x++]=E)}1===x&&
f[0]===d&&(x=0);f.length=x}}();
var sanitizeCssSelectors=function(a,b){function c(c,f){function g(c,d,e){var f,l,m;l="";c<d&&(m=a[c].toLowerCase(),("*"===m||"body"===m&&c+1!==d&&!e||"number"===typeof(f=html4.ELEMENTS[m])&&!(f&html4.eflags.UNSAFE))&&(++c,l=m));for(e="";c<d;){m=a[c];if("#"===m.charAt(0)){if(/^#_|__$|[^#0-9A-Za-z:_\-]/.test(m))return null;e+=m+"-"+b}else if("."===m)if(++c<d&&/^[0-9A-Za-z:_\-]+$/.test(m=a[c])&&!/^_|__$/.test(m))e+="."+m;else return null;else break;++c}f="";if(c<d&&":"===a[c]&&(m=a[++c],"visited"===
m||"link"===m)){if(!/^[a*]?$/.test(l))return null;k=!0;f=":"+m;l="a";++c}return c===d?l+e+f:null}var k=!1,q,u,v,y,z;" "===a[c]&&++c;f-1!==c&&" "===a[f]&&--f;z=[];y=c;q="";for(u=c;u<f;++u)if(q=a[u],(v=">"===q)||" "===q){q=g(y,u,!1);if(!q||v&&/^html/i.test(q))return;y=u+1;z.push(q,v?" > ":" ")}if(q=g(y,f,!0))z.push(q),u=z.join(""),/^body\b/.test(u)?u=".vdoc-body___."+b+u.substring(4):u="."+b+" "+u,(k?d:e).push(u)}var d=[],e=[],f=0,g,k;for(g=0;g<a.length;++g)" "==a[g]&&(">"==a[g-1]||">"==a[g+1])||(a[f++]=
a[g]);a.length=f;f=a.length;for(g=k=0;g<f;++g)","==a[g]&&(c(k,g),k=g+1);c(k,f);return[e,d]};
sanitizeStylesheet=function(){function a(a){var b=!1,c,g,k;c=0;for(g=a.length;c<g-1;++c)k=a[c],":"===a[c+1]&&(b=!(cssSchema[k].cssPropBits&CSS_PROP_BIT_ALLOWED_IN_LINK)),b&&(a[c]=""),";"===k&&(b=!1);return a.join("")}var b={},c={braille:b,embossed:b,handheld:b,print:b,projection:b,screen:b,speech:b,tty:b,tv:b};return function(d,e,f){function g(){m=0!==l.length&&null!==l[l.length-1]}var k=void 0,l=[],m=!1;parseCssStylesheet(d,{startStylesheet:function(){k=[]},endStylesheet:function(){},startAtrule:function(a,
d){m?a=null:"@media"===a?(d=d.filter(function(a){return c[a]==b}),d.length?k.push(a,d.join(","),"{"):a=null):("@import"===a&&window.console&&window.console.log("@import "+d.join(" ")+" elided"),a=null);m=!a;l.push(a)},endAtrule:function(){l.pop();m||k.push(";");g()},startBlock:function(){m||k.push("{")},endBlock:function(){m||(k.push("}"),m=!0)},startRuleset:function(a){var b=void 0,c=!1,d,f,g;m||(g=sanitizeCssSelectors(a,e),d=g[0],b=g[1],d.length||b.length?(f=d.join(", "),f||(f="head > html",c=!0),
k.push(f,"{")):m=!0);l.push(m?null:{historySensitiveSelectors:b,endOfSelectors:k.length-1,removeHistoryInsensitiveSelectors:c})},endRuleset:function(){var b=l.pop(),c=k.length,d,e;m||(k.push("}"),b&&(d=b.historySensitiveSelectors,d.length&&(e=k.slice(b.endOfSelectors),k.push(d.join(", "),a(e)))));b&&b.removeHistoryInsensitiveSelectors&&k.splice(b.endOfSelectors-1,c+1);g()},declaration:function(a,b){var c;m||(c=cssSchema[a],c&&(sanitizeCssProperty(a,c,b,f),b.length&&k.push(a,":",b.join(" "),";")))}});
return k.join("")}}();"undefined"!==typeof window&&(window.sanitizeCssProperty=sanitizeCssProperty,window.sanitizeCssSelectors=sanitizeCssSelectors,window.sanitizeStylesheet=sanitizeStylesheet);
(function(){function a(a,c,d,e,f){for(var p=c++,q,u;c<d&&"{"!==a[c]&&";"!==a[c];)++c;return c<d&&(f||";"===a[c])&&(u=p+1,q=c,u<d&&" "===a[u]&&++u,q>u&&" "===a[q-1]&&--q,e.startAtrule&&e.startAtrule(a[p].toLowerCase(),a.slice(u,q)),c="{"===a[c]?b(a,c,d,e):c+1,e.endAtrule&&e.endAtrule()),c}function b(d,e,f,m){var n;++e;for(m.startBlock&&m.startBlock();e<f;){n=d[e].charAt(0);if("}"==n){++e;break}" "===n||";"===n?e+=1:"@"===n?e=a(d,e,f,m,!1):"{"===n?e=b(d,e,f,m):e=c(d,e,f,m)}return m.endBlock&&m.endBlock(),
e}function c(a,b,c,f){var n=b,p=d(a,b,c,!0),q;if(0>p)return p=~p,b===p?p+1:p;b=p;p>n&&" "===a[p-1]&&--p;q=a[b];++b;if("{"!==q)return b;for(f.startRuleset&&f.startRuleset(a.slice(n,p));b<c;){q=a[b];if("}"===q){++b;break}" "===q?b+=1:b=e(a,b,c,f)}return f.endRuleset&&f.endRuleset(),b<c?b+1:b}function d(a,b,c,d){for(var e=[],f=-1,q;b<c;++b)if(q=a[b].charAt(0),"["===q||"("===q)e[++f]=q;else if("]"===q&&"["===e[f]||")"===q&&"("===e[f])--f;else if("{"===q||"}"===q||";"===q||"@"===q||":"===q&&!d)break;return 0<=
f&&(b=~(b+1)),b}function e(a,b,c,e){var n=a[b++],p,q,u,v;if(!f.test(n))return b+1;b<c&&" "===a[b]&&++b;if(b==c||":"!==a[b]){for(;b<c&&";"!==(q=a[b])&&"}"!==q;)++b;return b}++b;b<c&&" "===a[b]&&++b;q=b;b=d(a,b,c,!1);if(0>b)b=~b;else{u=[];v=0;for(p=q;p<b;++p)q=a[p]," "!==q&&(u[v++]=q);if(b<c){do{q=a[b];if(";"===q||"}"===q)break;v=0}while(++b<c);";"===q&&++b}v&&e.declaration&&e.declaration(n.toLowerCase(),u)}return b}var f;parseCssStylesheet=function(b,d){var e=lexCss(b),f,n;d.startStylesheet&&d.startStylesheet();
f=0;for(n=e.length;f<n;){var p;if(" "===e[f])p=f+1;else{p=e;var q=f,u=n,v=d;f=void 0;p=q<u?(f=p[q],"@"===f.charAt(0)?a(p,q,u,v,!0):c(p,q,u,v)):q}f=p}d.endStylesheet&&d.endStylesheet()};f=/^-?[a-z]/i;parseCssDeclarations=function(a,b){var c=lexCss(a),d,f;d=0;for(f=c.length;d<f;)d=" "!==c[d]?e(c,d,f,b):d+1}})();"undefined"!==typeof window&&(window.parseCssStylesheet=parseCssStylesheet,window.parseCssDeclarations=parseCssDeclarations);
html4={atype:{NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},ATTRIBS:{"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,
"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":0,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,
"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,
"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,
"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,
"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,
"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,
"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},eflags:{OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,
UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},ELEMENTS:{a:0,abbr:0,acronym:0,address:0,applet:16,area:2,article:16,aside:16,audio:16,b:0,base:18,basefont:18,bdi:16,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,data:16,datalist:16,dd:1,del:0,details:16,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:16,figure:16,font:0,footer:16,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,header:16,hgroup:16,hr:2,html:49,i:0,iframe:4,
img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,mark:16,menu:0,meta:18,meter:16,nav:0,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,output:16,p:1,param:18,pre:0,progress:16,q:0,s:0,samp:0,script:84,section:16,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,summary:16,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:16,title:24,tr:1,tt:0,u:0,ul:0,"var":0,video:16},ueffects:{NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},
URIEFFECTS:{"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},ltypes:{UNSANDBOXED:2,SANDBOXED:1,DATA:0},LOADERTYPES:{"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2}};html4.ATTRIBS=html4.ATTRIBS;html4.ELEMENTS=html4.ELEMENTS;html4.URIEFFECTS=html4.URIEFFECTS;html4.LOADERTYPES=html4.LOADERTYPES;
html4.atype=html4.atype;html4.eflags=html4.eflags;html4.ltypes=html4.ltypes;html4.ueffects=html4.ueffects;"undefined"!==typeof window&&(window.html4=html4);
html=function(a){function b(a,b){var c=b,d;return c=c.toLowerCase(),A.hasOwnProperty(c)?A[c]:(d=c.match(I),d?String.fromCharCode(parseInt(d[1],10)):(d=c.match(O))?String.fromCharCode(parseInt(d[1],16)):"")}function c(a){return a.replace(P,b)}function d(a){return(""+a).replace(G,"&amp;").replace(M,"&lt;").replace(J,"&gt;").replace(S,"&#34;")}function e(a){return a.replace(N,"&amp;$1").replace(M,"&lt;").replace(J,"&gt;")}function f(a){var b={cdata:a.cdata||a.cdata,comment:a.comment||a.comment,endDoc:a.endDoc||
a.endDoc,endTag:a.endTag||a.endTag,pcdata:a.pcdata||a.pcdata,rcdata:a.rcdata||a.rcdata,startDoc:a.startDoc||a.startDoc,startTag:a.startTag||a.startTag};return function(a,c){var d;var e=/(\x3c\/|\x3c\!--|\x3c[!?]|[\x26\x3c\x3e])/g,f,g,l;d=a+"";if(pa)d=d.split(e);else{l=[];for(f=0;null!==(g=e.exec(d));)l.push(d.substring(f,g.index)),l.push(g[0]),f=g.index+g[0].length;d=(l.push(d.substring(f)),l)}k(b,d,0,{noMoreGT:!1,noMoreEndComments:!1},c)}}function g(a,b,c,d,e){return function(){k(a,b,c,d,e)}}function k(b,
c,d,e,f){var k,n,p,q,u,x,v,F,z,y;try{b.startDoc&&0==d&&b.startDoc(f);F=d;for(q=c.length;F<q;)switch(n=c[F++],x=c[F],n){case "&":D.test(x)?(b.pcdata&&b.pcdata("&"+x,f,C,g(b,c,F,e,f)),++F):b.pcdata&&b.pcdata("&amp;",f,C,g(b,c,F,e,f));break;case "</":if(u=/^(\w+)[^\'\"]*/.exec(x))if(u[0].length===x.length&&">"===c[F+1])F+=2,y=u[1].toLowerCase(),b.endTag&&b.endTag(y,f,C,g(b,c,F,e,f));else{d=c;var H=F,I=b,A=f,P=C,E=e,J=m(d,H);F=J?(I.endTag&&I.endTag(J.name,A,P,g(I,d,H,E,A)),J.next):d.length}else b.pcdata&&
b.pcdata("&lt;/",f,C,g(b,c,F,e,f));break;case "<":if(u=/^(\w+)\s*\/?/.exec(x))if(u[0].length===x.length&&">"===c[F+1])F+=2,y=u[1].toLowerCase(),b.startTag&&b.startTag(y,[],f,C,g(b,c,F,e,f)),p=a.ELEMENTS[y],p&B&&(z={name:y,next:F,eflags:p},F=l(c,z,b,f,C,e));else{d=c;var H=b,I=f,A=C,P=e,O=m(d,F);F=O?(H.startTag&&H.startTag(O.name,O.attrs,I,A,g(H,d,O.next,P,I)),O.eflags&B?l(d,O,H,I,A,P):O.next):d.length}else b.pcdata&&b.pcdata("&lt;",f,C,g(b,c,F,e,f));break;case "\x3c!--":if(!e.noMoreEndComments){for(v=
F+1;v<q&&(">"!==c[v]||!/--$/.test(c[v-1]));++v);v<q?(b.comment&&(k=c.slice(F,v).join(""),b.comment(k.substr(0,k.length-2),f,C,g(b,c,v+1,e,f))),F=v+1):e.noMoreEndComments=!0}e.noMoreEndComments&&b.pcdata&&b.pcdata("&lt;!--",f,C,g(b,c,F,e,f));break;case "<!":if(/^\w/.test(x)){if(!e.noMoreGT){for(v=F+1;v<q&&">"!==c[v];++v);v<q?F=v+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;!",f,C,g(b,c,F,e,f))}else b.pcdata&&b.pcdata("&lt;!",f,C,g(b,c,F,e,f));break;case "<?":if(!e.noMoreGT){for(v=F+1;v<q&&">"!==
c[v];++v);v<q?F=v+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;?",f,C,g(b,c,F,e,f));break;case ">":b.pcdata&&b.pcdata("&gt;",f,C,g(b,c,F,e,f));break;case "":break;default:b.pcdata&&b.pcdata(n,f,C,g(b,c,F,e,f))}b.endDoc&&b.endDoc(f)}catch(G){if(G!==C)throw G;}}function l(b,c,d,f,k,l){var m=b.length,n,p,q;H.hasOwnProperty(c.name)||(H[c.name]=RegExp("^"+c.name+"(?:[\\s\\/]|$)","i"));q=H[c.name];n=c.next;for(p=c.next+1;p<m&&("</"!==b[p-1]||!q.test(b[p]));++p);p<m&&(p-=1);m=b.slice(n,p).join("");
if(c.eflags&a.eflags.CDATA)d.cdata&&d.cdata(m,f,k,g(d,b,p,l,f));else if(c.eflags&a.eflags.RCDATA)d.rcdata&&d.rcdata(e(m),f,k,g(d,b,p,l,f));else throw Error("bug");return p}function m(b,d){var e=/^(\w+)/.exec(b[d]),f={},g,k,l,m,n,p;f.name=e[1].toLowerCase();f.eflags=a.ELEMENTS[f.name];l=b[d].substr(e[0].length);p=d+1;for(n=b.length;p<n&&">"!==b[p];++p)l+=b[p];if(!(n<=p)){for(m=[];""!==l;)if(e=x.exec(l))if(e[4]&&!e[5]||e[6]&&!e[7]){e=e[4]||e[6];g=!1;for(l=[l,b[p++]];p<n;++p){if(g){if(">"===b[p])break}else 0<=
b[p].indexOf(e)&&(g=!0);l.push(b[p])}if(n<=p)break;l=l.join("")}else{g=e[1].toLowerCase();var q;e[2]?(k=e[3],q=k.charCodeAt(0),q=((34===q||39===q)&&(k=k.substr(1,k.length-2)),c(k.replace(R,"")))):q=g;k=q;m.push(g,k);l=l.substr(e[0].length)}else l=l.replace(/^[\s\S][^a-z\s]*/,"");return f.attrs=m,f.next=p+1,f}}function n(b){var c=function(a,b){e||b.push(a)},e,g;return f({startDoc:function(a){g=[];e=!1},startTag:function(c,f,k){var l,m,n;if(!e&&a.ELEMENTS.hasOwnProperty(c)&&(l=a.ELEMENTS[c],!(l&a.eflags.FOLDABLE))){f=
b(c,f);if(!f)return e=!(l&a.eflags.EMPTY),void 0;l&a.eflags.EMPTY||g.push(c);k.push("<",c);l=0;for(m=f.length;l<m;l+=2)c=f[l],n=f[l+1],null!==n&&void 0!==n&&k.push(" ",c,'="',d(n),'"');k.push(">")}},endTag:function(b,c){var d,f,k;if(e)return e=!1,void 0;if(a.ELEMENTS.hasOwnProperty(b)&&(d=a.ELEMENTS[b],!(d&(a.eflags.EMPTY|a.eflags.FOLDABLE)))){if(d&a.eflags.OPTIONAL_ENDTAG)for(f=g.length;0<=--f;){k=g[f];if(k===b)break;if(!(a.ELEMENTS[k]&a.eflags.OPTIONAL_ENDTAG))return}else for(f=g.length;0<=--f&&
g[f]!==b;);if(!(0>f)){for(d=g.length;--d>f;)k=g[d],a.ELEMENTS[k]&a.eflags.OPTIONAL_ENDTAG||c.push("</",k,">");g.length=f;c.push("</",b,">")}}},pcdata:c,rcdata:c,cdata:c,endDoc:function(a){for(;g.length;--g.length)a.push("</",g[g.length-1],">")}})}function p(a,b){var c;return b?(c=(""+a).match(E),!c||c[1]&&!z.test(c[1])?null:b(a)):null}function q(a,b,c,d,e){var f;c||a(b+" removed",{change:"removed",tagName:b});d!==e&&(f="changed",d&&!e?f="removed":!d&&e&&(f="added"),a(b+"."+c+" "+f,{change:f,tagName:b,
attribName:c,oldValue:d,newValue:e}))}function u(b,c,d,e,f){var g,k,l,m,n,u,x;for(m=0;m<c.length;m+=2){k=c[m];n=x=c[m+1];l=null;((g=b+"::"+k,a.ATTRIBS.hasOwnProperty(g))||(g="*::"+k,a.ATTRIBS.hasOwnProperty(g)))&&(l=a.ATTRIBS[g]);if(null!==l)switch(l){case a.atype.NONE:break;case a.atype.SCRIPT:x=null;f&&q(f,b,k,n,x);break;case a.atype.STYLE:if("undefined"===typeof U){x=null;f&&q(f,b,k,n,x);break}u=[];U(x,{declaration:function(a,b){var c=a.toLowerCase(),e=F[c];e&&(L(c,e,b,d),u.push(a+": "+b.join(" ")))}});
x=0<u.length?u.join(" ; "):null;f&&q(f,b,k,n,x);break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:x=e?e(x):x;f&&q(f,b,k,n,x);break;case a.atype.URI:x=p(x,d);f&&q(f,b,k,n,x);break;case a.atype.URI_FRAGMENT:x&&"#"===x.charAt(0)?(x=x.substring(1),x=e?e(x):x,null!==x&&void 0!==x&&(x="#"+x)):x=null;f&&q(f,b,k,n,x);break;default:x=null,f&&q(f,b,k,n,x)}else x=null,f&&q(f,b,k,n,x);c[m+1]=x}return c}function v(b,c,d){return function(e,
f){if(!(a.ELEMENTS[e]&a.eflags.UNSAFE))return u(e,f,b,c,d);d&&q(d,e,void 0,void 0,void 0)}}function y(a,b){var c=[];return n(b)(a,c),c.join("")}var z,x,B,A,D,E,G,C,F,I,H,P,J,O,Q,N,M,R,U,S,L,pa;"undefined"!==typeof window&&(U=window.parseCssDeclarations,L=window.sanitizeCssProperty,F=window.cssSchema);A={lt:"<",gt:">",amp:"&",nbsp:"\u00a0",quot:'"',apos:"'"};I=/^#(\d+)$/;O=/^#x([0-9A-Fa-f]+)$/;R=/\0/g;P=/\x26(#\d+|#x[0-9A-Fa-f]+|\w+);/g;G=/\x26/g;N=/\x26([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;
M=/[\x3c]/g;J=/\x3e/g;S=/\"/g;x=/^\s*([a-z][-\w]*)(?:\s*(=)\s*((")[^"]*("|$)|(')[^']*('|$)|(?=[a-z][-\w]*\s*=)|[^"'\s]*))?/i;D=/^(#[0-9]+|#x[0-9a-f]+|\w+);/i;pa=3==="a,b".split(/(,)/).length;B=a.eflags.CDATA|a.eflags.RCDATA;C={};H={};E=/^(?:([^:/?# ]+):)?/;z=/^(?:https?|mailto)$/i;return Q={},Q.escapeAttrib=Q.escapeAttrib=d,Q.makeHtmlSanitizer=Q.makeHtmlSanitizer=n,Q.makeSaxParser=Q.makeSaxParser=f,Q.makeTagPolicy=Q.makeTagPolicy=v,Q.normalizeRCData=Q.normalizeRCData=e,Q.sanitize=Q.sanitize=function(a,
b,c,d){b=v(b,c,d);return y(a,b)},Q.sanitizeAttribs=Q.sanitizeAttribs=u,Q.sanitizeWithPolicy=Q.sanitizeWithPolicy=y,Q.unescapeEntities=Q.unescapeEntities=c,Q}(html4);html_sanitize=html.sanitize;"undefined"!==typeof window&&(window.html=html,window.html_sanitize=html_sanitize);function clean(a){return a?html_sanitize(a,function(a){return a},function(a){return a}):a};function updateModel(){var a=getSetting();if(3>a.getAttribute("Version")){for(var b=primitives("Converter"),c=0;c<b.length;c++){for(var d=b[c].getAttribute("Inputs").split(","),e=b[c].getAttribute("Outputs").split(","),f="",g=0;g<d.length;g++)0<g&&(f+=";"),f=f+d[g]+","+e[g];b[c].setAttribute("Data",f)}a.setAttribute("Version",3)}4>a.getAttribute("Version")&&(a.setAttribute("SolutionAlgorithm","RK1"),a.setAttribute("Version",4));if(5>a.getAttribute("Version")){b=primitives("Stock");for(c=0;c<b.length;c++)b[c].setAttribute("NonNegative",
!1);a.setAttribute("Version",5)}if(6>a.getAttribute("Version")){b=primitives("Picture");for(c=0;c<b.length;c++)b[c].setAttribute("FlipHorizontal",!1),b[c].setAttribute("FlipVertical",!1);a.setAttribute("Version",6)}if(7>a.getAttribute("Version")){b=primitives("Link");for(c=0;c<b.length;c++)b[c].setAttribute("BiDirectional",!1);a.setAttribute("Version",7)}if(8>a.getAttribute("Version")){b=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"));for(c=0;c<b.length;c++)b[c].setAttribute("Image",
"None");b=primitives("Display");for(c=0;c<b.length;c++)b[c].setAttribute("Image","Display");a.setAttribute("Version",8)}9>a.getAttribute("Version")&&(a.setAttribute("BackgroundColor","white"),a.setAttribute("Version",9));if(10>a.getAttribute("Version")){b=primitives("Display");for(c=0;c<b.length;c++)b[c].setVisible(!1);a.setAttribute("Version",10);graph.refresh()}11>a.getAttribute("Version")&&(b=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"),primitives("Text")),graph instanceof
SimpleNode||graph.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,mxConstants.NONE,b),a.setAttribute("Version",11));if(12>a.getAttribute("Version")){b=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"));d=primitives("Picture");for(c=0;c<d.length;c++)d[c].setAttribute("LabelPosition","Bottom");for(c=0;c<b.length;c++)b[c].setAttribute("LabelPosition","Middle");a.setAttribute("Version",12)}if(13>a.getAttribute("Version")){b=primitives("Folder");for(c=0;c<b.length;c++)b[c].setAttribute("Image",
"None"),b[c].setAttribute("LabelPosition","Middle");a.setAttribute("Version",13)}if(14>a.getAttribute("Version")){b=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"),primitives("Folder"));for(c=0;c<b.length;c++)b[c].setAttribute("FlipHorizontal",!1),b[c].setAttribute("FlipVertical",!1);a.setAttribute("Version",14)}if(15>a.getAttribute("Version")){b=primitives("Button");for(c=0;c<b.length;c++)d=b[c].getAttribute("Function"),d=d.replace(/getName/g,"findName"),d=d.replace(/getType/g,
"findType"),d=d.replace(/getAll/g,"findAll"),b[c].setAttribute("Function",d);a.setAttribute("Version",15)}if(16>a.getAttribute("Version")){b=primitives("Parameter");for(c=0;c<b.length;c++)b[c].value=changeNodeName(b[c].value,"Variable");a.setAttribute("Version",16)}17>a.getAttribute("Version")&&(a.setAttribute("Throttle",-1),a.setAttribute("Version",17));if(18>a.getAttribute("Version")){b=primitives("Display");for(c=0;c<b.length;c++)b[c].setAttribute("yAxis2",""),b[c].setAttribute("Primitives2","");
a.setAttribute("Version",18)}19>a.getAttribute("Version")&&(a.setAttribute("Macros",""),a.setAttribute("Version",19));20>a.getAttribute("Version")&&(c=a.getAttribute("Units"),isDefined(c)&&a.setAttribute("Units",c.replace(/,/g,"*")),a.setAttribute("Version",20));if(21>a.getAttribute("Version")){b=primitives("Display");for(c=0;c<b.length;c++)"Scatterplot"==b[c].getAttribute("Type")?(b[c].setAttribute("showMarkers",!0),b[c].setAttribute("showLines",!1)):(b[c].setAttribute("showMarkers",!1),b[c].setAttribute("showLines",
!0));a.setAttribute("Version",21)}22>a.getAttribute("Version")&&(a.setAttribute("SensitivityPrimitives",""),a.setAttribute("SensitivityRuns",50),a.setAttribute("SensitivityBounds","50, 80, 95, 100"),a.setAttribute("SensitivityShowRuns","false"),a.setAttribute("Version",22));23>a.getAttribute("Version")&&(c=findValue([/\bmin\(\s*</i,/\bmax\(\s*</i,/\bmean\(\s*</i,/\bmedian\(\s*</i,/\bstddev\(\s*</i]),0<c.length&&window.Ext&&(b="<p>Insight Maker has received an update that removes the need for the <i>&lt;Primitive&gt;</i> notation. You may now use the <i>[Primitive]</i> in place of it.</p> <br/><p>A side effect of this update is that the usage of the Min(), Max(), Mean(), Median() and StdDev() statistical functions for aggregating over a primitive's history have been renamed to PastMin(), PastMax(), etc... (the usage of these function for values is unchanged; e.g. Max(1, 4, 2) is still correct).</p><br/><p>To correct this you need to change equations like:</p>",
b+="<br/><b>Max(&lt;x&gt;)</b></p>",b+="<br/>to</p>",b+="<br/><b>PastMax([x])</b></p>",b+="<br/><p>The following of your primitives appear to use these function and need to be updated to work correctly with this change. You can adjust their equations manually:</p>",b+="<br/><p><b>"+Ext.Array.map(c,function(a){return a.getAttribute("name")}).join(", ")+"</b></p>",Ext.Msg.show({icon:Ext.MessageBox.WARNING,title:"Model Update Required",msg:b,buttons:Ext.MessageBox.OK})),a.setAttribute("Version",23));
if(24>a.getAttribute("Version")){b=primitives("Folder");for(c=0;c<b.length;c++)b[c].setAttribute("Type","None");b=primitives("Display");for(c=0;c<b.length;c++)b[c].setAttribute("showArea",!1);b=primitives("Text");for(c=0;c<b.length;c++)b[c].setAttribute("LabelPosition","Middle");a.setAttribute("Version",24)}25>a.getAttribute("Version")&&(graph instanceof SimpleNode||setAllConnectable(),a.setAttribute("Version",25));if(26>a.getAttribute("Version")){b=primitives("Flow");for(c=0;c<b.length;c++)graph instanceof
SimpleNode||isTrue(b[c].getAttribute("OnlyPositive"))||(graph.setCellStyles(mxConstants.STYLE_STARTARROW,"block",[b[c]]),graph.setCellStyles("startFill",0,[b[c]]));a.setAttribute("Version",26)}if(27>a.getAttribute("Version")){b=primitives("Display");for(c=0;c<b.length;c++)b[c].setAttribute("legendPosition","Automatic");a.setAttribute("Version",27)}if(28>a.getAttribute("Version")){b=primitives();for(c=0;c<b.length;c++)"ShowSlider"in b[c]&&b[c].setAttribute("SliderStep","");a.setAttribute("Version",
28)}29>a.getAttribute("Version")&&(c=excludeType(findValue(/[A-Za-z0-9_]\s+\(/i),"Button"),window.Ext&&viewConfig.allowEdits&&0<c.length&&(b='<p>Insight Maker has received a significant update to its equation engine providing improved flexibility and power.</p><br/><p>A side effect of this update is that function names must now immediately be followed by a parenthesis. Thus, for instance, "Max&nbsp;&nbsp(1,2)" is no longer valid and needs to be replaced with  "Max(1,2)." This also improves the clarity and readability of equations.</p> ',
b+="<br/><p>The following of your primitives appear to use an unsupported format. Their equations will automatically be updated to use the correct format:</p>",b+="<br/><p><b>"+Ext.Array.map(c,function(a){return a.getAttribute("name")}).join(", ")+"</b></p>",b+="<br/><p>You may save your model to keep these updates.</p>",Ext.Msg.show({icon:Ext.MessageBox.WARNING,title:"Model Update Required",msg:b,buttons:Ext.MessageBox.OK})),0<c.length&&c.map(function(a){setValue(a,getValue(a).replace(/([A-Za-z0-9_])\s+\(/gi,
"$1("))}),a.setAttribute("Version",29));if(30>a.getAttribute("Version")){b=primitives("Folder");for(c=0;c<b.length;c++)b[c].setAttribute("Solver",defaultSolver);a.setAttribute("Version",30)}if(31>a.getAttribute("Version")){b=primitives("Agents");for(c=0;c<b.length;c++)b[c].setAttribute("ShowSlider",!1),b[c].setAttribute("SliderMax",100),b[c].setAttribute("SliderMin",0),b[c].setAttribute("SliderStep",1);a.setAttribute("Version",31)}if(32>a.getAttribute("Version")){b=primitives("Folder");for(c=0;c<
b.length;c++)b[c].setAttribute("AgentBase","");a.setAttribute("Version",32)}if(33>a.getAttribute("Version")){b=primitives("Action");for(c=0;c<b.length;c++)b[c].setAttribute("Repeat",!0),b[c].setAttribute("Recalculate",!0);b=primitives("Transition");for(c=0;c<b.length;c++)b[c].setAttribute("Repeat",!1),b[c].setAttribute("Recalculate",!0);b=primitives("State");for(c=0;c<b.length;c++)b[c].setAttribute("Residency","0");a.setAttribute("Version",33)}34>a.getAttribute("Version")&&(c=excludeType(findValue(/\[self\]/i),
"Button"),window.Ext&&viewConfig.allowEdits&&0<c.length&&(b='<p>Insight Maker has received a significant update to its equation engine improving Agent Based Modeling..</p><br/><p>A side effect of this update is that the "Self" agent must always be referred to using the variable syntax -- <i>Self</i> -- instead of the old primitive syntax -- <i>[Self]</i>.</p> ',b+="<br/><p>The following of your primitives appear to use the outdated format. Their equations will automatically be updated to use the correct format:</p>",
b+="<br/><p><b>"+Ext.Array.map(c,function(a){return a.getAttribute("name")}).join(", ")+"</b></p>",b+="<br/><p>You may save your model to keep these updates.</p>",Ext.Msg.show({icon:Ext.MessageBox.WARNING,title:"Model Update Required",msg:b,buttons:Ext.MessageBox.OK})),0<c.length&&c.map(function(a){setValue(a,getValue(a).replace(/\[Self\]/gi,"Self"))}),a.setAttribute("Version",34));35>a.getAttribute("Version")&&(a.setAttribute("article",'{"comments":true, "facebookUID": ""}'),a.setAttribute("Version",
35));36>a.getAttribute("Version")&&(a.setAttribute("StyleSheet","{}"),a.setAttribute("Version",36))};function sliderPrimitives(a){a=a?findType(a):primitives();for(var b=[],c=0;c<a.length;c++)isTrue(a[c].getAttribute("ShowSlider"))&&b.push(a[c]);return b}
function createSliders(a,b,c){function d(){var a=Ext.create("Ext.form.field.Number",{slider:m,width:60,decimalPrecision:k,ignoreChange:!1,hideTrigger:!0,keyNavEnabled:!1,selectOnFocus:!0,mouseWheelEnabled:!1,minValue:parseFloat(f[g].getAttribute("SliderMin")),maxValue:parseFloat(f[g].getAttribute("SliderMax")),listeners:{change:function(a,b,c){!a.ignoreChange&&a.validate()&&(a.ignoreChange=!0,b=parseFloat(a.getValue()),isNaN(b)||a.slider.setValue(b),a.ignoreChange=!1)}}});m.addListener("change",function(d,
e){d.confirming||(a.ignoreChange&&parseFloat(a.getValue())==parseFloat(e)||a.setRawValue(parseFloat(e)),getValue(d.sliderCell).trim()!=parseFloat(getValue(d.sliderCell).trim())?(d.confirming=!0,c(d,b,a,e)):b(d.sliderCell,parseFloat(e)))});var d=f[g].getAttribute("Note");isUndefined(d)&&(d="");var q=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},baseCls:"single-slider",margin:0,items:[]});q.add(Ext.create("Ext.Component",{html:"<big> "+f[g].getAttribute("name")+"</big>"+
(""==d?"":"<div style='font-size: 90%; margin-top: 3px; color: grey'>"+d+"</div>"),padding:"10px 3px 3px 3px"}));q.add(Ext.create("Ext.container.Container",{layout:{type:"hbox",align:"stretch"},margin:3,items:[m,a]}));e.add(q);l==parseFloat(l)&&a.setValue(parseFloat(getValue(f[g])))}var e=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},baseCls:"slider-holder",margin:"0px 4px 0px 4px"}),f=sliderPrimitives(a);sliders=[];for(var g=0;g<f.length;g++){var k=(a=parseFloat(f[g].getAttribute("SliderStep"))?
parseFloat(f[g].getAttribute("SliderStep")):void 0)?Math.ceil(-Math.log(a)/Math.log(10)):Math.floor(-(Math.log(Math.max(0.1,f[g].getAttribute("SliderMax")-f[g].getAttribute("SliderMin")))/Math.log(10)-4)),l=getValue(f[g]).trim(),k=Math.max(0,k),m=Ext.create("Ext.slider.Single",{flex:1,minValue:parseFloat(f[g].getAttribute("SliderMin")),sliderCell:f[g],value:parseFloat(l)==l?parseFloat(l):void 0,maxValue:parseFloat(f[g].getAttribute("SliderMax")),decimalPrecision:k,increment:a,margin:"0px 5px 0px 0px"});
sliders.push(m);d()}return e};Ext.onReady(function(){main()});require.config&&require.config({baseUrl:builder_path+"/resources"});function isLocalStorageNameSupported(){var a=window.sessionStorage;try{return a.setItem("testLocalStorage","1"),a.removeItem("testLocalStorage"),!0}catch(b){return!1}}isLocalStorageNameSupported()?Ext.state.Manager.setProvider(new Ext.state.LocalStorageProvider):Ext.state.Manager.setProvider(Ext.create("Ext.state.CookieProvider",{expires:new Date((new Date).getTime()+864E10)}));
Ext.override(Ext.form.HtmlEditor,{createLink:function(){var a=prompt(this.createLinkText,this.defaultLinkValue);if(a&&"http://"!=a){var b=this.win.getSelection();""==b&&(b=a);b='<a href="'+a+'" target="_blank">'+b+"</a>";if(Ext.isIE){if(range=this.getDoc().selection.createRange())range.pasteHTML(b),this.syncValue(),this.deferFocus()}else this.execCmd("InsertHTML",b),this.deferFocus()}}});
function renderTimeBut(a){var b=Ext.id();Ext.Function.defer(function(){(new Ext.Button({text:getText("Edit Time Settings"),padding:0,margin:0,handler:function(a,b){var e=JSON.parse(getSelected()[0].getAttribute("Solver"));e.cell=getSelected()[0];showTimeSettings(e)}})).render(b)},15);return'<div id="'+b+'" style="height:24px"></div>'}window.addEventListener("message",callAPI,!1);function callAPI(a){try{a.source.postMessage(eval(a.data),"*")}catch(b){}}
function isLocal(){return"localhost"==document.location.hostname||"insightmaker.test"==document.location.hostname}mxGraph.prototype.stopEditing=function(a){null!==this.cellEditor&&this.cellEditor.stopEditing(a)};mxObjectCodec.prototype.isExcluded=function(a,b,c,d){return b==mxObjectIdentity.FIELD_NAME||"origCache"==b||0<=mxUtils.indexOf(this.exclude,b)};
mxGraph.prototype.duplicateCells=function(a,b){a=null!=a?a:this.getSelectionCells();b=null!=b?b:!0;a=this.model.getTopmostCells(a);var c=this.getModel(),d=this.gridSize,e=[];c.beginUpdate();try{for(var f=0;f<a.length;f++){var g=c.getParent(a[f]),k=this.moveCells([a[f]],d,d,!0,g)[0];e.push(k);if(!b){var l=g.getIndex(a[f]);c.add(g,k,l+1)}}}finally{c.endUpdate()}return e};
var equationRenderer=function(a,b){var c;c=a.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");c=c.replace(/\[(.*?)\]/g,"<font color='Green'>[$1]</font>");c=c.replace(/(&lt;&lt;.*?&gt;&gt;)/g,"<font color='Orange'>$1</font>");c=c.replace(/(\u00ab.*?\u00bb)/g,"<font color='Orange'>$1</font>");c=c.replace(/\b([\d\.e]+)\b/g,"<font color='DeepSkyBlue'>$1</font>");c=c.replace(/(\{.*?\})/g,"<font color='Orange'>$1</font>");/\\n/.test(c)&&(!0===b?(c=c.replace(/\\n/g,"<br>"),c=c.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),
c=c.replace(/ /g,"&nbsp;")):c=c.match(/(.*?)\\n/)[1]+"...");return clean(c)};isLocal()||(window.onerror=function(a,b,c,d,e){if(!/removeChild/.test(a))return a=[a,b,c].join(" : "),_gaq.push(["_trackEvent","Errors","App",a,null,!0]),console.log(a),console.log(e),!0});try{var showNotification=function(a,b,c){$().toastmessage("showToast",{text:a,sticky:!c,type:b||"error"})};mxUtils.alert=showNotification}catch(err$$3){alert("Insight Maker failed to load all its resources. Check your network connection and try to reload Insight Maker.")}
var GraphEditor={},mainPanel,mxPanel,ribbonPanel,configPanel,sizeChanging,sliders=[],settingCell,selectionChanged,clipboardListener,undoHistory;
function main(){function a(a,b){"Folder"==a.cell.value.nodeName&&getFrozen(a.cell)&&b&&(a.style[mxConstants.STYLE_STROKECOLOR]="#05B8CC",a.style[mxConstants.STYLE_DASHED]=0)}Ext.QuickTips.init();mxConstants.DEFAULT_HOTSPOT=0.3;mxConstants.LINE_HEIGHT=1.15;graph=new mxGraph;undoHistory=new mxUndoManager;graph.alternateEdgeStyle="vertical";graph.connectableEdges=!0;graph.disconnectOnMove=!1;graph.edgeLabelsMovable=!0;graph.enterStopsCellEditing=!0;graph.allowLoops=!1;viewConfig.allowEdits&&(mxVertexHandler.prototype.rotationEnabled=
!0);mxVertexHandler.prototype.manageSizers=!0;mxVertexHandler.prototype.livePreview=!0;mxEvent.addMouseWheelListener(function(a,b){mxEvent.isControlDown(a)&&(b?graph.zoomIn():graph.zoomOut(),mxEvent.consume(a))});if(mxClient.IS_TOUCH||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints){mxGraph.prototype.collapsedImage=new mxImage(mxClient.imageBasePath+"/collapsed.gif",18,18);mxGraph.prototype.expandedImage=new mxImage(mxClient.imageBasePath+"/expanded.gif",18,18);mxShape.prototype.svgStrokeTolerance=
18;mxVertexHandler.prototype.tolerance=12;mxEdgeHandler.prototype.tolerance=12;mxGraph.prototype.tolerance=12;mxConstants.DEFAULT_HOTSPOT=0.5;mxConstants.HANDLE_SIZE=16;mxConstants.LABEL_HANDLE_SIZE=7;graph.addListener(mxEvent.TAP_AND_HOLD,function(a,b){var c=b.getProperty("event"),d=b.getProperty("cell");null!==d&&isValued(d)?showEditor(d):showContextMenu(null,c);b.consume()});mxPanningHandler.prototype.isPanningTrigger=function(a){var b=a.getEvent();return null==a.getState()&&!mxEvent.isMouseEvent(b)||
mxEvent.isPopupTrigger(b)&&(null==a.getState()||mxEvent.isControlDown(b)||mxEvent.isShiftDown(b))};var b=mxGraphHandler.prototype.mouseDown;mxGraphHandler.prototype.mouseDown=function(a,c){b.apply(this,arguments);this.graph.isCellSelected(c.getCell())&&1<this.graph.getSelectionCount()&&(this.delayedSelection=!1)};var c=mxGraph.prototype.dblClick;mxGraph.prototype.dblClick=function(a,b){if(null==b){var d=mxUtils.convertPoint(this.container,mxEvent.getClientX(a),mxEvent.getClientY(a));b=this.getCellAt(d.x,
d.y)}c.call(this,a,b)};var d=builder_path+"/images/touch-connector.png";(new Image).src=d;var e=mxVertexHandler.prototype.init;mxVertexHandler.prototype.init=function(){e.apply(this,arguments);this.graph.connectionHandler.isEnabled()&&this.graph.isCellConnectable(this.state.cell)&&1==this.graph.getSelectionCount()&&graph.connectionHandler.isConnectableCell(this.state.cell)&&(this.connectorImg=mxUtils.createImage(d),this.connectorImg.style.cursor="pointer",this.connectorImg.style.width="29px",this.connectorImg.style.height=
"29px",this.connectorImg.style.position="absolute",mxEvent.addGestureListeners(this.connectorImg,mxUtils.bind(this,function(a){this.graph.popupMenuHandler.hideMenu();this.graph.stopEditing(!1);var b=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(a),mxEvent.getClientY(a));this.graph.connectionHandler.start(this.state,b.x,b.y);this.graph.isMouseDown=!0;this.graph.isMouseTrigger=mxEvent.isMouseEvent(a);mxEvent.consume(a)})),this.graph.container.appendChild(this.connectorImg));this.redrawHandles()};
var f=mxVertexHandler.prototype.hideSizers;mxVertexHandler.prototype.hideSizers=function(){f.apply(this,arguments);null!=this.connectorImg&&(this.connectorImg.style.visibility="hidden")};var g=mxVertexHandler.prototype.reset;mxVertexHandler.prototype.reset=function(){g.apply(this,arguments);null!=this.connectorImg&&(this.connectorImg.style.visibility="")};var k=mxVertexHandler.prototype.redrawHandles;mxVertexHandler.prototype.redrawHandles=function(){k.apply(this);if(null!=this.state&&null!=this.connectorImg){var a=
new mxPoint,b=this.state;mxVertexHandler.prototype.singleSizer?(a.x=b.x+b.width-this.connectorImg.offsetWidth/2,a.y=b.y-this.connectorImg.offsetHeight/2):(a.x=b.x+b.width+mxConstants.HANDLE_SIZE/2+4+this.connectorImg.offsetWidth/2,a.y=b.y+b.height/2);var c=mxUtils.toRadians(mxUtils.getValue(b.style,mxConstants.STYLE_ROTATION,0));if(0!=c)var d=Math.cos(c),c=Math.sin(c),b=new mxPoint(b.getCenterX(),b.getCenterY()),a=mxUtils.getRotatedPoint(a,d,c,b);this.connectorImg.style.left=a.x-this.connectorImg.offsetWidth/
2+"px";this.connectorImg.style.top=a.y-this.connectorImg.offsetHeight/2+"px"}};var l=mxVertexHandler.prototype.destroy;mxVertexHandler.prototype.destroy=function(a,b){l.apply(this,arguments);null!=this.connectorImg&&(this.connectorImg.parentNode.removeChild(this.connectorImg),this.connectorImg=null)}}var m=new mxImage(builder_path+"/images/touch-handle.png",16,16);mxVertexHandler.prototype.handleImage=m;mxEdgeHandler.prototype.handleImage=m;mxOutline.prototype.sizerImage=m;(new Image).src=m.src;mxEdgeHandler.prototype.addEnabled=
!0;mxEdgeHandler.prototype.removeEnabled=!0;graph.isHtmlLabel=function(a){return null!=a&&null!=a.value&&"Display"!=a.value.nodeName};graph.isWrapping=graph.isHtmlLabel;graph.isCellLocked=function(a){return!viewConfig.allowEdits||0===getOpacity(a)};graph.allowButtonSelect=!1;graph.isCellSelectable=function(a){return"Setting"!=a.value.nodeName&&"Display"!=a.value.nodeName&&(graph.allowButtonSelect||"Button"!=a.value.nodeName&&0!==getOpacity(a))};graph.isCellEditable=function(a){return viewConfig.allowEdits?
"Display"!=a.value.nodeName&&"Setting"!=a.value.nodeName&&0!==getOpacity(a)&&"Ghost"!=a.value.nodeName&&("Button"!=a.value.nodeName||graph.isCellSelected(a)):!1};graph.getCursorForCell=function(a){if("Button"==a.value.nodeName)return"pointer"};graph.convertValueToString=function(a){return!mxUtils.isNode(a.value)||"Link"==a.value.nodeName&&"Link"==orig(a).getAttribute("name")?"":clean(orig(a).getAttribute("name"))};graph.labelChanged=function(a,b,c){if(validPrimitiveName(b,a))return c=a.getAttribute("name"),
graph.model.beginUpdate(),b=new mxCellAttributeChange(a,"name",b),graph.getModel().execute(b),selectionChanged(!1),propogateGhosts(a),propogateName(a,c),graph.model.endUpdate(),a};graph.getEditingValue=function(a){if(mxUtils.isNode(a.value))return a.getAttribute("name")};setupHoverIcons();mxPanel=Ext.create("Ext.Component",{border:!1,id:"mxPanelForModelGraph"});mainPanel=Ext.create("Ext.Panel",{region:"center",border:!1,layout:"fit",items:[mxPanel]});mainPanel.on("resize",function(){graph.sizeDidChange()});
configPanel=Ext.create("Ext.Panel",ConfigPanel());ribbonPanel=Ext.create("Ext.Panel",RibbonPanel(graph,mainPanel,configPanel));window.toNum=0;new Ext.Viewport({layout:"border",padding:viewConfig.showTopLinks?"22 0 0 0":0,id:"overall-viewport",items:[ribbonPanel,{xtype:"toolbar",region:"south",dock:"bottom",hidden:!1,id:"unfoldToolbar",layout:{align:"bottom"},items:[{glyph:61670,text:getText("View Story"),iconCls:"blue-icon",scope:this,id:"unfoldUnfoldBut",handler:function(){revealUnfoldButtons(!0);
beginUnfolding()}},{glyph:61508,text:getText("Edit Story"),scope:this,id:"editUnfoldBut",handler:showUnfoldingWin},{scale:"large",iconAlign:"top",glyph:61473,text:getText("Start Over"),scope:this,id:"reloadUnfoldBut",handler:function(){restartUnfolding()}},{hidden:is_ebook,scale:"large",iconAlign:"top",glyph:61532,iconCls:"red-icon",text:getText("Exit Story"),scope:this,id:"exitUnfoldBut",handler:function(){revealUnfoldButtons(!1);finishUnfolding()}},{html:"",id:"messageUnfoldBut",flex:1,xtype:"box",
style:{"font-size":"larger"},margin:"4 10 4 10",align:"middle",minHeight:64},{scale:"large",iconCls:"green-icon",iconAlign:"top",glyph:61752,text:getText("Step Forward"),scope:this,id:"nextUnfoldBut",handler:function(){doUnfoldStep()}}]}]});$(mxPanel.getEl().dom).on("touchstart tap  ",function(a){a.stopPropagation();document.activeElement&&document.activeElement.blur&&document.activeElement.blur()});graph.addListener(mxEvent.CELL_CONNECTED,function(a,b){var c=b.getProperty("edge");"Link"==c.value.nodeName&&
linkBroken(c)});graph.addListener(mxEvent.CELLS_FOLDED,function(a,b){b.properties.collapse||a.orderCells(!1,b.properties.cells)});mainPanel.getEl().insertHtml("beforeBegin","<div id='mainGraph'  style='z-index:1000;position:absolute; width:100%;height:100%;display:none;'></div>");mxEvent.disableContextMenu(mxPanel.getEl().dom);mxPanel.getEl().dom.style.overflow="auto";graph.model.styleForCellChanged=function(a,b){var c=mxGraphModel.prototype.styleForCellChanged(a,b);propogateGhosts(a);return c};graph.model.addListener(mxEvent.CHANGED,
function(a){setSaveEnabled(!0)});graph.model.addListener(mxEvent.CHANGE,function(a,b){var c=b.getProperty("changes");10>c.length&&c.animate&&mxEffects.animateChanges(graph,c)});graph.addListener(mxEvent.CELLS_REMOVED,function(a,b){for(var c=b.getProperty("cells"),d=0;d<c.length;d++)if(deletePrimitive(c[d]),"Folder"==c[d].value.nodeName){var e=childrenCells(c[d]);if(null!=e)for(var f=0;f<e.length;f++)deletePrimitive(e[f])}selectionChanged(!0)});graph.addListener(mxEvent.CLICK,function(a,b){var c=b.getProperty("cell");
b.getProperty("event");b.isConsumed()||null==c&&graph.clearSelection()});graph.init(mxPanel.getEl().dom);graph.setConnectable(viewConfig.allowEdits);graph.setDropEnabled(!0);graph.setSplitEnabled(!1);graph.connectionHandler.connectImage=new mxImage(builder_path+"/images/connector.gif",16,16);graph.connectionHandler.isConnectableCell=function(a){if(!a||0===getOpacity(a))return!1;var b=connectionType();if("Link"==a.value.nodeName||"None"==b)return!1;if("Link"==b)return!0;a=orig(a);return"Stock"==a.value.nodeName||
"State"==a.value.nodeName};graph.setPanning(!0);graph.setTooltips(!0);graph.connectionHandler.setCreateTarget(!1);new mxRubberband(graph);m=graph.getDefaultParent();graph.popupMenuHandler.factoryMethod=function(a,b,c){c.shiftKey||viewConfig.enableContextMenu&&showContextMenu(null,c)};graph.model.addListener(mxEvent.CHANGED,clearPrimitiveCache);settingCell=graph.insertVertex(m,null,primitiveBank.setting,20,20,80,40);settingCell.visible=!1;m=graph.insertVertex(m,null,primitiveBank.display.cloneNode(!0),
50,20,64,64,"roundImage;image="+builder_path+"/images/DisplayFull.png;");m.visible=!1;m.setAttribute("AutoAddPrimitives",!0);m.setAttribute("name",getText("Default Display"));graph.getEdgeValidationError=function(a,b,c){if(null!=a&&("Flow"==a.value.nodeName||"Transition"==a.value.nodeName)||null==this.model.getValue(a)&&"Flow"==connectionType){if(isDefined(b)&&null!==b&&b.isConnectable()&&!("Stock"==b.value.nodeName||"Ghost"==b.value.nodeName&&"Stock"==orig(b).value.nodeName||"State"==b.value.nodeName||
"Ghost"==b.value.nodeName&&"State"==orig(b).value.nodeName))return getText("You cannot make that connection.");if(isDefined(c)&&null!==c&&c.isConnectable()){if(!("Stock"==c.value.nodeName||"Ghost"==c.value.nodeName&&"Stock"==orig(c).value.nodeName||"State"==c.value.nodeName||"Ghost"==c.value.nodeName&&"State"==orig(c).value.nodeName))return getText("You cannot make that connection.");if(isDefined(b)&&null!==b&&b.isConnectable()&&orig(b).value.nodeName!=orig(c).value.nodeName)return getText("You cannot connect Stocks to Transitions.")}}if(null!=
a&&"Link"==a.value.nodeName||null==this.model.getValue(a)&&"Link"==connectionType())if(isDefined(b)&&null!==b&&"Link"==b.value.nodeName||isDefined(c)&&null!==c&&"Link"==c.value.nodeName)return getText("Links cannot be connected to links.");if("Link"!==connectionType()&&b&&c&&("Stock"==orig(b).value.nodeName||"State"==orig(b).value.nodeName)&&orig(b).value.nodeName!=orig(c).value.nodeName)return getText("You cannot connect a Stock to a State using a Flow or Transition.");if(a){if("Transition"==a.value.nodeName&&
(b&&"Stock"==orig(b).value.nodeName||c&&"Stock"==orig(c).value.nodeName))return getText("You cannot connect a Transition to a Stock.");if("Flow"==a.value.nodeName&&(b&&"State"==orig(b).value.nodeName||c&&"State"==orig(c).value.nodeName))return getText("You cannot connect a Flow to a State.")}return mxGraph.prototype.getEdgeValidationError.apply(this,arguments)};if(null!=graph_source_data&&0<graph_source_data.length||-1==drupal_node_ID)m=mxUtils.parseXml(-1==drupal_node_ID?blankGraphTemplate:graph_source_data),
(new mxCodec(m)).decode(m.documentElement,graph.getModel()),updateModel(),loadStyleSheet();loadBackgroundColor();viewConfig.saveEnabled&&(m=new mxAutoSaveManager(graph),m.autoSaveThreshold=0,m.autoSaveDelay=0,m.autoSaveThrottle=0,m.save=function(){""!=graph_title&&saveModel()});m=function(a,b){undoHistory.undoableEditHappened(b.getProperty("edit"))};graph.getModel().addListener(mxEvent.UNDO,m);graph.getView().addListener(mxEvent.UNDO,m);graph.addListener(mxEvent.CELLS_FOLDED,function(a,b){for(var c=
b.properties.cells,d=0;d<c.length;d++)setPicture(c[d]),setLabelPosition(c[d])});var n=ribbonPanelItems(),m=function(){var a=!graph.isSelectionEmpty();a&&document.activeElement&&document.activeElement.blur&&document.activeElement.blur();var b=a&&(1==graph.getSelectionCount()?"Ghost"!=graph.getSelectionCell().value.nodeName:!0);n.down("#folder").setDisabled(0>=graph.getSelectionCount());n.down("#ghostBut").setDisabled(1!=graph.getSelectionCount()||!isValued(graph.getSelectionCell())&&"Picture"!=graph.getSelectionCell().value.nodeName&&
"Agents"!=graph.getSelectionCell().value.nodeName||"Flow"==graph.getSelectionCell().value.nodeName||"Transition"==graph.getSelectionCell().value.nodeName||"Ghost"==graph.getSelectionCell().value.nodeName);n.down("#cut").setDisabled(!a);n.down("#copy").setDisabled(!a);n.down("#delete").setDisabled(!a);n.down("#fillcolor").setDisabled(!(!a||b));n.down("#fontcolor").setDisabled(!b);n.down("#linecolor").setDisabled(!b);n.down("#bold").setDisabled(!b);n.down("#italic").setDisabled(!b);n.down("#underline").setDisabled(!b);
n.down("#fontCombo").setDisabled(!b);n.down("#sizeCombo").setDisabled(!b);n.down("#align").setDisabled(!b);n.down("#movemenu").setDisabled(!a);n.down("#picturemenu").setDisabled(!a);n.down("#useAsDefaultStyle").setDisabled(!b);n.down("#reverse").setDisabled(!(a&&(cellsContainNodename(graph.getSelectionCells(),"Link")||cellsContainNodename(graph.getSelectionCells(),"Flow")||cellsContainNodename(graph.getSelectionCells(),"Transition"))));setStyles()};graph.getSelectionModel().addListener(mxEvent.CHANGED,
m);clipboardListener=function(){n.down("#paste").setDisabled(mxClipboard.isEmpty())};clipboardListener();var p=function(){n.down("#undo").setDisabled(!undoHistory.canUndo());n.down("#redo").setDisabled(!undoHistory.canRedo())};undoHistory.addListener(mxEvent.ADD,p);undoHistory.addListener(mxEvent.UNDO,p);undoHistory.addListener(mxEvent.REDO,p);m();p();var q=graph.createGroupCell;graph.createGroupCell=function(){var a=q.apply(this,arguments);a.setStyle("folder");a.setValue(primitiveBank.folder.cloneNode(!0));
return a};graph.connectionHandler.factoryMethod=function(a,b){var c,d;"Link"==connectionType()?(c="link",d=primitiveBank.link.cloneNode(!0)):null!=a&&"Stock"==a.value.nodeName||null!=b&&"Stock"==b.value.nodeName?(c="flow",d=primitiveBank.flow.cloneNode(!0)):(c="transition",d=primitiveBank.transition.cloneNode(!0));c=new mxCell(d,new mxGeometry(0,0,100,100),c);c.geometry.setTerminalPoint(new mxPoint(0,100),!0);c.geometry.setTerminalPoint(new mxPoint(100,0),!1);c.edge=!0;c.connectable=!0;return c};
graph.getTooltipForCell=function(a){if(linkedResults&&null!=a){for(var b=linkedResults.displayInformation,c=[],d=[],e=0,f=0;f<b.ids.length;f++)if(a.id==b.ids[f]){var g=b.elementIds[f];d.push(g);var k=null;isGray(b.colors[f])?(k=defaultColors[e],e++,e%=defaultColors.length):k=b.colors[f];c.push({type:"line",axis:"left",xField:"Time",yField:g,title:b.headers[f],showMarkers:!1,colors:[k],smooth:!1,style:{"stroke-width":3}})}return 0==d.length?void 0:{flex:1,width:200,height:160,animation:!1,shadow:!1,
store:b.store,axes:[{type:"numeric",position:"left",fields:d,grid:!0,titleMargin:0,renderer:commaStr,label:{fontSize:"11px"}},{type:"numeric",position:"bottom",fields:"Time",minimum:b.store.min("Time"),maximum:b.store.max("Time"),grid:!0,titleMargin:0,renderer:function(a){return round(a,9)},label:{fontSize:"11px"}}],series:c}}return""};var u=new Ext.ToolTip({html:"",hideDelay:0,dismissDelay:0,showDelay:0});graph.tooltipHandler.show=function(a,b,c){null!=a&&""!=a.length?(u.items.each(function(a){this.remove(a)},
u),u.add(Ext.create("Ext.chart.CartesianChart",a)),u.showAt([b,c+mxConstants.TOOLTIP_VERTICAL_OFFSET])):u.hide()};graph.tooltipHandler.hide=function(){u.hide()};graph.tooltipHandler.hideTooltip=function(){u.hide()};mxGraphHandler.prototype.guidesEnabled=!0;mxGraphHandler.prototype.mouseDown=function(a,b){if(!b.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null!=b.getState()){var c=this.getInitialCellForEvent(b);if(null!==c&&"Button"==c.value.nodeName&&!graph.getSelectionModel().isSelected(c)){if(!1==
b.evt.shiftKey)return pressButton(c),b.consume(),graph.allowButtonSelect=!1;graph.allowButtonSelect=!0}this.delayedSelection=this.isDelayedSelection(c);this.cell=null;this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(c,b.getEvent());if(this.isMoveEnabled()){var d=this.graph.model,e=d.getGeometry(c);this.graph.isCellMovable(c)&&(!d.isEdge(c)||1<this.graph.getSelectionCount()||null!=e.points&&0<e.points.length||null==d.getTerminal(c,!0)||null==d.getTerminal(c,!1)||this.graph.allowDanglingEdges||
this.graph.isCloneEvent(b.getEvent())&&this.graph.isCellsCloneable())&&this.start(c,b.getX(),b.getY());this.cellWasClicked=!0;!mxClient.IS_SF&&!mxClient.IS_GC||"SELECT"!=b.getSource().nodeName?b.consume():mxClient.IS_SF&&"SELECT"==b.getSource().nodeName&&(this.cellWasClicked=!1,this.first=null)}}};mxGuide.prototype.isEnabledForEvent=function(a){return!mxEvent.isAltDown(a)};m=function(a,b){var c=b.getProperty("edit").changes;graph.setSelectionCells(graph.getSelectionCellsForChanges(c))};undoHistory.addListener(mxEvent.UNDO,
m);undoHistory.addListener(mxEvent.REDO,m);viewConfig.focusDiagram&&graph.container.focus();setTopLinks();is_topBar||toggleTopBar();is_sideBar||configPanel.collapse(Ext.Component.DIRECTION_RIGHT,!1);mxKeyHandler.prototype.isGraphEvent=function(a){if(a.altKey||a.shiftKey)return!1;a=Ext.WindowManager.getActive();if(isDefined(a)&&null!==a&&(a.modal||"unfold-window"==a.getId()))return!1;a=Ext.get(Ext.Element.getActiveElement());return a.hasCls&&a.hasCls("x-form-field")?!1:!a||!a.component||"x-container"==
a.component.componentCls||"x-window"==a.component.componentCls||"x-panel"==a.component.componentCls||"x-panel-header"==a.component.componentCls||"x-window-header"==a.component.componentCls||"x-btn-group"==a.component.componentCls||"x-form-field"==a.component.componentCls};m=new mxKeyHandler(graph);m.getFunction=function(a){return null!=a?mxEvent.isControlDown(a)||mxClient.IS_MAC&&a.metaKey?this.controlKeys[a.keyCode]:this.normalKeys[a.keyCode]:null};m.bindKey(13,function(){graph.foldCells(!1)});m.bindControlKey(65,
function(){graph.selectAll()});m.bindControlKey(68,function(){graph.setSelectionCells(graph.duplicateCells())});m.bindControlKey(66,function(){viewConfig.allowEdits&&(graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD,excludeType(graph.getSelectionCells(),"Ghost")),setStyles())});m.bindControlKey(73,function(){viewConfig.allowEdits&&(graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC,excludeType(graph.getSelectionCells(),"Ghost")),setStyles())});
m.bindControlKey(85,function(){viewConfig.allowEdits&&(graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE,excludeType(graph.getSelectionCells(),"Ghost")),setStyles())});m.bindControlKey(89,function(){undoHistory.redo()});m.bindControlKey(90,function(){undoHistory.undo()});m.bindControlKey(67,function(){mxClipboard.copy(graph);clipboardListener()});m.bindControlKey(13,function(){runModel()});m.bindControlKey(75,function(){scratchpadFn()});m.bindControlKey(191,function(){Ext.getCmp("unfoldToolbar").isHidden()||
Ext.getCmp("nextUnfoldBut").isHidden||Ext.getCmp("nextUnfoldBut").isDisabled()||doUnfoldStep()});viewConfig.allowEdits&&(m.bindKey(8,function(){graph.removeCells(graph.getSelectionCells(),!1)}),m.bindKey(46,function(){graph.removeCells(graph.getSelectionCells(),!1)}),m.bindControlKey(88,function(){mxClipboard.cut(graph);clipboardListener()}),m.bindControlKey(83,function(){saveModel()}),m.bindControlKey(86,function(){mxClipboard.paste(graph);clipboardListener()}),m.bindControlKey(190,function(){var a=
graph.getSelectionCell();isDefined(a)&&null!=a&&(new RichTextWindow({parent:"",cell:a,html:getNote(a)})).show()}));m.bindControlKey(69,function(){doSensitivity()});m.bindControlKey(76,function(){timeSettingsFn()});m.bindControlKey(70,function(){showFindAndReplace()});m.bindControlKey(71,function(){var a=Ext.getCmp("findNextBut");a&&!a.disabled&&findNext()});m.bindControlKey(80,printGraph);graph.getSelectionModel().addListener(mxEvent.CHANGE,function(a,b){selectionChanged(!1)});var v=function(a){a=
a.split(",");var b=primitives();if(null!=b)for(var c=0;c<b.length;c++)-1<Ext.Array.indexOf(a,b[c].id)&&(a[Ext.Array.indexOf(a,b[c].id)]=b[c].getAttribute("name"));return a.join(", ")};selectionChanged=function(a){function b(a,c){return"<a href='"+a+"' class='description_link' target='_blank'>Learn more about "+c+"&nbsp;&rsaquo;</a><div style='clear:both'></div>"}isDefined(grid)&&(grid.plugins[0].completeEdit(),configPanel.removeAll());var c=graph.getSelectionCell();a&&(c=null);a=[];var d=[],e=[],
f;null!=c&&(f=c.value.nodeName);null!=c&&1==graph.getSelectionCells().length&&"Ghost"!=f?(configPanel.setTitle(getText(f)),e=[{name:"Note",text:getText("Note"),value:c.getAttribute("Note"),group:"  "+getText("General"),editor:new RichTextEditor({})},{name:"name",text:getText("(name)"),value:c.getAttribute("name"),group:"  "+getText("General")}],!isValued(c)&&"Agents"!=c.value.nodeName||"State"==c.value.nodeName||"Action"==c.value.nodeName||(viewConfig.allowEdits&&"Converter"!=c.value.nodeName&&(e.push({name:"ShowSlider",
text:getText("Show Value Slider"),value:isTrue(c.getAttribute("ShowSlider")),group:getText("Slider")}),e.push({name:"SliderMax",text:getText("Slider Max"),value:parseFloat(c.getAttribute("SliderMax")),group:getText("Slider"),editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}}),e.push({name:"SliderMin",text:getText("Slider Min"),value:parseFloat(c.getAttribute("SliderMin")),group:getText("Slider"),editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}}),e.push({name:"SliderStep",
text:getText("Slider Step"),value:c.getAttribute("SliderStep"),group:getText("Slider"),editor:{xtype:"numberfield",minValue:0,allowDecimals:!0,decimalPrecision:9}})),"Transition"!=c.value.nodeName&&"Agents"!=c.value.nodeName&&e.push({name:"Units",text:getText("Units"),value:c.getAttribute("Units"),group:getText("Validation"),editor:new UnitsEditor({})}),viewConfig.allowEdits&&"Agents"!=c.value.nodeName&&(e.push({name:"MaxConstraintUsed",text:getText("Max Constraint"),value:isTrue(c.getAttribute("MaxConstraintUsed")),
group:getText("Validation")}),e.push({name:"MaxConstraint",text:getText("Max Constraint"),value:parseFloat(c.getAttribute("MaxConstraint")),group:getText("Validation"),editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}}),e.push({name:"MinConstraintUsed",text:getText("Min Constraint"),value:isTrue(c.getAttribute("MinConstraintUsed")),group:getText("Validation")}),e.push({name:"MinConstraint",text:getText("Min Constraint"),value:parseFloat(c.getAttribute("MinConstraint")),group:getText("Validation"),
editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}})))):configPanel.setTitle("");var g="",k="";if(null==c||1<graph.getSelectionCells().length)if(f=sliderPrimitives(),-1==drupal_node_ID&&0==f.length)g=is_ebook?"<center><big>Select a primitive to see its properties.</big></center>":"<center><a href='https://www.youtube.com/watch?v=zskFaBZt3HA' target='_blank'><img src='"+builder_path+"/images/Help.jpg' width=217 height=164 /><br><big>Watch this short video &rsaquo; </big></a><br/><br/><br/>Or take a look at the <a href='http://InsightMaker.com/help' target='_blank'>Detailed Insight Maker Manual</a><br/><br/>There is also a <a href='https://kumu.io/stw/insight-maker' target='_blank'>free, on-line education course</a> which teaches you how to think in a systems manner using Insight Maker.</center>";
else{g=clean(graph_description);""==g&&-1!=drupal_node_ID&&viewConfig.saveEnabled&&(g="<span style='color: #555'>"+getText("You haven't entered a description for this Insight yet. Please enter one to help others understand it.")+"</span>");""!=g&&(g="<div class='sidebar_description'>"+g+"</div>");-1!=drupal_node_ID&&null==c&&(g=g+' <div class="sidebar_share"> <div class="addthis_sharing_toolbox addthis_default_style" style="display:inline-block"><a class="addthis_button_preferred_1"></a> <a class="addthis_button_preferred_2"></a>  <a class="addthis_button_preferred_3"></a>  <a class="addthis_button_preferred_4"></a> <a class="addthis_button_compact"></a></div> </div>'+
(is_editor?'<div class="sidebar_edit"><a href="#" onclick="blockUnfold(updateProperties)()"><i class="fa fa-pencil-square"></i> '+getText("Edit Info")+"</a></div>":""));if(""!=graph_tags.trim())var l=graph_tags.split(",").map(function(a){a=a.trim();return"<a target='_blank' href='/tag/"+clean(a.replace(/ /g,"-"))+"'>"+clean(a)+"</a>"}).join(", "),g=g+"<div class='sidebar_tags'>Tags: "+l+"</div>";is_editor||""==graph_author_name||(g=g+"<div class='sidebar_author'>Insight Author: <a target='_blank' href='/user/"+
clean(graph_author_id)+"'>"+clean(graph_author_name)+"</a></div>");0<f.length&&a.push(createSliders(!1,function(a,b){setValue(a,b);linkedResults&&runModel({onPause:function(a){a.resume()},onSuccess:function(a){},resultsWindow:linkedResults})},function(a,b,c,d){Ext.Msg.confirm("Change Value","<p>The current value of the primitive is:</p><br/><p><pre>"+getValue(a.sliderCell).replace(/\\n/g,"\n")+"</pre></p><br/><p>Are you sure you want to change this value using the slider?</p>",function(e){"yes"==
e?b(a.sliderCell,parseFloat(d)):(c.setRawValue(""),a.setValue(void 0));a.confirming=!1})}));a.push({xtype:"component",height:0,margin:"100 0 0 0"})}else if("Stock"==f)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>A stock stores a material or a resource. Lakes and Bank Accounts are both examples of stocks. One stores water while the other stores money. The Initial Value defines how much material is initially in the Stock. "+
b("/stocks","Stocks"),e.push({name:"InitialValue",text:getText("Initial Value")+" =",value:c.getAttribute("InitialValue"),group:" "+getText("Configuration"),editor:new EquationEditor({}),renderer:equationRenderer}),e.push({name:"AllowNegatives",text:getText("Allow Negatives"),value:!isTrue(c.getAttribute("NonNegative")),group:" "+getText("Configuration")}),e.push({name:"StockMode",text:getText("Stock Type"),value:c.getAttribute("StockMode"),group:getText("Behavior"),editor:new Ext.form.ComboBox({triggerAction:"all",
store:[["Store",getText("Store")],["Conveyor",getText("Conveyor")]],selectOnFocus:!1,editable:!1})}),e.push({name:"Delay",text:getText("Delay"),value:isDefined(c.getAttribute("Delay"))?c.getAttribute("Delay").toString():"",group:getText("Behavior"),renderer:equationRenderer});else if("Variable"==f)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>A variable is a dynamically updated object in your model that synthesizes available data or provides a constant value for use in your equations. The birth rate of a population or the maximum volume of water in a lake are both possible uses of variables."+
b("/variables","Variables"),e.push({name:"Equation",text:getText("Value/Equation")+" =",value:c.getAttribute("Equation"),group:" "+getText("Configuration"),editor:new EquationEditor({}),renderer:equationRenderer});else if("Link"==c.value.nodeName)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>Links connect the different parts of your model. If one primitive in your model refers to another in its equation, the two primitives must either be directly connected or connected through a link. Once connected with links, square-brackets may be used to reference values of other primitives. So if you have a stock called <i>Bank Balance</i>, you could refer to it in another primitive's equation with <i>[Bank Balance]</i>."+
b("/links","Links"),e.push({name:"BiDirectional",text:getText("Bi-Directional"),value:isTrue(c.getAttribute("BiDirectional")),group:" "+getText("Configuration")});else if("Folder"==c.value.nodeName)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>Folders group together similar items in a logical way. You can collapse and expand folders to hide or reveal model complexity.",e.push({name:"Type",text:getText("Behavior"),
value:c.getAttribute("Type"),group:getText("Agents"),editor:new Ext.form.ComboBox({triggerAction:"all",store:[["None",getText("None")],["Agent",getText("Agent")]],editable:!1,selectOnFocus:!1})}),e.push({name:"Solver",text:getText("Time Settings"),value:c.getAttribute("Equation"),group:" "+getText("Configuration"),renderer:renderTimeBut}),e.push({name:"Frozen",text:getText("Frozen"),value:isTrue(c.getAttribute("Frozen")),group:" "+getText("Configuration")}),e.push({name:"AgentBase",text:getText("Agent Parent"),
value:c.getAttribute("AgentBase"),group:getText("Agents"),editor:new EquationEditor({help:"This equation should return an object that will be the parent class for the agent. This object can be used to augment the functionality of the agent with programmatic code."}),renderer:equationRenderer});else if("Button"==c.value.nodeName)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>Buttons are used for interactivity. To select a button without triggering its action, hold down the Shift key when you click the button. Buttons are currently in Beta and their implementation may change in later versions of Insight Maker. Available button API commands are <a href='http://insightmaker.com/sites/default/files/API/' target='_blank'>available here</a>."+
b("/scripting","Model Scripting"),e.push({name:"Function",text:getText("Action"),value:c.getAttribute("Function"),group:" "+getText("Configuration"),editor:new JavaScriptEditor({})});else if("Flow"==c.value.nodeName)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>Flows represent the transfer of material from one stock to another. For example given the case of a lake, the flows for the lake might be: River Inflow, River Outflow, Precipitation, and Evaporation. Flows are given a flow rate and they operator over one unit of time; in effect: flow per one second or per one minute."+
b("/flows","Flows"),e.push({name:"FlowRate",text:getText("Flow Rate")+" =",value:c.getAttribute("FlowRate"),group:" "+getText("Configuration"),editor:new EquationEditor({}),renderer:equationRenderer}),e.push({name:"OnlyPositive",text:getText("Only Positive Rates"),value:isTrue(c.getAttribute("OnlyPositive")),group:" "+getText("Configuration")});else if("Transition"==c.value.nodeName)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>Transitions move agents between states. You can have transitions trigger based on some condition, a probability, or a timeout."+
b("/transitions","Transitions"),e.push({name:"Trigger",text:getText("Triggered by"),value:c.getAttribute("Trigger"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:["Timeout","Probability","Condition"],editable:!1,selectOnFocus:!1})}),e.push({name:"Value",text:getText("Value")+" =",value:c.getAttribute("Value"),group:" "+getText("Configuration"),editor:new EquationEditor({}),renderer:equationRenderer}),e.push({name:"Repeat",text:getText("Repeat"),value:isTrue(c.getAttribute("Repeat")),
group:" "+getText("Configuration")}),e.push({name:"Recalculate",text:getText("Recalculate"),value:isTrue(c.getAttribute("Recalculate")),group:" "+getText("Configuration")});else if("Action"==c.value.nodeName)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>Action primitives can be used to execute some action such as moving agents or dynamically create connections between them."+b("/actions","Actions"),e.push({name:"Trigger",
text:getText("Triggered by"),value:c.getAttribute("Trigger"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:["Timeout","Probability","Condition"],editable:!1,selectOnFocus:!1})}),e.push({name:"Value",text:getText("Trigger Value")+" =",value:c.getAttribute("Value"),group:" "+getText("Configuration"),editor:new EquationEditor({help:function(a){a=a.cell;if("Probability"==a.getAttribute("Trigger"))return"You have selected the <i>Probability</i> trigger for this action. The value of this equation is the probability of the action happening each unit of time. You can change the trigger type.";
if("Condition"==a.getAttribute("Trigger"))return"You have selected the <i>Condition</i> trigger for this action. When the equation evaluates to <tt>True</tt>, the action will happen. You can change the trigger type.";if("Timeout"==a.getAttribute("Trigger"))return"You have selected the <i>Timeout</i> trigger for this action. The action will happen after the time specified by this equation passes. You can change the trigger type."}}),renderer:equationRenderer}),e.push({name:"Action",text:getText("Action")+
" =",value:c.getAttribute("Action"),group:" "+getText("Configuration"),editor:new EquationEditor({}),renderer:equationRenderer}),e.push({name:"Repeat",text:getText("Repeat"),value:isTrue(c.getAttribute("Repeat")),group:" "+getText("Configuration")}),e.push({name:"Recalculate",text:getText("Recalculate"),value:isTrue(c.getAttribute("Recalculate")),group:" "+getText("Configuration")});else if("State"==c.value.nodeName)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>The primitive representing the current state of an agent. A boolean yes/no property. You can connect states with transitions to move an agent between states."+
b("/states","States"),e.push({name:"Active",text:getText("Start Active")+" = ",value:c.getAttribute("Active"),group:" "+getText("Configuration"),editor:new EquationEditor({}),renderer:equationRenderer}),e.push({name:"Residency",text:getText("Residency")+" = ",value:c.getAttribute("Residency"),group:" "+getText("Configuration"),editor:new EquationEditor({help:"A length of time the state will remain active even if a transition wants to deactivate it."}),renderer:equationRenderer});else if("Agents"==
c.value.nodeName){k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>Agent populations hold a collection of agents: individually simulated entities which may interact with each other."+b("/agentpopulations","Agent Populations");f=[];for(var m=primitives("Folder"),l=0;l<m.length;l++)"Agent"==m[l].getAttribute("Type")&&f.push([m[l].id,clean(m[l].getAttribute("name"))]);f=new Ext.data.ArrayStore({fields:["myId","displayText"],
data:f});e.push({name:"Agent",text:getText("Agent Base"),value:c.getAttribute("Agent"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",store:f,selectOnFocus:!1,valueField:"myId",editable:!1,displayField:"displayText"}),renderer:v});e.push({name:"Size",text:getText("Population Size"),value:c.getAttribute("Size"),group:" "+getText("Configuration"),editor:{xtype:"numberfield",minValue:0,allowDecimals:!1}});e.push({name:"GeoWidth",text:getText("Width"),
value:c.getAttribute("GeoWidth"),group:" "+getText("Geometry"),editor:new EquationEditor({help:"The width of the two-dimensional spatial geography for the population."}),renderer:equationRenderer});e.push({name:"GeoHeight",text:getText("Height"),value:c.getAttribute("GeoHeight"),group:" "+getText("Geometry"),editor:new EquationEditor({help:"The height of the two-dimensional spatial geography for the population."}),renderer:equationRenderer});e.push({name:"GeoDimUnits",text:getText("Dimension Units"),
value:c.getAttribute("GeoDimUnits"),group:" "+getText("Geometry"),editor:new UnitsEditor({})});e.push({name:"GeoWrap",text:getText("Wrap Around"),value:isTrue(c.getAttribute("GeoWrap")),group:" "+getText("Geometry")});e.push({name:"Placement",text:getText("Placement Method"),value:c.getAttribute("Placement"),group:" "+getText("Geometry"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",selectOnFocus:!1,editable:!1,store:[["Random",getText("Random")],["Grid",getText("Grid")],["Ellipse",
getText("Ellipse")],["Network",getText("Network")],["Custom Function",getText("Custom Function")]]}),renderer:v});e.push({name:"PlacementFunction",text:getText("Custom Function"),value:c.getAttribute("PlacementFunction"),group:" "+getText("Geometry"),editor:new EquationEditor({help:"This equation is evaluated once for each agent. It should return a two element vector representing the initial position with the form <tt>{x, y}</tt>."}),renderer:equationRenderer});e.push({name:"Network",text:getText("Network Structure"),
value:c.getAttribute("Network"),group:" "+getText("Network"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",selectOnFocus:!1,editable:!1,store:[["None",getText("None")],["Custom Function",getText("Custom Function")]]})});e.push({name:"NetworkFunction",text:getText("Custom Function"),value:c.getAttribute("NetworkFunction"),group:" "+getText("Network"),editor:new EquationEditor({help:"This equation is evaluated once for each pair of agents at the start of the simulation. The two agents can be referenced in the equation using the variables <tt>a</tt> and <tt>b</tt>. The agents are connected if the equation evaluates to <tt>True</tt>."}),
renderer:equationRenderer})}else if("Ghost"==f)k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>This item is a 'Ghost' of another primitive. It mirrors the values and properties of its source primitive. You cannot edit the properties of the Ghost. You need to instead edit the properties of its source.<center style='padding-top: 6px'><a href='#' onclick='var x = findID(getSelected()[0].getAttribute(\"Source\"));highlight(x);'>Show Source <i class='fa fa-angle-right '></i></a></center>"+
b("/ghosting","Ghosts");else if("Converter"==f){k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>Converters store a table of input and output data. When the input source takes on one of the input values, the converter takes on the corresponding output value. If no specific input value exists for the current input source value, then the nearest input neighbors are averaged. "+b("/converters","Converters");m=neighborhood(c);
f=[["Time","Time"]];for(l=0;l<m.length;l++)m[l].linkHidden||f.push([m[l].item.id,clean(m[l].item.getAttribute("name"))]);f=new Ext.data.ArrayStore({fields:["myId","displayText"],data:f});e.push({name:"Source",text:getText("Input Source"),value:c.getAttribute("Source"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",store:f,selectOnFocus:!1,valueField:"myId",editable:!1,displayField:"displayText"}),renderer:v});e.push({name:"Data",text:getText("Data"),
value:c.getAttribute("Data"),group:getText("Input/Output Table"),editor:new ConverterEditor({})});e.push({name:"Interpolation",text:getText("Interpolation"),value:c.getAttribute("Interpolation"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:[["None",getText("None")],["Linear",getText("Linear")]],editable:!1,selectOnFocus:!1})})}else"Picture"==f&&(k="<br/><div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div>Pictures can make your model diagram come alive. Use the picture settings in the Style menu of the main toolbar to change the picture."+
b("/diagramming","Modeling Diagramming"));configPanel.removeAll();""!=g&&d.push(Ext.create("Ext.Component",{html:'<div class="'+(-1==drupal_node_ID?"":"sidebar_top")+'">'+g+"</div>"}));""!=k&&a.push(Ext.create("Ext.Component",{html:'<div class="sidebar_bottom">'+k+"</div>"}));createGrid(e,d,a,c);if(-1!=drupal_node_ID)try{addthis.toolbox(".addthis_sharing_toolbox")}catch(n){}};selectionChanged(!1);-1==drupal_node_ID?setSaveEnabled(!0):setSaveEnabled(!1);updateWindowTitle();handelCursors();handleUnfoldToolbar();
is_embed&&1==is_zoom&&(graph.getView().setScale(0.25),graph.fit(),graph.fit());var y=function(a){getID(a)&&a.setAttribute("oldId",getID(a));"Folder"==getType(a)&&getChildren(a,!1).forEach(y)};graph.cloneCells=function(a){a.forEach(y);return mxGraph.prototype.cloneCells.apply(graph,arguments)};graph.importCells=function(a){function b(a){for(var d=c.slice(),e=0;e<c.length;e++)"Folder"==getType(c[e])&&(d=d.concat(getChildren(c[e])));for(e=0;e<d.length;e++)if(d[e].getAttribute("oldId")==a)return d[e];
return findID(a)}a.forEach(y);var c=mxGraph.prototype.importCells.apply(graph,arguments),d=function(a){if(void 0!=a.getAttribute("oldId")&&"undefined"!=a.getAttribute("oldId"))if("Converter"==a.value.nodeName){var c=a.getAttribute("Source");"*"!=c[0]&&"Time"!=c&&a.setAttribute("Source",b(c).id)}else"Agents"==a.value.nodeName?a.setAttribute("Agent",b(a.getAttribute("Agent")).id):"Ghost"==a.value.nodeName&&a.setAttribute("Source",b(a.getAttribute("Source")).id);"Folder"==getType(a)&&getChildren(a,!1).forEach(d)};
c.forEach(d);c.forEach(y);return c};graph.addMouseListener({currentState:null,previousStyle:null,mouseMove:function(a,b){if(null==this.currentState||b.getState()!=this.currentState){var c=graph.view.getState(b.getCell());if(graph.isMouseDown||null!=c&&"Folder"!=c.cell.value.nodeName)c=null;c!=this.currentState&&(null!=this.currentState&&this.dragLeave(b.getEvent(),this.currentState),this.currentState=c,null!=this.currentState&&this.dragEnter(b.getEvent(),this.currentState))}},dragEnter:function(b,
c){null!=c&&(this.previousStyle=c.style,c.style=mxUtils.clone(c.style),a(c,!0),c.shape&&(c.shape.apply(c),c.shape.reconfigure()))},dragLeave:function(b,c){null!=c&&(c.style=this.previousStyle,a(c,!1),c.shape&&(void 0==getLineColor(c.cell)&&(c.style[mxConstants.STYLE_STROKECOLOR]=mxConstants.NONE),c.shape.apply(c),c.shape.reconfigure()))},mouseDown:function(){},mouseUp:function(){}});window.doneLoading=!0}var surpressCloseWarning=!1;
function confirmClose(){if(surpressCloseWarning)surpressCloseWarning=!1;else if(saved_enabled&&!ribbonPanelItems().down("#savebut").disabled&&undoHistory.canUndo())return getText("You have made unsaved changes to this Insight. If you leave now before saving, they will be lost.")}window.onbeforeunload=function(){return confirmClose()};Ext.round=function(a,b){var c=Number(a);"number"==typeof b&&(b=Math.pow(10,b),c=Math.round(a*b)/b);return c};
var makeGhost=function(a){var b=a.value;a=b?a:graph.getSelectionCell();var c=graph.getDefaultParent(),d=getPosition(a),e=a.getStyle(),e=mxUtils.setStyle(e,"opacity",30);graph.getModel().beginUpdate();c=graph.insertVertex(c,null,primitiveBank.ghost.cloneNode(!0),d[0]+10,d[1]+10,a.getGeometry().width,a.getGeometry().height,e);c.value.setAttribute("Source",a.id);c.value.setAttribute("name",a.getAttribute("name"));b||graph.setSelectionCell(c);graph.getModel().endUpdate();return c},makeFolder=function(){var a=
graph.groupCells(null,20);a.setConnectable(!0);graph.setSelectionCell(a);graph.orderCells(!0)};
function showContextMenu(a,b){var c=getSelected(),d=!1;0<c.length&&(d="Folder"==c[0].value.nodeName&&!getCollapsed(c[0]));var e=0<c.length&&!d,f={hidden:is_ebook,text:getText("Paste"),glyph:61674,disabled:mxClipboard.isEmpty(),handler:function(){graph.getModel().beginUpdate();try{var a=mxClipboard.paste(graph),c=graph.getPointForEvent(b);if(null!=a){var d=graph.getBoundingBoxFromGeometry(a);if(null!=d){var e=graph.view.translate,f=graph.view.scale,g=e.y,u=Math.round(graph.snap(c.x/f-e.x)),v=Math.round(graph.snap(c.y/
f-g));graph.cellsMoved(a,u-d.x,v-d.y)}}}finally{graph.getModel().endUpdate()}clipboardListener()},scope:this},g=[];viewConfig.allowEdits?e?(g=[editActions.copy,editActions.cut,f,"-",editActions["delete"],"-",{text:getText("Ghost Primitive"),glyph:61637,disabled:1!=graph.getSelectionCount()||!isValued(graph.getSelectionCell())&&"Picture"!=graph.getSelectionCell().value.nodeName||"Flow"==graph.getSelectionCell().value.nodeName||"Ghost"==graph.getSelectionCell().value.nodeName,handler:makeGhost},{text:getText("Create Folder"),
glyph:61716,disabled:!e,handler:makeFolder},"-"].concat(styleMenu.filter(function(a){return!a.excludeFromContext})),1!=c.length||"Flow"!=c[0].value.nodeName&&"Link"!=c[0].value.nodeName||(g=g.concat(["-",{text:getText("Reverse Direction"),glyph:61676,handler:reverseDirection}]))):(g=[{text:getText("Create Stock"),glyph:61874,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Stock"),"Stock",[a.x,a.y],[100,40]);graph.model.endUpdate();d&&setParent(e,
c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Variable"),glyph:61668,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Variable"),"Variable",[a.x,a.y],[120,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Converter"),glyph:61950,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),
e=createPrimitive(getText("New Converter"),"Converter",[a.x,a.y],[120,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},"-",{text:getText("Create Agent Population"),glyph:61632,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("Agent Population"),"Agents",[a.x,a.y],[170,80]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},
20)}},{text:getText("Create State"),glyph:61510,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New State"),"State",[a.x,a.y],[100,40]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Action"),glyph:61671,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Action"),"Action",[a.x,a.y],[120,50]);
graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},,"-",{text:getText("Create Text"),glyph:61493,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Text"),"Text",[a.x,a.y],[200,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Picture"),glyph:61502,handler:function(){graph.model.beginUpdate();
var a=graph.getPointForEvent(b),e=createPrimitive("","Picture",[a.x,a.y],[64,64]);graph.model.endUpdate();d&&setParent(e,c[0]);setPicture(e);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Button"),glyph:61846,handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Button"),"Button",[a.x,a.y],[120,40]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},
20)}}],is_ebook||(g=g.concat(["-",{glyph:61677,text:getText("Insert Insight Maker Model"),handler:function(){showInsertModelWindow(graph.getPointForEvent(b))}},"-",{glyph:61893,text:getText("Export Diagram as SVG"),handler:function(){exportSvg()}},{itemId:"zoomMenuButton",text:getText("Zoom"),glyph:61442,menu:zoomMenu}])),mxClipboard.isEmpty()||(g.unshift("-"),g.unshift(f))):g.push({itemId:"zoomMenuButton",text:getText("Zoom"),glyph:61442,menu:zoomMenu});f=new Ext.menu.Menu({items:g});e&&(f.down("#bold").setChecked(currentStyleIs(mxConstants.FONT_BOLD)),
f.down("#italic").setChecked(currentStyleIs(mxConstants.FONT_ITALIC)),f.down("#underline").setChecked(currentStyleIs(mxConstants.FONT_UNDERLINE)),f.down("#sizeCombo").setValue(graph.getCellStyle(c[0])[mxConstants.STYLE_FONTSIZE]),f.down("#fontCombo").setValue(graph.getCellStyle(c[0])[mxConstants.STYLE_FONTFAMILY]));f.showAt([mxEvent.getClientX(b)+1,mxEvent.getClientY(b)+1]);f.focus()}
mxCellRenderer.prototype.initControl=function(a,b,c,d){var e=a.view.graph;e.isHtmlLabel(a.cell)&&mxClient.NO_FO&&e.dialect==mxConstants.DIALECT_SVG?(b.dialect=mxConstants.DIALECT_PREFERHTML,b.init(e.container),b.node.style.zIndex=1):b.init(a.view.getOverlayPane());b=b.innerNode||b.node;d&&(e.isEnabled()&&(b.style.cursor="pointer"),mxEvent.addListener(b,"click",d),mxEvent.addListener(b,"touchstart",d));c&&mxEvent.addGestureListeners(b,function(b){e.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b,
a));mxEvent.consume(b)},function(b){e.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,a))});return b};
mxSvgCanvas2D.prototype.text=function(a,b,c,d,e,f,g,k,l,m,n,p,q){if(this.textEnabled&&null!=e){p=null!=p?p:0;var u=this.state;a+=u.dx;b+=u.dy;if(this.foEnabled&&"html"==l){var v="vertical-align:top;";n?v+="overflow:hidden;max-height:"+Math.round(d)+"px;max-width:"+Math.round(c)+"px;":"fill"==m?v+="width:"+Math.round(c)+"px;height:"+Math.round(d)+"px;":"width"==m&&(v+="width:"+Math.round(c)+"px;",0<d&&(v+="max-height:"+Math.round(d)+"px;"));var v=k&&0<c?v+("width:"+Math.round(c)+"px;white-space:normal;"):
v+"white-space:nowrap;",y=this.createElement("g");1>u.alpha&&y.setAttribute("opacity",u.alpha);var z=this.createElement("foreignObject");z.setAttribute("pointer-events","all");v=this.createDiv(e,f,g,v,m);if(null!=v){null!=q&&v.setAttribute("dir",q);y.appendChild(z);this.root.appendChild(y);var x=0;q=0;var B=q=2;if(!mxClient.IS_IE||9!=document.documentMode&&mxClient.IS_SVG){this.root.ownerDocument!=document||mxClient.IS_FF?(v.style.visibility="hidden",document.body.appendChild(v)):z.appendChild(v);
var A=v;null!=A.firstChild&&"DIV"==A.firstChild.nodeName&&(A=A.firstChild);x=A.offsetWidth;!n&&k&&0<c&&this.root.ownerDocument!=document&&(G=v.style.whiteSpace,v.style.whiteSpace="nowrap",x==A.offsetWidth&&(q+=this.fontMetricsPadding),v.style.whiteSpace=G);x+=q;k&&(n&&(x=Math.min(x,c)),v.style.width=x+"px");x=A.offsetWidth+q;q=A.offsetHeight+2;v.parentNode!=z&&(z.appendChild(v),v.style.visibility="")}else{A=document.createElement("div");A.style.cssText=v.getAttribute("style");A.style.display=mxClient.IS_QUIRKS?
"inline":"inline-block";A.style.position="absolute";A.style.visibility="hidden";var D=document.createElement("div");D.style.display=mxClient.IS_QUIRKS?"inline":"inline-block";D.innerHTML=mxUtils.isNode(e)?e.outerHTML:e;A.appendChild(D);document.body.appendChild(A);8!=document.documentMode&&9!=document.documentMode&&null!=u.fontBorderColor&&(q+=2,B+=2);if(k&&0<c){var x=D.offsetWidth,E=0;if(!n&&this.root.ownerDocument!=document){var G=A.style.whiteSpace;A.style.whiteSpace="nowrap";if(x==D.offsetWidth)q+=
this.fontMetricsPadding;else if(8==document.documentMode||9==document.documentMode)E=-2;A.style.whiteSpace=G}x+=q;n&&(x=Math.min(x,c));A.style.width=x+"px";x=D.offsetWidth+q+E;q=D.offsetHeight+B;A.style.display="inline-block";A.style.position="";A.style.visibility="";A.style.width=x+"px";v.setAttribute("style",A.style.cssText)}else x=D.offsetWidth+q,q=D.offsetHeight+B;A.parentNode.removeChild(A);z.appendChild(v)}n&&(q=Math.min(q,d),x=Math.min(x,c));"fill"==m?(c=Math.max(c,x),d=Math.max(d,q)):(c="width"==
m?Math.max(c,x):x,d=q);1>u.alpha&&y.setAttribute("opacity",u.alpha);q=v=0;f==mxConstants.ALIGN_CENTER?v-=c/2:f==mxConstants.ALIGN_RIGHT&&(v-=c);a+=v;g==mxConstants.ALIGN_MIDDLE?q-=d/2-2:g==mxConstants.ALIGN_BOTTOM&&(q-=d-3);!mxClient.IS_OP&&mxClient.IS_GC&&mxClient.IS_MAC?q+=1:mxClient.IS_FF&&mxClient.IS_WIN&&(q-=1);q=mxClient.IS_FF?q-1:q-2;b+=q;A=1!=u.scale?"scale("+u.scale+")":"";0!=u.rotation&&this.rotateHtml?(A+="rotate("+u.rotation+","+c/2+","+d/2+")",b=this.rotatePoint((a+c/2)*u.scale,(b+d/
2)*u.scale,u.rotation,u.rotationCx,u.rotationCy),a=b.x-c*u.scale/2,b=b.y-d*u.scale/2):(a*=u.scale,b*=u.scale);0!=p&&(A+="rotate("+p+","+-v+","+-q+")");y.setAttribute("transform","translate("+Math.round(a)+","+Math.round(b)+")"+A);z.setAttribute("width",Math.round(Math.max(1,c)));z.setAttribute("height",Math.round(Math.max(1,d)));this.root.ownerDocument!=document&&(a=this.createAlternateContent(z,a,b,c,d,e,f,g,k,l,m,n,p),null!=a&&(z.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility"),
c=this.createElement("switch"),c.appendChild(z),c.appendChild(a),y.appendChild(c)))}}else this.plainText(a,b,c,d,e,f,g,k,m,n,p,q)}};var analysisCount=0;function getGraphXml(a){a=(new mxCodec(mxUtils.createXmlDocument())).encode(a.getModel());return mxUtils.getPrettyXml(a)}var isSendingtoServer=!1,waitingToSendToServer=!1,waitingToSendTimeout=-1;
function sendGraphtoServer(a){isSendingtoServer?waitingToSendToServer=!0:unfoldingManager.unfolding||(clearTimeout(waitingToSendTimeout),waitingToSendToServer=!1,isSendingtoServer=!0,Ext.Ajax.request({url:builder_path+"/save.php",method:"POST",params:{data:getGraphXml(a),nid:drupal_node_ID,title:graph_title,description:graph_description,tags:graph_tags,has_article:has_article,published:published,groups:JSON.stringify(node_groups)},success:function(a,c){parseInt(a.responseText)!=a.responseText?console.log("Insight Save Issue:\n\n"+
a.responseText):(drupal_node_ID=a.responseText,setSaveEnabled(waitingToSendToServer),updateWindowTitle(),setTopLinks())},failure:function(a,c){console.log("Insight Not Saved:\n\n"+a.responseText)},callback:function(){isSendingtoServer=!1;waitingToSendToServer&&(waitingToSendTimeout=setTimeout(function(){sendGraphtoServer(a)},5E3))}}))}
function validPrimitiveName(a,b){if("Stock"==b.value.nodeName||"Variable"==b.value.nodeName||"Converter"==b.value.nodeName||"Flow"==b.value.nodeName||"Display"==b.value.nodeName||"Agents"==b.value.nodeName||"Transition"==b.value.nodeName||"State"==b.value.nodeName){if(0<a.length&&!/[\[\]\(\)\{\}\<\>\'\"]/.test(a))return!0;mxUtils.alert(getText("Primitive names cannot contain brackets, parenthesis, or quotes."));return!1}return!0}
function isPrimitive(a){return!("Button"==a.value.nodeName||"Picture"==a.value.nodeName||"Text"==a.value.nodeName)}function cellsContainNodename(a,b){for(var c=0;c<a.length;c++)if(a[c].value.nodeName==b)return!0}function connectionType(){return ribbonPanelItems().down("#connect").pressed?"Flow":"Link"}function setAllConnectable(){graph.setConnectable(!0);for(var a=primitives(),b=0;b<a.length;b++)a[b].setConnectable(!0)}var primitiveCache={};
function primitives(a){if(primitiveCache[" "+a])return primitiveCache[" "+a];var b=childrenCells((graph instanceof SimpleNode?graph.children[0]:graph.getModel().getRoot()).children[0]);if(null==a)primitiveCache[" "+a]=b;else{for(var c=[],d=0;d<b.length;d++)b[d].value.nodeName==a&&c.push(b[d]);primitiveCache[" "+a]=c}return primitiveCache[" "+a]}
function childrenCells(a){a=a?a.children:null;if(null!=a){for(var b=[],c=0;c<a.length;c++)"Folder"==a[c].value.nodeName&&(b=b.concat(childrenCells(a[c])));a=a.concat(b);for(c=a.length-1;0<=c;c--)null!=a[c]&&null!=a[c].value||a.splice(c,1);return a}return null}var neighborhoodCache={};function clearPrimitiveCache(){primitiveCache={};neighborhoodCache={}}
function neighborhood(a){function b(a,b){var c=[];if("Agents"==orig(a).value.nodeName&&orig(a).getAttribute("Agent")){var d=orig(a).getAttribute("Agent");d&&getChildren(findID(d)).forEach(function(a){isValued(a)&&"Ghost"!=a.value.nodeName&&c.push({item:a,type:"agent",linkHidden:b,name:a.getAttribute("name")})})}return c.sort(function(a,b){return a.name==b.name?0:a.name>b.name?1:-1})}var c=inAgent(a);if(neighborhoodCache[a.id])return neighborhoodCache[a.id];var d=[],e=primitives();if(null!=e)if(null!=
a){var f=[],g=[];-1<["Flow","Link","Transition"].indexOf(a.value.nodeName)&&(null!==orig(a.source)&&d.push({item:orig(a.source),type:"direct"}),null!==orig(a.target)&&d.push({item:orig(a.target),type:"direct"}));"Agents"==a.value.nodeName&&a.getAttribute("Agent")&&(d=d.concat(b(a)));for(var k=0;k<e.length;k++)"Flow"==e[k].value.nodeName?f.push(orig(e[k])):"Link"==e[k].value.nodeName&&g.push(orig(e[k]));for(k=0;k<f.length;k++)f[k].source==a&&d.push({item:f[k],type:"direct",linkHidden:!0}),f[k].target==
a&&d.push({item:f[k],type:"direct",linkHidden:!0});for(k=0;k<g.length;k++)orig(g[k].source)==a&&isDefined(g[k].target)&&null!==g[k].target&&(e=!isTrue(g[k].getAttribute("BiDirectional")),d.push({item:orig(g[k].target),type:"direct",linkHidden:e}),d=d.concat(b(g[k].target,e))),orig(g[k].target)!=a||!isDefined(g[k].source)||null===g[k].source||inAgent(orig(g[k].source))&&!c||(d.push({item:orig(g[k].source),type:"direct"}),d=d.concat(b(g[k].source)))}else for(k=0;k<e.length;k++)isValued(e[k])&&d.push({item:orig(e[k]),
type:"direct"});d=d.filter(function(a){return a});c=[];for(k=0;k<d.length;k++)if(!d[k].linkHidden||!strictLinks){g=!1;for(e=0;e<c.length;e++)if(c[e].type==d[k].type&&c[e].item.id==d[k].item.id){g=!0;c[e].linkHidden&&!d[k].linkHidden&&(c[e].linkHidden=!1);break}g||(isValued(d[k].item)||"Agents"==d[k].item.value.nodeName)&&c.push(d[k])}return neighborhoodCache[a.id]=c}function doubleArray(a){for(var b=[],c=0;c<a.length;c++)b.push([a[c],a[c]]);return b}
function isValued(a){return isUndefined(a)||null==a||isUndefined(orig(a))?!1:"Converter"==orig(a).value.nodeName||"Flow"==orig(a).value.nodeName||"Stock"==orig(a).value.nodeName||"Variable"==orig(a).value.nodeName||"Transition"==orig(a).value.nodeName||"State"==orig(a).value.nodeName}function setSaveEnabled(a){if(is_editor&&!is_embed){var b=ribbonPanelItems().getComponent("savebut");a&&!1==unfoldingManager.unfolding?(b.setDisabled(!1),b.setText("Save")):(b.setDisabled(!0),b.setText("Saved"))}}
function updateWindowTitle(){is_embed||(""==graph_title?document.title="Untitled Insight | Insight Maker":(document.title=graph_title+" | Insight Maker",window.history&&window.history.replaceState&&window.history.replaceState("Object",document.title,"/insight/"+drupal_node_ID+"/"+getURLTitle())))}
function getURLTitle(){var a=graph_title.replace(/&#\d+;/g,""),a=a.replace(/'/g,""),a=a.replace(/[^A-Za-z0-9]/g,"-"),a=a.replace(/\-+/g,"-"),a=a.replace(/(^\-)|(\-$)/g,"");0==a.toLowerCase().indexOf("embed")&&(a="_"+a);return a}function hasDisplay(){var a=primitives();return cellsContainNodename(a,"Display")}function urlImage(a){return a.getAttribute("Image")&&"http"==a.getAttribute("Image").substring(0,4).toLowerCase()}
function setPicture(a){var b=a.getStyle();"None"==a.getAttribute("Image")||""==a.getAttribute("Image")||" "==a.getAttribute("Image")||"null"==a.getAttribute("Image")||"Folder"==a.value.nodeName&&!a.isCollapsed()?(b=mxUtils.setStyle(b,"image","None"),b="Display"==a.value.nodeName||"Stock"==a.value.nodeName||"Folder"==a.value.nodeName?mxUtils.setStyle(b,"shape","rectangle"):"Button"==a.value.nodeName?mxUtils.setStyle(b,"shape","rectangle"):mxUtils.setStyle(b,"shape","ellipse")):(b=urlImage(a)?mxUtils.setStyle(b,
"image",a.getAttribute("Image")):mxUtils.setStyle(b,"image",builder_path+"/images/SD/"+a.getAttribute("Image")+".png"),b=isTrue(a.getAttribute("FlipVertical"))?mxUtils.setStyle(b,"imageFlipV",1):mxUtils.setStyle(b,"imageFlipV",0),b=isTrue(a.getAttribute("FlipHorizontal"))?mxUtils.setStyle(b,"imageFlipH",1):mxUtils.setStyle(b,"imageFlipH",0),b=mxUtils.setStyle(b,"shape","image"));b=new mxStyleChange(graph.getModel(),a,b);graph.getModel().execute(b);propogateGhosts(a)}
function setLabelPosition(a){var b=a.getAttribute("LabelPosition"),c=a.getStyle();"Folder"!=a.value.nodeName||a.isCollapsed()?"Top"==b?(c=mxUtils.setStyle(c,"labelPosition","middle"),c=mxUtils.setStyle(c,"align","center"),c=mxUtils.setStyle(c,"verticalLabelPosition","top"),c=mxUtils.setStyle(c,"verticalAlign","bottom")):"Bottom"==b?(c=mxUtils.setStyle(c,"labelPosition","middle"),c=mxUtils.setStyle(c,"align","center"),c=mxUtils.setStyle(c,"verticalLabelPosition","bottom"),c=mxUtils.setStyle(c,"verticalAlign",
"top")):"Middle"==b?(c=mxUtils.setStyle(c,"labelPosition","middle"),c=mxUtils.setStyle(c,"align","center"),c=mxUtils.setStyle(c,"verticalLabelPosition","middle"),c=mxUtils.setStyle(c,"verticalAlign","middle")):"Left"==b?(c=mxUtils.setStyle(c,"verticalLabelPosition","middle"),c=mxUtils.setStyle(c,"verticalAlign","middle"),c=mxUtils.setStyle(c,"labelPosition","left"),c=mxUtils.setStyle(c,"align","right")):"Right"==b&&(c=mxUtils.setStyle(c,"verticalLabelPosition","middle"),c=mxUtils.setStyle(c,"verticalAlign",
"middle"),c=mxUtils.setStyle(c,"labelPosition","right"),c=mxUtils.setStyle(c,"align","left")):(c=mxUtils.setStyle(c,"labelPosition",null),c=mxUtils.setStyle(c,"align",null),c=mxUtils.setStyle(c,"verticalLabelPosition",null),c=mxUtils.setStyle(c,"verticalAlign",null));b=new mxStyleChange(graph.getModel(),a,c);graph.getModel().execute(b);propogateGhosts(a)}function removeAgent(a){for(var b=primitives("Agents"),c=0;c<b.length;c++)b[c].getAttribute("Agent")==a.id&&b[c].setAttribute("Agent","")}
function deletePrimitive(a){var b=primitives(),c=getSetting();if(c.getAttribute("SensitivityPrimitives")){var d=c.getAttribute("SensitivityPrimitives").split(","),e=d.indexOf(a.id);-1<e&&(d.splice(e,1),c.setAttribute("SensitivityPrimitives",d.join(",")))}"Folder"==a.value.nodeName&&"Agent"==a.getAttribute("Type")&&removeAgent(a);for(c=0;c<b.length;c++)"Display"==b[c].value.nodeName?b[c].getAttribute("Primitives")&&(d=b[c].getAttribute("Primitives").split(","),e=d.indexOf(a.id),-1<e&&(d.splice(e,1),
b[c].setAttribute("Primitives",d.join(",")))):"Converter"==b[c].value.nodeName?b[c].getAttribute("Source")==a.id?b[c].setAttribute("Source","Time"):"Link"==a.value.nodeName&&testConverterSource(b[c]):"Ghost"==b[c].value.nodeName&&b[c].value.getAttribute("Source")==a.id&&(d=b[c],deletePrimitive(d),graph.removeCells([d],!1))}
function linkBroken(a){for(var b=primitives(),c=0;c<b.length;c++)"Converter"==b[c].value.nodeName&&testConverterSource(b[c]);null!==a.getTerminal(!1)&&"Converter"==a.getTerminal(!1).value.nodeName&&"undefined"!=typeof a.getTerminal(!0)&&isValued(a.getTerminal(!0))&&a.getTerminal(!1).setAttribute("Source",orig(a.getTerminal(!0)).id)}
function testConverterSource(a){for(var b=neighborhood(a),c=!1,d=0;d<b.length;d++)b[d].linkHidden||a.getAttribute("Source")==b[d].item.id&&(c=!0);c||a.setAttribute("Source","Time")}function downloadModel(){var a=getGraphXml(graph);surpressCloseWarning=!0;document.getElementById("downloader").title.value=encodeURIComponent(graph_title);document.getElementById("downloader").code.value=encodeURIComponent(a);document.getElementById("downloader").submit()}
function getSetting(){for(var a=primitives(),b=0;b<a.length;b++)if("Setting"==a[b].value.nodeName)return a[b];alert("Settings primitive could not be found.");return null}function handelCursors(){graph.container.style.cursor="auto"}var propertiesWin;
function updateProperties(){var a;a=""==graph_title?"Untitled Insight":graph_title;propertiesWin?""!=graph_title&&(Ext.getCmp("sinsightTitle").setValue(graph_title),Ext.getCmp("sinsightTags").setValue(graph_tags),Ext.getCmp("sinsightDescription").setValue(graph_description)):propertiesWin=new Ext.Window({applyTo:"property-win",layout:{type:"vbox",align:"stretch"},modal:!0,width:550,title:"Save Insight",autoHeight:!0,minHeight:300,minWidth:450,closable:!0,resizable:!0,autoScroll:!0,closeAction:"hide",
defaults:{width:230,labelWidth:150},items:[new Ext.form.TextField({fieldLabel:"Insight Title",name:"sinsightTitle",id:"sinsightTitle",allowBlank:!1,selectOnFocus:!0,value:a,margin:9}),new Ext.form.TextField({fieldLabel:"Tags",name:"sinsightTags",id:"sinsightTags",allowBlank:!0,emptyText:"Environment, Health Care, Finance",value:graph_tags,margin:9}),new Ext.form.field.HtmlEditor({enableColors:!1,enableSourceEdit:!1,enableFont:!1,enableLists:!0,enableFontSize:!1,fieldLabel:"Description",name:"sinsightDescription",
id:"sinsightDescription",allowBlank:!0,emptyText:"Enter a brief description of the Insight.",value:graph_description,margin:9,minHeight:100,flex:1}),{xtype:"fieldcontainer",fieldLabel:"Insight Access",layout:"hbox",defaults:{flex:1,hideLabel:!0},margin:9,items:[{xtype:"segmentedbutton",items:[{glyph:61612,text:"Public Insight",pressed:published,id:"insightPublic",tooltip:"This Insight is public. Anyone can view it, but only you can edit it."},{glyph:61572,text:"Private Insight",pressed:!published,
tooltip:"This Insight is private. Only people you have given access to can view it."}]}]},Ext.create("Ext.form.field.Tag",{hidden:0==user_groups.length,fieldLabel:"Share with Groups",name:"sinsightGroups",id:"sinsightGroups",value:node_groups,allowBlank:!0,filterPickList:!0,store:group_titles,margin:9})],buttons:[{text:"Cancel",scale:"large",glyph:61532,handler:function(){propertiesWin.hide()}},{glyph:61452,scale:"large",text:"Save",handler:function(){if(Ext.getCmp("sinsightTitle").validate()){propertiesWin.hide();
graph_title=Ext.String.trim(Ext.getCmp("sinsightTitle").getValue());graph_description=Ext.String.trim(Ext.getCmp("sinsightDescription").getValue());graph_description=graph_description.replace(/^(\u200b|&nbsp;)/g,"");graph_description=graph_description.replace(/(\u200b|&nbsp;)$/g,"");if("<br>"==graph_description||"<br/>"==graph_description||"\u200b"==graph_description||"&nbsp;"==graph_description)graph_description="";graph_tags=Ext.getCmp("sinsightTags").getValue();node_groups=Ext.getCmp("sinsightGroups").getValue();
published=Ext.getCmp("insightPublic").pressed;setSaveEnabled(!0);sendGraphtoServer(graph);selectionChanged(!1)}else showNotification(getText("You must specify a name for the Insight."),"error",!0)}}]});propertiesWin.show();Ext.getCmp("sinsightTitle").focus(!0,300)}function isTrue(a){return"false"!=a&&"No"!=a&&0!=a&&(1==a||-1==a||"True"==a||"true"==a||!0==a||"Yes"==a)}
function customUnits(){if("undefined"!=typeof getSetting().getAttribute("Units")){for(var a=getSetting().getAttribute("Units").split("\n"),b=0;b<a.length;b++)a[b]=a[b].split("<>");return a}return[]}function orig(a){return a?"Ghost"===a.value.nodeName?(a.origCache||(a.origCache=findID(a.value.getAttribute("Source"))),a.origCache):a:null}
function currentStyleIs(a){for(var b=graph.getCellStyle(graph.getSelectionCell())[mxConstants.STYLE_FONTSTYLE],c=3;1<=c;c--)b-=a*Math.pow(2,c),0>b&&(b+=a*Math.pow(2,c));return b>=a}
function setStyles(){if(!is_embed&&is_editor){var a=!graph.isSelectionEmpty(),b=ribbonPanelItems();a?(b.down("#bold").setChecked(currentStyleIs(mxConstants.FONT_BOLD)),b.down("#italic").setChecked(currentStyleIs(mxConstants.FONT_ITALIC)),b.down("#underline").setChecked(currentStyleIs(mxConstants.FONT_UNDERLINE)),a=graph.getCellStyle(graph.getSelectionCell()),b.down("#sizeCombo").setValue(a[mxConstants.STYLE_FONTSIZE]),b.down("#fontCombo").setValue(a[mxConstants.STYLE_FONTFAMILY])):(b.down("#bold").setChecked(!1),
b.down("#italic").setChecked(!1),b.down("#underline").setChecked(!1),b.down("#fontCombo").setValue(""),b.down("#sizeCombo").setValue(""))}}function stringArray(a,b,c){if(0==a.length)return"";if(1==a.length)return a[0];a=a.slice();var d=a.pop();return a.join(b)+c+d}function quickLabel(a,b,c){var d=getSetting();return processLabel(a,b,c,d.getAttribute("TimeUnits"),d.getAttribute("TimeStep"),d.getAttribute("SolutionAlgorithm"))}
function processLabel(a,b,c,d,e,f){a=replaceAll(a,"%%","<PERCENTSIGNPLACEHOLDER>");a=replaceAll(a,"%u",d);a=replaceAll(a,"%t",b);a=replaceAll(a,"%o",c);a=replaceAll(a,"%ts",e);a=replaceAll(a,"%a",f);a=replaceAll(a,"<PERCENTSIGNPLACEHOLDER>","%");return clean(a)}function replaceAll(a,b,c){return isUndefined(a)?"":a.replace(RegExp(b,"g"),c)}
function loadBackgroundColor(){mxPanel.el.dom.style["background-color"]=getSetting().getAttribute("BackgroundColor");mxPanel.el.dom.style.backgroundColor=getSetting().getAttribute("BackgroundColor")}function isUndefined(a){return"undefined"==typeof a}function isDefined(a){return!isUndefined(a)}function isTouch(){return mxClient.IS_TOUCH}
function propogateGhosts(a){for(var b=primitives("Ghost"),c=0;c<b.length;c++)if(b[c].getAttribute("Source")==a.id){var d=a.getStyle(),d=mxUtils.setStyle(d,"opacity",30);b[c].setStyle(d);setAttributeUndoable(b[c],"name",a.getAttribute("name"))}}
function propogateName(a,b){if(isValued(a))for(var c=getName(a),d=RegExp("\\["+b+"\\]","gi"),e=graph.getConnections(a),f=0;f<e.length;f++)if(e[f].target&&e[f].source){var g;g="Flow"==e[f].value.nodeName||"Transition"==e[f].value.nodeName?e[f]:e[f].target.id==a.id?e[f].source:e[f].target;(isValued(g)||g&&"Action"==g.value.nodeName)&&setValue(g,getValue(g).replace(d,"["+c+"]"))}}function map(a,b){return a instanceof Array?a.map(b):b(a)}
function unitsUsedInModel(){for(var a=primitives(),b=[],c=0;c<a.length;c++){var d=a[c].getAttribute("Units");"Setting"!=a[c].value.nodeName&&isDefined(d)&&null!==d&&"Unitless"!=d&&b.push(d)}return Ext.Array.unique(b)}function changeNodeName(a,b){for(var c=mxUtils.createXmlDocument().createElement(b),d=a.attributes,e=0;e<d.length;e++)c.setAttribute(d[e].name,d[e].value);return c}
function cmd(a){return mxClient.IS_MAC?"<span style='color:grey'>(&#8984;"+a+")</span>":"<span style='color:grey'>(Ctrl-"+a+")</span>"}function inAgent(a){return a&&null!=a?(a=getParent(a))&&"Agent"==a.getAttribute("Type")?!0:inAgent(a):!1}function parentAgent(a){if(a&&null!=a)return(a=getParent(a))&&"Agent"==a.getAttribute("Type")?a:parentAgent(a)}
function isGray(a){if(isUndefined(a))return!0;a="#"==a[0]?a:colourNameToHex(a);if("#6482B9"==a)return!0;var b=a[1];if(4==a.length)for(var c=2;c<a.length;c++){if(a[c]!=b)return!1}else if(7==a.length){for(c=1;c<a.length;c+=2)if(a[c]!=b)return!1;b=a[2];for(c=2;c<a.length;c+=2)if(a[c]!=b)return!1}return!0}
function colourNameToHex(a){var b={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",
darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",
goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",
lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",
olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",
slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return"undefined"!=typeof b[a.toLowerCase()]?b[a.toLowerCase()]:!1}
function printGraph(){var a=mxUtils.prompt(getText("Enter page count for printing")+":","1");null!=a&&(a=mxUtils.getScaleForPageCount(a,graph),(new mxPrintPreview(graph,a)).open())}function flatten(a){function b(a){var e,f,g;e=0;for(f=a.length;e<f;e++)g=a[e],Array.isArray(g)?b(g):c.push(g);return c}var c=[];return b(a)}
var downloadButton=function(a){return{xtype:"button",text:"Download",glyph:61677,handler:function(){var b=this.up("gridpanel"),c=b.getStore(),d=b.columns,e="",e=e+d.filter(function(a){return!a.hidden}).map(function(a){return'"'+(a.text||a.name).replace(/"/g,'""')+'"'}).join(",");c.each(function(a,b){var c=[];d.forEach(function(b){if(b=b.name||b.dataIndex)b=""+a.get(b),c.push('"'+b.replace(/"/g,'""')+'"')});e+="\r\n"+c.join(",")});(new mxXmlRequest(builder_path+"/download.php",$.param({name:a,format:"csv",
data:e}))).simulate(document,"_blank")}}};function deepClone(a,b,c,d){var e,f,g,k;if(null!=b)for(e in b)if(f=a[e],g=b[e],a!==g){if(d){var l=d(g);if(l){a[e]=l;continue}}0<c&&g&&((k=Array.isArray(g))||"object"==typeof g)?(k?(k=!1,f=f&&Array.isArray(f)?f:[]):f=f&&"object"==typeof srv?f:{},a[e]=deepClone(f,g,c-1,d)):void 0!==g&&(a[e]=g)}return a}
function exportSvg(){var a=graph.view.scale,b=graph.getGraphBounds(),c=mxUtils.createXmlDocument(),d=null!=c.createElementNS?c.createElementNS(mxConstants.NS_SVG,"svg"):c.createElement("svg");null!=d.style?d.style.backgroundColor="#FFFFFF":d.setAttribute("style","background-color:#FFFFFF");null==c.createElementNS&&d.setAttribute("xmlns",mxConstants.NS_SVG);d.setAttribute("width",Math.ceil(b.width*a+2)+"px");d.setAttribute("height",Math.ceil(b.height*a+2)+"px");d.setAttribute("xmlns:xlink",mxConstants.NS_XLINK);
d.setAttribute("version","1.1");var e=null!=c.createElementNS?c.createElementNS(mxConstants.NS_SVG,"g"):c.createElement("g");e.setAttribute("transform","translate(0.5,0.5)");d.appendChild(e);c.appendChild(d);c=new mxSvgCanvas2D(e);c.translate(Math.floor(1/a-b.x),Math.floor(1/a-b.y));c.scale(a);(new mxImageExport).drawState(graph.getView().getState(graph.model.root),c);a=mxUtils.getXml(d);(new mxXmlRequest(builder_path+"/download.php",$.param({name:"Insight Maker Diagram",format:"svg",data:a}))).simulate(document,
"_blank")};var scratchPadStatus="";function ribbonPanelItems(){return ribbonPanel.getDockedItems()[0]}
var reverseDirection=function(){graph.getModel().beginUpdate();var a=graph.getSelectionCells();if(null!=a)for(var b=0;b<a.length;b++)if(a[b].isEdge()){var c=a[b].getGeometry(),d=a[b].source,e=new mxTerminalChange(graph.getModel(),a[b],a[b].target,!0);graph.getModel().execute(e);e=new mxTerminalChange(graph.getModel(),a[b],d,!1);graph.getModel().execute(e);d=c.sourcePoint;c.sourcePoint=c.targetPoint;c.targetPoint=d;null!=c.points&&c.points.reverse();e=new mxGeometryChange(graph.getModel(),a[b],c);
graph.getModel().execute(e);"Link"==a[b].value.nodeName&&linkBroken(a[b])}graph.getModel().endUpdate()},showMacros=function(a){var b=new Ext.ux.AceEditor({id:"macroTxt",name:"macroTxt",readOnly:!viewConfig.allowEdits,flex:1,value:getSetting().getAttribute("Macros"),annotations:a}),c=new Ext.Window({layout:{type:"vbox",align:"stretch"},tools:[{type:"help",tooltip:getText("Get Help"),callback:function(a,b,c){showURL("/macros")}}],modal:!0,stateful:is_editor&&!is_embed,stateId:"macros_window",width:Math.min(Ext.getBody().getViewSize().width,
540),height:Math.min(Ext.getBody().getViewSize().height,450),title:getText("Insight Macros"),resizable:!0,maximizable:!0,closeAction:"destroy",plain:!0,items:[b,{xtype:"box",padding:8,style:{"border-top":"solid 1px lightgrey"},html:"<b>"+getText("Example Macros")+"</b> (<a href='//insightmaker.com/macros' target='_blank'>More</a>)<br>g <- {9.80665 meters/seconds^2} # Custom Variable<br/>TemperatureFtoC(f) <- (f+32)*5/9 # Custom Function<br/>"}],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),
handler:function(){c.close()}},{glyph:61452,scale:"large",text:getText("Apply"),handler:function(){graph.getModel().beginUpdate();var a=new mxCellAttributeChange(getSetting(),"Macros",Ext.getCmp("macroTxt").getValue());graph.getModel().execute(a);graph.getModel().endUpdate();c.close()}}]});c.show();b.focus(!0,!0);b.editor.focus();setTimeout(function(){b.editor.focus()},200)},scratchpadFn=function(){"shown"==scratchPadStatus?(Ext.get("mainGraph").setDisplayed("none"),scratchPadStatus="hidden"):("hidden"==
scratchPadStatus?Ext.get("mainGraph").setDisplayed("block"):(Ext.get("mainGraph").setDisplayed("block"),Scratchpad($("#mainGraph"))),scratchPadStatus="shown");ribbonPanel.down("#scratchpad").setChecked("shown"==scratchPadStatus)},editActions=[];editActions.copy={hidden:is_ebook,itemId:"copy",text:getText("Copy"),glyph:61637,tooltip:getText("Copy")+" "+cmd("C"),handler:function(){mxClipboard.copy(graph);clipboardListener()},scope:this};
editActions.cut={hidden:is_ebook,itemId:"cut",text:getText("Cut"),glyph:61636,tooltip:getText("Cut")+" "+cmd("X"),handler:function(){mxClipboard.cut(graph);clipboardListener()},scope:this};editActions.paste={hidden:is_ebook,text:getText("Paste"),glyph:61674,tooltip:getText("Paste")+" "+cmd("V"),itemId:"paste",handler:function(){mxClipboard.paste(graph);clipboardListener()},scope:this};
editActions["delete"]={itemId:"delete",text:getText("Delete"),glyph:61453,tooltip:getText("Delete primitive"),handler:function(){graph.removeCells(graph.getSelectionCells(),!1)},scope:this};
var sizeCombo,fontCombo,RibbonPanel=function(a,b,c){function d(a){return function(){getCustomColor(function(b){a(b)})}}function e(b){n.push({text:getText("Width: %s",b),handler:function(){a.setCellStyles(mxConstants.STYLE_STROKEWIDTH,b,excludeType(a.getSelectionCells(),"Ghost"));a.setCellStyles(mxConstants.ARROW_SIZE,10*b,excludeType(a.getSelectionCells(),"Ghost"))}})}function f(b){function c(d){return function(){b?a.setCellStyles(mxConstants.STYLE_STARTARROW,d,excludeType(a.getSelectionCells(),"Ghost")):
a.setCellStyles(mxConstants.STYLE_ENDARROW,d,excludeType(a.getSelectionCells(),"Ghost"))}}for(var d=[["None",mxConstants.NONE],"-",["Regular Arrow",mxConstants.ARROW_CLASSIC],["Block Arrow",mxConstants.ARROW_BLOCK],["Open Arrow",mxConstants.ARROW_OPEN],["Diamond",mxConstants.ARROW_DIAMOND],["Thin Diamond",mxConstants.ARROW_DIAMOND_THIN],["Oval",mxConstants.ARROW_OVAL]],e=0;e<d.length;e++)"-"!==d[e]&&(d[e]={text:d[e][0],handler:c(d[e][1])});return d}Ext.Ajax.timeout=6E4;for(var g={xtype:"menu",iconsCls:"picture-icon",
items:"Growth;Balance;Positive Feedback Clockwise;Positive Feedback Counterclockwise;Negative Feedback Clockwise;Negative Feedback Counterclockwise;Unknown Feedback Clockwise;Unknown Feedback Counterclockwise;Plus;Minus;Forwards;Reload;Play;Pause;Stop;Info;Question;Warning;Checkmark;Prohibited;Idea;Home;Book;Clock;Computer;Dice;Cards;Gear;Hammer;Smiley;Heart;Key;Lock;Loudspeaker;Footprints;Mail;Network;Notes;Paint;Pushpin;Paperclip;People;Person;Wallet;Money;Flag;Star;Rocket;Alarm;Beaker;Ball;Hat;List;Bolt;Cookie;Plugin;Monitor;Telescope;Chalkboard;Open;Trash".split(";").map(function(a){return{text:'<center><div class="x-combo-list-item" style="white-space:normal";><img src="'+
builder_path+"/images/SD/"+a+'.png" width=48 height=48/></div></center>',handler:function(){setImage(getSelected(),a)}}})},k="000000 993300 333300 003300 003366 000080 333399 333333 800000 FF6600 808000 008000 008080 0000FF 666699 808080 FF0000 FF9900 99CC00 339966 33CCCC 3366FF 800080 969696 FF00FF FFCC00 FFFF00 00FF00 00FFFF 6482B9 993366 C0C0C0 FF99CC FDCDAC FFFF99 B3E2CD CCFFFF A6D3F8 CC99FF FFFFFF".split(" "),l=[{xtype:"colorpicker",colors:k,allowReselect:!0,handler:function(b,c){if("string"==
typeof c){a.getModel().beginUpdate();a.setCellStyles(mxConstants.STYLE_FILLCOLOR,"#"+c,excludeType(a.getSelectionCells(),"Ghost"));for(var d=a.getSelectionCells(),e=[],f=0;f<d.length;f++)"Link"!=d[f].value.nodeName&&"Flow"!=d[f].value.nodeName||e.push(d[f]);a.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"#"+c,e,excludeType(a.getSelectionCells(),"Ghost"));a.isSelectionEmpty()&&(a.getModel().execute(new mxCellAttributeChange(getSetting(),"BackgroundColor","#"+c)),loadBackgroundColor());a.getModel().endUpdate();
document.activeElement&&document.activeElement.blur&&document.activeElement.blur()}}},"-",{text:getText("Custom Color")+"...",handler:d(function(b){a.getModel().beginUpdate();a.setCellStyles(mxConstants.STYLE_FILLCOLOR,b,excludeType(a.getSelectionCells(),"Ghost"));for(var c=a.getSelectionCells(),d=[],e=0;e<c.length;e++)"Link"!=c[e].value.nodeName&&"Flow"!=c[e].value.nodeName||d.push(c[e]);a.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,b,d,excludeType(a.getSelectionCells(),"Ghost"));a.isSelectionEmpty()&&
(a.getModel().execute(new mxCellAttributeChange(getSetting(),"BackgroundColor",b)),loadBackgroundColor());a.getModel().endUpdate()})},{text:getText("No Fill Color"),handler:function(){a.getModel().beginUpdate();a.setCellStyles(mxConstants.STYLE_FILLCOLOR,mxConstants.NONE,excludeType(a.getSelectionCells(),"Ghost"));for(var b=a.getSelectionCells(),c=[],d=0;d<b.length;d++)"Link"!=b[d].value.nodeName&&"Flow"!=b[d].value.nodeName||c.push(b[d]);a.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,mxConstants.NONE,
c,excludeType(a.getSelectionCells(),"Ghost"));a.isSelectionEmpty()&&(a.getModel().execute(new mxCellAttributeChange(getSetting(),"BackgroundColor","white")),loadBackgroundColor());a.getModel().endUpdate()}},"-",{text:getText("Shape"),menu:[{text:getText("Rectangle"),handler:function(){a.setCellStyles(mxConstants.STYLE_SHAPE,mxConstants.SHAPE_RECTANGLE,excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]));a.setCellStyles(mxConstants.STYLE_PERIMETER,mxConstants.PERIMETER_RECTANGLE,
excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]))}},{text:getText("Ellipse"),handler:function(){a.setCellStyles(mxConstants.STYLE_SHAPE,mxConstants.SHAPE_ELLIPSE,excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]));a.setCellStyles(mxConstants.STYLE_PERIMETER,mxConstants.PERIMETER_ELLIPSE,excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]))}},{text:getText("Cylinder"),handler:function(){a.setCellStyles(mxConstants.STYLE_SHAPE,mxConstants.SHAPE_CYLINDER,
excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]));a.setCellStyles(mxConstants.STYLE_PERIMETER,mxConstants.PERIMETER_RECTANGLE,excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]))}},{text:getText("Cloud"),handler:function(){a.setCellStyles(mxConstants.STYLE_SHAPE,mxConstants.SHAPE_CLOUD,excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]));a.setCellStyles(mxConstants.STYLE_PERIMETER,mxConstants.PERIMETER_RECTANGLE,excludeType(a.getSelectionCells(),
["Ghost","Flow","Link","Transition"]))}},{text:getText("Hexagon"),handler:function(){a.setCellStyles(mxConstants.STYLE_SHAPE,mxConstants.SHAPE_HEXAGON,excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]));a.setCellStyles(mxConstants.STYLE_PERIMETER,mxConstants.PERIMETER_HEXAGON,excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]))}},{text:getText("Diamond"),handler:function(){a.setCellStyles(mxConstants.STYLE_SHAPE,mxConstants.SHAPE_RHOMBUS,excludeType(a.getSelectionCells(),
["Ghost","Flow","Link","Transition"]));a.setCellStyles(mxConstants.STYLE_PERIMETER,mxConstants.PERIMETER_RHOMBUS,excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]))}},{text:getText("Triangle"),handler:function(){a.setCellStyles(mxConstants.STYLE_SHAPE,mxConstants.SHAPE_TRIANGLE,excludeType(a.getSelectionCells(),["Ghost","Flow","Link","Transition"]));a.setCellStyles(mxConstants.STYLE_PERIMETER,mxConstants.PERIMETER_TRIANGLE,excludeType(a.getSelectionCells(),["Ghost","Flow","Link",
"Transition"]))}}]},"-",{text:getText("Rounded Corners"),handler:function(){a.setCellStyles(mxConstants.STYLE_ROUNDED,1,excludeType(a.getSelectionCells(),"Ghost"))}},{text:getText("Sharp Corners"),handler:function(){a.setCellStyles(mxConstants.STYLE_ROUNDED,0,excludeType(a.getSelectionCells(),"Ghost"))}}],m=[{xtype:"colorpicker",colors:k,allowReselect:!0,handler:function(b,c){"string"==typeof c&&a.setCellStyles(mxConstants.STYLE_FONTCOLOR,"#"+c,excludeType(a.getSelectionCells(),"Ghost"));document.activeElement&&
document.activeElement.blur&&document.activeElement.blur()}},"-",{text:getText("Custom Color")+"...",handler:d(function(b){a.setCellStyles(mxConstants.STYLE_FONTCOLOR,b,excludeType(a.getSelectionCells(),"Ghost"))})}],n=[],p=1;10>=p;p++)e(p);for(p=15;50>=p;p+=5)e(p);k=[{xtype:"colorpicker",colors:k,allowReselect:!0,handler:function(b,c){"string"==typeof c&&a.setCellStyles(mxConstants.STYLE_STROKECOLOR,"#"+c,excludeType(a.getSelectionCells(),"Ghost"));document.activeElement&&document.activeElement.blur&&
document.activeElement.blur()}},"-",{text:getText("Custom Color")+"...",handler:d(function(b){a.setCellStyles(mxConstants.STYLE_STROKECOLOR,b,excludeType(a.getSelectionCells(),"Ghost"))})},{text:getText("No Line Color"),handler:function(){a.setCellStyles(mxConstants.STYLE_STROKECOLOR,mxConstants.NONE,excludeType(a.getSelectionCells(),"Ghost"))}},"-",{text:getText("Solid Line"),handler:function(){a.setCellStyles(mxConstants.STYLE_DASHED,0,excludeType(a.getSelectionCells(),"Ghost"))}},{text:getText("Dashed Line"),
handler:function(){a.setCellStyles(mxConstants.STYLE_DASHED,1,excludeType(a.getSelectionCells(),"Ghost"))}},"-",{text:getText("Line Width"),menu:{items:n}},"-",{text:getText("Line Start"),menu:{items:f(!0)}},{text:getText("Line End"),menu:{items:f(!1)}}];fontCombo={xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"label"},{type:"string",name:"font"}],data:[{label:"Comic",font:"Comic Sans MS"},{label:"Helvetica",font:"Helvetica"},{label:"Verdana",font:"Verdana"},{label:"Times New Roman",
font:"Times New Roman"},{label:"Garamond",font:"Garamond"},{label:"Courier New",font:"Courier New"}]}),itemId:"fontCombo",iconCls:"font-family-icon",displayField:"label",valueField:"font",queryMode:"local",width:120,colspan:3,triggerAction:"all",emptyText:getText("Font Family..."),selectOnFocus:!0,listeners:{select:function(b,c){null!=c&&a.setCellStyles(mxConstants.STYLE_FONTFAMILY,b.getValue(),excludeType(a.getSelectionCells(),"Ghost"))},specialkey:function(b,c){if(10==c.keyCode||13==c.keyCode){var d=
b.getValue();null!=d&&0<d.length&&(a.setCellStyles(mxConstants.STYLE_FONTFAMILY,d,excludeType(a.getSelectionCells(),"Ghost")),this.setValue(d))}}}};sizeCombo={xtype:"combobox",colspan:2,store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"label"},{type:"float",name:"size"}],data:[{label:"6pt",size:6},{label:"8pt",size:8},{label:"9pt",size:9},{label:"10pt",size:10},{label:"12pt",size:12},{label:"14pt",size:14},{label:"18pt",size:18},{label:"24pt",size:24},{label:"30pt",size:30},{label:"36pt",
size:36},{label:"48pt",size:48},{label:"60pt",size:60}]}),itemId:"sizeCombo",iconCls:"font-size-icon",displayField:"label",valueField:"size",queryMode:"local",width:50,triggerAction:"all",emptyText:"Font Size...",selectOnFocus:!0,listeners:{select:function(b,c){null!=c&&a.setCellStyles(mxConstants.STYLE_FONTSIZE,b.getValue(),excludeType(a.getSelectionCells(),"Ghost"))},specialkey:function(b,c){if(10==c.keyCode||13==c.keyCode){var d=parseInt(b.getValue());!isNaN(d)&&0<d&&(this.setValue(d),a.setCellStyles(mxConstants.STYLE_FONTSIZE,
d,excludeType(a.getSelectionCells(),"Ghost")))}}}};window.zoomMenu={items:[{text:"400%",scope:this,handler:function(a){setZoom(4)}},{text:"200%",scope:this,handler:function(a){setZoom(2)}},{text:"150%",scope:this,handler:function(a){setZoom(1.5)}},{text:"100%",scope:this,handler:function(a){setZoom(1)}},{text:"75%",scope:this,handler:function(a){setZoom(0.75)}},{text:"50%",scope:this,handler:function(a){setZoom(0.5)}},{text:"25%",scope:this,handler:function(a){setZoom(0.25)}},"-",{text:getText("Zoom In"),
glyph:61454,scope:this,handler:function(a){setZoom("in")}},{text:getText("Zoom Out"),glyph:61456,scope:this,handler:function(a){setZoom("out")}},"-",{text:getText("Actual Size"),scope:this,handler:function(a){setZoom("actual")}},{text:getText("Fit Window"),scope:this,handler:function(a){setZoom("fit")}}]};window.styleMenu=[fontCombo,sizeCombo,{itemId:"fontcolor",text:"Font Color",tooltip:getText("Font Color"),iconCls:"fontcolor-icon",menu:m},{itemId:"linecolor",text:"Line",tooltip:getText("Line Style"),
iconCls:"linecolor-icon",menu:k},{itemId:"fillcolor",text:"Fill",tooltip:getText("Fill Color"),iconCls:"fillcolor-icon",menu:l},"-",{itemId:"bold",xtype:"menucheckitem",text:"Bold",glyph:61490,tooltip:getText("Bold")+" "+cmd("B"),handler:function(){a.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD,excludeType(a.getSelectionCells(),"Ghost"));setStyles()},scope:this},{itemId:"italic",xtype:"menucheckitem",text:"Italic",tooltip:getText("Italic")+" "+cmd("I"),glyph:61491,handler:function(){a.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,
mxConstants.FONT_ITALIC,excludeType(a.getSelectionCells(),"Ghost"));setStyles()},scope:this},{itemId:"underline",xtype:"menucheckitem",text:"Underline",tooltip:getText("Underline")+" "+cmd("U"),glyph:61645,handler:function(){a.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE,excludeType(a.getSelectionCells(),"Ghost"));setStyles()},scope:this},{itemId:"align",text:"Align",glyph:61494,tooltip:getText("Label Position"),handler:function(){},menu:{items:[{text:getText("Align Left"),
scope:this,iconCls:"left-icon",handler:function(){a.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT,excludeType(a.getSelectionCells(),"Ghost"))}},{text:getText("Align Center"),scope:this,iconCls:"center-icon",handler:function(){a.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER,excludeType(a.getSelectionCells(),"Ghost"))}},{text:getText("Align Right"),scope:this,iconCls:"right-icon",handler:function(){a.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT,excludeType(a.getSelectionCells(),
"Ghost"))}},"-",{text:getText("Position Middle"),scope:this,iconCls:"middle-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Middle");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Top"),scope:this,iconCls:"top-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");
a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Top");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Right"),scope:this,iconCls:"left-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],
"LabelPosition","Right");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Bottom"),scope:this,iconCls:"bottom-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Bottom");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Left"),scope:this,
iconCls:"right-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Left");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}}]}},"-",{itemId:"movemenu",text:"Order",tooltip:getText("Change Order"),glyph:61641,handler:function(){},menu:{itemOd:"move-menu",cls:"move-menu",items:[{itemOd:"moveback",text:getText("Move to Back"),
iconCls:"back-icon",handler:function(){a.orderCells(!0)},scope:this},{itemId:"movefront",text:getText("Move to Front"),iconCls:"front-icon",handler:function(){a.orderCells(!1)},scope:this}]}},"-",{itemId:"picturemenu",text:"Primitive Picture",tooltip:getText("Adjust Picture"),glyph:61502,handler:function(){},menu:{itemId:"picture-menu",items:[{text:"No Image",glyph:61527,handler:function(){setImage(getSelected(),"None")}},"-",{text:"Custom Image",glyph:61633,handler:function(){Ext.Msg.prompt("Image URL",
"<p>You may use a link to an existing custom image stored on-line. Please note that the image is only stored as a link within Insight Maker so you need to ensure that the original image stays on-line for it to remain in your model.</p><p>Enter the full URL to the image:</p>",function(a,b){"ok"==a&&setImage(getSelected(),b)},null,!1,urlImage(getSelected()[0])?getSelected()[0].getAttribute("Image"):"")}},{text:getText("Built-In Images"),menu:g,glyph:61502},"-",{itemId:"fliphitem",text:getText("Flip Horizontal"),
iconCls:"fliph-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("FlipHorizontal"))){var d=new mxCellAttributeChange(b[c],"FlipHorizontal",!isTrue(b[c].getAttribute("FlipHorizontal")));a.getModel().execute(d);setPicture(b[c])}a.getModel().endUpdate()},scope:this},{itemId:"flipvitem",text:getText("Flip Vertical"),iconCls:"flipv-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();
for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("FlipVertical"))){var d=new mxCellAttributeChange(b[c],"FlipVertical",!isTrue(b[c].getAttribute("FlipVertical")));a.getModel().execute(d);setPicture(b[c])}a.getModel().endUpdate()},scope:this}]}},"-",{itemId:"useAsDefaultStyle",text:getText("Use as Default Style"),glyph:61507,handler:function(){var b=getSelected(),c=getStyleSheet();b.forEach(function(b){var d=b.getStyle().split(";"),e={},f=a.getStylesheet().getCellStyle(b.value.nodeName.toLowerCase()),
g;for(g in f)e[g]=f[g];for(f=1;f<d.length;f++)g=d[f].split("="),e[g[0]]=g[1];c[b.value.nodeName]=e});a.getModel().beginUpdate();setStyleSheet(c);a.getModel().endUpdate();loadStyleSheet()},scope:this},{excludeFromContext:!0,itemId:"styleManagerMenu",text:getText("Style Sheet Manager"),glyph:61888,handler:showStyleManager}];return{id:"ribbonPanel",xtype:"panel",layout:"border",region:"center",split:!0,border:!1,items:[b,c],collapsible:!1,tbar:new Ext.toolbar.Toolbar({enableOverflow:!0,items:[{hidden:!viewConfig.primitiveGroup,
text:getText("Add Primitive"),itemId:"valued",iconCls:"green-icon",glyph:61525,menu:[{xtype:"component",indent:!1,html:"<b>"+getText("System Dynamics")+"</b>",disabled:!0,style:{margin:"10px 5px 10px 5px"}},"-",{itemId:"stock",text:getText("Add Stock"),glyph:61874,tooltip:getText("Stocks store material"),handler:function(){var b=createPrimitive("New Stock","Stock",[240,80],[100,40]);highlight(b);a.orderCells(!1)}},{itemId:"variable",text:getText("Add Variable"),glyph:61668,tooltip:getText("Variables can be constant or dynamically updated equations"),
handler:function(){highlight(createPrimitive("New Variable","Variable",[240,80],[120,50]));a.orderCells(!1)}},{itemId:"converter",text:getText("Add Converter"),glyph:61950,tooltip:getText("Converters can contain graphical functions or input/output tables"),handler:function(){highlight(createPrimitive("New Converter","Converter",[240,80],[120,50]));a.orderCells(!1)}},"-",{xtype:"component",indent:!1,html:"<b>"+getText("Agent Based Modeling")+"</b>",disabled:!0,style:{margin:"10px 5px 10px 5px"}},"-",
{itemId:"population",glyph:61632,text:getText("Add Agent Population"),tooltip:getText("Agent populations are a collection of agents"),handler:function(){highlight(createPrimitive("Agent Population","Agents",[240,80],[170,80]));a.orderCells(!1)}},{itemId:"state",glyph:61510,text:getText("Add State"),tooltip:getText("States are binary, true/false variables"),handler:function(){highlight(createPrimitive("New State","State",[240,80],[100,40]))}},{itemId:"action",glyph:61671,text:getText("Add Action"),
tooltip:getText("Actions can trigger a change in the model state"),handler:function(){highlight(createPrimitive("New Action","Action",[240,80],[120,50]));a.orderCells(!1)}},"-",{xtype:"component",indent:!1,html:"<b>"+getText("User Interface")+"</b>",disabled:!0,style:{margin:"10px 5px 10px 5px"}},"-",{itemId:"text",text:getText("Add Text Field"),glyph:61493,tooltip:getText("Annotate your model"),handler:function(){highlight(createPrimitive("New Text","Text",[240,80],[200,50]));a.orderCells(!1)}},
{itemId:"picture",text:getText("Add Picture"),glyph:61502,tooltip:getText("Illustrate your model"),handler:function(){var b=createPrimitive("","Picture",[240,80],[64,64]);setPicture(b);highlight(b);a.orderCells(!1)}},{itemId:"buttonBut",text:getText("Add Interactive Button"),glyph:61846,tooltip:getText("Add interactivity to the model diagram"),handler:function(){highlight(createPrimitive("New Button","Button",[240,80],[120,40]));a.orderCells(!1)}},"-",{itemId:"ghostBut",text:getText("Ghost Primitive"),
glyph:61637,tooltip:getText("Create a linked alias of the selected primitive which can help you organize your model"),scope:this,handler:makeGhost},{itemId:"folder",text:getText("Make Folder"),glyph:61716,tooltip:getText("Create a new Folder containing the selected primitives"),scope:this,handler:makeFolder}]},{xtype:"tbseparator",hidden:!is_editor||is_embed},{hidden:!viewConfig.connectionsGroup,xtype:"segmentedbutton",items:[{text:"Flows/Transitions",id:"connect",pressed:!0,tooltip:"Use flows or transitions to connect primitives. Select a primitive and drag the arrow that appears over the primitive to make a connection. Flows transfer material. Transitions switch between states."},
{text:"Links",tooltip:"Use links to connect primitives. Select a primitive and drag the arrow that appears over the primitive to make a connection. Links transfer information."}]},,{itemId:"reverse",hidden:!viewConfig.connectionsGroup,glyph:61676,tooltip:getText("Reverse connection direction"),handler:reverseDirection,scope:this},{xtype:"tbseparator",hidden:!is_editor||is_embed},{itemId:"config",text:getText("Settings"),glyph:61463,tooltip:getText("Configure time start and stop")+" "+cmd("L"),handler:timeSettingsFn,
scope:this},"-",{hidden:!viewConfig.saveEnabled,text:getText("Save"),glyph:61639,tooltip:getText("Save Insight")+" "+cmd("S"),itemId:"savebut",handler:function(){saveModel()},scope:this},{itemId:"run",text:getText("Simulate"),iconCls:"blue-icon",glyph:61469,tooltip:getText("Run")+" "+cmd("Enter"),handler:function(a,b){runModel()},scope:this},"->",{hidden:!viewConfig.actionsGroup,text:getText("Edit"),itemId:"actions",menu:[{hidden:!viewConfig.actionsGroup,itemId:"undo",text:"Undo",glyph:61666,tooltip:getText("Undo change")+
" "+cmd("Z"),handler:function(){undoHistory.undo()},scope:this},{hidden:!viewConfig.actionsGroup,itemId:"redo",text:"Redo",glyph:61470,tooltip:getText("Redo change")+" "+cmd("Y"),handler:function(){undoHistory.redo()},scope:this},"-",editActions.copy,editActions.cut,editActions.paste,"-",editActions["delete"],"-",{text:getText("Find/Replace..."),tooltip:getText("Find text in your model")+" "+cmd("F"),handler:showFindAndReplace},{text:getText("Find Next"),tooltip:getText("Find the next occurrence of text in your model")+
" "+cmd("G"),handler:function(){var a=Ext.getCmp("findNextBut");a&&!a.disabled&&findNext()}},"-",{text:getText("Print..."),glyph:61487,handler:printGraph},"-",{itemId:"zoomMenuButton",text:getText("Zoom"),glyph:61442,menu:zoomMenu},{text:getText("Layout Diagram"),glyph:61672,menu:[{text:getText("Vertical Hierarchical Layout"),scope:this,handler:function(b){b=new mxHierarchicalLayout(a);executeLayout(b,!0)}},{text:getText("Horizontal Hierarchical Layout"),scope:this,handler:function(b){b=new mxHierarchicalLayout(a,
mxConstants.DIRECTION_WEST);executeLayout(b,!0)}},"-",{text:getText("Organic Layout"),scope:this,handler:function(a){layoutModel("organic")}},{text:getText("Circle Layout"),scope:this,handler:function(a){layoutModel("circular")}}]}]},{hidden:!viewConfig.styleGroup,text:getText("Style"),itemId:"style",menu:styleMenu},{xtype:"tbseparator",hidden:!viewConfig.actionsGroup},{hidden:!viewConfig.styleGroup,text:getText("Share"),itemId:"share",menu:[{hidden:!is_editor||is_ebook,text:getText("Storytelling")+
"...",glyph:61670,tooltip:getText("Display the model step-by-step to tell a story"),handler:blockUnfold(showUnfoldingWin),scope:this},{hidden:!is_editor||is_ebook,text:getText("Publish Article")+"...",glyph:61686,tooltip:getText("Create a crisp, static webpage of describing your model"),handler:blockUnfold(articleWindow),scope:this},"-",{itemId:"embed_but",text:getText("Embed in Webpage")+"...",hidden:!is_editor||is_ebook,glyph:61612,tooltip:getText("Embed this Insight in another web page"),handler:function(){-1==
drupal_node_ID?Ext.MessageBox.show({title:getText("Save the Insight"),msg:getText("You must save this Insight before you can embed it."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR}):Ext.MessageBox.show({title:getText("Embed"),msg:getText("To embed this Insight in another webpage (such as a blog or a private site), copy and paste the following code into the source HTML code of your webpage: %s",'<br/><br/><center><tt>&lt;IFRAME SRC="//InsightMaker.com/insight/'+drupal_node_ID+'/embed?topBar=1&sideBar=1&zoom=1" TITLE="Embedded Insight" width=600 height=420&gt;&lt;/IFRAME&gt;</tt></center><br/>'),
buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},scope:this},"-",{hidden:!is_editor,text:"Import",glyph:61587,menu:[{text:getText("Insight Maker URL..."),handler:function(){showInsertModelWindow({x:200,y:100})}},{text:getText("Insight Maker File..."),handler:importInsightMaker},"-",{text:getText("XMILE File... <span style='color: #bbb'>(Experimental)<span>"),handler:importXMILE}]},{hidden:!is_editor,text:"Export",glyph:61465,menu:[{text:getText("Download Insight Maker File"),handler:function(){(new mxXmlRequest(builder_path+
"/download.php",$.param({name:"Model",format:"InsightMaker",data:getGraphXml(a).replace(/mxGraphModel/g,"InsightMakerModel")}))).simulate(document,"_blank")}},"-",{itemId:"textBut",text:getText("Complete Equation List"),tooltip:getText("A listing of all equations in the Insight"),handler:textEquations,scope:this},{glyph:61893,text:getText("Export Diagram as SVG"),handler:function(){exportSvg()}}]}],glyph:61920},{hidden:!viewConfig.toolsGroup,text:getText("Tools"),itemId:"configgroup",glyph:61613,
menu:[{itemId:"scratchpad",text:getText("Scratchpad"),glyph:61504,tooltip:getText("Draw notes on your diagram")+" "+cmd("K"),enableToggle:!0,handler:scratchpadFn,xtype:"menucheckitem",scope:this},{xtype:"menuseparator",hidden:!is_editor||is_ebook},{text:getText("Identify Loops")+"...",glyph:61902,tooltip:getText("Identify Loops in the Diagram"),handler:doLoops,scope:this},{text:getText("Compare Results")+"...",glyph:61484,tooltip:getText("Compare Separate Simulation Runs"),handler:function(){var a=
0;Ext.WindowMgr.each(function(b){b.down("#pinTool")&&a++});2>a?showNotification(getText("You must have at least two open simulation results windows to do a comparison."),"notice",!0):doCompare()},scope:this},{xtype:"menuseparator",hidden:!is_editor||is_ebook},{itemId:"sensitivityBut",text:getText("Sensitivity Testing")+"...",glyph:61953,tooltip:getText("Model sensitivity testing"),handler:doSensitivity,scope:this},{itemId:"optimizeBut",text:getText("Optimization & Goal Seek")+"...",glyph:61760,tooltip:getText("Optimize model parameters"),
handler:doOptimizer,scope:this},{xtype:"menuseparator",hidden:!is_editor||is_ebook},{hidden:!is_editor||is_embed||is_ebook,itemId:"macroBut",text:getText("Macros & Variables")+"...",glyph:61897,tooltip:getText("Edit macro functions and constants for use anywhere in your equations"),handler:showMacros,scope:this}]},{hidden:is_editor,cls:"button",text:getText("Zoom"),glyph:61442,tooltip:getText("Zoom Diagram"),itemId:"zoomlargebutgrouped",handler:function(a){},menu:zoomMenu},{hidden:is_ebook,cls:"button",
iconCls:"icon-icon",href:"//InsightMaker.com",tooltip:"Insight Maker Home"}]})}};var grid;function getRenderer(a){return"renderer"in a?a.renderer:"boolean"==typeof a.value?function(a){return isTrue(a)?"Yes":"No"}:!1}
function getEditor(a){if("editor"in a)return a.editor;a=a.value;return a instanceof Date?new Ext.form.DateField({selectOnFocus:!0,editable:!0}):"number"==typeof a?Ext.create("Ext.form.field.Number",{selectOnFocus:!0,editable:!0}):"boolean"==typeof a?new Ext.form.ComboBox({triggerAction:"all",store:[["false",getText("No")],["true",getText("Yes")]],selectOnFocus:!1,editable:!1}):new Ext.form.TextField({selectOnFocus:!0})}
function createGrid(a,b,c,d){for(var e=0;e<b.length;e++)configPanel.add(b[e]);if(0<a.length){var f=[];b={};for(e=0;e<a.length;e++){f.push({id:a[e].name,name:a[e].name,text:a[e].text,value:a[e].value,group:a[e].group});"boolean"==typeof f[e].value&&(f[e].value=isTrue(f[e].value).toString());var g={};b[a[e].name]=g;g.displayName=a[e].text;g.editor=getEditor(a[e]);!1!=getRenderer(a[e])&&(g.renderer=getRenderer(a[e]))}a=Ext.create("Ext.data.Store",{fields:[{name:"name",type:"string"},{name:"text",type:"string"},
{name:"value",type:"string"},{name:"group",type:"string"}],data:f,groupField:"group"});handleGridEnables(a,d);e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}",collapsible:!1});grid=Ext.create("Ext.grid.property.Grid",{nameColumnWidth:165,selectedPrimitive:d,store:a,hideHeaders:!0,border:!1,features:[e],sourceConfig:b,viewConfig:{getRowClass:function(a){return!0==a.data.disabled?"disabled-cell":""}},listeners:{beforeedit:viewConfig.allowEdits?function(a,b){if("Solver"==b.record.data.name)return!1;
window.editingRecord=b.record}:function(){return!1}}});configPanel.add(grid);grid.plugins[0].on("edit",function(a,b){is_editor&&saveConfigRecord(b.record,d)})}for(e=0;e<c.length;e++)configPanel.add(c[e])}
function saveConfigRecord(a,b){b=b||getSelected()[0];var c=a.get("name"),d=a.get("value");a.commit();graph.getModel().beginUpdate();try{if("name"!=c||!isPrimitive(b)||validPrimitiveName(String(d),b)){if("name"==c)var e=getName(b);var f=new mxCellAttributeChange(b,c,String(d));graph.getModel().execute(f);"name"==c&&(propogateGhosts(b),propogateName(b,e))}"Folder"==b.value.nodeName&&"Type"==c&&"None"==String(d)&&removeAgent(b);"Stock"==b.value.nodeName&&"AllowNegatives"==c&&(f=new mxCellAttributeChange(b,
"NonNegative",String(!isTrue(d))),graph.getModel().execute(f));"Flow"==b.value.nodeName&&(isTrue(b.getAttribute("OnlyPositive"))?graph.setCellStyles(mxConstants.STYLE_STARTARROW,"",[b]):(graph.setCellStyles(mxConstants.STYLE_STARTARROW,"block",[b]),graph.setCellStyles("startFill",0,[b])));"Link"==b.value.nodeName&&(isTrue(b.getAttribute("BiDirectional"))?graph.setCellStyles(mxConstants.STYLE_STARTARROW,mxConstants.ARROW_CLASSIC,[b]):graph.setCellStyles(mxConstants.STYLE_STARTARROW,"",[b]));"Image"!=
c&&"FlipHorizontal"!=c&&"FlipVertical"!=c||setPicture(b);"LabelPosition"==c&&setLabelPosition(b)}finally{graph.getModel().endUpdate()}handleGridEnables(null,b)}
function handleGridEnables(a,b){var c;c=null!=a?a:grid.getStore();"Folder"==b.value.nodeName&&("Agent"==b.getAttribute("Type")?getGridRecord(c,"AgentBase").set("disabled",!1):getGridRecord(c,"AgentBase").set("disabled",!0));if("Action"==b.value.nodeName||"Transition"==b.value.nodeName)"Condition"==b.getAttribute("Trigger")?getGridRecord(c,"Recalculate").set("disabled",!0):getGridRecord(c,"Recalculate").set("disabled",!1);"Stock"==b.value.nodeName&&("Store"==b.getAttribute("StockMode")?getGridRecord(c,
"Delay").set("disabled",!0):"Conveyor"==b.getAttribute("StockMode")&&getGridRecord(c,"Delay").set("disabled",!1));"Agents"==b.value.nodeName&&("Custom Function"==b.getAttribute("Placement")?getGridRecord(c,"PlacementFunction").set("disabled",!1):getGridRecord(c,"PlacementFunction").set("disabled",!0),"Custom Function"==b.getAttribute("Network")?getGridRecord(c,"NetworkFunction").set("disabled",!1):getGridRecord(c,"NetworkFunction").set("disabled",!0));if(is_editor&&isValued(b)&&"State"!=b.value.nodeName&&
"Action"!=b.value.nodeName){try{getGridRecord(c,"MaxConstraint").set("disabled",!isTrue(b.getAttribute("MaxConstraintUsed"))),getGridRecord(c,"MinConstraint").set("disabled",!isTrue(b.getAttribute("MinConstraintUsed")))}catch(d){}if("Converter"!=b.value.nodeName)try{getGridRecord(c,"SliderMax").set("disabled",!isTrue(b.getAttribute("ShowSlider"))),getGridRecord(c,"SliderMin").set("disabled",!isTrue(b.getAttribute("ShowSlider"))),getGridRecord(c,"SliderStep").set("disabled",!isTrue(b.getAttribute("ShowSlider")))}catch(e){}}}
var ConfigPanel=function(){return{stateful:is_editor&&!is_embed,collapseFirst:!1,tools:[{type:"help",tooltip:getText("Insight Maker Help"),callback:function(a,b,c){showURL("/help")}}],stateId:"config_panel",region:"east",width:viewConfig.sideBarWidth,split:!0,autoScroll:!0,listeners:{beforeexpand:function(a){setSelected([])},beforecollapse:function(){}},collapsible:!mxClient.IS_TOUCH,header:!is_embed,title:getText("Configuration"),border:!1,layout:{type:"vbox",align:"stretch"}}};
function getGridRecord(a,b){return a.getAt(a.findBy(function(a){return a.data.name==b}))};function formatUnitsBut(a){return a&&""!=a.trim()?Ext.util.Format.ellipsis(a,20):"Unitless"}
var EquationEditor=Ext.extend(Ext.form.TextField,{enableKeyEvents:!1,selectOnFocus:!0,triggers:{edit:{hideOnReadOnly:!1,handler:function(){this.editorWindow=new EquationWindow({parent:this,equation:this.getValue(),cell:getSelected()[0],help:this.help});this.editorWindow.show()}}},listeners:{keydown:function(a){a.setEditable(!/\\n/.test(a.getValue()))},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
function EquationWindow(a){function b(a,b){var c="<b>"+b[1].replace(/\$\$/g,"").replace(/##/g,"").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g," ")+"</b><br/>"+b[2];b[3]&&(c+="<br/><br/><b>Example:</b><br/>&nbsp;&nbsp;",c="string"==typeof b[3]?c+b[3].replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g," "):c+b[3][0].replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g," ")+" <b>&rarr;</b> "+b[3][1].replace(/\</g,
"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g," "));u++;p.add({display:" <span class='moreExpander' data-id='"+u+"' style='padding: 0px 8px; float:right; cursor: pointer' class='gray'><i class='fa fa-question-circle' style='color: gray'></i></span>"+b[0]+"<p id='expander"+u+"' style='display:none; font-size: small; white-space: normal' class='gray'>"+c+"</p>",start:b[1].indexOf("##"),end:b[1].indexOf("$$"),insert:b[1].replace(/\#\#/g,"").replace(/\$\$/g,""),tip:c,group:a})}function c(){q.editor.execCommand("gotoright")}
function d(){q.editor.execCommand("gotoleft")}function e(){q.editor.execCommand("backspace")}for(var f=a.equation.replace(/\\n/g,"\n"),g=a.cell,k=[],l=neighborhood(g),m=0;m<l.length;m++)if(!l[m].linkHidden){var n='<i class="fa fa-plus-circle" style="color: green; font-size: 120%"></i> &nbsp;'+clean(l[m].item.getAttribute("name"));"agent"==l[m].type&&(n="<i class='gray'>&nbsp;&nbsp;"+n+"</i>");k.push({insert:"["+l[m].item.getAttribute("name")+"]",display:n,group:" References",tip:void 0})}0==k.length&&
k.push({insert:void 0,group:" References",tip:void 0,display:"<i class='gray'>"+getText("No references available")+"</i>"});for(var p=new Ext.data.Store({autoDestroy:!0,idIndex:0,fields:[{type:"string",name:"insert"},{type:"string",name:"display"},{type:"string",name:"tip"},{type:"string",name:"group"}],groupField:"group",data:k}),q=new Ext.ux.AceEditor({readOnly:!viewConfig.allowEdits,annotations:a.annotations,enterIsSpecial:!0,value:f,width:200,margin:"0 0 0 0",region:"center"}),f=[["Mathematical Functions",
[["Round","Round(##Value$$)","Rounds a number to the nearest integer.",["Round(3.6)","4"]],["Round Up","Ceiling(##Value$$)","Rounds a number up to the nearest integer.",["Ceiling(3.6)","4"]],["Round Down","Floor(##Value$$)","Rounds a number down to the nearest integer.",["Floor(3.6)","3"]],["Cos","Cos(##Angle$$)","Finds the cosine of an angle.",["Cos({180 Degrees})","-1"]],["ArcCos","ArcCos(##Value$$)","Finds the arc-cosine of a value. The result includes units.",["ArcCos(0)","{90 Degrees}"]],["Sin",
"Sin(##Angle$$)","Finds the sine of an angle.",["Sin({180 Degrees})","0"]],["ArcSin","ArcSin(##Value$$)","Finds the arc-sine of a value.  The result includes units.",["ArcSin(1)","{90 Degrees}"]],["Tan","Tan(##Angle$$)","Finds the tangent of an angle.",["Tan({Pi/4 Radians})","1"]],["ArcTan","ArcTan(##Value$$)","Finds the arc-tangent of a value. The result includes units.",["ArcTan(1)","{45 Degrees}"]],["Log","Log(##Value$$)","Returns the base-10 logarithm of a number.",["Log(1000)","3"]],["Ln","Ln(##Value$$)",
"Returns the natural logarithm of a number.",["Ln(e^2)","2"]],["Exp","Exp(##Value$$)","Returns e taken to a power.",["Exp(1)","e"]],["Sum","Sum(##Values$$)","Returns the sum of a vector or list of numbers.",["Sum(7, 5, 6)","18"]],["Product","Product(##Values$$)","Returns the product of a vector or list of numbers.",["Product(2, 4, -1)","-8"]],["Maximum","Max(##Values$$)","Returns the largest of a vector or list of numbers.",["Max(2, 4, -1)","4"]],["Minimum","Min(##Values$$)","Returns the smallest of a vector or list of numbers.",
["Min(2, 4, -1, 3)","-1"]],["Mean","Mean(##Values$$)","Returns the mean of a vector or list of numbers.",["Mean(2, 7, 3)","4"]],["Median","Median(##Values$$)","Returns the median of a vector or list of numbers.",["Median(2, 7, 3)","3"]],["Standard Deviation","StdDev(##Values$$)","Returns the standard deviation of a vector or list of numbers.",["StdDev(1, 2, 3)","1"]],["Absolute Value","Abs(##Value$$)","Returns the absolute value of a number.",["Abs(-23)","23"]],["Mod","##(Value One)$$ mod ##(Value Two)$$",
"Returns the remainder of the division of two numbers.",["13 mod 5","3"]],["Square Root","Sqrt(##Value$$)","Returns the square root of a number.",["Sqrt(9)","3"]],["Sign","Sign(##Value$$)","1 if the value is greater than 0, -1 if it is less than 0, and 0 if it is 0.",["Sign(-12)","-1"]],["Pi","pi","The value 3.14159265."],["e","e","The value 2.71828183."],["Logit","Logit(##Value$$)","Returns the logit transformation of the value. Converts values on a 0 to 1 scale to a -Infinity to Infinity scale.",
["Logit(0.5)","0"]],["Expit","Expit(##Value$$)","Returns the expit transformation of the value. Converts values on a -Infinity to Infinity scale to a 0 to 1 scale.",["Expit(0)","0.5"]]]],["Time Functions",[["Seconds","Seconds()","The current time in seconds.",["Seconds()*1000","The time in milliseconds"]],["Minutes","Minutes()","The current time in minutes.",["Seconds() = Minutes()*60","True"]],["Hours","Hours()","The current time in hours."],["Days","Days()","The current time in days."],["Weeks",
"Weeks()","The current time in weeks."],["Months","Months()","The current time in months."],["Years","Years()","The current time in years.","IfThenElse(Years() > 10, 15, 0)"],["Current Time","Time()","The current time including units.","IfThenElse(Time() > {10 Years}, 15, 0)"],["Time Start","TimeStart()","The simulation start time including units."],["Time Step","TimeStep()","The simulation time step including units."],["Time Length","TimeLength()","The total length of the simulation including units."],
["Time End","TimeEnd()","The time at which the simulation ends including units.",["TimeStart() + TimeLength() = TimeEnd()","True"]],["Seasonal","Seasonal(Peak=0)","Model of seasonality influences. Sine wave with a period of one year, a peak amplitude of one, and a peak at the specified time.",["Seasonal({9 Months})*0.5+1","A wave that oscillates from 0 to 1 and peaks in September"]]]],["Historical Functions",[["Delay","Delay(##[Primitive]$$, ##Delay Length$$, ##Default Value$$)","Returns the value of a primitive for a specified length of time ago. Default Value stands in for the primitive value in the case of negative times.",
"Delay([Income], {5 Years})"],["Delay1","Delay1(##[Primitive]$$, ##Delay Length$$, ##Initial Value$$)","Returns a smoothed, first-order exponential delay of the value of a primitive. The Initial Value is optional.","Delay1([Income], 5, 10000)"],["Delay3","Delay3(##[Primitive]$$, ##Delay Length$$, ##Initial Value$$)","Returns a smoothed, third-order exponential delay of the value of a primitive. The Initial Value is optional.","Delay3([Income], {20 Months}, 10000)"],["Smooth","Smooth(##[Primitive]$$, ##Length$$, ##Initial Value$$)",
"Returns a smoothing of a primitive's past values. Results in an averaged curve fit. Length affects the weight of past values. The Initial Value is optional."],["PastValues","PastValues(##[Primitive]$$, ##Period = All Time$$)","Returns the values a primitive has taken on over the course of the simulation as a vector. The second optional argument is a time window to limit the depth of the history.",["Sum(PastValues([Income]))","Total past income"]],["Maximum","PastMax(##[Primitive]$$, ##Period = All Time$$)",
"Returns the maximum of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation.",["PastMax([Income], {10 Years})","The maximum income in the past 10 years"]],["Minimum","PastMin(##[Primitive]$$, ##Period = All Time$$)","Returns the minimum of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation.",["PastMin([Income], 10)","The minimum income in the past 10 units of time"]],
["Median","PastMedian(##[Primitive]$$, ##Period = All Time$$)","Returns the median of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation."],["Mean","PastMean(##[Primitive]$$, ##Period = All Time$$)","Returns the mean of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation."],["Standard Deviation","PastStdDev(##[Primitive]$$, ##Period = All Time$$)",
"Returns the standard deviation of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation."],["Correlation","PastCorrelation(##[Primitive]$$, ##[Primitive]$$, ##Period = All Time$$)","Returns the correlation between the values that two primitives have taken on over the course of the simulation. The third optional argument is an optional time window to limit the calculation.",["PastCorrelation([Income], [Expenditures], {10 Years})",
"The correlation between income and expenditures over the past 10 years."]],["Fix","Fix(##Value$$, ##Period=-1$$)","Takes the dynamic value and forces it to be fixed over the course of the period. If period is -1, the value is held constant over the course of the whole simulation.",["Fix(Rand(), {5 Years})","Chooses a new random value every five years"]]]],["Random Number Functions",[["Uniform Distribution","Rand(##Minimum$$, ##Maximum$$)","Generates a uniformly distributed random number between the minimum and maximum. The minimum and maximum are optional and default to 0 and 1 respectively.",
["Rand()","0.7481"]],["Normal Distribution","RandNormal(##Mean$$, ##Standard Deviation$$)","Generates a normally distributed random number with a mean and a standard deviation. The mean and standard deviation are optional and default to 0 and 1 respectively.",["RandNormal(10, 1)","11.23"]],["Lognormal Distribution","RandLognormal(##Mean$$, ##Standard Deviation$$)","Generates a log-normally distributed random number with a mean and a standard deviation."],["Binary Distribution","RandBoolean(##Probability$$)",
"Returns 1 with the specified probability, otherwise 0. The probability is optional and defaults to 0.5: a coin flip.",["RandBoolean(0.1)","False"]],["Binomial Distribution","RandBinomial(##Count$$, ##Probability$$)","Generates a binomially distributed random number. The number of successes in Count random events each with Probability of success."],["Negative Binomial","RandNegativeBinomial(##Successes$$, ##Probability$$)","Generates a negative binomially distributed random number. The number of random events each with Probability of success required to generate the specified Successes."],
["Poisson Distribution","RandPoisson(##Lambda$$)","Generates a Poisson distributed random number."],["Triangular Distribution","RandTriangular(##Minimum$$, ##Maximum$$, ##Peak$$)","Generates a triangularly distributed random number."],["Exponential Distribution","RandExp(##Lambda$$)","Generates an exponentially distributed random number with the specified rate parameter."],["Gamma Distribution","RandGamma(##Alpha$$, ##Beta$$)","Generates a Gamma distributed random number."],["Beta Distribution","RandBeta(##Alpha$$, ##Beta$$)",
"Generates a Beta distributed random number."],["Custom Distribution","RandDist(##X$$, ##Y$$)","Generates a random number according to a custom distribution. Takes two vectors with the x- and y-coordinates respectively of points defining the distribution. Points are interpolated linearly. The distribution does not have to be normalized such that its area is 1, but the points must be sorted from smallest to largest x locations. You may also pass a single vector containing pairs of {x, y} coordinates (e.g. { {1, 0}, {3, 4}, {4, 0} } ).",
["RandDist({0, 1, 2, 3}, {0, 5, 1, 0})","1.2"]]]],["Agent Functions",[["Find All","##[Agent Population]$$.FindAll()","Returns a vector of all the agents in the agent population."],["Find State","##[Agent Population]$$.FindState(##[State]$$)","Returns a vector of agents in the specified state.",["[University].FindState([Smoker])","All smokers in the University population"]],["Find Not State","##[Agent Population]$$.FindNotState(##[State]$$)","Returns a vector of agents not in the specified state.",
["[University].FindNotState([Smoker])","All non-smokers in the University population"]],["Find Index","##[Agent Population]$$.FindIndex(##Index$$)","Returns an agent with the specified index. Agent indexes start at 1.",["[Population].FindIndex(1)","The first agent created"]],["Find Nearby","##[Agent Population]$$.FindNearby(##Target$$, ##Distance$$)","Returns a vector of agents that are within the specified distance of a target agent or location.",["[Population].FindState([Infected]).FindNearby(Self, 25)",
"All infected people who are near the agent"]],["Find Nearest","##[Agent Population]$$.FindNearest(##Target$$, ##Count=1$$)","Returns the nearest agents to the target agent or location. The number of agents returned is specified by the optional Count.",["[Population].FindNearest(Target)","The nearest agent to the target."]],["Find Furthest","##[Agent Population]$$.FindFurthest(##Target$$, ##Count=1$$)","Returns the agent farthest from the target agent or location. The number of agents returned is specified by the optional Count.",
["[Population].FindFurthest(Target, 4)","The four furthest agents from the target"]],["Value","##[Agent Population]$$.Value(##[Primitive]$$)","Returns the values of the specified primitive for each agent in the population as a vector.",["[University].Value([GPA]).Mean()","The average GPA of all students in the University population"]],["Set Value","##[Agent Population]$$.SetValue(##[Primitive]$$, ##Value$$)","Sets the value of the specified primitive for each agent in the population to the given value. Can also be applied directly to an agent.",
["[University].SetValue([Smoker], false)","Make all the smokers quit smoking"]],["Location","##[Agent]$$.Location()","Returns the location of an agent as the vector {x, y}.",["Self.Location().x","The x-coordinate of the agent"]],["Set Location","##[Agent]$$.SetLocation(##New Location$$)","Sets the location of the agent.",["[Student].SetLocation({x: 60, y: 40})","Moves the student to a new position"]],["Index","##[Agent]$$.Index()","Gets the numeric index of an agent within an agent population. Indexes are sequential within a population and start at 1."],
["Distance","Distance(##Location 1$$, ##Location 2$$)","Returns the distance between two agents or locations."],["Move","##[Agent]$$.Move(##{x, y}$$)","Moves an agent the amount specified.",["Self.Move({Rand(), Rand()})","Take a random walk"]],["MoveTowards","##[Agent]$$.MoveTowards(##Target$$, ##Distance$$)","Moves an agent towards a target agent or location by the distance specified.",["Self.MoveTowards({0, 100}, 10)","Moves towards the point {0, 100}."]],["Connected","##[Agent]$$.Connected()",
"Returns the agents connected to an agent in the network.",["Self.Connected().Length()","The number of connections an agent has"]],["Connect","##[Agent 1]$$.Connect(##[Agent 2]$$, ##Weight=1$$)","Connects two agents in the network. The second agent can also be a vector of agents. Optionally, you can specify a connection weight which will be stored with the connection.",["Self.Connect([Population].FindNearest(Self))","Connects an agent to the nearest agent to it in the population"]],["Unconnect","##[Agent 1]$$.Unconnect(##[Agent 2]$$)",
"Unconnects two agents in the network. The second agent can also be a vector of agents.",["Self.Unconnect(Self.Connected())","Removes an agent's connections"]],["Connection Weight","##[Agent 1]$$.ConnectionWeight(##[Agent 2]$$)","Returns the connection weight between two agents."],["Set Connection Weight","##[Agent 1]$$.SetConnectionWeight(##[Agent 2]$$, ##Weight$$)","Sets the connection weight between two agents."],["PopulationSize","##[Agent Population]$$.PopulationSize()","The total number of agents in a population."],
["Add","##[Agent Population]$$.Add(##Base Agent=Initial Agent$$)","Adds a new agent to the population. If Base is set, the new agent will be a clone of [Base]. Otherwise the agent will be like a newly created agent at the start of the simulation.",["Repeat([University].Add(), 200)","Enroll 200 new students in the University"]],["Remove","##[Agent]$$.Remove()",'Removes an agent from the population. The agent will no longer be simulated. Can be used to "Kill" an agent.',["[University].FindState([Smoker]).Map(x.Remove())",
"Expel all the smokers from the University"]],["Width","Width(##Agent$$)","The width of the geographic region an agent is within."],["Height","Height(##Agent$$)","The height of the geographic region an agent is within."]]],["Vector Functions",[["Range","##Start$$:##End$$",'Creates a vector with a range of sequential values going from start to end. To use step sizes other than 1, place the step size between the start and the end, for example "0:0.5:10".',["1:5","{1, 2, 3, 4, 5}"]],["Length","##Vector$$.Length()",
"The number of elements in a vector. Count() is a synonym for length.",["{1, 1, 2, 3}.Length()","4"]],["Select","##Vector$${##Selector$$}","Selects one or more elements from a vector. The selector can be an integer or vector of integers, a string or vector of strings (for named vectors), or a vector of booleans.",["{1,3,7}{2}","3"]],["Join","Join(##Item 1$$, ##Item 2$$, ##Item N$$)","Merges items together into a single vector.",["Join(0, {1, 1, 2})","{0, 1, 1, 2}"]],["Flatten","##Vector$$.Flatten()",
"Flattens a vector removing and expanding all nested vectors.",["{ {0}, {1, 1, 2} }.Flatten()","{0, 1, 1, 2}"]],["Unique","##Vector$$.Unique()","Returns a vector with duplicates removed.",["{1, 1, 2, 3}.Unique()","{1, 2, 3}"]],["Union","##Vector$$.Union(##Vector 2$$)","Returns the combined elements of two vectors (with duplicates removed).",["{1, 2}.Union({2, 3})","{1, 2, 3}"]],["Intersection","##Vector$$.Intersection(##Vector 2$$)","Returns the elements that exist in both vectors.",["{1, 2}.Intersection({2, 3})",
"{2}"]],["Difference","##Vector$$.Difference(##Vector 2$$)","Returns the elements that exist in only one of the two vectors.",["{1, 2}.Difference({2, 3})","{1, 3}"]],["Sort","##Vector$$.Sort()","Sorts a vector from smallest value to largest value.",["{1, 3, 2}.Sort()","{1, 2, 3}"]],["Reverse","##Vector$$.Reverse()","Reverses the ordering of elements in a vector.",["{1, 2, 3}.Reverse()","{3, 2, 1}"]],["Sample","##Vector$$.Sample(##Sample Size$$, ##Allow Repeats=False$$)","Takes a random sample from a vector. Allow Repeats determines whether the same index can be sampled multiple time and is false by default.",
["{1, 4, 9}.Sample(2)","{9, 1}"]],["IndexOf","##Vector$$.IndexOf(##Needle$$)","Returns the position of the needle within the vector (starting with index 1). If the needle is not found, 0 is returned.",["{1, 4, 9}.IndexOf(9)","3"]],["Contains","##Vector$$.Contains(##Needle$$)","Returns true if the needle is in the vector. Otherwise returns false.",["{1, 4, 9}.Contains(9)","true"]],["Repeat","Repeat(##Expression$$, ##Times$$)","Creates a new vector by repeating an expression a specified expression a number of times. 'x' in the expression refers to the current index. Times may also be a vector of strings in which case a named vector is created.",
["Repeat(x^2, 3)","{1, 4, 9}"]],["Map","##Vector$$.Map(##Function$$)","Applies a function to each element of a vector and returns the result. The function may also be an expression where 'x' in the expression represents the current element and, for named vectors, 'key' represents the current element's key.",["{1, 2, 3}.Map(x*2)","{2, 4, 6}"]],["Filter","##Vector$$.Filter(##Function$$)","Tests each element of a vector using a function and returns the elements which evaluate to true. The function may also be an expression where 'x' in the expression represents the current element.",
["{1, 2, 3}.Filter(x >= 2)","{2, 3}"]],["Keys","##Vector$$.Keys()","Returns the keys for a named vector as a vector. Any element without a key will be omitted.",["{a: 1, b: 4, b: 9}.Keys()","{'a', 'b', 'c'}"]],["Values","##Vector$$.Values()","Returns the values of a vector (stripping away any keys if it is a named vector).",["{a: 1, b: 4, b: 9}.Values()","{1, 4, 9}"]]]],["General Functions",[["If Then Else","IfThenElse(##Test Condition$$, ##Value if True$$, ##Value if False$$)","Tests a condition and returns one value if the condition is true and another value if the condition is false.",
["IfThenElse(20 > 10, 7, 5)","7"]],["Lookup","Lookup(##Value$$, ##Values Vector$$, ##Results Vector$$)","Finds the Value in the Values Vector and returns the corresponding item in the Results Vector. If the exact Value is not found in the Values Vector, linear interpolation of the nearby values will be used.",["Lookup(6, {5, 7}, {10, 15})","12.5"]],["Pulse","Pulse(##Time$$, ##Height$$, ##Width=0$$, ##Repeat=-1$$)","Creates a pulse input at the specified time with the specified Height and Width. Height defaults to 1 and Width defaults to 0. Repeat is optional and will create a pulse train with the specified time if positive..",
"Pulse({10 Years}, 5, 2)"],["Step","Step(##Start$$, ##Height=1$$)","Creates an input that is initially set to 0 and after the time of Start is set to Height. Height defaults to 1.","Step({10 Years}, 5)"],["Ramp","Ramp(##Start$$, ##Finish$$, ##Height=1$$)","Creates a ramp input which moves linearly from 0 to Height between the Start and Finish times. Before Start, the value is 0; after Finish, the value is Height. Height defaults to 1.","Ramp({10 Year}, {20 Years}, 5)"],["Pause","Pause()","Pauses the simulation and allows sliders to be adjusted. Often used in combination with an IfThenElse function.",
"IfThenElse(Years() = 20, Pause(), 0)"],["Stop","Stop()","Immediately terminates the simulation. Often used in combination with an IfThenElse function.","IfThenElse(Rand() < 0.01, Stop(), 0)"]]],["String Functions",[["Length","##String$$.Length()","The length of a string in characters.",['"abcde".Length()',"5"]],["Range","##String$$.Range(##Characters$$)","Obtains a certain character or set of characters.",['"abcde".Range(2:4)','"bcd"']],["Split","##String$$.Split(##Deliminator$$)","Splits a string into a vector at the locations of the Deliminator.",
['"abcde".Split("c")','{"ab", "de"}']],["IndexOf","##String$$.IndexOf(##Needle$$)","Finds the location of the first occurrence of the needle in the string.",['"abcde".IndexOf("c")',"3"]],["Contains","##String$$.Contains(##Needle$$)","Returns true if the needle is in the string. Otherwise returns false.",['"abcde".Contains("cd")',"true"]],["UpperCase","##String$$.UpperCase()","Uppercases all letters in a string.",['"Test".UpperCase()','"TEST"']],["LowerCase","##String$$.LowerCase()","Lowercases all letters in a string.",
['"Test".LowerCase()','"test"']],["Join","##Vector$$.Join(##String$$)","Combines the characters in a vector using the given string.",['{"a", "bc", "d"}.Join("-")','"a-bc-d"']],["Trim","##String$$.Trim()","Removes whitespace on either side of a string.",['" abc  ".Trim()','"abc"']],["Parse","##String$$.Parse()","Converts a string to a number.",['"1.2".Parse() + 3.3',"4.5"]]]],["Programming Functions",[["Variables","##Variable$$ <- ##Value$$","Assigns a value to a reusable variable.",["x <- 10\nx^2",
"100"]],["If-Then-Else","If ##Condition$$ Then\n  ##Expression$$\nElse If ##Condition$$ Then\n  ##Expression$$\nElse\n  ##Expression$$\nEnd If","Test one or more conditions and selectively execute code based on these tests."],["While Loop","While ##Condition$$\n  ##Expression$$\nEnd Loop","Repeats an action until a condition is no longer true.",["x <- 1\nWhile x < 10\n  x <- x*2\nEnd Loop\nx","16"]],["For-In Loop","For ##Variable$$ in ##Vector$$\n  ##Expression$$\nEnd Loop","Repeats an action for each element in a vector.",
["sum <- 0\nFor x in {1, 10, 27}\n  sum <- sum + x\nEnd Loop\nsum","38"]],["Functions","Function ##Name$$()\n  ##Expression$$\nEnd Function","Creates a reusable function.",["Function Square(x)\n  x^2\nEnd Function\nSquare(5)","25"]],["Anonymous Functions","##Variable$$ <- Function()\n  ##Expression$$\nEnd Function","Creates an anonymous function.",["square <- Function(x)\n  x^2\nEnd Function\nsquare(5)","25"]],["Anonymous Functions","Function() ##Expression$$","Creates a single-line anonymous function.",
["{1, 2, 3}.Map(Function(value) value^2 - value)","{0, 2, 6}"]],["Throwing Errors","throw '##Message$$'","Passes an error message up to the nearest Try-Catch block or aborts the simulation with the error message.",'throw "Error: Index out of range."'],["Error Handling","Try\n  ##Expression$$\nCatch ##ErrorString$$\n  ##Expression // Handle the error$$\nEnd Try","Attempts to execute some code. If an error occurs, the error is passed as a string variable to the catch block which will then be executed. The catch block will not be executed unless an error occurs.",
'Try\n  mean(x)\nCatch err\n  alert("Could not calculate the mean of the variable. Error Message: "+err)\nEnd Try']]],["User Input Functions",[["Alert","Alert(##Message$$)","Show an alert dialogue with the message.",'Alert("An event has occurred.")'],["Prompt","Prompt(##Message$$, ##Default=''$$)","Prompts the user for an input and returns it. Can optionally provide a default value for the input.",'timeScale <- Prompt("What time scale should we use?.", 10).Parse()'],["Confirm","Confirm(##Message$$)",
"Prompts the user to confirm a statement and returns a boolean based on whether they confirmed it or not.",'advanced <- Confirm("Use advanced mode?")']]],["Statistical Distributions",[["CDFNormal","CDFNormal(##x$$, ##Mean=0$$, ##StandardDeviation=1$$)","Returns the value of x in the CDF of the Normal Distribution.",["CDFNormal(1.96)","0.975"]],["PDFNormal","PDFNormal(##x$$, ##Mean=0$$, ##StandardDeviation=1$$)","Returns the value of x in the PDF of the Normal Distribution.",["PDFNormal(1.5, 0, 1)",
"0.12"]],["InvNormal","InvNormal(##p$$, ##Mean=0$$, ##StandardDeviation=1$$)","Returns the value of p in the inverse CDF of the Normal Distribution.",["InvNormal(0.975)","1.96"]],["CDFLognormal","CDFLognormal(##x$$, ##Mean=0$$, ##StandardDeviation=1$$)","Returns the value of x in the CDF of the Lognormal Distribution."],["PDFLognormal","PDFLognormal(##x$$, ##Mean=0$$, ##StandardDeviation=1$$)","Returns the value of x in the PDF of the Lognormal Distribution."],["InvLognormal","InvLognormal(##p$$, ##Mean=0$$, ##StandardDeviation=1$$)",
"Returns the value of p in the inverse CDF of the Lognormal Distribution."],["CDFt","CDFt(##x$$, ##DegreesOfFreedom$$)","Returns the value of x in the CDF of Student's t Distribution."],["PDFt","PDFt(##x$$, ##DegreesOfFreedom$$)","Returns the value of x in the PDF of Student's t Distribution."],["Invt","Invt(##p$$, ##DegreesOfFreedom$$)","Returns the value of p in the inverse CDF of Student's t Distribution."],["CDFF","CDFF(##x$$, ##DegreesOfFreedom1$$, ##DegreesOfFreedom2$$)","Returns the value of x in the CDF of the F Distribution."],
["PDFF","PDFF(##x$$, ##DegreesOfFreedom1$$, ##DegreesOfFreedom2$$)","Returns the value of x in the PDF of the F Distribution."],["InvF","InvF(##p$$, ##DegreesOfFreedom1$$, ##DegreesOfFreedom2$$)","Returns the value of p in the inverse CDF of the F Distribution."],["CDFChiSquared","CDFChiSquared(##x$$, ##DegreesOfFreedom$$)","Returns the value of x in the CDF of the Chi-Squared Distribution."],["PDFChiSquared","PDFChiSquared(##x$$, ##DegreesOfFreedom$$)","Returns the value of x in the PDF of the Chi-Squared Distribution."],
["InvChiSquared","InvChiSquared(##p$$, ##DegreesOfFreedom$$)","Returns the value of p in the inverse CDF of the Chi-Squared Distribution."],["CDFExponential","CDFExponential(##x$$, ##Rate$$)","Returns the value of x in the CDF of the Exponential Distribution."],["PDFExponential","PDFExponential(##x$$, ##Rate$$)","Returns the value of x in the PDF of the Exponential Distribution."],["InvExponential","InvExponential(##p$$, ##Rate$$)","Returns the value of p in the inverse CDF of the Exponential Distribution."],
["CDFPoisson","CDFPoisson(##x$$, ##Lambda$$)","Returns the value of x in the CDF of the Poisson Distribution."],["PMFPoisson","PMFPoisson(##x$$, ##Lambda$$)","Returns the value of x in the PMF of the Poisson Distribution."]]]],u=0,m=0;m<f.length;m++)for(k=0;k<f[m][1].length;k++)b(f[m][0],f[m][1][k]);var v=new Ext.grid.Panel({hidden:!viewConfig.allowEdits,store:p,split:!0,region:"east",hideHeaders:!0,width:viewConfig.referenceBarWidth,margin:"0 0 0 4",hideGroupedHeader:!0,columns:[{header:"References",
flex:1,dataIndex:"display",sortable:!1}],features:[{groupHeaderTpl:"{name}",ftype:"grouping",startCollapsed:!0,hideGroupedHeader:!0,id:"typeGrouping"}]});v.view.getFeature("typeGrouping").expand(" References");v.view.on("groupexpand",function(a,b){v.getEl().query(".moreExpander",!1).forEach(function(a){1!=a.getAttribute("data-processed")&&(a.on("click",function(b){var c=Ext.get("expander"+a.getAttribute("data-id"));c.setVisibilityMode(2);c.toggle();b.stopPropagation()}),a.set({"data-processed":1}))})});
if(mxClient.IS_TOUCH)var m=function(a,b){b=b||{};return new Ext.Button({text:a,colspan:b.colspan,width:b.width||n,height:b.height||n,rowspan:b.rowspan,style:b.opacity?"opacity:"+b.opacity:"opacity: .7",handler:b.handler||function(){q.insertText(b.insert||a);q.editor.focus()},margin:b.margin||y})},n=40,y=3,m=new Ext.panel.Panel({margin:0,region:"west",frame:!1,border:!1,layout:{type:"table",columns:5},items:[m("("),m(")"),m("{"),m("}"),m(","),m("7",{opacity:1}),m("8",{opacity:1}),m("9",{opacity:1}),
m("*"),m("/"),m("4",{opacity:1}),m("5",{opacity:1}),m("6",{opacity:1}),m("+"),m("-"),m("1",{opacity:1}),m("2",{opacity:1}),m("3",{opacity:1}),m("^"),m("="),m("0",{opacity:1}),m(".",{opacity:1}),m(" ",{colspan:2,width:2*n+2*y}),m("#"),m("<small>\u2b05</small>",{handler:e}),m("\u2190",{colspan:2,width:2*n+2*y,handler:d}),m("\u2192",{colspan:2,width:2*n+2*y,handler:c})]});else m=new Ext.Component({html:"<span style='font-size: 280%'>=</span>",region:"west",margin:"5 0 0 3"});f=getText("Equation Editor");
l=g.value.nodeName;"Stock"==l?f=getText("Initial Value Equation"):"Variable"==l?f=getText("Variable Equation"):"State"==l?f=getText("Initial Active Equation"):"Flow"==l?f=getText("Flow Rate Equation"):"Transition"==l&&(f=getText("Transition Equation"));k="";a.help&&(k=a.help.toLowerCase?a.help:a.help(a));var z={State:"This equation determines whether or not the state starts active. The result of the equation should be a value like <tt>True</tt> or <tt>False</tt>. Logical statements like <tt>[Primitive] > 10</tt> are commonly used.",
Flow:"Material will move out of the source stock and into the sink stock at the rate determined by this equation.",Stock:"The initial value of the stock will be calculated by this equation. Inflows and outflows can increase or decrease the stock's value over time.",Variable:"The variable will take on the value calculated from this equation. The value will be recalculated as the simulation progresses.",Action:"This code will be executed when the action triggers. You can use it to adjust values in your simulation or make other changes such as moving agents.",
Transition:function(a){a=a.cell;if("Probability"==a.getAttribute("Trigger"))return"The transition is currently using the <i>Probability</i> trigger. For this trigger type, the value of the equation is the probability of the transition happening each unit of time.";if("Condition"==a.getAttribute("Trigger"))return"The transition is currently using the <i>Condition</i> trigger. For this trigger type, the transition will happen when the equation evaluates to <tt>True</tt>.";if("Timeout"==a.getAttribute("Trigger"))return"The transition is currently using the <i>Timeout</i> trigger. For this trigger type, the transition will happen after the time specified by this equation passes."}};
!k&&z[l]&&(k=z[l].toLowerCase?z[l]:z[l](a));var l={xtype:"container",hidden:!a.extra,items:[a.extra],region:"south",padding:6,style:{"background-color":"#eee"}},x=new Ext.Component({xtype:"box",html:k,hidden:!k||Ext.state.Manager.get("equationHelpCollapsed",!1),region:"north",padding:6,style:{"background-color":"#eee","font-size":"small"}}),B=new Ext.Window({title:f+": "+clean(g.getAttribute("name")),layout:"border",stateful:is_editor&&!is_embed,stateId:"equation_window",closeAction:"destroy",border:!1,
modal:!0,closable:!0,tools:[{type:"help",tooltip:getText("About Equations"),callback:function(a,b,c){showURL("/equations")}},{id:"upButton",type:"up",tooltip:getText("Hide Description"),hidden:!k||Ext.state.Manager.get("equationHelpCollapsed",!1),callback:function(a,b,c){x.setVisible(!1);b.hide();Ext.getCmp("downButton").show();Ext.state.Manager.set("equationHelpCollapsed",!0)}},{id:"downButton",type:"down",tooltip:getText("Show Description"),hidden:!k||!Ext.state.Manager.get("equationHelpCollapsed",
!1),callback:function(a,b,c){x.setVisible(!0);b.hide();Ext.getCmp("upButton").show();Ext.state.Manager.set("equationHelpCollapsed",!1)}}],items:[q,v,m,x,l],minHeight:400,minWidth:550,width:Math.min(Ext.getBody().getViewSize().width,mxClient.IS_TOUCH?770:720),height:Math.min(Ext.getBody().getViewSize().height,500),resizable:!0,maximizable:!0,shadow:!0,buttonAlign:"left",buttons:[{hidden:!viewConfig.allowEdits||"State"==g.value.nodeName||"Action"==g.value.nodeName||"Transition"==g.value.nodeName||"Agents"==
g.value.nodeName,scale:"large",id:"equationUnitsBut",text:formatUnitsBut(g.getAttribute("Units")),glyph:61918,tooltip:getText("Primitive units"),handler:function(){(new UnitsWindow({parent:"",cell:g,units:g.getAttribute("Units")})).show()}},"->",{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){B.close();""!=a.parent&&a.parent.resumeEvents()}},{hidden:!viewConfig.allowEdits,glyph:61452,scale:"large",text:getText("Apply"),handler:function(){var b=q.getValue(),b=b.replace(/\n|\r/g,
"\\n");B.close();""!=a.parent?(editingRecord.set("value",b),saveConfigRecord(editingRecord),a.saveExtra&&a.saveExtra()):(graph.getModel().beginUpdate(),setValue(a.cell,b),a.saveExtra&&a.saveExtra(),graph.getModel().endUpdate(),selectionChanged(!1))}}]});v.on("beforeselect",function(a,b,c,d){b.data.insert&&(q.insertText(b.data.insert),q.editor.focus());return!1});this.show=function(){B.show();q.focus(!0,!0);q.editor.focus();setTimeout(function(){q.editor.focus()},100)}};var ConverterEditor=Ext.extend(Ext.form.TextField,{enableKeyEvents:!1,selectOnFocus:!0,stripCharsRe:/[^0-9\;\,\. \-]/g,triggers:{edit:{hideOnReadOnly:!1,handler:function(){this.editorWindow=new ConverterWindow({parent:this,oldKeys:this.getValue(),interpolation:graph.getSelectionCell().getAttribute("Interpolation")});this.editorWindow.show()}}},listeners:{keydown:function(a){a.setEditable(!1)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
function ConverterWindow(a){function b(){for(var a="",b=0;b<g.getCount();b++)0<b&&(a+="; "),a=a+g.getAt(b).data.xVal+","+g.getAt(b).data.yVal;return a}var c=[];if(!isUndefined(a.oldKeys))for(var d=a.oldKeys.split(";"),e=0;e<d.length;e++){var f=d[e].split(",");c.push({xVal:parseFloat(f[0]),yVal:parseFloat(f[1])})}var g=new Ext.data.Store({fields:[{name:"xVal",type:"float"},{name:"yVal",type:"float"}],data:c,sorters:["xVal"]}),k=new Ext.grid.plugin.CellEditing({clicksToEdit:1}),l=new Ext.grid.GridPanel({store:g,
width:600,region:"center",plugins:[k],viewConfig:{headersDisabled:!0,markDirty:!1},tbar:["Click on the chart to add a point.<br/>Shift-click to remove. Option-click to move.","->",{hidden:!viewConfig.allowEdits,text:getText("Import"),glyph:61646,tooltip:getText("Import data from a CSV or other text file"),handler:function(){importData(g)}},{glyph:61525,iconCls:"green-icon",text:getText("Add Point"),handler:function(){k.completeEdit();g.insert(0,{xVal:0,yVal:0});g.sort("xVal","ASC");l.getView().refresh();
var a=g.findBy(function(a){return 0==a.get("xVal")&&0==a.get("yVal")});l.getSelectionModel().selectRange(a,a);k.startEdit(a,a)}}],columns:[{id:"xVal",header:getText("Input Value"),dataIndex:"xVal",flex:1,sortable:!1,menuDisabled:!0,editor:{xtype:"numberfield",allowBlank:!1,decimalPrecision:10,selectOnFocus:!0}},{header:getText("Output Value"),dataIndex:"yVal",flex:1,sortable:!1,menuDisabled:!0,editor:{xtype:"numberfield",allowBlank:!1,decimalPrecision:10,selectOnFocus:!0}},{xtype:"actioncolumn",width:40,
items:[{iconCls:"units-remove-icon",tooltip:getText("Delete"),handler:function(a,b,c){g.remove(g.getAt(b));g.sort("xVal","ASC");l.getView().refresh()}}]}]}),c=g,d="",m;m=""!=a.parent?graph.getSelectionCell():a.cell;var d="Time"==m.getAttribute("Source")?"Time":findID(m.getAttribute("Source")).getAttribute("name"),n=new Ext.chart.CartesianChart({store:c,animate:!1,shadow:!1,axes:[{type:"numeric",position:"left",fields:["yVal"],title:{text:getText("Output"),fontSize:14},titleMargin:20,grid:!0},{type:"numeric",
position:"bottom",fields:["xVal"],title:{text:getText("Input")+" ("+clean(d)+")",fontSize:14},titleMargin:16,grid:!0}],series:[{type:"line",axis:"left",showMarkers:!0,smooth:!1,step:"Linear"!=a.interpolation,style:{"stroke-width":3},marker:{radius:4},xField:"xVal",yField:"yVal"}]}),c=new Ext.Panel({height:180,layout:"fit",region:"north",split:!0,minHeight:100,maxHeight:500,items:n}),p=new Ext.Window({title:getText("Converter Data Specification"),layout:"border",closeAction:"destroy",tools:[{type:"help",
tooltip:getText("Get Help"),callback:function(a,b,c){showURL("/converters")}}],border:!1,stateful:is_editor&&!is_embed,stateId:"converter_window",modal:!0,resizable:!0,maximizable:!0,shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},listeners:{afterrender:function(){n.getEl().on({click:function(a){var b=n.getEventXY(a),c=b[0],d=b[1],b=n.getInnerRect(),d=b[3]-d,e=n.getAxes()[0].getRange(),f=n.getAxes()[1].getRange(),c=f[0]+c/b[2]*(f[1]-f[0]),d=e[0]+d/b[3]*(e[1]-e[0]),m=1/b[2]*(f[1]-f[0]),p=1/b[3]*
(e[1]-e[0]),D,E,b=m.toExponential().split("e")[1];D="-"==b[1]?(Math.round(c/Math.pow(10,b+1))*Math.pow(10,b+1)).toPrecision(9):(Math.round(c/Math.pow(10,b-1))*Math.pow(10,b-1)).toPrecision(9);b=p.toExponential().split("e")[1];E="-"==b[1]?(Math.round(d/Math.pow(10,b+1))*Math.pow(10,b+1)).toPrecision(9):(Math.round(d/Math.pow(10,b-1))*Math.pow(10,b-1)).toPrecision(9);if(a.shiftKey)b=g.findBy(function(a){return a.get("xVal")>c-4*m&&a.get("xVal")<c+4*m&&a.get("yVal")>d-4*p&&a.get("yVal")<d+4*p}),-1<b&&
g.remove(g.getAt(b));else if(a.altKey){if(0<g.count()){b=g.getAt(0);for(e=1;e<g.count();e++)Math.abs(b.get("xVal")-c)>Math.abs(g.getAt(e).get("xVal")-c)&&(b=g.getAt(e));b.set("xVal",D);b.set("yVal",E)}}else b=g.findBy(function(a){return a.get("xVal")>c-5*m&&a.get("xVal")<c+5*m}),(b=-1<b?g.getAt(b):null)?b.set("yVal",E):(a={xVal:D,yVal:E},k.completeEdit(),g.insert(0,a));g.sort("xVal","ASC");a.shiftKey||(a=g.findBy(function(a){return a.get("xVal")==D&&a.get("yVal")==E}),0<=a&&l.getSelectionModel().selectRange(a,
a));l.getView().refresh()}})}},width:Math.min(Ext.getBody().getViewSize().width,560),height:Math.min(Ext.getBody().getViewSize().height,530),minWidth:550,minHeight:500,items:[c,l],buttons:[{hidden:!viewConfig.allowEdits,scale:"large",id:"equationUnitsBut",text:formatUnitsBut(m.getAttribute("Units")),glyph:61918,tooltip:getText("Primitive units"),handler:function(){(new UnitsWindow({parent:"",cell:a.cell,units:a.cell.getAttribute("Units")})).show()}},"->",{scale:"large",glyph:61532,text:getText("Cancel"),
handler:function(){p.close();""!=a.parent&&a.parent.resumeEvents()}},{hidden:!viewConfig.allowEdits,scale:"large",glyph:61452,text:getText("Apply"),handler:function(){k.completeEdit();""!=a.parent?(editingRecord.set("value",b()),saveConfigRecord(editingRecord)):(graph.getModel().beginUpdate(),setValue(m,b()),graph.getModel().endUpdate());p.close();""!=a.parent?(a.parent.resumeEvents(),grid.plugins[0].completeEdit()):selectionChanged(!1)}}]});window.chart=n;g.on("update",function(){g.sort("xVal","ASC")});
this.show=function(){p.show()}};var compareResults={win:null,resultsStore:new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),primitiveStore:new Ext.data.JsonStore({fields:[{name:"rid",type:"string"},{name:"rname",type:"string"}],data:[]})};
function doCompare(){var a=[],b=[],c=[];Ext.WindowMgr.each(function(c){c.down("#pinTool")&&(b.push(c.analysisCount),a.push({rid:c.analysisCount,rname:c.getTitle()}))});for(var d=[],e=excludeType(primitives(),"Ghost"),f=0;f<e.length;f++)isValued(e[f])&&!inAgent(e[f])&&(c.push(e[f].id),d.push({pid:e[f].id,pname:e[f].getAttribute("name")}));d.sort(function(a,b){return a.pname<b.pname?-1:a.pname>b.pname?1:0});compareResults.win||(e=new Ext.FormPanel({fieldDefaults:{labelWidth:195,width:"100%"},autoScroll:!0,
frame:!1,bodyStyle:"padding: 10px",defaultType:"textfield",items:[Ext.create("Ext.form.field.Tag",{fieldLabel:getText("Results to Compare"),itemId:"selResults",displayField:"rname",filterPickList:!0,valueField:"rid",queryMode:"local",store:compareResults.resultsStore,emptyText:getText("Select results windows")}),Ext.create("Ext.form.field.Tag",{fieldLabel:getText("Primitives to Contrast"),itemId:"selPrimitives",displayField:"pname",filterPickList:!0,valueField:"pid",queryMode:"local",store:compareResults.primitiveStore,
emptyText:getText("Select primitives")})]}),compareResults.win=new Ext.Window({title:getText("Compare Simulation Results"),layout:"fit",closeAction:"hide",border:!1,modal:!0,resizable:!1,maximizable:!1,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,480),autoHeight:!0,items:[e],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){compareResults.win.close()}},{scale:"large",glyph:61452,text:getText("Compare"),handler:function(){var a=
compareResults.win.down("#selPrimitives").getValue();if(0==a.length)showNotification(getText("You must select at least one primitive to contrast."),"error",!0);else{var b=compareResults.win.down("#selResults").getValue().map(function(a){return+a});if(2>b.length)showNotification(getText("You must select at least two results windows to compare."),"error",!0);else{var c=[],d=[],e=[];Ext.WindowMgr.each(function(a){-1<b.indexOf(a.analysisCount)&&(c.push(a),d.push(a.getTitle()),e.push(a.results))});for(var f=
1;f<e.length;f++)if(e[f].Time.join(",")!=e[0].Time.join(",")){showNotification(getText("Compared results windows must have the same simulation time settings."),"error",!0);return}var g=[],k=!1;a.forEach(function(a){var b=findID(a),c=[];e.forEach(function(a){a[b.id]?c.push(a.value(b)):(k||showNotification(getText("The primitive '"+getName(b)+"' does not appear in all the results."),"error",!0),k=!0)});k||(g.push({name:getName(b)+" Chart",type:"chart",xData:e[0].Time,xType:"numeric",xLabel:"Time",yLabel:getName(b),
legend:"top",verticalGrid:!0,horizontalGrid:!0,xMin:Math.min.apply(null,e[0].Time),xMax:Math.max.apply(null,e[0].Time),data:c.map(function(a,b){return{data:a,type:"line",name:d[b],hideMarkers:!0}})}),g.push({name:getName(b)+" Table",type:"table",data:c,header:d}))});k||(showData("Simulation Results Comparison",g),compareResults.win.close())}}}}]}));e=compareResults.win.down("#selPrimitives").getValue().slice();compareResults.win.down("#selPrimitives").setValue(null);var g=[];e.forEach(function(a){-1<
c.indexOf(a)&&g.push(a)});e=compareResults.win.down("#selResults").getValue().slice();compareResults.win.down("#selResults").setValue(null);var k=[];e.forEach(function(a){-1<b.indexOf(a)&&k.push(a)});compareResults.resultsStore.loadData(a);compareResults.primitiveStore.loadData(d);compareResults.win.down("#selResults").setValue(k);compareResults.win.down("#selPrimitives").setValue(g);compareResults.win.show()};function importData(a){var b=new Ext.FormPanel({fieldDefaults:{labelWidth:130,width:355},autoScroll:!0,margin:"3 5 5 20",frame:!1,defaultType:"textfield",items:[{xtype:"box",margin:10,html:"<center>"+getText("Copy and paste the contents from your CSV file or tab-delimited file into the data field below.")+"</center>"},{xtype:"textareafield",fieldLabel:"Data",name:"impData",id:"impData",allowBlank:!1,selectOnFocus:!0,value:getText("Example Input, Example Output")+"\n24, 62\n641, 12\n234, 56\n123, 19",
height:195},{xtype:"checkboxfield",fieldLabel:getText("Include First Row"),inputValue:"1",name:"impIncludeHeader",id:"impIncludeHeader"},new Ext.form.NumberField({fieldLabel:getText("Input Column Index"),name:"impInputIndex",id:"impInputIndex",allowBlank:!1,minValue:1,allowDecimals:!1,value:1}),new Ext.form.NumberField({fieldLabel:getText("Output Column Index"),name:"impOutputIndex",id:"impOutputIndex",allowBlank:!1,minValue:1,allowDecimals:!1,value:2})]}),c=new Ext.Window({title:getText("Import Converter Data"),
layout:"fit",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,400),height:Math.min(Ext.getBody().getViewSize().height,510),items:[b],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){c.close()}},{scale:"large",glyph:61452,text:getText("Import"),handler:function(){try{var b=parseCSV(Ext.getCmp("impData").getValue())}catch(e){mxUtils.alert(getText("There was an error with your data file. It should be a valid CSV or tab-delimited text file."));
return}if(0>=b.length)mxUtils.alert(getText("Could not import as no data entered."));else{var f=Ext.getCmp("impInputIndex").getValue()-1,g=Ext.getCmp("impOutputIndex").getValue()-1;if(f<b[0].length&&g<b[0].length){a.removeAll();for(var k=[],l=0==Ext.getCmp("impIncludeHeader").getValue()?1:0;l<b.length;l++)try{var m=flexibleParseFloat(b[l][f]),n=flexibleParseFloat(b[l][g]);isNaN(m)||isNaN(n)?mxUtils.alert(getText("(%s, %s) is not a pair of numbers. Skipping row during import.",b[l][f],b[l][g])):k.push({xVal:m,
yVal:n})}catch(p){mxUtils.alert(getText("Skipping badly formed row (%s, %s) on import.",b[l][f],b[l][g]))}a.add(k);c.close()}else mxUtils.alert(getText("Invalid column index for data file. Maximum number of columns is %s.",b[0].length))}}}]});c.show()}function flexibleParseFloat(a){return parseFloat(a.replace(/\,/g,""))}
function parseCSV(a){var b=/([,\015\012\t;] *)/g,c=/("")*"([,\015\012\t;] *)/g,d=0,e=[],f=[];do{var g='"'==a.charAt(d)?c:b;g.lastIndex=d;var k=g.exec(a);if(!k||!k.length)break;d=a.substring(d,g.lastIndex-k[k.length-1].length);'"'==d.charAt(0)&&(d=d.substring(1,d.length-1).replace(/""/g,'"'));f.push(d);k=k[0];0>k.indexOf(",")&&0>k.indexOf("\t")&&(e.push(f),f=[]);d=g.lastIndex}while(1);d<a.length&&(a=a.substring(d).trim())&&f.push(a);0<f.length&&e.push(f);return e};var UnitsEditor=Ext.extend(Ext.form.TextField,{enableKeyEvents:!1,selectOnFocus:!0,stripCharsRe:/[^A-Za-z 0-9\.\/\(\)\*\^]/g,triggers:{edit:{hideOnReadOnly:!1,handler:function(){this.editorWindow=new UnitsWindow({parent:this,units:this.getValue()});this.editorWindow.show()}}},listeners:{keydown:function(a){a.setEditable(!1)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
function UnitsWindow(a){var b=new Ext.form.field.Text({xtype:"textfield",height:40,fieldStyle:"font-size: x-large; text-align:center;",stripCharsRe:/[^A-Za-z 0-9\.\/\(\)\*\^]/g}),c=Ext.create("Ext.data.TreeStore",{root:{text:getText("Units"),draggable:!1,expanded:!0,children:[]}}),d=new Ext.tree.Panel({animate:!1,frame:!0,store:c,autoScroll:!0,useArrows:!0,flex:1,margin:"5,5,5,5",rootVisible:!1,folderSort:!1,listeners:{selectionchange:function(a,c,d){c[0].data.leaf&&b.setValue(clean(c[0].data.text))}}}),
e=function(a){var b=a.getRootNode();a=[b];var c=b.appendChild({text:"Unitless",draggable:!1,leaf:!0,expanded:!0}),d=unitsUsedInModel();if(0<d.length)for(var c=b.appendChild({text:getText("Units Used in Model"),draggable:!1,leaf:!1,expanded:!0}),e=0;e<d.length;e++)c.appendChild({text:d[e],draggable:!1,leaf:!0,expanded:!0});d=customUnits();if(0<d.length)for(c=b.appendChild({text:getText("Custom Units"),draggable:!1,leaf:!1,expanded:!0}),e=0;e<d.length;e++)c.appendChild({text:clean(d[e][0]),draggable:!1,
leaf:!0,expanded:!1});b=0;d="Distance, Area and Volume\r Metric\r  Millimeters\r  Centimeters\r  Meters\r  Kilometers\r  -\r  Square Millimeters\r  Square Centimeters\r  Square Meters\r  Hectares\r  Square Kilometers\r  -\r  Cubic Millimeters\r  Cubic Centimeters\r  Liters\r  Cubic Meters\r English\r  Inches\r  Feet\r  Yards\r  Miles\r  -\r  Square Inches\r  Square Feet\r  Square Yards\r  Acres\r  Square Miles\r  -\r  Fluid Ounces\r  Quarts\r  Gallons\r  Acre Feet\rVelocity, Acceleration and Flow\r Metric\r  Meters per Second\r  Meters per Second Squared\r  Kilometers per Hour\r  Kilometers per Hour Squared\r  -\r  Liters per Second\r  Cubic Meters per Second\r  -\r  Kilograms per Second\r English\r  Feet per Second\r  Feet per Second Squared\r  Miles per Hour\r  Miles per Hour Squared\r  -\r  Gallons per Second\r  Gallons per Minute\r  -\r  Pounds per Second\rMass, Force and Pressure\r Metric\r  Milligrams\r  Grams\r  Kilograms\r  Tonnes\r  -\r  Newtons\r  -\r  Pascals\r  Kilopascals\r  Bars\r  Atmospheres\r English\r  Ounces\r  Pounds\r  Tons\r  -\r  Pounds Force\r  -\r  Pounds per Square Inch\rTemperature and Energy\r Metric\r  Degrees Celsius\r  Degrees Kelvin\r  -\r  Joules\r  Kilojoules\r  -\r  Watts\r  Kilowatts\r  Megawatts\r  Gigawatts\r  -\r  Amperes\r  -\r  Millivolts\r  Volts\r  Kilovolts\r  -\r  Coulombs\r  -\r  Farads\r English\r  Degrees Fahrenheit\r  -\r  Calories\r  Kilocalories\r  British Thermal Units\rTime\r Milliseconds\r Seconds\r Minutes\r Hours\r Days\r Weeks\r Months\r Quarters\r Years\rMoney\r Dollars\r Flow of Dollars\r  Dollars per Second\r  Dollars per Hour\r  Dollars per Day\r  Dollars per Week\r  Dollars per Month\r  Dollars per Quarter\r  Dollars per Year\r -\r Euros\r Flow of Euros\r  Euros per Second\r  Euros per Hour\r  Euros per Day\r  Euros per Week\r  Euros per Month\r  Euros per Quarter\r  Euros per Year\rBusiness and Commerce\r People\r Customers\r Employees\r Workers\r -\r Factories\r Buildings\r -\r Units\r Widgets\r Parts\rEcology and Nature\r Individuals\r Animals\r Plants\r Trees\r Biomass\rChemistry\r Atoms\r Molecules\r -\r Moles".split(/[\n\r]/);
for(e=0;e<d.length;e++){var f=d[e].match(/^ *(.*?)$/);if("-"!=f[1]){var q=d[e].length-f[1].length;if(q>b)c.leaf=!1,c.iconCls="icon-folder",c=a[a.length-1].appendChild(c),a.push(c);else if(q<b)for(a[a.length-1].appendChild(c),c=0;c<b-q;c++)a.pop();else a[a.length-1].appendChild(c);b=q;c={text:f[1],draggable:!1,leaf:!0,expanded:!1}}}};e(d);var f=new Ext.Window({title:getText("Primitive Units"),layout:{type:"vbox",align:"stretch"},tools:[{type:"help",tooltip:getText("Get Help"),callback:function(a,b,
c){showURL("/units")}}],closeAction:"destroy",border:!1,modal:!0,resizable:!0,maximizable:!0,stateful:is_editor&&!is_embed,stateId:"units_window",shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,560),height:Math.min(Ext.getBody().getViewSize().height,400),items:[b,d],buttons:[{id:"units_but",scale:"large",text:getText("Unit Conversions"),glyph:61918,handler:function(){var a=getSetting(),b=Ext.create("Ext.data.Store",{fields:[{name:"name",type:"string"},
{name:"synonym",type:"string"},{name:"scale",type:"float"}],data:function(){for(var a=[],b=customUnits(),c=0;c<b.length;c++){var d=b[c];a.push({name:d[0],scale:d[1],synonym:d[2]})}return a}(),sorters:["name"]}),c=new Ext.grid.plugin.RowEditing({saveText:"Apply"}),f=[{header:getText("Name"),dataIndex:"name",flex:2,sortable:!0,editor:{xtype:"textfield",allowBlank:!1,regex:/^[a-zA-Z][a-z A-Z]*$/,regexText:getText("The unit name may only contain letters and spaces, and cannot start with a space")}},{xtype:"numbercolumn",
header:getText("Scale"),dataIndex:"scale",width:150,sortable:!1,editor:{xtype:"numberfield",allowBlank:!1,decimalPrecision:10}},{header:getText("Synonym"),dataIndex:"synonym",flex:3,sortable:!1,editor:{xtype:"textfield",allowBlank:!0,emptyText:"Meters/Seconds^2",regex:/^([a-zA-Z][a-z A-Z]*(\^-?[\d\.]+)?[\*\/]?)*$/,regexText:getText("The unit synonym should be of the form: Meters*Seconds^2/Kilograms.")}}],n=new Ext.grid.GridPanel({store:b,plugins:[c],features:[],tbar:[{glyph:61526,iconCls:"red-icon",
itemId:"removeBut",text:getText("Remove Conversion"),disabled:!0,handler:function(){c.completeEdit();for(var a=n.getSelectionModel().getSelection(),d=0,e;e=a[d];d++)b.remove(e)}},"->",{glyph:61525,text:getText("Add Conversion"),iconCls:"green-icon",handler:function(){var a={name:getText("New Unit Name"),synonym:"",scale:1};c.completeEdit();a=b.insert(0,a);n.getView().refresh();n.getSelectionModel().select(a);c.startEdit(a[0],0)}}],columns:f});n.getSelectionModel().on("selectionchange",function(a){n.getDockedItems()[0].getComponent("removeBut").setDisabled(1>
a.getCount())});var p=new Ext.Window({layout:"fit",modal:!0,title:getText("Configure Custom Unit Conversions"),width:Math.min(Ext.getBody().getViewSize().width,530),height:Math.min(Ext.getBody().getViewSize().height,430),resizable:!0,closeAction:"close",closable:!1,items:[n],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){p.close()}},{scale:"large",glyph:61452,text:getText("Apply"),handler:function(){n.plugins[0].completeEdit();for(var c=b.getCount(),f=0;f<c;f++)b.getAt(f).commit();
c="";0<b.getCount()&&(c=b.getAt(0).get("name")+"<>"+b.getAt(0).get("scale")+"<>"+b.getAt(0).get("synonym"));for(f=1;f<b.getCount();f++)c=c+"\n"+b.getAt(f).get("name")+"<>"+b.getAt(f).get("scale")+"<>"+b.getAt(f).get("synonym");graph.getModel().beginUpdate();f=new mxCellAttributeChange(a,"Units",c);graph.getModel().execute(f);graph.getModel().endUpdate();e(d);p.close()}}]});p.show()},scope:this},"->",{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){f.close();""!=a.parent&&a.parent.resumeEvents()}},
{hidden:!viewConfig.allowEdits,scale:"large",glyph:61452,text:getText("Apply"),handler:function(){""!=a.parent?(f.close(),editingRecord.set("value",b.getValue()),saveConfigRecord(editingRecord)):(graph.getModel().beginUpdate(),a.cell.setAttribute("Units",b.getValue()),graph.getModel().endUpdate(),f.close());Ext.getCmp("equationUnitsBut")&&Ext.getCmp("equationUnitsBut").setText(formatUnitsBut(b.getValue()))}}]});this.show=function(){f.show();b.setValue(clean(a.units))}};var sensitivityProgress,sensitivityController={};
function doSensitivity(){for(var a=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),b=[],c=excludeType(primitives(),"Ghost"),d=0;d<c.length;d++)isValued(c[d])&&!inAgent(c[d])&&b.push({pid:c[d].id,pname:c[d].getAttribute("name")});a.loadData(b);var b=getSetting(),a=new Ext.FormPanel({fieldDefaults:{labelWidth:195,width:"100%"},autoScroll:!0,frame:!1,bodyStyle:"padding: 10px",defaultType:"textfield",items:[Ext.create("Ext.form.field.Tag",{fieldLabel:getText("Monitored Primitives"),
name:"monPrimitives",id:"monPrimitives",displayField:"pname",filterPickList:!0,valueField:"pid",queryMode:"local",store:a,emptyText:getText("Select primitives to monitor"),value:b.getAttribute("SensitivityPrimitives")?b.getAttribute("SensitivityPrimitives").split(","):void 0}),new Ext.form.NumberField({fieldLabel:getText("Number of Runs"),name:"nRuns",id:"nRuns",allowBlank:!1,minValue:10,allowDecimals:!1,value:b.getAttribute("SensitivityRuns")}),{fieldLabel:getText("Confidence Regions")+" (%)",name:"confRegion",
id:"confRegion",allowBlank:!1,value:b.getAttribute("SensitivityBounds")},{xtype:"checkboxfield",fieldLabel:getText("Plot Each Run (slower)"),inputValue:"true",name:"plotEach",id:"plotEach",checked:isTrue(b.getAttribute("SensitivityShowRuns"))},{xtype:"displayfield",fieldLabel:"",value:"<div style='padding-top:1.2em;'> <div class = 'fa fa-question-circle' style='float:left; margin-right: 7px; font-size: xx-large; display: block; color: grey'></div> Sensitivity analysis runs your simulation multiple times with random inputs to see how the results vary (in a sense, how 'sensitive' the results are to the inputs).<br/><br/> In order to use sensitivity analysis you need to have sources of randomness in your model. For instance, you can use the <i>Rand()</i> function or other Insight Maker random generation functions to choose random variables or random starting values. Please note, that if you want to have a random variable value, you can use <i>Fix(Rand())</i> to set the variable to a random value at the start of the simulation and keep it at the same value for the rest of that simulation."}]}),
e=new Ext.Window({title:getText("Sensitivity Analysis"),layout:"fit",closeAction:"destroy",border:!1,tools:[{type:"help",tooltip:getText("Get Help"),callback:function(a,b,c){showURL("/sensitivitytesting")}}],modal:!0,resizable:!1,maximizable:!1,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,480),height:Math.min(Ext.getBody().getViewSize().height,525),items:[a],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){e.close()}},
{scale:"large",glyph:61452,text:getText("Run Analysis"),handler:function(){var a=Ext.getCmp("nRuns").getValue(),b=Ext.getCmp("monPrimitives").getValue(),c=Ext.Array.map(Ext.getCmp("confRegion").getValue().split(","),parseFloat),d=isTrue(Ext.getCmp("plotEach").getValue());if(1>b.length)mxUtils.alert(getText("You must select one or more primitives to monitor."));else if(1>c.length)mxUtils.alert(getText("You must specify one or more bounds as percentages."));else{for(var m=0;m<c.length;m++)if(0>=c[m]||
100<c[m]){mxUtils.alert(getText("Bounds are percentage values that must be between 0 and 100."));return}m=getSetting();graph.getModel().beginUpdate();var n=new mxCellAttributeChange(m,"SensitivityPrimitives",b.join(","));graph.getModel().execute(n);n=new mxCellAttributeChange(m,"SensitivityRuns",a);graph.getModel().execute(n);n=new mxCellAttributeChange(m,"SensitivityBounds",c.join(", "));graph.getModel().execute(n);n=new mxCellAttributeChange(m,"SensitivityShowRuns",d);graph.getModel().execute(n);
graph.getModel().endUpdate();sensitivityProgress=Ext.MessageBox.show({msg:getText("Running Sensitivity Analysis..."),icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0,progressText:" "});sensitivityController={nRuns:a,items:b,bounds:c,showRuns:d,results:[]};setTimeout("runSensitivity()",15);e.close()}}}]});e.show()}
function runSensitivity(){var a=runModel({silent:!0});if("none"!=a.error)mxUtils.alert(a.error),a.errorPrimitive&&highlight(a.errorPrimitive),sensitivityProgress&&sensitivityProgress.close();else if(sensitivityController.results.push(a),sensitivityProgress.updateProgress(sensitivityController.results.length/sensitivityController.nRuns," "),sensitivityController.results.length<sensitivityController.nRuns)sensitivityController.noYield?runSensitivity():setTimeout("runSensitivity()",15);else{for(var a=
sensitivityController.nRuns,b=sensitivityController.results,c=sensitivityController.bounds,d=sensitivityController.items,e=[],f=0;f<d.length;f++){for(var g=findID(d[f]),k=[],l=0;l<a;l++)k.push(b[l].value(g));for(var m={median:[]},n=0;n<c.length;n++)m[c[n]+"_lower"]=[],m[c[n]+"_upper"]=[];for(var p=0;p<k[0].length;p++){for(var q=[],l=0;l<k.length;l++)q.push(k[l][p]);q=q.sort(function(a,b){return a-b});m.median.push(getQuantile(q,0.5));for(n=0;n<c.length;n++)m[c[n]+"_lower"].push(getQuantile(q,0.5-
c[n]/100/2)),m[c[n]+"_upper"].push(getQuantile(q,0.5+c[n]/100/2))}q=[];for(n=0;n<c.length;n++)q=q.concat(m[c[n]+"_lower"]),q=q.concat(m[c[n]+"_upper"]);var l={name:g.getAttribute("name")+" Quantiles Table",type:"table"},u=[],v=[];u.push(getText("Time"));v.push(b[0].Time);for(var y=[],p="#ECC928 #425FCA #8E630F #007012 #CC2C33 #773A86".split(" "),z=[],x=[],B=[],A=[],n=c.length-1;0<=n;n--)u.push(c[n]+"% "+getText("Lower")),v.push(m[c[n]+"_lower"]),u.push(c[n]+"% "+getText("Upper")),v.push(m[c[n]+"_upper"]),
0<n&&x.push({name:"Lower "+c[n]+"%",data:m[c[n-1]+"_lower"].map(function(a){return Math.max(a,0)}),type:"line",color:p[n%p.length],fill:!0,hideMarkers:!0,hideLegend:!0}),A.push({name:"Lower "+c[n]+"%",data:m[c[n]+"_lower"].map(function(a){return Math.min(a,0)}),type:"line",color:p[n%p.length],fill:!0,hideMarkers:!0,hideLegend:!0}),z.push({name:c[n]+"% "+getText("Region"),data:m[c[n]+"_upper"].map(function(a){return Math.max(a,0)}),type:"line",color:p[n%p.length],fill:!0,hideMarkers:!0}),0<n&&B.push({name:c[n]+
"% "+getText("Region"),data:m[c[n-1]+"_upper"].map(function(a){return Math.min(a,0)}),type:"line",color:p[n%p.length],fill:!0,hideMarkers:!0,hideLegend:!0});for(n=0;n<z.length;n++)y.push(z[n]);for(n=x.length-1;0<=n;n--)y.push(x[n]);for(n=0;n<A.length;n++)y.push(A[n]);for(n=B.length-1;0<=n;n--)y.push(B[n]);n=m[c[c.length-1]+"_lower"];z=m[c[c.length-1]+"_upper"];x=[];for(p=0;p<n.length;p++)0<z[p]&&0>n[p]?x.push(0):Math.abs(n[p])<Math.abs(z[p])?x.push(n[p]):x.push(z[p]);y.push({name:"White Cover",data:x,
type:"line",color:"white",fill:!0,hideMarkers:!0,hideLegend:!0});u.push(getText("Median"));v.push(m.median);y.push({name:getText("Median"),data:m.median,type:"line",color:"black"});l.header=u;l.data=v;e.push({legend:"right",legendStatic:!0,data:y,name:g.getAttribute("name")+" "+getText("Quantiles Chart"),type:"chart",horizontalGrid:!1,verticalGrid:!1,xType:"Numeric",xData:b[0].Time,xLabel:"Time",yLabel:g.getAttribute("name"),yMin:Math.min.apply(null,q),yMax:Math.max.apply(null,q)});e.push(l);if(sensitivityController.showRuns){l=
{name:g.getAttribute("name")+" "+getText("Runs Table"),type:"table"};u=[];v=[];y=[];for(p=0;p<a;p++)u.push("Run "+(p+1)),v.push(k[p]),y.push({title:"",data:k[p],type:"line",hideMarkers:!0});l.header=u;l.data=v;e.push({legend:"none",data:y,name:g.getAttribute("name")+" "+getText("Runs Chart"),type:"chart",horizontalGrid:!0,verticalGrid:!0,xType:"Numeric",xData:b[0].Time,xLabel:"Time",yLabel:g.getAttribute("name")});e.push(l)}}sensitivityProgress.close();showData(getText("Sensitivity Analysis Results"),
e)}}function getQuantile(a,b){var c=a.length*b;return Math.ceil(c)==a.length?a[a.length-1]:c==Math.ceil(c)?a[c]:(a[Math.floor(c)]+a[Math.ceil(c)])/2};var optimizerProgress,optimizerController={};
function doOptimizer(){for(var a=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),b=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),c=[],d=[],e=excludeType(primitives(),"Ghost"),f=0;f<e.length;f++)if(isValued(e[f])&&!inAgent(e[f])){var g={pid:e[f].id,pname:e[f].getAttribute("name")};c.push(g);"Stock"!=e[f].value.nodeName&&"Variable"!=e[f].value.nodeName||d.push(g)}b.loadData(c);a.loadData(d);c=getSetting();
d=c.getAttribute("OptimizerGridStore")?JSON.parse(c.getAttribute("OptimizerGridStore")):[];for(f=d.length-1;0<=f;f--)findID(d[f].id)||d.splice(f,1);var k=Ext.create("Ext.data.Store",{fields:["id","minBound","maxBound","desiredAccuracy"],data:d}),f=Ext.create("Ext.grid.Panel",{store:k,columns:[{header:getText("Primitive Name"),sortable:!1,menuDisabled:!0,dataIndex:"id",flex:1,renderer:function(a){return getName(findID(a))}},{header:getText("Minimum Bound"),sortable:!1,menuDisabled:!0,dataIndex:"minBound",
width:130,editor:{xtype:"numberfield",allowBlank:!1,allowDecimals:!0,decimalPrecision:9}},{header:getText("Maximum Bound"),sortable:!1,menuDisabled:!0,dataIndex:"maxBound",width:130,editor:{xtype:"numberfield",allowBlank:!1,allowDecimals:!0,decimalPrecision:9}},{header:getText("Accuracy"),sortable:!1,menuDisabled:!0,dataIndex:"desiredAccuracy",width:130,editor:{xtype:"numberfield",allowBlank:!1,step:0.1,minValue:0,allowDecimals:!0,decimalPrecision:9}}],selType:"cellmodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",
{clicksToEdit:1})],flex:1,frame:!0,border:!0}),a=new Ext.FormPanel({fieldDefaults:{labelWidth:175,width:"100%"},autoScroll:!0,frame:!1,margin:"11 11 11 11",items:[Ext.create("Ext.form.field.ComboBox",{fieldLabel:getText("Goal Primitive"),name:"optGoalPrimitive",id:"optGoalPrimitive",displayField:"pname",valueField:"pid",queryMode:"local",store:b,forceSelection:!0,allowBlank:!1,emptyText:getText("Select primitive to target"),value:c.getAttribute("OptimizerGoalPrimitive")?c.getAttribute("OptimizerGoalPrimitive"):
void 0}),Ext.create("Ext.form.field.ComboBox",{fieldLabel:getText("Goal"),name:"optGoal",id:"optGoal",queryMode:"local",store:[["Minimize",getText("Minimize")],["Maximize",getText("Maximize")]],forceSelection:!0,allowBlank:!1,value:c.getAttribute("OptimizerGoal")?c.getAttribute("OptimizerGoal"):"Minimize"}),Ext.create("Ext.form.field.ComboBox",{fieldLabel:getText("Goal Type"),name:"optGoalType",id:"optGoalType",queryMode:"local",store:[["Integral of Value",getText("Integral of Value")],["Final Value",
getText("Final Value")]],forceSelection:!0,allowBlank:!1,value:c.getAttribute("OptimizerGoalType")?c.getAttribute("OptimizerGoalType"):"Integral of Value"}),Ext.create("Ext.form.field.Tag",{fieldLabel:getText("Primitives to Adjust"),name:"optChangePrimitives",id:"optChangePrimitives",displayField:"pname",filterPickList:!0,valueField:"pid",queryMode:"local",store:a,emptyText:getText("Select primitives to adjust"),listeners:{change:function(a,b,c){a=b?b:[];c=c?c:[];for(b=0;b<a.length;b++)""!=a[b].trim()&&
-1==k.find("id",a[b])&&k.add({id:a[b],minBound:0,maxBound:1,desiredAccuracy:0.1});for(b=0;b<c.length;b++)""!=c[b].trim()&&-1==a.indexOf(c[b])&&k.removeAt(k.find("id",c[b]))}},value:c.getAttribute("OptimizerPrimitives")?c.getAttribute("OptimizerPrimitives").split(","):[]})]}),b=new Ext.FormPanel({fieldDefaults:{labelWidth:175,width:"100%"},autoScroll:!0,frame:!1,margin:"11 11 11 11",items:[new Ext.form.NumberField({fieldLabel:getText("Random Starts"),name:"nRandomStarts",id:"nRandomStarts",allowBlank:!1,
minValue:0,allowDecimals:!1,value:c.getAttribute("OptimizerRandomStarts")?c.getAttribute("OptimizerRandomStarts"):0}),new Ext.form.NumberField({fieldLabel:getText("Maximum Number of Iterations"),name:"nIterations",id:"nIterations",allowBlank:!1,minValue:1,allowDecimals:!1,value:c.getAttribute("OptimizerMaxIterations")?c.getAttribute("OptimizerMaxIterations"):100}),new Ext.form.NumberField({fieldLabel:getText("Step Reduction Factor"),name:"nStepReduction",id:"nStepReduction",allowBlank:!1,minValue:0,
maxValue:1,step:0.1,allowDecimals:!0,value:c.getAttribute("OptimizerStepReduction")?c.getAttribute("OptimizerStepReduction"):0.5})]}),l=new Ext.Window({title:getText("Optimization"),layout:"fit",closeAction:"destroy",border:!1,modal:!0,tools:[{type:"help",tooltip:getText("Get Help"),callback:function(a,b,c){showURL("/optimization")}}],resizable:!0,maximizable:!0,shadow:!0,buttonAlign:"right",width:Math.min(Ext.getBody().getViewSize().width,560),height:Math.min(Ext.getBody().getViewSize().height,525),
items:[Ext.create("Ext.tab.Panel",{xtype:"tabpanel",layout:"vbox",activeTab:0,plain:!0,flex:1,items:[{title:getText("General"),layout:{type:"vbox",align:"stretch"},items:[a,f],autoScroll:!0},{title:getText("Advanced"),items:b,autoScroll:!0}]})],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){l.close()}},{scale:"large",glyph:61452,text:getText("Run Optimization"),handler:function(){var a=Ext.getCmp("nRandomStarts").getValue(),b=Ext.getCmp("nIterations").getValue(),c=Ext.getCmp("nStepReduction").getValue(),
d=Ext.getCmp("optGoal").getValue(),e=Ext.getCmp("optGoalType").getValue(),f=Ext.getCmp("optGoalPrimitive").getValue(),g=Ext.getCmp("optChangePrimitives").getValue();if(1>g.length)showNotifaction(getText("You must select one or more primitives to adjust."),"error",!0);else if(f){var z=getSetting();graph.getModel().beginUpdate();var x=new mxCellAttributeChange(z,"OptimizerPrimitives",g.join(","));graph.getModel().execute(x);x=new mxCellAttributeChange(z,"OptimizerGoalPrimitive",f);graph.getModel().execute(x);
x=new mxCellAttributeChange(z,"OptimizerGoal",d);graph.getModel().execute(x);x=new mxCellAttributeChange(z,"OptimizerGoalType",e);graph.getModel().execute(x);x=new mxCellAttributeChange(z,"OptimizerStepReduction",c);graph.getModel().execute(x);x=new mxCellAttributeChange(z,"OptimizerMaxIterations",b);graph.getModel().execute(x);x=new mxCellAttributeChange(z,"OptimizerRandomStarts",a);graph.getModel().execute(x);var B=[];k.each(function(a){B.push(a.getData())});x=new mxCellAttributeChange(z,"OptimizerGridStore",
JSON.stringify(B));graph.getModel().execute(x);graph.getModel().endUpdate();optimizerProgress=Ext.MessageBox.show({msg:getText("Optimizing Model..."),icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0,progressText:" "});optimizerController={runs:-1,randomStarts:a,optIterations:b,stepReduction:c,optGoal:d,goalType:e,goalPrimitive:f,changePrimitives:g,gridData:B};l.close();setTimeout("runOptimizer()",30)}else showNotifaction(getText("You must select a goal primitive to optimize."),"error",!0)}}]});
l.show()}
function runOptimizer(){-1==optimizerController.runs&&setupOptimizer();if(optimizerController.runs<=optimizerController.randomStarts){optimizerController.midRun||(optMsg("Run: "+optimizerController.runs),optimizerController.iterations=0,optimizerController.stepScale=1,optimizerController.metAccuracyConditions=!1,optimizerController.opts.push(new DataStore),setInitialPosition(0!=optimizerController.runs));var a=Date.now();for(optimizerController.midRun=!0;!metFinishedConditions();){optimizerController.currentPointMarker=evaluateCurrentPoint();
optimizerController.startPoints.length-1<optimizerController.runs&&(optimizerController.startPoints.push(optimizerController.currentPointMarker),optimizerController.opts[optimizerController.opts.length-1].data.push(optimizerController.solutionSpace[0][optimizerController.currentPointMarker]));var b=explore();if(b.stationary()){optMsg("Reducing Step Size");reduceStepSizes();for(var c=0;c<optimizerController.coreDimensions.length;c++)optimizerController.optDimensions[c]=optimizerController.coreDimensions[c];
optimizerController.dimensionsDiscarded=0}else if(optMsg("Moving"),isLocal()&&console.log(b),patternMove(b),!dimensionExists(b))if(optMsg("Inserting Dimension: "+b.toString()),optimizerController.optDimensions.splice(optimizerController.optDimensions.length-1),optimizerController.optDimensions=[b].concat(optimizerController.optDimensions),optimizerController.dimensionsDiscarded+=1,optimizerController.dimensionsDiscarded>optimizerController.coreDimensions.length){for(c=0;c<optimizerController.coreDimensions.length;c++)optimizerController.optDimensions[c]=
optimizerController.coreDimensions[c];optimizerController.dimensionsDiscarded=0}else optMsg("Dimension Already Exists:"+b.toString());optimizerController.iterations+=1;optimizerController.opts[optimizerController.opts.length-1].data.push(optimizerController.solutionSpace[0][optimizerController.currentPointMarker]);b=Math.log(optimizerController.stepScale*optimizerController.stepSizes[0]/optimizerController.accuracies[0]);for(c=1;c<optimizerController.stepSizes.length;c++){var d=Math.log(optimizerController.stepScale*
optimizerController.stepSizes[c]/optimizerController.accuracies[c]);d>b&&(b=d)}-1==optimizerController.maxAcc&&(optimizerController.maxAcc=b);c=1/(optimizerController.randomStarts+1);optimizerProgress.updateProgress((optimizerController.runs+1)*c+c*Math.min(0.95,Math.max(optimizerController.iterations/optimizerController.optIterations,(optimizerController.maxAcc-b)/optimizerController.maxAcc))," ");if(2<(Date.now()-a)/1E3){setTimeout("runOptimizer()",30);return}}optimizerController.bestPoints.push(optimizerController.currentPointMarker);
optimizerController.midRun=!1;optimizerController.runs++;setTimeout("runOptimizer()",30)}else finishOptimizer()}
function setupOptimizer(){optimizerController.startTime=Date.now();optimizerController.midRun=!1;optimizerController.goal=findID(optimizerController.goalPrimitive);optimizerController.targets=findID(optimizerController.changePrimitives);optimizerController.maximums=[];optimizerController.minimums=[];optimizerController.accuracies=[];for(var a=0;a<optimizerController.targets.length;a++)for(var b=0;b<optimizerController.gridData.length;b++){var c=optimizerController.gridData[b];if(c.id==optimizerController.targets[a].id){optimizerController.maximums.push(c.maxBound);
optimizerController.minimums.push(c.minBound);optimizerController.accuracies.push(c.desiredAccuracy);break}}optimizerController.reductionRate=optimizerController.stepReduction;optimizerController.minimize="Minimize"==optimizerController.optGoal?1:-1;optimizerController.stepScale=1;optimizerController.stepSizes=[];for(a=0;a<optimizerController.maximums.length;a++)optimizerController.stepSizes.push((optimizerController.maximums[a]-optimizerController.minimums[a])/4);optimizerController.evaluations=
0;optimizerController.currentPointMarker=0;optimizerController.iterations=0;optimizerController.solutionSpace=[];optimizerController.runs=0;optimizerController.bestPoints=[];optimizerController.startPoints=[];optimizerController.terminationReasons=[];optimizerController.opts=[];optimizerController.metAccuracyConditions=!1;optimizerController.maxAcc=-1;optimizerController.coreDimensions=[];for(a=0;a<optimizerController.targets.length;a++)optimizerController.coreDimensions.push(new OptDimension(a));
optimizerController.optDimensions=[];for(a=0;a<optimizerController.targets.length;a++)optimizerController.optDimensions.push(optimizerController.coreDimensions[a]);optimizerController.dimensionsDiscarded=0}
function finishOptimizer(){for(var a=optimizerController.bestPoints[0],b=1;b<optimizerController.bestPoints.length;b++)optimizerController.solutionSpace[0][optimizerController.bestPoints[b]]*optimizerController.minimize<optimizerController.solutionSpace[0][a]*optimizerController.minimize&&(a=optimizerController.bestPoints[b]);for(b=1;b<optimizerController.targets.length;b++)setValue(optimizerController.targets[b],optimizerController.solutionSpace[b+1][a]);a="<div style='padding: 1em; text-align: center;'><p>"+
getText("Your model has been set to the optimal solution.")+"</p>"+optString(a);a=a+"<br/><p>"+getText("Please note that the optimization algorithm is unable to fully account for local minimums or maximums. If your solution space contains such features, the algorithm may have returned erroneous results.")+"</p>";if(0<optimizerController.randomStarts)for(a=a+"<hr><p>"+getText("You specified a total of %s random iterations. The optimums of the initial iteration and each random one are as follows",optimizerController.randomStarts)+
":<br/>",b=0;b<optimizerController.bestPoints.length;b++)a=a+"\n\n"+optString(optimizerController.bestPoints[b]);a=a+"<hr/><p>"+getText("Optimization Duration: %s seconds",(Date.now()-optimizerController.startTime)/1E3)+"</p></div>";a=[{name:"Summary",type:"html",data:a}];if(1==optimizerController.targets.length){for(var c=[],d=[],e=[],b=0;b<optimizerController.evaluations;b++)e.push({x:optimizerController.solutionSpace[1][b],y:optimizerController.solutionSpace[0][b]});e.sort(function(a,b){return a.x-
b.x});for(b=0;b<e.length;b++)c.push(e[b].x),d.push(e[b].y);a.push({name:getText("Explored Solution Space"),type:"chart",xLabel:getName(optimizerController.targets[0]),yLabel:getName(optimizerController.goal)+" "+optimizerController.goalType,legend:"none",horizontalGrid:!0,verticalGrid:!0,xType:"Numeric",xData:c,data:[{data:d,type:"line",name:"Results"}]})}c=[];d=[];for(b=0;b<optimizerController.opts.length;b++)c=c.concat(optimizerController.opts[b].iterations()),d.push({data:optimizerController.opts[b].data,
type:"line",name:"Run "+(b+1)});c=Ext.Array.unique(c);a.push({name:getText("Iterations"),type:"chart",xLabel:getText("Iteration"),yLabel:getName(optimizerController.goal)+" "+optimizerController.goalType+" Optimum",legend:"none",horizontalGrid:!0,verticalGrid:!0,xType:"Numeric",xData:c,data:d});c=[[],[]];d=[getName(optimizerController.goal)+" "+optimizerController.goalType];for(e=0;e<optimizerController.targets.length;e++)d.push(getName(optimizerController.targets[e])),c.push([]);d.push("Note");for(b=
0;b<optimizerController.evaluations;b++){for(e=0;e<=optimizerController.targets.length;e++)c[e].push(optimizerController.solutionSpace[e][b]);-1!=optimizerController.startPoints.indexOf(b)?c[c.length-1].push(getText("Iteration Start")):-1!=optimizerController.bestPoints.indexOf(b)?c[c.length-1].push(getText("Iteration Optimum")):c[c.length-1].push("")}a.push({name:getText("Results Table"),type:"table",data:c,header:d});showData(getText("Optimization Results"),a);optimizerProgress.close()}
var OptDimension=function(a){this.coords=[];if(null!=a)for(var b=0;b<optimizerController.targets.length;b++)b==a?this.coords.push(1):this.coords.push(0);else for(b=0;b<optimizerController.targets.length;b++)this.coords.push(0)};OptDimension.prototype.toString=function(){for(var a=[],b=0;b<this.coords.length;b++)a.push(this.coords[b]);return"<<"+a.join(", ")+">>"};OptDimension.prototype.append=function(a,b){b=b?b:1;for(var c=0;c<a.coords.length;c++)this.coords[c]+=a.coords[c]*b};
OptDimension.prototype.apply=function(a){for(var b=0;b<optimizerController.targets.length;b++){var c=parseFloat(getValue(optimizerController.targets[b]))+this.coords[b]*a*optimizerController.stepSizes[b]*optimizerController.stepScale;optMsg("Value "+b+": "+c);setValue(optimizerController.targets[b],c)}};OptDimension.prototype.stationary=function(){for(var a=0;a<this.coords.length;a++)if(0!=this.coords[a])return!1;return!0};
OptDimension.prototype.makeUnit=function(){for(var a=this.length(),b=0;b<this.coords.length;b++)this.coords[b]/=a};OptDimension.prototype.length=function(){for(var a=0,b=0;b<this.coords.length;b++)a+=Math.pow(this.coords[b],2);return Math.sqrt(a)};OptDimension.prototype.equalTo=function(a){for(var b=0,c=0;c<this.coords.length;c++)b+=Math.abs(a.coords[c]*this.coords[c]);b/=this.length()*a.length();return 0.99<b};
function dimensionExists(a){for(var b=0;b<optimizerController.optDimensions.length;b++)if(optimizerController.optDimensions[b].equalTo(a))return!0;return!1}function metFinishedConditions(){if(optimizerController.iterations>optimizerController.optIterations)return optimizerController.terminationReasons.push("Iterations"),!0;optimizerController.metAccuracyConditions&&optimizerController.terminationReasons.push("StepSize");return optimizerController.metAccuracyConditions}
function reduceStepSizes(){optimizerController.metAccuracyConditions=!0;for(var a=0;a<optimizerController.stepSizes.length;a++)if(optimizerController.stepSizes[a]*optimizerController.stepScale>=optimizerController.accuracies[a]){optimizerController.metAccuracyConditions=!1;break}optimizerController.stepScale*=optimizerController.reductionRate;optMsg("Step scale: "+optimizerController.stepScale)}function restoreCurrentPoint(){restorePoint(optimizerController.currentPointMarker)}
function restorePoint(a){for(var b=0;b<optimizerController.targets.length;b++)setValue(optimizerController.targets[b],optimizerController.solutionSpace[b+1][a])}
function evaluateCurrentPoint(){testPointBounds();for(var a=[],b=0;b<optimizerController.targets.length;b++)a.push(parseFloat(getValue(optimizerController.targets[b])));for(var c=0;c<optimizerController.evaluations;c++){for(var d=!0,b=0;b<optimizerController.targets.length;b++)if(optimizerController.solutionSpace[b+1][c]!=a[b]){d=!1;break}if(d)return c}a=runModel({silent:!0});if("none"!=a.error)throw mxUtils.alert(a.error),a.errorPrimitive&&highlight(a.errorPrimitive),optimizerProgress&&optimizerProgress.close(),
"Opt Error";optimizerController.evaluations+=1;optimizerController.solutionSpace.length=optimizerController.targets.length+1;for(b=0;b<optimizerController.solutionSpace.length;b++)optimizerController.solutionSpace[b]||(optimizerController.solutionSpace[b]=[]),optimizerController.solutionSpace[b].length=optimizerController.evaluations;if("Final Value"==optimizerController.goalType)optimizerController.solutionSpace[0][optimizerController.evaluations-1]=a.lastValue(optimizerController.goal);else if("Integral of Value"==
optimizerController.goalType){a=a.value(optimizerController.goal);for(b=c=0;b<a.length;b++)c+=a[b];optimizerController.solutionSpace[0][optimizerController.evaluations-1]=c}else alert("Unknonw optimizer goal type: "+optimizerController.goalType);for(b=0;b<optimizerController.targets.length;b++)optimizerController.solutionSpace[b+1][optimizerController.evaluations-1]=parseFloat(getValue(optimizerController.targets[b]));return optimizerController.evaluations-1}
function explore(){var a=new OptDimension,b=optimizerController.currentPointMarker,c;optMsg("Exploring");for(var d=0;d<optimizerController.optDimensions.length;d++)optMsg("Dimensions "+optimizerController.optDimensions[d].toString()),optimizerController.optDimensions[d].apply(1),c=evaluateCurrentPoint(),firstBetter(c,b)?(optMsg("Plus 1 Success"),a.append(optimizerController.optDimensions[d],1),b=c):(restorePoint(b),optimizerController.optDimensions[d].apply(-1),c=evaluateCurrentPoint(),firstBetter(c,
b)?(optMsg("Minus 1 Success"),a.append(optimizerController.optDimensions[d],-1),b=c):(optMsg("Static"),restorePoint(b)));return a}
function patternMove(a){optMsg("Pattern Move: "+a.toString());var b=evaluateCurrentPoint();a.apply(1);a=evaluateCurrentPoint();optMsg("Step One: "+optimizerController.solutionSpace[0][b]);optMsg("Step Two: "+optimizerController.solutionSpace[0][a]);firstBetter(b,a)?(optMsg("Chose 1"),optimizerController.currentPointMarker=b):(optMsg("Chose 2"),optimizerController.currentPointMarker=a);restoreCurrentPoint()}
function firstBetter(a,b){return optimizerController.solutionSpace[0][a]*optimizerController.minimize<optimizerController.solutionSpace[0][b]*optimizerController.minimize}
function testPointBounds(){for(var a=0;a<optimizerController.targets.length;a++)parseFloat(getValue(optimizerController.targets[a]))>optimizerController.maximums[a]&&setValue(optimizerController.targets[a],optimizerController.maximums[a]),parseFloat(getValue(optimizerController.targets[a]))<optimizerController.minimums[a]&&setValue(optimizerController.targets[a],optimizerController.minimums[a])}
function setInitialPosition(a){for(var b=0;b<optimizerController.targets.length;b++){var c;c=a?Math.random():0.5;setValue(optimizerController.targets[b],(optimizerController.maximums[b]-optimizerController.minimums[b])*c+optimizerController.minimums[b])}}
function optString(a){var b=optimizerController.terminationReasons[optimizerController.bestPoints.indexOf(a)],c;c="<br/><center><table border='1' cellpadding='4' align = 'center' style='text-align:center;background-color: white; border: solid 1px black; border-spacing: 0; border-collapse: collapse;'><tr><td style='padding:.5em'><b>Primitive</b></td><td style='padding:.5em'><b>Optimum</b></td><td style='padding:.5em'><b>Range</b></td></tr><tr><td colspan=3 style='padding:.5em'><b>Goal Primitive</b></td></tr><tr><td style='padding:.5em'><b>["+getName(optimizerController.goal)+
"]</b></td><td style='padding:.5em'>"+optimizerController.solutionSpace[0][a]+"</td><td style='padding:.5em'>";c=("Iterations"==b?c+" optimization terminated due to exceeding maximum number of allowed iterations":c+"--")+"</td></tr>";c+="<tr><td colspan=3 style='padding:.5em'><b>Changed Primitives</b></td></tr>";for(var d=0;d<optimizerController.targets.length;d++){var e=optimizerController.solutionSpace[d+1][a];c=c+"<tr><td style='padding:.5em'><b>["+getName(optimizerController.targets[d])+"]</></td><td style='padding:.5em'>"+
e+"</td><td style='padding:.5em'>";"StepSize"==b?(c=e==optimizerController.minimums[d]?c+"-Infinity":c+(e-optimizerController.accuracies[d]),c+=" - ",c=e==optimizerController.maximums[d]?c+"Infinity":c+(e+optimizerController.accuracies[d])):c+="--";c+="</td></tr>"}return c+="</table></center>"}var DataStore=function(){this.data=[]};DataStore.prototype.iterations=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(b);return a};function optMsg(a){isLocal()&&console.log(a)};var linkedResults=void 0,defaultColors="#94ae0a #115fa6 #a61120 #ff8809 #ffd13e #a61187 #24ad9a #7c7474 #a66111".split(" ");function dataRenderer(a){return a instanceof Vector?a.toString():a instanceof Agent?"Agent "+(a.index+1):commaStr(a)}function commaStr(a){if(isUndefined(a)||null===a)return"";if(1E9<=a||1E-9>=a&&0!=a)return a.toPrecision(3);a=round(a,9)+"";var b=a.split(".");a=b[0];for(var b=1<b.length?"."+b[1]:"",c=/(\d+)(\d{3})/;c.test(a);)a=a.replace(c,"$1,$2");return a+b}
function numericBound(a){return void 0===a||""===a?void 0:+a}function round(a,b,c){var d,e,f;b=Math.pow(10,b|0);a*=b;f=0<a|-(0>a);e=a%1===0.5*f;d=Math.floor(a);if(e)switch(c){case "PHP_ROUND_HALF_DOWN":a=d+(0>f);break;case "PHP_ROUND_HALF_EVEN":a=d+d%2*f;break;case "PHP_ROUND_HALF_ODD":a=d+!(d%2);break;default:a=d+(0<f)}return(e?a:Math.round(a))/b}var displayConfigWin,displayConfigStore,displayConfigStore2;
function openDisplayConfigure(a){displayConfigStore=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]});displayConfigStore2=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]});displayConfigWin=new Ext.Window({layout:"fit",modal:!0,autoScroll:!0,title:getText("Chart/Table Configuration"),width:Math.min(Ext.getBody().getViewSize().width,470),height:Math.min(Ext.getBody().getViewSize().height,580),resizable:!1,
closeAction:"destroy",plain:!0,items:[new Ext.FormPanel({fieldDefaults:{labelWidth:80},frame:!0,autoScroll:!0,id:"displayConfigure",bodyStyle:"padding:5px 5px 0px 12px",defaults:{width:425},items:[{xtype:"fieldset",title:getText("General Settings"),defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[{name:"chartType",id:"chartType",fieldLabel:getText("Type"),xtype:"segmentedbutton",style:{"margin-bottom":"10px"},items:[{text:getText("Time Series"),itemId:"Time Series",pressed:!0,
tooltip:"A time series chart shows how the valus of one or primitives change over time.."},{text:getText("Scatter Plot"),itemId:"Scatterplot",tooltip:"A scatter plot allows you to see how two primitives change together. It is also known as a Phase-Plane plot."},{text:getText("Table"),itemId:"Tabular",tooltip:"A table gives you the precise values of your primitives over the course of the simulation."},{text:getText("Agent Map"),itemId:"Map",tooltip:"An agent map plots the geographic locations of agents within an Agent Population primitive. Connections between agents and agent states are also plotted."}],
listeners:{toggle:function(a,b,c){c&&(a=b.getItemId(),"Scatterplot"==a?(Ext.getCmp("xAxisLabel").setValue("%o"),Ext.getCmp("yAxisLabel").setValue("%o"),Ext.getCmp("showMarkers").setValue(!0),Ext.getCmp("showLines").setValue(!1)):"Time Series"==a?(Ext.getCmp("xAxisLabel").setValue("Time (%u)"),Ext.getCmp("yAxisLabel").setValue(""),Ext.getCmp("showMarkers").setValue(!1),Ext.getCmp("showLines").setValue(!0)):"Map"==a&&(Ext.getCmp("xAxisLabel").setValue("%o"),Ext.getCmp("yAxisLabel").setValue("%o"),Ext.getCmp("showMarkers").setValue(!0),
Ext.getCmp("showLines").setValue(!1)),"Tabular"==a?Ext.getCmp("chartSettings").setStyle("opacity",0.4):Ext.getCmp("chartSettings").setStyle("opacity",1))}}},{fieldLabel:getText("Title"),id:"chartTitle",name:"chartTitle",allowBlank:!1},Ext.create("Ext.form.field.Tag",{fieldLabel:getText("Data"),name:"chartPrimitives",id:"chartPrimitives",displayField:"pname",valueField:"pid",filterPickList:!0,queryMode:"local",store:displayConfigStore,emptyText:getText("Select which data to display")}),{xtype:"checkboxfield",
fieldLabel:"",name:"autoAdd",id:"autoAdd",boxLabel:getText("Add newly created primitives to the data")}]},{xtype:"fieldset",title:getText("Chart Settings"),defaultType:"textfield",id:"chartSettings",defaults:{anchor:"100%"},layout:"anchor",items:[{xtype:"container",layout:"column",anchor:"100%",margin:7,items:[{columnWidth:0.33,xtype:"checkboxfield",boxLabel:getText("Show Markers"),name:"showMarkers",inputValue:"1",id:"showMarkers"},{columnWidth:0.33,xtype:"checkboxfield",boxLabel:getText("Show Lines"),
name:"showLines",inputValue:"1",id:"showLines"},{columnWidth:0.33,xtype:"checkboxfield",boxLabel:getText("Use Areas"),name:"showArea",inputValue:"1",id:"showArea"}]},{xtype:"combo",id:"legendPosition",fieldLabel:getText("Legend Position"),allowBlank:!1,labelWidth:140,store:[["Automatic",getText("Automatic")],["Top",getText("Top")],["Right",getText("Right")],["Bottom",getText("Bottom")],["Left",getText("Left")],["None",getText("None")]],queryMode:"local",forceSelection:!0},{xtype:"fieldset",title:getText("X-Axis"),
defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[{xtype:"fieldcontainer",fieldLabel:"",layout:"hbox",defaultType:"textfield",fieldDefaults:{labelAlign:"top"},items:[{flex:1,fieldLabel:getText("Label"),id:"xAxisLabel",name:"xAxisLabel"},{hidden:!1,xtype:"numberfield",fieldLabel:getText("Min"),width:110,id:"xAxisMin",name:"xAxisMin",margin:"0 0 0 5"},{hidden:!1,xtype:"numberfield",fieldLabel:getText("Max"),width:110,id:"xAxisMax",name:"xAxisMax",margin:"0 0 0 5"}]}]},{xtype:"fieldset",
title:getText("Y-Axis"),defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[{xtype:"fieldcontainer",fieldLabel:"",layout:"hbox",defaultType:"textfield",fieldDefaults:{labelAlign:"top"},items:[{flex:1,fieldLabel:getText("Label"),id:"yAxisLabel",name:"yAxisLabel"},{hidden:!1,xtype:"numberfield",fieldLabel:getText("Min"),width:110,id:"yAxisMin",name:"yAxisMin",margin:"0 0 0 5"},{hidden:!1,xtype:"numberfield",fieldLabel:getText("Max"),width:110,id:"yAxisMax",name:"yAxisMax",margin:"0 0 0 5"}]}]},
{xtype:"fieldset",title:getText("Secondary Y-Axis"),defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[Ext.create("Ext.form.field.Tag",{fieldLabel:getText("Data"),name:"chartPrimitives2",id:"chartPrimitives2",displayField:"pname",filterPickList:!0,valueField:"pid",queryMode:"local",store:displayConfigStore2,emptyText:getText("Select which data to display")}),{xtype:"fieldcontainer",layout:"hbox",defaultType:"textfield",fieldDefaults:{labelAlign:"top"},items:[{flex:1,fieldLabel:getText("Label"),
id:"yAxisLabel2",name:"yAxisLabel2"},{hidden:!1,xtype:"numberfield",fieldLabel:getText("Min"),width:110,id:"yAxisMin2",name:"yAxisMin2",margin:"0 0 0 5"},{hidden:!1,xtype:"numberfield",fieldLabel:getText("Max"),width:110,id:"yAxisMax2",name:"yAxisMax2",margin:"0 0 0 5"}]}]}]}]})],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){displayConfigWin.close()}},{glyph:61452,scale:"large",text:getText("Apply"),handler:function(){var b=displayConfigWin.myDisplay,c=displayConfigWin.myWin;
if(Ext.getCmp("chartTitle").validate()&&Ext.getCmp("chartPrimitives").validate()){graph.getModel().beginUpdate();graph.getModel().execute(new mxCellAttributeChange(b,"name",Ext.getCmp("chartTitle").getValue()));c.tabs.getActiveTab().setTitle(Ext.getCmp("chartTitle").getValue());var d;Ext.getCmp("chartType").items.each(function(a){a.pressed&&(d=a.getItemId())});graph.getModel().execute(new mxCellAttributeChange(b,"Type",d));graph.getModel().execute(new mxCellAttributeChange(b,"AutoAddPrimitives",Ext.getCmp("autoAdd").getValue().toString()));
graph.getModel().execute(new mxCellAttributeChange(b,"legendPosition",Ext.getCmp("legendPosition").getValue()));graph.getModel().execute(new mxCellAttributeChange(b,"xAxis",Ext.getCmp("xAxisLabel").getValue()));graph.getModel().execute(new mxCellAttributeChange(b,"yAxis",Ext.getCmp("yAxisLabel").getValue()));graph.getModel().execute(new mxCellAttributeChange(b,"yAxis2",Ext.getCmp("yAxisLabel2").getValue()));graph.getModel().execute(new mxCellAttributeChange(b,"xAxisMin",Ext.getCmp("xAxisMin").getValue()));
graph.getModel().execute(new mxCellAttributeChange(b,"yAxisMin",Ext.getCmp("yAxisMin").getValue()));graph.getModel().execute(new mxCellAttributeChange(b,"yAxisMin2",Ext.getCmp("yAxisMin2").getValue()));graph.getModel().execute(new mxCellAttributeChange(b,"xAxisMax",Ext.getCmp("xAxisMax").getValue()));graph.getModel().execute(new mxCellAttributeChange(b,"yAxisMax",Ext.getCmp("yAxisMax").getValue()));graph.getModel().execute(new mxCellAttributeChange(b,"yAxisMax2",Ext.getCmp("yAxisMax2").getValue()));
var k=Ext.getCmp("chartPrimitives").getValue();if("Scatterplot"==d)2<k.length?(k.length=2,mxUtils.alert(getText("The primitive list for the scatterplot has been truncated to two items. One for the x-Axis and one for the y-Axis."))):1==k.length&&mxUtils.alert(getText("You need two primitives to create a scatterplot. One for the x-Axis and one for the y-Axis."));else if("Map"==d){for(var l=!1,m=k.length-1;0<=m;m--)k[m]&&"Agents"!=findID(k[m]).value.nodeName?(k.splice(m,1),l=!0):k[m]||k.splice(m,1);
l&&mxUtils.alert(getText("Map charts can only show agent population primitives."))}graph.getModel().execute(new mxCellAttributeChange(b,"Primitives",k.join(",")));graph.getModel().execute(new mxCellAttributeChange(b,"Primitives2",Ext.getCmp("chartPrimitives2").getValue().join(",")));graph.getModel().execute(new mxCellAttributeChange(b,"showMarkers",Ext.getCmp("showMarkers").getValue().toString()));graph.getModel().execute(new mxCellAttributeChange(b,"showLines",Ext.getCmp("showLines").getValue().toString()));
graph.getModel().execute(new mxCellAttributeChange(b,"showArea",Ext.getCmp("showArea").getValue().toString()));c.tabs.getActiveTab().removeAll();for(m=c.displayInformation.maps.length-1;0<=m;m--)c.displayInformation.maps[m].id==b.id&&c.displayInformation.maps.splice(m,1);for(m=c.displayInformation.histograms.length-1;0<=m;m--)c.displayInformation.histograms[m].id==b.id&&c.displayInformation.histograms.splice(m,1);c.tabs.getActiveTab().add(renderDisplay(b,c.displayInformation));displayConfigWin.close();
graph.getModel().endUpdate();a.enableTabs()}else mxUtils.alert(getText("Correct the display configuration before applying."))}}]});for(var b=[],c=0;c<a.displayInformation.displayedIds.length;c++)b.push({pid:a.displayInformation.displayedIds[c],pname:a.displayInformation.displayedHeaders[c]});b.sort(function(a,b){return a.pname.localeCompare(b.pname)});displayConfigStore.loadData(b);displayConfigStore2.loadData(b);var d=a.tabs.getActiveTab().display;Ext.getCmp("chartTitle").setValue(d.getAttribute("name"));
Ext.getCmp("chartType").items.each(function(a){a.setPressed(a.getItemId()==d.getAttribute("Type"))});Ext.getCmp("xAxisLabel").setValue(d.getAttribute("xAxis"));Ext.getCmp("yAxisLabel").setValue(d.getAttribute("yAxis"));Ext.getCmp("yAxisLabel2").setValue(d.getAttribute("yAxis2"));Ext.getCmp("xAxisMin").setValue(d.getAttribute("xAxisMin"));Ext.getCmp("yAxisMin").setValue(d.getAttribute("yAxisMin"));Ext.getCmp("yAxisMin2").setValue(d.getAttribute("yAxisMin2"));Ext.getCmp("xAxisMax").setValue(d.getAttribute("xAxisMax"));
Ext.getCmp("yAxisMax").setValue(d.getAttribute("yAxisMax"));Ext.getCmp("yAxisMax2").setValue(d.getAttribute("yAxisMax2"));Ext.getCmp("legendPosition").setValue(d.getAttribute("legendPosition"));Ext.getCmp("showMarkers").setValue(d.getAttribute("showMarkers"));Ext.getCmp("showLines").setValue(d.getAttribute("showLines"));Ext.getCmp("showArea").setValue(d.getAttribute("showArea"));Ext.getCmp("autoAdd").setValue(d.getAttribute("AutoAddPrimitives"));Ext.getCmp("chartPrimitives").setValue([]);isUndefined(d.getAttribute("Primitives"))||
Ext.getCmp("chartPrimitives").setValue(d.getAttribute("Primitives").split(","));Ext.getCmp("chartPrimitives2").setValue([]);isUndefined(d.getAttribute("Primitives2"))||Ext.getCmp("chartPrimitives2").setValue(d.getAttribute("Primitives2").split(","));displayConfigWin.myDisplay=d;displayConfigWin.myWin=a;displayConfigWin.show();Ext.getCmp("displayConfigure").scrollTo(0,0,!1)}
function renderDisplay(a,b){function c(a,c){E.push(a);G.push(a+"x");C.push(a+"y");D.push({type:"float",name:a+"x"});D.push({type:"float",name:a+"y"});for(var d=0,d=0;d<b.colors.length&&(b.ids[d]!=I||b.headers[d]!=c);d++);var e=null;isGray(b.colors[d])?(e=defaultColors[v],v++,v%=defaultColors.length):e=b.colors[d];u.push({title:c,animation:!1,type:"scatter",axis:"left",colors:[e],xField:a+"x",yField:a+"y",marker:[{type:"circle",radius:5},{type:"rect",width:9,height:9},{type:"path",path:[["M",0,1],
["L",1,0],["L",0,-1],["L",-1,0],["Z"]],scale:6},{type:"path",path:[["M",0,-145],["L",48,-50],["L",153,-36],["L",76,39],["L",93,143],["L",0,95],["L",-93,143],["L",-76,39],["L",-153,-36],["L",-48,-50],["Z"]],scalingX:0.05,scalingY:-0.05}][m%5],highlight:!0,highlightCfg:{radius:5},tooltip:{trackMouse:!0,width:160,style:"background-color: #fff",renderer:F(H)}})}for(var d=a.getAttribute("Type"),e=isDefined(a.getAttribute("Primitives"))?a.getAttribute("Primitives").split(","):[],f=e.length-1;0<=f;f--)inAgent(findID(e[f]))&&
e.splice(f,1);for(var g=isDefined(a.getAttribute("Primitives2"))?a.getAttribute("Primitives2").split(","):[],f=g.length-1;0<=f;f--)inAgent(findID(g[f]))&&g.splice(f,1);if(0==e.length||"Scatterplot"==d&&2>e.length)return{xtype:"box",html:"<br/><br/><br/><b><big><center><span style='color:darkgray'>"+getText("No data to display")+"<br/><br/>"+getText("Press 'Configure' to select data")+"</span></center></big></b>"};var k,l=[];if("Tabular"==d){for(var l=[{header:getText("Time"),sortable:!0,flex:1,dataIndex:"Time",
renderer:function(a){return round(a,9)}}],m=0;m<e.length;m++)for(f=0;f<b.ids.length;f++)e[m]==b.ids[f]&&l.push({header:b.headers[f],sortable:!0,flex:1,dataIndex:b.elementIds[f],renderer:dataRenderer});return new Ext.grid.GridPanel({store:b.store,columns:l,stripeRows:!0,border:!1,frame:!1,header:!1,dockedItems:[{xtype:"toolbar",dock:"bottom",items:["->",downloadButton(a.getAttribute("name"))]}]})}if("Time Series"==d){var e=e.concat(g),n=[];k=[];var p=[],q=[],u=[],v=0,y=[];if(isTrue(a.getAttribute("showArea"))){for(var z=
[],x=[],m=0;m<e.length;m++)for(f=0;f<b.ids.length;f++)if(e[m]==b.ids[f])if(b.renderers[f]){var B=-1==g.indexOf(e[m]);B&&(isGray(b.colors[f])?(y.push(defaultColors[v]),v++,v%=defaultColors.length):y.push(b.colors[f]),z.push(b.elementIds[f]),x.push(b.headers[f]))}else l.push(createHistogramChart(b,f));u.push({highlight:!1,type:"area",axis:"left",xField:"Time",yField:z,title:x,smooth:!1,colors:y})}else for(m=0;m<e.length;m++)for(f=0;f<b.ids.length;f++)if(e[m]==b.ids[f])if(b.renderers[f]){var B=-1==g.indexOf(e[m]),
x=b.elementIds[f],A=null;isGray(b.colors[f])?(A=defaultColors[v],v++,v%=defaultColors.length):A=b.colors[f];y.push(A);z={"stroke-width":4};isTrue(a.getAttribute("showLines"))||(z.stroke="none");B?(p.push(b.headers[f]),n.push(x)):(q.push(b.headers[f]),k.push(x));u.push({type:"line",axis:B?"left":"right",xField:"Time",yField:B?n[n.length-1]:k[k.length-1],title:B?p[p.length-1]:q[q.length-1],showMarkers:isTrue(a.getAttribute("showMarkers")),marker:{radius:4},colors:[A],smooth:!1,style:z,highlight:!0,
highlightCfg:{radius:5},tooltip:{trackMouse:!0,width:160,style:"background-color: #fff",renderer:function(a,b){this.setHtml("Time: "+a.get("Time")+"<br/>"+clean(b.series.getTitle())+": "+commaStr(a.get(b.field)))}}})}else l.push(createHistogramChart(b,f));f=[{type:"numeric",position:"bottom",fields:"Time",minimum:isUndefined(a.getAttribute("xAxisMin"))?b.store.min("Time"):parseFloat(a.getAttribute("xAxisMin")),maximum:isUndefined(a.getAttribute("xAxisMax"))?b.times[b.times.length-1]:parseFloat(a.getAttribute("xAxisMax")),
title:{text:quickLabel(a.getAttribute("xAxis"),a.getAttribute("name"),stringArray(p,", "," and ")),fontSize:14},grid:!0,titleMargin:16,renderer:function(a){return round(a,9)}}];e.length>g.length&&f.push({type:"numeric",position:"left",minimum:numericBound(a.getAttribute("yAxisMin")),maximum:numericBound(a.getAttribute("yAxisMax")),fields:n,grid:!0,title:{text:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),stringArray(p,", "," and ")),fontSize:14},titleMargin:20,renderer:commaStr});0<g.length&&
f.push({minimum:numericBound(a.getAttribute("yAxisMin2")),maximum:numericBound(a.getAttribute("yAxisMax2")),type:"numeric",position:"right",fields:k,grid:e.length==g.length,title:{text:quickLabel(a.getAttribute("yAxis2"),a.getAttribute("name"),stringArray(q,", "," and ")),fontSize:14},titleMargin:20,renderer:commaStr});k={flex:1,interactions:["crosszoom","itemhighlight"],animation:!1,shadow:!1,store:b.store,axes:f,series:u};"None"!=a.getAttribute("legendPosition")&&(k.legend={docked:"Automatic"==
a.getAttribute("legendPosition")?4<e.length?"right":"top":a.getAttribute("legendPosition").toLowerCase()});k=Ext.create("Ext.chart.CartesianChart",k)}else if("Scatterplot"==d){g=[];n=[];for(m=0;m<e.length;m++)for(f=0;f<b.ids.length;f++)e[m]==b.ids[f]&&(b.renderers[f]?(g.push(b.elementIds[f]),n.push(b.headers[f])):l.push(createHistogramChart(b,f)));z={"stroke-width":4};isTrue(a.getAttribute("showLines"))||(z.stroke="none");k=Ext.create("Ext.chart.CartesianChart",{flex:1,interactions:["crosszoom","itemhighlight"],
xtype:"chart",animation:!1,shadow:!1,store:b.store,axes:[{minimum:numericBound(a.getAttribute("xAxisMin")),maximum:numericBound(a.getAttribute("xAxisMax")),type:"numeric",position:"bottom",fields:g[0],titleMargin:16,grid:!0,title:{text:quickLabel(a.getAttribute("xAxis"),a.getAttribute("name"),n[0]),fontSize:14},renderer:commaStr},{minimum:numericBound(a.getAttribute("yAxisMin")),maximum:numericBound(a.getAttribute("yAxisMax")),type:"numeric",position:"left",fields:g[1],grid:!0,title:{text:quickLabel(a.getAttribute("yAxis"),
a.getAttribute("name"),n[1]),fontSize:14},titleMargin:20,renderer:commaStr}],series:[{type:"scatter",axis:"left",xField:g[0],yField:g[1],showMarkers:isTrue(a.getAttribute("showMarkers")),marker:{radius:4},style:z,smooth:!1,highlight:!0,highlightCfg:{radius:5},tooltip:{trackMouse:!0,width:160,style:"background-color: #fff",renderer:function(a,b,c,d){return function(e,f){this.setHtml(clean(b)+": "+commaStr(e.get(a))+"<br/>"+clean(d)+": "+commaStr(e.get(c)))}}(g[0],n[0],g[1],n[1])}}]})}else if("Map"==
d){for(var v=0,y=[],D=[{type:"float",name:"agentIndex"},{type:"string",name:"states"}],u=[],E=[],G=[],C=[],f=[],F=function(a){return function(b,c){var d=c.field,d=d.substr(0,d.length-1);this.setTitle(a+" "+b.get("agentIndex"));this.setHtml((b.get("states")?"<p>"+b.get("states")+"</p>":"")+"<p>("+commaStr(b.get(d+"x"))+"; "+commaStr(b.get(d+"y"))+")</p>")}},m=0;m<e.length;m++){var I=e[m],n=b.agents[I];if(isUndefined(n)){alert("Primitive is not an agent population!");return}f.push(n);var H=getName(findID(n.item.getAttribute("Agent")));
c("series_"+I+"__",H);for(g=0;g<n.data.states.length;g++)k="series_"+I+"_"+n.data.states[g]+"_",p=getName(findID(n.data.states[g])),c(k,p)}e=new Ext.data.Store({fields:D});k=Ext.create("Ext.chart.CartesianChart",{flex:1,interactions:["crosszoom","itemhighlight"],legend:"None"==a.getAttribute("legendPosition")?!1:{docked:"Automatic"==a.getAttribute("legendPosition")?4<E.length?"right":"top":a.getAttribute("legendPosition").toLowerCase()},animation:!1,animate:!1,shadow:!1,store:e,axes:[{type:"numeric",
position:"left",fields:C,grid:!1,title:{text:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),"Position ("+n.item.getAttribute("GeoDimUnits")+")"),fontSize:14},titleMargin:20,renderer:commaStr,minimum:0,maximum:parseFloat(simpleNum(n.data.height,n.data.units))},{type:"numeric",position:"bottom",fields:G,grid:!1,titleMargin:16,title:{text:quickLabel(a.getAttribute("xAxis"),a.getAttribute("name"),"Position ("+n.item.getAttribute("GeoDimUnits")+")"),fontSize:14},renderer:commaStr,minimum:0,
maximum:parseFloat(simpleNum(n.data.width,n.data.units))}],series:u,listeners:{redraw:function(a){if(this.oldLinks){for(var b=0;b<this.oldLinks.length;b++)this.oldLinks[b].destroy();this.oldLinks=[]}if(this.links){var c=function(b){var c=a.getInnerRect(),d=a.getAxes()[1].getRange();return(b-d[0])/(d[1]-d[0])*c[2]},d=function(b){var c=a.getInnerRect(),d=a.getAxes()[0].getRange();return c[3]-(b-d[0])/(d[1]-d[0])*c[3]};this.oldLinks=[];var e=[],f;for(f in this.links){for(var b=this.links[f][0],g=this.links[f][1],
g=[[c(b.items[0]),d(b.items[1])],[c(g.items[0]),d(g.items[1])]],k="M"+g[0][0]+" "+g[0][1]+" ",b=1;b<g.length;b++)k=k+"L"+g[b][0]+" "+g[b][1]+" ";k+="Z";e.push({type:"path",opacity:0.5,fill:"#aaa",path:k,stroke:"#aaa","stroke-width":1})}this.oldLinks=a.getSurface("main").add.apply(a.getSurface("main"),e)}}}});b.maps.push({id:a.id,store:e,agents:f,bases:E,chart:k});buildMapStore(b.maps[b.maps.length-1],b.scripter.time)}if("Tabular"!=d)return d=[],0<k.series.length&&d.push(k),d=d.concat(l),{xtype:"panel",
items:d,layout:1==d.length?"fit":{type:"vbox",align:"stretch"},html:"<div id='scratchpad"+analysisCount+"_"+a.id+"' style='z-index:1000;position:absolute; left:0px;bottom:0px;top:0px;right:0px;display:none;'></div>"}}
function createResultsWindow(a,b){function c(){var a=l.tabs,a=a.items.indexOf(a.getActiveTab());l.down("#delete").setDisabled(0==l.displays.length);l.down("#left").setDisabled(2>l.displays.length||0==a);l.down("#right").setDisabled(2>l.displays.length||a==l.displays.length-1);l.down("#scratchpad").setDisabled(0==l.displays.length||"Tabular"==l.displays[a].getAttribute("Type"));l.down("#configure").setDisabled(0==l.displays.length)}a.maps=[];a.histograms=[];analysisCount++;var d=primitives("Display"),
e=[],f={time:0};a.scripter=f;for(var g=0,k=0;k<d.length;k++)e.push({xtype:"panel",autoScroll:!1,title:d[k].getAttribute("name"),items:[renderDisplay(d[k],a)],layout:"fit",display:d[k]}),b&&d[k]==b.selectedDisplay&&(g=k);e=new Ext.TabPanel({activeTab:g,flex:1,deferredRender:!1,frame:!1,border:!1,enableTabScroll:!0,defaults:{autoScroll:!0},items:e,listeners:{tabchange:c}});f.updatingSlider=!1;f.timeIndex=0;f.maxTime=function(){return this.simulator.displayInformation.store.maxLoaded};f.minTime=0;f.timeStep=
2;f.times=a.times;f.simulator=simulate;f.showSliders=function(){f.slidersShown||(0<sliderPrimitives(["Variable","Flow"]).length&&(f.dockedPanel=Ext.create("Ext.Panel",{xtype:"panel",layout:"fit",items:[createSliders(["Variable","Flow"],function(a,b){if(f.isFinished)mxUtils.alert("The simulation has finished and slider values cannot be changed.");else{for(var c=new Material(b),d=0;d<simulate.sliders[a.id].length;d++)simulate.sliders[a.id][d].equation=c;simulate.sliders[a.id][0].dna.equation=c;simulate.valueChange=
!0}},function(a,b,c,d){b(a.sliderCell,d)})],dock:"right",width:200,autoScroll:!0,title:"Sliders",collapsible:!0,split:!0,border:!0,bodyStyle:"background: none",collapseDirection:"right",animCollapse:!1}),l.addDocked(f.dockedPanel)),f.slidersShown=!0)};f.slider=Ext.create("Ext.form.SliderField",{minValue:0,animate:!1,hideLabel:!0,disabled:!0,maxValue:a.times.length-1,flex:1,step:f.timeStep,margin:"0 10 0 10",useTips:!0,tipText:function(a){return""+a.slider.s.times[a.slider.getValue()]}});f.combo=Ext.create("Ext.form.field.ComboBox",
{fieldLabel:"",labelWidth:0,allowBlank:!1,store:[[0.2,getText("%s x Normal","0.2")],[0.5,getText("%s x Normal","0.5")],[1,getText("Normal Speed")],[1.5,getText("%s x Normal","1.5")],[2,getText("%s x Normal","2")],[5,getText("%s x Normal","5")],[10,getText("%s x Normal","10")],[-1,getText("Full Speed")]],queryMode:"local",value:window.storyConverter?-1:b&&void 0!==b.rate?b.rate:parseFloat(getSetting().getAttribute("Throttle")),width:140,forceSelection:!0,listeners:{select:function(a){graph.getModel().beginUpdate();
a=new mxCellAttributeChange(getSetting(),"Throttle",a.getValue());graph.getModel().execute(a);graph.getModel().endUpdate()}}});f.slider.s=f;f.slider.on("change",function(a,b){this.s.updatingSlider||(b>this.s.maxTime()?this.setValue(this.s.maxTime()):this.s.loadTime(b))});f.playBut=Ext.create("Ext.button.Button",{scale:"medium",allowDepress:!0,enableToggle:!0,pressed:!0,glyph:61516});f.stopBut=Ext.create("Ext.button.Button",{scale:"medium",margin:"0 10 0 10",glyph:61517,handler:function(a){endRunningSimulation()}});
f.finished=function(){this.isFinished=!0;this.stopBut.hide();this.slider.setDisabled(!1);this.dockedPanel&&this.dockedPanel.collapse()};f.playBut.s=f;f.animInter=-1;f.playBut.on("toggle",function(b,c){c?(f.endMode="wait",f.slider.getValue()==a.times.length-1&&f.slider.setValue(f.minTime),f.playBut.setGlyph(61516),f.advanceTimer(),clearInterval(f.animInter),f.animInter=setInterval(function(){f.advanceTimer()},100/Math.min(0.5,f.combo.getValue())),f.simulator&&!f.simulator.completed()&&(f.simulator.shouldSleep=
!1,f.simulator.resume())):f.pause(!0)});f.pause=function(a){this.slider.isDisabled()&&this.showSliders();a&&!this.isFinished&&this.slider.setValue(this.maxTime());this.playBut.pressed&&this.playBut.toggle(!1,!0);this.playBut.setGlyph(61515);clearInterval(this.animInter);a&&!this.simulator.completed()&&this.simulator.sleep()};f.endMode="wait";f.advanceTimer=function(){this.slider.getValue()<this.maxTime()||this.maxTime()==a.times.length-1?this.slider.getValue()<a.times.length-1?-1==this.combo.getValue()?
this.loadTime(this.maxTime()):this.loadTime(Math.min(this.maxTime(),this.slider.getValue()+this.timeStep*Math.max(0.5,this.combo.getValue()))):this.playBut.toggle():("pause"==this.endMode||f.isFinished)&&this.pause()};f.loadTime=function(b){a.store.clearFilter(!0);this.time=b;a.store.filter([{filterFn:function(a){return a.get("id")<=b}}]);a.maps.forEach(function(a){buildMapStore(a,b)});a.histograms.forEach(function(a){buildHistogramStore(a,b)});this.updatingSlider=!0;this.slider.setValue(b);this.updatingSlider=
!1};d={title:getText("Simulation Results %s",analysisCount),analysisCount:analysisCount,scratchPadStatus:{},closable:!0,displays:d,tabs:e,renderTo:"ribbonPanel",constrain:!0,maximized:viewConfig.fullScreenResults,expandedState:!0,displayInformation:a,minWidth:350,minHeight:300,width:Math.min(Ext.getBody().getViewSize().width,640),height:Math.min(Ext.getBody().getViewSize().height,viewConfig.showResultsEdit?550:540),resizable:!0,maximizable:!0,minimizable:!0,simulate:simulate,layout:{type:"vbox",align:"stretch"},
items:[e,{xtype:"container",layout:{type:"hbox",align:"middle"},margin:"5 10 10 10",items:[f.playBut,f.slider,f.combo,f.stopBut]}],dockedItems:[{xtype:"toolbar",enableOverflow:!0,dock:"top",hidden:!viewConfig.showResultsEdit,items:[{glyph:61525,scale:"large",text:getText("Add Display"),iconCls:"green-icon",handler:function(){var a=graph.getDefaultParent(),b=this.findParentByType("window");graph.getModel().beginUpdate();a=graph.insertVertex(a,null,primitiveBank.display.cloneNode(!0),10,10,64,64,"display");
a.visible=!1;setName(a,"New Display");graph.getModel().endUpdate();b.displays.push(a);b.tabs.add({title:a.getAttribute("name"),items:[renderDisplay(a,b.displayInformation)],layout:"fit",display:a});b.tabs.setActiveTab(primitives("Display").length-1);openDisplayConfigure(b);c()}},{scale:"large",glyph:61460,iconCls:"red-icon",tooltip:getText("Delete Display"),itemId:"delete",handler:function(){var a=this.findParentByType("window");0<a.displays.length?Ext.MessageBox.confirm("Delete Display","Are you sure you want to delete the display? This cannot be undone.",
function(b){if("yes"===b){b=a.tabs;var d=b.items.indexOf(b.getActiveTab());graph.getModel().beginUpdate();graph.removeCells([a.displays[d]],!1);graph.getModel().endUpdate();a.displays.splice(d,1);b.remove(b.getActiveTab());c()}}):mxUtils.alert(getText("No chart or table to delete."),"error",!0)}},"-",{scale:"large",glyph:61751,text:"",tooltip:getText("Move display to the left."),itemId:"left",handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,c=b.items.indexOf(b.getActiveTab()),
d=a.displays[c];graph.orderCells(!0,[d]);var e=b.getActiveTab();a.displays.splice(c,1);a.displays=[d].concat(a.displays);b.remove(e,!1);b.insert(0,e);b.setActiveTab(e)}else mxUtils.alert(getText("No chart or table to reorder."),"error",!0)}},{scale:"large",glyph:61752,text:"",tooltip:getText("Move display to the right."),itemId:"right",handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,c=b.items.indexOf(b.getActiveTab()),d=a.displays[c];graph.orderCells(!1,
[d]);a.displays.splice(c,1);a.displays.push(d);a=b.getActiveTab();b.remove(a,!1);b.add(a);b.setActiveTab(a)}else mxUtils.alert(getText("No chart or table to reorder."),"error",!0)}},"->",{scale:"large",glyph:61504,text:getText(""),tooltip:getText("Scratchpad"),itemId:"scratchpad",handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,b=b.items.indexOf(b.getActiveTab()),b=a.displays[b];if("Tabular"!=b.getAttribute("Type")){b="scratchpad"+a.analysisCount+"_"+b.id;
"shown"==a.scratchPadStatus[b]?(Ext.get(b).setDisplayed("none"),a.scratchPadStatus[b]="hidden"):"hidden"==a.scratchPadStatus[b]?(Ext.get(b).setDisplayed("block"),a.scratchPadStatus[b]="shown"):Ext.get(b)?(Ext.get(b).setDisplayed("block"),Scratchpad($("#"+b)),a.scratchPadStatus[b]="shown"):mxUtils.alert(getText("Scratchpads can only be shown for charts with data."),"error",!0);return}}mxUtils.alert(getText("Scratchpads can only be shown for charts."),"error",!0)}},{scale:"large",glyph:61573,text:getText("Configure"),
itemId:"configure",handler:function(){var a=this.findParentByType("window");0<a.displays.length?openDisplayConfigure(a):mxUtils.alert(getText("Add a chart or table to configure it."),"notice",!0)}}]}]};is_ebook&&(d.maximizable=!1,d.closable=!1,d.resizable=!1,d.minimizable=!1);d.stateful=is_editor&&!is_embed;d.stateId="results_window";d.tools=[{type:"pin",tooltip:getText("Link Results to Model"),pinned:!1,itemId:"pinTool",callback:function(a,b,c){if(b.pinned)b.pinned=!1,b.setStyle("opacity",0.4),linkedResults=
void 0;else{b.pinned=!0;b.setStyle("opacity",1);linkedResults=l;Ext.WindowMgr.each(function(a){l!=a&&(a=a.down("#pinTool"))&&a.pinned&&(a.pinned=!1,a.setStyle("opacity",0.4))});for(var d in l.sliders)a=evaluateTree(trimTree(l.sliders[d][0].dna.value),varBank).value,setValue(findID(d),a);selectionChanged(!0)}},style:{opacity:0.4}},{type:"gear",tooltip:"Edit Tite",handler:function(){Ext.Msg.prompt("Edit Results Title","Enter the title for these simulation results:",function(a,b){"ok"==a&&l.setTitle(b)},
this,!1,l.getTitle())}}];var l=new Ext.Window(d);l.on("minimize",function(a){a.expandedState?(a.expandedState=!1,a.collapse()):(a.expandedState=!0,l.expand())});c();l.enableTabs=c;l.on("close",function(a){linkedResults==l&&(linkedResults=void 0);f.simulator.completed()||f.simulator.terminate();clearInterval(f.animInter)});l.scripter=f;l.show();return l}
function buildMapStore(a,b){function c(){for(var b={agentIndex:p+1,states:q},c=0;c<a.bases.length;c++)b[a.bases[c]+"x"]=l,b[a.bases[c]+"y"]=m;return b}for(var d=[],e={},f={},g=0;g<a.agents.length;g++)for(var k=a.agents[g],l=-parseFloat(simpleNum(k.data.width,k.data.units)),m=-parseFloat(simpleNum(k.data.height,k.data.units)),n=a.agents[g].results[b].current,p=0;p<n.length;p++){f[n[p].instanceId]=n[p].location;e[n[p].instanceId]=n[p].connected;var q=null!==n[p].state?n[p].state.map(function(a){return a.dna.name}).join(", "):
"",u=c(),v="series_"+k.id+"__";u[v+"x"]=n[p].location.items[0];u[v+"y"]=n[p].location.items[1];d.push(u);if(null!==n[p].state)for(var y=0;y<n[p].state.length;y++)u=c(),v="series_"+k.id+"_"+n[p].state[y].id+"_",u[v+"x"]=n[p].location.items[0],u[v+"y"]=n[p].location.items[1],d.push(u)}k={};n=Object.keys(e);for(p=0;p<n.length;p++)for(u=n[p],g=0;g<e[u].length;g++)v=[u,e[u][g]].sort().join("__"),k[v]||(k[v]=[f[u],f[e[u][g]]]);a.chart.links=k;a.store.loadData(d)}
function buildHistogramStore(a,b){a.store.loadData(createHistogramData(a.data[b],a.min,a.max))}
function createHistogramChart(a,b){var c=new Ext.data.JsonStore({fields:[{name:"Label",type:"string"},{name:"Count",type:"float"}],data:[]}),d={store:c,data:a.res[a.ids[b]].results},e=d.data;try{d.min=Math.floor(0+functionBank.min(e).value),d.max=Math.ceil(0+functionBank.max(e).value)}catch(f){d.min=-1,d.max=1}isNaN(d.min)&&(d.min=-1,d.max=1);d.min==d.max&&(d.min-=1,d.max+=1);c=Ext.create("Ext.chart.CartesianChart",{xtype:"chart",flex:1,animation:!1,interactions:["crosszoom"],shadow:!1,store:c,axes:[{type:"category",
position:"bottom",fields:["Label"],title:a.headers[b]},{type:"numeric",position:"left",fields:"Count",titleMargin:20,decimals:0,minimum:0}],series:[{type:"bar",xField:"Label",yField:"Count",titleMargin:16,gutter:5,tooltip:{trackMouse:!0,width:80,renderer:function(a,b){this.setTitle("<center>"+commaStr(b.value[1])+"</center>")}}}]});buildHistogramStore(d,a.scripter.time);a.histograms.push(d);return c}
function createHistogramData(a,b,c){var d=[];c=(c-b)/20;for(var e=0;20>e;e++)d.push({Label:round(b+c/2+c*e,9),Count:0});for(e=0;e<a.items.length;e++){var f=0+a.items[e].value;isNaN(f)||(f=Math.max(0,Math.min(19,Math.round((f-b)/c-0.5))),d[f].Count+=1)}return d};(function(a,b){function c(a){var b=Ha[a]={};return r.each(a.split(za),function(a,c){b[c]=!0}),b}function d(a,c,d){if(d===b&&1===a.nodeType)if(d="data-"+c.replace(ea,"-$1").toLowerCase(),d=a.getAttribute(d),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:ua.test(d)?r.parseJSON(d):d}catch(e){}r.data(a,c,d)}else d=b;return d}function e(a){for(var b in a)if(("data"!==b||!r.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function f(){return!1}function g(){return!0}
function k(a){return!a||!a.parentNode||11===a.parentNode.nodeType}function l(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function m(a,b,c){b=b||0;if(r.isFunction(b))return r.grep(a,function(a,d){return!!b.call(a,d,a)===c});if(b.nodeType)return r.grep(a,function(a,d){return a===b===c});if("string"==typeof b){var d=r.grep(a,function(a){return 1===a.nodeType});if(Cb.test(b))return r.filter(b,d,!c);b=r.filter(b,d)}return r.grep(a,function(a,d){return 0<=r.inArray(a,b)===c})}function n(a){var b=Ta.split("|");
a=a.createDocumentFragment();if(a.createElement)for(;b.length;)a.createElement(b.pop());return a}function p(a,b){if(1===b.nodeType&&r.hasData(a)){var c,d,e;d=r._data(a);var f=r._data(b,d),g=d.events;if(g)for(c in delete f.handle,f.events={},g)for(d=0,e=g[c].length;d<e;d++)r.event.add(b,c,g[c][d]);f.data&&(f.data=r.extend({},f.data))}}function q(a,b){var c;1===b.nodeType&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),"object"===c?(b.parentNode&&
(b.outerHTML=a.outerHTML),r.support.html5Clone&&a.innerHTML&&!r.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&ma.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.selected=a.defaultSelected:"input"===c||"textarea"===c?b.defaultValue=a.defaultValue:"script"===c&&b.text!==a.text&&(b.text=a.text),b.removeAttribute(r.expando))}function u(a){return"undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName("*"):"undefined"!=typeof a.querySelectorAll?
a.querySelectorAll("*"):[]}function v(a){ma.test(a.type)&&(a.defaultChecked=a.checked)}function y(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=aa.length;e--;)if(b=aa[e]+c,b in a)return b;return d}function z(a,b){return a=b||a,"none"===r.css(a,"display")||!r.contains(a.ownerDocument,a)}function x(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)c=a[f],c.style&&(e[f]=r._data(c,"olddisplay"),b?(!e[f]&&"none"===c.style.display&&(c.style.display=""),""===c.style.display&&z(c)&&
(e[f]=r._data(c,"olddisplay",E(c.nodeName)))):(d=ga(c,"display"),!e[f]&&"none"!==d&&r._data(c,"olddisplay",d)));for(f=0;f<g;f++)c=a[f],!c.style||b&&"none"!==c.style.display&&""!==c.style.display||(c.style.display=b?e[f]||"":"none");return a}function B(a,b,c){return(a=Ua.exec(b))?Math.max(0,a[1]-(c||0))+(a[2]||"px"):b}function A(a,b,c,d){b=c===(d?"border":"content")?4:"width"===b?1:0;for(var e=0;4>b;b+=2)"margin"===c&&(e+=r.css(a,c+xa[b],!0)),d?("content"===c&&(e-=parseFloat(ga(a,"padding"+xa[b]))||
0),"margin"!==c&&(e-=parseFloat(ga(a,"border"+xa[b]+"Width"))||0)):(e+=parseFloat(ga(a,"padding"+xa[b]))||0,"padding"!==c&&(e+=parseFloat(ga(a,"border"+xa[b]+"Width"))||0));return e}function D(a,b,c){var d="width"===b?a.offsetWidth:a.offsetHeight,e=!0,f=r.support.boxSizing&&"border-box"===r.css(a,"boxSizing");if(0>=d){d=ga(a,b);if(0>d||null==d)d=a.style[b];if(ra.test(d))return d;e=f&&(r.support.boxSizingReliable||d===a.style[b]);d=parseFloat(d)||0}return d+A(a,b,c||(f?"border":"content"),e)+"px"}
function E(a){if(ta[a])return ta[a];var b=r("<"+a+">").appendTo(L.body),c=b.css("display");b.remove();if("none"===c||""===c)K=L.body.appendChild(K||r.extend(L.createElement("iframe"),{frameBorder:0,width:0,height:0})),X&&K.createElement||(X=(K.contentWindow||K.contentDocument).document,X.write("<!doctype html><html><body>"),X.close()),b=X.body.appendChild(X.createElement(a)),c=ga(b,"display"),L.body.removeChild(K);return ta[a]=c,c}function G(a,b,c,d){var e;if(r.isArray(b))r.each(b,function(b,e){c||
Jb.test(a)?d(a,e):G(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==r.type(b))d(a,b);else for(e in b)G(a+"["+e+"]",b[e],c,d)}function C(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e,f=b.toLowerCase().split(za),g=0,k=f.length;if(r.isFunction(c))for(;g<k;g++)d=f[g],(e=/^\+/.test(d))&&(d=d.substr(1)||"*"),d=a[d]=a[d]||[],d[e?"unshift":"push"](c)}}function F(a,c,d,e,f,g){f=f||c.dataTypes[0];g=g||{};g[f]=!0;var k;f=a[f];for(var l=0,m=f?f.length:0,n=a===Db;l<m&&(n||
!k);l++)k=f[l](c,d,e),"string"==typeof k&&(!n||g[k]?k=b:(c.dataTypes.unshift(k),k=F(a,c,d,e,k,g)));return(n||!k)&&!g["*"]&&(k=F(a,c,d,e,"*",g)),k}function I(a,c){var d,e,f=r.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&r.extend(!0,a,e)}function H(){try{return new a.XMLHttpRequest}catch(b){}}function P(){return setTimeout(function(){nb=b},0),nb=r.now()}function J(a,b){r.each(b,function(b,c){for(var d=(Ya[b]||[]).concat(Ya["*"]),e=0,f=d.length;e<f&&!d[e].call(a,
b,c);e++);})}function O(a,b,c){var d=0,e=ob.length,f=r.Deferred().always(function(){delete g.elem}),g=function(){for(var b=nb||P(),b=Math.max(0,k.startTime+k.duration-b),c=1-(b/k.duration||0),d=0,e=k.tweens.length;d<e;d++)k.tweens[d].run(c);return f.notifyWith(a,[k,c,b]),1>c&&e?b:(f.resolveWith(a,[k]),!1)},k=f.promise({elem:a,props:r.extend({},b),opts:r.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:nb||P(),duration:c.duration,tweens:[],createTween:function(b,c,d){b=
r.Tween(a,k.opts,b,c,k.opts.specialEasing[b]||k.opts.easing);return k.tweens.push(b),b},stop:function(b){for(var c=0,d=b?k.tweens.length:0;c<d;c++)k.tweens[c].run(1);return b?f.resolveWith(a,[k,b]):f.rejectWith(a,[k,b]),this}});c=k.props;for(Q(c,k.opts.specialEasing);d<e;d++)if(b=ob[d].call(k,a,c,k.opts))return b;return J(k,c),r.isFunction(k.opts.start)&&k.opts.start.call(a,k),r.fx.timer(r.extend(g,{anim:k,queue:k.opts.queue,elem:a})),k.progress(k.opts.progress).done(k.opts.done,k.opts.complete).fail(k.opts.fail).always(k.opts.always)}
function Q(a,b){var c,d,e,f,g;for(c in a)if(d=r.camelCase(c),e=b[d],f=a[c],r.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),(g=r.cssHooks[d])&&"expand"in g)for(c in f=g.expand(f),delete a[d],f)c in a||(a[c]=f[c],b[c]=e);else b[d]=e}function N(a,b,c,d,e){return new N.prototype.init(a,b,c,d,e)}function M(a,b){for(var c,d={height:a},e=0;4>e;e+=2-b)c=xa[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function R(a){return r.isWindow(a)?a:9===a.nodeType?a.defaultView||
a.parentWindow:!1}var U,S,L=a.document,pa=a.location,sa=a.navigator,ia=a.jQuery,oa=a.$,Z=Array.prototype.push,fa=Array.prototype.slice,ja=Array.prototype.indexOf,Ca=Object.prototype.toString,Ma=Object.prototype.hasOwnProperty,Ra=String.prototype.trim,r=function(a,b){return new r.fn.init(a,b,U)},Sa=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,jb=/\S/,za=/\s+/,kb=jb.test("\u00c2 ")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g,Na=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,lb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,
Bb=/^[\],:{}\s]*$/,Ab=/(?:^|:|,)(?:\s*\[)+/g,Aa=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,V=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,wa=/^-ms-/,Ga=/-([\da-z])/gi,W=function(a,b){return(b+"").toUpperCase()},da=function(){L.addEventListener?(L.removeEventListener("DOMContentLoaded",da,!1),r.ready()):"complete"===L.readyState&&(L.detachEvent("onreadystatechange",da),r.ready())},va={};r.fn=r.prototype={constructor:r,init:function(a,c,d){var e,f;if(!a)return this;if(a.nodeType)return this.context=
this[0]=a,this.length=1,this;if("string"==typeof a){"<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&3<=a.length?e=[null,a,null]:e=Na.exec(a);if(e&&(e[1]||!c)){if(e[1])return c=c instanceof r?c[0]:c,f=c&&c.nodeType?c.ownerDocument||c:L,a=r.parseHTML(e[1],f,!0),lb.test(e[1])&&r.isPlainObject(c)&&this.attr.call(a,c,!0),r.merge(this,a);if((c=L.getElementById(e[2]))&&c.parentNode){if(c.id!==e[2])return d.find(a);this.length=1;this[0]=c}return this.context=L,this.selector=a,this}return!c||c.jquery?(c||d).find(a):
this.constructor(c).find(a)}return r.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),r.makeArray(a,this))},selector:"",jquery:"1.8.0",length:0,size:function(){return this.length},toArray:function(){return fa.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a,b,c){a=r.merge(this.constructor(),a);return a.prevObject=this,a.context=this.context,"find"===b?a.selector=this.selector+(this.selector?" ":
"")+c:b&&(a.selector=this.selector+"."+b+"("+c+")"),a},each:function(a,b){return r.each(this,a,b)},ready:function(a){return r.ready.promise().done(a),this},eq:function(a){return a=+a,-1===a?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(fa.apply(this,arguments),"slice",fa.call(arguments).join(","))},map:function(a){return this.pushStack(r.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||
this.constructor(null)},push:Z,sort:[].sort,splice:[].splice};r.fn.init.prototype=r.fn;r.extend=r.fn.extend=function(){var a,c,d,e,f,g,k=arguments[0]||{},l=1,m=arguments.length,n=!1;"boolean"==typeof k&&(n=k,k=arguments[1]||{},l=2);"object"!=typeof k&&!r.isFunction(k)&&(k={});for(m===l&&(k=this,--l);l<m;l++)if(null!=(a=arguments[l]))for(c in a)d=k[c],e=a[c],k!==e&&(n&&e&&(r.isPlainObject(e)||(f=r.isArray(e)))?(f?(f=!1,g=d&&r.isArray(d)?d:[]):g=d&&r.isPlainObject(d)?d:{},k[c]=r.extend(n,g,e)):e!==
b&&(k[c]=e));return k};r.extend({noConflict:function(b){return a.$===r&&(a.$=oa),b&&a.jQuery===r&&(a.jQuery=ia),r},isReady:!1,readyWait:1,holdReady:function(a){a?r.readyWait++:r.ready(!0)},ready:function(a){if(!0===a?!--r.readyWait:!r.isReady){if(!L.body)return setTimeout(r.ready,1);r.isReady=!0;!0!==a&&0<--r.readyWait||(S.resolveWith(L,[r]),r.fn.trigger&&r(L).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===r.type(a)},isArray:Array.isArray||function(a){return"array"===r.type(a)},
isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):va[Ca.call(a)]||"object"},isPlainObject:function(a){if(!a||"object"!==r.type(a)||a.nodeType||r.isWindow(a))return!1;try{if(a.constructor&&!Ma.call(a,"constructor")&&!Ma.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}for(var d in a);return d===b||Ma.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},
error:function(a){throw Error(a);},parseHTML:function(a,b,c){var d;return a&&"string"==typeof a?("boolean"==typeof b&&(c=b,b=0),b=b||L,(d=lb.exec(a))?[b.createElement(d[1])]:(d=r.buildFragment([a],b,c?null:[]),r.merge([],(d.cacheable?r.clone(d.fragment):d.fragment).childNodes))):null},parseJSON:function(b){if(!b||"string"!=typeof b)return null;b=r.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(Bb.test(b.replace(Aa,"@").replace(V,"]").replace(Ab,"")))return(new Function("return "+b))();
r.error("Invalid JSON: "+b)},parseXML:function(c){var d,e;if(!c||"string"!=typeof c)return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&r.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&jb.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(wa,
"ms-").replace(Ga,W)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var e,f=0,g=a.length,k=g===b||r.isFunction(a);if(d)if(k)for(e in a){if(!1===c.apply(a[e],d))break}else for(;f<g&&!1!==c.apply(a[f++],d););else if(k)for(e in a){if(!1===c.call(a[e],e,a[e]))break}else for(;f<g&&!1!==c.call(a[f],f,a[f++]););return a},trim:Ra?function(a){return null==a?"":Ra.call(a)}:function(a){return null==a?"":a.toString().replace(kb,"")},makeArray:function(a,
b){var c,d=b||[];return null!=a&&(c=r.type(a),null==a.length||"string"===c||"function"===c||"regexp"===c||r.isWindow(a)?Z.call(d,a):r.merge(d,a)),d},inArray:function(a,b,c){var d;if(b){if(ja)return ja.call(b,a,c);d=b.length;for(c=c?0>c?Math.max(0,d+c):c:0;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;f<d;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;
for(c=!!c;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,c,d){var e,f,g=[],k=0,l=a.length;if(a instanceof r||l!==b&&"number"==typeof l&&(0<l&&a[0]&&a[l-1]||0===l||r.isArray(a)))for(;k<l;k++)e=c(a[k],k,d),null!=e&&(g[g.length]=e);else for(f in a)e=c(a[f],f,d),null!=e&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(d=a[c],c=a,a=d),r.isFunction(a)?(e=fa.call(arguments,2),f=function(){return a.apply(c,e.concat(fa.call(arguments)))},
f.guid=a.guid=a.guid||f.guid||r.guid++,f):b},access:function(a,c,d,e,f,g,k){var l,m=null==d,n=0,p=a.length;if(d&&"object"==typeof d){for(n in d)r.access(a,c,n,d[n],1,g,e);f=1}else if(e!==b){l=k===b&&r.isFunction(e);m&&(l?(l=c,c=function(a,b,c){return l.call(r(a),c)}):(c.call(a,e),c=null));if(c)for(;n<p;n++)c(a[n],d,l?e.call(a[n],n,c(a[n],d)):e,k);f=1}return f?a:m?c.call(a):p?c(a[0],d):g},now:function(){return(new Date).getTime()}});r.ready.promise=function(b){if(!S)if(S=r.Deferred(),"complete"===
L.readyState||"loading"!==L.readyState&&L.addEventListener)setTimeout(r.ready,1);else if(L.addEventListener)L.addEventListener("DOMContentLoaded",da,!1),a.addEventListener("load",r.ready,!1);else{L.attachEvent("onreadystatechange",da);a.attachEvent("onload",r.ready);var c=!1;try{c=null==a.frameElement&&L.documentElement}catch(d){}c&&c.doScroll&&function Rb(){if(!r.isReady){try{c.doScroll("left")}catch(a){return setTimeout(Rb,50)}r.ready()}}()}return S.promise(b)};r.each("Boolean Number String Function Array Date RegExp Object".split(" "),
function(a,b){va["[object "+b+"]"]=b.toLowerCase()});U=r(L);var Ha={};r.Callbacks=function(a){a="string"==typeof a?Ha[a]||c(a):r.extend({},a);var d,e,f,g,k,l,m=[],n=!a.once&&[],p=function(b){d=a.memory&&b;e=!0;l=g||0;g=0;k=m.length;for(f=!0;m&&l<k;l++)if(!1===m[l].apply(b[0],b[1])&&a.stopOnFalse){d=!1;break}f=!1;m&&(n?n.length&&p(n.shift()):d?m=[]:q.disable())},q={add:function(){if(m){var b=m.length;(function Sb(b){r.each(b,function(b,c){!r.isFunction(c)||a.unique&&q.has(c)?c&&c.length&&Sb(c):m.push(c)})})(arguments);
f?k=m.length:d&&(g=b,p(d))}return this},remove:function(){return m&&r.each(arguments,function(a,b){for(var c;-1<(c=r.inArray(b,m,c));)m.splice(c,1),f&&(c<=k&&k--,c<=l&&l--)}),this},has:function(a){return-1<r.inArray(a,m)},empty:function(){return m=[],this},disable:function(){return m=n=d=b,this},disabled:function(){return!m},lock:function(){return n=b,d||q.disable(),this},locked:function(){return!n},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],m&&(!e||n)&&(f?n.push(b):p(b)),this},
fire:function(){return q.fireWith(this,arguments),this},fired:function(){return!!e}};return q};r.extend({Deferred:function(a){var b=[["resolve","done",r.Callbacks("once memory"),"resolved"],["reject","fail",r.Callbacks("once memory"),"rejected"],["notify","progress",r.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return r.Deferred(function(c){r.each(b,function(b,d){var f=d[0],g=a[b];
e[d[1]](r.isFunction(g)?function(){var a=g.apply(this,arguments);a&&r.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])});a=null}).promise()},promise:function(a){return"object"==typeof a?r.extend(a,d):d}},e={};return d.pipe=d.then,r.each(b,function(a,f){var g=f[2],k=f[3];d[f[1]]=g.add;k&&g.add(function(){c=k},b[a^1][2].disable,b[2][2].lock);e[f[0]]=g.fire;e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=
0,c=fa.call(arguments),d=c.length,e=1!==d||a&&r.isFunction(a.promise)?d:0,f=1===e?a:r.Deferred(),g=function(a,b,c){return function(d){b[a]=this;c[a]=1<arguments.length?fa.call(arguments):d;c===k?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},k,l,m;if(1<d)for(k=Array(d),l=Array(d),m=Array(d);b<d;b++)c[b]&&r.isFunction(c[b].promise)?c[b].promise().done(g(b,m,c)).fail(f.reject).progress(g(b,l,k)):--e;return e||f.resolveWith(m,c),f.promise()}});r.support=function(){var b,c,d,e,f,g,k,l,m=L.createElement("div");
m.setAttribute("className","t");m.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";c=m.getElementsByTagName("*");d=m.getElementsByTagName("a")[0];d.style.cssText="top:1px;float:left;opacity:.5";if(!c||!c.length||!d)return{};e=L.createElement("select");f=e.appendChild(L.createElement("option"));c=m.getElementsByTagName("input")[0];b={leadingWhitespace:3===m.firstChild.nodeType,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,
style:/top/.test(d.getAttribute("style")),hrefNormalized:"/a"===d.getAttribute("href"),opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:"on"===c.value,optSelected:f.selected,getSetAttribute:"t"!==m.className,enctype:!!L.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==L.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===L.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,
reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1};c.checked=!0;b.noCloneChecked=c.cloneNode(!0).checked;e.disabled=!0;b.optDisabled=!f.disabled;try{delete m.test}catch(n){b.deleteExpando=!1}!m.addEventListener&&m.attachEvent&&m.fireEvent&&(m.attachEvent("onclick",l=function(){b.noCloneEvent=!1}),m.cloneNode(!0).fireEvent("onclick"),m.detachEvent("onclick",l));c=L.createElement("input");c.value="t";c.setAttribute("type","radio");b.radioValue="t"===c.value;c.setAttribute("checked","checked");
c.setAttribute("name","t");m.appendChild(c);d=L.createDocumentFragment();d.appendChild(m.lastChild);b.checkClone=d.cloneNode(!0).cloneNode(!0).lastChild.checked;b.appendChecked=c.checked;d.removeChild(c);d.appendChild(m);if(m.attachEvent)for(g in{submit:!0,change:!0,focusin:!0})c="on"+g,(k=c in m)||(m.setAttribute(c,"return;"),k="function"==typeof m[c]),b[g+"Bubbles"]=k;return r(function(){var c,d,e,f,g=L.getElementsByTagName("body")[0];g&&(c=L.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",
g.insertBefore(c,g.firstChild),d=L.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=d.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",k=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",b.reliableHiddenOffsets=k&&0===e[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",
b.boxSizing=4===d.offsetWidth,b.doesNotIncludeMarginInBodyOffset=1!==g.offsetTop,a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(d,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(d,null)||{width:"4px"}).width,f=L.createElement("div"),f.style.cssText=d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;",f.style.marginRight=f.style.width="0",d.style.width="1px",d.appendChild(f),b.reliableMarginRight=!parseFloat((a.getComputedStyle(f,null)||{}).marginRight)),
"undefined"!=typeof d.style.zoom&&(d.innerHTML="",d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==d.offsetWidth,c.style.zoom=1),g.removeChild(c))}),d.removeChild(m),c=d=e=f=c=d=m=null,b}();var ua=/^(?:\{.*\}|\[.*\])$/,ea=/([A-Z])/g;r.extend({cache:{},deletedIds:[],
uuid:0,expando:"jQuery"+(r.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?r.cache[a[r.expando]]:a[r.expando],!!a&&!e(a)},data:function(a,c,d,e){if(r.acceptData(a)){var f,g,k=r.expando,l="string"==typeof c,m=a.nodeType,n=m?r.cache:a,p=m?a[k]:a[k]&&k;if(p&&n[p]&&(e||n[p].data)||!l||d!==b){p||(m?a[k]=p=r.deletedIds.pop()||++r.uuid:p=k);n[p]||(n[p]={},m||(n[p].toJSON=r.noop));if("object"==
typeof c||"function"==typeof c)e?n[p]=r.extend(n[p],c):n[p].data=r.extend(n[p].data,c);return f=n[p],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[r.camelCase(c)]=d),l?(g=f[c],null==g&&(g=f[r.camelCase(c)])):g=f,g}}},removeData:function(a,b,c){if(r.acceptData(a)){var d,f,g,k=a.nodeType,l=k?r.cache:a,m=k?a[r.expando]:r.expando;if(l[m]){if(b&&(d=c?l[m]:l[m].data)){r.isArray(b)||(b in d?b=[b]:(b=r.camelCase(b),b in d?b=[b]:b=b.split(" ")));f=0;for(g=b.length;f<g;f++)delete d[b[f]];if(!(c?e:r.isEmptyObject)(d))return}if(!c&&
(delete l[m].data,!e(l[m])))return;k?r.cleanData([a],!0):r.support.deleteExpando||l!=l.window?delete l[m]:l[m]=null}}},_data:function(a,b,c){return r.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&r.noData[a.nodeName.toLowerCase()];return!b||!0!==b&&a.getAttribute("classid")===b}});r.fn.extend({data:function(a,c){var e,f,g,k,l,m=this[0],n=0,p=null;if(a===b){if(this.length&&(p=r.data(m),1===m.nodeType&&!r._data(m,"parsedAttrs"))){g=m.attributes;for(l=g.length;n<l;n++)k=g[n].name,0===k.indexOf("data-")&&
(k=r.camelCase(k.substring(5)),d(m,k,p[k]));r._data(m,"parsedAttrs",!0)}return p}return"object"==typeof a?this.each(function(){r.data(this,a)}):(e=a.split(".",2),e[1]=e[1]?"."+e[1]:"",f=e[1]+"!",r.access(this,function(c){if(c===b)return p=this.triggerHandler("getData"+f,[e[0]]),p===b&&m&&(p=r.data(m,a),p=d(m,a,p)),p===b&&e[1]?this.data(e[0]):p;e[1]=c;this.each(function(){var b=r(this);b.triggerHandler("setData"+f,e);r.data(this,a,c);b.triggerHandler("changeData"+f,e)})},null,c,1<arguments.length,
null,!1))},removeData:function(a){return this.each(function(){r.removeData(this,a)})}});r.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=r._data(a,b),c&&(!d||r.isArray(c)?d=r._data(a,b,r.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=r.queue(a,b),d=c.shift(),e=r._queueHooks(a,b),f=function(){r.dequeue(a,b)};"inprogress"===d&&(d=c.shift());d&&("fx"===b&&c.unshift("inprogress"),delete e.stop,d.call(a,f,e));!c.length&&e&&e.empty.fire()},_queueHooks:function(a,
b){var c=b+"queueHooks";return r._data(a,c)||r._data(a,c,{empty:r.Callbacks("once memory").add(function(){r.removeData(a,b+"queue",!0);r.removeData(a,c,!0)})})}});r.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?r.queue(this[0],a):c===b?this:this.each(function(){var b=r.queue(this,a,c);r._queueHooks(this,a);"fx"===a&&"inprogress"!==b[0]&&r.dequeue(this,a)})},dequeue:function(a){return this.each(function(){r.dequeue(this,a)})},delay:function(a,
b){return a=r.fx?r.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=r.Deferred(),g=this,k=this.length,l=function(){--e||f.resolveWith(g,[g])};"string"!=typeof a&&(c=a,a=b);for(a=a||"fx";k--;)(d=r._data(g[k],a+"queueHooks"))&&d.empty&&(e++,d.empty.add(l));return l(),f.promise(c)}});var la,Ea,Fa,Da=/[\t\r\n]/g,xb=/\r/g,eb=/^(?:button|input)$/i,fb=
/^(?:button|input|object|select|textarea)$/i,gb=/^a(?:rea|)$/i,Ja=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,hb=r.support.getSetAttribute;r.fn.extend({attr:function(a,b){return r.access(this,r.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){r.removeAttr(this,a)})},prop:function(a,b){return r.access(this,r.prop,a,b,1<arguments.length)},removeProp:function(a){return a=r.propFix[a]||a,
this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,k;if(r.isFunction(a))return this.each(function(b){r(this).addClass(a.call(this,b,this.className))});if(a&&"string"==typeof a)for(b=a.split(za),c=0,d=this.length;c<d;c++)if(e=this[c],1===e.nodeType)if(e.className||1!==b.length){f=" "+e.className+" ";g=0;for(k=b.length;g<k;g++)~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ");e.className=r.trim(f)}else e.className=a;return this},removeClass:function(a){var c,
d,e,f,g,k,l;if(r.isFunction(a))return this.each(function(b){r(this).removeClass(a.call(this,b,this.className))});if(a&&"string"==typeof a||a===b)for(c=(a||"").split(za),k=0,l=this.length;k<l;k++)if(e=this[k],1===e.nodeType&&e.className){d=(" "+e.className+" ").replace(Da," ");f=0;for(g=c.length;f<g;f++)for(;-1<d.indexOf(" "+c[f]+" ");)d=d.replace(" "+c[f]+" "," ");e.className=a?r.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return r.isFunction(a)?this.each(function(c){r(this).toggleClass(a.call(this,
c,this.className,b),b)}):this.each(function(){if("string"===c)for(var e,f=0,g=r(this),k=b,l=a.split(za);e=l[f++];)k=d?k:!g.hasClass(e),g[k?"addClass":"removeClass"](e);else if("undefined"===c||"boolean"===c)this.className&&r._data(this,"__className__",this.className),this.className=this.className||!1===a?"":r._data(this,"__className__")||""})},hasClass:function(a){a=" "+a+" ";for(var b=0,c=this.length;b<c;b++)if(1===this[b].nodeType&&-1<(" "+this[b].className+" ").replace(Da," ").indexOf(a))return!0;
return!1},val:function(a){var c,d,e,f=this[0];if(arguments.length)return e=r.isFunction(a),this.each(function(d){var f,g=r(this);1===this.nodeType&&(e?f=a.call(this,d,g.val()):f=a,null==f?f="":"number"==typeof f?f+="":r.isArray(f)&&(f=r.map(f,function(a){return null==a?"":a+""})),c=r.valHooks[this.type]||r.valHooks[this.nodeName.toLowerCase()],c&&"set"in c&&c.set(this,f,"value")!==b||(this.value=f))});if(f)return c=r.valHooks[f.type]||r.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,
"value"))!==b?d:(d=f.value,"string"==typeof d?d.replace(xb,""):null==d?"":d)}});r.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d=a.selectedIndex,e=[],f=a.options,g="select-one"===a.type;if(0>d)return null;a=g?d:0;for(c=g?d+1:f.length;a<c;a++)if(b=f[a],b.selected&&!((r.support.optDisabled?b.disabled:null!==b.getAttribute("disabled"))||b.parentNode.disabled&&r.nodeName(b.parentNode,"optgroup"))){b=r(b).val();
if(g)return b;e.push(b)}return g&&!e.length&&f.length?r(f[d]).val():e},set:function(a,b){var c=r.makeArray(b);return r(a).find("option").each(function(){this.selected=0<=r.inArray(r(this).val(),c)}),c.length||(a.selectedIndex=-1),c}}},attrFn:{},attr:function(a,c,d,e){var f,g,k=a.nodeType;if(a&&3!==k&&8!==k&&2!==k){if(e&&r.isFunction(r.fn[c]))return r(a)[c](d);if("undefined"==typeof a.getAttribute)return r.prop(a,c,d);(e=1!==k||!r.isXMLDoc(a))&&(c=c.toLowerCase(),g=r.attrHooks[c]||(Ja.test(c)?Ea:la));
if(d!==b){if(null===d){r.removeAttr(a,c);return}return g&&"set"in g&&e&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,""+d),d)}return g&&"get"in g&&e&&null!==(f=g.get(a,c))?f:(f=a.getAttribute(c),null===f?b:f)}},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&1===a.nodeType)for(d=b.split(za);g<d.length;g++)(e=d[g])&&(c=r.propFix[e]||e,f=Ja.test(e),f||r.attr(a,e,""),a.removeAttribute(hb?e:c),f&&c in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(eb.test(a.nodeName)&&a.parentNode)r.error("type property can't be changed");
else if(!r.support.radioValue&&"radio"===b&&r.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return la&&r.nodeName(a,"button")?la.get(a,b):b in a?a.value:null},set:function(a,b,c){if(la&&r.nodeName(a,"button"))return la.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",
usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,k=a.nodeType;if(a&&3!==k&&8!==k&&2!==k)return g=1!==k||!r.isXMLDoc(a),g&&(c=r.propFix[c]||c,f=r.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):fb.test(a.nodeName)||gb.test(a.nodeName)&&a.href?0:b}}}});Ea={get:function(a,
c){var d,e=r.prop(a,c);return!0===e||"boolean"!=typeof e&&(d=a.getAttributeNode(c))&&!1!==d.nodeValue?c.toLowerCase():b},set:function(a,b,c){var d;return!1===b?r.removeAttr(a,c):(d=r.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}};hb||(Fa={name:!0,id:!0,coords:!0},la=r.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(Fa[c]?""!==d.value:d.specified)?d.value:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=L.createAttribute(c),a.setAttributeNode(d)),
d.value=b+""}},r.each(["width","height"],function(a,b){r.attrHooks[b]=r.extend(r.attrHooks[b],{set:function(a,c){if(""===c)return a.setAttribute(b,"auto"),c}})}),r.attrHooks.contenteditable={get:la.get,set:function(a,b,c){""===b&&(b="false");la.set(a,b,c)}});r.support.hrefNormalized||r.each(["href","src","width","height"],function(a,c){r.attrHooks[c]=r.extend(r.attrHooks[c],{get:function(a){a=a.getAttribute(c,2);return null===a?b:a}})});r.support.style||(r.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||
b},set:function(a,b){return a.style.cssText=""+b}});r.support.optSelected||(r.propHooks.selected=r.extend(r.propHooks.selected,{get:function(a){a=a.parentNode;return a&&(a.selectedIndex,a.parentNode&&a.parentNode.selectedIndex),null}}));r.support.enctype||(r.propFix.enctype="encoding");r.support.checkOn||r.each(["radio","checkbox"],function(){r.valHooks[this]={get:function(a){return null===a.getAttribute("value")?"on":a.value}}});r.each(["radio","checkbox"],function(){r.valHooks[this]=r.extend(r.valHooks[this],
{set:function(a,b){if(r.isArray(b))return a.checked=0<=r.inArray(r(a).val(),b)}})});var ya=/^(?:textarea|input|select)$/i,Ka=/^([^\.]*|)(?:\.(.+)|)$/,yb=/(?:^|\s)hover(\.\S+|)\b/,ib=/^key/,zb=/^(?:mouse|contextmenu)|click/,La=/^(?:focusinfocus|focusoutblur)$/,mb=function(a){return r.event.special.hover?a:a.replace(yb,"mouseenter$1 mouseleave$1")};r.event={add:function(a,c,d,e,f){var g,k,l,m,n,p,q,K,u;if(3!==a.nodeType&&8!==a.nodeType&&c&&d&&(g=r._data(a))){d.handler&&(q=d,d=q.handler,f=q.selector);
d.guid||(d.guid=r.guid++);(l=g.events)||(g.events=l={});(k=g.handle)||(g.handle=k=function(a){return"undefined"==typeof r||a&&r.event.triggered===a.type?b:r.event.dispatch.apply(k.elem,arguments)},k.elem=a);c=r.trim(mb(c)).split(" ");for(g=0;g<c.length;g++)m=Ka.exec(c[g])||[],n=m[1],p=(m[2]||"").split(".").sort(),u=r.event.special[n]||{},n=(f?u.delegateType:u.bindType)||n,u=r.event.special[n]||{},m=r.extend({type:n,origType:m[1],data:e,handler:d,guid:d.guid,selector:f,namespace:p.join(".")},q),K=
l[n],K||(K=l[n]=[],K.delegateCount=0,u.setup&&!1!==u.setup.call(a,e,p,k)||(a.addEventListener?a.addEventListener(n,k,!1):a.attachEvent&&a.attachEvent("on"+n,k))),u.add&&(u.add.call(a,m),m.handler.guid||(m.handler.guid=d.guid)),f?K.splice(K.delegateCount++,0,m):K.push(m),r.event.global[n]=!0;a=null}},global:{},remove:function(a,b,c,d,e){var f,g,k,l,m,n,p,q,K,u,F=r.hasData(a)&&r._data(a);if(F&&(p=F.events)){b=r.trim(mb(b||"")).split(" ");for(f=0;f<b.length;f++)if(g=Ka.exec(b[f])||[],k=l=g[1],g=g[2],
k){q=r.event.special[k]||{};k=(d?q.delegateType:q.bindType)||k;K=p[k]||[];m=K.length;g=g?RegExp("(^|\\.)"+g.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(n=0;n<K.length;n++)u=K[n],!e&&l!==u.origType||c&&c.guid!==u.guid||g&&!g.test(u.namespace)||d&&!(d===u.selector||"**"===d&&u.selector)||(K.splice(n--,1),u.selector&&K.delegateCount--,!q.remove||q.remove.call(a,u));0===K.length&&m!==K.length&&((!q.teardown||!1===q.teardown.call(a,g,F.handle))&&r.removeEvent(a,k,F.handle),delete p[k])}else for(k in p)r.event.remove(a,
k+b[f],c,d,!0);r.isEmptyObject(p)&&(delete F.handle,r.removeData(a,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||3!==e.nodeType&&8!==e.nodeType){var g,k,l,m,n,p,q,K=c.type||c;m=[];if(!La.test(K+r.event.triggered)&&(0<=K.indexOf("!")&&(K=K.slice(0,-1),g=!0),0<=K.indexOf(".")&&(m=K.split("."),K=m.shift(),m.sort()),e&&!r.event.customEvent[K]||r.event.global[K]))if(c="object"==typeof c?c[r.expando]?c:new r.Event(K,c):new r.Event(K),c.type=K,c.isTrigger=
!0,c.exclusive=g,c.namespace=m.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,m=0>K.indexOf(":")?"on"+K:"",e){if(c.result=b,c.target||(c.target=e),d=null!=d?r.makeArray(d):[],d.unshift(c),n=r.event.special[K]||{},!n.trigger||!1!==n.trigger.apply(e,d)){q=[[e,n.bindType||K]];if(!f&&!n.noBubble&&!r.isWindow(e)){k=n.delegateType||K;g=La.test(k+K)?e:e.parentNode;for(l=e;g;g=g.parentNode)q.push([g,k]),l=g;l===(e.ownerDocument||L)&&q.push([l.defaultView||l.parentWindow||
a,k])}for(k=0;k<q.length&&!c.isPropagationStopped();k++)g=q[k][0],c.type=q[k][1],(p=(r._data(g,"events")||{})[c.type]&&r._data(g,"handle"))&&p.apply(g,d),(p=m&&g[m])&&r.acceptData(g)&&!1===p.apply(g,d)&&c.preventDefault();return c.type=K,!f&&!c.isDefaultPrevented()&&(!n._default||!1===n._default.apply(e.ownerDocument,d))&&("click"!==K||!r.nodeName(e,"a"))&&r.acceptData(e)&&m&&e[K]&&("focus"!==K&&"blur"!==K||0!==c.target.offsetWidth)&&!r.isWindow(e)&&(l=e[m],l&&(e[m]=null),r.event.triggered=K,e[K](),
r.event.triggered=b,l&&(e[m]=l)),c.result}}else for(k in e=r.cache,e)e[k].events&&e[k].events[K]&&r.event.trigger(c,d,e[k].handle.elem,!0)}},dispatch:function(c){c=r.event.fix(c||a.event);var d,e,f,g,k,l,m,n=(r._data(this,"events")||{})[c.type]||[],p=n.delegateCount,q=[].slice.call(arguments),K=!c.exclusive&&!c.namespace,u=r.event.special[c.type]||{},F=[];q[0]=c;c.delegateTarget=this;if(!u.preDispatch||!1!==u.preDispatch.call(this,c)){if(p&&(!c.button||"click"!==c.type))for(f=r(this),f.context=this,
e=c.target;e!=this;e=e.parentNode||this)if(!0!==e.disabled||"click"!==c.type){k={};l=[];f[0]=e;for(d=0;d<p;d++)g=n[d],m=g.selector,k[m]===b&&(k[m]=f.is(m)),k[m]&&l.push(g);l.length&&F.push({elem:e,matches:l})}n.length>p&&F.push({elem:this,matches:n.slice(p)});for(d=0;d<F.length&&!c.isPropagationStopped();d++)for(f=F[d],c.currentTarget=f.elem,e=0;e<f.matches.length&&!c.isImmediatePropagationStopped();e++)if(g=f.matches[e],K||!c.namespace&&!g.namespace||c.namespace_re&&c.namespace_re.test(g.namespace))c.data=
g.data,c.handleObj=g,g=((r.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,q),g!==b&&(c.result=g,!1===g&&(c.preventDefault(),c.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,c),c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(a,b){return null==
a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button,k=c.fromElement;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||L,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||
f&&f.clientTop||0)),!a.relatedTarget&&k&&(a.relatedTarget=k===a.target?c.toElement:k),!a.which&&g!==b&&(a.which=g&1?1:g&2?3:g&4?2:0),a}},fix:function(a){if(a[r.expando])return a;var b,c,d=a,e=r.event.fixHooks[a.type]||{},f=e.props?this.props.concat(e.props):this.props;a=r.Event(d);for(b=f.length;b;)c=f[--b],a[c]=d[c];return a.target||(a.target=d.srcElement||L),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,e.filter?e.filter(a,d):a},special:{ready:{setup:r.bindReady},load:{noBubble:!0},
focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){r.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){a=r.extend(new r.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?r.event.trigger(a,null,b):r.event.dispatch.call(b,a);a.isDefaultPrevented()&&c.preventDefault()}};r.event.handle=r.event.dispatch;r.removeEvent=L.removeEventListener?function(a,b,c){a.removeEventListener&&
a.removeEventListener(b,c,!1)}:function(a,b,c){b="on"+b;a.detachEvent&&("undefined"==typeof a[b]&&(a[b]=null),a.detachEvent(b,c))};r.Event=function(a,b){if(this instanceof r.Event)a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||!1===a.returnValue||a.getPreventDefault&&a.getPreventDefault()?g:f):this.type=a,b&&r.extend(this,b),this.timeStamp=a&&a.timeStamp||r.now(),this[r.expando]=!0;else return new r.Event(a,b)};r.Event.prototype={preventDefault:function(){this.isDefaultPrevented=
g;var a=this.originalEvent;a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=g;var a=this.originalEvent;a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g;this.stopPropagation()},isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f};r.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){r.event.special[a]={delegateType:b,
bindType:b,handle:function(a){var c,d=a.relatedTarget,e=a.handleObj;if(!d||d!==this&&!r.contains(this,d))a.type=e.origType,c=e.handler.apply(this,arguments),a.type=b;return c}}});r.support.submitBubbles||(r.event.special.submit={setup:function(){if(r.nodeName(this,"form"))return!1;r.event.add(this,"click._submit keypress._submit",function(a){a=a.target;(a=r.nodeName(a,"input")||r.nodeName(a,"button")?a.form:b)&&!r._data(a,"_submit_attached")&&(r.event.add(a,"submit._submit",function(a){a._submit_bubble=
!0}),r._data(a,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&r.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(r.nodeName(this,"form"))return!1;r.event.remove(this,"._submit")}});r.support.changeBubbles||(r.event.special.change={setup:function(){if(ya.test(this.nodeName)){if("checkbox"===this.type||"radio"===this.type)r.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&
(this._just_changed=!0)}),r.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1);r.event.simulate("change",this,a,!0)});return!1}r.event.add(this,"beforeactivate._change",function(a){a=a.target;ya.test(a.nodeName)&&!r._data(a,"_change_attached")&&(r.event.add(a,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&r.event.simulate("change",this.parentNode,a,!0)}),r._data(a,"_change_attached",!0))})},handle:function(a){var b=a.target;
if(this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type)return a.handleObj.handler.apply(this,arguments)},teardown:function(){return r.event.remove(this,"._change"),ya.test(this.nodeName)}});r.support.focusinBubbles||r.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){r.event.simulate(b,a.target,r.event.fix(a),!0)};r.event.special[b]={setup:function(){0===c++&&L.addEventListener(a,d,!0)},teardown:function(){0===--c&&L.removeEventListener(a,d,!0)}}});
r.fn.extend({on:function(a,c,d,e,g){var k,l;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(l in a)this.on(l,c,d,a[l],g);return this}null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b));if(!1===e)e=f;else if(!e)return this;return 1===g&&(k=e,e=function(a){return r().off(a),k.apply(this,arguments)},e.guid=k.guid||(k.guid=r.guid++)),this.each(function(){r.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,g;
if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,r(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(g in a)this.off(g,c,a[g]);return this}if(!1===c||"function"==typeof c)d=c,c=b;return!1===d&&(d=f),this.each(function(){r.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return r(this.context).on(a,this.selector,b,c),this},
die:function(a,b){return r(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1==arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){r.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return r.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||r.guid++,d=0,e=function(c){var e=(r._data(this,"lastToggle"+a.guid)||0)%d;return r._data(this,
"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};for(e.guid=c;d<b.length;)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});r.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){r.fn[b]=function(a,c){return null==c&&(c=a,a=null),0<arguments.length?
this.on(b,null,a,c):this.trigger(b)};ib.test(b)&&(r.event.fixHooks[b]=r.event.keyHooks);zb.test(b)&&(r.event.fixHooks[b]=r.event.mouseHooks)});(function(a,b){function c(a,b,d,e){for(var f=0,g=b.length;f<g;f++)M(a,b[f],d,e)}function d(a,b,e,f,g,k){var l,m=aa.setFilters[b.toLowerCase()];return m||M.error(b),(a||!(l=g))&&c(a||"*",f,l=[],g),0<l.length?m(l,e,k):[]}function e(a,f,g,k,l){for(var m,n,p,q,K,r,u,F=0,v=l.length,x=ra.POS,y=RegExp("^"+x.source+"(?!"+C+")","i"),ca=function(){for(var a=1,c=arguments.length-
2;a<c;a++)arguments[a]===b&&(m[a]=b)};F<v;F++){x.exec("");a=l[F];q=[];p=0;for(K=k;m=x.exec(a);)if(n=x.lastIndex=m.index+m[0].length,n>p){u=a.slice(p,m.index);p=n;r=[f];B.test(u)&&(K&&(r=K),K=k);if(n=E.test(u))u=u.slice(0,-5).replace(B,"$&*");1<m.length&&m[0].replace(y,ca);K=d(u,m[1],m[2],r,K,n)}K?(q=q.concat(K),(u=a.slice(p))&&")"!==u?B.test(u)?c(u,q,g,k):M(u,f,g,k?k.concat(K):K):X.apply(g,q)):M(a,f,g,k)}return 1===v?g:M.uniqueSort(g)}function f(a,b,c){var d=b.dir,e=x++;return a||(a=function(a){return a===
c}),b.first?function(b,c){for(;b=b[d];)if(1===b.nodeType)return a(b,c)&&b}:function(b,c){for(var f,g=e+"."+m,k=g+"."+l;b=b[d];)if(1===b.nodeType){if((f=b[ca])===k)return b.sizset;if("string"==typeof f&&0===f.indexOf(g)){if(b.sizset)return b}else{b[ca]=k;if(a(b,c))return b.sizset=!0,b;b.sizset=!1}}}}function g(a,b){return a?function(c,d){var e=b(c,d);return e&&a(!0===e?c:e,d)}:b}function k(a){return function(b,c){for(var d,e=0;d=a[e];e++)if(d(b,c))return!0;return!1}}var l,m,n,p,q,K=a.document,u=K.documentElement,
F=!1,v=!0,x=0,y=[].slice,X=[].push,ca=("sizcache"+Math.random()).replace(".",""),C="[\\x20\\t\\r\\n\\f]",z="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w#"),z="\\["+C+"*((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)"+C+"*(?:([*^$|!~]?=)"+C+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+z+")|)|)"+C+"*\\]",T=C+"*([\\x20\\t\\r\\n\\f>+~])"+C+"*",H="(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|"+z+"|"+":((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)".replace(2,
7)+"|[^\\\\(),])+",I=RegExp("^"+C+"+|((?:^|[^\\\\])(?:\\\\.)*)"+C+"+$","g"),B=RegExp("^"+T),A=RegExp(H+"?(?="+C+"*,|$)","g"),Ia=RegExp("^(?:(?!,)(?:(?:^|,)"+C+"*"+H+")*?|"+C+"*(.*?))(\\)|$)"),P=RegExp(H.slice(19,-6)+"\\x20\\t\\r\\n\\f>+~])+|"+T,"g"),Ua=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,na=/[\x20\t\r\n\f]*[+~]/,E=/:not\($/,J=/h\d/i,D=/input|select|textarea|button/i,O=/\\(?!\\)/g,ra={ID:/^#((?:\\.|[-\w]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[-\w]|[^\x00-\xa0])+)/,NAME:/^\[name=['"]?((?:\\.|[-\w]|[^\x00-\xa0])+)['"]?\]/,
TAG:RegExp("^("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("[-","[-\\*")+")"),ATTR:RegExp("^"+z),PSEUDO:RegExp("^:((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)"),CHILD:RegExp("^:(only|nth|last|first)-child(?:\\("+C+"*(even|odd|(([+-]|)(\\d*)n|)"+C+"*(?:([+-]|)"+C+"*(\\d+)|))"+C+"*\\)|)","i"),POS:RegExp(":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)","ig"),needsContext:RegExp("^"+C+"*[>+~]|:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",
"i")},Q={},cb=[],G={},N=[],z=function(a){return a.sizzleFilter=!0,a},T=function(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}},H=function(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}},ta=function(a){var b=!1,c=K.createElement("div");try{b=a(c)}catch(d){}return b},Hb=ta(function(a){a.innerHTML="<select></select>";a=typeof a.lastChild.getAttribute("multiple");return"boolean"!==a&&"string"!==a}),tb=ta(function(a){a.id=
ca+0;a.innerHTML="<a name='"+ca+"'></a><div name='"+ca+"'></div>";u.insertBefore(a,u.firstChild);var b=K.getElementsByName&&K.getElementsByName(ca).length===2+K.getElementsByName(ca+0).length;return q=!K.getElementById(ca),u.removeChild(a),b}),ub=ta(function(a){return a.appendChild(K.createComment("")),0===a.getElementsByTagName("*").length}),Gb=ta(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&"undefined"!==typeof a.firstChild.getAttribute&&"#"===a.firstChild.getAttribute("href")}),
L=ta(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",a.getElementsByClassName&&0!==a.getElementsByClassName("e").length?(a.lastChild.className="e",1!==a.getElementsByClassName("e").length):!1}),M=function(a,b,c,d){c=c||[];b=b||K;var e,f,g,k,l=b.nodeType;if(1!==l&&9!==l)return[];if(!a||"string"!=typeof a)return c;g=xa(b);if(!g&&!d&&(e=Ua.exec(a)))if(k=e[1])if(9===l){f=b.getElementById(k);if(!f||!f.parentNode)return c;if(f.id===k)return c.push(f),c}else{if(b.ownerDocument&&
(f=b.ownerDocument.getElementById(k))&&R(b,f)&&f.id===k)return c.push(f),c}else{if(e[2])return X.apply(c,y.call(b.getElementsByTagName(a),0)),c;if((k=e[3])&&L&&b.getElementsByClassName)return X.apply(c,y.call(b.getElementsByClassName(k),0)),c}return db(a,b,c,d,g)},aa=M.selectors={cacheLength:50,match:ra,order:["ID","TAG"],attrHandle:{},createPseudo:z,find:{ID:q?function(a,b,c){if("undefined"!==typeof b.getElementById&&!c)return(a=b.getElementById(a))&&a.parentNode?[a]:[]}:function(a,c,d){if("undefined"!==
typeof c.getElementById&&!d)return(c=c.getElementById(a))?c.id===a||"undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id").value===a?[c]:b:[]},TAG:ub?function(a,b){if("undefined"!==typeof b.getElementsByTagName)return b.getElementsByTagName(a)}:function(a,b){var c=b.getElementsByTagName(a);if("*"===a){for(var d,e=[],f=0;d=c[f];f++)1===d.nodeType&&e.push(d);return e}return c}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},
preFilter:{ATTR:function(a){return a[1]=a[1].replace(O,""),a[3]=(a[4]||a[5]||"").replace(O,""),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1]?(a[2]||M.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*("even"===a[2]||"odd"===a[2])),a[4]=+(a[6]+a[7]||"odd"===a[2])):a[2]&&M.error(a[0]),a},PSEUDO:function(a){var b,c=a[4];return ra.CHILD.test(a[0])?null:(c&&(b=Ia.exec(c))&&b.pop()&&(a[0]=a[0].slice(0,b[0].length-c.length-1),c=b[0].slice(0,-1)),a.splice(2,
3,c||a[3]),a)}},filter:{ID:q?function(a){return a=a.replace(O,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(O,""),function(b){return(b="undefined"!==typeof b.getAttributeNode&&b.getAttributeNode("id"))&&b.value===a}},TAG:function(a){return"*"===a?function(){return!0}:(a=a.replace(O,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=Q[a];return b||(b=Q[a]=RegExp("(^|"+C+")"+a+"("+C+"|$)"),cb.push(a),cb.length>
aa.cacheLength&&delete Q[cb.shift()]),function(a){return b.test(a.className||"undefined"!==typeof a.getAttribute&&a.getAttribute("class")||"")}},ATTR:function(a,b,c){return b?function(d){d=M.attr(d,a);var e=d+"";if(null==d)return"!="===b;switch(b){case "=":return e===c;case "!=":return e!==c;case "^=":return c&&0===e.indexOf(c);case "*=":return c&&-1<e.indexOf(c);case "$=":return c&&e.substr(e.length-c.length)===c;case "~=":return-1<(" "+e+" ").indexOf(c);case "|=":return e===c||e.substr(0,c.length+
1)===c+"-"}}:function(b){return null!=M.attr(b,a)}},CHILD:function(a,b,c,d){if("nth"===a){var e=x++;return function(a){var b,f,g=0,k=a;if(1===c&&0===d)return!0;if((b=a.parentNode)&&(b[ca]!==e||!a.sizset)){for(k=b.firstChild;k&&(1!==k.nodeType||(k.sizset=++g,k!==a));k=k.nextSibling);b[ca]=e}return f=a.sizset-d,0===c?0===f:0===f%c&&0<=f/c}}return function(b){var c=b;switch(a){case "only":case "first":for(;c=c.previousSibling;)if(1===c.nodeType)return!1;if("first"===a)return!0;c=b;case "last":for(;c=
c.nextSibling;)if(1===c.nodeType)return!1;return!0}}},PSEUDO:function(a,b,c,d){var e=aa.pseudos[a]||aa.pseudos[a.toLowerCase()];return e||M.error("unsupported pseudo: "+a),e.sizzleFilter?e(b,c,d):e}},pseudos:{not:z(function(a,b,c){var d=S(a.replace(I,"$1"),b,c);return function(a){return!d(a)}}),enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&
a.parentNode.selectedIndex,!0===a.selected},parent:function(a){return!aa.pseudos.empty(a)},empty:function(a){var b;for(a=a.firstChild;a;){if("@"<a.nodeName||3===(b=a.nodeType)||4===b)return!1;a=a.nextSibling}return!0},contains:z(function(a){return function(b){return-1<(b.textContent||b.innerText||U(b)).indexOf(a)}}),has:z(function(a){return function(b){return 0<M(a,b).length}}),header:function(a){return J.test(a.nodeName)},text:function(a){var b,c;return"input"===a.nodeName.toLowerCase()&&"text"===
(b=a.type)&&(null==(c=a.getAttribute("type"))||c.toLowerCase()===b)},radio:T("radio"),checkbox:T("checkbox"),file:T("file"),password:T("password"),image:T("image"),submit:H("submit"),reset:H("reset"),button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},input:function(a){return D.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&(!!a.type||!!a.href)},active:function(a){return a===a.ownerDocument.activeElement}},
setFilters:{first:function(a,b,c){return c?a.slice(1):[a[0]]},last:function(a,b,c){b=a.pop();return c?a:[b]},even:function(a,b,c){b=[];c=c?1:0;for(var d=a.length;c<d;c+=2)b.push(a[c]);return b},odd:function(a,b,c){b=[];c=c?0:1;for(var d=a.length;c<d;c+=2)b.push(a[c]);return b},lt:function(a,b,c){return c?a.slice(+b):a.slice(0,+b)},gt:function(a,b,c){return c?a.slice(0,+b+1):a.slice(+b+1)},eq:function(a,b,c){b=a.splice(+b,1);return c?a:b}}};aa.setFilters.nth=aa.setFilters.eq;aa.filters=aa.pseudos;
Gb||(aa.attrHandle={href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}});tb&&(aa.order.push("NAME"),aa.find.NAME=function(a,b){if("undefined"!==typeof b.getElementsByName)return b.getElementsByName(a)});L&&(aa.order.splice(1,0,"CLASS"),aa.find.CLASS=function(a,b,c){if("undefined"!==typeof b.getElementsByClassName&&!c)return b.getElementsByClassName(a)});try{y.call(u.childNodes,0)[0].nodeType}catch(Jb){y=function(a){for(var b,c=[];b=this[a];a++)c.push(b);
return c}}var xa=M.isXML=function(a){return(a=a&&(a.ownerDocument||a).documentElement)?"HTML"!==a.nodeName:!1},R=M.contains=u.compareDocumentPosition?function(a,b){return!!(a.compareDocumentPosition(b)&16)}:u.contains?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b.parentNode;return a===d||!!(d&&1===d.nodeType&&c.contains&&c.contains(d))}:function(a,b){for(;b=b.parentNode;)if(b===a)return!0;return!1},U=M.getText=function(a){var b,c="",d=0;if(b=a.nodeType)if(1===b||9===b||11===b){if("string"==
typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=U(a)}else{if(3===b||4===b)return a.nodeValue}else for(;b=a[d];d++)c+=U(b);return c};M.attr=function(a,b){var c,d=xa(a);return d||(b=b.toLowerCase()),aa.attrHandle[b]?aa.attrHandle[b](a):Hb||d?a.getAttribute(b):(c=a.getAttributeNode(b),c?"boolean"==typeof a[b]?a[b]?b:null:c.specified?c.value:null:null)};M.error=function(a){throw Error("Syntax error, unrecognized expression: "+a);};[0,0].sort(function(){return v=0});u.compareDocumentPosition?
n=function(a,b){return a===b?(F=!0,0):(a.compareDocumentPosition&&b.compareDocumentPosition?a.compareDocumentPosition(b)&4:a.compareDocumentPosition)?-1:1}:(n=function(a,b){if(a===b)return F=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[];c=a.parentNode;d=b.parentNode;var g=c;if(c===d)return p(a,b);if(!c)return-1;if(!d)return 1;for(;g;)e.unshift(g),g=g.parentNode;for(g=d;g;)f.unshift(g),g=g.parentNode;c=e.length;d=f.length;for(g=0;g<c&&g<d;g++)if(e[g]!==f[g])return p(e[g],
f[g]);return g===c?p(a,f[g],-1):p(e[g],b,1)},p=function(a,b,c){if(a===b)return c;for(a=a.nextSibling;a;){if(a===b)return-1;a=a.nextSibling}return 1});M.uniqueSort=function(a){var b,c=1;if(n&&(F=v,a.sort(n),F))for(;b=a[c];c++)b===a[c-1]&&a.splice(c--,1);return a};var S=M.compile=function(a,b,c){var d,e,l,m=G[a];if(m&&m.context===b)return m;var n,p=[];d=0;for(var q=Ia.exec(a),u=!q.pop()&&!q.pop(),r=u&&a.match(A)||[""],F=aa.preFilter,v=aa.filter,x=!c&&b!==K;null!=(l=r[d])&&u;d++)for(p.push(e=[]),x&&
(l=" "+l);l;){u=!1;if(q=B.exec(l))l=l.slice(q[0].length),u=e.push({part:q.pop().replace(I," "),captures:q});for(n in v)(q=ra[n].exec(l))&&(!F[n]||(q=F[n](q,b,c)))&&(l=l.slice(q.shift().length),u=e.push({part:n,captures:q}));if(!u)break}e=(u||M.error(a),p);for(l=0;d=e[l];l++){n=e;p=l;q=b;u=c;F=r=void 0;for(v=0;r=d[v];v++)aa.relative[r.part]?F=f(F,aa.relative[r.part],q):(r.captures.push(q,u),F=g(F,aa.filter[r.part].apply(null,r.captures)));n[p]=F}return m=G[a]=k(e),m.context=b,m.runs=m.dirruns=0,N.push(a),
N.length>aa.cacheLength&&delete G[N.shift()],m};M.matches=function(a,b){return M(a,null,null,b)};M.matchesSelector=function(a,b){return 0<M(b,null,null,[a]).length};var db=function(a,b,c,d,f){a=a.replace(I,"$1");var g,k,n,p,q,K,u=a.match(A);k=a.match(P);n=b.nodeType;if(ra.POS.test(a))return e(a,b,c,d,u);if(d)g=y.call(d,0);else if(u&&1===u.length){if(1<k.length&&9===n&&!f&&(u=ra.ID.exec(k[0]))){b=aa.find.ID(u[1],b,f)[0];if(!b)return c;a=a.slice(k.shift().length)}d=(u=na.exec(k[0]))&&!u.index&&b.parentNode||
b;K=k.pop();p=K.split(":not")[0];k=0;for(n=aa.order.length;k<n;k++)if(q=aa.order[k],u=ra[q].exec(p))if(g=aa.find[q]((u[1]||"").replace(O,""),d,f),null!=g){p===K&&(a=a.slice(0,a.length-K.length)+p.replace(ra[q],""),a||X.apply(c,y.call(g,0)));break}}if(a)for(f=S(a,b,f),m=f.dirruns++,null==g&&(g=aa.find.TAG("*",na.test(a)&&b.parentNode||b)),k=0;a=g[k];k++)l=f.runs++,f(a,b)&&c.push(a);return c};K.querySelectorAll&&function(){var a,b=db,c=/'|\\/g,d=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,e=[],
f=[":active"],g=u.matchesSelector||u.mozMatchesSelector||u.webkitMatchesSelector||u.oMatchesSelector||u.msMatchesSelector;ta(function(a){a.innerHTML="<select><option selected></option></select>";a.querySelectorAll("[selected]").length||e.push("\\["+C+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)");a.querySelectorAll(":checked").length||e.push(":checked")});ta(function(a){a.innerHTML="<p test=''></p>";a.querySelectorAll("[test^='']").length&&e.push("[*^$]="+C+"*(?:\"\"|'')");a.innerHTML=
"<input type='hidden'>";a.querySelectorAll(":enabled").length||e.push(":enabled",":disabled")});e=e.length&&RegExp(e.join("|"));db=function(a,d,f,g,k){if(!(g||k||e&&e.test(a)))if(9===d.nodeType)try{return X.apply(f,y.call(d.querySelectorAll(a),0)),f}catch(l){}else if(1===d.nodeType&&"object"!==d.nodeName.toLowerCase()){var m=d.getAttribute("id"),n=m||ca,p=na.test(a)&&d.parentNode||d;m?n=n.replace(c,"\\$&"):d.setAttribute("id",n);try{return X.apply(f,y.call(p.querySelectorAll(a.replace(A,"[id='"+n+
"'] $&")),0)),f}catch(q){}finally{m||d.removeAttribute("id")}}return b(a,d,f,g,k)};g&&(ta(function(b){a=g.call(b,"div");try{g.call(b,"[test!='']:sizzle"),f.push(aa.match.PSEUDO)}catch(c){}}),f=RegExp(f.join("|")),M.matchesSelector=function(b,c){c=c.replace(d,"='$1']");if(!(xa(b)||f.test(c)||e&&e.test(c)))try{var k=g.call(b,c);if(k||a||b.document&&11!==b.document.nodeType)return k}catch(l){}return 0<M(c,null,null,[b]).length})}();M.attr=r.attr;r.find=M;r.expr=M.selectors;r.expr[":"]=r.expr.pseudos;
r.unique=M.uniqueSort;r.text=M.getText;r.isXMLDoc=M.isXML;r.contains=M.contains})(a);var Eb=/Until$/,Fb=/^(?:parents|prev(?:Until|All))/,Cb=/^.[^:#\[\.,]*$/,pb=r.expr.match.needsContext,qa={children:!0,contents:!0,next:!0,prev:!0};r.fn.extend({find:function(a){var b,c,d,e,f,g,k=this;if("string"!=typeof a)return r(a).filter(function(){b=0;for(c=k.length;b<c;b++)if(r.contains(k[b],this))return!0});g=this.pushStack("","find",a);b=0;for(c=this.length;b<c;b++)if(d=g.length,r.find(a,this[b],g),0<b)for(e=
d;e<g.length;e++)for(f=0;f<d;f++)if(g[f]===g[e]){g.splice(e--,1);break}return g},has:function(a){var b,c=r(a,this),d=c.length;return this.filter(function(){for(b=0;b<d;b++)if(r.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(m(this,a,!1),"not",a)},filter:function(a){return this.pushStack(m(this,a,!0),"filter",a)},is:function(a){return!!a&&("string"==typeof a?pb.test(a)?0<=r(a,this.context).index(this[0]):0<r.filter(a,this).length:0<this.filter(a).length)},closest:function(a,
b){for(var c,d=0,e=this.length,f=[],g=pb.test(a)||"string"!=typeof a?r(a,b||this.context):0;d<e;d++)for(c=this[d];c&&c.ownerDocument&&c!==b&&11!==c.nodeType;){if(g?-1<g.index(c):r.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}return f=1<f.length?r.unique(f):f,this.pushStack(f,"closest",a)},index:function(a){return a?"string"==typeof a?r.inArray(this[0],r(a)):r.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c="string"==typeof a?
r(a,b):r.makeArray(a&&a.nodeType?[a]:a),d=r.merge(this.get(),c);return this.pushStack(k(c[0])||k(d[0])?d:r.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});r.fn.andSelf=r.fn.addBack;r.each({parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},parents:function(a){return r.dir(a,"parentNode")},parentsUntil:function(a,b,c){return r.dir(a,"parentNode",c)},next:function(a){return l(a,"nextSibling")},prev:function(a){return l(a,"previousSibling")},
nextAll:function(a){return r.dir(a,"nextSibling")},prevAll:function(a){return r.dir(a,"previousSibling")},nextUntil:function(a,b,c){return r.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return r.dir(a,"previousSibling",c)},siblings:function(a){return r.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return r.sibling(a.firstChild)},contents:function(a){return r.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:r.merge([],a.childNodes)}},function(a,b){r.fn[a]=function(c,
d){var e=r.map(this,b,c);return Eb.test(a)||(d=c),d&&"string"==typeof d&&(e=r.filter(d,e)),e=1<this.length&&!qa[a]?r.unique(e):e,1<this.length&&Fb.test(a)&&(e=e.reverse()),this.pushStack(e,a,fa.call(arguments).join(","))}});r.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),1===b.length?r.find.matchesSelector(b[0],a)?[b[0]]:[]:r.find.matches(a,b)},dir:function(a,c,d){var e=[];for(a=a[c];a&&9!==a.nodeType&&(d===b||1!==a.nodeType||!r(a).is(d));)1===a.nodeType&&e.push(a),a=a[c];return e},sibling:function(a,
b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Ta="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Za=/ jQuery\d+="(?:null|\d+)"/g,Y=/^\s+/,$a=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Va=/<([\w:]+)/,Wa=/<tbody/i,ab=/<|&#?\w+;/,qb=/<(?:script|style|link)/i,rb=/<(?:script|object|embed|option|style)/i,Oa=RegExp("<(?:"+Ta+")[\\s/>]",
"i"),ma=/^(?:checkbox|radio)$/,ba=/checked\s*(?:[^=]|=\s*.checked.)/i,sb=/\/(java|ecma)script/i,bb=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,ka={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ba=n(L),ha=Ba.appendChild(L.createElement("div"));
ka.optgroup=ka.option;ka.tbody=ka.tfoot=ka.colgroup=ka.caption=ka.thead;ka.th=ka.td;r.support.htmlSerialize||(ka._default=[1,"X<div>","</div>"]);r.fn.extend({text:function(a){return r.access(this,function(a){return a===b?r.text(this):this.empty().append((this[0]&&this[0].ownerDocument||L).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(r.isFunction(a))return this.each(function(b){r(this).wrapAll(a.call(this,b))});if(this[0]){var b=r(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&
b.insertBefore(this[0]);b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return r.isFunction(a)?this.each(function(b){r(this).wrapInner(a.call(this,b))}):this.each(function(){var b=r(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=r.isFunction(a);return this.each(function(c){r(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){r.nodeName(this,
"body")||r(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){1!==this.nodeType&&11!==this.nodeType||this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){1!==this.nodeType&&11!==this.nodeType||this.insertBefore(a,this.firstChild)})},before:function(){if(!k(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=r.clean(arguments);return this.pushStack(r.merge(a,
this),"before",this.selector)}},after:function(){if(!k(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=r.clean(arguments);return this.pushStack(r.merge(this,a),"after",this.selector)}},remove:function(a,b){for(var c,d=0;null!=(c=this[d]);d++)if(!a||r.filter(a,[c]).length)!b&&1===c.nodeType&&(r.cleanData(c.getElementsByTagName("*")),r.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c);return this},empty:function(){for(var a,
b=0;null!=(a=this[b]);b++)for(1===a.nodeType&&r.cleanData(a.getElementsByTagName("*"));a.firstChild;)a.removeChild(a.firstChild);return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return r.clone(this,a,b)})},html:function(a){return r.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(Za,""):b;if("string"==typeof a&&!(qb.test(a)||!r.support.htmlSerialize&&Oa.test(a)||!r.support.leadingWhitespace&&Y.test(a)||
ka[(Va.exec(a)||["",""])[1].toLowerCase()])){a=a.replace($a,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},1===c.nodeType&&(r.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){return k(this[0])?this.length?this.pushStack(r(r.isFunction(a)?a():a),"replaceWith",a):this:r.isFunction(a)?this.each(function(b){var c=r(this),d=c.html();c.replaceWith(a.call(this,b,d))}):("string"!=typeof a&&(a=r(a).detach()),this.each(function(){var b=
this.nextSibling,c=this.parentNode;r(this).remove();b?r(b).before(a):r(c).append(a)}))},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){a=[].concat.apply([],a);var e,f,g,k=0,l=a[0],m=[],n=this.length;if(!r.support.checkClone&&1<n&&"string"==typeof l&&ba.test(l))return this.each(function(){r(this).domManip(a,c,d)});if(r.isFunction(l))return this.each(function(e){var f=r(this);a[0]=l.call(this,e,c?f.html():b);f.domManip(a,c,d)});if(this[0]){e=r.buildFragment(a,this,m);g=e.fragment;
f=g.firstChild;1===g.childNodes.length&&(g=f);if(f)for(c=c&&r.nodeName(f,"tr"),e=e.cacheable||n-1;k<n;k++)d.call(c&&r.nodeName(this[k],"table")?this[k].getElementsByTagName("tbody")[0]||this[k].appendChild(this[k].ownerDocument.createElement("tbody")):this[k],k===e?g:r.clone(g,!0,!0));g=f=null;m.length&&r.each(m,function(a,b){b.src?r.ajax?r.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):r.error("no ajax"):r.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bb,
""));b.parentNode&&b.parentNode.removeChild(b)})}return this}});r.buildFragment=function(a,c,d){var e,f,g,k=a[0];return c=c||L,c=(c[0]||c).ownerDocument||c[0]||c,"undefined"==typeof c.createDocumentFragment&&(c=L),1===a.length&&"string"==typeof k&&512>k.length&&c===L&&"<"===k.charAt(0)&&!rb.test(k)&&(r.support.checkClone||!ba.test(k))&&(r.support.html5Clone||!Oa.test(k))&&(f=!0,e=r.fragments[k],g=e!==b),e||(e=c.createDocumentFragment(),r.clean(a,c,e,d),f&&(r.fragments[k]=g&&e)),{fragment:e,cacheable:f}};
r.fragments={};r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){r.fn[a]=function(c){var d,e=0,f=[];c=r(c);var g=c.length;d=1===this.length&&this[0].parentNode;if((null==d||d&&11===d.nodeType&&1===d.childNodes.length)&&1===g)return c[b](this[0]),this;for(;e<g;e++)d=(0<e?this.clone(!0):this).get(),r(c[e])[b](d),f=f.concat(d);return this.pushStack(f,a,c.selector)}});r.extend({clone:function(a,b,c){var d,e,f,g;r.support.html5Clone||
r.isXMLDoc(a)||!Oa.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(ha.innerHTML=a.outerHTML,ha.removeChild(g=ha.firstChild));if(!(r.support.noCloneEvent&&r.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||r.isXMLDoc(a)))for(q(a,g),d=u(a),e=u(g),f=0;d[f];++f)e[f]&&q(d[f],e[f]);if(b&&(p(a,g),c))for(d=u(a),e=u(g),f=0;d[f];++f)p(d[f],e[f]);return g},clean:function(a,b,c,d){var e,f,g,k,l,m,p,q=0,K=[];b&&"undefined"!=typeof b.createDocumentFragment||(b=L);for(f=b===L&&Ba;null!=(g=a[q]);q++)if("number"==
typeof g&&(g+=""),g){if("string"==typeof g)if(ab.test(g)){f=f||n(b);m=m||f.appendChild(b.createElement("div"));g=g.replace($a,"<$1></$2>");e=(Va.exec(g)||["",""])[1].toLowerCase();k=ka[e]||ka._default;l=k[0];for(m.innerHTML=k[1]+g+k[2];l--;)m=m.lastChild;if(!r.support.tbody)for(l=Wa.test(g),k="table"!==e||l?"<table>"!==k[1]||l?[]:m.childNodes:m.firstChild&&m.firstChild.childNodes,e=k.length-1;0<=e;--e)r.nodeName(k[e],"tbody")&&!k[e].childNodes.length&&k[e].parentNode.removeChild(k[e]);!r.support.leadingWhitespace&&
Y.test(g)&&m.insertBefore(b.createTextNode(Y.exec(g)[0]),m.firstChild);g=m.childNodes;m=f.lastChild}else g=b.createTextNode(g);g.nodeType?K.push(g):K=r.merge(K,g)}m&&(f.removeChild(m),g=m=f=null);if(!r.support.appendChecked)for(q=0;null!=(g=K[q]);q++)r.nodeName(g,"input")?v(g):"undefined"!=typeof g.getElementsByTagName&&r.grep(g.getElementsByTagName("input"),v);if(c)for(a=function(a){if(!a.type||sb.test(a.type))return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)},q=0;null!=
(g=K[q]);q++)r.nodeName(g,"script")&&a(g)||(c.appendChild(g),"undefined"!=typeof g.getElementsByTagName&&(p=r.grep(r.merge([],g.getElementsByTagName("script")),a),K.splice.apply(K,[q+1,0].concat(p)),q+=p.length));return K},cleanData:function(a,b){for(var c,d,e,f,g=0,k=r.expando,l=r.cache,m=r.support.deleteExpando,n=r.event.special;null!=(e=a[g]);g++)if(b||r.acceptData(e))if(c=(d=e[k])&&l[d]){if(c.events)for(f in c.events)n[f]?r.event.remove(e,f):r.removeEvent(e,f,c.handle);l[d]&&(delete l[d],m?delete e[k]:
e.removeAttribute?e.removeAttribute(k):e[k]=null,r.deletedIds.push(d))}}});(function(){var a,b;r.uaMatch=function(a){a=a.toLowerCase();a=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}};a=r.uaMatch(sa.userAgent);b={};a.browser&&(b[a.browser]=!0,b.version=a.version);b.webkit&&(b.safari=!0);r.browser=
b;r.sub=function(){function a(b,c){return new a.fn.init(b,c)}r.extend(!0,a,this);a.superclass=this;a.fn=a.prototype=this();a.fn.constructor=a;a.sub=this.sub;a.fn.init=function(c,d){return d&&d instanceof r&&!(d instanceof a)&&(d=a(d)),r.fn.init.call(this,c,d,b)};a.fn.init.prototype=a.fn;var b=a(L);return a}})();var ga,K,X,ca=/alpha\([^)]*\)/i,T=/opacity=([^)]*)/,Ia=/^(top|right|bottom|left)$/,na=/^margin/,Ua=RegExp("^("+Sa+")(.*)$","i"),ra=RegExp("^("+Sa+")(?!px)[a-z%]+$","i"),cb=RegExp("^([-+])=("+
Sa+")","i"),ta={},Gb={position:"absolute",visibility:"hidden",display:"block"},tb={letterSpacing:0,fontWeight:400,lineHeight:1},xa=["Top","Right","Bottom","Left"],aa=["Webkit","O","Moz","ms"],db=r.fn.toggle;r.fn.extend({css:function(a,c){return r.access(this,function(a,c,d){return d!==b?r.style(a,c,d):r.css(a,c)},a,c,1<arguments.length)},show:function(){return x(this,!0)},hide:function(){return x(this)},toggle:function(a,b){var c="boolean"==typeof a;return r.isFunction(a)&&r.isFunction(b)?db.apply(this,
arguments):this.each(function(){(c?a:z(this))?r(this).show():r(this).hide()})}});r.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=ga(a,"opacity");return""===c?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":r.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,k,l=r.camelCase(c),m=a.style;c=r.cssProps[l]||(r.cssProps[l]=y(m,l));k=r.cssHooks[c]||
r.cssHooks[l];if(d===b)return k&&"get"in k&&(f=k.get(a,!1,e))!==b?f:m[c];g=typeof d;"string"===g&&(f=cb.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(r.css(a,c)),g="number");if(!(null==d||"number"===g&&isNaN(d)||("number"===g&&!r.cssNumber[l]&&(d+="px"),k&&"set"in k&&(d=k.set(a,d,e))===b)))try{m[c]=d}catch(n){}}},css:function(a,c,d,e){var f,g,k,l=r.camelCase(c);return c=r.cssProps[l]||(r.cssProps[l]=y(a.style,l)),k=r.cssHooks[c]||r.cssHooks[l],k&&"get"in k&&(f=k.get(a,!0,e)),f===b&&(f=ga(a,c)),"normal"===
f&&c in tb&&(f=tb[c]),d||e!==b?(g=parseFloat(f),d||r.isNumeric(g)?g||0:f):f},swap:function(a,b,c){var d,e={};for(d in b)e[d]=a.style[d],a.style[d]=b[d];c=c.call(a);for(d in b)a.style[d]=e[d];return c}});a.getComputedStyle?ga=function(a,b){var c,d,e,f,g=getComputedStyle(a,null),k=a.style;return g&&(c=g[b],""===c&&!r.contains(a.ownerDocument.documentElement,a)&&(c=r.style(a,b)),ra.test(c)&&na.test(b)&&(d=k.width,e=k.minWidth,f=k.maxWidth,k.minWidth=k.maxWidth=k.width=c,c=g.width,k.width=d,k.minWidth=
e,k.maxWidth=f)),c}:L.documentElement.currentStyle&&(ga=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;return null==e&&f&&f[b]&&(e=f[b]),ra.test(e)&&!Ia.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),f.left="fontSize"===b?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),""===e?"auto":e});r.each(["height","width"],function(a,b){r.cssHooks[b]={get:function(a,c,d){if(c)return 0!==a.offsetWidth||"none"!==ga(a,"display")?
D(a,b,d):r.swap(a,Gb,function(){return D(a,b,d)})},set:function(a,c,d){return B(a,c,d?A(a,b,d,r.support.boxSizing&&"border-box"===r.css(a,"boxSizing")):0)}}});r.support.opacity||(r.cssHooks.opacity={get:function(a,b){return T.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=r.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(1<=b&&""===r.trim(f.replace(ca,""))&&
c.removeAttribute&&(c.removeAttribute("filter"),d&&!d.filter))return;c.filter=ca.test(f)?f.replace(ca,e):f+" "+e}});r(function(){r.support.reliableMarginRight||(r.cssHooks.marginRight={get:function(a,b){return r.swap(a,{display:"inline-block"},function(){if(b)return ga(a,"marginRight")})}});!r.support.pixelPosition&&r.fn.position&&r.each(["top","left"],function(a,b){r.cssHooks[b]={get:function(a,c){if(c){var d=ga(a,b);return ra.test(d)?r(a).position()[b]+"px":d}}}})});r.expr&&r.expr.filters&&(r.expr.filters.hidden=
function(a){return 0===a.offsetWidth&&0===a.offsetHeight||!r.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||ga(a,"display"))},r.expr.filters.visible=function(a){return!r.expr.filters.hidden(a)});r.each({margin:"",padding:"",border:"Width"},function(a,b){r.cssHooks[a+b]={expand:function(c){var d="string"==typeof c?c.split(" "):[c],e={};for(c=0;4>c;c++)e[a+xa[c]+b]=d[c]||d[c-2]||d[0];return e}};na.test(a)||(r.cssHooks[a+b].set=B)});var Hb=/%20/g,Jb=/\[\]$/,ub=/\r?\n/g,Tb=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,
Ub=/^(?:select|textarea)/i;r.fn.extend({serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?r.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Ub.test(this.nodeName)||Tb.test(this.type))}).map(function(a,b){var c=r(this).val();return null==c?null:r.isArray(c)?r.map(c,function(a,c){return{name:b.name,value:a.replace(ub,"\r\n")}}):{name:b.name,value:c.replace(ub,"\r\n")}}).get()}});
r.param=function(a,c){var d,e=[],f=function(a,b){b=r.isFunction(b)?b():null==b?"":b;e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=r.ajaxSettings&&r.ajaxSettings.traditional);if(r.isArray(a)||a.jquery&&!r.isPlainObject(a))r.each(a,function(){f(this.name,this.value)});else for(d in a)G(d,a[d],c,f);return e.join("&").replace(Hb,"+")};var Pa,Qa,Vb=/#.*$/,Wb=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Xb=/^(?:GET|HEAD)$/,Yb=/^\/\//,Kb=/\?/,Zb=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
$b=/([?&])_=[^&]*/,Lb=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Mb=r.fn.load,Db={},Nb={},Ob=["*/"]+["*"];try{Pa=pa.href}catch(gc){Pa=L.createElement("a"),Pa.href="",Pa=Pa.href}Qa=Lb.exec(Pa.toLowerCase())||[];r.fn.load=function(a,c,d){if("string"!=typeof a&&Mb)return Mb.apply(this,arguments);if(!this.length)return this;var e,f,g,k=this,l=a.indexOf(" ");return 0<=l&&(e=a.slice(l,a.length),a=a.slice(0,l)),r.isFunction(c)?(d=c,c=b):"object"==typeof c&&(f="POST"),r.ajax({url:a,type:f,dataType:"html",
data:c,complete:function(a,b){d&&k.each(d,g||[a.responseText,b,a])}}).done(function(a){g=arguments;k.html(e?r("<div>").append(a.replace(Zb,"")).find(e):a)}),this};r.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){r.fn[b]=function(a){return this.on(b,a)}});r.each(["get","post"],function(a,c){r[c]=function(a,d,e,f){return r.isFunction(d)&&(f=f||e,e=d,d=b),r.ajax({type:c,url:a,data:d,success:e,dataType:f})}});r.extend({getScript:function(a,c){return r.get(a,
b,c,"script")},getJSON:function(a,b,c){return r.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?I(a,r.ajaxSettings):(b=a,a=r.ajaxSettings),I(a,b),a},ajaxSettings:{url:Pa,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(Qa[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Ob},contents:{xml:/xml/,
html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":r.parseJSON,"text xml":r.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:C(Db),ajaxTransport:C(Nb),ajax:function(a,c){function d(a,c,g,m){var p,F,X,ca,z,H=c;if(2!==C){C=2;l&&clearTimeout(l);k=b;f=m||"";T.readyState=0<a?4:0;if(g){ca=q;m=T;var I,B,A,Ia,P=ca.contents,na=ca.dataTypes,Ua=ca.responseFields;for(B in Ua)B in g&&(m[Ua[B]]=g[B]);for(;"*"===na[0];)na.shift(),
I===b&&(I=ca.mimeType||m.getResponseHeader("content-type"));if(I)for(B in P)if(P[B]&&P[B].test(I)){na.unshift(B);break}if(na[0]in g)A=na[0];else{for(B in g){if(!na[0]||ca.converters[B+" "+na[0]]){A=B;break}Ia||(Ia=B)}A=A||Ia}g=A?(A!==na[0]&&na.unshift(A),g[A]):void 0;ca=g}if(200<=a&&300>a||304===a)if(q.ifModified&&(z=T.getResponseHeader("Last-Modified"),z&&(r.lastModified[e]=z),z=T.getResponseHeader("Etag"),z&&(r.etag[e]=z)),304===a)H="notmodified",p=!0;else{var E;a:{p=q;F=ca;var J,H=p.dataTypes.slice();
g=H[0];I={};B=0;p.dataFilter&&(F=p.dataFilter(F,p.dataType));if(H[1])for(E in p.converters)I[E.toLowerCase()]=p.converters[E];for(;X=H[++B];)if("*"!==X){if("*"!==g&&g!==X){E=I[g+" "+X]||I["* "+X];if(!E)for(J in I)if(z=J.split(" "),z[1]===X&&(E=I[g+" "+z[0]]||I["* "+z[0]])){!0===E?E=I[J]:!0!==I[J]&&(X=z[0],H.splice(B--,0,X));break}if(!0!==E)if(E&&p["throws"])F=E(F);else try{F=E(F)}catch(D){E={state:"parsererror",error:E?D:"No conversion from "+g+" to "+X};break a}}g=X}E={state:"success",data:F}}p=
E;H=p.state;F=p.data;X=p.error;p=!X}else if(X=H,!H||a)H="error",0>a&&(a=0);T.status=a;T.statusText=""+(c||H);p?v.resolveWith(K,[F,H,T]):v.rejectWith(K,[T,H,X]);T.statusCode(y);y=b;n&&u.trigger("ajax"+(p?"Success":"Error"),[T,q,p?F:X]);x.fireWith(K,[T,H]);n&&(u.trigger("ajaxComplete",[T,q]),--r.active||r.event.trigger("ajaxStop"))}}"object"==typeof a&&(c=a,a=b);c=c||{};var e,f,g,k,l,m,n,p,q=r.ajaxSetup({},c),K=q.context||q,u=K!==q&&(K.nodeType||K instanceof r)?r(K):r.event,v=r.Deferred(),x=r.Callbacks("once memory"),
y=q.statusCode||{},X={},ca={},C=0,z="canceled",T={readyState:0,setRequestHeader:function(a,b){if(!C){var c=a.toLowerCase();a=ca[c]=ca[c]||a;X[a]=b}return this},getAllResponseHeaders:function(){return 2===C?f:null},getResponseHeader:function(a){var c;if(2===C){if(!g)for(g={};c=Wb.exec(f);)g[c[1].toLowerCase()]=c[2];c=g[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return C||(q.mimeType=a),this},abort:function(a){return a=a||z,k&&k.abort(a),d(0,a),this}};v.promise(T);T.success=
T.done;T.error=T.fail;T.complete=x.add;T.statusCode=function(a){if(a){var b;if(2>C)for(b in a)y[b]=[y[b],a[b]];else b=a[T.status],T.always(b)}return this};q.url=((a||q.url)+"").replace(Vb,"").replace(Yb,Qa[1]+"//");q.dataTypes=r.trim(q.dataType||"*").toLowerCase().split(za);null==q.crossDomain&&(m=Lb.exec(q.url.toLowerCase()),q.crossDomain=!(!m||m[1]==Qa[1]&&m[2]==Qa[2]&&(m[3]||("http:"===m[1]?80:443))==(Qa[3]||("http:"===Qa[1]?80:443))));q.data&&q.processData&&"string"!=typeof q.data&&(q.data=r.param(q.data,
q.traditional));F(Db,q,c,T);if(2===C)return T;n=q.global;q.type=q.type.toUpperCase();q.hasContent=!Xb.test(q.type);n&&0===r.active++&&r.event.trigger("ajaxStart");if(!q.hasContent&&(q.data&&(q.url+=(Kb.test(q.url)?"&":"?")+q.data,delete q.data),e=q.url,!1===q.cache)){m=r.now();var H=q.url.replace($b,"$1_="+m);q.url=H+(H===q.url?(Kb.test(q.url)?"&":"?")+"_="+m:"")}(q.data&&q.hasContent&&!1!==q.contentType||c.contentType)&&T.setRequestHeader("Content-Type",q.contentType);q.ifModified&&(e=e||q.url,r.lastModified[e]&&
T.setRequestHeader("If-Modified-Since",r.lastModified[e]),r.etag[e]&&T.setRequestHeader("If-None-Match",r.etag[e]));T.setRequestHeader("Accept",q.dataTypes[0]&&q.accepts[q.dataTypes[0]]?q.accepts[q.dataTypes[0]]+("*"!==q.dataTypes[0]?", "+Ob+"; q=0.01":""):q.accepts["*"]);for(p in q.headers)T.setRequestHeader(p,q.headers[p]);if(!q.beforeSend||!1!==q.beforeSend.call(K,T,q)&&2!==C){z="abort";for(p in{success:1,error:1,complete:1})T[p](q[p]);if(k=F(Nb,q,c,T)){T.readyState=1;n&&u.trigger("ajaxSend",[T,
q]);q.async&&0<q.timeout&&(l=setTimeout(function(){T.abort("timeout")},q.timeout));try{C=1,k.send(X,d)}catch(I){if(2>C)d(-1,I);else throw I;}}else d(-1,"No Transport");return T}return T.abort()},active:0,lastModified:{},etag:{}});var Pb=[],ac=/\?/,vb=/(=)\?(?=&|$)|\?\?/,bc=r.now();r.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Pb.pop()||r.expando+"_"+bc++;return this[a]=!0,a}});r.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,k,l=c.data,m=c.url,n=!1!==c.jsonp,p=n&&vb.test(m),q=n&&
!p&&"string"==typeof l&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&vb.test(l);if("jsonp"===c.dataTypes[0]||p||q)return f=c.jsonpCallback=r.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,g=a[f],p?c.url=m.replace(vb,"$1"+f):q?c.data=l.replace(vb,"$1"+f):n&&(c.url+=(ac.test(m)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return k||r.error(f+" was not called"),k[0]},c.dataTypes[0]="json",a[f]=function(){k=arguments},e.always(function(){a[f]=g;c[f]&&
(c.jsonpCallback=d.jsonpCallback,Pb.push(f));k&&r.isFunction(g)&&g(k[0]);k=g=b}),"script"});r.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return r.globalEval(a),a}}});r.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1);a.crossDomain&&(a.type="GET",a.global=!1)});r.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=L.head||
L.getElementsByTagName("head")[0]||L.documentElement;return{send:function(e,f){c=L.createElement("script");c.async="async";a.scriptCharset&&(c.charset=a.scriptCharset);c.src=a.url;c.onload=c.onreadystatechange=function(a,e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success")};d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var Xa,Ib=a.ActiveXObject?function(){for(var a in Xa)Xa[a](0,
1)}:!1,cc=0;r.ajaxSettings.xhr=a.ActiveXObject?function(){var b;if(!(b=!this.isLocal&&H()))a:{try{b=new a.ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}b=void 0}return b}:H;(function(a){r.extend(r.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})})(r.ajaxSettings.xhr());r.support.ajax&&r.ajaxTransport(function(c){if(!c.crossDomain||r.support.cors){var d;return{send:function(e,f){var g,k,l=c.xhr();c.username?l.open(c.type,c.url,c.async,c.username,c.password):l.open(c.type,c.url,c.async);if(c.xhrFields)for(k in c.xhrFields)l[k]=
c.xhrFields[k];c.mimeType&&l.overrideMimeType&&l.overrideMimeType(c.mimeType);c.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(k in e)l.setRequestHeader(k,e[k])}catch(m){}l.send(c.hasContent&&c.data||null);d=function(a,e){var k,m,n,p,q;try{if(d&&(e||4===l.readyState))if(d=b,g&&(l.onreadystatechange=r.noop,Ib&&delete Xa[g]),e)4!==l.readyState&&l.abort();else{k=l.status;n=l.getAllResponseHeaders();p={};(q=l.responseXML)&&q.documentElement&&(p.xml=q);try{p.text=
l.responseText}catch(K){}try{m=l.statusText}catch(u){m=""}k||!c.isLocal||c.crossDomain?1223===k&&(k=204):k=p.text?200:404}}catch(F){e||f(-1,F)}p&&f(k,m,p,n)};c.async?4===l.readyState?setTimeout(d,0):(g=++cc,Ib&&(Xa||(Xa={},r(a).unload(Ib)),Xa[g]=d),l.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var nb,wb,dc=/^(?:toggle|show|hide)$/,ec=RegExp("^(?:([-+])=|)("+Sa+")([a-z%]*)$","i"),fc=/queueHooks$/,ob=[function(a,b,c){var d,e,f,g,k,l,m=this,n=a.style,p={},q=[],K=a.nodeType&&z(a);c.queue||
(k=r._queueHooks(a,"fx"),null==k.unqueued&&(k.unqueued=0,l=k.empty.fire,k.empty.fire=function(){k.unqueued||l()}),k.unqueued++,m.always(function(){m.always(function(){k.unqueued--;r.queue(a,"fx").length||k.empty.fire()})}));1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],"inline"===r.css(a,"display")&&"none"===r.css(a,"float")&&(r.support.inlineBlockNeedsLayout&&"inline"!==E(a.nodeName)?n.zoom=1:n.display="inline-block"));c.overflow&&(n.overflow="hidden",
r.support.shrinkWrapBlocks||m.done(function(){n.overflow=c.overflow[0];n.overflowX=c.overflow[1];n.overflowY=c.overflow[2]}));for(d in b)e=b[d],dc.exec(e)&&(delete b[d],e!==(K?"hide":"show")&&q.push(d));if(e=q.length)for(f=r._data(a,"fxshow")||r._data(a,"fxshow",{}),K?r(a).show():m.done(function(){r(a).hide()}),m.done(function(){var b;r.removeData(a,"fxshow",!0);for(b in p)r.style(a,b,p[b])}),d=0;d<e;d++)b=q[d],g=m.createTween(b,K?f[b]:0),p[b]=f[b]||r.style(a,b),b in f||(f[b]=g.start,K&&(g.end=g.start,
g.start="width"===b||"height"===b?1:0))}],Ya={"*":[function(a,b){var c,d,e,f=this.createTween(a,b),g=ec.exec(b),k=f.cur(),l=+k||0,m=1;if(g){c=+g[2];d=g[3]||(r.cssNumber[a]?"":"px");if("px"!==d&&l){l=r.css(f.elem,a,!0)||c||1;do e=m=m||".5",l/=m,r.style(f.elem,a,l+d),m=f.cur()/k;while(1!==m&&m!==e)}f.unit=d;f.start=l;f.end=g[1]?l+(g[1]+1)*c:c}return f}]};r.Animation=r.extend(O,{tweener:function(a,b){r.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;d<e;d++)c=a[d],Ya[c]=Ya[c]||[],
Ya[c].unshift(b)},prefilter:function(a,b){b?ob.unshift(a):ob.push(a)}});r.Tween=N;N.prototype={constructor:N,init:function(a,b,c,d,e,f){this.elem=a;this.prop=c;this.easing=e||"swing";this.options=b;this.start=this.now=this.cur();this.end=d;this.unit=f||(r.cssNumber[c]?"":"px")},cur:function(){var a=N.propHooks[this.prop];return a&&a.get?a.get(this):N.propHooks._default.get(this)},run:function(a){var b,c=N.propHooks[this.prop];return this.pos=b=r.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration),
this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):N.propHooks._default.set(this),this}};N.prototype.init.prototype=N.prototype;N.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=r.css(a.elem,a.prop,!1,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){r.fx.step[a.prop]?r.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[r.cssProps[a.prop]]||r.cssHooks[a.prop])?
r.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}};N.propHooks.scrollTop=N.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}};r.each(["toggle","show","hide"],function(a,b){var c=r.fn[b];r.fn[b]=function(d,e,f){return null==d||"boolean"==typeof d||!a&&r.isFunction(d)&&r.isFunction(e)?c.apply(this,arguments):this.animate(M(b,!0),d,e,f)}});r.fn.extend({fadeTo:function(a,b,c,d){return this.filter(z).css("opacity",0).show().end().animate({opacity:b},
a,c,d)},animate:function(a,b,c,d){var e=r.isEmptyObject(a),f=r.speed(b,c,d);b=function(){var b=O(this,r.extend({},a),f);e&&b.stop(!0)};return e||!1===f.queue?this.each(b):this.queue(f.queue,b)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop;b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&!1!==a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=r.timers,g=r._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&fc.test(c)&&e(g[c]);
for(c=f.length;c--;)f[c].elem!==this||null!=a&&f[c].queue!==a||(f[c].anim.stop(d),b=!1,f.splice(c,1));!b&&d||r.dequeue(this,a)})}});r.each({slideDown:M("show"),slideUp:M("hide"),slideToggle:M("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){r.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}});r.speed=function(a,b,c){var d=a&&"object"==typeof a?r.extend({},a):{complete:c||!c&&b||r.isFunction(a)&&a,duration:a,easing:c&&b||b&&!r.isFunction(b)&&
b};d.duration=r.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in r.fx.speeds?r.fx.speeds[d.duration]:r.fx.speeds._default;if(null==d.queue||!0===d.queue)d.queue="fx";return d.old=d.complete,d.complete=function(){r.isFunction(d.old)&&d.old.call(this);d.queue&&r.dequeue(this,d.queue)},d};r.easing={linear:function(a){return a},swing:function(a){return 0.5-Math.cos(a*Math.PI)/2}};r.timers=[];r.fx=N.prototype.init;r.fx.tick=function(){for(var a,b=r.timers,c=0;c<b.length;c++)a=b[c],!a()&&b[c]===
a&&b.splice(c--,1);b.length||r.fx.stop()};r.fx.timer=function(a){a()&&r.timers.push(a)&&!wb&&(wb=setInterval(r.fx.tick,r.fx.interval))};r.fx.interval=13;r.fx.stop=function(){clearInterval(wb);wb=null};r.fx.speeds={slow:600,fast:200,_default:400};r.fx.step={};r.expr&&r.expr.filters&&(r.expr.filters.animated=function(a){return r.grep(r.timers,function(b){return a===b.elem}).length});var Qb=/^(?:body|html)$/i;r.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){r.offset.setOffset(this,
a,b)});var c,d,e,f,g,k,l,m,n,p,q=this[0],K=q&&q.ownerDocument;if(K)return(e=K.body)===q?r.offset.bodyOffset(q):(d=K.documentElement,r.contains(d,q)?(c=q.getBoundingClientRect(),f=R(K),g=d.clientTop||e.clientTop||0,k=d.clientLeft||e.clientLeft||0,l=f.pageYOffset||d.scrollTop,m=f.pageXOffset||d.scrollLeft,n=c.top+l-g,p=c.left+m-k,{top:n,left:p}):{top:0,left:0})};r.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return r.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(r.css(a,
"marginTop"))||0,c+=parseFloat(r.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=r.css(a,"position");"static"===d&&(a.style.position="relative");var e=r(a),f=e.offset(),g=r.css(a,"top"),k=r.css(a,"left"),l={},m={},n,p;("absolute"===d||"fixed"===d)&&-1<r.inArray("auto",[g,k])?(m=e.position(),n=m.top,p=m.left):(n=parseFloat(g)||0,p=parseFloat(k)||0);r.isFunction(b)&&(b=b.call(a,c,f));null!=b.top&&(l.top=b.top-f.top+n);null!=b.left&&(l.left=b.left-f.left+p);"using"in b?b.using.call(a,
l):e.css(l)}};r.fn.extend({position:function(){if(this[0]){var a=this[0],b=this.offsetParent(),c=this.offset(),d=Qb.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(r.css(a,"marginTop"))||0,c.left-=parseFloat(r.css(a,"marginLeft"))||0,d.top+=parseFloat(r.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(r.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||L.body;a&&!Qb.test(a.nodeName)&&
"static"===r.css(a,"position");)a=a.offsetParent;return a||L.body})}});r.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);r.fn[a]=function(e){return r.access(this,function(a,e,f){var g=R(a);if(f===b)return g?c in g?g[c]:g.document.documentElement[e]:a[e];g?g.scrollTo(d?r(g).scrollLeft():f,d?f:r(g).scrollTop()):a[e]=f},a,e,arguments.length,null)}});r.each({Height:"height",Width:"width"},function(a,c){r.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,
e){r.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),k=d||(!0===e||!0===f?"margin":"border");return r.access(this,function(c,d,e){var f;return r.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?r.css(c,d,e,k):r.style(c,d,e,k)},c,g?e:b,g)}})});a.jQuery=a.$=r;"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return r})})(window);(function(a){var b=/[\.\/]/,c=function(){},d=function(a,b){return a-b},e,f,g={n:{}},k=function(a,b){var c=f,g=Array.prototype.slice.call(arguments,2),q=k.listeners(a),u=0,v,y=[],z={},x=[];e=a;for(var B=f=0,A=q.length;B<A;B++)"zIndex"in q[B]&&(y.push(q[B].zIndex),0>q[B].zIndex&&(z[q[B].zIndex]=q[B]));for(y.sort(d);0>y[u];)if(v=z[y[u++]],x.push(v.apply(b,g)),f)return f=c,x;for(B=0;B<A;B++)if(v=q[B],"zIndex"in v)if(v.zIndex==y[u]){x.push(v.apply(b,g));if(f)return f=c,x;do if(u++,(v=z[y[u]])&&x.push(v.apply(b,
g)),f)return f=c,x;while(v)}else z[v.zIndex]=v;else if(x.push(v.apply(b,g)),f)return f=c,x;f=c;return x.length?x:null};k.listeners=function(a){a=a.split(b);var c=g,d,e,f,k,v,y,z,x=[c],B=[];f=0;for(k=a.length;f<k;f++){z=[];v=0;for(y=x.length;v<y;v++)for(c=x[v].n,d=[c[a[f]],c["*"]],e=2;e--;)(c=d[e])&&(z.push(c),B=B.concat(c.f||[]));x=z}return B};k.on=function(a,d){for(var e=a.split(b),f=g,k=0,u=e.length;k<u;k++)f=f.n,!f[e[k]]&&(f[e[k]]={n:{}}),f=f[e[k]];f.f=f.f||[];k=0;for(u=f.f.length;k<u;k++)if(f.f[k]==
d)return c;f.f.push(d);return function(a){+a==+a&&(d.zIndex=+a)}};k.stop=function(){f=1};k.nt=function(a){return a?RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(e):e};k.unbind=function(a,c){for(var d=a.split(b),e,f,k,v=[g],y=0,z=d.length;y<z;y++)for(var x=0;x<v.length;x+=k.length-2){k=[x,1];e=v[x].n;if("*"!=d[y])e[d[y]]&&k.push(e[d[y]]);else for(f in e)e.hasOwnProperty(f)&&k.push(e[f]);v.splice.apply(v,k)}y=0;for(z=v.length;y<z;y++)for(e=v[y];e.n;){if(c){if(e.f){x=0;for(jj=e.f.length;x<jj;x++)if(e.f[x]==
c){e.f.splice(x,1);break}!e.f.length&&delete e.f}for(f in e.n)if(e.n.hasOwnProperty(f)&&e.n[f].f){d=e.n[f].f;x=0;for(jj=d.length;x<jj;x++)if(d[x]==c){d.splice(x,1);break}!d.length&&delete e.n[f].f}}else for(f in delete e.f,e.n)e.n.hasOwnProperty(f)&&e.n[f].f&&delete e.n[f].f;e=e.n}};k.version="0.3.2";k.toString=function(){return"You are running Eve 0.3.2"};"undefined"!=typeof module&&module.exports?module.exports=k:a.eve=k})(this);
(function(){function a(a,b,d,f,g,k){d=Z(d);var m,p,q,r,v,x,y=a.ms,z={},H={},I={};if(f)for(A=0,x=ba.length;A<x;A++){var B=ba[A];if(B.el.id==b.id&&B.anim==a){B.percent!=d?(ba.splice(A,1),q=1):p=B;b.attr(B.totalOrigin);break}}else f=+H;var A=0;for(x=a.percents.length;A<x;A++){if(a.percents[A]==d||a.percents[A]>f*a.top){d=a.percents[A];v=a.percents[A-1]||0;y=y/a.top*(d-v);r=a.percents[A+1];m=a.anim[d];break}f&&b.attr(a.anim[a.percents[A]])}if(m){if(p)p.initstatus=f,p.start=new Date-p.ms*f;else{for(attr in m)if(m[u](attr)&&
(Ma[u](attr)||b.paper.customAttributes[u](attr)))switch(z[attr]=b.attr(attr),null==z[attr]&&(z[attr]=Ca[attr]),H[attr]=m[attr],Ma[attr]){case U:I[attr]=(H[attr]-z[attr])/y;break;case "colour":z[attr]=l.getRGB(z[attr]);A=l.getRGB(H[attr]);I[attr]={r:(A.r-z[attr].r)/y,g:(A.g-z[attr].g)/y,b:(A.b-z[attr].b)/y};break;case "path":A=ya(z[attr],H[attr]);B=A[1];z[attr]=A[0];I[attr]=[];A=0;for(x=z[attr].length;A<x;A++){I[attr][A]=[0];for(var P=1,E=z[attr][A].length;P<E;P++)I[attr][A][P]=(B[A][P]-z[attr][A][P])/
y}break;case "transform":A=b._;if(x=zb(A[attr],H[attr]))for(z[attr]=x.from,H[attr]=x.to,I[attr]=[],I[attr].real=!0,A=0,x=z[attr].length;A<x;A++)for(I[attr][A]=[z[attr][A][0]],P=1,E=z[attr][A].length;P<E;P++)I[attr][A][P]=(H[attr][A][P]-z[attr][A][P])/y;else x=b.matrix||new e,A={_:{transform:A.transform},getBBox:function(){return b.getBBox(1)}},z[attr]=[x.a,x.b,x.c,x.d,x.e,x.f],yb(A,H[attr]),H[attr]=A._.transform,I[attr]=[(A.matrix.a-x.a)/y,(A.matrix.b-x.b)/y,(A.matrix.c-x.c)/y,(A.matrix.d-x.d)/y,
(A.matrix.e-x.e)/y,(A.matrix.e-x.f)/y];break;case "csv":x=C(m[attr])[F](n);B=C(z[attr])[F](n);if("clip-rect"==attr)for(z[attr]=B,I[attr]=[],A=B.length;A--;)I[attr][A]=(x[A]-z[attr][A])/y;H[attr]=x;break;default:for(x=[][D](m[attr]),B=[][D](z[attr]),I[attr]=[],A=b.paper.customAttributes[attr].length;A--;)I[attr][A]=((x[A]||0)-(B[A]||0))/y}x=m.easing;A=l.easing_formulas[x];if(!A)if((A=C(x).match(ia))&&5==A.length)var J=A,A=function(a){return c(a,+J[1],+J[2],+J[3],+J[4],y)};else A=Ab;x=m.start||a.start||
+new Date;B={anim:a,percent:d,timestamp:x,start:x+(a.del||0),status:0,initstatus:f||0,stop:!1,ms:y,easing:A,from:z,diff:I,to:H,el:b,callback:m.callback,prev:v,next:r,repeat:k||a.times,origin:b.attr(),totalOrigin:g};ba.push(B);if(f&&!p&&!q&&(B.stop=!0,B.start=new Date-y*f,1==ba.length))return bb();q&&(B.start=new Date-B.ms*f);1==ba.length&&sb(bb)}eve("anim.start."+b.id,b,a)}}function b(a,b){var c=[],d={};this.ms=b;this.times=1;if(a){for(var e in a)a[u](e)&&(d[Z(e)]=a[e],c.push(Z(e)));c.sort(lb)}this.anim=
d;this.top=c[c.length-1];this.percents=c}function c(a,b,c,d,e,f){function g(a,b){var c,d,e,f;e=a;for(d=0;8>d;d++){f=((m*e+l)*e+k)*e-a;if(N(f)<b)return e;c=(3*m*e+2*l)*e+k;if(1E-6>N(c))break;e-=f/c}c=0;d=1;e=a;if(e<c)return c;if(e>d)return d;for(;c<d;){f=((m*e+l)*e+k)*e;if(N(f-a)<b)break;a>f?c=e:d=e;e=(d-c)/2+c}return e}var k=3*b,l=3*(d-b)-k,m=1-k-l,n=3*c,p=3*(e-c)-n,q=1-n-p;return function(a,b){var c=g(a,b);return((q*c+p)*c+n)*c}(a,1/(200*f))}function d(){return this.x+G+this.y+G+this.width+" \u00d7 "+
this.height}function e(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function f(a){for(var b=[],c=0,d=a.length;d-2>c;c+=2){var e=[{x:+a[c],y:+a[c+1]},{x:+a[c],y:+a[c+1]},{x:+a[c+2],y:+a[c+3]},{x:+a[c+4],y:+a[c+5]}];d-4==c?(e[0]={x:+a[c-2],y:+a[c-1]},e[3]=e[2]):c&&(e[0]={x:+a[c-2],y:+a[c-1]});b.push(["C",(-e[0].x+6*e[1].x+e[2].x)/6,(-e[0].y+6*e[1].y+e[2].y)/6,(e[1].x+6*e[2].x-e[3].x)/6,(e[1].y+6*e[2].y-e[3].y)/
6,e[2].x,e[2].y])}return b}function g(){return this.hex}function k(a,b,c){function d(){var e=Array.prototype.slice.call(arguments,0),f=e.join("\u2400"),g=d.cache=d.cache||{},k=d.count=d.count||[];if(g[u](f)){a:for(var e=k,k=f,l=0,m=e.length;l<m;l++)if(e[l]===k){e.push(e.splice(l,1)[0]);break a}return c?c(g[f]):g[f]}1E3<=k.length&&delete g[k.shift()];k.push(f);g[f]=a[A](b,e);return c?c(g[f]):g[f]}return d}function l(a){if(l.is(a,"function"))return m?a():eve.on("DOMload",a);if(l.is(a,S)){for(var b=
a,c=l._engine.create[A](l,b.splice(0,3+l.is(b[0],U))),d=c.set(),e=0,f=b.length,g;e<f;e++)g=b[e]||{},p[u](g.type)&&d.push(c[g.type]().attr(g));return d}var k=Array.prototype.slice.call(arguments,0);if(l.is(k[k.length-1],"function")){var n=k.pop();return m?n.call(l._engine.create[A](l,k)):eve.on("DOMload",function(){n.call(l._engine.create[A](l,k))})}return l._engine.create[A](l,arguments)}l.version="2.0.0";l.eve=eve;var m,n=/[, ]+/,p={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},q=/\{(\d+)\}/g,
u="hasOwnProperty",v={doc:document,win:window},y=Object.prototype[u].call(v.win,"Raphael"),z=v.win.Raphael,x=function(){this.ca=this.customAttributes={}},B,A="apply",D="concat",E="createTouch"in v.doc,G=" ",C=String,F="split",I="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[F](G),H={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},P=C.prototype.toLowerCase,J=Math,O=J.max,Q=J.min,N=J.abs,M=J.pow,R=J.PI,U="number",S="array",
L=Object.prototype.toString;l._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i;var pa=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,sa={NaN:1,Infinity:1,"-Infinity":1},ia=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,oa=J.round,Z=parseFloat,
fa=parseInt,ja=C.prototype.toUpperCase,Ca=l._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,
"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},Ma=l._availableAnimAttrs={blur:U,"clip-rect":"csv",cx:U,cy:U,fill:"colour","fill-opacity":U,"font-size":U,height:U,opacity:U,path:"path",r:U,rx:U,ry:U,stroke:"colour","stroke-opacity":U,"stroke-width":U,transform:"transform",width:U,x:U,y:U},Ra=/\s*,\s*/,r={hs:1,rg:1},Sa=/,?([achlmqrstvxz]),?/gi,jb=/([achlmrqstvz])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,za=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,
kb=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)\s*,?\s*/ig;l._radial_gradient=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/;var Na={},lb=function(a,b){return Z(a)-Z(b)},Bb=function(){},Ab=function(a){return a},Aa=l._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},V=function(a,b,c,d){null==d&&(d=c);return[["M",a,b],["m",0,-d],
["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},wa=l._getPath={path:function(a){return a.attr("path")},circle:function(a){a=a.attrs;return V(a.cx,a.cy,a.r)},ellipse:function(a){a=a.attrs;return V(a.cx,a.cy,a.rx,a.ry)},rect:function(a){a=a.attrs;return Aa(a.x,a.y,a.width,a.height,a.r)},image:function(a){a=a.attrs;return Aa(a.x,a.y,a.width,a.height)},text:function(a){a=a._getBBox();return Aa(a.x,a.y,a.width,a.height)}},Ga=l.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g;a=ya(a);e=0;for(ii=
a.length;e<ii;e++)for(g=a[e],f=1,jj=g.length;f<jj;f+=2)c=b.x(g[f],g[f+1]),d=b.y(g[f],g[f+1]),g[f]=c,g[f+1]=d;return a};l._g=v;l.type=v.win.SVGAngle||v.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if("VML"==l.type){var W=v.doc.createElement("div"),da;W.innerHTML='<v:shape adj="1"/>';da=W.firstChild;da.style.behavior="url(#default#VML)";if(!da||"object"!=typeof da.adj)return l.type="";W=null}l.svg=!(l.vml="VML"==l.type);l._Paper=x;l.fn=B=x.prototype=
l.prototype;l._id=0;l._oid=0;l.is=function(a,b){b=P.call(b);return"finite"==b?!sa[u](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||L.call(a).slice(8,-1).toLowerCase()==b};l.angle=function(a,b,c,d,e,f){return null==e?(a-=c,b-=d,a||b?(180*J.atan2(-b,-a)/R+540)%360:0):l.angle(a,b,e,f)-l.angle(c,d,e,f)};l.rad=function(a){return a%360*R/180};l.deg=function(a){return 180*a/R%360};l.snapTo=function(a,
b,c){c=l.is(c,"finite")?c:10;if(l.is(a,S))for(var d=a.length;d--;){if(N(a[d]-b)<=c)return a[d]}else{a=+a;d=b%a;if(d<c)return b-d;if(d>a-c)return b-d+a}return b};l.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=16*J.random()|0;return("x"==a?b:b&3|8).toString(16)});l.setWindow=function(a){eve("setWindow",l,v.win,a);v.win=a;v.doc=v.win.document;initWin&&initWin(v.win)};var va=function(a){if(l.vml){var b=/^\s+|\s+$/g,
c;try{var d=new ActiveXObject("htmlfile");d.write("<body>");d.close();c=d.body}catch(e){c=createPopup().document.body}var f=c.createTextRange();va=k(function(a){try{c.style.color=C(a).replace(b,"");var d=f.queryCommandValue("ForeColor");return"#"+("000000"+((d&255)<<16|d&65280|(d&16711680)>>>16).toString(16)).slice(-6)}catch(e){return"none"}})}else{var g=v.doc.createElement("i");g.title="Rapha\u00ebl Colour Picker";g.style.display="none";v.doc.body.appendChild(g);va=k(function(a){g.style.color=a;
return v.doc.defaultView.getComputedStyle(g,"").getPropertyValue("color")})}return va(a)},Ha=function(){return"hsb("+[this.h,this.s,this.b]+")"},ua=function(){return"hsl("+[this.h,this.s,this.l]+")"},ea=function(){return this.hex},la=function(a,b,c){null==b&&l.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(c=a.b,b=a.g,a=a.r);null==b&&l.is(a,"string")&&(c=l.getRGB(a),a=c.r,b=c.g,c=c.b);if(1<a||1<b||1<c)a/=255,b/=255,c/=255;return[a,b,c]},Ea=function(a,b,c,d){a*=255;b*=255;c*=255;a={r:a,g:b,b:c,hex:l.rgb(a,
b,c),toString:ea};l.is(d,"finite")&&(a.opacity=d);return a};l.color=function(a){var b;l.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=l.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):l.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=l.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(l.is(a,"string")&&(a=l.getRGB(a)),l.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=l.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=l.rgb2hsb(a),a.v=b.b):(a={hex:"none"},crl.r=a.g=a.b=a.h=a.s=a.v=a.l=-1));a.toString=ea;return a};l.hsb2rgb=
function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o);var e,f,g;a=360*a%360/60;g=c*b;b=g*(1-N(a%2-1));c=e=f=c-g;a=~~a;c+=[g,b,0,0,b,g][a];e+=[b,g,g,b,0,0][a];f+=[0,0,b,g,g,b][a];return Ea(c,e,f,d)};l.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h);if(1<a||1<b||1<c)a/=360,b/=100,c/=100;var e,f,g;a=360*a%360/60;g=2*b*(0.5>c?c:1-c);b=g*(1-N(a%2-1));c=e=f=c-g/2;a=~~a;c+=[g,b,0,0,b,g][a];e+=[b,g,g,b,0,0][a];f+=[0,0,b,g,
g,b][a];return Ea(c,e,f,d)};l.rgb2hsb=function(a,b,c){c=la(a,b,c);a=c[0];b=c[1];c=c[2];var d,e;d=O(a,b,c);e=d-Q(a,b,c);a=((0==e?0:d==a?(b-c)/e:d==b?(c-a)/e+2:(a-b)/e+4)+360)%6*60/360;return{h:a,s:0==e?0:e/d,b:d,toString:Ha}};l.rgb2hsl=function(a,b,c){c=la(a,b,c);a=c[0];b=c[1];c=c[2];var d,e,f;d=O(a,b,c);e=Q(a,b,c);f=d-e;a=((0==f?0:d==a?(b-c)/f:d==b?(c-a)/f+2:(a-b)/f+4)+360)%6*60/360;d=(d+e)/2;return{h:a,s:0==f?0:0.5>d?f/(2*d):f/(2-2*d),l:d,toString:ua}};l._path2string=function(){return this.join(",").replace(Sa,
"$1")};l._preload=function(a,b){var c=v.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top-9999em";c.onload=function(){b.call(this);this.onload=null;v.doc.body.removeChild(this)};c.onerror=function(){v.doc.body.removeChild(this)};v.doc.body.appendChild(c);c.src=a};l.getRGB=k(function(a){if(!a||(a=C(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:g};!r[u](a.toLowerCase().substring(0,2))&&"#"!=a.charAt()&&
(a=va(a));var b,c,d,e,f,k;if(a=a.match(pa)){a[2]&&(d=fa(a[2].substring(5),16),c=fa(a[2].substring(3,5),16),b=fa(a[2].substring(1,3),16));a[3]&&(d=fa((f=a[3].charAt(3))+f,16),c=fa((f=a[3].charAt(2))+f,16),b=fa((f=a[3].charAt(1))+f,16));a[4]&&(k=a[4][F](Ra),b=Z(k[0]),"%"==k[0].slice(-1)&&(b*=2.55),c=Z(k[1]),"%"==k[1].slice(-1)&&(c*=2.55),d=Z(k[2]),"%"==k[2].slice(-1)&&(d*=2.55),"rgba"==a[1].toLowerCase().slice(0,4)&&(e=Z(k[3])),k[3]&&"%"==k[3].slice(-1)&&(e/=100));if(a[5])return k=a[5][F](Ra),b=Z(k[0]),
"%"==k[0].slice(-1)&&(b*=2.55),c=Z(k[1]),"%"==k[1].slice(-1)&&(c*=2.55),d=Z(k[2]),"%"==k[2].slice(-1)&&(d*=2.55),"deg"!=k[0].slice(-3)&&"\u00b0"!=k[0].slice(-1)||(b/=360),"hsba"==a[1].toLowerCase().slice(0,4)&&(e=Z(k[3])),k[3]&&"%"==k[3].slice(-1)&&(e/=100),l.hsb2rgb(b,c,d,e);if(a[6])return k=a[6][F](Ra),b=Z(k[0]),"%"==k[0].slice(-1)&&(b*=2.55),c=Z(k[1]),"%"==k[1].slice(-1)&&(c*=2.55),d=Z(k[2]),"%"==k[2].slice(-1)&&(d*=2.55),"deg"!=k[0].slice(-3)&&"\u00b0"!=k[0].slice(-1)||(b/=360),"hsla"==a[1].toLowerCase().slice(0,
4)&&(e=Z(k[3])),k[3]&&"%"==k[3].slice(-1)&&(e/=100),l.hsl2rgb(b,c,d,e);a={r:b,g:c,b:d,toString:g};a.hex="#"+(16777216|d|c<<8|b<<16).toString(16).slice(1);l.is(e,"finite")&&(a.opacity=e);return a}return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g}},l);l.hsb=k(function(a,b,c){return l.hsb2rgb(a,b,c).hex});l.hsl=k(function(a,b,c){return l.hsl2rgb(a,b,c).hex});l.rgb=k(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)});l.getColor=function(a){a=this.getColor.start=this.getColor.start||
{h:0,s:1,b:a||0.75};var b=this.hsb2rgb(a.h,a.s,a.b);a.h+=0.075;1<a.h&&(a.h=0,a.s-=0.2,0>=a.s&&(this.getColor.start={h:0,s:1,b:a.b}));return b.hex};l.getColor.reset=function(){delete this.start};l.parsePathString=k(function(a){if(!a)return null;var b={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},c=[];l.is(a,S)&&l.is(a[0],S)&&(c=Da(a));c.length||C(a).replace(jb,function(a,d,e){var f=[];a=d.toLowerCase();e.replace(kb,function(a,b){b&&f.push(+b)});"m"==a&&2<f.length&&(c.push([d][D](f.splice(0,2))),a=
"l",d="m"==d?"l":"L");if("r"==a)c.push([d][D](f));else for(;f.length>=b[a]&&(c.push([d][D](f.splice(0,b[a]))),b[a]););});c.toString=l._path2string;return c});l.parseTransformString=k(function(a){if(!a)return null;var b=[];l.is(a,S)&&l.is(a[0],S)&&(b=Da(a));b.length||C(a).replace(za,function(a,c,d){var e=[];P.call(c);d.replace(kb,function(a,b){b&&e.push(+b)});b.push([c][D](e))});b.toString=l._path2string;return b});l.findDotsAtSegment=function(a,b,c,d,e,f,g,k,l){var m=1-l,n=M(m,3),p=M(m,2),q=l*l,u=
q*l,r=n*a+3*p*l*c+3*m*l*l*e+u*g,n=n*b+3*p*l*d+3*m*l*l*f+u*k,p=a+2*l*(c-a)+q*(e-2*c+a),u=b+2*l*(d-b)+q*(f-2*d+b),F=c+2*l*(e-c)+q*(g-2*e+c),q=d+2*l*(f-d)+q*(k-2*f+d);a=m*a+l*c;b=m*b+l*d;e=m*e+l*g;f=m*f+l*k;k=90-180*J.atan2(p-F,u-q)/R;(p>F||u<q)&&(k+=180);return{x:r,y:n,m:{x:p,y:u},n:{x:F,y:q},start:{x:a,y:b},end:{x:e,y:f},alpha:k}};var Fa=k(function(a){if(!a)return{x:0,y:0,width:0,height:0};a=ya(a);for(var b=0,c=0,d=[],e=[],f,g=0,k=a.length;g<k;g++)f=a[g],"M"==f[0]?(b=f[1],c=f[2],d.push(b),e.push(c)):
(b=hb(b,c,f[1],f[2],f[3],f[4],f[5],f[6]),d=d[D](b.min.x,b.max.x),e=e[D](b.min.y,b.max.y),b=f[5],c=f[6]);a=Q[A](0,d);f=Q[A](0,e);return{x:a,y:f,width:O[A](0,d)-a,height:O[A](0,e)-f}},null,function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}}),Da=function(a){var b=[];l.is(a,S)&&l.is(a&&a[0],S)||(a=l.parsePathString(a));for(var c=0,d=a.length;c<d;c++){b[c]=[];for(var e=0,f=a[c].length;e<f;e++)b[c][e]=a[c][e]}b.toString=l._path2string;return b},xb=l._pathToRelative=k(function(a){l.is(a,S)&&l.is(a&&
a[0],S)||(a=l.parsePathString(a));var b=[],c=0,d=0,e=0,f=0,g=0;"M"==a[0][0]&&(c=a[0][1],d=a[0][2],e=c,f=d,g++,b.push(["M",c,d]));for(var k=a.length;g<k;g++){var m=b[g]=[],n=a[g];if(n[0]!=P.call(n[0]))switch(m[0]=P.call(n[0]),m[0]){case "a":m[1]=n[1];m[2]=n[2];m[3]=n[3];m[4]=n[4];m[5]=n[5];m[6]=+(n[6]-c).toFixed(3);m[7]=+(n[7]-d).toFixed(3);break;case "v":m[1]=+(n[1]-d).toFixed(3);break;case "m":e=n[1],f=n[2];default:for(var p=1,q=n.length;p<q;p++)m[p]=+(n[p]-(p%2?c:d)).toFixed(3)}else for(b[g]=[],
"m"==n[0]&&(e=n[1]+c,f=n[2]+d),m=0,p=n.length;m<p;m++)b[g][m]=n[m];n=b[g].length;switch(b[g][0]){case "z":c=e;d=f;break;case "h":c+=+b[g][n-1];break;case "v":d+=+b[g][n-1];break;default:c+=+b[g][n-2],d+=+b[g][n-1]}}b.toString=l._path2string;return b},0,Da),eb=l._pathToAbsolute=k(function(a){l.is(a,S)&&l.is(a&&a[0],S)||(a=l.parsePathString(a));if(!a||!a.length)return[["M",0,0]];var b=[],c=0,d=0,e=0,g=0,k=0;"M"==a[0][0]&&(c=+a[0][1],d=+a[0][2],e=c,g=d,k++,b[0]=["M",c,d]);for(var m,n=k,p=a.length;n<
p;n++){b.push(k=[]);m=a[n];if(m[0]!=ja.call(m[0]))switch(k[0]=ja.call(m[0]),k[0]){case "A":k[1]=m[1];k[2]=m[2];k[3]=m[3];k[4]=m[4];k[5]=m[5];k[6]=+(m[6]+c);k[7]=+(m[7]+d);break;case "V":k[1]=+m[1]+d;break;case "H":k[1]=+m[1]+c;break;case "R":for(var q=[c,d][D](m.slice(1)),u=2,r=q.length;u<r;u++)q[u]=+q[u]+c,q[++u]=+q[u]+d;b.pop();b=b[D](f(q));break;case "M":e=+m[1]+c,g=+m[2]+d;default:for(u=1,r=m.length;u<r;u++)k[u]=+m[u]+(u%2?c:d)}else if("R"==m[0])q=[c,d][D](m.slice(1)),b.pop(),b=b[D](f(q)),k=["R"][D](m.slice(-2));
else for(q=0,u=m.length;q<u;q++)k[q]=m[q];switch(k[0]){case "Z":c=e;d=g;break;case "H":c=k[1];break;case "V":d=k[1];break;case "M":e=k[k.length-2],g=k[k.length-1];default:c=k[k.length-2],d=k[k.length-1]}}b.toString=l._path2string;return b},null,Da),fb=function(a,b,c,d,e,f){var g=1/3,k=2/3;return[g*a+k*c,g*b+k*d,g*e+k*c,g*f+k*d,e,f]},gb=function(a,b,c,d,e,f,g,l,m,n){var p=120*R/180,q=R/180*(+e||0),u=[],r,v=k(function(a,b,c){var d=a*J.cos(c)-b*J.sin(c);a=a*J.sin(c)+b*J.cos(c);return{x:d,y:a}});if(n)C=
n[0],r=n[1],f=n[2],x=n[3];else{r=v(a,b,-q);a=r.x;b=r.y;r=v(l,m,-q);l=r.x;m=r.y;J.cos(R/180*e);J.sin(R/180*e);r=(a-l)/2;C=(b-m)/2;x=r*r/(c*c)+C*C/(d*d);1<x&&(x=J.sqrt(x),c*=x,d*=x);var x=c*c,y=d*d,x=(f==g?-1:1)*J.sqrt(N((x*y-x*C*C-y*r*r)/(x*C*C+y*r*r)));f=x*c*C/d+(a+l)/2;var x=x*-d*r/c+(b+m)/2,C=J.asin(((b-x)/d).toFixed(9));r=J.asin(((m-x)/d).toFixed(9));C=a<f?R-C:C;r=l<f?R-r:r;0>C&&(C=2*R+C);0>r&&(r=2*R+r);g&&C>r&&(C-=2*R);!g&&r>C&&(r-=2*R)}if(N(r-C)>p){var u=r,y=l,z=m;r=C+p*(g&&r>C?1:-1);l=f+c*J.cos(r);
m=x+d*J.sin(r);u=gb(l,m,c,d,e,0,g,y,z,[r,u,f,x])}f=r-C;e=J.cos(C);p=J.sin(C);g=J.cos(r);r=J.sin(r);f=J.tan(f/4);c=4/3*c*f;f*=4/3*d;d=[a,b];a=[a+c*p,b-f*e];b=[l+c*r,m-f*g];l=[l,m];a[0]=2*d[0]-a[0];a[1]=2*d[1]-a[1];if(n)return[a,b,l][D](u);u=[a,b,l][D](u).join()[F](",");n=[];l=0;for(m=u.length;l<m;l++)n[l]=l%2?v(u[l-1],u[l],q).y:v(u[l],u[l+1],q).x;return n},Ja=function(a,b,c,d,e,f,g,k,l){var m=1-l;return{x:M(m,3)*a+3*M(m,2)*l*c+3*m*l*l*e+M(l,3)*g,y:M(m,3)*b+3*M(m,2)*l*d+3*m*l*l*f+M(l,3)*k}},hb=k(function(a,
b,c,d,e,f,g,k){var l=e-2*c+a-(g-2*e+c),m=2*(c-a)-2*(e-c),n=a-c,p=(-m+J.sqrt(m*m-4*l*n))/2/l,l=(-m-J.sqrt(m*m-4*l*n))/2/l,q=[b,k],r=[a,g],u;"1e12"<N(p)&&(p=0.5);"1e12"<N(l)&&(l=0.5);0<p&&1>p&&(u=Ja(a,b,c,d,e,f,g,k,p),r.push(u.x),q.push(u.y));0<l&&1>l&&(u=Ja(a,b,c,d,e,f,g,k,l),r.push(u.x),q.push(u.y));l=f-2*d+b-(k-2*f+d);m=2*(d-b)-2*(f-d);n=b-d;p=(-m+J.sqrt(m*m-4*l*n))/2/l;l=(-m-J.sqrt(m*m-4*l*n))/2/l;"1e12"<N(p)&&(p=0.5);"1e12"<N(l)&&(l=0.5);0<p&&1>p&&(u=Ja(a,b,c,d,e,f,g,k,p),r.push(u.x),q.push(u.y));
0<l&&1>l&&(u=Ja(a,b,c,d,e,f,g,k,l),r.push(u.x),q.push(u.y));return{min:{x:Q[A](0,r),y:Q[A](0,q)},max:{x:O[A](0,r),y:O[A](0,q)}}}),ya=l._path2curve=k(function(a,b){var c=eb(a),d=b&&eb(b),e={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g=function(a,b){var c,d;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];a[0]in{T:1,Q:1}||(b.qx=b.qy=null);switch(a[0]){case "M":b.X=a[1];b.Y=a[2];break;case "A":a=["C"][D](gb[A](0,[b.x,b.y][D](a.slice(1))));break;case "S":c=b.x+(b.x-
(b.bx||b.x));d=b.y+(b.y-(b.by||b.y));a=["C",c,d][D](a.slice(1));break;case "T":b.qx=b.x+(b.x-(b.qx||b.x));b.qy=b.y+(b.y-(b.qy||b.y));a=["C"][D](fb(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case "Q":b.qx=a[1];b.qy=a[2];a=["C"][D](fb(b.x,b.y,a[1],a[2],a[3],a[4]));break;case "L":a=["C"][D]([b.x,b.y,a[1],a[2],a[1],a[2]]);break;case "H":a=["C"][D]([b.x,b.y,a[1],b.y,a[1],b.y]);break;case "V":a=["C"][D]([b.x,b.y,b.x,a[1],b.x,a[1]]);break;case "Z":a=["C"][D]([b.x,b.y,b.X,b.Y,b.X,b.Y])}return a},k=function(a,b){if(7<
a[b].length){a[b].shift();for(var e=a[b];e.length;)a.splice(b++,0,["C"][D](e.splice(0,6)));a.splice(b,1);n=O(c.length,d&&d.length||0)}},l=function(a,b,e,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),e.bx=0,e.by=0,e.x=a[g][1],e.y=a[g][2],n=O(c.length,d&&d.length||0))},m=0,n=O(c.length,d&&d.length||0);for(;m<n;m++){c[m]=g(c[m],e);k(c,m);d&&(d[m]=g(d[m],f));d&&k(d,m);l(c,d,e,f,m);l(d,c,f,e,m);var p=c[m],q=d&&d[m],r=p.length,u=d&&q.length;e.x=p[r-2];e.y=p[r-1];e.bx=Z(p[r-4])||e.x;
e.by=Z(p[r-3])||e.y;f.bx=d&&(Z(q[u-4])||f.x);f.by=d&&(Z(q[u-3])||f.y);f.x=d&&q[u-2];f.y=d&&q[u-1]}return d?[c,d]:c},null,Da);l._parseDots=k(function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e={},f=a[c].match(/^([^:]*):?([\d\.]*)/);e.color=l.getRGB(f[1]);if(e.color.error)return null;e.color=e.color.hex;f[2]&&(e.offset=f[2]+"%");b.push(e)}c=1;for(d=b.length-1;c<d;c++)if(!b[c].offset){a=Z(b[c-1].offset||0);f=0;for(e=c+1;e<d;e++)if(b[e].offset){f=b[e].offset;break}f||(f=100,e=d);f=Z(f);for(f=(f-a)/
(e-c+1);c<e;c++)a+=f,b[c].offset=a+"%"}return b});var Ka=l._tear=function(a,b){a==b.top&&(b.top=a.prev);a==b.bottom&&(b.bottom=a.next);a.next&&(a.next.prev=a.prev);a.prev&&(a.prev.next=a.next)};l._tofront=function(a,b){b.top!==a&&(Ka(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)};l._toback=function(a,b){b.bottom!==a&&(Ka(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)};l._insertafter=function(a,b,c){Ka(a,c);b==c.top&&(c.top=a);b.next&&(b.next.prev=a);a.next=b.next;a.prev=b;b.next=
a};l._insertbefore=function(a,b,c){Ka(a,c);b==c.bottom&&(c.bottom=a);b.prev&&(b.prev.next=a);a.prev=b.prev;b.prev=a;a.next=b};var yb=l._extractTransform=function(a,b){if(null==b)return a._.transform;b=C(b).replace(/\.{3}|\u2026/g,a._.transform||"");var c=l.parseTransformString(b),d=0,f=0,g=0,k=1,m=1,n=a._,g=new e;n.transform=c||[];if(c)for(var f=0,p=c.length;f<p;f++){var q=c[f],r=q.length,u=C(q[0]).toLowerCase(),F=q[0]!=u,v=F?g.invert():0,x,y,z,H,I;"t"==u&&3==r?F?(x=v.x(0,0),y=v.y(0,0),z=v.x(q[1],
q[2]),H=v.y(q[1],q[2]),g.translate(z-x,H-y)):g.translate(q[1],q[2]):"r"==u?2==r?(I=I||a.getBBox(1),g.rotate(q[1],I.x+I.width/2,I.y+I.height/2),d+=q[1]):4==r&&(F?(z=v.x(q[2],q[3]),H=v.y(q[2],q[3]),g.rotate(q[1],z,H)):g.rotate(q[1],q[2],q[3]),d+=q[1]):"s"==u?2==r||3==r?(I=I||a.getBBox(1),g.scale(q[1],q[r-1],I.x+I.width/2,I.y+I.height/2),k*=q[1],m*=q[r-1]):5==r&&(F?(z=v.x(q[3],q[4]),H=v.y(q[3],q[4]),g.scale(q[1],q[2],z,H)):g.scale(q[1],q[2],q[3],q[4]),k*=q[1],m*=q[2]):"m"==u&&7==r&&g.add(q[1],q[2],q[3],
q[4],q[5],q[6]);n.dirtyT=1;a.matrix=g}a.matrix=g;n.sx=k;n.sy=m;n.deg=d;n.dx=f=g.e;n.dy=g=g.f;1==k&&1==m&&!d&&n.bbox?(n.bbox.x+=+f,n.bbox.y+=+g):n.dirtyT=1},ib=function(a){var b=a[0];switch(b.toLowerCase()){case "t":return[b,0,0];case "m":return[b,1,0,0,1,0,0];case "r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case "s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},zb=l._equaliseTransform=function(a,b){b=C(b).replace(/\.{3}|\u2026/g,a);a=l.parseTransformString(a)||[];b=l.parseTransformString(b)||
[];for(var c=O(a.length,b.length),d=[],e=[],f=0,g,k,m,n;f<c;f++){m=a[f]||ib(b[f]);n=b[f]||ib(m);if(m[0]!=n[0]||"r"==m[0].toLowerCase()&&(m[2]!=n[2]||m[3]!=n[3])||"s"==m[0].toLowerCase()&&(m[3]!=n[3]||m[4]!=n[4]))return;d[f]=[];e[f]=[];g=0;for(k=O(m.length,n.length);g<k;g++)g in m&&(d[f][g]=m[g]),g in n&&(e[f][g]=n[g])}return{from:d,to:e}};l._getContainer=function(a,b,c,d){var e;e=null!=d||l.is(a,"object")?a:v.doc.getElementById(a);if(null!=e)return e.tagName?null==b?{container:e,width:e.style.pixelWidth||
e.offsetWidth,height:e.style.pixelHeight||e.offsetHeight}:{container:e,width:b,height:c}:{container:1,x:a,y:b,width:c,height:d}};l.pathToRelative=xb;l._engine={};l.path2curve=ya;l.matrix=function(a,b,c,d,f,g){return new e(a,b,c,d,f,g)};(function(a){function b(a){var d=J.sqrt(c(a));a[0]&&(a[0]/=d);a[1]&&(a[1]/=d)}function c(a){return a[0]*a[0]+a[1]*a[1]}a.add=function(a,b,c,d,f,g){var k=[[],[],[]],l=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]];b=[[a,c,f],[b,d,g],[0,0,1]];a&&a instanceof
e&&(b=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]);for(a=0;3>a;a++)for(c=0;3>c;c++){for(d=f=0;3>d;d++)f+=l[a][d]*b[d][c];k[a][c]=f}this.a=k[0][0];this.b=k[1][0];this.c=k[0][1];this.d=k[1][1];this.e=k[0][2];this.f=k[1][2]};a.invert=function(){var a=this.a*this.d-this.b*this.c;return new e(this.d/a,-this.b/a,-this.c/a,this.a/a,(this.c*this.f-this.d*this.e)/a,(this.b*this.e-this.a*this.f)/a)};a.clone=function(){return new e(this.a,this.b,this.c,this.d,this.e,this.f)};a.translate=function(a,b){this.add(1,0,
0,1,a,b)};a.scale=function(a,b,c,d){null==b&&(b=a);(c||d)&&this.add(1,0,0,1,c,d);this.add(a,0,0,b,0,0);(c||d)&&this.add(1,0,0,1,-c,-d)};a.rotate=function(a,b,c){a=l.rad(a);b=b||0;c=c||0;var d=+J.cos(a).toFixed(9);a=+J.sin(a).toFixed(9);this.add(d,a,-a,d,b,c);this.add(1,0,0,1,-b,-c)};a.x=function(a,b){return a*this.a+b*this.c+this.e};a.y=function(a,b){return a*this.b+b*this.d+this.f};a.get=function(a){return+this[C.fromCharCode(97+a)].toFixed(4)};a.toString=function(){return l.svg?"matrix("+[this.get(0),
this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};a.split=function(){var a={};a.dx=this.e;a.dy=this.f;var d=[[this.a,this.c],[this.b,
this.d]];a.scalex=J.sqrt(c(d[0]));b(d[0]);a.shear=d[0][0]*d[1][0]+d[0][1]*d[1][1];d[1]=[d[1][0]-d[0][0]*a.shear,d[1][1]-d[0][1]*a.shear];a.scaley=J.sqrt(c(d[1]));b(d[1]);a.shear/=a.scaley;var e=-d[0][1],d=d[1][1];0>d?(a.rotate=l.deg(J.acos(d)),0>e&&(a.rotate=360-a.rotate)):a.rotate=l.deg(J.asin(e));a.isSimple=!+a.shear.toFixed(9)&&(a.scalex.toFixed(9)==a.scaley.toFixed(9)||!a.rotate);a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate;a.noRotation=!+a.shear.toFixed(9)&&
!a.rotate;return a};a.toTransformString=function(a){a=a||this[F]();return a.isSimple?"t"+[a.dx,a.dy]+"s"+[a.scalex,a.scaley,0,0]+"r"+[a.rotate,0,0]:"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}})(e.prototype);var La=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);"Apple Computer, Inc."==navigator.vendor&&(La&&4>La[1]||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&La&&8>La[1]?B.safari=function(){var a=
this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:B.safari=Bb;for(var mb=function(){this.returnValue=!1},Eb=function(){return this.originalEvent.preventDefault()},Fb=function(){this.cancelBubble=!0},Cb=function(){return this.originalEvent.stopPropagation()},pb=function(){if(v.doc.addEventListener)return function(a,b,c,d){var e=E&&H[b]?H[b]:b,f=function(e){var f=e.clientX+(v.doc.documentElement.scrollLeft||v.doc.body.scrollLeft),g=e.clientY+(v.doc.documentElement.scrollTop||
v.doc.body.scrollTop);if(E&&H[u](b))for(var k=0,l=e.targetTouches&&e.targetTouches.length;k<l;k++)if(e.targetTouches[k].target==a){l=e;e=e.targetTouches[k];e.originalEvent=l;e.preventDefault=Eb;e.stopPropagation=Cb;break}return c.call(d,e,f,g)};a.addEventListener(e,f,!1);return function(){a.removeEventListener(e,f,!1);return!0}};if(v.doc.attachEvent)return function(a,b,c,d){var e=function(a){a=a||v.win.event;var b=a.clientX+(v.doc.documentElement.scrollLeft||v.doc.body.scrollLeft),e=a.clientY+(v.doc.documentElement.scrollTop||
v.doc.body.scrollTop);a.preventDefault=a.preventDefault||mb;a.stopPropagation=a.stopPropagation||Fb;return c.call(d,a,b,e)};a.attachEvent("on"+b,e);return function(){a.detachEvent("on"+b,e);return!0}}}(),qa=[],Ta=function(a){for(var b=a.clientX,c=a.clientY,d=v.doc.documentElement.scrollTop||v.doc.body.scrollTop,e=v.doc.documentElement.scrollLeft||v.doc.body.scrollLeft,f,g=qa.length;g--;){f=qa[g];if(E)for(var k=a.touches.length,l;k--;){if(l=a.touches[k],l.identifier==f.el._drag.id){b=l.clientX;c=l.clientY;
(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var k=f.el.node,m=k.nextSibling,n=k.parentNode,p=k.style.display;v.win.opera&&n.removeChild(k);k.style.display="none";l=f.el.paper.getElementByPoint(b,c);k.style.display=p;v.win.opera&&(m?n.insertBefore(k,m):n.appendChild(k));l&&eve("drag.over."+f.el.id,f.el,l);b+=e;c+=d;eve("drag.move."+f.el.id,f.move_scope||f.el,b-f.el._drag.x,c-f.el._drag.y,b,c,a)}},Za=function(a){l.unmousemove(Ta).unmouseup(Za);for(var b=qa.length,
c;b--;)c=qa[b],c.el._drag={},eve("drag.end."+c.el.id,c.end_scope||c.start_scope||c.move_scope||c.el,a);qa=[]},Y=l.el={},$a=I.length;$a--;)(function(a){l[a]=Y[a]=function(b,c){l.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:pb(this.shape||this.node||v.doc,a,b,c||this)}));return this};l["un"+a]=Y["un"+a]=function(b){for(var c=this.events,d=c.length;d--;)if(c[d].name==a&&c[d].f==b){c[d].unbind();c.splice(d,1);!c.length&&delete this.events;break}return this}})(I[$a]);
Y.data=function(a,b){var c=Na[this.id]=Na[this.id]||{};if(1==arguments.length){if(l.is(a,"object")){for(var d in a)a[u](d)&&this.data(d,a[d]);return this}eve("data.get."+this.id,this,c[a],a);return c[a]}c[a]=b;eve("data.set."+this.id,this,b,a);return this};Y.removeData=function(a){null==a?Na[this.id]={}:Na[this.id]&&delete Na[this.id][a];return this};Y.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)};Y.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};Y.drag=function(a,
b,c,d,e,f){this._drag={};this.mousedown(function(g){(g.originalEvent||g).preventDefault();var k=v.doc.documentElement.scrollTop||v.doc.body.scrollTop,m=v.doc.documentElement.scrollLeft||v.doc.body.scrollLeft;this._drag.x=g.clientX+m;this._drag.y=g.clientY+k;this._drag.id=g.identifier;!qa.length&&l.mousemove(Ta).mouseup(Za);qa.push({el:this,move_scope:d,start_scope:e,end_scope:f});b&&eve.on("drag.start."+this.id,b);a&&eve.on("drag.move."+this.id,a);c&&eve.on("drag.end."+this.id,c);eve("drag.start."+
this.id,e||d||this,g.clientX+m,g.clientY+k,g)});return this};Y.onDragOver=function(a){a?eve.on("drag.over."+this.id,a):eve.unbind("drag.over."+this.id)};Y.undrag=function(){for(var a=qa.length;a--;)qa[a].el==this&&(l.unmousedown(qa[a].start),qa.splice(a++,1),eve.unbind("drag.*."+this.id));!qa.length&&l.unmousemove(Ta).unmouseup(Za)};B.circle=function(a,b,c){a=l._engine.circle(this,a||0,b||0,c||0);this.__set__&&this.__set__.push(a);return a};B.rect=function(a,b,c,d,e){a=l._engine.rect(this,a||0,b||
0,c||0,d||0,e||0);this.__set__&&this.__set__.push(a);return a};B.ellipse=function(a,b,c,d){a=l._engine.ellipse(this,a||0,b||0,c||0,d||0);this.__set__&&this.__set__.push(a);return a};B.path=function(a){a&&!l.is(a,"string")&&!l.is(a[0],S)&&(a+="");var b=l._engine.path(l.format[A](l,arguments),this);this.__set__&&this.__set__.push(b);return b};B.image=function(a,b,c,d,e){a=l._engine.image(this,a||"about:blank",b||0,c||0,d||0,e||0);this.__set__&&this.__set__.push(a);return a};B.text=function(a,b,c){a=
l._engine.text(this,a||0,b||0,C(c));this.__set__&&this.__set__.push(a);return a};B.set=function(a){!l.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new Ba(a);this.__set__&&this.__set__.push(b);return b};B.setStart=function(a){this.__set__=a||this.set()};B.setFinish=function(a){a=this.__set__;delete this.__set__;return a};B.setSize=function(a,b){return l._engine.setSize.call(this,a,b)};B.setViewBox=function(a,b,c,d,e){return l._engine.setViewBox.call(this,a,b,c,
d,e)};B.top=B.bottom=null;B.raphael=l;B.getElementByPoint=function(a,b){var c,d,e=this.canvas,f=v.doc.elementFromPoint(a,b);if(v.win.opera&&"svg"==f.tagName){d=e.getBoundingClientRect();c=e.ownerDocument;var g=c.body,k=c.documentElement;c=d.top+(v.win.pageYOffset||k.scrollTop||g.scrollTop)-(k.clientTop||g.clientTop||0);d=d.left+(v.win.pageXOffset||k.scrollLeft||g.scrollLeft)-(k.clientLeft||g.clientLeft||0);g=e.createSVGRect();g.x=a-d;g.y=b-c;g.width=g.height=1;c=e.getIntersectionList(g,null);c.length&&
(f=c[c.length-1])}if(!f)return null;for(;f.parentNode&&f!=e.parentNode&&!f.raphael;)f=f.parentNode;f==this.canvas.parentNode&&(f=e);return f=f&&f.raphael?this.getById(f.raphaelid):null};B.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null};B.forEach=function(a,b){for(var c=this.bottom;c&&!1!==a.call(b,c);)c=c.next;return this};Y.getBBox=function(a){if(this.removed)return{};var b=this._;if(a){if(b.dirty||!b.bboxwt)this.realPath=wa[this.type](this),b.bboxwt=Fa(this.realPath),
b.bboxwt.toString=d,b.dirty=0;return b.bboxwt}if(b.dirty||b.dirtyT||!b.bbox){if(b.dirty||!this.realPath)b.bboxwt=0,this.realPath=wa[this.type](this);b.bbox=Fa(Ga(this.realPath,this.matrix));b.bbox.toString=d;b.dirty=b.dirtyT=0}return b.bbox};Y.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(a);return a};Y.glow=function(a){if("text"==this.type)return null;a=a||{};var b=(a.width||10)+(+this.attr("stroke-width")||1),c=a.fill||
!1,d=a.opacity||0.5,e=a.offsetx||0,f=a.offsety||0;a=a.color||"#000";for(var g=b/2,k=this.paper,l=k.set(),m=this.realPath||wa[this.type](this),m=this.matrix?Ga(m,this.matrix):m,n=1;n<g+1;n++)l.push(k.path(m).attr({stroke:a,fill:c?a:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b/g*n).toFixed(3),opacity:+(d/g).toFixed(3)}));return l.insertBefore(this).translate(e,f)};var Va={},Wa=function(a,b,c,d,e,f,g,k,m){var n=0,p=100,q=[a,b,c,d,e,f,g,k].join(),r=Va[q],u,F;!r&&(Va[q]=
r={data:[]});r.timer&&clearTimeout(r.timer);r.timer=setTimeout(function(){delete Va[q]},2E3);if(null!=m&&!r.precision){var v=Wa(a,b,c,d,e,f,g,k);r.precision=10*~~v;r.data=[]}p=r.precision||p;for(v=0;v<p+1;v++){r.data[v*p]?F=r.data[v*p]:(F=l.findDotsAtSegment(a,b,c,d,e,f,g,k,v/p),r.data[v*p]=F);v&&(n+=M(M(u.x-F.x,2)+M(u.y-F.y,2),0.5));if(null!=m&&n>=m)return F;u=F}if(null==m)return n},ab=function(a,b){return function(c,d,e){c=ya(c);for(var f,g,k,m,n="",p={},q=0,r=0,u=c.length;r<u;r++){k=c[r];if("M"==
k[0])f=+k[1],g=+k[2];else{m=Wa(f,g,k[1],k[2],k[3],k[4],k[5],k[6]);if(q+m>d){if(b&&!p.start){f=Wa(f,g,k[1],k[2],k[3],k[4],k[5],k[6],d-q);n+=["C"+f.start.x,f.start.y,f.m.x,f.m.y,f.x,f.y];if(e)return n;p.start=n;n=["M"+f.x,f.y+"C"+f.n.x,f.n.y,f.end.x,f.end.y,k[5],k[6]].join();q+=m;f=+k[5];g=+k[6];continue}if(!a&&!b)return f=Wa(f,g,k[1],k[2],k[3],k[4],k[5],k[6],d-q),{x:f.x,y:f.y,alpha:f.alpha}}q+=m;f=+k[5];g=+k[6]}n+=k.shift()+k}p.end=n;f=a?q:b?p:l.findDotsAtSegment(f,g,k[0],k[1],k[2],k[3],k[4],k[5],
1);f.alpha&&(f={x:f.x,y:f.y,alpha:f.alpha});return f}},qb=ab(1),rb=ab(),Oa=ab(0,1);l.getTotalLength=qb;l.getPointAtLength=rb;l.getSubpath=function(a,b,c){if(1E-6>this.getTotalLength(a)-c)return Oa(a,b).end;a=Oa(a,c,1);return b?Oa(a,b).end:a};Y.getTotalLength=function(){if("path"==this.type)return this.node.getTotalLength?this.node.getTotalLength():qb(this.attrs.path)};Y.getPointAtLength=function(a){if("path"==this.type)return rb(this.attrs.path,a)};Y.getSubpath=function(a,b){if("path"==this.type)return l.getSubpath(this.attrs.path,
a,b)};var ma=l.easing_formulas={linear:function(a){return a},"<":function(a){return M(a,1.7)},">":function(a){return M(a,0.48)},"<>":function(a){var b=0.48-a/1.04,c=J.sqrt(0.1734+b*b);a=c-b;a=M(N(a),1/3)*(0>a?-1:1);b=-c-b;b=M(N(b),1/3)*(0>b?-1:1);a=a+b+0.5;return 3*(1-a)*a*a+a*a*a},backIn:function(a){return a*a*(2.70158*a-1.70158)},backOut:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},elastic:function(a){return a==!!a?a:M(2,-10*a)*J.sin(2*(a-0.075)*R/0.3)+1},bounce:function(a){var b;a<1/2.75?
b=7.5625*a*a:a<2/2.75?(a-=1.5/2.75,b=7.5625*a*a+0.75):a<2.5/2.75?(a-=2.25/2.75,b=7.5625*a*a+0.9375):(a-=2.625/2.75,b=7.5625*a*a+0.984375);return b}};ma.easeIn=ma["ease-in"]=ma["<"];ma.easeOut=ma["ease-out"]=ma[">"];ma.easeInOut=ma["ease-in-out"]=ma["<>"];ma["back-in"]=ma.backIn;ma["back-out"]=ma.backOut;var ba=[],sb=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,
16)},bb=function(){for(var b=+new Date,c=0;c<ba.length;c++){var d=ba[c];if(!d.el.removed&&!d.paused){var e=b-d.start,f=d.ms,g=d.easing,k=d.from,m=d.diff,n=d.to,p=d.el,q={},r,F={},v;d.initstatus?(e=(d.initstatus*d.anim.top-d.prev)/(d.percent-d.prev)*f,d.status=d.initstatus,delete d.initstatus,d.stop&&ba.splice(c--,1)):d.status=(d.prev+e/f*(d.percent-d.prev))/d.anim.top;if(!(0>e))if(e<f){var x=g(e/f),y;for(y in k)if(k[u](y)){switch(Ma[y]){case U:r=+k[y]+x*f*m[y];break;case "colour":r="rgb("+[ka(oa(k[y].r+
x*f*m[y].r)),ka(oa(k[y].g+x*f*m[y].g)),ka(oa(k[y].b+x*f*m[y].b))].join()+")";break;case "path":r=[];e=0;for(g=k[y].length;e<g;e++){r[e]=[k[y][e][0]];n=1;for(F=k[y][e].length;n<F;n++)r[e][n]=+k[y][e][n]+x*f*m[y][e][n];r[e]=r[e].join(G)}r=r.join(G);break;case "transform":if(m[y].real)for(r=[],e=0,g=k[y].length;e<g;e++)for(r[e]=[k[y][e][0]],n=1,F=k[y][e].length;n<F;n++)r[e][n]=k[y][e][n]+x*f*m[y][e][n];else r=function(a){return+k[y][a]+x*f*m[y][a]},r=[["m",r(0),r(1),r(2),r(3),r(4),r(5)]];break;case "csv":if("clip-rect"==
y)for(r=[],e=4;e--;)r[e]=+k[y][e]+x*f*m[y][e];break;default:for(g=[][D](k[y]),r=[],e=p.paper.customAttributes[y].length;e--;)r[e]=+g[e]+x*f*m[y][e]}q[y]=r}p.attr(q);(function(a,b,c){setTimeout(function(){eve("anim.frame."+a,b,c)})})(p.id,p,d.anim)}else{(function(a,b,c){setTimeout(function(){eve("anim.frame."+b.id,b,c);eve("anim.finish."+b.id,b,c);l.is(a,"function")&&a.call(b)})})(d.callback,p,d.anim);p.attr(n);ba.splice(c--,1);if(1<d.repeat&&!d.next){for(v in n)n[u](v)&&(F[v]=d.totalOrigin[v]);d.el.attr(F);
a(d.anim,d.el,d.anim.percents[0],null,d.totalOrigin,d.repeat-1)}d.next&&!d.stop&&a(d.anim,d.el,d.next,null,d.totalOrigin,d.repeat)}}}l.svg&&p&&p.paper&&p.paper.safari();ba.length&&sb(bb)},ka=function(a){return 255<a?255:0>a?0:a};Y.animateWith=function(a,b,c,d,e,f){c=c?l.animation(c,d,e,f):b;status=a.status(b);return this.animate(c).status(c,status*b.ms/c.ms)};Y.onAnimation=function(a){a?eve.on("anim.frame."+this.id,a):eve.unbind("anim.frame."+this.id);return this};b.prototype.delay=function(a){var c=
new b(this.anim,this.ms);c.times=this.times;c.del=+a||0;return c};b.prototype.repeat=function(a){var c=new b(this.anim,this.ms);c.del=this.del;c.times=J.floor(O(a,0))||1;return c};l.animation=function(a,c,d,e){if(a instanceof b)return a;if(l.is(d,"function")||!d)e=e||d||null,d=null;a=Object(a);c=+c||0;var f={},g,k;for(k in a)a[u](k)&&Z(k)!=k&&Z(k)+"%"!=k&&(g=!0,f[k]=a[k]);if(!g)return new b(a,c);d&&(f.easing=d);e&&(f.callback=e);return new b({100:f},c)};Y.animate=function(c,d,e,f){if(this.removed)return f&&
f.call(this),this;c=c instanceof b?c:l.animation(c,d,e,f);a(c,this,c.percents[0],null,this.attr());return this};Y.setTime=function(a,b){a&&null!=b&&this.status(a,Q(b,a.ms)/a.ms);return this};Y.status=function(b,c){var d=[],e=0,f,g;if(null!=c)return a(b,this,-1,Q(c,1)),this;for(f=ba.length;e<f;e++)if(g=ba[e],g.el.id==this.id&&(!b||g.anim==b)){if(b)return g.status;d.push({anim:g.anim,status:g.status})}return b?0:d};Y.pause=function(a){for(var b=0;b<ba.length;b++)ba[b].el.id!=this.id||a&&ba[b].anim!=
a||!1===eve("anim.pause."+this.id,this,ba[b].anim)||(ba[b].paused=!0);return this};Y.resume=function(a){for(var b=0;b<ba.length;b++)if(ba[b].el.id==this.id&&(!a||ba[b].anim==a)){var c=ba[b];!1!==eve("anim.resume."+this.id,this,c.anim)&&(delete c.paused,this.status(c.anim,c.status))}return this};Y.stop=function(a){for(var b=0;b<ba.length;b++)ba[b].el.id!=this.id||a&&ba[b].anim!=a||!1===eve("anim.stop."+this.id,this,ba[b].anim)||ba.splice(b--,1);return this};Y.toString=function(){return"Rapha\u00ebl\u2019s object"};
var Ba=function(a){this.items=[];this.length=0;this.type="set";if(a)for(var b=0,c=a.length;b<c;b++)a[b]&&(a[b].constructor==Y.constructor||a[b].constructor==Ba)&&(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},ha=Ba.prototype;ha.push=function(){for(var a,b,c=0,d=arguments.length;c<d;c++)(a=arguments[c])&&(a.constructor==Y.constructor||a.constructor==Ba)&&(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this};ha.pop=function(){this.length&&delete this[this.length--];
return this.items.pop()};ha.forEach=function(a,b){for(var c=0,d=this.items.length;c<d&&!1!==a.call(b,this.items[c],c);c++);return this};for(var ga in Y)Y[u](ga)&&(ha[ga]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][A](c,b)})}}(ga));ha.attr=function(a,b){if(a&&l.is(a,S)&&l.is(a[0],"object"))for(var c=0,d=a.length;c<d;c++)this.items[c].attr(a[c]);else for(c=0,d=this.items.length;c<d;c++)this.items[c].attr(a,b);return this};ha.clear=function(){for(;this.length;)this.pop()};
ha.splice=function(a,b,c){a=0>a?O(this.length+a,0):a;b=O(0,Q(this.length-a,b));var d=[],e=[],f=[],g;for(g=2;g<arguments.length;g++)f.push(arguments[g]);for(g=0;g<b;g++)e.push(this[a+g]);for(;g<this.length-a;g++)d.push(this[a+g]);var k=f.length;for(g=0;g<k+d.length;g++)this.items[a+g]=this[a+g]=g<k?f[g]:d[g-k];for(g=this.items.length=this.length-=b-k;this[g];)delete this[g++];return new Ba(e)};ha.exclude=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]==a)return this.splice(b,1),!0};ha.animate=
function(a,b,c,d){!l.is(c,"function")&&c||(d=c||null);var e=this.items.length,f=e,g=this,k;if(!e)return this;d&&(k=function(){!--e&&d.call(g)});c=l.is(c,"string")?c:k;b=l.animation(a,b,c,k);for(a=this.items[--f].animate(b);f--;)this.items[f]&&!this.items[f].removed&&this.items[f].animateWith(a,b);return this};ha.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this};ha.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=
this.items[e].getBBox();a.push(f.x);b.push(f.y);c.push(f.x+f.width);d.push(f.y+f.height)}a=Q[A](0,a);b=Q[A](0,b);return{x:a,y:b,width:O[A](0,c)-a,height:O[A](0,d)-b}};ha.clone=function(a){a=new Ba;for(var b=0,c=this.items.length;b<c;b++)a.push(this.items[b].clone());return a};ha.toString=function(){return"Rapha\u00ebl\u2018s set"};l.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"],d;for(d in a.face)a.face[u](d)&&(b.face[d]=
a.face[d]);this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b];if(!a.svg){b.face["units-per-em"]=fa(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[u](e)&&(c=a.glyphs[e],b.glyphs[e]={w:c.w,k:{},d:c.d&&"M"+c.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},c.k))for(var f in c.k)c[u](f)&&(b.glyphs[e].k[f]=c.k[f])}return a};B.getFont=function(a,b,c,d){d=d||"normal";c=c||"normal";b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400;if(l.fonts){var e=
l.fonts[a];if(!e){a=RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,"")+"(\\s|$)","i");for(var f in l.fonts)if(l.fonts[u](f)&&a.test(f)){e=l.fonts[f];break}}var g;if(e)for(f=0,a=e.length;f<a&&(g=e[f],g.face["font-weight"]!=b||g.face["font-style"]!=c&&g.face["font-style"]||g.face["font-stretch"]!=d);f++);return g}};B.print=function(a,b,c,d,e,f,g){f=f||"middle";g=O(Q(g||0,1),-1);var k=this.set(),m=C(c)[F](""),p=0;l.is(d,c)&&(d=this.getFont(d));if(d){c=(e||16)/d.face["units-per-em"];var q=d.face.bbox[F](n);
e=+q[0];f=+q[1]+("baseline"==f?q[3]-q[1]+ +d.face.descent:(q[3]-q[1])/2);for(var q=0,r=m.length;q<r;q++){var u=q&&d.glyphs[m[q-1]]||{},v=d.glyphs[m[q]],p=p+(q?(u.w||d.w)+(u.k&&u.k[m[q]]||0)+d.w*g:0);v&&v.d&&k.push(this.path(v.d).attr({fill:"#000",stroke:"none",transform:[["t",p*c,0]]}))}k.transform(["...s",c,c,e,f,"t",(a-e)/c,(b-f)/c])}return k};l.format=function(a,b){var c=l.is(b,S)?[0][D](b):arguments;a&&l.is(a,"string")&&c.length-1&&(a=a.replace(q,function(a,b){return null==c[++b]?"":c[b]}));return a||
""};l.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;c.replace(b,function(a,b,c,d,f){b=b||d;e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))});return e=(null==e||e==d?a:e)+""};return function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})}}();l.ninja=function(){y?v.win.Raphael=z:delete Raphael;return l};l.st=ha;(function(a,b,c){function d(){/in/.test(a.readyState)?setTimeout(d,9):l.eve("DOMload")}
null==a.readyState&&a.addEventListener&&(a.addEventListener(b,c=function(){a.removeEventListener(b,c,!1);a.readyState="complete"},!1),a.readyState="loading");d()})(document,"DOMContentLoaded");y?v.win.Raphael=l:Raphael=l;eve.on("DOMload",function(){m=!0})})();
window.Raphael.svg&&function(a){var b=String,c=parseFloat,d=parseInt,e=Math,f=e.max,g=e.abs,k=e.pow,l=/[, ]+/,m=a.eve,n={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},p={};a.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\u00ebl "+this.version};var q=function(c,d){if(d){"string"==typeof c&&(c=q(c));for(var e in d)d.hasOwnProperty(e)&&("xlink:"==
e.substring(0,6)?c.setAttributeNS("http://www.w3.org/1999/xlink",e.substring(6),b(d[e])):c.setAttribute(e,b(d[e])))}else c=a._g.doc.createElementNS("http://www.w3.org/2000/svg",c),c.style&&(c.style.webkitTapHighlightColor="rgba(0,0,0,0)");return c},u=function(d,l){var m="linear",n=d.id+l,p=0.5,u=0.5,v=d.node,x=d.paper,y=v.style,C=a._g.doc.getElementById(n);if(!C){l=b(l).replace(a._radial_gradient,function(a,b,d){m="radial";b&&d&&(p=c(b),u=c(d),a=2*(0.5<u)-1,0.25<k(p-0.5,2)+k(u-0.5,2)&&(u=e.sqrt(0.25-
k(p-0.5,2))*a+0.5)&&0.5!=u&&(u=u.toFixed(5)-1E-5*a));return""});l=l.split(/\s*\-\s*/);if("linear"==m){C=l.shift();C=-c(C);if(isNaN(C))return null;var z=[0,0,e.cos(a.rad(C)),e.sin(a.rad(C))],C=1/(f(g(z[2]),g(z[3]))||1);z[2]*=C;z[3]*=C;0>z[2]&&(z[0]=-z[2],z[2]=0);0>z[3]&&(z[1]=-z[3],z[3]=0)}var B=a._parseDots(l);if(!B)return null;d.gradient&&(x.defs.removeChild(d.gradient),delete d.gradient);n=n.replace(/[\(\)\s,\xb0#]/g,"-");C=q(m+"Gradient",{id:n});d.gradient=C;q(C,"radial"==m?{fx:p,fy:u}:{x1:z[0],
y1:z[1],x2:z[2],y2:z[3],gradientTransform:d.matrix.invert()});x.defs.appendChild(C);x=0;for(z=B.length;x<z;x++)C.appendChild(q("stop",{offset:B[x].offset?B[x].offset:x?"100%":"0%","stop-color":B[x].color||"#fff"}))}q(v,{fill:"url(#"+n+")",opacity:1,"fill-opacity":1});y.fill="";y.opacity=1;return y.fillOpacity=1},v=function(a){var b=a.getBBox(1);q(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},y=function(c,d,e){if("path"==c.type){for(var f=b(d).toLowerCase().split("-"),
g=c.paper,k=e?"end":"start",l=c.node,m=c.attrs,u=m["stroke-width"],v=f.length,x="classic",y,C,z,B,A,E=3,D=3,G=5;v--;)switch(f[v]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":x=f[v];break;case "wide":D=5;break;case "narrow":D=2;break;case "long":E=5;break;case "short":E=2}"open"==x?(E+=2,D+=2,G+=2,z=1,B=e?4:1,A={fill:"none",stroke:m.stroke}):(B=z=E/2,A={fill:m.stroke,stroke:"none"});c._.arrows?e?(c._.arrows.endPath&&p[c._.arrows.endPath]--,c._.arrows.endMarker&&p[c._.arrows.endMarker]--):
(c._.arrows.startPath&&p[c._.arrows.startPath]--,c._.arrows.startMarker&&p[c._.arrows.startMarker]--):c._.arrows={};if("none"!=x){f="raphael-marker-"+x;v="raphael-marker-"+k+x+E+D;a._g.doc.getElementById(f)?p[f]++:(g.defs.appendChild(q(q("path"),{"stroke-linecap":"round",d:n[x],id:f})),p[f]=1);var ja=a._g.doc.getElementById(v),Ca;ja?(p[v]++,Ca=ja.getElementsByTagName("use")[0]):(ja=q(q("marker"),{id:v,markerHeight:D,markerWidth:E,orient:"auto",refX:B,refY:D/2}),Ca=q(q("use"),{"xlink:href":"#"+f,transform:(e?
" rotate(180 "+E/2+" "+D/2+") ":" ")+"scale("+E/G+","+D/G+")","stroke-width":1/((E/G+D/G)/2)}),ja.appendChild(Ca),g.defs.appendChild(ja),p[v]=1);q(Ca,A);g=z*("diamond"!=x&&"oval"!=x);e?(y=c._.arrows.startdx*u||0,C=a.getTotalLength(m.path)-g*u):(y=g*u,C=a.getTotalLength(m.path)-(c._.arrows.enddx*u||0));A={};A["marker-"+k]="url(#"+v+")";if(C||y)A.d=Raphael.getSubpath(m.path,y,C);q(l,A);c._.arrows[k+"Path"]=f;c._.arrows[k+"Marker"]=v;c._.arrows[k+"dx"]=g;c._.arrows[k+"Type"]=x;c._.arrows[k+"String"]=
d}else e?(y=c._.arrows.startdx*u||0,C=a.getTotalLength(m.path)-y):(y=0,C=a.getTotalLength(m.path)-(c._.arrows.enddx*u||0)),c._.arrows[k+"Path"]&&q(l,{d:Raphael.getSubpath(m.path,y,C)}),delete c._.arrows[k+"Path"],delete c._.arrows[k+"Marker"],delete c._.arrows[k+"dx"],delete c._.arrows[k+"Type"],delete c._.arrows[k+"String"];for(A in p)p.hasOwnProperty(A)&&!p[A]&&(c=a._g.doc.getElementById(A))&&c.parentNode.removeChild(c)}},z={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],
". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},x=function(a,c,d){if(c=z[b(c).toLowerCase()]){var e=a.attrs["stroke-width"]||"1";d={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0;for(var f=[],g=c.length;g--;)f[g]=c[g]*e+(g%2?1:-1)*d;q(a.node,{"stroke-dasharray":f.join(",")})}},B=function(c,e){var k=c.node,m=c.attrs,n=k.style.visibility;k.style.visibility="hidden";for(var p in e)if(e.hasOwnProperty(p)&&a._availableAttrs.hasOwnProperty(p)){var C=
e[p];m[p]=C;switch(p){case "blur":c.blur(C);break;case "href":case "title":case "target":var z=k.parentNode;if("a"!=z.tagName.toLowerCase()){var B=q("a");z.insertBefore(B,k);B.appendChild(k);z=B}"target"==p&&"blank"==C?z.setAttributeNS("http://www.w3.org/1999/xlink","show","new"):z.setAttributeNS("http://www.w3.org/1999/xlink",p,C);break;case "cursor":k.style.cursor=C;break;case "transform":c.transform(C);break;case "arrow-start":y(c,C);break;case "arrow-end":y(c,C,1);break;case "clip-rect":z=b(C).split(l);
if(4==z.length){c.clip&&c.clip.parentNode.parentNode.removeChild(c.clip.parentNode);var B=q("clipPath"),E=q("rect");B.id=a.createUUID();q(E,{x:z[0],y:z[1],width:z[2],height:z[3]});B.appendChild(E);c.paper.defs.appendChild(B);q(k,{"clip-path":"url(#"+B.id+")"});c.clip=E}C||((C=a._g.doc.getElementById(k.getAttribute("clip-path").replace(/(^url\(#|\)$)/g,"")))&&C.parentNode.removeChild(C),q(k,{"clip-path":""}),delete c.clip);break;case "path":"path"==c.type&&(q(k,{d:C?m.path=a._pathToAbsolute(C):"M0,0"}),
c._.dirty=1,c._.arrows&&("startString"in c._.arrows&&y(c,c._.arrows.startString),"endString"in c._.arrows&&y(c,c._.arrows.endString,1)));break;case "width":if(k.setAttribute(p,C),c._.dirty=1,m.fx)p="x",C=m.x;else break;case "x":m.fx&&(C=-m.x-(m.width||0));case "rx":if("rx"==p&&"rect"==c.type)break;case "cx":k.setAttribute(p,C);c.pattern&&v(c);c._.dirty=1;break;case "height":if(k.setAttribute(p,C),c._.dirty=1,m.fy)p="y",C=m.y;else break;case "y":m.fy&&(C=-m.y-(m.height||0));case "ry":if("ry"==p&&"rect"==
c.type)break;case "cy":k.setAttribute(p,C);c.pattern&&v(c);c._.dirty=1;break;case "r":"rect"==c.type?q(k,{rx:C,ry:C}):k.setAttribute(p,C);c._.dirty=1;break;case "src":"image"==c.type&&k.setAttributeNS("http://www.w3.org/1999/xlink","href",C);break;case "stroke-width":if(1!=c._.sx||1!=c._.sy)C/=f(g(c._.sx),g(c._.sy))||1;c.paper._vbSize&&(C*=c.paper._vbSize);k.setAttribute(p,C);m["stroke-dasharray"]&&x(c,m["stroke-dasharray"],e);c._.arrows&&("startString"in c._.arrows&&y(c,c._.arrows.startString),"endString"in
c._.arrows&&y(c,c._.arrows.endString,1));break;case "stroke-dasharray":x(c,C,e);break;case "fill":var D=b(C).match(a._ISURL);if(D){var B=q("pattern"),G=q("image");B.id=a.createUUID();q(B,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});q(G,{x:0,y:0,"xlink:href":D[1]});B.appendChild(G);(function(b){a._preload(D[1],function(){var a=this.offsetWidth,d=this.offsetHeight;q(b,{width:a,height:d});q(G,{width:a,height:d});c.paper.safari()})})(B);c.paper.defs.appendChild(B);k.style.fill="url(#"+B.id+
")";q(k,{fill:"url(#"+B.id+")"});c.pattern=B;c.pattern&&v(c);break}z=a.getRGB(C);if(!z.error)delete e.gradient,delete m.gradient,!a.is(m.opacity,"undefined")&&a.is(e.opacity,"undefined")&&q(k,{opacity:m.opacity}),!a.is(m["fill-opacity"],"undefined")&&a.is(e["fill-opacity"],"undefined")&&q(k,{"fill-opacity":m["fill-opacity"]});else if(("circle"==c.type||"ellipse"==c.type||"r"!=b(C).charAt())&&u(c,C)){if("opacity"in m||"fill-opacity"in m)if(z=a._g.doc.getElementById(k.getAttribute("fill").replace(/^url\(#|\)$/g,
""))){var L=z.getElementsByTagName("stop");q(L[L.length-1],{"stop-opacity":("opacity"in m?m.opacity:1)*("fill-opacity"in m?m["fill-opacity"]:1)})}m.gradient=C;m.fill="none";break}z.hasOwnProperty("opacity")&&q(k,{"fill-opacity":1<z.opacity?z.opacity/100:z.opacity});case "stroke":z=a.getRGB(C);k.setAttribute(p,z.hex);"stroke"==p&&z.hasOwnProperty("opacity")&&q(k,{"stroke-opacity":1<z.opacity?z.opacity/100:z.opacity});"stroke"==p&&c._.arrows&&("startString"in c._.arrows&&y(c,c._.arrows.startString),
"endString"in c._.arrows&&y(c,c._.arrows.endString,1));break;case "gradient":"circle"!=c.type&&"ellipse"!=c.type&&"r"==b(C).charAt()||u(c,C);break;case "opacity":m.gradient&&!m.hasOwnProperty("stroke-opacity")&&q(k,{"stroke-opacity":1<C?C/100:C});case "fill-opacity":if(m.gradient){(z=a._g.doc.getElementById(k.getAttribute("fill").replace(/^url\(#|\)$/g,"")))&&(L=z.getElementsByTagName("stop"),q(L[L.length-1],{"stop-opacity":C}));break}default:"font-size"==p&&(C=d(C,10)+"px"),z=p.replace(/(\-.)/g,
function(a){return a.substring(1).toUpperCase()}),k.style[z]=C,c._.dirty=1,k.setAttribute(p,C)}}A(c,e);k.style.visibility=n},A=function(c,e){if("text"==c.type&&(e.hasOwnProperty("text")||e.hasOwnProperty("font")||e.hasOwnProperty("font-size")||e.hasOwnProperty("x")||e.hasOwnProperty("y"))){var f=c.attrs,g=c.node,k=g.firstChild?d(a._g.doc.defaultView.getComputedStyle(g.firstChild,"").getPropertyValue("font-size"),10):10;if(e.hasOwnProperty("text")){for(f.text=e.text;g.firstChild;)g.removeChild(g.firstChild);
for(var l=b(e.text).split("\n"),m=[],n,p=0,u=l.length;p<u;p++)n=q("tspan"),p&&q(n,{dy:1.2*k,x:f.x}),n.appendChild(a._g.doc.createTextNode(l[p])),g.appendChild(n),m[p]=n}else for(m=g.getElementsByTagName("tspan"),p=0,u=m.length;p<u;p++)p?q(m[p],{dy:1.2*k,x:f.x}):q(m[0],{dy:0});q(g,{x:f.x,y:f.y});c._.dirty=1;g=c._getBBox();(f=f.y-(g.y+g.height/2))&&a.is(f,"finite")&&q(m[0],{dy:f})}},D=function(b,c){this[0]=this.node=b;b.raphael=!0;this.id=a._oid++;b.raphaelid=this.id;this.matrix=a.matrix();this.realPath=
null;this.paper=c;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!c.bottom&&(c.bottom=this);(this.prev=c.top)&&(c.top.next=this);c.top=this;this.next=null},E=a.el;D.prototype=E;E.constructor=D;a._engine.path=function(a,b){var c=q("path");b.canvas&&b.canvas.appendChild(c);c=new D(c,b);c.type="path";B(c,{fill:"none",stroke:"#000",path:a});return c};E.rotate=function(a,d,e){if(this.removed)return this;a=b(a).split(l);a.length-1&&(d=c(a[1]),e=c(a[2]));a=c(a[0]);null==
e&&(d=e);if(null==d||null==e)e=this.getBBox(1),d=e.x+e.width/2,e=e.y+e.height/2;this.transform(this._.transform.concat([["r",a,d,e]]));return this};E.scale=function(a,d,e,f){if(this.removed)return this;a=b(a).split(l);a.length-1&&(d=c(a[1]),e=c(a[2]),f=c(a[3]));a=c(a[0]);null==d&&(d=a);null==f&&(e=f);if(null==e||null==f)var g=this.getBBox(1);e=null==e?g.x+g.width/2:e;f=null==f?g.y+g.height/2:f;this.transform(this._.transform.concat([["s",a,d,e,f]]));return this};E.translate=function(a,d){if(this.removed)return this;
a=b(a).split(l);a.length-1&&(d=c(a[1]));a=c(a[0])||0;this.transform(this._.transform.concat([["t",a,+d||0]]));return this};E.transform=function(b){var c=this._;if(null==b)return c.transform;a._extractTransform(this,b);this.clip&&q(this.clip,{transform:this.matrix.invert()});this.pattern&&v(this);this.node&&q(this.node,{transform:this.matrix});if(1!=c.sx||1!=c.sy)b=this.attrs.hasOwnProperty("stroke-width")?this.attrs["stroke-width"]:1,this.attr({"stroke-width":b});return this};E.hide=function(){!this.removed&&
this.paper.safari(this.node.style.display="none");return this};E.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this};E.remove=function(){if(!this.removed){this.paper.__set__&&this.paper.__set__.exclude(this);m.unbind("*.*."+this.id);a._tear(this,this.paper);this.node.parentNode.removeChild(this.node);for(var b in this)delete this[b];this.removed=!0}};E._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(c){}finally{b=
b||{}}a&&this.hide();return b};E.attr=function(b,c){if(this.removed)return this;if(null==b){var d={},e;for(e in this.attrs)this.attrs.hasOwnProperty(e)&&(d[e]=this.attrs[e]);d.gradient&&"none"==d.fill&&(d.fill=d.gradient)&&delete d.gradient;d.transform=this._.transform;return d}if(null==c&&a.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;e=b.split(l);for(var d={},f=0,g=e.length;f<g;f++)b=e[f],b in this.attrs?
d[b]=this.attrs[b]:a.is(this.paper.customAttributes[b],"function")?d[b]=this.paper.customAttributes[b].def:d[b]=a._availableAttrs[b];return g-1?d:d[e[0]]}if(null==c&&a.is(b,"array")){d={};f=0;for(g=b.length;f<g;f++)d[b[f]]=this.attr(b[f]);return d}null!=c?(d={},d[b]=c):null!=b&&a.is(b,"object")&&(d=b);for(f in d)m("attr."+f+"."+this.id,this,d[f]);for(f in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(f)&&d.hasOwnProperty(f)&&a.is(this.paper.customAttributes[f],"function"))for(g in e=
this.paper.customAttributes[f].apply(this,[].concat(d[f])),this.attrs[f]=d[f],e)e.hasOwnProperty(g)&&(d[g]=e[g]);B(this,d);return this};E.toFront=function(){if(this.removed)return this;this.node.parentNode.appendChild(this.node);var b=this.paper;b.top!=this&&a._tofront(this,b);return this};E.toBack=function(){if(this.removed)return this;this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper));return this};
E.insertAfter=function(b){if(this.removed)return this;var c=b.node||b[b.length-1].node;c.nextSibling?c.parentNode.insertBefore(this.node,c.nextSibling):c.parentNode.appendChild(this.node);a._insertafter(this,b,this.paper);return this};E.insertBefore=function(b){if(this.removed)return this;var c=b.node||b[0].node;c.parentNode.insertBefore(this.node,c);a._insertbefore(this,b,this.paper);return this};E.blur=function(b){if(0!==+b){var c=q("filter"),d=q("feGaussianBlur");this.attrs.blur=b;c.id=a.createUUID();
q(d,{stdDeviation:+b||1.5});c.appendChild(d);this.paper.defs.appendChild(c);this._blur=c;q(this.node,{filter:"url(#"+c.id+")"})}else this._blur&&(this._blur.parentNode.removeChild(this._blur),delete this._blur,delete this.attrs.blur),this.node.removeAttribute("filter")};a._engine.circle=function(a,b,c,d){var e=q("circle");a.canvas&&a.canvas.appendChild(e);a=new D(e,a);a.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"};a.type="circle";q(e,a.attrs);return a};a._engine.rect=function(a,b,c,d,e,f){var g=
q("rect");a.canvas&&a.canvas.appendChild(g);a=new D(g,a);a.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"};a.type="rect";q(g,a.attrs);return a};a._engine.ellipse=function(a,b,c,d,e){var f=q("ellipse");a.canvas&&a.canvas.appendChild(f);a=new D(f,a);a.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"};a.type="ellipse";q(f,a.attrs);return a};a._engine.image=function(a,b,c,d,e,f){var g=q("image");q(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"});g.setAttributeNS("http://www.w3.org/1999/xlink",
"href",b);a.canvas&&a.canvas.appendChild(g);a=new D(g,a);a.attrs={x:c,y:d,width:e,height:f,src:b};a.type="image";return a};a._engine.text=function(b,c,d,e){var f=q("text");b.canvas&&b.canvas.appendChild(f);b=new D(f,b);b.attrs={x:c,y:d,"text-anchor":"middle",text:e,font:a._availableAttrs.font,stroke:"none",fill:"#000"};b.type="text";B(b,b.attrs);return b};a._engine.setSize=function(a,b){this.width=a||this.width;this.height=b||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",
this.height);this._viewBox&&this.setViewBox.apply(this,this._viewBox);return this};a._engine.create=function(){var b=a._getContainer.apply(0,arguments),c=b&&b.container,d=b.x,e=b.y,f=b.width,b=b.height;if(!c)throw Error("SVG container not found.");var g=q("svg"),k,d=d||0,e=e||0,f=f||512,b=b||342;q(g,{height:b,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"});1==c?(g.style.cssText="overflow:hidden;position:absolute;left:"+d+"px;top:"+e+"px",a._g.doc.body.appendChild(g),k=1):(g.style.cssText=
"overflow:hidden;position:relative",c.firstChild?c.insertBefore(g,c.firstChild):c.appendChild(g));c=new a._Paper;c.width=f;c.height=b;c.canvas=g;c.clear();c._left=c._top=0;k&&(c.renderfix=function(){});c.renderfix();return c};a._engine.setViewBox=function(a,b,c,d,e){m("setViewBox",this,this._viewBox,[a,b,c,d,e]);var g=f(c/this.width,d/this.height),k=this.top,l=e?"meet":"xMinYMin",n;null==a?(this._vbSize&&(g=1),delete this._vbSize,n="0 0 "+this.width+" "+this.height):(this._vbSize=g,n=a+" "+b+" "+
c+" "+d);for(q(this.canvas,{viewBox:n,preserveAspectRatio:l});g&&k;)l="stroke-width"in k.attrs?k.attrs["stroke-width"]:1,k.attr({"stroke-width":l}),k._.dirty=1,k._.dirtyT=1,k=k.prev;this._viewBox=[a,b,c,d,!!e];return this};a.prototype.renderfix=function(){var a=this.canvas,b=a.style,c=a.getScreenCTM()||a.createSVGMatrix(),a=-c.e%1,c=-c.f%1;if(a||c)a&&(this._left=(this._left+a)%1,b.left=this._left+"px"),c&&(this._top=(this._top+c)%1,b.top=this._top+"px")};a.prototype.clear=function(){a.eve("clear",
this);for(var b=this.canvas;b.firstChild;)b.removeChild(b.firstChild);this.bottom=this.top=null;(this.desc=q("desc")).appendChild(a._g.doc.createTextNode("Created with Rapha\u00ebl "+a.version));b.appendChild(this.desc);b.appendChild(this.defs=q("defs"))};a.prototype.remove=function(){m("remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]=removed(a)};var G=a.st,C;for(C in E)E.hasOwnProperty(C)&&!G.hasOwnProperty(C)&&(G[C]=function(a){return function(){var b=
arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(C))}(window.Raphael);
window.Raphael.vml&&function(a){var b=String,c=parseFloat,d=Math,e=d.round,f=d.max,g=d.min,k=d.abs,l=/[, ]+/,m=a.eve,n={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},p=/([clmz]),?([^clmz]*)/gi,q=/ progid:\S+Blur\([^\)]+\)/g,u=/-?[^,\s-]+/g,v={path:1,rect:1,image:1},y={circle:1,ellipse:1},z=function(c){var d=/[ahqstv]/ig,f=a._pathToAbsolute;b(c).match(d)&&(f=a._path2curve);d=/[clmz]/g;if(f==a._pathToAbsolute&&!b(c).match(d))return c=b(c).replace(p,function(a,b,c){var d=[],f="m"==b.toLowerCase(),
g=n[b];c.replace(u,function(a){f&&2==d.length&&(g+=d+n["m"==b?"l":"L"],d=[]);d.push(e(21600*a))});return g+d});var d=f(c),g;c=[];for(var k=0,l=d.length;k<l;k++){f=d[k];g=d[k][0].toLowerCase();"z"==g&&(g="x");for(var m=1,q=f.length;m<q;m++)g+=e(21600*f[m])+(m!=q-1?",":"");c.push(g)}return c.join(" ")},x=function(b,c,d){var e=a.matrix();e.rotate(-b,0.5,0.5);return{dx:e.x(c,d),dy:e.y(c,d)}},B=function(a,b,c,d,e,f){var g=a._,l=a.matrix,m=g.fillpos;a=a.node;var n=a.style,p=1,q="",u=21600/b,v=21600/c;n.visibility=
"hidden";if(b&&c){a.coordsize=k(u)+" "+k(v);n.rotation=f*(0>b*c?-1:1);if(f){var y=x(f,d,e);d=y.dx;e=y.dy}0>b&&(q+="x");0>c&&(q+=" y")&&(p=-1);n.flip=q;a.coordorigin=d*-u+" "+e*-v;if(m||g.fillsize)d=(d=a.getElementsByTagName("fill"))&&d[0],a.removeChild(d),m&&(y=x(f,l.x(m[0],m[1]),l.y(m[0],m[1])),d.position=y.dx*p+" "+y.dy*p),g.fillsize&&(d.size=g.fillsize[0]*k(b)+" "+g.fillsize[1]*k(c)),a.appendChild(d);n.visibility="visible"}};a.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\u00ebl "+
this.version};addArrow=function(a,c,d){c=b(c).toLowerCase().split("-");d=d?"end":"start";for(var e=c.length,f="classic",g="medium",k="medium";e--;)switch(c[e]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":f=c[e];break;case "wide":case "narrow":k=c[e];break;case "long":case "short":g=c[e]}a=a.node.getElementsByTagName("stroke")[0];a[d+"arrow"]=f;a[d+"arrowlength"]=g;a[d+"arrowwidth"]=k};setFillAndStroke=function(d,k){d.attrs=d.attrs||{};var m=d.node,n=d.attrs,p=m.style,
q=v[d.type]&&(k.x!=n.x||k.y!=n.y||k.width!=n.width||k.height!=n.height||k.cx!=n.cx||k.cy!=n.cy||k.rx!=n.rx||k.ry!=n.ry||k.r!=n.r),u=y[d.type]&&(n.cx!=k.cx||n.cy!=k.cy||n.r!=k.r||n.rx!=k.rx||n.ry!=k.ry),x;for(x in k)k.hasOwnProperty(x)&&(n[x]=k[x]);q&&(n.path=a._getPath[d.type](d),d._.dirty=1);k.href&&(m.href=k.href);k.title&&(m.title=k.title);k.target&&(m.target=k.target);k.cursor&&(p.cursor=k.cursor);"blur"in k&&d.blur(k.blur);if(k.path&&"path"==d.type||q)m.path=z(~b(n.path).toLowerCase().indexOf("r")?
a._pathToAbsolute(n.path):n.path),"image"==d.type&&(d._.fillpos=[n.x,n.y],d._.fillsize=[n.width,n.height],B(d,1,1,0,0,0));"transform"in k&&d.transform(k.transform);u&&(p=+n.cx,q=+n.cy,u=+n.rx||+n.r||0,x=+n.ry||+n.r||0,m.path=a.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",e(21600*(p-u)),e(21600*(q-x)),e(21600*(p+u)),e(21600*(q+x)),e(21600*p)));"clip-rect"in k&&(p=b(k["clip-rect"]).split(l),4==p.length&&(p[2]=+p[2]+ +p[0],p[3]=+p[3]+ +p[1],q=m.clipRect||a._g.doc.createElement("div"),u=q.style,u.clip=
a.format("rect({1}px {2}px {3}px {0}px)",p),m.clipRect||(u.position="absolute",u.top=0,u.left=0,u.width=d.paper.width+"px",u.height=d.paper.height+"px",m.parentNode.insertBefore(q,m),q.appendChild(m),m.clipRect=q)),k["clip-rect"]||m.clipRect&&(m.clipRect.style.clip=""));d.textpath&&(p=d.textpath.style,k.font&&(p.font=k.font),k["font-family"]&&(p.fontFamily='"'+k["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,"")+'"'),k["font-size"]&&(p.fontSize=k["font-size"]),k["font-weight"]&&(p.fontWeight=
k["font-weight"]),k["font-style"]&&(p.fontStyle=k["font-style"]));"arrow-start"in k&&addArrow(d,k["arrow-start"]);"arrow-end"in k&&addArrow(d,k["arrow-end"],1);if(null!=k.opacity||null!=k["stroke-width"]||null!=k.fill||null!=k.src||null!=k.stroke||null!=k["stroke-width"]||null!=k["stroke-opacity"]||null!=k["fill-opacity"]||null!=k["stroke-dasharray"]||null!=k["stroke-miterlimit"]||null!=k["stroke-linejoin"]||null!=k["stroke-linecap"]){p=(p=m.getElementsByTagName("fill"))&&p[0];!p&&(p=D("fill"));"image"==
d.type&&k.src&&(p.src=k.src);k.fill&&(p.on=!0);if(null==p.on||"none"==k.fill||null===k.fill)p.on=!1;p.on&&k.fill&&((q=b(k.fill).match(a._ISURL))?(p.parentNode==m&&m.removeChild(p),p.rotate=!0,p.src=q[1],p.type="tile",u=d.getBBox(1),p.position=u.x+" "+u.y,d._.fillpos=[u.x,u.y],a._preload(q[1],function(){d._.fillsize=[this.offsetWidth,this.offsetHeight]})):(p.color=a.getRGB(k.fill).hex,p.src="",p.type="solid",a.getRGB(k.fill).error&&(d.type in{circle:1,ellipse:1}||"r"!=b(k.fill).charAt())&&addGradientFill(d,
k.fill,p)&&(n.fill="none",n.gradient=k.fill,p.rotate=!1)));if("fill-opacity"in k||"opacity"in k)u=((+n["fill-opacity"]+1||2)-1)*((+n.opacity+1||2)-1)*((+a.getRGB(k.fill).o+1||2)-1),u=g(f(u,0),1),p.opacity=u,p.src&&(p.color="none");m.appendChild(p);p=m.getElementsByTagName("stroke")&&m.getElementsByTagName("stroke")[0];q=!1;!p&&(q=p=D("stroke"));if(k.stroke&&"none"!=k.stroke||k["stroke-width"]||null!=k["stroke-opacity"]||k["stroke-dasharray"]||k["stroke-miterlimit"]||k["stroke-linejoin"]||k["stroke-linecap"])p.on=
!0;"none"!=k.stroke&&null!==k.stroke&&null!=p.on&&0!=k.stroke&&0!=k["stroke-width"]||(p.on=!1);u=a.getRGB(k.stroke);p.on&&k.stroke&&(p.color=u.hex);u=((+n["stroke-opacity"]+1||2)-1)*((+n.opacity+1||2)-1)*((+u.o+1||2)-1);x=0.75*(c(k["stroke-width"])||1);u=g(f(u,0),1);null==k["stroke-width"]&&(x=n["stroke-width"]);k["stroke-width"]&&(p.weight=x);x&&1>x&&(u*=x)&&(p.weight=1);p.opacity=u;k["stroke-linejoin"]&&(p.joinstyle=k["stroke-linejoin"]||"miter");p.miterlimit=k["stroke-miterlimit"]||8;k["stroke-linecap"]&&
(p.endcap="butt"==k["stroke-linecap"]?"flat":"square"==k["stroke-linecap"]?"square":"round");k["stroke-dasharray"]&&(u={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},p.dashstyle=u.hasOwnProperty(k["stroke-dasharray"])?u[k["stroke-dasharray"]]:"");q&&m.appendChild(p)}if("text"==d.type){d.paper.canvas.style.display="";m=d.paper.span;q=n.font&&n.font.match(/\d+(?:\.\d*)?(?=px)/);
p=m.style;n.font&&(p.font=n.font);n["font-family"]&&(p.fontFamily=n["font-family"]);n["font-weight"]&&(p.fontWeight=n["font-weight"]);n["font-style"]&&(p.fontStyle=n["font-style"]);q=c(q?q[0]:n["font-size"]);p.fontSize=100*q+"px";d.textpath.string&&(m.innerHTML=b(d.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));m=m.getBoundingClientRect();d.W=n.w=(m.right-m.left)/100;d.H=n.h=(m.bottom-m.top)/100;d.X=n.x;d.Y=n.y+d.H/2;("x"in k||"y"in k)&&(d.path.v=a.format("m{0},{1}l{2},{1}",
e(21600*n.x),e(21600*n.y),e(21600*n.x)+1));m="x y text font font-family font-weight font-style font-size".split(" ");p=0;for(q=m.length;p<q;p++)if(m[p]in k){d._.dirty=1;break}switch(n["text-anchor"]){case "start":d.textpath.style["v-text-align"]="left";d.bbx=d.W/2;break;case "end":d.textpath.style["v-text-align"]="right";d.bbx=-d.W/2;break;default:d.textpath.style["v-text-align"]="center",d.bbx=0}d.textpath.style["v-text-kern"]=!0}};addGradientFill=function(e,f,g){e.attrs=e.attrs||{};var k=Math.pow,
l="linear",m=".5 .5";e.attrs.gradient=f;f=b(f).replace(a._radial_gradient,function(a,b,e){l="radial";b&&e&&(b=c(b),e=c(e),0.25<k(b-0.5,2)+k(e-0.5,2)&&(e=d.sqrt(0.25-k(b-0.5,2))*(2*(0.5<e)-1)+0.5),m=b+" "+e);return""});f=f.split(/\s*\-\s*/);if("linear"==l){var n=f.shift(),n=-c(n);if(isNaN(n))return null}f=a._parseDots(f);if(!f)return null;e=e.shape||e.node;if(f.length){e.removeChild(g);g.on=!0;g.method="none";g.color=f[0].color;g.color2=f[f.length-1].color;for(var p=[],q=0,u=f.length;q<u;q++)f[q].offset&&
p.push(f[q].offset+" "+f[q].color);g.colors=p.length?p.join():"0% "+g.color;"radial"==l?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=m,g.angle=0):(g.type="gradient",g.angle=(270-n)%360);e.appendChild(g)}return 1};Element=function(b,c){this[0]=this.node=b;b.raphael=!0;this.id=a._oid++;b.raphaelid=this.id;this.Y=this.X=0;this.attrs={};this.paper=c;this.matrix=a.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!c.bottom&&(c.bottom=this);(this.prev=
c.top)&&(c.top.next=this);c.top=this;this.next=null};var A=a.el;Element.prototype=A;A.constructor=Element;A.transform=function(c){if(null==c)return this._.transform;var d=this.paper._viewBoxShift,e=d?"s"+[d.scale,d.scale]+"-1-1t"+[d.dx,d.dy]:"",f;d&&(f=c=b(c).replace(/\.{3}|\u2026/g,this._.transform||""));a._extractTransform(this,e+c);var d=this.matrix.clone(),g=this.skew;c=this.node;var e=~b(this.attrs.fill).indexOf("-"),k=!b(this.attrs.fill).indexOf("url(");d.translate(-0.5,-0.5);k||e||"image"==
this.type?(g.matrix="1 0 0 1",g.offset="0 0",g=d.split(),e&&g.noRotation||!g.isSimple?(c.style.filter=d.toFilter(),e=this.getBBox(),g=this.getBBox(1),d=e.x-g.x,e=e.y-g.y,c.coordorigin=-21600*d+" "+-21600*e,B(this,1,1,d,e,0)):(c.style.filter="",B(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate))):(c.style.filter="",g.matrix=b(d),g.offset=d.offset());f&&(this._.transform=f);return this};A.rotate=function(a,d,e){if(this.removed)return this;if(null!=a){a=b(a).split(l);a.length-1&&(d=c(a[1]),e=c(a[2]));a=c(a[0]);
null==e&&(d=e);if(null==d||null==e)e=this.getBBox(1),d=e.x+e.width/2,e=e.y+e.height/2;this._.dirtyT=1;this.transform(this._.transform.concat([["r",a,d,e]]));return this}};A.translate=function(a,d){if(this.removed)return this;a=b(a).split(l);a.length-1&&(d=c(a[1]));a=c(a[0])||0;d=+d||0;this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=d);this.transform(this._.transform.concat([["t",a,d]]));return this};A.scale=function(a,d,e,f){if(this.removed)return this;a=b(a).split(l);a.length-1&&(d=c(a[1]),e=c(a[2]),
f=c(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null));a=c(a[0]);null==d&&(d=a);null==f&&(e=f);if(null==e||null==f)var g=this.getBBox(1);e=null==e?g.x+g.width/2:e;f=null==f?g.y+g.height/2:f;this.transform(this._.transform.concat([["s",a,d,e,f]]));this._.dirtyT=1;return this};A.hide=function(){!this.removed&&(this.node.style.display="none");return this};A.show=function(){!this.removed&&(this.node.style.display="");return this};A._getBBox=function(){return this.removed?{}:"text"==this.type?{x:this.X+(this.bbx||
0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}:pathDimensions(this.attrs.path)};A.remove=function(){if(!this.removed){this.paper.__set__&&this.paper.__set__.exclude(this);a.eve.unbind("*.*."+this.id);a._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var b in this)delete this[b];this.removed=!0}};A.attr=function(b,c){if(this.removed)return this;if(null==b){var d={},e;for(e in this.attrs)this.attrs.hasOwnProperty(e)&&
(d[e]=this.attrs[e]);d.gradient&&"none"==d.fill&&(d.fill=d.gradient)&&delete d.gradient;d.transform=this._.transform;return d}if(null==c&&a.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;e=b.split(l);for(var d={},f=0,g=e.length;f<g;f++)b=e[f],b in this.attrs?d[b]=this.attrs[b]:a.is(this.paper.customAttributes[b],"function")?d[b]=this.paper.customAttributes[b].def:d[b]=a._availableAttrs[b];return g-1?d:d[e[0]]}if(this.attrs&&null==c&&a.is(b,"array")){d=
{};f=0;for(g=b.length;f<g;f++)d[b[f]]=this.attr(b[f]);return d}null!=c&&(d={},d[b]=c);null==c&&a.is(b,"object")&&(d=b);for(f in d)m("attr."+f+"."+this.id,this,d[f]);if(d){for(f in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(f)&&d.hasOwnProperty(f)&&a.is(this.paper.customAttributes[f],"function"))for(g in e=this.paper.customAttributes[f].apply(this,[].concat(d[f])),this.attrs[f]=d[f],e)e.hasOwnProperty(g)&&(d[g]=e[g]);d.text&&"text"==this.type&&(this.textpath.string=d.text);
setFillAndStroke(this,d)}return this};A.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node);this.paper&&this.paper.top!=this&&a._tofront(this,this.paper);return this};A.toBack=function(){if(this.removed)return this;this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper));return this};A.insertAfter=function(b){if(this.removed)return this;b.constructor==a.st.constructor&&(b=b[b.length-
1]);b.node.nextSibling?b.node.parentNode.insertBefore(this.node,b.node.nextSibling):b.node.parentNode.appendChild(this.node);a._insertafter(this,b,this.paper);return this};A.insertBefore=function(b){if(this.removed)return this;b.constructor==a.st.constructor&&(b=b[0]);b.node.parentNode.insertBefore(this.node,b.node);a._insertbefore(this,b,this.paper);return this};A.blur=function(b){var c=this.node.runtimeStyle,d=c.filter,d=d.replace(q,"");0!==+b?(this.attrs.blur=b,c.filter=d+"  progid:DXImageTransform.Microsoft.Blur(pixelradius="+
(+b||1.5)+")",c.margin=a.format("-{0}px 0 0 -{0}px",e(+b||1.5))):(c.filter=d,c.margin=0,delete this.attrs.blur)};a._engine.path=function(a,b){var c=D("shape");c.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";c.coordsize="21600 21600";c.coordorigin=b.coordorigin;var d=new Element(c,b),e={fill:"none",stroke:"#000"};a&&(e.path=a);d.type="path";d.path=[];d.Path="";setFillAndStroke(d,e);b.canvas.appendChild(c);e=D("skew");e.on=!0;c.appendChild(e);d.skew=e;d.transform("");return d};
a._engine.rect=function(b,c,d,e,f,g){var k=a._rectPath(c,d,e,f,g);b=b.path(k);var l=b.attrs;b.X=l.x=c;b.Y=l.y=d;b.W=l.width=e;b.H=l.height=f;l.r=g;l.path=k;b.type="rect";return b};a._engine.ellipse=function(a,b,c,d,e){a=a.path();a.X=b-d;a.Y=c-e;a.W=2*d;a.H=2*e;a.type="ellipse";setFillAndStroke(a,{cx:b,cy:c,rx:d,ry:e});return a};a._engine.circle=function(a,b,c,d){a=a.path();a.X=b-d;a.Y=c-d;a.W=a.H=2*d;a.type="circle";setFillAndStroke(a,{cx:b,cy:c,r:d});return a};a._engine.image=function(b,c,d,e,f,
g){var k=a._rectPath(d,e,f,g);b=b.path(k).attr({stroke:"none"});var l=b.attrs,m=b.node,n=m.getElementsByTagName("fill")[0];l.src=c;b.X=l.x=d;b.Y=l.y=e;b.W=l.width=f;b.H=l.height=g;l.path=k;b.type="image";n.parentNode==m&&m.removeChild(n);n.rotate=!0;n.src=c;n.type="tile";b._.fillpos=[d,e];b._.fillsize=[f,g];m.appendChild(n);B(b,1,1,0,0,0);return b};a._engine.text=function(c,d,f,g){var k=D("shape"),l=D("path"),m=D("textpath");d=d||0;f=f||0;g=g||"";l.v=a.format("m{0},{1}l{2},{1}",e(21600*d),e(21600*
f),e(21600*d)+1);l.textpathok=!0;m.string=b(g);m.on=!0;k.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";k.coordsize="21600 21600";k.coordorigin="0 0";var n=new Element(k,c),p={fill:"#000",stroke:"none",font:a._availableAttrs.font,text:g};n.shape=k;n.path=l;n.textpath=m;n.type="text";n.attrs.text=b(g);n.attrs.x=d;n.attrs.y=f;n.attrs.w=1;n.attrs.h=1;setFillAndStroke(n,p);k.appendChild(m);k.appendChild(l);c.canvas.appendChild(k);c=D("skew");c.on=!0;k.appendChild(c);n.skew=c;n.transform("");
return n};a._engine.setSize=function(a,b){var c=this.canvas.style;this.width=a;this.height=b;a==+a&&(a+="px");b==+b&&(b+="px");c.width=a;c.height=b;c.clip="rect(0 "+a+" "+b+" 0)";this._viewBox&&setViewBox.apply(this,this._viewBox);return this};a._engine.setViewBox=function(b,c,d,e,g){a.eve("setViewBox",this,this._viewBox,[b,c,d,e,g]);var k=this.width,l=this.height,m=1/f(d/k,e/l),n,p;g&&(n=l/e,p=k/d,d*n<k&&(b-=(k-d*n)/2/n),e*p<l&&(c-=(l-e*p)/2/p));this._viewBox=[b,c,d,e,!!g];this._viewBoxShift={dx:-b,
dy:-c,scale:m};this.forEach(function(a){a.transform("...")});return this};var D;(function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),D=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){D=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}})(a._g.win);a._engine.create=function(){var b=a._getContainer.apply(0,
arguments),c=b.container,d=b.height,e=b.width,f=b.x,b=b.y;if(!c)throw Error("VML container not found.");var g=new a._Paper,k=g.canvas=a._g.doc.createElement("div"),l=k.style,f=f||0,b=b||0,e=e||512,d=d||342;g.width=e;g.height=d;e==+e&&(e+="px");d==+d&&(d+="px");g.coordsize="21600000 21600000";g.coordorigin="0 0";g.span=a._g.doc.createElement("span");g.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";k.appendChild(g.span);l.cssText=a.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",
e,d);1==c?(a._g.doc.body.appendChild(k),l.left=f+"px",l.top=b+"px",l.position="absolute"):c.firstChild?c.insertBefore(k,c.firstChild):c.appendChild(k);g.renderfix=function(){};return g};a.prototype.clear=function(){a.eve("clear",this);this.canvas.innerHTML="";this.span=a._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};a.prototype.remove=function(){a.eve("remove",
this);this.canvas.parentNode.removeChild(this.canvas);for(var b in this)this[b]=removed(b);return!0};var E=a.st,G;for(G in A)A.hasOwnProperty(G)&&!E.hasOwnProperty(G)&&(E[G]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(G))}(window.Raphael);var scratchpadClear;
function Scratchpad(a){function b(){for(var a=0,b=[];a<x.length;a++)x[a].removed||"path"==x[a].type&&b.push({path:x[a].attr("path").toString(),stroke:x[a].attr("stroke"),type:"path"});B.push(b)}function c(){y.animate({y:2},100);A="draw"}function d(){y.animate({y:32},100);A="erase"}function e(){var a=B.pop();x.remove();for(var b=0;b<a.length;b++)"path"==a[b].type&&x.push(p.path(a[b].path).attr(z).attr("stroke",a[b].stroke))}function f(a,c,d){a&&c&&d&&(G&&(G.remove(),G=null),b(),d=x.length,40<a&&("draw"==
A?(D=p.path("M"+a+","+c).attr(z).attr({stroke:u}),E=D.attr("path"),x.push(D)):"erase"==A&&(G=p.rect(a,c,0,0).attr({"fill-opacity":0.15,"stroke-opacity":0.5,fill:"#ff0000",stroke:"#ff0000"}),G.sx=a,G.sy=c)),x.length==d&&B.pop())}function g(a,b){return b.x<a.x+a.width&&b.x+b.width>a.x&&b.y<a.y+a.height&&b.y+b.height>a.y}function k(a){a=a.toString().split("L");for(var b=a[0].substr(1).split(","),c=+b[0],b=+b[1],d=a[0],e=0,f=1;f<a.length;f++){var g=a[f].split(","),k=Math.pow(+g[0]-c,2)+Math.pow(+g[1]-
b,2);if(10<k||k<e||f==a.length-1)d+="L"+a[f],b=g[1],c=g[0];e=k}return d}function l(){D&&D.attr("path",k(E));D=null;if("erase"==A&&G){b();for(var a=G.getBBox(),c=0;c<x.length;c++)g(a,x[c].getBBox())&&x[c].remove();G.animate({"fill-opacity":0},100,function(){G.remove();G=null})}}function m(a,b){if(!(40>=a))if(D&&"draw"==A)E+="L"+a+","+b,D.attr("path",E);else if("erase"==A&&G){var c=Math.min(a,G.sx),d=Math.min(b,G.sy),e=Math.max(a,G.sx),f=Math.max(b,G.sy);G.attr({x:c,y:d,width:e-c,height:f-d})}}/AppleWebKit.*Mobile/.test(navigator.userAgent);
var n=jQuery(a),p=Raphael(n[0],n.width(),n.height());n.bind("resize",function(){p.setSize(n.width(),n.height())});$("body").bind("selectstart",function(a){return!1});var q=p.set(),u="#000000";a="#000000 #3f3f3f #7f7f7f #bfbfbf #ff0000 #ff7f00 #ffff00 #00ff00 #00ffff #007fff #0000ff #7f00ff".split(" ");for(var v=0;v<a.length;v++)(function(a){var b=function(b){u=a;q.animate({x:7},100);this.animate({x:15},100);c()};q.push(p.rect(7,90+24*v,24,24).attr({fill:a,stroke:""}).touchstart(b).click(b))})(a[v]);
q[0].attr({x:15});var y=p.rect(2,2,30,30).attr({r:5,stroke:"",fill:"rgba(30, 157, 186, 0.5)"}),z={"stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},x=p.set(),B=[[]];a=p.set();a.push(p.path("M25.31,2.872l-3.384-2.127c-0.854-0.536-1.979-0.278-2.517,0.576l-1.334,2.123l6.474,4.066l1.335-2.122C26.42,4.533,26.164,3.407,25.31,2.872zM6.555,21.786l6.474,4.066L23.581,9.054l-6.477-4.067L6.555,21.786zM5.566,26.952l-0.143,3.819l3.379-1.787l3.14-1.658l-6.246-3.925L5.566,26.952z").scale(0.8).translate(0,
0));a.push(p.path("M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248").translate(0,30));a.push(p.path("M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z").scale(0.7).translate(1,80));var A="draw";p.rect(2,2,30,30).attr({stroke:"",fill:"black","fill-opacity":0}).click(c).touchstart(c);
p.rect(2,32,30,30).attr({stroke:"",fill:"black","fill-opacity":0}).click(d).touchstart(d);p.rect(2,62,30,30).attr({stroke:"",fill:"black","fill-opacity":0}).click(e).touchstart(e);a.attr({fill:"#000",stroke:"none"});var D=null,E="",G=null;n.mousemove(function(a){var b=jQuery(n).offset();m(a.pageX-b.left,a.pageY-b.top);a.preventDefault()});n.mousedown(function(a){var b=jQuery(n).offset();f(a.pageX-b.left,a.pageY-b.top,a);a.preventDefault();$(document).one("mouseup",function(a){l();a.preventDefault()})});
n.bind("touchstart",function(a){var b=jQuery(n).offset();f(a.originalEvent.touches[0].pageX-b.left,a.originalEvent.touches[0].pageY-b.top,a.originalEvent);a.preventDefault()});n.bind("touchmove",function(a){var b=jQuery(n).offset();m(a.originalEvent.touches[0].pageX-b.left,a.originalEvent.touches[0].pageY-b.top);a.preventDefault()});n.bind("touchend",function(a){l();a.preventDefault()});scratchpadClear=function(){x.remove()}}
(function(a,b,c){function d(){g=b[k](function(){e.each(function(){var b=a(this),c=b.width(),d=b.height(),e=a.data(this,m);c===e.w&&d===e.h||b.trigger(l,[e.w=c,e.h=d])});d()},f[n])}var e=a([]),f=a.resize=a.extend(a.resize,{}),g,k="setTimeout",l="resize",m=l+"-special-event",n="delay";f[n]=1E3;f.throttleWindow=!0;a.event.special[l]={setup:function(){if(!f.throttleWindow&&this[k])return!1;var b=a(this);e=e.add(b);a.data(this,m,{w:b.width(),h:b.height()});1===e.length&&d()},teardown:function(){if(!f.throttleWindow&&
this[k])return!1;var b=a(this);e=e.not(b);b.removeData(m);e.length||clearTimeout(g)},add:function(b){function d(b,f,g){var k=a(this),l=a.data(this,m);l.w=f!==c?f:k.width();l.h=g!==c?g:k.height();e.apply(this,arguments)}if(!f.throttleWindow&&this[k])return!1;var e;if(a.isFunction(b))return e=b,d;e=b.handler;b.handler=d}}})(jQuery,this);var equalSrc=builder_path+"/images/equal.png";(new Image).src=equalSrc;var infoSrc=builder_path+"/images/note.png";(new Image).src=infoSrc;
function mxIconSet(a){this.images=[];var b=["mousedown","touchstart"],c=orig(a.cell);if(0!==getOpacity(c)){if(isValued(c)||"Action"==c.value.nodeName){var d=mxUtils.createImage(equalSrc);d.setAttribute("title","");d.style.position="absolute";d.style.cursor="pointer";d.style.width="16px";d.style.height="16px";d.style.left=a.x+2+"px";d.style.top=a.y+2+"px";2>a.width&&(d.style.left=a.x+a.width-20);b.forEach(function(a){mxEvent.addListener(d,a,mxUtils.bind(this,function(a){showEditor(c);mxEvent.consume(a)}))});
a.view.graph.container.appendChild(d);this.images.push(d)}null!=c.value.getAttribute("Note")&&""!=Ext.String.trim(c.value.getAttribute("Note"))&&(d=mxUtils.createImage(infoSrc),d.setAttribute("title",""),d.style.position="absolute",d.style.cursor="pointer",d.style.width="16px",d.style.height="16px",d.style.left=a.x+a.width-18+"px",d.style.top=a.y+2+"px",2>a.width&&(d.style.left=a.x+2),b.forEach(function(a){mxEvent.addListener(d,a,mxUtils.bind(this,function(a){var b=Ext.getCmp("note"+c.id);isUndefined(b)?
(b=new Ext.ToolTip({html:"<big>"+clean(c.value.getAttribute("Note").replace(/\n/g,"<br/>"))+"</big>",autoHide:!1,closable:!0,width:300,draggable:!0,id:"note"+c.id,title:clean(c.value.getAttribute("name")),closeAction:"destroy"}),a.clientX?b.showAt([a.clientX+17,a.clientY-8]):b.showAt(getPosition(c)),mxEvent.consume(a)):b.destroy()}))}),a.view.graph.container.appendChild(d),this.images.push(d))}}
mxIconSet.prototype.destroy=function(){if(null!=this.images)for(var a=0;a<this.images.length;a++){var b=this.images[a];b.parentNode.removeChild(b)}this.images=null};
function setupHoverIcons(){var a=function(a,b){if(null!=this.currentState&&(b.getState()==this.currentState||null==b.getState())){var e=new mxRectangle(b.getGraphX()-20,b.getGraphY()-20,40,40);if(mxUtils.intersects(e,this.currentState))return}e=graph.view.getState(b.getCell());if(graph.isMouseDown||null!=e&&!graph.getModel().isEdge(e.cell)&&!graph.getModel().isVertex(e.cell))e=null;e!=this.currentState&&(null!=this.currentState&&this.dragLeave(b.getEvent(),this.currentState),this.currentState=e,null!=
this.currentState&&this.dragEnter(b.getEvent(),this.currentState))},b={currentState:null,currentIconSet:null,mouseDown:function(a,b){null!=this.currentState&&(this.dragLeave(b.getEvent(),this.currentState),this.currentState=null)},mouseMove:a,mouseUp:a,dragEnter:function(a,b){null==this.currentIconSet&&(this.currentIconSet=new mxIconSet(b))},dragLeave:function(a,b){null!=this.currentIconSet&&(this.currentIconSet.destroy(),this.currentIconSet=null)}};graph.addMouseListener(b);graph.addListener(mxEvent.CELLS_REMOVED,
function(a,d){null!=b.currentIconSet&&(b.currentIconSet.destroy(),b.currentIconSet=null)})};var findAndReplaceWin;
function showFindAndReplace(){if(!findAndReplaceWin){var a=new Ext.FormPanel({fieldDefaults:{labelWidth:120,width:485},margin:"5 5 5 10",autoScroll:!0,frame:!1,defaultType:"textfield",items:[{xtype:"textareafield",fieldLabel:getText("Search Text"),name:"frSearchData",id:"frSearchData",selectOnFocus:!0,height:60,listeners:{change:function(a,c,d){Ext.getCmp("findNextBut").setDisabled(!0)}}},{xtype:"textareafield",fieldLabel:getText("Replace Text"),name:"frReplaceData",id:"frReplaceData",allowBlank:!0,
selectOnFocus:!0,height:60},{xtype:"checkboxgroup",fieldLabel:getText("Search in"),items:[{boxLabel:getText("Names"),inputValue:"1",name:"frSearchNames",id:"frSearchNames",value:"1",checked:!0,width:90},{boxLabel:getText("Notes"),inputValue:"1",name:"frSearchNotes",id:"frSearchNotes",width:90},{boxLabel:getText("Equations"),inputValue:"1",name:"frSearchValues",id:"frSearchValues",width:90}]},{xtype:"checkboxfield",fieldLabel:getText("Case Sensitive"),inputValue:"1",name:"frCaseSensitive",id:"frCaseSensitive"}]});
findAndReplaceWin=new Ext.Window({title:getText("Find and Replace"),layout:"fit",closeAction:"hide",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},width:524,height:355,items:[a],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){findAndReplaceWin.hide()}},"->",{scale:"large",text:getText("Replace All"),handler:function(){var a=primitives(),c=Ext.getCmp("frSearchData").getValue().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),
d=Ext.getCmp("frReplaceData").getValue(),e=Ext.getCmp("frSearchNames").getValue(),f=Ext.getCmp("frSearchValues").getValue(),g=Ext.getCmp("frSearchNotes").getValue(),c=Ext.getCmp("frCaseSensitive").getValue()?RegExp(c,"g"):RegExp(c,"ig");if(e||f||g){graph.getModel().beginUpdate();for(var k=0;k<a.length;k++){var l=a[k];l.isVisible()&&(e&&getName(l)&&setName(l,getName(l).replace(c,d)),g&&getNote(l)&&setNote(l,getNote(l).replace(c,d)),f&&getValue(l)&&setValue(l,getValue(l).replace(c,d)))}graph.getModel().endUpdate();
findAndReplaceWin.hide()}else showNotification(getText("You must search within at least one category."),"error",!0)}},{scale:"large",text:getText("Find Next"),disabled:!0,id:"findNextBut",tooltip:cmd("G"),handler:function(){findNext()}},{scale:"large",glyph:61452,text:getText("Find"),handler:function(){findFirst()}}]})}findAndReplaceWin.show();Ext.getCmp("frSearchData").focus(!0,100)}var currentFindPrimitive;
function findNext(){var a=primitives(),b=Ext.getCmp("frSearchData").getValue().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),c=Ext.getCmp("frSearchNames").getValue(),d=Ext.getCmp("frSearchValues").getValue(),e=Ext.getCmp("frSearchNotes").getValue(),b=Ext.getCmp("frCaseSensitive").getValue()?RegExp(b):RegExp(b,"i");if(c||d||e){var f=0;if(currentFindPrimitive)for(var g=0;g<a.length;g++)if(currentFindPrimitive.id==a[g].id){f=g+1;break}f>=a.length&&(f=0);var k=2;for(0==f&&(k=1);0<k;){for(g=f;g<
a.length;g++)if(currentFindPrimitive=f=a[g],f.isVisible()){if(c&&getName(f)&&-1!=getName(f).search(b)){highlight(f);findAndReplaceWin.hide();return}if(e&&getNote(f)&&-1!=getNote(f).search(b)){highlight(f);findAndReplaceWin.hide();showNote(f);return}if(d&&getValue(f)&&-1!=getValue(f).replace("/\\n/g","\n").search(b)){highlight(f);findAndReplaceWin.hide();showEditor(f);return}}k--;f=0}showNotification(getText("Search text not found in model."),"notice",!0)}else showNotification(getText("You must search within at least one category."),
"error",!0)}function findFirst(){Ext.getCmp("findNextBut").setDisabled(!1);currentFindPrimitive=null;findNext()};var timeSettingsFn=function(){var a=getSetting();showTimeSettings({algorithm:a.getAttribute("SolutionAlgorithm"),timeStep:a.getAttribute("TimeStep"),timeStart:a.getAttribute("TimeStart"),timeUnits:a.getAttribute("TimeUnits"),timeLength:a.getAttribute("TimeLength"),timePause:a.getAttribute("TimePause")})};
function showTimeSettings(a){var b=new Ext.Window({layout:"fit",closeAction:"destroy",modal:!0,tools:[{type:"help",tooltip:getText("Get Help"),callback:function(a,b,e){showURL("/simulating")}}],title:getText("Simulation Time Settings"),width:Math.min(Ext.getBody().getViewSize().width,370),height:Math.min(Ext.getBody().getViewSize().height,a.cell?280:550),resizable:!1,items:[new Ext.FormPanel({fieldDefaults:{labelWidth:150},autoScroll:!0,frame:!0,bodyStyle:"padding: 12px 0px 0px 15px",width:450,defaults:{width:330},
id:"timeSettingsForm",defaultType:"textfield",items:[new Ext.form.field.Checkbox({hidden:!a.cell,fieldLabel:getText("Custom Time Settings"),id:"sEnabled",checked:a.enabled,listeners:{change:function(a,b,e){Ext.getCmp("sSolutionAlgo").setDisabled(!b);Ext.getCmp("stimestep").setDisabled(!b)}}}),new Ext.form.NumberField({hidden:a.cell,fieldLabel:getText("Simulation Start"),id:"stimestart",allowBlank:!1,minValue:0,decimalPrecision:12,value:a.timeStart}),new Ext.form.NumberField({hidden:a.cell,fieldLabel:getText("Simulation Length"),
id:"stimelength",allowBlank:!1,minValue:0,decimalPrecision:12,value:a.timeLength}),{hidden:a.cell,xtype:"radiogroup",id:"tunits",fieldLabel:getText("Time Units"),columns:1,items:[{boxLabel:getText("Seconds"),name:"tunits",inputValue:"Seconds",checked:"Seconds"==a.timeUnits},{boxLabel:getText("Minutes"),name:"tunits",inputValue:"Minutes",checked:"Minutes"==a.timeUnits},{boxLabel:getText("Hours"),name:"tunits",inputValue:"Hours",checked:"Hours"==a.timeUnits},{boxLabel:getText("Days"),name:"tunits",
inputValue:"Days",checked:"Days"==a.timeUnits},{boxLabel:getText("Weeks"),name:"tunits",inputValue:"Weeks",checked:"Weeks"==a.timeUnits},{boxLabel:getText("Months"),name:"tunits",inputValue:"Months",checked:"Months"==a.timeUnits},{boxLabel:getText("Years"),name:"tunits",inputValue:"Years",checked:"Years"==a.timeUnits}]},new Ext.form.NumberField({hidden:a.cell,fieldLabel:getText("Pause Interval"),id:"stimepause",allowBlank:!0,minValue:0,emptyText:"No Pause",decimalPrecision:12,value:a.timePause}),
new Ext.form.ComboBox({fieldLabel:getText("Analysis Algorithm"),typeAhead:!0,triggerAction:"all",queryMode:"local",selectOnFocus:!0,forceSelection:!0,store:[["RK1",getText("Fast (Euler)")],["RK4",getText("Accurate (RK4)")]],id:"sSolutionAlgo",editable:!0,value:a.algorithm,disabled:a.cell&&!a.enabled}),new Ext.form.NumberField({fieldLabel:getText("Simulation Time Step"),id:"stimestep",allowBlank:!1,minValue:1E-12,step:0.1,decimalPrecision:12,value:a.timeStep,disabled:a.cell&&!a.enabled})],buttons:[{xtype:"button",
scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){b.close()}},{xtype:"button",glyph:61452,scale:"large",text:getText("Apply"),handler:function(){linkedResults=void 0;Ext.WindowMgr.each(function(a){(a=a.down("#pinTool"))&&a.hide()});graph.getModel().beginUpdate();if(a.cell)d=new mxCellAttributeChange(a.cell,"Solver",JSON.stringify({enabled:Ext.getCmp("sEnabled").getValue(),timeStep:Ext.getCmp("stimestep").getValue().toString(),algorithm:Ext.getCmp("sSolutionAlgo").getValue()}));else{var c=
getSetting(),d=new mxCellAttributeChange(c,"SolutionAlgorithm",Ext.getCmp("sSolutionAlgo").getValue());graph.getModel().execute(d);d=new mxCellAttributeChange(c,"TimeLength",Ext.getCmp("stimelength").getValue().toString());graph.getModel().execute(d);d=new mxCellAttributeChange(c,"TimeStart",Ext.getCmp("stimestart").getValue().toString());graph.getModel().execute(d);d=new mxCellAttributeChange(c,"TimeStep",Ext.getCmp("stimestep").getValue().toString());graph.getModel().execute(d);d=new mxCellAttributeChange(c,
"TimePause",Ext.getCmp("stimepause").getValue());graph.getModel().execute(d);d=new mxCellAttributeChange(c,"TimeUnits",Ext.getCmp("timeSettingsForm").getValues().tunits)}graph.getModel().execute(d);graph.getModel().endUpdate();b.close()}}]})]});b.show();return b};function textEquations(){function a(a){return isTrue(a)?getText("Yes"):getText("No")}function b(a){for(var b="",c=0;c<a.length;c++)b=b+"<li><b>"+a[c][0]+":</b> "+(/<br>/.test(a[c][1])?"<br/>":"")+a[c][1]+"</li>";return"<ul style='list-style-type: none;'>"+b+"</ul>"}function c(a,b){k=k+"<tr class='textRow"+(l?"Odd":"Even")+"'><td class='textName'>"+a+"</td><td>"+b+"</td></tr>";l=!l}function d(a){k=k+"<tr class='textDivider'><td colspan=2>"+a+"</td></tr>";l=!0}function e(a){return a&&null!=a?clean(a.getAttribute("name")):
"<i>"+getText("None")+"</i>"}function f(a,b){b.getAttribute("Note")&&a.push([getText("Note"),clean(b.getAttribute("Note"))]);return a}function g(a){a=primitives(a);a.sort(function(a,b){return e(a).toUpperCase()>e(b).toUpperCase()?1:-1});return a}var k="<table style='width:100%'>",l=!0,m=getSetting();c("Simulation Settings",b([[getText("Time Start"),clean(m.getAttribute("TimeStart"))],[getText("Time Length"),clean(m.getAttribute("TimeLength"))],[getText("Time Step"),clean(m.getAttribute("TimeStep"))],
[getText("Time Units"),clean(m.getAttribute("TimeUnits"))],[getText("Algorithm"),clean(m.getAttribute("SolutionAlgorithm"))]]));n=g("Variable");if(0<n.length)for(d(getText("Model Variables")),m=0;m<n.length;m++)c(e(n[m]),b(f([[getText("Value"),equationRenderer(getValue(n[m]),!0)],[getText("Units"),clean(n[m].getAttribute("Units"))]],n[m])));var n=g("Stock");if(0<n.length)for(d(getText("Model Stocks")),m=0;m<n.length;m++)c(e(n[m]),b(f([[getText("Initial Value"),equationRenderer(getValue(n[m]),!0)],
[getText("Non-Negative"),a(n[m].getAttribute("NonNegative"))],[getText("Units"),clean(n[m].getAttribute("Units"))]],n[m])));n=g("Flow");if(0<n.length)for(d(getText("Model Flows")),m=0;m<n.length;m++)c(e(n[m]),b(f([[getText("Rate"),equationRenderer(getValue(n[m]),!0)],[getText("Alpha"),clean(e(n[m].source))],[getText("Omega"),clean(e(n[m].target))],[getText("Positive Only"),a(n[m].getAttribute("OnlyPositive"))],[getText("Units"),clean(n[m].getAttribute("Units"))]],n[m])));n=g("Converter");if(0<n.length)for(d(getText("Model Converters")),
m=0;m<n.length;m++)c(e(n[m]),b(f([[getText("Data"),clean(getValue(n[m]).replace(/\;/g,"; "))],[getText("Source"),clean("Time"==n[m].getAttribute("Source")?"Time":e(findID(n[m].getAttribute("Source"))))],[getText("Interpolation"),getText(clean(n[m].getAttribute("Interpolation")))],[getText("Units"),clean(n[m].getAttribute("Units"))]],n[m])));n=g("State");if(0<n.length)for(d(getText("Model States")),m=0;m<n.length;m++)c(e(n[m]),b(f([[getText("Initial Active"),equationRenderer(getValue(n[m]),!0)]],n[m])));
n=g("Transition");if(0<n.length)for(d(getText("Model Transitions")),m=0;m<n.length;m++)c(e(n[m]),b(f([[getText("Trigger"),clean(n[m].getAttribute("Trigger"))],[getText("Value"),equationRenderer(getValue(n[m]),!0)]],n[m])));n=g("Action");if(0<n.length)for(d(getText("Model Actions")),m=0;m<n.length;m++)c(e(n[m]),b(f([[getText("Trigger"),clean(n[m].getAttribute("Trigger"))],[getText("Trigger Value"),equationRenderer(n[m].getAttribute("Value"),!0)],[getText("Action"),equationRenderer(getValue(n[m]),!0)]],
n[m])));k+="</table>";Ext.create("Ext.tab.Panel",{xtype:"tabpanel",layout:"fit",activeTab:0,plain:!0,flex:1,items:[{title:getText("Insight Equations"),xtype:"box",html:k,style:"background-color: white",autoScroll:!0},{padding:4,title:getText("Full Insight Specification"),xtype:"container",layout:{type:"vbox",align:"middle"},items:[{xtype:"box",margin:6,html:getText("Complete Insight specification including equations and styling. You may download this as a file and later import it back into Insight Maker."),
width:"100%"},{flex:1,margin:6,readOnly:!0,xtype:"textareafield",hideLabel:!0,value:getGraphXml(graph).replace(/mxGraphModel/g,"InsightMakerModel"),width:"100%"},{text:getText("Download"),xtype:"button",margin:3,handler:function(){(new mxXmlRequest(builder_path+"/download.php",$.param({name:"Model",format:"InsightMaker",data:getGraphXml(graph).replace(/mxGraphModel/g,"InsightMakerModel")}))).simulate(document,"_blank")}}]}]});var p=new Ext.Window({title:getText("Complete Model Equation List"),layout:"fit",
closeAction:"destroy",border:!1,modal:!0,maximizable:!0,resizable:!0,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,600),height:Math.min(Ext.getBody().getViewSize().height,500),items:[{title:getText("Insight Equations"),xtype:"box",html:k,style:"background-color: white",autoScroll:!0}],buttons:["->",{scale:"large",glyph:61452,text:getText("Done"),handler:function(){p.close()}}]});p.show()};function getStyleSheet(){return JSON.parse(getSetting().getAttribute("StyleSheet"))}function setStyleSheet(a){a=new mxCellAttributeChange(getSetting(),"StyleSheet",JSON.stringify(a));graph.getModel().execute(a)}
function loadStyleSheet(){var a=mxUtils.parseXml('<mxStylesheet> \t<add as="defaultVertex" extend="defaultVertex">  \t\t<add as="strokeColor" value="#666666"/> \t\t<add as="fontColor" value="#333333"/>  <add as="overflow" value=""/> \t\t<add as="fontSize" value="14"/> \t\t<add as="fontFamily" value="Comic Sans MS"/> \t\t<add as="strokeWidth" value="2"/> \t</add> \t<add as="defaultEdge" extend="defaultEdge"> \t\t<add as="labelBackgroundColor" value="white"/> \t\t<add as="rounded" value="1"/> \t\t<add as="fontSize" value="14"/> \t\t<add as="edgeStyle" value="elbowEdgeStyle"/> \t\t<add as="fontFamily" value="Comic Sans MS"/> \t\t<add as="strokeWidth" value="4"/> \t</add> \t<add as="stock" extend="defaultVertex"> \t\t<add as="fillColor" value="#A6D3F8"/> \t</add> \t<add as="state" extend="defaultVertex"> \t<add as="rounded" value="1"/> \t<add as="fillColor" value="#ffffff"/> \t</add> \t<add as="transition" extend="defaultEdge"> \t\t<add as="strokeColor" value="#000000"/> \t\t<add as="fontColor" value="#000000"/> \t</add> \t<add as="agents" extend="defaultVertex"> \t\t<add as="fillColor" value="#F0E68C"/> \t\t<add as="shape" value="cloud"/> \t</add> \t<add as="textArea" extend="defaultVertex"> \t\t<add as="strokeColor" value="none"/> \t\t<add as="fillColor" value="none"/> \t\t<add as="fontColor" value="black"/> \t\t<add as="fontSize" value="30"/> \t\t<add as="fontStyle" value="4"/> \t</add> \t<add as="text" extend="defaultVertex"> \t\t<add as="strokeColor" value="none"/> \t\t<add as="fillColor" value="none"/> \t\t<add as="fontColor" value="black"/> \t\t<add as="fontSize" value="30"/> \t\t<add as="fontStyle" value="4"/> \t</add> \t \t<add as="parameter" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#FDCDAC"/> \t</add> \t<add as="variable" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#FDCDAC"/> \t</add> \t<add as="action" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#FFFFFF"/> \t</add> \t<add as="converter" extend="defaultVertex"> \t\t<add as="shape" value="hexagon"/> \t<add as="spacingLeft" value="20"/> <add as="spacingRight" value="20"/>\t<add as="perimeter" value="hexagonPerimeter"/> \t\t<add as="fillColor" value="#B3E2CD"/> \t</add> \t<add as="button" extend="defaultVertex"> \t\t<add as="rounded" value="1"/> \t\t<add as="glass" value="1"/> \t\t<add as="fillColor" value="#C0C0C0"/> \t\t<add as="fontColor" value="black"/> \t\t<add as="strokeWidth" value="3"/> \t\t<add as="fontFamily" value="Helvetica"/> \t</add> \t<add as="display" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="fillColor" value="#FFFFFF"/> \t\t<add as="strokeColor" value="#FFFFFF"/> \t\t<add as="fontColor" value="#FFFFFF"/> \t\t<add as="opacity" value="0"/> \t</add> \t<add as="picture" extend="defaultVertex"> \t\t<add as="shape" value="image"/> \t\t<add as="verticalLabelPosition" value="bottom"/> \t\t<add as="verticalAlign" value="top"/> \t</add> \t \t<add as="entity" extend="defaultEdge"> \t\t<add as="strokeColor" value="#808080"/> \t\t<add as="fontColor" value="#808080"/> \t\t<add as="opacity" value="70"/> \t\t<add as="edgeStyle" value="straight"/> \t\t<add as="strokeWidth" value="2"/> \t\t<add as="dashed" value="1"/> \t\t<add as="noLabel" value="0"/> \t</add> \t<add as="flow" extend="defaultEdge"> \t</add> \t<add as="link" extend="defaultEdge"> \t\t<add as="strokeColor" value="#808080"/> \t\t<add as="fontColor" value="#808080"/> \t\t<add as="opacity" value="70"/> \t\t<add as="edgeStyle" value="straight"/> \t<add as="curved" value="1"/> \t<add as="strokeWidth" value="2"/> \t\t<add as="dashed" value="1"/> \t\t<add as="noLabel" value="0"/> \t</add> \t \t<add as="line" extend="defaultVertex"> \t\t<add as="shape" value="line"/> \t\t<add as="strokeWidth" value="4"/> \t\t<add as="labelBackgroundColor" value="white"/> \t\t<add as="verticalAlign" value="top"/> \t\t<add as="spacingTop" value="8"/> \t</add> \t<add as="image" extend="defaultVertex"> \t\t<add as="shape" value="image"/> \t\t<add as="verticalLabelPosition" value="bottom"/> \t\t<add as="verticalAlign" value="top"/> \t</add> \t \t<add as="folder" extend="defaultVertex"> \t\t<add as="verticalAlign" value="top"/> \t\t<add as="dashed" value="1"/> \t\t<add as="fillColor" value="none"/> \t\t<add as="rounded" value="1"/> \t</add> </mxStylesheet> ');(new mxCodec(a)).decode(a.documentElement,
graph.getStylesheet());var a=getStyleSheet(),b;for(b in a)graph.getStylesheet().putCellStyle(b.toLowerCase(),a[b]);graph.refresh()}
function showStyleManager(){var a=new Ext.Window({title:getText("Style Sheet Manager"),layout:{type:"vbox",align:"stretch"},closeAction:"hide",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},width:500,height:310,items:[{xtype:"container",layout:{type:"hbox",align:"middle"},padding:5,items:[{xtype:"box",flex:1},{xtype:"button",text:getText("Download Style Sheet"),glyph:61677,handler:function(){(new mxXmlRequest(builder_path+"/download.php",$.param({name:"Insight Maker Style Sheet",
format:"json",data:JSON.stringify(getStyleSheet())}))).simulate(document,"_blank")},margin:4},{xtype:"button",text:getText("Load Style Sheet"),glyph:61678,handler:function(){openFile({read:"text",multiple:!1,onCompleted:function(b){b=JSON.parse(b.contents);setStyleSheet(b);loadStyleSheet();mxUtils.alert("The style sheet has been loaded.","notice");a.close()}})},margin:4},{xtype:"box",flex:1}]},{xtype:"box",margin:9,html:"The style sheet controls the default appearence of primitives  in the insight. Select a primitive and choose 'Use as Default Style' to add its current styling to the style sheet. Properties like font, font size, and background color will be copied to other primitives of the same type. You can  download style sheets for sharing or reuse."},
{xtype:"container",layout:{type:"hbox",align:"middle"},padding:5,items:[{xtype:"box",flex:1},{xtype:"button",text:getText("Reset Style Sheet"),glyph:61534,handler:function(){graph.getModel().beginUpdate();setStyleSheet({});graph.getModel().endUpdate();loadStyleSheet();mxUtils.alert("The style sheet has been reset.","notice")},margin:4},{xtype:"box",flex:1}]}],buttons:["->",{scale:"large",glyph:61452,text:getText("Done"),handler:function(){a.close()}}]});a.show()};var RichTextEditor=Ext.extend(Ext.form.TextField,{enableKeyEvents:!1,selectOnFocus:!0,triggers:{edit:{hideOnReadOnly:!1,handler:function(){this.editorWindow=new RichTextWindow({parent:this,html:this.getValue()});this.editorWindow.show()}}},listeners:{keydown:function(a){a.setEditable(!1)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
function RichTextWindow(a){var b=new Ext.Window({title:getText("Note Editor"),layout:{type:"fit"},closeAction:"destroy",border:!1,modal:!0,resizable:!0,maximizable:!0,stateful:is_editor&&!is_embed,stateId:"richtext_window",shadow:!0,buttonAlign:"right",width:Math.min(Ext.getBody().getViewSize().width,520),height:Math.min(Ext.getBody().getViewSize().height,400),items:[new Ext.form.field.HtmlEditor({enableColors:!1,enableSourceEdit:!0,enableFont:!1,enableLists:!0,enableFontSize:!1,fieldLabel:"",name:"richTextItem",
id:"richTextItem",allowBlank:!0,emptyText:getText("Enter a Note..."),value:a.html})],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){b.close();""!=a.parent&&a.parent.resumeEvents()}},{scale:"large",glyph:61452,text:getText("Apply"),handler:function(){""!=a.parent?(editingRecord.set("value",Ext.getCmp("richTextItem").getValue()),saveConfigRecord(editingRecord)):(graph.getModel().beginUpdate(),setNote(a.cell,Ext.getCmp("richTextItem").getValue()),graph.getModel().endUpdate(),
selectionChanged(!1));b.close()}}]});this.show=function(){b.show()}};var JavaScriptEditor=Ext.extend(Ext.form.field.TextArea,{enableKeyEvents:!0,selectOnFocus:!0,disableKeyFilter:!0,triggers:{edit:{hideOnReadOnly:!1,handler:function(){this.editorWindow=new JavaScriptWindow({parent:this,code:this.getValue()});this.editorWindow.show()}}},listeners:{keydown:function(a){a.setEditable(!0)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
function JavaScriptWindow(a){var b=new Ext.ux.AceEditor({mode:"javascript",value:a.code}),c=new Ext.Window({title:getText("JavaScript Editor"),layout:{type:"fit"},tools:[{type:"help",tooltip:getText("Get Help"),callback:function(a,b,c){showURL("/sites/default/files/API/files/API-js.html")}}],closeAction:"destroy",border:!1,modal:!0,resizable:!0,maximizable:!0,stateful:is_editor&&!is_embed,stateId:"js_window",shadow:!0,buttonAlign:"right",width:Math.min(Ext.getBody().getViewSize().width,520),height:Math.min(Ext.getBody().getViewSize().height,
400),items:[b],buttons:[{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){c.close();""!=a.parent&&a.parent.resumeEvents()}},{scale:"large",glyph:61452,text:getText("Apply"),handler:function(){""!=a.parent?(editingRecord.set("value",b.getValue()),saveConfigRecord(editingRecord)):(graph.getModel().beginUpdate(),setNote(a.cell,b.getValue()),graph.getModel().endUpdate(),selectionChanged(!1));c.close()}}]});this.show=function(){c.show();b.focus(!0,!0);b.editor.focus();setTimeout(function(){b.editor.focus()},
100)}};function showInsertModelWindow(a){Ext.Msg.prompt("Insert Insight Maker Model","Enter the URL for the Insight Maker model you wish to insert (e.g. <i>"+base_path+"/insight/1234</i>). This model will be inserted as a component into your current model.",function(b,c){if("ok"==b){var d=Ext.MessageBox.wait(getText("Inserting Model..."),void 0,{icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0,progressText:" "});$.ajax({url:c,dataType:"html",success:function(b){var c=b.match(/var graph_source_data = (".*?");\n/);
if(c&&""!=c[1].trim()){var g=JSON.parse(c[1]),c=JSON.parse(b.match(/var graph_title = (".*?");\n/)[1]);b=JSON.parse(b.match(/var graph_description = (".*?");\n/)[1]);g=mxUtils.parseXml(g);g=(new mxCodec(g)).decode(g.documentElement).cells;graph.getModel().beginUpdate();var c=createPrimitive(c,"Folder",[a.x,a.y],[100,100]),g=g[1].children,g=excludeType(g,"Setting"),g=excludeType(g,"Display"),k=graph.getEdgeValidationError;graph.getEdgeValidationError=function(){return mxGraph.prototype.getEdgeValidationError.apply(this,
arguments)};graph.importCells(g,0,0,c);graph.getEdgeValidationError=k;setImage(c,"Plugin");setNote(c,b);b=c.geometry;b.alternateBounds=new mxRectangle(0,0,128,128);graph.getModel().setGeometry(c,b);collapseFolder(c);c.setAttribute("LabelPosition","Bottom");setLabelPosition(c);graph.getModel().endUpdate();clearPrimitiveCache();setAllConnectable()}else mxUtils.alert("Model could not be inserted. Please ensure the model URL is correct.");d.close()},error:function(){mxUtils.alert("Model could not be inserted. Please ensure the morel URL is correct.");
d.close()}})}})}function importMXGraph(a){graph_source_data=a.replace(/InsightMakerModel/g,"mxGraphModel");a=mxUtils.parseXml(graph_source_data);(new mxCodec(a)).decode(a.documentElement,graph.getModel());clearPrimitiveCache();setAllConnectable()}
function importSimgua(a){function b(a){return null==a?c:a}clearModel();graph.getModel().beginUpdate();var c=createPrimitive("temp stock xyzz","Stock",[200,200],[100,100]);a=a.split("\n");for(var d=0;d<a.length;d++){var e=a[d].split(" --- "),f=e[0];if("STOCK"==f){var g=createPrimitive(e[1],"Stock",[500*Math.random(),500*Math.random()],[100,40]);setValue(g,e[3]);setNonNegative(g,"true"==e[2])}else"VARIABLE"==f?(g=createPrimitive(e[1],"Variable",[500*Math.random(),500*Math.random()],[120,50]),setValue(g,
e[2])):"CONVERTER"==f?(g=createPrimitive(e[1],"Converter",[500*Math.random(),500*Math.random()],[120,50]),setData(g,e[4]),setInterpolation(g,1==e[2]?"Linear":"Discrete")):"SETTING"==f&&(setTimeStart(e[1]),setTimeLength(e[2]),setTimeStep(e[3]))}for(d=0;d<a.length;d++)e=a[d].split(" --- "),f=e[0],"FLOW"==f&&(g=createConnector(e[1],"Flow",b(findName(e[2])),b(findName(e[3]))),setValue(g,e[5]),setNonNegative(g,"true"==e[4]));for(d=0;d<a.length;d++)e=a[d].split(" --- "),f=e[0],"LINK"==f?g=createConnector(e[1],
"Link",findName(e[2]),findName(e[3])):"CONVERTER"==f&&setConverterInput(findName(e[1]),findName(e[3]));layoutModel("organic");graph.getModel().endUpdate()}
function cleanMXGraphSnippet(a){var b=""+Math.floor(1E4*Math.random());a=a.replace(/parent=\"1\"/g,"XXXROOT PARENTXXX");a=a.replace(/id=\"(\d+)\"/g,'id="'+b+'$1"');a=a.replace(/source=\"(\d+)\"/g,'source="'+b+'$1"');a=a.replace(/Source=\"(\d+)\"/g,'Source="'+b+'$1"');a=a.replace(/target=\"(\d+)\"/g,'target="'+b+'$1"');a=a.replace(/parent=\"(\d+)\"/g,'parent="'+b+'$1"');a=a.replace(/Agent=\"(\d+)\"/g,'Agent="'+b+'$1"');a=a.replace(/Primitives=\"([\d\,]+)\"/g,'Primitives="'+b+'$1"');a=a.replace(/Primitives2=\"([\d\,]+)\"/g,
'Primitives2="'+b+'$1"');return a=a.replace(/XXXROOT PARENTXXX/g,'parent="1"')}function cleanMXGraph(){var a=prompt("Enter mxGraphXML:");console.log(cleanMXGraphSnippet(a))}function importInsightMaker(){openFile({read:"text",multiple:!1,onCompleted:function(a){importMXGraph(a.contents)}})}
function importXMILE(){openFile({read:"text",multiple:!0,onCompleted:function(a){function b(a){return a?a.replace(/_/g," ").replace(/\\n/g," "):a}function c(a){return a.array?(a="{\n"+a.array.map(function(a){return'\t"'+b(a._subscript)+'": '+d(a.eqn)}).join(",\n"),a+"\n}"):d(a.eqn)}function d(a){if(!a)return a;a=a.replace(/\n/g," ");a=a.replace(/\[(.*?)\]/g,'{"$1"}');a=a.replace(/([a-zA-z][^ ()+*/+\-,.\[\]{}\>\<\=\!\|]+) *([+*/\-\),.\[\]{}\>\<\=\!\|\&]|$)/g,function(a,c,d){return"["+b(c)+"]"+d});
a=a.replace(/\{\"\[/g,'{"').replace(/\"\]\}/g,'"}');a=a.replace(/[a-zA-Z]+\./g,"");return a=a.replace(/^(if\s+.*\s+then)\s+(.*)\s+else\s+(.*)\s*$/ig,"$1\n  $2\nelse\n  $3\nend if")}function e(a){return a?a.forEach?a:[a]:[]}function f(a,c){a.alias&&(a=a.alias._uid);var d=k[b(a)];c&&delete k[b(a)];return d}var g=Ext.MessageBox.show({msg:getText("Importing XMILE model...<br/><br/>This may take a few minutes."),icon:"run-icon",width:300,closable:!1,modal:!0}),k={},l={},m={};setTimeout(function(){try{var d=
new X2JS,p;try{var q=a.map(function(a){p=a.name;a=d.xml_str2json(a.contents);if(!a.xmile)throw"Invalid XMILE";return a.xmile})}catch(u){showNotification("Import was unsuccessful. '"+p+"' is not a valid XMILE model.");g.close();return}isLocal()&&(console.log("Import Objects:"),console.log(q));setTimeStart(q[0].sim_specs.start);setTimeStep(q[0].sim_specs.dt);setTimeLength(q[0].sim_specs.stop-q[0].sim_specs.start);var v="int(x) <- floor(x)",y={};q.forEach(function(a){k={};l={};m={};a.dimensions&&a.dimensions.dim&&
e(a.dimensions.dim).forEach(function(a){y[a._name]=a});a.model.aux=e(a.model.aux);a.model.flow=e(a.model.flow);a.model.stock=e(a.model.stock);e(a.model.array).forEach(function(b){b.stock&&(a.model.stock.push(b),b.array=b.stock);b.aux&&(a.model.aux.push(b),b.array=b.aux);b.flow&&(a.model.flow.push(b),b.array=b.flow)});e(a.model.aux).forEach(function(a){var d=createPrimitive(b(a._name),"Variable",[1.1*a.display._x,1.1*a.display._y],[100,50]);k[b(a._name)]=d;setValue(d,c(a));a.doc&&setNote(d,a.doc)});
e(a.model.stock).forEach(function(a){var d=createPrimitive(b(a._name),"Stock",[1.1*a.display._x,1.1*a.display._y],[100,40]);setValue(d,c(a));setNonNegative(d,!!a.non_negative);k[b(a._name)]=d;a.doc&&setNote(d,a.doc);a.inflow&&e(a.inflow).forEach(function(a){m[a]=d});a.outflow&&e(a.outflow).forEach(function(a){l[a]=d})});e(a.model.flow).forEach(function(a){var d=createConnector,e=b(a._name),f;f=a._name;f=l[f]?l[f]:null;var g;g=a._name;g=m[g]?m[g]:null;d=d(e,"Flow",f,g);k[b(a._name)]=d;a.doc&&setNote(d,
a.doc);setNonNegative(d,!!a.non_negative);setValue(d,c(a))});a.model.display&&(e(a.model.display.text_box).forEach(function(a){if(a.__text){var b=createPrimitive(a.__text,"Text",[1.1*a._x,1.1*a._y],[1.1*a._width,1.1*a._height]);graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE,[b]);a["_font-size"]&&graph.setCellStyles(mxConstants.STYLE_FONTSIZE,a["_font-size"],[b]);a["_font-family"]&&graph.setCellStyles(mxConstants.STYLE_FONTFAMILY,a["_font-family"],[b]);k[a._uid]=
b}}),e(a.model.display.alias).forEach(function(a){var c=k[b(a.of)];"Flow"!=c.value.nodeName&&(c=makeGhost(c),setPosition(c,[1.1*a._x,1.1*a._y]));k[a._uid]=c}),e(a.model.display.connector).forEach(function(a){createConnector("Link","Link",f(a.from),f(a.to))}));if(a.model["interface"]){var d=function(a){a.sort(function(a,b){return a._index-b._index});a=a.filter(function(a){return!a._type||"variable"==a._type});return a.map(function(a){a=f(a.entity._name);return a.indexOf?a[0]:a}).join(",")};e(a.model["interface"].stacked_container).forEach(function(a){e(a.table).forEach(function(a){var b=
graph.insertVertex(graph.getDefaultParent(),null,primitiveBank.display.cloneNode(!0),10,10,64,64,"display");b.visible=!1;graph.getModel().execute(new mxCellAttributeChange(b,"name",a._title||"Table"));graph.getModel().execute(new mxCellAttributeChange(b,"AutoAddPrimitives","false"));graph.getModel().execute(new mxCellAttributeChange(b,"Type","Tabular"));graph.getModel().execute(new mxCellAttributeChange(b,"Primitives",d(e(a.item))))});e(a.graph).forEach(function(a){if("time_series"==a._type||"scatterplot"==
a._type){var b=graph.insertVertex(graph.getDefaultParent(),null,primitiveBank.display.cloneNode(!0),10,10,64,64,"display");b.visible=!1;graph.getModel().execute(new mxCellAttributeChange(b,"name",a._title||"Chart"));graph.getModel().execute(new mxCellAttributeChange(b,"AutoAddPrimitives","false"));"time_series"==a._type&&(graph.getModel().execute(new mxCellAttributeChange(b,"Type","Time Series")),graph.getModel().execute(new mxCellAttributeChange(b,"xAxis","Time (%u)")));"scatterplot"==a._type&&(graph.getModel().execute(new mxCellAttributeChange(b,
"Type","Scatterplot")),graph.getModel().execute(new mxCellAttributeChange(b,"xAxis","%o")));graph.getModel().execute(new mxCellAttributeChange(b,"yAxis","%o"));graph.getModel().execute(new mxCellAttributeChange(b,"Primitives",d(e(a.plot))))}})})}a.model.group&&e(a.model.group).forEach(function(a){var c=e(a.entity).map(function(a){return f(a._name,!0)}).concat(e(a.display.item).map(function(a){var b=k[a._uid];delete k[a._uid];return b})).filter(function(a){return a}),c=graph.groupCells(null,30,c);
setName(c,b(a._name));c.setConnectable(!0);graph.orderCells(!0);k[a._name]=c});var g=graph.groupCells(null,50,Object.keys(k).map(function(a){return k[a]}));setName(g,b(a.header.name));g.setConnectable(!0);graph.orderCells(!0)});for(var z in y)z=y[z],v+="\n\n "+z._name+" <- ",v=z._size?v+("1:"+z._size):v+("{"+z.elem.map(function(a){return'"'+b(a._name)+'"'}).join(", ")+"}");setMacros((getMacros()||"")+"\n\n"+v);showNotification("XMILE import completed successfully. Some equations may require manual adjustment in order to work with Insight Maker.",
"notice")}catch(x){if(showNotification("XMILE model could not be imported. Please ensure you have selected valid XMILE files."),isLocal())throw console.log(x),x;}finally{g.close()}},15)}});clearPrimitiveCache();setAllConnectable()};var recordingRes;
function generateRecording(){recordingRes=[];for(var a=undoHistory.history.map(function(a){return a.changes}),b=[],c=0;c<a.length;c++)b=b.concat(a[c]);for(c=0;c<b.length;c++)console.log("Item: "+c),a=serializeChange(b[c]),!capture||null===a||a.id==capture.id&&("attribute"==a.type&&"name"==a.attribute||"geometry"==a.type||"terminal"==a.type)||(console.log("Removing capture"),console.log(a.id),console.log(capture.id),console.log(a.type),capture=!1),console.log(a),capture&&null!==a?(console.log("Inserting into capture"),
"attribute"==a.type?capture[a.attribute]=a.value:"terminal"==a.type?(isDefined(a.alpha)&&(capture.alpha=a.alpha),isDefined(a.omega)&&(capture.omega=a.omega)):"geometry"==a.type&&(capture.geometry=a.geometry)):(console.log("Adding change"),null!==a&&recordingRes.push(a));b=JSON.stringify(cleanIds(recordingRes)).replace(/\}\,\{(.[^x])/g,"}\n\n{$1");return b.substr(1,b.length-2)}
function cleanIds(a){for(var b=0;b<a.length;b++)a[b].id=void 0,"attribute"==a[b].type&&(a[b].type=void 0,"Agent"==a[b].attribute&&(a[b].value=getName(findID(a[b].value)))),"create"==a[b].type&&(a[b].create=a[b].primitive,a[b].primitive=void 0,a[b].type=void 0),"geometry"==a[b].type&&(a[b].type=void 0),"remove"==a[b].type&&(a[b].remove=a[b].target,a[b].target=void 0,a[b].type=void 0);return a}var capture=!1,folderItems=[];
function serializeChange(a){if(a instanceof mxCellAttributeChange){if(a.value==a.previous||""==a.value&&isUndefined(a.previous))return null;var b={type:"attribute",id:a.cell.id,attribute:a.attribute};b.target="name"==a.attribute?a.previous:"Display"==a.cell.value.nodeName?"DISPLAY":a.cell.getAttribute("name");b.value="Primitives"==a.attribute?getName(findID(a.value.split(","))):a.value;return b}if(a instanceof mxChildChange){if(isUndefined(a.index))return{type:"remove",target:a.child.getAttribute("name")};
if(a.parent.value)folderItems.push(a.child);else{b=a.child.geometry;capture={type:"create",id:a.child.id,primitive:a.child.value.nodeName,geometry:{x:b.x,y:b.y,width:b.width,height:b.height}};!b.sourcePoint||0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y||(capture.geometry.sourcePoint={x:b.sourcePoint.x,y:b.sourcePoint.y});!b.targetPoint||0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y||(capture.geometry.targetPoint={x:b.targetPoint.x,
y:b.targetPoint.y});if("Folder"==a.child.value.nodeName){if(0==folderItems.length)return null;capture.items=getName(folderItems);folderItems=[]}recordingRes.push(capture)}return null}if(a instanceof mxGeometryChange){if(0<folderItems.length)return null;b=a.cell.geometry;a={type:"geometry",id:a.cell.id,target:a.cell.getAttribute("name"),geometry:{x:b.x,y:b.y,width:b.width,height:b.height}};!b.sourcePoint||0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y||(a.geometry.sourcePoint=
{x:b.sourcePoint.x,y:b.sourcePoint.y});!b.targetPoint||0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y||(a.geometry.targetPoint={x:b.targetPoint.x,y:b.targetPoint.y});b.points&&(a.geometry.points=b.points.slice().map(function(a){return{x:a.x,y:a.y}}));return a}return a instanceof mxTerminalChange?(b={type:"terminal",id:a.cell.id,target:a.cell.getAttribute("name")},a.source&&(b.alpha=a.terminal?a.terminal.getAttribute("name"):null),a.source||(b.omega=a.terminal?a.terminal.getAttribute("name"):
null),!1==capture||capture.id!=b.id?(capture=b,recordingRes.push(capture),null):b):null};var unfoldingManager={unfolding:!1},unfoldingReady=!1,doneUnfolding=!1;function beginUnfolding(){is_editor&&!is_embed&&showNotification(getText("Edits to the model will not be saved while you are viewing the story."),"notice",!0);unfoldingManager.unfolding=!0;unfoldingManager.init=getGraphXml(graph);initUnfolding();unfoldingReady=!0}function restartUnfolding(a){loadStoredUnfolding();a&&(saveUnfoldingStatus(a),unfoldingManager.init=getGraphXml(graph));initUnfolding()}
function saveUnfoldingStatus(a){var b=unfoldingManager.unfolding;unfoldingManager.unfolding=!1;graph.getModel().beginUpdate();var c=new mxCellAttributeChange(getSetting(),"unfolding",a.steps);graph.getModel().execute(c);c=new mxCellAttributeChange(getSetting(),"unfoldingStatus",a.enabled);graph.getModel().execute(c);c=new mxCellAttributeChange(getSetting(),"unfoldingAuto",a.auto);graph.getModel().execute(c);graph.getModel().endUpdate();unfoldingManager.unfolding=b}
function finishUnfolding(){loadStoredUnfolding();unfoldingManager.unfolding=!1;selectionChanged()}function loadStoredUnfolding(){unfoldingManager.init&&(importMXGraph(unfoldingManager.init),!is_editor&&is_embed&&1==is_zoom&&(graph.getView().setScale(0.25),graph.fit(),graph.fit()))}
function initUnfolding(){getSetting().getAttribute("unfolding")?(unfoldingManager.steps=JSON.parse(getSetting().getAttribute("unfolding")),unfoldingManager.step=0,Ext.getCmp("messageUnfoldBut").update(""),Ext.getCmp("nextUnfoldBut").setDisabled(!1),doUnfoldStep()):(unfoldingManager.steps={children:[]},doneUnfolding=unfoldingReady=!0,window.lastStepTypes=[])}
function doUnfoldStep(){unfoldingReady=!1;if(unfoldingManager.steps.children.length>unfoldingManager.step){var a=unfoldingManager.steps.children[unfoldingManager.step];window.lastStepTypes=[];executeUnfoldAction(a);unfoldingManager.step++}else doneUnfolding=!0;unfoldingManager.steps.children.length<=unfoldingManager.step&&Ext.getCmp("nextUnfoldBut").setDisabled(!0);unfoldingReady=!0}
function executeUnfoldAction(a){if("group"==a.type)for(var b=0;b<a.children.length;b++)executeUnfoldAction(a.children[b]);else if("note"==a.type||"noteMessage"==a.type){lastStepTypes.push("note");if("note"==a.type)var c=a.data;else a=JSON.parse(a.data),b=findID(a.ids).filter(function(a){return null!==a}),c=getNote(b).join("<br/>");Ext.getCmp("messageUnfoldBut").getEl().down(".message")?(Ext.getCmp("messageUnfoldBut").getEl().down(".message").fadeOut({duration:300}),setTimeout(function(){Ext.getCmp("messageUnfoldBut").update("<div class='message'>"+
c+"</div>")},400)):Ext.getCmp("messageUnfoldBut").update("<div class='message'>"+c+"</div>")}else"visibility"==a.type?(lastStepTypes.push("diagram"),a=JSON.parse(a.data),graph.getModel().beginUpdate(),b=findID(a.ids).filter(function(a){return null!==a}),b.length==[]&&(b=findAll()),setOpacity(b,a.opacity),graph.getModel().endUpdate()):"action"==a.type?runAction(a.data):"simulate"==a.type?(lastStepTypes.push("simulation"),runModel({silent:!1,selectedDisplay:findID(JSON.parse(a.data).display),rate:window.storyConverter?
-1:void 0})):"folder"==a.type?(lastStepTypes.push("diagram"),a=JSON.parse(a.data),b=findID(a.ids).filter(function(a){return null!==a}),"expand"==a.mode?expandFolder(b):collapseFolder(b)):(alert("Unknown action!"),console.log(a))}
var handleUnfoldToolbar=function(a){var b="on"==getSetting().getAttribute("unfoldingStatus"),c=Ext.getCmp("unfoldToolbar");if(!a||b&&c.isHidden()||!b&&!c.isHidden()){b?c.show():c.hide();var c=!1,d=getSetting().getAttribute("unfoldingAuto");isUndefined(d)&&(d="non-editors");a||"never"==d||("always"==d?c=!0:is_embed&&"editors"!=d?c=!0:"editors"==d&&is_editor?c=!0:"non-editors"!=d||is_editor||(c=!0));revealUnfoldButtons(c);c&&b&&beginUnfolding()}},revealUnfoldButtons=function(a){a?(Ext.getCmp("unfoldUnfoldBut").hide(),
Ext.getCmp("editUnfoldBut").hide(),Ext.getCmp("reloadUnfoldBut").show(),is_ebook||Ext.getCmp("exitUnfoldBut").show(),Ext.getCmp("messageUnfoldBut").show(),Ext.getCmp("nextUnfoldBut").show()):(Ext.getCmp("unfoldUnfoldBut").show(),is_editor&&!is_ebook&&Ext.getCmp("editUnfoldBut").show(),Ext.getCmp("reloadUnfoldBut").hide(),Ext.getCmp("exitUnfoldBut").hide(),Ext.getCmp("messageUnfoldBut").hide(),Ext.getCmp("nextUnfoldBut").hide())};
function showUnfoldingWin(){function a(){if(Ext.getCmp("opacitySlider")){var a=Ext.getCmp("opacitySlider").getValue(),b=Ext.getCmp("unfoldingPrimitives").getValue();g.set("data",JSON.stringify({opacity:a,ids:b}))}}function b(){if(Ext.getCmp("modeCombo")){var a=Ext.getCmp("modeCombo").getValue(),b=Ext.getCmp("unfoldingFolders").getValue();g.set("data",JSON.stringify({mode:a,ids:b}))}}function c(a){var b=function(c){var d=c.data,e={text:d.text,data:d.data,type:d.type,leaf:d.leaf,expanded:d.expanded};
a&&(e.flag=d.flag);e.children=[];for(d=0;d<c.childNodes.length;d++)e.children.push(b(c.childNodes[d]));return e};return b(k.getRootNode())}function d(a){var b=m.getRootNode(),c=b.childNodes.length+1;g&&("group"==g.get("type")&&g.isExpanded()?(b=g,c=0):(b=g.parentNode,c=b.indexOf(g)+1));a=b.insertChild(c,a);m.getSelectionModel().select(a)}var e=!1,f=getSetting(),g,k=new Ext.data.TreeStore({fields:[{name:"text",type:"string"},{name:"type",type:"string"},{name:"data",type:"string"},{name:"flag",type:"string"}],
proxy:{type:"memory"}});f.getAttribute("unfolding")?k.setRootNode(JSON.parse(f.getAttribute("unfolding"))):k.setRootNode({text:"Root Node",type:"root",id:"src",expanded:!0});for(var l=function(){if(g){var a=g.get("type");g.set("flag","selected");"visibility"==a?(y.getLayout().setActiveItem(1),a=JSON.parse(g.get("data")),Ext.getCmp("opacitySlider").setValue(a.opacity),Ext.getCmp("unfoldingPrimitives").setValue(a.ids)):"noteMessage"==a?(y.getLayout().setActiveItem(7),a=JSON.parse(g.get("data")),Ext.getCmp("unfoldingPrimitivesNotes").setValue(a.ids)):
"note"==a?(Ext.getCmp("actionNote").setValue(g.get("data")),y.getLayout().setActiveItem(2)):"simulate"==a?(Ext.getCmp("simulateSelectedDisplayCombo").setValue(JSON.parse(g.get("data")).display),y.getLayout().setActiveItem(3)):"action"==a?(Ext.getCmp("actionCode").setValue(g.get("data")),y.getLayout().setActiveItem(4)):"group"==a?(Ext.getCmp("selectedDisplayCombo, selectedNode.get"),Ext.getCmp("groupName").setValue(g.get("text")),y.getLayout().setActiveItem(5)):"folder"==a&&(y.getLayout().setActiveItem(6),
a=JSON.parse(g.get("data")),Ext.getCmp("modeCombo").setValue(a.mode),Ext.getCmp("unfoldingFolders").setValue(a.ids))}},m=Ext.create("Ext.tree.Panel",{title:getText("Story Steps"),disabled:"on"!=f.getAttribute("unfoldingStatus"),useArrows:!0,width:280,rootVisible:!1,id:"stepsTree",store:k,viewConfig:{plugins:{ptype:"treeviewdragdrop",containerScroll:!0}},listeners:{select:{fn:function(a,b,c,d){e=!0;g&&g.set("flag","");g=b;l();e=!1}}},bbar:[{glyph:61526,text:getText("Remove"),scope:this,iconCls:"red-icon",
handler:function(){function a(b){for(var c=0;c<b.children.length;c++)"selected"==b.children[c].flag?(b.children.splice(c,1),c--):a(b.children[c])}var b=c(!0);a(b);k.setRootNode(b);y.getLayout().setActiveItem(0);g=null}},"->",{glyph:61525,iconCls:"green-icon",text:getText("Add Step"),scope:this,menu:{xtype:"menu",items:[{text:getText("Change Visibility"),handler:function(){d({text:getText("Visibility Change"),data:'{"opacity": 100, "ids": []}',type:"visibility",leaf:!0})}},{text:getText("Toggle Folders"),
handler:function(){d({text:getText("Toggle Folders"),data:'{"mode": "expand", "ids": []}',type:"folder",leaf:!0})}},"-",{text:getText("Show Message"),handler:function(){d({text:getText("Show Message"),data:getText("Enter your message..."),type:"note",leaf:!0})}},{text:getText("Show Note as Message"),handler:function(){d({text:getText("Note Message"),data:'{"ids": []}',type:"noteMessage",leaf:!0})}},"-",{text:getText("Run Simulation"),handler:function(){d({text:getText("Run Simulation"),data:"{}",
type:"simulate",leaf:!0})}},"-",{text:getText("Run Action"),handler:function(){d({text:getText("Run Action"),data:"",type:"action",leaf:!0})}},"-",{text:getText("Group Steps"),handler:function(){d({text:getText("New Group"),type:"group",leaf:!1,expanded:!0})}}]}}]}),n=[],p=findAll(),q=0;q<p.length;q++){var u=getName(p[q]);n.push({pid:getID(p[q]),pname:isDefined(u)?u:"--"})}n.sort(function(a,b){return a.pname.localeCompare(b.pname)});for(var v=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},
{name:"pname",type:"string"}],data:n}),n=[],p=findType("Folder"),q=0;q<p.length;q++)u=getName(p[q]),n.push({pid:getID(p[q]),pname:isDefined(u)?u:"--"});n.sort(function(a,b){return a.pname.localeCompare(b.pname)});var n=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:n}),y=Ext.create("Ext.container.Container",{flex:1,layout:"card",items:[{xtype:"panel",padding:8,bodyStyle:"background:none",border:!1,html:'<p style="color:grey; text-align:center; line-height:1.5em">Use the Story Designer to construct a step-by-step walkthrough of your model. You can reveal your model piece-by-piece, display messages, and run simulations.<br/></br>Once your story is done, consider publishing your model and sharing it with others.</p>'},
{xtype:"container",padding:8,bodyStyle:"background:none",border:!1,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Opacity")+":"},{xtype:"slider",id:"opacitySlider",value:100,increment:1,minValue:0,animate:!1,listeners:{change:a}},{xtype:"displayfield",value:getText("Primitives (leave blank to apply to all)")+":"},Ext.create("Ext.form.field.Tag",{hideLabel:!0,name:"unfoldingPrimitives",id:"unfoldingPrimitives",filterPickList:!0,displayField:"pname",valueField:"pid",
queryMode:"local",store:v,emptyText:getText("Data"),listeners:{change:a},bbar:[]}),{xtype:"container",bodyStyle:"background:none",border:!1,autoScroll:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",glyph:61526,text:getText("Clear"),handler:function(){Ext.getCmp("unfoldingPrimitives").setValue([])}},{xtype:"box",flex:1},{glyph:61525,xtype:"button",text:getText("Add from Diagram"),tooltip:"Add the selected primitives in the diagram.",handler:function(){Ext.getCmp("unfoldingPrimitives").setValue(Ext.Array.unique(Ext.getCmp("unfoldingPrimitives").getValue().concat(getSelected().map(function(a){return getID(a)}))))}}]}]},
{xtype:"container",padding:8,bodyStyle:"background:none",border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"htmleditor",enableColors:!1,enableSourceEdit:!0,enableFont:!1,enableLists:!0,enableFontSize:!1,id:"actionNote",hideLabel:!0,flex:1,listeners:{change:function(a,b,c){e||g.set("data",b)}}}]},{xtype:"container",padding:8,bodyStyle:"background:none",border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Initially Selected Display")+":"},{xtype:"combo",
id:"simulateSelectedDisplayCombo",hideLabel:!0,store:findType("Display").map(function(a){return[a.id,getName(a)]}),forceSelection:!0,listeners:{select:function(){Ext.getCmp("simulateSelectedDisplayCombo")&&g.set("data",JSON.stringify({display:Ext.getCmp("simulateSelectedDisplayCombo").getValue()}))}}}]},{xtype:"container",padding:8,bodyStyle:"background:none",border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("JavaScript Action (<a href='//insightmaker.com/sites/default/files/API/files/API-js.html' target='_blank'>API</a>)")+
":"},{xtype:"aceeditor",mode:"javascript",id:"actionCode",flex:1,value:" ",listeners:{change:function(a,b,c){g.set("data",b)}}}]},{xtype:"container",padding:8,bodyStyle:"background:none",border:!1,plain:!0,items:[{xtype:"textfield",id:"groupName",fieldLabel:getText("Name"),labelWidth:60,allowBlank:!1,listeners:{change:function(a,b,c){g.set("text",b)}}}]},{xtype:"container",padding:8,bodyStyle:"background:none",border:!1,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",
value:getText("Action")+":"},{xtype:"combo",id:"modeCombo",hideLabel:!0,store:[["expand",getText("Expand")],["collapse",getText("Collapse")]],forceSelection:!0,listeners:{select:b}},{xtype:"displayfield",value:getText("Folders")+":"},Ext.create("Ext.form.field.Tag",{hideLabel:!0,name:"unfoldingFolders",filterPickList:!0,id:"unfoldingFolders",displayField:"pname",valueField:"pid",queryMode:"local",store:n,emptyText:getText("Folders"),listeners:{change:b}})]},{xtype:"container",padding:8,bodyStyle:"background:none",
border:!1,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Primitives whose notes will be shown")+":"},Ext.create("Ext.form.field.Tag",{hideLabel:!0,name:"unfoldingPrimitivesNotes",id:"unfoldingPrimitivesNotes",displayField:"pname",filterPickList:!0,valueField:"pid",queryMode:"local",store:v,emptyText:getText("Data"),listeners:{change:function(){if(Ext.getCmp("unfoldingPrimitivesNotes")){var a=Ext.getCmp("unfoldingPrimitivesNotes").getValue();g.set("data",
JSON.stringify({ids:a}))}}}}),{xtype:"container",bodyStyle:"background:none",border:!1,autoScroll:!0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",glyph:61526,text:getText("Clear"),handler:function(){Ext.getCmp("unfoldingPrimitivesNotes").setValue([])}},{xtype:"box",flex:1},{glyph:61525,xtype:"button",text:getText("Add from Diagram"),tooltip:"Add the selected primitives in the diagram.",handler:function(){Ext.getCmp("unfoldingPrimitivesNotes").setValue(Ext.Array.unique(Ext.getCmp("unfoldingPrimitivesNotes").getValue().concat(getSelected().map(function(a){return getID(a)}))))}}]}]}]}),
v={xtype:"container",frame:!0,layout:{type:"vbox",align:"stretch"},items:[{padding:8,xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[m,y]}]},z=new Ext.Window({title:getText("Story Designer"),layout:"fit",tools:[{type:"help",tooltip:getText("Get Help"),callback:function(a,b,c){showURL("/storytelling")}}],closeAction:"destroy",border:!1,modal:!1,resizable:!0,maximizable:!0,stateful:is_editor&&!is_embed,stateId:"story_window",shadow:!0,id:"unfold-window",buttonAlign:"right",width:Math.min(Ext.getBody().getViewSize().width,
600),height:Math.min(Ext.getBody().getViewSize().height,510),items:[v],tbar:[{xtype:"checkbox",id:"enabledChk",hideLabel:!0,boxLabel:getText("Enabled"),checked:"on"==f.getAttribute("unfoldingStatus"),listeners:{change:function(a,b,c){b?(Ext.getCmp("stepsTree").setDisabled(!1),l()):(Ext.getCmp("stepsTree").setDisabled(!0),y.getLayout().setActiveItem(0))}}},"->",{xtype:"combo",id:"autoCombo",fieldLabel:getText("Automatically start story")+":",labelWidth:180,store:[["never",getText("Never")],["editors",
getText("For Editors")],["non-editors",getText("For Non-Editors")],["always",getText("Always")]],forceSelection:!0,value:f.getAttribute("unfoldingAuto")||"non-editors",listeners:{select:function(a,b){}}}],buttons:["->",{scale:"large",glyph:61532,text:getText("Cancel"),handler:function(){z.close()}},{scale:"large",glyph:61452,text:getText("Apply"),handler:function(){var a={steps:JSON.stringify(c()),enabled:Ext.getCmp("enabledChk").getValue()?"on":"off",auto:Ext.getCmp("autoCombo").getValue()};unfoldingManager.unfolding?
restartUnfolding(a):saveUnfoldingStatus(a);handleUnfoldToolbar(!0);z.close()}}]});z.show()}
function configureArticle(){has_article?(Ext.getCmp("articleText").update("<a href='https://InsightMaker.com/article/"+drupal_node_ID+"/"+getURLTitle()+"' target='_blank'>https://InsightMaker.com/article/"+drupal_node_ID+"/"+getURLTitle()+"</a>"),Ext.getCmp("articlePublish").hide(),Ext.getCmp("articleRefresh").show(),Ext.getCmp("articleDelete").show()):(Ext.getCmp("articleText").update("Story article has not been published"),Ext.getCmp("articlePublish").show(),Ext.getCmp("articleRefresh").hide(),
Ext.getCmp("articleDelete").hide())}
function publishArticle(){if(-1==drupal_node_ID)mxUtils.alert("You must save the Insight before publishing an article."),closeAllWindows(),updateProperties();else if(!1==published)mxUtils.alert("You must make the Insight public before publishing or updating an article."),closeAllWindows(),updateProperties();else{graph.getModel().beginUpdate();var a=new mxCellAttributeChange(getSetting(),"article",JSON.stringify({comments:Ext.getCmp("articleAllowComments").getValue(),facebookUID:Ext.getCmp("articleFacebookUID").getValue()}));
graph.getModel().execute(a);graph.getModel().endUpdate();var b=Ext.MessageBox.show({icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0,progressText:" "});b.wait(getText("<i class='fa fa-file-text-o fa-5x' style='color: lightgrey; float: left; margin-right: 15px; margin-bottom: 8px'></i> Insight Maker is creating your article...<br/><br/>This may take a few minutes. Your article will reflect the state of your model the last time it was saved."));a=$.ajax({type:"GET",url:"/builder/StoryConverter.php",
timeout:9E5,data:{nid:drupal_node_ID,config:getSetting().getAttribute("article")}});a.done(function(a){/CONVERSION_COMPLETED/.test(a)?(a="https://insightmaker.com/article/"+drupal_node_ID+"/"+getURLTitle(),Ext.MessageBox.show({title:getText("Article Created"),msg:getText("Your article was created successfully. You can view it at:<br><br><a href='"+a+"' target='_blank'>"+a+"</a><br/><br/>If you make changes to your story, you will need to update the article."),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO}),
has_article=!0):(b.close(),mxUtils.alert("Could not create article. Please report this to the Insight Maker team.","error",!1),has_article=!1);saveModel();configureArticle()});a.fail(function(a,d,e){b.close();mxUtils.alert("Could not create article: "+d+" - "+e,"error",!1)})}}function deleteArticle(){$.ajax({type:"GET",url:"/builder/StoryConverter.php",data:{nid:drupal_node_ID,"delete":"1"}});has_article=!1;saveModel();configureArticle()}
function articleWindow(){var a=JSON.parse(getSetting().getAttribute("article")),b=new Ext.Window({title:getText("Publish Article"),tools:[{type:"help",tooltip:getText("Get Help"),callback:function(a,b,e){showURL("/storytelling")}}],autoScroll:!0,closeAction:"destroy",border:!1,modal:!0,resizable:!1,maximizable:!1,shadow:!0,buttonAlign:"right",width:Math.min(Ext.getBody().getViewSize().width,600),height:Math.min(Ext.getBody().getViewSize().height,510),layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",
margin:10,html:"<p>An article takes your Story and converts it into a static webpage. Model diagrams and simulation results are placed in the article as static images. Make sure to define a Story using the <a href='#' onclick='closeAllWindows(); showUnfoldingWin()'> Storytelling Designer</a> prior to publishing your article. You can delete or update your article after publishing it.</p><p>Optionally, you can allow readers to comment on your article using Facebook comments. You can also specify a numeric Facebook user ID to act as a moderator for the discussion.</p>"},
{xtype:"container",layout:{type:"hbox",align:"middle"},padding:8,style:{"border-top":"dashed 1px lightgrey"},items:[{xtype:"box",html:"<i class='fa fa-file-text-o fa-3x' style='color: lightgrey'></i>",margin:4},{xtype:"box",html:getText("Article not published"),id:"articleText",style:{"margin-right":"8px",overflow:"hidden","text-overflow":"ellipsis"},margin:4,flex:1},{xtype:"button",text:getText("Publish Article"),tooltip:getText("Create a static article from the story."),glyph:61678,id:"articlePublish",
handler:publishArticle,margin:4},{xtype:"button",text:getText("Update"),tooltip:getText("Update the published article to reflect changes to the story."),glyph:61473,id:"articleRefresh",handler:publishArticle,margin:4},{xtype:"button",text:getText("Delete"),tooltip:getText("Delete the published article."),glyph:61534,id:"articleDelete",handler:deleteArticle,margin:4}]},{xtype:"fieldset",title:"Commenting Options",collapsible:!1,margin:10,defaults:{labelWidth:160,anchor:"100%",layout:{type:"hbox",defaultMargins:{top:0,
right:5,bottom:0,left:0}}},items:[{xtype:"checkboxfield",fieldLabel:"Allow Comments",checked:a.comments,id:"articleAllowComments"},{xtype:"numberfield",fieldLabel:"Moderator",emptyText:"Numeric Facebook User ID",value:a.facebookUID,allowDecimals:!1,autoStripChars:!0,minValue:0,id:"articleFacebookUID"}]}],buttons:["->",{scale:"large",glyph:61452,text:getText("Done"),handler:function(){b.close()}}]});b.show();configureArticle()}
function blockUnfold(a){return function(){unfoldingManager.unfolding?mxUtils.alert("You cannot use this function while in Storytelling mode.","notice",!0):a()}};Ext.define("Ext.ux.AceEditor",{extend:"Ext.Component",alias:"widget.aceeditor",config:{theme:"chrome",mode:"mdln",readOnly:!1},onRender:function(){this.autoEl=Ext.apply({},this.initialConfig,this.autoEl);this.callParent(arguments)},onResize:function(a,b){this.editor.resize()},afterRender:function(){var a=this,b=this.getEl().dom;b.style["font-size"]="13pt";var c=ace.edit(b);this.editor=c;c.setTheme("ace/theme/"+this.theme);c.$blockScrolling=Infinity;c.getSession().setMode("ace/mode/"+this.mode);c.setShowPrintMargin(!1);
c.setHighlightActiveLine(!1);c.getSession().setUseSoftTabs(!0);setTimeout(function(){c.getSession().setUseWrapMode(!0)},100);c.setOptions({fontSize:"13pt",showLineNumbers:!1});c.setReadOnly(a.readOnly);c.setValue(this.value||"");this.oldValue=this.value||"";c.focus();var d;c.on("change",function(){"mdln"==a.mode&&(clearInterval(d),d=setTimeout(function(){try{createTree(a.getValue()),c.getSession().setAnnotations()}catch(b){var d=b.toString();try{var g=Math.max(0,d.match(/line (\d+)/i)[1]-1)}catch(k){g=
0,d="Syntax error."}c.getSession().setAnnotations([{type:"error",row:g,text:d}])}},400));a.fireEvent("change",a,a.getValue(),a.oldValue);a.oldValue=a.getValue()});this.annotations&&c.getSession().setAnnotations(this.annotations)},setValue:function(a){this.oldValue=a;this.editor.setValue(a)},getValue:function(){return this.editor.getValue()},insertText:function(a){this.editor.insert(a)}});function doLoops(){for(var a=getAdjList(),a=(new ElementaryCyclesSearch(a.adjList,a.nodes)).getElementaryCycles(),b=findType(["Flow","Transition","Link"]),c=a.length-1;0<=c;c--)2==a[c].length&&("Stock"==a[c][0].value.nodeName&&"Flow"==a[c][1].value.nodeName||"Stock"==a[c][1].value.nodeName&&"Flow"==a[c][0].value.nodeName||"State"==a[c][0].value.nodeName&&"Transition"==a[c][1].value.nodeName||"State"==a[c][1].value.nodeName&&"Transition"==a[c][0].value.nodeName)&&a.splice(c,1);0==a.length?mxUtils.alert("No loops found in the model.",
"notice",!0):(a.sort(function(a,b){return a.length-b.length}),showData("Model Loops",[{name:"List of Loops",type:"html",data:"<div style='padding:10px'><p>Insight Maker has identified "+a.length+" loop"+(1==a.length?"":"s")+" in the model diagram:</p>"+a.map(function(a){a.push(a[0]);for(var c="<div style='line-height: 2.2em; margin:18px'>",f=0;f<a.length;f++){var g=a[f],c=c+("<span style='background-color: aliceblue; padding:5px; margin: 2px; border-radius: 5px; cursor: pointer;' onclick='highlight(findID("+
g.id+"))'><nobr>"+g.value.getAttribute("name")+"</nobr></span>"),k="grey";if(f<a.length-1){a:{for(var l=a[f+1],m=0;m<b.length;m++){var n=getEnds(b[m]);if(n[0]==g&&n[1]==l){g=b[m];break a}}g=void 0}g&&(k=getLineColor(g));c+="<i class='fa fa-arrow-right' style='margin: 2px; color: "+k+"'></i>"}}return c+"</div>"}).join("")+"</div>"}]))}
function getAdjList(){function a(a){-1==d.indexOf(a)&&(d.push(a),e.push([]));return d.indexOf(a)}function b(a,b){-1==e[a].indexOf(+b)&&e[a].push(+b)}for(var c=findType(["Flow","Transition","Link"]),d=[],e=[],f=0;f<c.length;f++){var g=c[f],k=getEnds(orig(g));"Link"!=g.value.nodeName?(g=a(orig(g)),k[0]&&(b(g,a(orig(k[0]))),b(a(orig(k[0])),g)),k[1]&&b(a(orig(k[1])),g)):k[0]&&k[1]&&(b(a(orig(k[1])),a(orig(k[0]))),isTrue(g.getAttribute("BiDirectional"))&&b(a(orig(k[0])),a(orig(k[1]))))}e.map(function(a){a.sort(function(a,
b){return a-b})});return{nodes:d,adjList:e}};function showMessage(a){alert(a)}function showPrompt(a,b){return prompt(a,b)}function showChoice(a){return confirm(a)}function showURL(a){var b=window.open(a,"","scrollbars=yes,menubar=yes,height=500,width=700,resizable=yes,toolbar=yes,location=yes,status=yes");open!=b&&"undefined"!=typeof b||Ext.Msg.alert("","<big><big><center><a href='"+a+"' target='_blank'><i class='fa fa-external-link-square'></i> Open Link</a></center></big></big>")}
function downloadFile(a,b){var c=document.createElement("a");document.body.appendChild(c);var d=new Blob([b],{type:"octet/stream"}),d=window.URL.createObjectURL(d);c.href=d;c.download=a;c.click();window.URL.revokeObjectURL(d);c.remove()}
function showData(a,b,c){c||(c=[Math.min(Ext.getBody().getViewSize().width,640),Math.min(Ext.getBody().getViewSize().height,480)]);for(var d=[],e=0;e<b.length;e++){var f={layout:"fit"};f.title=b[e].name;if("text"==b[e].type.toLowerCase())f.items=[{xtype:"textareafield",value:b[e].data,readOnly:!0}];else if("html"==b[e].type.toLowerCase())f.items=[{title:"Insight Equations",xtype:"box",html:b[e].data,style:"background-color: white",autoScroll:!0}];else if("table"==b[e].type.toLowerCase()){for(var g=
{xtype:"grid"},k=[],l=[],m=[],n=0;n<b[e].data.length;n++){k.push({dataIndex:"a"+n,text:b[e].header?b[e].header[n]:""});for(var p="float",q=0;q<b[e].data[n].length;q++)"string"==typeof b[e].data[n][e]&&(p="string");l.push({name:"a"+n,type:p})}for(q=0;q<b[e].data[0].length;q++)m.push({});for(n=0;n<b[e].data.length;n++)for(q=0;q<b[e].data[0].length;q++)m[q]["a"+n]=b[e].data[n][q];g.columns=k;g.store=new Ext.data.JsonStore({fields:l,data:m});b[e].header||(g.hideHeaders=!0);g.dockedItems=[{xtype:"toolbar",
dock:"bottom",items:["->",downloadButton(b[e].name)]}];f.items=[g]}else if("chart"==b[e].type.toLowerCase()){l="#94ae0a #115fa6 #a61120 #ff8809 #ffd13e #a61187 #24ad9a #7c7474 #a66111".split(" ");m=0;g=[];for(n=0;n<b[e].data.length;n++)b[e].data[n].color?g.push(b[e].data[n].color):(g.push(l[m]),m++,m%=l.length);k=[];l=[{name:"x",type:"numeric"==b[e].xType.toLowerCase()?"float":"string"}];p=[];m=[];for(n=0;n<b[e].xData.length;n++)m.push({x:b[e].xData[n]});for(n=0;n<b[e].data.length;n++)for(l.push({name:"a"+
n,type:"float"}),k.push({shadow:!1,type:b[e].data[n].fill?"area":b[e].data[n].type.toLowerCase(),title:b[e].data[n].name,colors:[g[n]],axis:"left",xField:"x",yField:"a"+n,showInLegend:b[e].data[n].hideLegend?!1:!0,showMarkers:b[e].data[n].hideMarkers?!1:!0,style:{opacity:1,"stroke-width":3},marker:{radius:3},animation:!1}),b[e].data[n].fill&&(k[k.length-1].style["stroke-width"]=0),p.push("a"+n),q=0;q<b[e].data[n].data.length;q++)m[q]["a"+n]=b[e].data[n].data[q];n={xtype:"cartesian",animation:!1,shadow:!1,
interactions:"crosszoom",store:new Ext.data.JsonStore({fields:l,data:m}),axes:[{position:"bottom",type:b[e].xType?b[e].xType.toLowerCase():"numeric",grid:b[e].verticalGrid?b[e].verticalGrid:!1,title:{text:b[e].xLabel?b[e].xLabel:"",fontSize:14},fields:["x"],minimum:b[e].xMin,maximum:b[e].xMax},{position:"left",type:"numeric",grid:b[e].horizontalGrid?b[e].horizontalGrid:!1,title:{text:b[e].yLabel?b[e].yLabel:"",fontSize:14},titleMargin:20,fields:p,minimum:b[e].yMin,maximum:b[e].yMax}],series:k};b[e].legend&&
"none"!=b[e].legend&&(n.legend={},n.legend.docked=b[e].legend,n.legend.toggleable=!b[e].legendStatic);f.items=[n]}else alert("Unknown tab type: "+b[e].type);d.push(f)}var u=new Ext.Window({title:a,layout:"fit",closeAction:"destroy",border:!1,modal:!1,resizable:!0,closable:!0,maximizable:!0,minimizable:!0,shadow:!0,width:c[0],height:c[1],items:[{xtype:"tabpanel",layout:"fit",items:d}]});u.on("minimize",function(a){a.expandedState?(a.expandedState=!1,a.collapse()):(a.expandedState=!0,u.expand())});
u.show();return u}function frontWindow(){return Ext.WindowMgr.getActive()}function closeAllWindows(){for(var a;a=Ext.WindowMgr.getActive();)a.close()}
function openFile(a){a=a||{multiple:!1,accept:null,onCompleted:null,onSelected:null,onError:null,read:!1};a.read&&(a.read=a.read.toLowerCase());"xlsx"!=a.read||a.accept||(a.accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");var b=document.createElement("input");b.setAttribute("type","file");a.multiple&&b.setAttribute("multiple",!0);a.accept&&b.setAttribute("accept",a.accept);var c=null,d=0,e=function(){$(b).remove();if(c.length){if(d++,d==c.length)a.onCompleted(c)}else a.onCompleted(c)},
f=function(b){var c={};c.file=b;c.size=b.size;c.name=b.name;c.type=b.type;var d=new FileReader;d.onloadend=function(b){"xlsx"==a.read?require(["jszip"],function(){require(["xlsx"],function(){c.contents=XLSX.read(d.result,{type:"binary"});e()})}):(c.contents=d.result,e())};d.onerror=function(){if(a.onError)a.onError(d.error);else alert("FileReader error."),console.log("FileReader Error"),console.log(d.error)};d.onabort=function(){if(a.onError)a.onError(d.error);else alert("FileReader aborted."),console.log("FileReader Error"),
console.log(d.error)};if("binary"==a.read)d.readAsBinaryString(b);else if("text"==a.read)d.readAsText(b);else if("xlsx"==a.read)d.readAsBinaryString(b);else{if(a.read)throw"Unknown data read type: "+a.type;setTimeout(e,1)}return c};b.onchange=function(){var d=b.files;if(a.onSelected)a.onSelected(d);if(a.onCompleted){if("undefined"==typeof d[0])a.onCompleted(null);c=a.multiple?Array.prototype.slice.call(d).map(function(a){return f(a)}):f(d[0])}};document.body.appendChild(b);b.click()}
function runModel(a){if(!simulationRunning()||simulate.config.silent||a.resultsWindow)return isUndefined(a)?a={silent:graph instanceof SimpleNode}:"boolean"==typeof a&&(a={silent:a}),runSimulation(a);mxUtils.alert(getText("You have an existing simulation running that has not yet completed. Either close the results window or press the window's 'Stop' button. You may then run a new simulation."));simulate.resultsWindow.show()}function simulationRunning(){return simulate&&!simulate.completed()}
function endRunningSimulation(){simulate&&simulate.terminate()}function saveModel(a){a||""==graph_title?updateProperties():unfoldingManager.unfolding||sendGraphtoServer(graph)}
function clearModel(){graph instanceof SimpleNode?(graph.children[0].children[0].children=graph.children[0].children[0].children.filter(function(a){return"Setting"==a.value.nodeName}),clearPrimitiveCache()):(graph.getModel().beginUpdate(),graph.allowButtonSelect=!0,graph.selectAll(),graph.allowButtonSelect=!1,graph.removeCells(graph.getSelectionCells(),!1),graph.getModel().endUpdate())}
function layoutModel(a){"organic"==a?(a=new mxFastOrganicLayout(graph),a.forceConstant=50,executeLayout(a,!0)):"circular"==a?executeLayout(new mxCircleLayout(graph),!0):"hierarchical"==a?(a=new mxCompactTreeLayout(graph),a.horizontal=!1,a.resizeParent=!1,a.moveTree=!1,executeLayout(a,!0)):alert("Unknown layout algorithm: "+a)}
var executeLayout=function(a,b,c){var d=graph.getSelectionCell();if(null==d||!c&&0==graph.getModel().getChildCount(d))d=graph.getDefaultParent();graph.getModel().beginUpdate();try{a.execute(d)}catch(e){throw e;}finally{b&&0>navigator.userAgent.indexOf("Camino")?(a=new mxMorphing(graph),a.addListener(mxEvent.DONE,function(){graph.getModel().endUpdate()}),a.startAnimation()):graph.getModel().endUpdate()}};
function setZoom(a){"fit"==a?graph.fit():"actual"==a?graph.zoomActual():"in"==a?graph.zoomIn():"out"==a?graph.zoomOut():graph.getView().setScale(a)}function getTimeStep(){return parseFloat(getSetting().getAttribute("TimeStep"))}function setTimeStep(a){setAttributeUndoable(getSetting(),"TimeStep",a)}function getTimeStart(){return parseFloat(getSetting().getAttribute("TimeStart"))}function setTimeStart(a){setAttributeUndoable(getSetting(),"TimeStart",a)}
function getTimeLength(){return parseFloat(getSetting().getAttribute("TimeLength"))}function setTimeLength(a){setAttributeUndoable(getSetting(),"TimeLength",a)}function getPauseInterval(){return parseFloat(getSetting().getAttribute("TimePause"))}function setPauseInterval(a){setAttributeUndoable(getSetting(),"TimePause",a)}function getTimeUnits(){return getSetting().getAttribute("TimeUnits")}function setTimeUnits(a){setAttributeUndoable(getSetting(),"TimeUnits",a)}
function getAlgorithm(){return getSetting().getAttribute("SolutionAlgorithm")}function setAlgorithm(a){setAttributeUndoable(getSetting(),"SolutionAlgorithm",a)}function getMacros(){return getSetting().getAttribute("Macros")}function setMacros(a){setAttributeUndoable(getSetting(),"Macros",a)}
function findName(a){var b=map(a,function(a){for(var b=[],e=findAll(),f=0;f<e.length;f++)isDefined(e[f].getAttribute("name"))&&e[f].getAttribute("name").toLowerCase()==a.toLowerCase()&&b.push(e[f]);return b}),b=flatten(b),b=b.filter(function(a){return null!==a});return a instanceof Array?b:0==b.length?null:1==b.length?b[0]:b}function findAll(){for(var a=primitives(),b=[],c=0;c<a.length;c++)"Setting"!=a[c].value.nodeName&&"Display"!=a[c].value.nodeName&&b.push(a[c]);return b}
function findType(a){a=map(a,function(a){return primitives(a)});return a=flatten(a)}function findID(a){var b=primitives(),c=map(a,function(a){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c];return null});return null===c?c:a instanceof Array?c:1==c.length?c[0]:c}function findValue(a){var b=findAll();a=map(a,function(a){for(var d=[],e=0;e<b.length;e++)a instanceof RegExp?a.test(getValue(b[e]))&&d.push(b[e]):getValue(b[e])==a&&d.push(b[e]);return d});return uniquePrimitives(flatten(a))}
function findNote(a){var b=findAll();a=map(a,function(a){for(var d=[],e=0;e<b.length;e++)a instanceof RegExp?a.test(getNote(b[e]))&&d.push(b[e]):getNote(b[e])==a&&d.push(b[e]);return d});return uniquePrimitives(flatten(a))}
function createPrimitive(a,b,c,d){var e=b.toLowerCase();graph instanceof SimpleNode?(b=graph.children[0].children[0],c=simpleCloneNode(primitiveBank[e],b),b.children.push(c),clearPrimitiveCache()):(b=graph.getDefaultParent(),c=graph.insertVertex(b,null,primitiveBank[e].cloneNode(!0),c[0],c[1],d[0],d[1],e));setName(c,a);"Converter"==c.value.nodeName&&setConverterInit(c);if(isValued(c)||"Agents"==c.value.nodeName)for(a=primitives("Display"),d=0;d<a.length;d++)b=a[d],!isTrue(b.getAttribute("AutoAddPrimitives"))||
"Scatterplot"==b.getAttribute("Type")||"Map"==b.getAttribute("Type")&&"Agents"!=c.value.nodeName||(e=b.getAttribute("Primitives"),"undefined"==typeof e?b.setAttribute("Primitives",c.id):(e=e.split(","),e.push(c.id),b.setAttribute("Primitives",e.join(","))));return c}
function createConnector(a,b,c,d){var e,f=!1,g=b.toLowerCase();if(graph instanceof SimpleNode)b=graph.children[0].children[0],c&&(b=c.parent),d&&(b=d.parent),g=simpleCloneNode(primitiveBank[g],b),b.children.push(g),setEnds(g,[c,d]),clearPrimitiveCache();else{b=graph.getDefaultParent();if(null==d&&null==c)f=!0,d=c=e=createPrimitive("temp stock xyz","Stock",[300,300],[10,10]);else if(null==c){f=!0;e=getPosition(d);var k=getSize(d);c=e=createPrimitive("temp stock xyz","Stock",[e[0]+k[0]/2-5,e[1]-120],
[10,10])}else null==d&&(f=!0,e=getPosition(c),k=getSize(c),d=e=createPrimitive("temp stock xyz","Stock",[e[0]+k[0]/2-5,e[1]+120+k[1]],[10,10]));g=graph.insertEdge(b,null,primitiveBank[g].cloneNode(!0),c,d,g)}setName(g,a);f&&removePrimitive(e);return g}
function removePrimitive(a){a instanceof Array||(a=[a]);if(graph instanceof SimpleNode){var b=findType(["Flow","Transition","Link"]);a.forEach(function(a){a.parent.children.splice(a.parent.children.indexOf(a),1);b.forEach(function(b){b.source==a&&(b.source=null,b.target&&b.target.parent!==b.parent&&setParent(b,b.target.parent));b.target==a&&(b.target=null,b.source&&b.source.parent!==b.parent&&setParent(b,b.source.parent))})});clearPrimitiveCache()}else graph.removeCells(a,!1)}
function highlight(a){for(var b=getParent(a);b;)getCollapsed(b)&&expandFolder(b),b=getParent(b);setSelected(a);graph.scrollCellToVisible(a)}function getSelected(){return graph.getSelectionCells()}function setSelected(a){graph.allowButtonSelect=!0;a instanceof Array?graph.setSelectionCells(a):graph.setSelectionCells([a]);graph.allowButtonSelect=!1}function isSelected(a){var b=getSelected();return map(a,function(a){return-1<primitiveIndex(b,a)})}
function getID(a){return map(a,function(a){return a.id})}function getType(a){return map(a,function(a){return a.value.nodeName})}function getName(a){return map(a,function(a){return a.getAttribute("name")})}function setName(a,b){map(a,function(a){validPrimitiveName(String(b),a)&&(setAttributeUndoable(a,"name",String(b)),propogateGhosts(a))})}function getUnits(a){return map(a,function(a){return a.getAttribute("Units")})}
function setUnits(a,b){map(a,function(a){setAttributeUndoable(a,"Units",String(b))})}function getConstraints(a){return map(a,function(a){return[a.getAttribute("MinConstraint"),isTrue(a.getAttribute("MinConstraintUsed")),a.getAttribute("MaxConstraint"),isTrue(a.getAttribute("MaxConstraintUsed"))]})}
function setConstraints(a,b){map(a,function(a){setAttributeUndoable(a,"MinConstraint",b[0]);setAttributeUndoable(a,"MinConstraintUsed",b[1]);setAttributeUndoable(a,"MaxConstraint",b[2]);setAttributeUndoable(a,"MaxConstraintUsed",b[3])})}function getNote(a){return map(a,function(a){return a.getAttribute("Note")})}function setNote(a,b){map(a,function(a){setAttributeUndoable(a,"Note",String(b))})}
function showNote(a){return map(a,function(a){if(null!==a.value.getAttribute("Note",null)&&""!=a.value.getAttribute("Note")){var c=Ext.getCmp("note"+a.id);isUndefined(c)&&(c=graph.view.getState(a))&&(new Ext.ToolTip({html:"<big>"+clean(a.value.getAttribute("Note").replace(/\n/g,"<br/>"))+"</big>",autoHide:!1,closable:!0,width:300,draggable:!0,id:"note"+a.id,title:clean(a.value.getAttribute("name")),closeAction:"destroy"})).showAt([c.x+mxPanel.getEl().getLeft()+c.width+4-graph.container.scrollLeft,
c.y+mxPanel.getEl().getTop()-graph.container.scrollTop])}})}function hideNote(a){return map(a,function(a){a=Ext.getCmp("note"+a.id);isUndefined(a)||a.destroy()})}
function showEditor(a,b){if("Converter"==a.value.nodeName)var c=new ConverterWindow({parent:"",cell:a,oldKeys:a.getAttribute("Data"),interpolation:a.getAttribute("Interpolation")});else if("Stock"==a.value.nodeName)var d=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Restrict this stock to positive values"),checked:getNonNegative(a),autoEl:{"data-qtip":"If checked, the value of the stock will not be allowed to fall below zero. The rates of outflows may be adjusted to ensure this condition is met."}}),
c=new EquationWindow({parent:"",cell:a,equation:getValue(a),annotations:b,extra:d,saveExtra:function(b){setNonNegative(a,d.getValue())}});else if("Flow"==a.value.nodeName)d=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Restrict this flow to positive rates"),checked:getNonNegative(a),autoEl:{"data-qtip":"If checked, the flow will not be applied if the calculated rate is less than zero."}}),c=new EquationWindow({parent:"",cell:a,equation:getValue(a),annotations:b,extra:d,saveExtra:function(b){setNonNegative(a,
d.getValue())}});else if("Transition"==a.value.nodeName){var e=function(){var a="Condition"==f.getValue();g.setDisabled(a);k.setDisabled(a)},f=new Ext.form.ComboBox({triggerAction:"all",store:["Timeout","Probability","Condition"],editable:!1,selectOnFocus:!1,value:getTriggerType(a),fieldLabel:"Trigger Type",width:240,listeners:{change:function(){e()}}}),g=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Recalculate each time step"),checked:getTriggerRecalculate(a),margin:"0 0 0 15",
autoEl:{"data-qtip":"If this is not true, the equation will be evaluated once and the trigger time scheduled based on that calculation. If this is true, the timeout or probability will be recalculated as the state of the system changes."}}),k=new Ext.form.field.Checkbox({xtype:"checkboxfield",boxLabel:getText("Repeat after triggering"),checked:getTriggerRepeat(a),margin:"0 0 0 15",autoEl:{"data-qtip":"If this is true, the transition will be rescheduled after it is triggered. If this is not true, the transition will only be rescheduled if its source state becomes active again."}}),
c={xtype:"container",layout:"hbox",items:[f,g,k]};e();c=new EquationWindow({parent:"",cell:a,equation:getValue(a),annotations:b,extra:c,saveExtra:function(b){setTriggerType(a,f.value);setTriggerRecalculate(a,g.getValue());setTriggerRepeat(a,k.getValue())}})}else c=new EquationWindow({parent:"",cell:a,equation:getValue(a),annotations:b});c.show()}
function getValue(a){return map(a,function(a){var c=a.value.nodeName,d;"Stock"==c?d=a.getAttribute("InitialValue"):"Flow"==c?d=a.getAttribute("FlowRate"):"Transition"==c?d=a.getAttribute("Value"):"State"==c?d=a.getAttribute("Active"):"Variable"==c?d=a.getAttribute("Equation"):"Button"==c?d=a.getAttribute("Function"):"Converter"==c?d=a.getAttribute("Data"):"Action"==c?d=a.getAttribute("Action"):"Agents"==c&&(d=a.getAttribute("Size"));return isDefined(d)?d:""})}
function setValue(a,b){map(a,function(a){if(getValue(a)!=b){var d=a.value.nodeName;"Stock"==d?setAttributeUndoable(a,"InitialValue",String(b)):"Flow"==d?setAttributeUndoable(a,"FlowRate",String(b)):"Transition"==d?setAttributeUndoable(a,"Value",String(b)):"State"==d?setAttributeUndoable(a,"Active",String(b)):"Variable"==d?setAttributeUndoable(a,"Equation",String(b)):"Button"==d?setAttributeUndoable(a,"Function",String(b)):"Converter"==d?setAttributeUndoable(a,"Data",String(b)):"Action"==d?setAttributeUndoable(a,
"Action",String(b)):"Agents"==d&&(0>b||Math.round(b)!=b?alert("The agent population size must be a non-negative integer."):setAttributeUndoable(a,"Size",parseFloat(b)))}})}function getSize(a){return map(a,function(a){if(graph instanceof SimpleNode)return[0,0];a=graph.getCellBounds(a);var c=graph.view.getScale();return[a.width/c,a.height/c]})}
function getPosition(a){return map(a,function(a){if(graph instanceof SimpleNode)return[0,0];a=graph.view.getState(a);var c=graph.view.getScale();return[a.x/c,a.y/c]})}function setPosition(a,b){map(a,function(a){var d=graph.view.getState(a),e=graph.view.getScale(),f=a.geometry,g=d.x/e-f.x,d=d.y/e-f.y,f=f.clone();f.x=b[0]-g;f.y=b[1]-d;graph.getModel().setGeometry(a,f)})}
function flash(a,b,c){map(a,function(a){"Folder"==a.value.nodeName&&flash(getChildren(a,!1),b,c);var e=getOpacity(a);setOpacity(a,b||0);setTimeout(function(){setOpacity(a,e)},c||100)})}function getShowSlider(a){return map(a,function(a){return isTrue(a.getAttribute("ShowSlider"))})}function setShowSlider(a,b){map(a,function(a){setAttributeUndoable(a,"ShowSlider",b)})}function getSliderMin(a){return map(a,function(a){return a.getAttribute("SliderMin")})}
function setSliderMin(a,b){map(a,function(a){setAttributeUndoable(a,"SliderMin",b)})}function getSliderMax(a){return map(a,function(a){return a.getAttribute("SliderMax")})}function setSliderMax(a,b){map(a,function(a){setAttributeUndoable(a,"SliderMax",b)})}function getSliderStep(a){return map(a,function(a){return a.getAttribute("SliderStep")})}function setSliderStep(a,b){map(a,function(a){setAttributeUndoable(a,"SliderStep",b)})}
function getOpacity(a){return map(a,function(a){return graph.getCellStyle(a).opacity})}function setOpacity(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"opacity",b),d=mxUtils.setStyle(d,mxConstants.STYLE_TEXT_OPACITY,b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}function getLineColor(a){return map(a,function(a){return graph.getCellStyle(a).strokeColor})}
function setLineColor(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"strokeColor",b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}function getFontColor(a){return map(a,function(a){return graph.getCellStyle(a).fontColor})}function setFontColor(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"fontColor",b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}
function getFillColor(a){return map(a,function(a){return graph.getCellStyle(a).fillColor})}function setFillColor(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"fillColor",b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}function getImage(a){return map(a,function(a){return a.getAttribute("Image")})}function setImage(a,b){map(a,function(a){a.setAttribute("Image",b);setPicture(a)})}
function getNonNegative(a){return map(a,function(a){return"Stock"==a.value.nodeName?isTrue(a.getAttribute("NonNegative")):isTrue(a.getAttribute("OnlyPositive"))})}
function setNonNegative(a,b){map(a,function(a){"Stock"==a.value.nodeName?setAttributeUndoable(a,"NonNegative",b):(setAttributeUndoable(a,"OnlyPositive",b),a instanceof SimpleNode||(b?graph.setCellStyles(mxConstants.STYLE_STARTARROW,"",[a]):(graph.setCellStyles(mxConstants.STYLE_STARTARROW,"block",[a]),graph.setCellStyles("startFill",0,[a]))))})}function getStockType(a){return map(a,function(a){return a.getAttribute("StockMode")})}
function setStockType(a,b){map(a,function(a){setAttributeUndoable(a,"StockMode",b)})}function getDelay(a){return map(a,function(a){return a.getAttribute("Delay")})}function setDelay(a,b){map(a,function(a){setAttributeUndoable(a,"Delay",b)})}function getEnds(a){return map(a,function(a){return[a.source,a.target]})}
function setEnds(a,b){map(a,function(c){if(a instanceof SimpleNode)c.source=b[0],c.target=b[1],clearPrimitiveCache();else{var d=new mxTerminalChange(graph.model,c,b[0],!0);graph.getModel().execute(d);d=new mxTerminalChange(graph.model,c,b[1],!1);graph.getModel().execute(d)}})}
function connected(a,b){if(a.isEdge&&(null!==a.source&&a.source.id===b.id||null!==a.target&&a.target.id===b.id)||b.isEdge&&(null!==b.source&&b.source.id===a.id||null!==b.target&&b.target.id===a.id))return!0;for(var c=findType(["Flow","Link","Transition"]),d=0;d<c.length;d++)if(null!==c[d].source&&null!==c[d].target&&(c[d].source.id===a.id&&c[d].target.id===b.id||c[d].target.id===a.id&&c[d].source.id===b.id))return!0;return!1}
function getResidency(a){return map(a,function(a){return a.getAttribute("Residency")})}function setResidency(a,b){map(a,function(a){setAttributeUndoable(a,"Residency",b)})}function getTriggerType(a){return map(a,function(a){return a.getAttribute("Trigger")})}function setTriggerType(a,b){map(a,function(a){setAttributeUndoable(a,"Trigger",b)})}function getTriggerValue(a){return map(a,function(a){return a.getAttribute("Value")})}
function setTriggerValue(a,b){map(a,function(a){setAttributeUndoable(a,"Value",b)})}function getTriggerRepeat(a){return map(a,function(a){return isTrue(a.getAttribute("Repeat"))})}function setTriggerRepeat(a,b){map(a,function(a){setAttributeUndoable(a,"Repeat",b)})}function getTriggerRecalculate(a){return map(a,function(a){return isTrue(a.getAttribute("Recalculate"))})}function setTriggerRecalculate(a,b){map(a,function(a){setAttributeUndoable(a,"Recalculate",b)})}
function getData(a){return map(a,function(a){return a.getAttribute("Data")})}function setData(a,b){map(a,function(a){setAttributeUndoable(a,"Data",b)})}function getConverterInput(a){return map(a,function(a){a=a.getAttribute("Source");return"Time"==a?null:findID(a)})}function setConverterInput(a,b){map(a,function(a){null==b?setAttributeUndoable(a,"Source","Time"):setAttributeUndoable(a,"Source",b.id)})}function getInterpolation(a){return map(a,function(a){return a.getAttribute("Interpolation")})}
function setInterpolation(a,b){map(a,function(a){setAttributeUndoable(a,"Interpolation",b)})}function pressButton(a){graph.getModel().beginUpdate();map(a,function(a){runAction(a.getAttribute("Function"),"<p>There was an error with the Action for the button <i>"+a.getAttribute("name")+"</i>.</p><br/>",a)});graph.getModel().endUpdate()}var trusted=is_owner;
function runAction(a,b,c){try{if(trusted||confirm("This insight is requesting permission to execute custom code. For security reasons, you should only run custom code in trusted insights.\n\nAre you sure you want to run code in this insight?"))trusted=!0,eval('"use strict;"\n\n'+a)}catch(d){b=b||"",Ext.Msg.show({title:getText("Action Error"),msg:b+"<p><tt>"+d+"</tt></p><p><b>Code:</b></p><p><tt><pre>"+a+"</pre></tt></p>",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}),c&&setTimeout(function(){highlight(c)},
100)}}function getPopulationSize(a){return map(a,function(a){return a.getAttribute("Size")})}function setPopulationSize(a,b){map(a,function(a){setAttributeUndoable(a,"Size",b)})}function getAgentBase(a){return map(a,function(a){return findID(a.getAttribute("Agent"))})}function setAgentBase(a,b){map(a,function(a){setAttributeUndoable(a,"Agent",b.id)})}function getGeometryWrap(a){return map(a,function(a){return isTrue(a.getAttribute("GeoWrap"))})}
function setGeometryWrap(a,b){map(a,function(a){setAttributeUndoable(a,"GeoWrap",b)})}function getGeometryUnits(a){return map(a,function(a){return a.getAttribute("GeoDimUnits")})}function setGeometryUnits(a,b){map(a,function(a){setAttributeUndoable(a,"GeoDimUnits",b)})}function getGeometryWidth(a){return map(a,function(a){return a.getAttribute("GeoWidth")})}function setGeometryWidth(a,b){map(a,function(a){setAttributeUndoable(a,"GeoWidth",b)})}
function getGeometryHeight(a){return map(a,function(a){return a.getAttribute("GeoHeight")})}function setGeometryHeight(a,b){map(a,function(a){setAttributeUndoable(a,"GeoHeight",b)})}function getAgentPlacement(a){return map(a,function(a){return a.getAttribute("Placement")})}function setAgentPlacement(a,b){map(a,function(a){setAttributeUndoable(a,"Placement",b)})}function getAgentPlacementFunction(a){return map(a,function(a){return a.getAttribute("PlacementFunction")})}
function setAgentPlacementFunction(a,b){map(a,function(a){setAttributeUndoable(a,"PlacementFunction",b)})}function getAgentNetwork(a){return map(a,function(a){return a.getAttribute("Network")})}function setAgentNetwork(a,b){map(a,function(a){setAttributeUndoable(a,"Network",b)})}function getAgentNetworkFunction(a){return map(a,function(a){return a.getAttribute("NetworkFunction")})}function setAgentNetworkFunction(a,b){map(a,function(a){setAttributeUndoable(a,"NetworkFunction",b)})}
function collapseFolder(a){map(a,function(a){graph.foldCells(!0,!1,[a])})}function expandFolder(a){map(a,function(a){graph.foldCells(!1,!1,[a])})}function getCollapsed(a){return map(a,function(a){return a.isCollapsed()})}function getParent(a){return map(a,function(a){a=a.parentNode||a.parent;return a.value&&"root"==a.value.nodeName||"root"==a.nodeName||"1"==a.id?null:a})}
function setParent(a,b,c){if(graph instanceof SimpleNode)null==b&&(b=graph.children[0].children[0]);else var d=null==b?graph.getDefaultParent():b;map(a,function(a){if(graph instanceof SimpleNode)a.parent.children.splice(a.parent.children.indexOf(a),1),a.parent=b,a.parentNode=b,b.children||(b.children=[]),b.children.push(a);else{var f=getPosition(a),g=new mxChildChange(graph.getModel(),d,a);graph.getModel().execute(g);c||setPosition(a,f)}})}
function getFrozen(a){return map(a,function(a){return isTrue(a.getAttribute("Frozen"))})}function setFrozen(a,b){map(a,function(a){setAttributeUndoable(a,"Frozen",b)})}function getChildren(a,b){isUndefined(b)&&(b=!0);return a.children?b?flatten(map(a.children,function(a){return"Folder"==a.value.nodeName?a.children.concat([a]):a})):a.children:[]}function getFolderType(a){return map(a,function(a){return a.getAttribute("Type")})}
function setFolderType(a,b){map(a,function(a){setAttributeUndoable(a,"Type",b)})}function getFolderAgentParent(a){return map(a,function(a){return a.getAttribute("AgentBase")})}function setFolderAgentParent(a,b){map(a,function(a){setAttributeUndoable(a,"AgentBase",b)})}function getFolderSolver(a){return map(a,function(a){return JSON.parse(a.getAttribute("Solver"))})}function setFolderSolver(a,b){map(a,function(a){setAttributeUndoable(a,"Solver",JSON.stringify(b))})}
function excludeType(a,b){var c=function(a,b){if(a instanceof Array){for(var c=[],d=0;d<a.length;d++)a[d].value.nodeName!=b&&c.push(a[d]);return c}return null==a?a:a.value.nodeName==b?null:a};if(Array.isArray(b)){for(var d=0;d<b.length;d++)a=c(a,b[d]);return a}return c(a,b)}function primitiveIndex(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b.id)return c;return-1}
function uniquePrimitives(a){for(var b=[],c=0;c<a.length;c++){for(var d=!1,e=0;e<b.length;e++)if(b[e].id==a[c].id){d=!0;break}d||b.push(a[c])}return b}var globalVarBank={};function setGlobal(a,b){globalVarBank["_"+a]=b}function getGlobal(a){return globalVarBank["_"+a]}function topBarShown(){return ribbonPanel.getDockedItems()[0].isVisible()}
function toggleTopBar(){var a=ribbonPanel.getDockedItems()[0];if(a.isVisible()){a.hide();try{Ext.get("toolbarToggle").update("&darr;"),Ext.get("toplinks-holder").addCls("collapsed")}catch(b){}}else{a.show();try{Ext.get("toolbarToggle").update("&uarr;"),Ext.get("toplinks-holder").removeCls("collapsed")}catch(c){}}}function sideBarShown(){return!configPanel.collapsed}function toggleSideBar(){sideBarShown()?configPanel.collapse(Ext.Component.DIRECTION_RIGHT,!1):configPanel.expand(!1)}
function updateSideBar(){selectionChanged(!0)};function SimpleNode(){}SimpleNode.prototype.getAttribute=function(a){return this["@attributes"][a]};SimpleNode.prototype.setAttribute=function(a,b){this["@attributes"][a]=""+b};
function loadXML(a){function b(a){if(a.children){var c=a.children.filter(function(a){return"mxCell"==a.value.nodeName});0<c.length&&c[0].getAttribute("parent")&&setParent(a,findID(c[0].getAttribute("parent")));a.children=a.children.filter(function(a){return"mxCell"!=a.value.nodeName});for(c=a.children.length-1;0<=c;c--)b(a.children[c])}}graph=(new DOMParser).parseFromString(a,"text/xml");graph=mxGraphToJson(graph);graph.children[0].value={nodeName:"root",id:1};graph.children[0].id=1;clearPrimitiveCache();
a=findType(["Flow","Link","Transition"]);var c=primitives();a.forEach(function(a){a.source=null;a.target=null;c.forEach(function(b){a.children[0].getAttribute("source")&&a.children[0].getAttribute("source")==b.id&&(a.source=b);a.children[0].getAttribute("target")&&a.children[0].getAttribute("target")==b.id&&(a.target=b)})});clearPrimitiveCache();b(graph);clearPrimitiveCache();return graph}
function simpleCloneNode(a,b){var c=new SimpleNode;c.value=a.cloneNode(!0);c.parent=b;c.parentNode=b;var d=[1].concat(primitives().map(function(a){return a.id}).filter(function(a){return a}));c["@attributes"]={id:Math.max.apply(null,d)+1};if(0<a.attributes.length)for(d=0;d<a.attributes.length;d++){var e=a.attributes.item(d);c["@attributes"][e.nodeName]=e.nodeValue}c.id=c["@attributes"].id;return c}
function mxGraphToJson(a,b){var c=new SimpleNode;c["@attributes"]={};c.value=a;c.parent=b;c.parentNode=b;if(1==a.nodeType){if(0<a.attributes.length){for(var d=0;d<a.attributes.length;d++){var e=a.attributes.item(d);c["@attributes"][e.nodeName]=e.nodeValue}c.id=c["@attributes"].id}}else if(3==a.nodeType)return null;if(a.hasChildNodes())for(c.children=[],d=0;d<a.childNodes.length;d++)e=a.childNodes.item(d),(e=mxGraphToJson(e,c))&&c.children.push(e);return c}
function setAttributeUndoable(a,b,c){a instanceof SimpleNode?(a.setAttribute(b,c),clearPrimitiveCache()):(a=new mxCellAttributeChange(a,b,c),graph.getModel().execute(a))};var test,errorCount=0,testCount=0;function runTests(){errorCount=testCount=0;window.ribbonPanel&&testUI();testCreate();testClearModel();testFolders();testPrimitiveGetSet();testFind();testUnitFunctions();testSimulationGetSet();testSimulation();testUnitsAndConstraints();testMacros();testTimeShift();testRunModel();clearModel();console.log("Tests complete!\n\n Errors: "+errorCount+"/"+testCount);alert("Tests complete! \n\n Errors: "+errorCount+"/"+testCount)}
function testError(a){console.log(a);errorCount++}function assertEqual(a,b,c){testCount++;console.log("- "+test+" - "+a);b!=c&&testError(" *** FAILED  ***  "+test+" "+a+". Found ("+b+") expected ("+c+")")}function assertUnequal(a,b,c){testCount++;console.log("- "+test+" - "+a);b==c&&testError(" *** FAILED ***  "+test+" "+a+". Found ("+b+") expected not ("+c+")")}
function assertNull(a,b){testCount++;console.log("- "+test+" - "+a);null!==b&&testError(" *** FAILED *** "+test+" "+a+". Found ("+b+") expected null.")}function assertNotNull(a,b){testCount++;console.log("- "+test+" - "+a);null===b&&testError(" *** FAILED *** "+test+" "+a+". Found null expected ("+b+").")}
function testRunModel(){test="RunModel";clearModel();var a=createPrimitive("Var","Variable",[100,100],[100,100]);setTimeUnits("Years");setTimeStep(1);setTimeLength(10);setValue(a,"Years()^2");var b=runModel(!0);assertEqual("Old Silent",b.value(a)[2],4);setPauseInterval(1);b=runModel(!0);assertEqual("Pause Interval",b.value(a)[2],4);setPauseInterval(0);runModel({silent:!0,onSuccess:function(b){assertEqual("Silent Callback",b.value(a)[2],4)}});setValue(a,"sds");b=runModel(!0);assertUnequal("Old Silent Error",
b.error,"none");runModel({silent:!0,onError:function(a){assertUnequal("Silent Callback Error",a.error,"none")}});graph instanceof SimpleNode||runModel({silent:!1,onError:function(a){assertUnequal("Non-Silent Callback Error",a.error,"none")}});clearModel();setTimeout(function(){var a=createPrimitive("p","Variable",[100,100],[100,100]);setShowSlider(a,!0);setPauseInterval(2);setValue(a,1);var b=1;runModel({silent:!0,onPause:function(e){assertEqual("Pause "+b,e.lastValue(a),b);b++;e.setValue(a,b);e.resume()},
onSuccess:function(e){assertEqual("Pause "+b,e.lastValue(a),b);assertEqual("Pause done",!0,!0)},onError:function(){assertEqual("Pause failed",!0,!1)}})},1E3);clearModel()}function testBothAgents(){setAlgorithm("RK1");console.log("---RK1---");testAgents();setAlgorithm("RK4");console.log("---RK4---");testAgents()}
function testSubscripting(){var a=test,b=getTimeLength(),c=getTimeUnits();setTimeUnits("Years");setTimeLength(20);test="Subscripting";getAlgorithm();clearModel();var d=runModel(!0);assertEqual("Blank Model",d.error,"none");var e=createPrimitive("Population","Stock",[100,100],[100,100]),f=createPrimitive("Rate","Variable",[100,100],[100,100]),g=createConnector("Growth","Flow",null,e);createConnector("Link","Link",f,g);var k=createPrimitive("Aggregate","Variable",[100,100],[100,100]),l=createPrimitive("Aggregate 2",
"Variable",[100,100],[100,100]);createConnector("Link","Link",e,k);createConnector("Link","Link",e,l);setValue(e,"\u00ab'a': 10, 'b': 5\u00bb");setValue(g,"[Rate]");setValue(f,"\u00aba: 2, b: 1\u00bb");setValue(k,'[Population]{"a"}');setValue(l,'[Population]\u00ab"b"\u00bb');d=runModel(!0);assertEqual("Subscripting 1",d.value(k)[10],30);assertEqual("Subscripting 2",d.value(l)[10],15);setValue(k,"[Population]\u00abmean\u00bb");setValue(l,"[Population]\u00abmax\u00bb");d=runModel(!0);assertEqual("Subscripting 3",
d.value(k)[10],22.5);assertEqual("Subscripting 4",d.value(l)[10],30);setValue(f,"2");runModel(!0);assertUnequal("Subscripting Error 1",runModel(!0).error,"none");setValue(f,"repeat(2, <<'a', 'b'>>)");d=runModel(!0);assertEqual("Subscripting 5",d.value(k)[10],27.5);assertEqual("Subscripting 6",d.value(l)[10],30);setValue(e,"\u00ab'males': \u00abcanada:1, usa:2,'mexico':3\u00bb, 'females': \u00ab'usa':20, 'canada':10, 'mexico': 30\u00bb \u00bb");setValue(k,'([Population]\u00ab"males", *\u00bb).usa');
setValue(l,'[Population]\u00ab"females", "mexico"\u00bb');runModel(!0);assertUnequal("Subscripting Error 2",runModel(!0).error,"none");setValue(f,"repeat(repeat(2, <<'canada', 'usa', 'mexico'>>), <<'males', 'females'>>)");d=runModel(!0);assertEqual("Subscripting 7",d.value(k)[10],22);assertEqual("Subscripting 8",d.value(l)[10],50);setValue(k,'[Population]\u00ab"males", max\u00bb');setValue(l,'[Population]\u00abmin, "canada"\u00bb');d=runModel(!0);assertEqual("Subscripting 9",d.value(k)[10],23);assertEqual("Subscripting 10",
d.value(l)[10],21);setValue(k,'([Population]\u00ab"males", *\u00bb)\u00ab"USA"\u00bb');setValue(l,'([Population]\u00ab* , "mexico"\u00bb)\u00ab"Females"\u00bb');d=runModel(!0);assertEqual("Subscripting 11",d.value(k)[10],22);assertEqual("Subscripting 12",d.value(l)[10],50);setValue(k,'([Population]{"males", *}){"USA"}');setValue(l,'([Population]{* , "mexico"}).Females');d=runModel(!0);assertEqual("Subscripting 13",d.value(k)[10],22);assertEqual("Subscripting 14",d.value(l)[10],50);setValue(f,"{males: repeat(3, {'canada', 'usa', 'mexico'}), females: repeat(1, {'canada', 'usa', 'mexico'})}");
d=runModel(!0);assertEqual("Subscripting 15",d.value(k)[10],32);assertEqual("Subscripting 16",d.value(l)[10],40);setNonNegative(e,!1);setNonNegative(g,!0);setValue(f,"\u00ab'males': repeat(3, <<'canada', 'usa', 'mexico'>>), 'females': repeat(-4, <<'canada', 'usa', 'mexico'>>)\u00bb");d=runModel(!0);assertEqual("Flow OnlyPositive 1",d.value(k)[10],32);assertEqual("Flow OnlyPositive  2",d.value(l)[10],30);setNonNegative(g,!1);d=runModel(!0);assertEqual("Flow OnlyPositive  3",d.value(k)[10],32);assertEqual("Flow OnlyPositive  4",
d.value(l)[10],-10);setNonNegative(e,!0);d=runModel(!0);assertEqual("Stock Non Negative 1",d.value(k)[10],32);assertEqual("Stock Non Negative 2",d.value(l)[10],0);setNonNegative(e,!1);setConstraints(e,[-100,!0,100,!0]);runModel(!0);assertEqual("Constraints 1",runModel(!0).error,"none");setConstraints(e,[-5,!0,100,!0]);runModel(!0);assertUnequal("Constraints 2",runModel(!0).error,"none");setConstraints(e,[-100,!0,31,!0]);runModel(!0);assertUnequal("Constraints 3",runModel(!0).error,"none");setConstraints(e,
[-100,!1,31,!1]);runModel(!0);assertEqual("Constraints 4",runModel(!0).error,"none");setUnits([e,k,l],"Widgets");setUnits([g,f],"Widgets/Year");runModel(!0);runModel(!0);assertEqual("Units 1",runModel(!0).error,"none");setValue(e,"\u00ab'males': \u00ab'canada':1,'usa':{2 cats},'mexico':3\u00bb, 'females': \u00ab'usa':20, 'canada':10, 'mexico': 30\u00bb \u00bb");runModel(!0);assertUnequal("Units 2",runModel(!0).error,"none");setValue(e,"\u00ab'males': \u00ab'canada':1,'usa':{2 widgets},'mexico':3\u00bb, 'females': \u00ab'usa':20, 'canada':10, 'mexico': 30\u00bb \u00bb");
runModel(!0);assertEqual("Units 3",runModel(!0).error,"none");setStockType(e,"Conveyor");setDelay(e,5);d=runModel(!0);assertEqual("Conveyor 1",d.value(k)[14],32);assertEqual("Conveyor 2",Math.round(1E5*d.value(l)[14]),-1E6);setValue(k,'([Population]\u00ab"males", *\u00bb)\u00ab"India"\u00bb');runModel(!0);assertUnequal("Errors 1",runModel(!0).error,"none");setValue(k,'([Population]\u00ab"foobar", *\u00bb)\u00ab"USA"\u00bb');runModel(!0);assertUnequal("Errors 2",runModel(!0).error,"none");clearModel();
var e=createPrimitive("Population","Stock",[100,100],[100,100]),m=createPrimitive("Population 2","Stock",[100,100],[100,100]),f=createPrimitive("Rate","Variable",[100,100],[100,100]),g=createConnector("Growth","Flow",e,m);createConnector("Link","Link",f,g);k=createPrimitive("Aggregate","Variable",[100,100],[100,100]);createConnector("Link","Link",m,k);l=createPrimitive("Aggregate 2","Variable",[100,100],[100,100]);createConnector("Link","Link",e,l);setValue(e,100);setValue(m,0);setValue(g,"[Rate]");
setValue(f,"<<'dogs':1, 'cats':2>>");d=runModel(!0);assertEqual("Collapsing 1",d.value(e)[10],70);assertEqual("Collapsing 2",d.value(m)[10],30);setValue(m,"<<'dogs':5, 'cats':4>>");setValue(k,"[population 2]<<'dogs'>>");d=runModel(!0);assertEqual("Collapsing 3",d.value(e)[10],70);assertEqual("Collapsing 4",d.value(k)[10],15);setValue(f,"<<'dogs': <<'x': 1, 'y':2>>, 'cats': <<'x':3, 'y':4>> >>");d=runModel(!0);assertEqual("Collapsing 5",d.value(e)[10],0);assertEqual("Collapsing 6",d.value(k)[10],35);
setValue(e,"<<x:40, y:60>>");setValue(l,"[Population]<<'x'>>");d=runModel(!0);assertEqual("Collapsing 7",d.value(l)[10],0);assertEqual("Collapsing 8",d.value(k)[10],35);setValue(m,"<<'dogs':5, 'cats':4, rats:6>>");setValue(f,"<<'dogs': <<'x': 1, 'y':2>>, 'cats': <<'x':3, 'y':4>>, 'rats': <<'x':9, 'y':10>> >>");d=runModel(!0);assertEqual("Collapsing 9",d.value(l)[10],-90);assertEqual("Collapsing 10",d.value(k)[10],35);setEnds(g,[m,e]);d=runModel(!0);assertEqual("Collapsing 11",d.value(l)[10],170);
assertEqual("Collapsing 12",d.value(k)[10],-25);clearModel();test=a;setTimeUnits(c);setTimeLength(b)}
function testAgents(){var a=test;test="Agents";getAlgorithm();clearModel();var b=createPrimitive("My State","State",[100,100],[100,100]),c=createPrimitive("My State 2","State",[100,100],[100,100]);setValue(b,"false || true");setValue(c,"false || 0");var d=runModel(!0);assertEqual("State Start 1",d.value(b)[0],1);assertEqual("State Start 2",d.value(c)[0],0);assertEqual("State Start 3",d.value(b)[10],1);assertEqual("State Start 4",d.value(c)[10],0);setValue(b,"true");setValue(c,"false");var e=createPrimitive("Action 1",
"Action",[100,100],[100,100]);setValue(e,"[My State] <- false");setTriggerType(e,"Timeout");setTriggerValue(e,5);var f=createPrimitive("Action 2","Action",[100,100],[100,100]);setTriggerType(f,"Timeout");setTriggerValue(f,100);setValue(f,"[My State 2] <- true");var g=createConnector("Link","Link",b,e),k=createConnector("Link","Link",c,f),d=runModel(!0);assertEqual("State Start 5",d.value(b)[0],1);assertEqual("State Start 6",d.value(c)[0],0);assertEqual("State Start 7",d.value(b)[10],0);assertEqual("State Start 8",
d.value(c)[10],0);removePrimitive(e);removePrimitive(f);removePrimitive(g);removePrimitive(k);setValue(b,"false || true");setValue(c,"false || 0");var l=createConnector("My Transition","Transition",null,c),m=createConnector("My Transition","Transition",c,null);setTriggerType(l,"Timeout");setTriggerValue(l,"{2 years}");setTriggerType(m,"Timeout");setTriggerValue(m,"{3 years}");d=runModel(!0);assertEqual("Transition T Dangle 1",d.value(b)[0],1);assertEqual("Transition T Dangle 2",d.value(c)[0],0);assertEqual("Transition T Dangle 3",
d.value(b)[3],1);assertEqual("Transition T Dangle 4",d.value(c)[3],1);assertEqual("Transition T Dangle 5",d.value(c)[8],0);removePrimitive(l);removePrimitive(m);l=createConnector("My Transition","Transition",b,c);m=createConnector("My Transition","Transition",c,b);setTriggerType(l,"Timeout");setTriggerValue(l,"{10 Years} - Time()");setTriggerType(m,"Timeout");setTriggerValue(m,"{100 years}");d=runModel(!0);assertEqual("Recalculate 1",d.value(b)[0],1);assertEqual("Recalculate 2",d.value(c)[0],0);assertEqual("Recalculate 3",
d.value(b)[3],1);assertEqual("Recalculate 4",d.value(c)[3],0);assertEqual("Recalculate 5",d.value(b)[6],1);assertEqual("Recalculate 6",d.value(c)[6],0);setTriggerRecalculate(l,!0);d=runModel(!0);assertEqual("Recalculate 7",d.value(b)[0],1);assertEqual("Recalculate 8",d.value(c)[0],0);assertEqual("Recalculate 9",d.value(b)[3],1);assertEqual("Recalculate 10",d.value(c)[3],0);assertEqual("Recalculate 11",d.value(b)[6],0);assertEqual("Recalculate 12",d.value(c)[6],1);setTriggerRecalculate(l,!1);setTriggerType(l,
"Probability");setTriggerValue(l,"IfThenElse(years < 2, 0, 1)");d=runModel(!0);assertEqual("Recalculate 13",d.value(b)[0],1);assertEqual("Recalculate 14",d.value(c)[0],0);assertEqual("Recalculate 15",d.value(b)[3],1);assertEqual("Recalculate 16",d.value(c)[3],0);assertEqual("Recalculate 17",d.value(b)[6],1);assertEqual("Recalculate 18",d.value(c)[6],0);setTriggerRecalculate(l,!0);d=runModel(!0);assertEqual("Recalculate 19",d.value(b)[0],1);assertEqual("Recalculate 20",d.value(c)[0],0);assertEqual("Recalculate 21",
d.value(b)[3],0);assertEqual("Recalculate 22",d.value(c)[3],1);assertEqual("Recalculate 23",d.value(b)[6],0);assertEqual("Recalculate 24",d.value(c)[6],1);setTriggerRecalculate(l,!1);setTriggerType(l,"Timeout");setTriggerValue(l,"{2 years}");setTriggerType(m,"Timeout");setTriggerValue(m,"{3 years}");d=runModel(!0);assertEqual("Transition T 1",d.value(b)[0],1);assertEqual("Transition T 2",d.value(c)[0],0);assertEqual("Transition T 3",d.value(b)[3],0);assertEqual("Transition T 4",d.value(c)[3],1);assertEqual("Transition T 5",
d.value(b)[6],1);assertEqual("Transition T 6",d.value(c)[6],0);setTriggerValue(l,"2");setTriggerValue(m,"3");d=runModel(!0);assertEqual("Transition T 1.2",d.value(b)[0],1);assertEqual("Transition T 2.2",d.value(c)[0],0);assertEqual("Transition T 3.2",d.value(b)[3],0);assertEqual("Transition T 4.2",d.value(c)[3],1);assertEqual("Transition T 5.2",d.value(b)[6],1);assertEqual("Transition T 6.2",d.value(c)[6],0);setResidency(b,"2");d=runModel(!0);assertEqual("Residency 1",d.value(b)[0],1);assertEqual("Residency 2",
d.value(c)[0],0);assertEqual("Residency 3",d.value(b)[3],1);assertEqual("Residency 4",d.value(c)[3],0);assertEqual("Residency 5",d.value(b)[6],0);assertEqual("Residency 6",d.value(c)[6],1);setResidency(b,"{2 years}");d=runModel(!0);assertEqual("Residency 7",d.value(b)[0],1);assertEqual("Residency 8",d.value(c)[0],0);assertEqual("Residency 9",d.value(b)[3],1);assertEqual("Residency 10",d.value(c)[3],0);assertEqual("Residency 11",d.value(b)[6],0);assertEqual("Residency 12",d.value(c)[6],1);setResidency(b,
"0");setTriggerType(l,"Probability");setTriggerValue(l,"1");setTriggerType(m,"Timeout");setTriggerValue(m,"{100 years}");d=runModel(!0);assertEqual("Transition P 1",d.value(b)[0],1);assertEqual("Transition P 2",d.value(c)[0],0);assertEqual("Transition P 3",d.value(b)[2],0);assertEqual("Transition P 4",d.value(c)[2],1);assertEqual("Transition P 5",d.value(b)[10],0);assertEqual("Transition P 6",d.value(c)[10],1);setTriggerValue(l,"2");d=runModel(!0);assertUnequal(d.error,"none");setTriggerValue(l,"-1");
d=runModel(!0);assertUnequal(d.error,"none");setTriggerValue(l,"0");d=runModel(!0);assertEqual("Transition P 1.3",d.value(b)[0],1);assertEqual("Transition P 2.3",d.value(c)[0],0);assertEqual("Transition P 3.3",d.value(b)[2],1);assertEqual("Transition P 4.3",d.value(c)[2],0);setTriggerType(l,"Condition");setTriggerValue(l,"years = 5");setTriggerType(m,"Condition");setTriggerValue(m,"years = 7");d=runModel(!0);assertEqual("Transition C 1",d.value(b)[0],1);assertEqual("Transition C 2",d.value(c)[0],
0);assertEqual("Transition C 3",d.value(b)[6],0);assertEqual("Transition C 4",d.value(c)[6],1);assertEqual("Transition C 5",d.value(b)[7],0);assertEqual("Transition C 6",d.value(c)[7],1);assertEqual("Transition C 7",d.value(b)[8],1);assertEqual("Transition C 8",d.value(c)[8],0);setTriggerRepeat(l,!0);setTriggerRepeat(m,!0);d=runModel(!0);assertEqual("Transition C Repeat 1",d.value(b)[0],1);assertEqual("Transition C Repeat 2",d.value(c)[0],0);assertEqual("Transition C Repeat 3",d.value(b)[6],0);assertEqual("Transition C Repeat 4",
d.value(c)[6],1);assertEqual("Transition C Repeat 5",d.value(b)[7],0);assertEqual("Transition C Repeat 6",d.value(c)[7],1);assertEqual("Transition C Repeat 7",d.value(b)[8],1);assertEqual("Transition C Repeat 8",d.value(c)[8],0);clearModel();b=createPrimitive("State","State",[100,100],[100,100]);c=createPrimitive("Variable","State",[300,100],[100,100]);createConnector("My Link","Link",b,c);setValue(b,"true");setValue(c,"ifThenElse([State], 1, 0)");d=runModel(!0);assertEqual("State Values 1",d.value(b)[0],
1);assertEqual("State Values 2",d.value(c)[0],1);setValue(b,"false");d=runModel(!0);assertEqual("State Values 3",d.value(b)[0],0);assertEqual("State Values 4",d.value(c)[0],0);setValue(c,"if [State] then\n 1\nelse\n 0\nend if");d=runModel(!0);assertEqual("State Values 5",d.value(b)[0],0);assertEqual("State Values 6",d.value(c)[0],0);setValue(b,"true");d=runModel(!0);assertEqual("State Values 7",d.value(b)[5],1);assertEqual("State Values 8",d.value(c)[5],1);clearModel();b=createPrimitive("State 1",
"State",[100,100],[100,100]);c=createPrimitive("State 2","State",[100,100],[100,100]);g=createConnector("My Link","Link",b,c);l=createConnector("My Transition","Transition",b,c);m=createConnector("My Transition","Transition",c,b);setTriggerType(l,"Timeout");setTriggerValue(l,"{2 years}");setTriggerType(m,"Condition");setTriggerValue(m,"false");setValue(b,"1");setValue(c,"! [State 1]");f=createPrimitive("My Agent","Folder",[200,150],[400,400]);setParent([b,c,g,l,m],f);setFolderType(f,"Agent");var n=
createPrimitive("Population","Agents",[1210,0],[200,200]);createConnector("Link","Link",f,n);setAgentBase(n,f);setPopulationSize(n,10);var c=createPrimitive("My Variable","Variable",[1200,150],[150,100]),p=createPrimitive("My Variable 2","Variable",[1200,150],[150,100]);setValue(c,"Count(FindAll([Population]))");setValue(p,"PopulationSize([Population])+1");createConnector("My Link","Link",n,c);createConnector("My Link","Link",n,p);d=runModel(!0);assertEqual("Pop 1",d.value(c)[0],10);assertEqual("Pop 2",
d.value(c)[8],10);assertEqual("Pop 2.1",d.value(p)[0],11);assertEqual("Pop 2.2",d.value(p)[8],11);setValue(c,"[Population].FindAll().length()");setValue(p,"[Population].PopulationSize()+1");d=runModel(!0);assertEqual("Pop 1 (Obj)",d.value(c)[0],10);assertEqual("Pop 2 (Obj)",d.value(c)[8],10);assertEqual("Pop 2.1 (Obj)",d.value(p)[0],11);assertEqual("Pop 2.2 (Obj)",d.value(p)[8],11);setValue(c,"Count(FindState([Population], [State 1]))");setValue(p,"Count(FindState([Population], [State 2]))");d=runModel(!0);
assertEqual("Pop 3",d.value(c)[0],10);assertEqual("Pop 4",d.value(p)[0],0);assertEqual("Pop 5",d.value(c)[8],0);assertEqual("Pop 6",d.value(p)[8],10);setValue(c,"[Population].findState([State 1]).length()");setValue(p,"[Population].findState([State 2]).length()");d=runModel(!0);assertEqual("Pop 3 (Obj)",d.value(c)[0],10);assertEqual("Pop 4 (Obj)",d.value(p)[0],0);assertEqual("Pop 5 (Obj)",d.value(c)[8],0);assertEqual("Pop 6 (Obj)",d.value(p)[8],10);var q=createPrimitive("My Variable 3","Variable",
[1200,150],[150,100]);createConnector("My Link","Link",n,q);createConnector("My Link","Link",q,p);setValue(q,"FindState([Population], [State 2])");setValue(p,"Count([My Variable 3])");d=runModel(!0);assertEqual("Pop 6.1",d.value(c)[0],10);assertEqual("Pop 6.2",d.value(p)[0],0);assertEqual("Pop 6.3",d.value(c)[8],0);assertEqual("Pop 6.4",d.value(p)[8],10);assertEqual("Pop 6.5",d.error,"none");setValue(q,"[Population].findState([State 2])");setValue(p,"[My Variable 3].length()");d=runModel(!0);assertEqual("Pop 6.1 (Obj)",
d.value(c)[0],10);assertEqual("Pop 6.2 (Obj)",d.value(p)[0],0);assertEqual("Pop 6.3 (Obj)",d.value(c)[8],0);assertEqual("Pop 6.4 (Obj)",d.value(p)[8],10);assertEqual("Pop 6.5 (Obj)",d.error,"none");setValue(c,"Count(FindNotState([Population], [State 1]))");setValue(p,"Count(FindNotState([Population], [State 2]))");d=runModel(!0);assertEqual("Pop 6.6",d.error,"none");setValue(c,"Count([Population].FindNotState([State 1]))");setValue(p,"Count([Population].FindNotState([State 2]))");d=runModel(!0);assertEqual("Pop 6.6 (Obj)",
d.error,"none");setValue(q,"FindState([Population], [State 2])+1");d=runModel(!0);assertUnequal("Pop 6.7",d.error,"none");setValue(q,"[Population].FindState([State 2])+1");d=runModel(!0);assertUnequal("Pop 6.7 (Obj)",d.error,"none");setValue(q,"[Population]+1");d=runModel(!0);assertUnequal("Pop 6.8",d.error,"none");removePrimitive(q);setTriggerType(m,"Timeout");setTriggerValue(m,"5");setTriggerType(m,"Condition");setTriggerValue(m,"index(self)=1 and years=7");d=runModel(!0);assertEqual("Pop 7",d.value(c)[0],
0);assertEqual("Pop 8",d.value(p)[0],10);assertEqual("Pop 9",d.value(c)[8],9);assertEqual("Pop 10",d.value(p)[8],1);setTriggerValue(m,"self.index()=1 and years=7");d=runModel(!0);assertEqual("Pop 7 (obj)",d.value(c)[0],0);assertEqual("Pop 8 (obj)",d.value(p)[0],10);assertEqual("Pop 9 (obj)",d.value(c)[8],9);assertEqual("Pop 10 (obj)",d.value(p)[8],1);q=createPrimitive("Var","Variable",[200,150],[150,100]);setParent(q,f);d=createPrimitive("Outside Var","Variable",[200,150],[150,100]);setParent(d,f);
setValue(d,"IfThenElse(years<5, 1, 0)");createConnector("Link","Link",d,q);setValue(q,"[Outside Var]*2");setValue(c,"Min(Value([Population], [Var]))");setValue(p,"Max(Value([Population], [Var]))");d=runModel(!0);assertEqual("Pop 10.1",d.value(c)[0],2);assertEqual("Pop 10.2",d.value(c)[8],0);setValue(c,"[Population].value([Var]).min()");setValue(p,"Max([Population].Value([Var]))");d=runModel(!0);assertEqual("Pop 10.1 (obj)",d.value(c)[0],2);assertEqual("Pop 10.2 (obj)",d.value(c)[8],0);setMacros("counter <- 0");
e=createPrimitive("Action","Action",[200,150],[150,100]);setTriggerType(e,"Condition");setTriggerValue(e,"true");setValue(e,"Counter <- counter + 1");setValue(q,"counter*3");d=runModel(!0);assertEqual("Pop 10.3",d.value(c)[0],0);assertEqual("Pop 10.4",d.value(c)[8],24);setTriggerRepeat(e,!1);d=runModel(!0);assertEqual("Repeat Off 1",d.value(c)[0],0);assertEqual("Repeat Off 2",d.value(c)[8],3);setTriggerRepeat(e,!0);setTriggerValue(e,"false");d=runModel(!0);assertEqual("Pop 10.5",d.value(c)[0],0);
assertEqual("Pop 10.6",d.value(c)[8],0);setTriggerType(e,"Condition");setTriggerValue(e,"true");d=runModel(!0);assertEqual("Pop 10.7",d.value(c)[0],0);assertEqual("Pop 10.8",d.value(c)[8],24);setTriggerValue(e,"false");d=runModel(!0);assertEqual("Pop 10.9",d.value(c)[0],0);assertEqual("Pop 10.10",d.value(c)[8],0);setTriggerType(e,"Timeout");setTriggerValue(e,"100");d=runModel(!0);assertEqual("Pop 10.11",d.value(c)[0],0);assertEqual("Pop 10.12",d.value(c)[8],0);setTriggerValue(e,"{100 years}");d=runModel(!0);
assertEqual("Pop 10.13",d.value(c)[0],0);assertEqual("Pop 10.14",d.value(c)[8],0);setTriggerType(e,"Condition");setTriggerValue(e,"true");var u=createPrimitive("Count","Stock",[200,150],[150,100]);setParent([e,u],f);setValue(u,10);setValue(e,"[Count] <- [Count] + 2");g=createConnector("Link","Link",u,q);k=createConnector("Link","Link",u,e);setValue(q,"[Count]");d=runModel(!0);assertEqual("Pop 10.17",d.value(c)[0],10);assertEqual("Pop 10.18",d.value(c)[8],26);removePrimitive(e);removePrimitive(u);
removePrimitive(g);removePrimitive(k);setValue(q,"index(self)");d=runModel(!0);assertEqual("Pop 11",d.value(c)[0],1);assertEqual("Pop 12",d.value(p)[8],10);setValue(c,"PopulationSize([Population])");setValue(p,"Count(Value([Population], [Var]))");d=runModel(!0);assertEqual("Pop 12.1",d.value(c)[0],d.value(p)[0]);assertEqual("Pop 12.2",d.value(c)[8],d.value(p)[8]);setValue(c,"[Population].PopulationSize()");setValue(p,"Count([Population].Value([Var]))");d=runModel(!0);assertEqual("Pop 12.1 (Obj)",
d.value(c)[0],d.value(p)[0]);assertEqual("Pop 12.2 (Obj)",d.value(c)[8],d.value(p)[8]);setValue(c,"Count(Join(FindState([Population], [State 1]), FindState([Population], [State 2])))");setValue(p,"Min(Value(Join(FindState([Population], [State 1]), FindState([Population], [State 2])), [Var]))");d=runModel(!0);assertEqual("Pop 13",d.value(c)[0],10);assertEqual("Pop 14",d.value(p)[8],1);setValue(c,"Join([Population].FindState([State 1]), [Population].FindState([State 2])).Length()");setValue(p,"Join([Population].FindState([State 1]), [Population].FindState([State 2])).Value([Var]).Min()");
d=runModel(!0);assertEqual("Pop 13 (Obj)",d.value(c)[0],10);assertEqual("Pop 14 (Obj)",d.value(p)[8],1);setValue(c,"Count(Join(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var]) <=3)))");setValue(p,"Count(Union(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var]) <=3)))");d=runModel(!0);assertEqual("Pop 14.1",d.value(c)[0],5);assertEqual("Pop 14.2",d.value(p)[8],5);setValue(c,"Join(Filter([Population].FindAll(), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var]) <=3)).Length()");
setValue(p,"Union([Population].FindAll().Filter(x.value([Var])>8), [Population].FindAll().Filter(x.value([Var]) <=3)).Length()");d=runModel(!0);assertEqual("Pop 14.1 (Obj)",d.value(c)[0],5);assertEqual("Pop 14.2 (Obj)",d.value(p)[8],5);setValue(c,"Count(Intersection(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var])<=3)))");setValue(p,"Count(Difference(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var])<=3)))");
d=runModel(!0);assertEqual("Pop 14.3",d.value(c)[0],0);assertEqual("Pop 14.4",d.value(p)[8],5);setValue(c,"Distance(FindNearest([Population], FindIndex([population], 1)), FindIndex([population], 1)) = Min(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");setValue(p,"Distance(FindFurthest([Population], FindIndex([population], 1)), FindIndex([population], 1)) = Max(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");
d=runModel(!0);assertEqual("Pop 14.5",d.value(c)[0],1);assertEqual("Pop 14.6",d.value(p)[8],1);setValue(c,"Distance([Population].FindNearest([population].FindIndex(1)), [population].FindIndex(1)) = Min(map(Select([Population].FindAll(),join(false, repeat(true,9))), distance(x, [population].FindIndex(1))))");setValue(p,"Distance([Population].FindFurthest([population].FindIndex(1)), [population].FindIndex(1)) = Max(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, [population].FindIndex(1))))");
d=runModel(!0);assertEqual("Pop 14.5 (Obj)",d.value(c)[0],1);assertEqual("Pop 14.6 (Obj)",d.value(p)[8],1);setValue(c,"Distance(select(FindNearest([Population], FindIndex([population], 1),2),2), FindIndex([population], 1)) = Min(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");setValue(p,"Distance(select(FindFurthest([Population], FindIndex([population], 1),3),2), FindIndex([population], 1)) = Max(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");
d=runModel(!0);assertEqual("Pop 14.5.2",d.value(c)[0],0);assertEqual("Pop 14.6.2",d.value(p)[8],0);setValue(c,"Count(FindNearby([Population], FindIndex([Population], 1), 400))");setValue(p,"Count(FindNearby([Population], FindIndex([Population], 1), 0))");d=runModel(!0);assertEqual("Pop 14.7",d.value(c)[0],9);assertEqual("Pop 14.8",d.value(p)[8],0);setValue(c,"[Population].FindNearby([Population].FindIndex(1), 400).length()");setValue(p,"[Population].FindNearby([Population].FindIndex(1), 0).length()");
d=runModel(!0);assertEqual("Pop 14.7 (Obj)",d.value(c)[0],9);assertEqual("Pop 14.8 (Obj)",d.value(p)[8],0);setValue(c,"[Population].FindNearby( {0,0}, 400).length()");setValue(p,"[Population].FindNearby({0,0}, 0).length()");d=runModel(!0);assertEqual("Pop 14.7.2",d.value(c)[0],10);assertEqual("Pop 14.8.2",d.value(p)[8],0);setValue(c,"[Population].FindNearby( {0}, 400).length()");d=runModel(!0);assertUnequal("Pop 14.7.3",d.error,"none");setValue(c,"[Population].FindNearby( {0,0}, 400).length()");setValue(p,
"[Population].FindNearby({0}, 0).length()");d=runModel(!0);assertUnequal("Pop 14.8.3",d.error,"none");setValue(p,"[Population].FindNearby({0,0}, 0).length()");d=runModel(!0);assertEqual("Pop 14.7.4",d.value(c)[0],10);assertEqual("Pop 14.8.4",d.value(p)[8],0);setValue(c,"[Population].FindNearby( 'abc', 400).length()");d=runModel(!0);assertUnequal("Pop 14.8.5",d.error,"none");setValue(c,"width([Population])");setValue(p,"height([Population])");d=runModel(!0);assertEqual("Pop 14.9",d.value(c)[0],200);
assertEqual("Pop 14.10",d.value(p)[8],100);setValue(c,"[Population].FindIndex(2) == [Population].FindIndex(2)");setValue(p,"[Population].FindIndex(2) == [Population].FindIndex(3)");d=runModel(!0);assertEqual("Comparison 1",d.value(c)[0],!0);assertEqual("Comparison 2",d.value(p)[8],!1);setValue(c,"[Population].FindIndex(2) != [Population].FindIndex(2)");setValue(p,"[Population].FindIndex(2) != [Population].FindIndex(3)");d=runModel(!0);assertEqual("Comparison 3",d.value(c)[0],!1);assertEqual("Comparison 4",
d.value(p)[8],!0);setValue(c,"[Population].FindIndex(2) > [Population].FindIndex(2)");d=runModel(!0);assertUnequal("Comparison 5",d.error,"none");setValue(c,"[Population].FindIndex(2) >= [Population].FindIndex(2)");d=runModel(!0);assertUnequal("Comparison 6",d.error,"none");setValue(c,"[Population].FindIndex(2) < [Population].FindIndex(2)");d=runModel(!0);assertUnequal("Comparison 7",d.error,"none");setValue(c,"[Population].FindIndex(2) <= [Population].FindIndex(2)");d=runModel(!0);assertUnequal("Comparison 8",
d.error,"none");setAgentPlacement(n,"Grid");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");setValue(p,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");d=runModel(!0);assertEqual("Grid Loc 15",d.value(c)[0],0);assertEqual("Grid Loc 16",d.value(p)[8],1);setAgentPlacement(n,"Ellipse");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");
setValue(p,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");d=runModel(!0);assertEqual("Grid Loc 16.1",d.value(c)[0],0);assertEqual("Grid Loc 16.2",d.value(p)[8],0);setAgentPlacement(n,"Network");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");setValue(p,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");
d=runModel(!0);assertEqual("Network Loc 17",d.value(c)[0],0);assertEqual("Network Loc 18",d.value(p)[8],0);setAgentPlacement(n,"Custom Function");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");setValue(p,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");d=runModel(!0);assertEqual("Custom Loc 19",d.value(c)[0],0);assertEqual("Custom Loc 20",d.value(p)[8],
0);setAgentPlacementFunction(n,"<<index(Self)*10,index(Self)*20>>");setValue(c,"Location(FindIndex([Population], 1)).x");setValue(p,"Location(FindIndex([Population], 2)).y");d=runModel(!0);assertEqual("Custom Loc 21",d.value(c)[0],10);assertEqual("Custom Loc 22",d.value(p)[8],40);setAgentPlacementFunction(n,"{index(Self)*10, Self.index()*20}");d=runModel(!0);assertEqual("Custom Loc 21 (Self)",d.value(c)[0],10);assertEqual("Custom Loc 22 (Self)",d.value(p)[8],40);setAgentPlacementFunction(n,"<<Self.index()*10,Self.index()*20>>");
setValue(c,"[Population].FindIndex(1).Location().x");setValue(p,"[Population].FindIndex(2).Location().y");d=runModel(!0);assertEqual("Custom Loc 21 (Obj)",d.value(c)[0],10);assertEqual("Custom Loc 22 (Obj)",d.value(p)[8],40);e=createPrimitive("Mover","Action",[200,150],[150,100]);setParent(e,f);setTriggerType(e,"Condition");setTriggerValue(e,"true");setValue(e,"move(Self, {10, 20})");d=runModel(!0);assertEqual("Custom Move 22",d.value(c)[2],30);assertEqual("Custom Move 23",d.value(p)[9],220);setValue(e,
"Self.move({10, 20})");d=runModel(!0);assertEqual("Custom Move 22 (Obj)",d.value(c)[2],30);assertEqual("Custom Move 23 (Obj)",d.value(p)[9],220);setValue(e,"Self.setLocation({11, 21})");d=runModel(!0);assertEqual("Custom Move 24 (Obj)",d.value(c)[2],11);assertEqual("Custom Move 25 (Obj)",d.value(p)[9],21);setFolderAgentParent(f,"x <- new AgentBase\n x.doMove <- function() self.move({10, 20})\n x");setValue(e,"Self.doMove()");d=runModel(!0);assertEqual("Custom Agent Parent 1",d.value(c)[2],30);assertEqual("Custom Agent Parent 2",
d.value(p)[9],220);setMacros("mover <- new AgentBase\n mover.doMove <- function(dist) self.move(dist*{1, 2})");setFolderAgentParent(f,"mover");setValue(e,"Self.doMove(10)");d=runModel(!0);assertEqual("Custom Agent Parent 3",d.value(c)[2],30);assertEqual("Custom Agent Parent 4",d.value(p)[9],220);setGeometryWrap(n,!0);d=runModel(!0);assertEqual("Custom Move 24",d.value(c)[2],30);assertEqual("Custom Move 25",d.value(p)[9],20);createConnector("Link","Link",n,e);setAgentPlacementFunction(n,"{index(Self)*10, 1}");
setValue(e,"moveTowards(Self, findIndex([Population], 1), 1)");setValue(p,"Location(FindIndex([Population], 2)).x");d=runModel(!0);assertEqual("Custom Move 26",d.value(c)[2],10);assertEqual("Custom Move 27",d.value(c)[9],10);assertEqual("Custom Move 27.1",d.value(p)[2],18);assertEqual("Custom Move 27.2",d.value(p)[9],11);setValue(e,"Self.moveTowards([Population].findIndex(1), 1)");setValue(p,"[Population].FindIndex(2).Location().x");d=runModel(!0);assertEqual("Custom Move 26 (Obj)",d.value(c)[2],
10);assertEqual("Custom Move 27 (Obj)",d.value(c)[9],10);assertEqual("Custom Move 27.1 (Obj)",d.value(p)[2],18);assertEqual("Custom Move 27.2 (Obj)",d.value(p)[9],11);setValue(e,"1");setAgentNetwork(n,"Custom Function");setAgentNetworkFunction(n,"ifThenElse(index(a)=1 || index(b)=1, true, false)");setValue(c,"count(connected(findIndex([Population], 1)))");setValue(p,"count(connected(findIndex([Population], 3)))");d=runModel(!0);assertEqual("Custom Network 28",d.value(c)[0],9);assertEqual("Custom Network 29",
d.value(p)[8],1);setValue(c,"count(connectionWeight(findIndex([Population], 1), connected(findIndex([Population], 1))))");setValue(p,"connectionWeight(findIndex([Population], 3), connected(findIndex([Population], 3))){1}");d=runModel(!0);assertEqual("Custom Network 29.1",d.value(c)[0],9);assertEqual("Custom Network 29.2",d.value(p)[8],1);setValue(c,"setConnectionWeight(findIndex([Population], 1), connected(findIndex([Population], 1)), 5)");setValue(p,"connectionWeight(findIndex([Population], 1), connected(findIndex([Population], 1))){1}");
d=runModel(!0);assertEqual("Custom Network 29.3",d.value(c)[0],1);assertEqual("Custom Network 29.4",d.value(p)[8],5);setValue(c,"[Population].findIndex(1).connected().length()");setValue(p,"[Population].findIndex(3).connected().length()");d=runModel(!0);assertEqual("Custom Network 28 (Obj)",d.value(c)[0],9);assertEqual("Custom Network 29 (Obj)",d.value(p)[8],1);setValue(e,"ifthenelse( index(self)==3, unconnect(self, findIndex([population], 1)), 0)");d=runModel(!0);assertEqual("Custom Network 30",
d.value(c)[0],9);assertEqual("Custom Network 31",d.value(p)[0],1);assertEqual("Custom Network 32",d.value(c)[8],8);assertEqual("Custom Network 33",d.value(p)[8],0);setValue(e,"ifthenelse( index(self)==3, self.unconnect([population].findIndex(1)), 0)");d=runModel(!0);assertEqual("Custom Network 30 (Obj)",d.value(c)[0],9);assertEqual("Custom Network 31 (Obj)",d.value(p)[0],1);assertEqual("Custom Network 32 (Obj)",d.value(c)[8],8);assertEqual("Custom Network 33 (Obj)",d.value(p)[8],0);setValue(e,"ifthenelse(index(self)==3, connect(self, findIndex([population], 2)),0)");
d=runModel(!0);assertEqual("Custom Network 34",d.value(c)[0],9);assertEqual("Custom Network 35",d.value(p)[0],1);assertEqual("Custom Network 36",d.value(c)[8],9);assertEqual("Custom Network 37",d.value(p)[8],2);setValue(e,"IfThenElse(self.index()==3, self.connect([population].findIndex(2)),0)");d=runModel(!0);assertEqual("Custom Network 34 (Obj)",d.value(c)[0],9);assertEqual("Custom Network 35 (Obj)",d.value(p)[0],1);assertEqual("Custom Network 36 (Obj)",d.value(c)[8],9);assertEqual("Custom Network 37 (Obj)",
d.value(p)[8],2);setValue(e,"ifthenelse(index(self)==3, connect(self, true),0)");d=runModel(!0);assertUnequal("Custom Network 38",d.error,"none");setValue(e,"ifthenelse(index(self)==3, self.connect(true),0)");d=runModel(!0);assertUnequal("Custom Network 38 (Obj)",d.error,"none");setValue(e,"ifthenelse(index(self)==3, connect(self, 1),0)");d=runModel(!0);assertUnequal("Custom Network 39",d.error,"none");setTriggerType(e,"Condition");setTriggerValue(e,"((index(self)==3 && years>=2) || (index(self)==5 && years>=5))");
setValue(e,"remove(self)");setValue(c,"populationSize([Population])");setValue(p,"count(connected(findIndex([Population], 1)))");d=runModel(!0);assertEqual("Add/Remove 1",d.value(c)[0],10);assertEqual("Add/Remove 2",d.value(c)[4],9);assertEqual("Add/Remove 3",d.value(c)[8],8);setTriggerValue(e,"((self.index()==3 && years==2) || (self.index()==5 && years==5))");setValue(e,"self.remove()");setValue(c,"[Population].populationSize()");setValue(p,"[Population].findIndex(1).connected().length()");d=runModel(!0);
assertEqual("Add/Remove 1 (Obj)",d.value(c)[0],10);assertEqual("Add/Remove 2 (Obj)",d.value(c)[4],9);assertEqual("Add/Remove 3 (Obj)",d.value(c)[8],8);setTriggerValue(e,"((index(self)==3 && years==2) || (index(self)==5 && years==5))");setValue(e,"add([Population])");setValue(c,"populationSize([Population])");setValue(p,"count(connected(findIndex([Population], 3)))");d=runModel(!0);assertEqual("Add/Remove 5",d.value(c)[0],10);assertEqual("Add/Remove 6",d.value(c)[4],11);assertEqual("Add/Remove 7",
d.value(c)[8],12);setValue(e,"[Population].add()");assertEqual("Add/Remove 5 (Obj)",d.value(c)[0],10);assertEqual("Add/Remove 6 (Obj)",d.value(c)[4],11);assertEqual("Add/Remove 7 (Obj)",d.value(c)[8],12);setTriggerValue(e,"((index(self)==3 && years==2) || (index(self)==5 && years==5))");setValue(e,"add([Population], Self)");setValue(c,"populationSize([Population])");d=runModel(!0);assertEqual("Add/Remove 8",d.value(c)[0],10);assertEqual("Add/Remove 9",d.value(c)[4],11);assertEqual("Add/Remove 10",
d.value(c)[8],12);setValue(e,"[Population].add(Self)");assertEqual("Add/Remove 8 (Obj)",d.value(c)[0],10);assertEqual("Add/Remove 9 (Obj)",d.value(c)[4],11);assertEqual("Add/Remove 10 (Obj)",d.value(c)[8],12);setAgentPlacement(n,"Random");setPopulationSize(n,1);setTriggerValue(e,"years == 5 ");setValue(e,"[Population].add()");setValue(c,"populationSize([Population])");setValue(p,"IfThenElse(populationsize([Population])==2, Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), -1)");
d=runModel(!0);assertEqual("Add/Remove 11",d.value(c)[0],1);assertEqual("Add/Remove 12",d.value(c)[8],2);assertEqual("Add/Remove 13",d.value(p)[0],-1);assertEqual("Add/Remove 14",d.value(p)[7],0);setPopulationSize(n,1);setValue(e,"add([Population], Self)");setValue(c,"populationSize([Population])");setValue(p,"ifthenElse(populationsize([Population])==2, Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), -1)");d=runModel(!0);assertEqual("Add/Remove 15",
d.value(c)[0],1);assertEqual("Add/Remove 16",d.value(c)[8],2);assertEqual("Add/Remove 17",d.value(p)[0],-1);assertEqual("Add/Remove 18",d.value(p)[7],1);setPopulationSize(n,0);setParent(e);setTriggerValue(e,"years == 5 or years==3");setValue(e,"add([Population])");setValue(c,"populationSize([Population])");setValue(p,"IfThenElse(populationsize([Population])==2, Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), -1)");d=runModel(!0);assertEqual("Add/Remove 19",
d.value(c)[0],0);assertEqual("Add/Remove 20",d.value(c)[8],2);assertEqual("Add/Remove 21",d.value(p)[0],-1);assertEqual("Add/Remove 22",d.value(p)[7],0);setPopulationSize(n,3);createConnector("Link","Link",n,l);setValue(e,1);setTriggerType(l,"Condition");setTriggerValue(l,"Distance(self, [Population].findIndex(1)) > 1");setTriggerRepeat(l,!1);setTriggerRepeat(m,!1);d=runModel(!0);assertEqual("Init Position With State",d.error,"none");setPopulationSize(n,2);removePrimitive(l);removePrimitive(m);setParent(e);
setValue(b,"false");setTriggerValue(e,"years == 5 ");setValue(e,"SetValue([Population], [State 1], true)");setValue(c,"select(value([Population], [State 1]), 1)");setValue(p,"select(value([Population],[State 1]), 2)");d=runModel(!0);assertEqual("SetValue 1",d.value(c)[3],0);assertEqual("SetValue 2",d.value(c)[8],1);assertEqual("SetValue 3",d.value(p)[3],0);assertEqual("SetValue 4",d.value(p)[8],1);setValue(e,"[Population].SetValue([State 1], true)");setValue(c,"[Population].value([State 1]){1}");
setValue(p,"[Population].value([State 1]){2}");d=runModel(!0);assertEqual("SetValue 1 (Obj)",d.value(c)[3],0);assertEqual("SetValue 2 (Obj)",d.value(c)[8],1);assertEqual("SetValue 3 (Obj)",d.value(p)[3],0);assertEqual("SetValue 4 (Obj)",d.value(p)[8],1);setGeometryWidth(n,"{1 Meter}");d=runModel(!0);assertUnequal("Geo Units 1",d.error,"none");setGeometryWidth(n,"2");setGeometryHeight(n,"{2 Kilometers}");d=runModel(!0);assertUnequal("Geo Units 2",d.error,"none");setGeometryUnits(n,"Meters");d=runModel(!0);
assertEqual("Geo Units 3",d.error,"none");setGeometryWidth(n,"{1 Meter}");d=runModel(!0);assertEqual("Geo Units 4",d.error,"none");setGeometryWidth(n,"{1 Dog}");d=runModel(!0);assertUnequal("Geo Units 5",d.error,"none");clearModel();c=createPrimitive("Var","Variable",[350,350],[200,200]);p=createPrimitive("Var2","Variable",[0,300],[200,100]);f=createPrimitive("Agent","Folder",[300,300],[300,300]);setFolderType(f,"Agent");setParent(c,f);d=createPrimitive("Population","Agents",[0,0],[200,100]);b=createPrimitive("Action",
"Action",[300,0],[200,100]);createConnector("Link","Link",f,d);createConnector("Link","Link",d,c);createConnector("Link","Link",d,p);createConnector("Link","Link",d,b);setAgentBase(d,f);setPopulationSize(d,5);setValue(c,"PopulationSize([Population])");setTriggerType(b,"Condition");setTriggerValue(b,"years=5");setValue(b,"repeat(add([Population]),10)");setValue(p,"Count(unique(Value([Population],[Var])))");d=runModel(!0);assertEqual("Additional Add 1",d.value(p)[0],1);assertEqual("Additional Add 2",
d.value(p)[5],1);assertEqual("Additional Add 3",d.value(p)[6],1);assertEqual("Additional Add 4",d.value(p)[7],1);setValue(b,"repeat([Population].add(),10)");setValue(p,"[Population].Value([Var]).unique().length()");d=runModel(!0);assertEqual("Additional Add 1 (Obj)",d.value(p)[0],1);assertEqual("Additional Add 2 (Obj)",d.value(p)[5],1);assertEqual("Additional Add 3 (Obj)",d.value(p)[6],1);assertEqual("Additional Add 4 (Obj)",d.value(p)[7],1);setValue(p,"max(Value([Population],[Var]))");d=runModel(!0);
assertEqual("Additional Add 5",d.value(p)[0],5);assertEqual("Additional Add 6",d.value(p)[5],5);assertEqual("Additional Add 7",d.value(p)[6],15);assertEqual("Additional Add 8",d.value(p)[7],15);setValue(p,"[Population].value([Var]).max()");d=runModel(!0);assertEqual("Additional Add 5 (Obj)",d.value(p)[0],5);assertEqual("Additional Add 6 (Obj)",d.value(p)[5],5);assertEqual("Additional Add 7 (Obj)",d.value(p)[6],15);assertEqual("Additional Add 8 (Obj)",d.value(p)[7],15);clearModel();c=createPrimitive("Stock1",
"Stock",[350,350],[200,200]);p=createPrimitive("Stock2","Stock",[0,300],[200,100]);f=createPrimitive("Agent","Folder",[300,300],[300,300]);setFolderType(f,"Agent");setParent(c,f);d=createPrimitive("Population","Agents",[0,0],[200,100]);b=createConnector("Flow","Flow",c,p);setAgentBase(d,f);setPopulationSize(d,5);d=runModel(!0);assertUnequal("Cross Boundary Flow 1",d.error,"none");setParent(p,f);setParent(b,f);d=runModel(!0);assertEqual("Cross Boundary Flow 2",d.error,"none");removePrimitive(p);d=
runModel(!0);assertEqual("Cross Boundary Flow 3",d.error,"none");p=createPrimitive("Stock2","Stock",[0,300],[200,100]);setEnds(f,c,p);setParent(b,null);removePrimitive(p);d=runModel(!0);assertUnequal("Cross Boundary Flow 4",d.error,"none");clearModel();test=a}
function testUI(){test="UI";var a=topBarShown();toggleTopBar();assertEqual("Top bar 1",topBarShown(),!a);toggleTopBar();assertEqual("Top bar 2",topBarShown(),a);a=sideBarShown();toggleSideBar();assertEqual("Side bar 1",sideBarShown(),!a);toggleSideBar();assertEqual("Side bar 2",sideBarShown(),a)}
function testMacros(){test="Macros";clearModel();setMacros("a <- 52\nf(x)<-x^2");assertEqual("Get Macros",getMacros(),"a <- 52\nf(x)<-x^2");var a=createPrimitive("p1","Variable",[200,0],[100,100]),b=createPrimitive("p2","Variable",[0,0],[100,100]);setValue(a,"a");setValue(b,"f(2)");var c=runModel(!0);assertEqual("Constant",c.value(a)[3],52);assertEqual("Function",c.value(b)[3],4)}
function testUnitFunctions(){test="Units Functions";clearModel();var a=createPrimitive("p1","Variable",[200,0],[100,100]),b=createPrimitive("p2","Variable",[0,0],[100,100]),c=createPrimitive("p3","Variable",[0,0],[100,100]),d=createPrimitive("p4","Variable",[0,0],[100,100]),e=createPrimitive("p5","Variable",[0,0],[100,100]),f=createPrimitive("p6","Variable",[0,0],[100,100]),g=createPrimitive("p7","Variable",[0,0],[100,100]);setValue(a,"Years");setValue(b,"Months");setValue(c,"Weeks");setValue(d,"Days");
setValue(e,"Hours");setValue(f,"Minutes");setValue(g,"Seconds");var k=runModel(!0);assertEqual("Y",k.value(a)[3],3);assertEqual("Mo",k.value(b)[3],36);assertEqual("W",Math.floor(k.value(c)[3]),156);assertEqual("D",k.value(d)[3],1095);assertEqual("H",k.value(e)[3],26280);assertEqual("Mi",k.value(f)[3],1576800);assertEqual("S",k.value(g)[3],94608E3);setValue(a,"Years(time*2)");setValue(b,"Months(time*2)");setValue(c,"Weeks(time*2)");setValue(d,"Days(time*2)");setValue(e,"Hours(time*2)");setValue(f,
"Minutes(time*2)");setValue(g,"Seconds(time*2)");k=runModel(!0);assertEqual("Y",k.value(a)[3],6);assertEqual("Mo",k.value(b)[3],72);assertEqual("W",Math.floor(k.value(c)[3]),312);assertEqual("D",k.value(d)[3],2190);assertEqual("H",k.value(e)[3],52560);assertEqual("Mi",k.value(f)[3],3153600);assertEqual("S",k.value(g)[3],189216E3);setValue(a,"unitless(TimeStart)");setValue(b,"unitless(TimeLength)");setValue(c,"unitless(TimeStep)");setValue(d,"unitless(TimeEnd)");k=runModel(!0);assertEqual("Time Start",
k.value(a)[3],getTimeStart());assertEqual("Time Length",k.value(b)[3],getTimeLength());assertEqual("Time Step",k.value(c)[3],getTimeStep());assertEqual("Time End",k.value(d)[3],getTimeStart()+getTimeLength())}
function testUnitsAndConstraints(){test="Units and Constraints";clearModel();var a=createPrimitive("tester","Variable",[0,0],[100,10]);setValue(a,"time");setUnits(a,"Seconds");assertEqual("No error",runModel(!0).error,"none");setUnits(a,"Qubits");assertUnequal("Units Error",runModel(!0).error,"none");setUnits(a,"Minutes");assertEqual("No error Units",runModel(!0).error,"none");setConstraints(a,[10,!0,5,!1]);assertUnequal("Constraints Error",runModel(!0).error,"none");setConstraints(a,[10,!1,5,!1]);
assertEqual("Constraints Error",runModel(!0).error,"none");setConstraints(a,[10,!1,5,!0]);assertUnequal("Constraints Error",runModel(!0).error,"none");setConstraints(a,[10,!1,5,!1]);assertEqual("Constraints Error",runModel(!0).error,"none")}
function testPrimitiveGetSet(){test="Primitive Get Set";setupComplexDummy();var a=findName("x");setName(a,"xyz");assertEqual("Name",getName(a),"xyz");setNote(a,"abc");assertEqual("Note",getNote(a),"abc");setValue(a,"123");assertEqual("SetValue",getValue(a),"123");setValue(findName("My Flow"),"098");assertEqual("SetValue",getValue(findName("My Flow")),"098");setUnits(findName("My Flow"),"Qubits");assertEqual("SetUnits",getUnits(findName("My Flow")),"Qubits");setShowSlider(a,!0);assertEqual("ShowSlider 1",
getShowSlider(a),!0);setShowSlider(a,!1);assertEqual("ShowSlider 2",getShowSlider(a),!1);setSliderMax(a,72);assertEqual("SliderMax",getSliderMax(a),72);setSliderMin(a,12);assertEqual("SliderMin",getSliderMin(a),12);setSliderStep(a,15);assertEqual("SliderStep",getSliderStep(a),15);graph instanceof SimpleNode||(setFillColor(a,"green"),assertEqual("Fill Color",getFillColor(a),"green"),setFontColor(a,"red"),assertEqual("Font Color",getFontColor(a),"red"),setLineColor(a,"yellow"),assertEqual("Line Color",
getLineColor(a),"yellow"),setOpacity(a,50),assertEqual("Opacity",getOpacity(a),50),setImage(a,"http://testimage.com/image.png"),assertEqual("Image",getImage(a),"http://testimage.com/image.png"));a=findName("My Flow");setConstraints(a,[-10,!0,10,!1]);assertEqual("SetConstraints",getConstraints(a)[0],-10);assertEqual("SetConstraints",getConstraints(a)[1],!0);assertEqual("SetConstraints",getConstraints(a)[2],10);assertEqual("SetConstraints",getConstraints(a)[3],!1);setConstraints(findName("My Flow"),
[-10,!1,10,!0]);assertEqual("SetConstraints",getConstraints(a)[1],!1);assertEqual("SetConstraints",getConstraints(a)[3],!0);setNonNegative(a,!0);assertEqual("Set Non Negative Flow",getNonNegative(a),!0);setNonNegative(a,!1);assertEqual("Set Non Negative Flow",getNonNegative(a),!1);a=findName("My Stock");setNonNegative(a,!0);assertEqual("Set Non Negative Stock",getNonNegative(a),!0);setNonNegative(a,!1);assertEqual("Set Non Negative Stock",getNonNegative(a),!1);setDelay(a,5);assertEqual("Set Delay",
getDelay(a),5);setStockType(a,"Conveyor");assertEqual("Set Type",getStockType(a),"Conveyor");setStockType(a,"Store");assertEqual("Set Type",getStockType(a),"Store");var b=findName("My Converter");setData(b,"fdsgsdg");assertEqual("Set Data",getData(b),"fdsgsdg");setConverterInput(b,a);assertEqual("Set Source",getConverterInput(b).id,a.id);setConverterInput(b,null);assertNull("Set Source 2",getConverterInput(b));setInterpolation(b,"fdsf");assertEqual("Set Interpolation",getInterpolation(b),"fdsf");
a=createPrimitive("My State","State",[100,60],[100,100]);setValue(a,"abc");assertEqual("State Set Value",getValue(a),"abc");assertEqual("State Get Residency",getResidency(a),"0");setResidency(a,"xyz");assertEqual("State Set Residency",getResidency(a),"xyz");a=createConnector("My Transition","Transition",a,null);setValue(a,"abc1");assertEqual("Transition Set Value",getValue(a),"abc1");setTriggerValue(a,"abc12");assertEqual("Transition Set Value 2",getTriggerValue(a),"abc12");assertEqual("Transition Get Trigger 1",
getTriggerType(a),"Timeout");setTriggerType(a,"Condition");assertEqual("Transition Get Trigger 2",getTriggerType(a),"Condition");assertEqual("Transition Get Trigger Repeat 1",getTriggerRepeat(a),!1);setTriggerRepeat(a,!0);assertEqual("Transition Get Trigger Repeat 2",getTriggerRepeat(a),!0);assertEqual("Transition Get Trigger Recalculate 1",getTriggerRecalculate(a),!1);setTriggerRecalculate(a,!0);assertEqual("Transition Get Trigger Recalculate 2",getTriggerRecalculate(a),!0);a=createPrimitive("My Action",
"Action",[100,60],[100,100]);setValue(a,"abc1");assertEqual("Action Set Value",getValue(a),"abc1");setTriggerValue(a,"abc123");assertEqual("Action Set Value 2",getTriggerValue(a),"abc123");assertEqual("Action Set Value 3",getValue(a),"abc1");assertEqual("Action Get Trigger 1",getTriggerType(a),"Probability");setTriggerType(a,"Timeout");assertEqual("Action Get Trigger 2",getTriggerType(a),"Timeout");assertEqual("Action Get Trigger Repeat 1",getTriggerRepeat(a),!0);setTriggerRepeat(a,!1);assertEqual("Action Get Trigger Repeat 2",
getTriggerRepeat(a),!1);assertEqual("Action Get Trigger Recalculate 1",getTriggerRecalculate(a),!1);setTriggerRecalculate(a,!0);assertEqual("Action Get Trigger Recalculate 2",getTriggerRecalculate(a),!0);b=createPrimitive("My Agents","Agents",[300,300],[200,100]);setPopulationSize(b,123);assertEqual("Agents Size",getPopulationSize(b),123);setGeometryUnits(b,"foo bar");assertEqual("Agents Units",getGeometryUnits(b),"foo bar");setGeometryHeight(b,"foo bar 1");assertEqual("Agents Height",getGeometryHeight(b),
"foo bar 1");setGeometryWidth(b,"foo bar 2");assertEqual("Agents Width",getGeometryWidth(b),"foo bar 2");setAgentPlacement(b,"foo bar 3");assertEqual("Agents Placement",getAgentPlacement(b),"foo bar 3");setAgentPlacementFunction(b,"foo bar 4");assertEqual("Agents Placement Function",getAgentPlacementFunction(b),"foo bar 4");setAgentNetwork(b,"foo bar 5");assertEqual("Agents Network",getAgentNetwork(b),"foo bar 5");setAgentNetworkFunction(b,"foo bar 6");assertEqual("Agents Network Function",getAgentNetworkFunction(b),
"foo bar 6");setGeometryWrap(b,!0);assertEqual("Agents Wrap 1",getGeometryWrap(b),!0);setGeometryWrap(b,!1);assertEqual("Agents Wrap 2",getGeometryWrap(b),!1);a=createPrimitive("f","Folder",[200,150],[150,100]);createConnector("Link","Link",a,b);setAgentBase(b,a);assertEqual("Agents Base",getAgentBase(b).id,a.id);setFolderSolver(a,{a:1});assertEqual("Folder Solver",getFolderSolver(a).a,1)}
function testSimulationGetSet(){test="Simulation Get Set";setAlgorithm("x");assertEqual("Algorithm",getAlgorithm(),"x");setTimeStep(72);assertEqual("Time Step",getTimeStep(),72);setTimeLength(43);assertEqual("Time Length",getTimeLength(),43);setTimeStart(32);assertEqual("Time Start",getTimeStart(),32);setPauseInterval(2);assertEqual("Pause Interval",getPauseInterval(),2);setTimeUnits("foo");assertEqual("Time Units",getTimeUnits(),"foo")}
function testSimulation(){test="Simulation Test";setTimeUnits("Years");setTimeStep(1);setTimeStart(0);setTimeLength(10);for(var a=["RK1","RK4"],b=0;b<a.length;b++){console.log("--- Using Algorithm: "+a[b]);setAlgorithm(a[b]);setTimeLength(10);clearModel();var c=createPrimitive("My Stock","Stock",[10,10],[140,50]),d=createConnector("My Flow","Flow",c,null);setValue(c,"100");setValue(d,"0.1*[Alpha]");var e=runModel(!0);assertEqual("Length",e.Time.length,11);assertEqual("Time Start",e.Time[0],0);assertEqual("Time End",
e.Time[10],10);assertEqual("Stock Start",e.value(c)[0],100);clearModel();clearModel();setTimeStep(0.1);setTimeLength(2);var d=createPrimitive("Y","Stock",[10,10],[140,50]),f=createConnector("My Flow","Flow",null,d);setValue(d,"100");setValue(f,"0.04*[Y]");e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica ExpGrow Small Time",Math.round(1E5*e.value(d)[20]),Math.round(1.0831142163E7)):"RK4"==a[b]&&assertEqual("Mathematica ExpGrow Small Time",Math.round(1E5*e.value(d)[20]),Math.round(1.08328706767E7));
setTimeStart(0.12);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica ExpGrow Start Time",Math.round(1E5*e.value(d)[20]),Math.round(1.0831142163E7)):"RK4"==a[b]&&assertEqual("Mathematica ExpGrow Start Time",Math.round(1E5*e.value(d)[20]),Math.round(1.08328706767E7));assertEqual("Mathematica ExpGrow Start Time 2",e.times[0],0.12);assertEqual("Mathematica ExpGrow Start Time 3",e.times[1],0.22);setTimeStart(0);setTimeLength(100);setTimeStep(1);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica ExpGrow",
Math.round(1E5*e.value(d)[100]),Math.round(5.05049481843E8)):"RK4"==a[b]&&assertEqual("Mathematica ExpGrow",Math.round(1E5*e.value(d)[100]),Math.round(5.45981455268E8));setValue(f,"0.02*[Y]*(1-[Y]/100)*Sin(Years/3)^2");setValue(d,2);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica LogGrow",Math.round(1E5*e.value(d)[100]),Math.round(522332.33648999996)):"RK4"==a[b]&&assertEqual("Mathematica LogGrow",Math.round(1E5*e.value(d)[100]),Math.round(530387.612074));setValue(f,"0.02*[Y]*(1-[Y]/100)*Sin({Years/3 Radians})^2");
setValue(d,2);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica LogGrow 2",Math.round(1E5*e.value(d)[100]),Math.round(522332.33648999996)):"RK4"==a[b]&&assertEqual("Mathematica LogGrow 2",Math.round(1E5*e.value(d)[100]),Math.round(530387.612074));var g=createPrimitive("X","Stock",[10,10],[140,50]),k=createConnector("My Flow","Flow",null,g),l=createConnector("My Flow","Flow",g,null),m=createConnector("My Flow","Flow",d,null);createConnector("Link","Link",g,f);createConnector("Link","Link",d,l);setValue(f,
"[Y]*0.001*[X]");setValue(m,"[Y]*0.1");setValue(k,"[X]*0.1");setValue(l,"[X]*0.0001*[Y]");setValue(g,200);setValue(d,100);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica LV",Math.round(1E5*e.value(d)[100]),Math.round(1525172.07902)):"RK4"==a[b]&&assertEqual("Mathematica LV",Math.round(1E5*e.value(d)[100]),Math.round(4.1183764750399995E8));setTimeLength(10);clearModel();g=createPrimitive("X","Stock",[10,10],[140,50]);d=createPrimitive("V","Variable",[10,10],[140,50]);k=createConnector("Flow","Flow",
null,g);createConnector("Link","Link",k,d);setValue(k,"[X]*0.1");setValue(g,200);setValue(d,"[Flow]");e=runModel(!0);"RK1"==a[b]?(assertEqual("Flow Time Correct 1",Math.round(1E5*e.value(k)[0]),Math.round(2E6)),assertEqual("Flow Time Correct 2",Math.round(1E5*e.value(d)[0]),Math.round(2E6))):"RK4"==a[b]&&(assertEqual("Flow Time Correct 1",Math.round(1E5*e.value(k)[0]),Math.round(2103416.666)),assertEqual("Flow Time Correct 2",Math.round(1E5*e.value(d)[0]),Math.round(2103416.666)));clearModel();k=
createPrimitive("p","Variable",[0,0],[100,100]);setValue(k,"years");e=runModel(!0);assertEqual("Generic Units 1",e.value(k)[4],4);setValue(k,"months");e=runModel(!0);assertEqual("Generic Units 2",e.value(k)[4],48);clearModel();setTimeLength(100);"RK1"==a[b]&&(k=createPrimitive("My Variable","Variable",[100,100],[140,50]),d=createConnector("My Flow","Flow",null,null),createConnector("link","Link",d,k),setUnits(d,"euros/seconds"),setUnits(k,"euros"),setValue(d,"years*{1 euros/seconds}"),setValue(k,
"[My Flow]*{1 seconds}"),e=runModel(!0),assertEqual("More Flow Scaling 1",e.value(k)[20],20),setUnits(d,"euros/years"),e=runModel(!0),assertEqual("More Flow Scaling 2",e.value(k)[20],20),setUnits(d,"euros per years"),e=runModel(!0),assertEqual("More Flow Scaling 2",e.value(k)[20],20),setValue(d,"years"),setUnits(k,"euros/years"),setValue(k,"[My Flow]"),e=runModel(!0),assertEqual("More Flow Scaling 3",e.value(k)[20],20),clearModel(),k=createPrimitive("My Variable","Variable",[100,100],[140,50]),d=
createConnector("My Flow","Flow",null,null),createConnector("link","Link",d,k),setUnits(d,""),setUnits(k,""),setNonNegative(d,!1),setValue(d,"10-years"),setValue(k,"[My Flow]"),e=runModel(!0),assertEqual("PositiveOnly with Units",e.value(k)[20],-10),clearModel());testAgents();clearModel();testSubscripting();clearModel();k=createPrimitive("My Variable","Variable",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,null);createConnector("link","Link",d,k);setUnits(d,"euros/seconds");setUnits(k,
"euros/seconds");setValue(d,"10-years");setValue(k,"[My Flow]");e=runModel(!0);assertEqual("PositiveOnly with Units",e.value(k)[20],0);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);setUnits(d,"euros/year");setUnits(c,"euros");setValue(d,"10");setValue(c,"1");e=runModel(!0);assertEqual("Unit Flows 1",e.value(c)[10],101);setValue(d,"{10 Euros/years}");setValue(c,"{1 Euros}");e=runModel(!0);assertEqual("Unit Flows 2",e.value(c)[10],101);
clearModel();k=createPrimitive("My Variable","Variable",[100,100],[140,50]);setValue(k,"Fix(years+12)");e=runModel(!0);assertEqual("Fix 1",e.value(k)[15],12);setValue(k,"Fix(years+12, 5)");e=runModel(!0);assertEqual("Fix 2",e.value(k)[14],22);setValue(k,"Fix(years+13, {5 years})");e=runModel(!0);assertEqual("Fix 3",e.value(k)[14],23);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);k=createPrimitive("My Variable","Variable",[100,100],
[140,50]);createConnector("My Link","Link",c,k);setValue(d,"1");setValue(c,"0");setStockType(c,"Conveyor");setDelay(c,5);setValue(k,"[[My Stock]]");e=runModel(!0);assertEqual("Conveyor 1",e.value(c)[2],0);assertEqual("Conveyor 2",e.value(c)[4],0);assertEqual("Conveyor 3",e.value(c)[12],8);assertEqual("Conveyor 4",e.value(k)[2],2);assertEqual("Conveyor 5",e.value(k)[12],12);setDelay(c,"{5 years}");e=runModel(!0);assertEqual("Conveyor Units 1",e.value(c)[2],0);assertEqual("Conveyor Units 2",e.value(c)[4],
0);assertEqual("Conveyor Units 3",e.value(c)[12],8);assertEqual("Conveyor Units 4",e.value(k)[2],2);assertEqual("Conveyor Units 5",e.value(k)[12],12);setDelay(c,"{365 days}*5");e=runModel(!0);assertEqual("Conveyor Units 6",e.value(c)[2],0);assertEqual("Conveyor Units 7",e.value(c)[4],0);assertEqual("Conveyor Units 8",e.value(c)[12],8);assertEqual("Conveyor Units 9",e.value(k)[2],2);assertEqual("Conveyor Units 10",e.value(k)[12],12);setValue(k,"[[My Stock]]-[My Stock]");g=createConnector("Outflow",
"Flow",c,null);setValue(g,"[Alpha]");setValue(d,"2");e=runModel(!0);assertEqual("FSF 1",Math.round(1E3*e.lastValue(c)),2E3);assertEqual("FSF 2",e.lastValue(k),8);assertEqual("FSF 3",e.value(k)[3],6);assertEqual("FSF 4",Math.round(1E3*e.lastValue(g)),2E3);assertEqual("FSF 5",e.value(g)[3],0);assertEqual("FSF 6",e.lastValue(d),2);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);g=createConnector("My Flow","Flow",c,null);k=createPrimitive("My Variable",
"Variable",[100,100],[140,50]);createConnector("My Link","Link",c,k);setValue(d,"10");setValue(c,"50");setValue(g,"[My Stock]");setStockType(c,"Conveyor");setDelay(c,5);setValue(k,"[[My Stock]]");e=runModel(!0);assertEqual("Conveyor 11",e.value(k)[0],50);assertEqual("Conveyor 12",e.value(k)[1],50);assertEqual("Conveyor 13",e.value(k)[2],50);assertEqual("Conveyor 14",e.value(k)[12],50);assertEqual("Conveyor 15",e.value(c)[0],10);assertEqual("Conveyor 16",e.value(c)[1],10);assertEqual("Conveyor 17",
e.value(c)[2],10);assertEqual("Conveyor 18",e.value(c)[5],10);assertEqual("Conveyor 19",e.value(c)[12],10);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);k=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",c,k);setValue(d,"1");setValue(c,"0");setValue(k,"0");e=runModel(!0);assertEqual("Same Name 1",e.value(c)[5],-5);assertEqual("Same Name 2",e.value(k)[5],5);assertEqual("Same Name 3",e.value(c)[10],-10);assertEqual("Same Name 4",e.value(k)[10],
10);clearModel();k=createPrimitive("My Variable","Variable",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,null);createConnector("link","Link",d,k);setValue(d,10);setValue(k,"[My Flow]");e=runModel(!0);assertEqual("Flow Value Default",e.value(k)[20],10);clearModel();var d=createPrimitive("Stock 1","Stock",[100,100],[140,50]),k=createPrimitive("Stock 2","Stock",[100,100],[140,50]),f=createPrimitive("Stock 3","Stock",[100,100],[140,50]),l=createPrimitive("Stock 4","Stock",[100,100],[140,
50]),m=createPrimitive("Stock 5","Stock",[100,100],[140,50]),n=createConnector("Flow 1","Flow",null,d),g=createConnector("Flow 2","Flow",null,k),p=createConnector("Flow 3","Flow",null,f),q=createConnector("Flow 4","Flow",null,l),u=createConnector("Flow 5","Flow",null,m);setValue(n,1);setUnits(g,"unitless");setValue(g,7);setUnits(g,"1/years");setValue(p,3);setUnits(p,"dollars/years");setUnits(f,"dollars");setValue(q,"{200 centimeters/year}");setUnits(q,"meters/years");setUnits(l,"centimeters");setValue(u,
5);setUnits(u,"1/days");e=runModel(!0);assertEqual("Flow Value 1",Math.round(1E3*e.value(n)[20]),1E3);assertEqual("Flow Value 2",Math.round(1E3*e.value(g)[20]),7E3);assertEqual("Flow Value 3",Math.round(1E3*e.value(p)[20]),3E3);assertEqual("Flow Value 4",Math.round(1E3*e.value(q)[20]),2E3);assertEqual("Flow Value 5",Math.round(1E3*e.value(u)[20]),5E3);assertEqual("Flow Stock Value 1",e.value(d)[2],2);assertEqual("Flow Stock Value 2",Math.round(e.value(k)[2]),14);assertEqual("Flow Stock Value 3",e.value(f)[2],
6);assertEqual("Flow Stock Value 4",e.value(l)[2],400);assertEqual("Flow Stock Value 5",Math.round(e.value(m)[2]),3650);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);k=createPrimitive("My Stock 2","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",c,k);setValue(c,10);setValue(k,0);setValue(d,1);e=runModel(!0);assertEqual("Non Negative Stock 1",e.value(c)[20],-10);assertEqual("Non Negative Stock 2",e.value(k)[20],20);setNonNegative(c,!0);e=runModel(!0);assertEqual("Non Negative Stock 3",
e.value(c)[20],0);assertEqual("Non Negative Stock 4",e.value(k)[20],10);clearModel();var c=createPrimitive("My Stock","Stock",[100,100],[140,50]),v=createConnector("Outflow","Flow",c,null),y=createConnector("Inflow","Flow",null,c);setNonNegative(c,!0);g=function(a){setValue(c,50);setValue(v,110);setValue(y,100);e=runModel(!0);assertEqual("Non Negative Stock "+(a+1),e.value(c)[2],30);assertEqual("Non Negative Stock "+(a+2),e.value(c)[10],0);setValue(c,"{a:50, b:30}");setValue(v,"{a:-10, b:110}");setValue(y,
"{a:-10, b:100}");e=runModel(!0);assertEqual("Non Negative Stock "+(a+3),e.value(c)[2].a,50);assertEqual("Non Negative Stock "+(a+4),e.value(c)[10].a,50);assertEqual("Non Negative Stock "+(a+5),e.value(c)[2].b,10);assertEqual("Non Negative Stock "+(a+6),e.value(c)[10].b,0);clearModel()};g(4);c=createPrimitive("My Stock","Stock",[100,100],[140,50]);y=createConnector("Inflow","Flow",null,c);v=createConnector("Outflow","Flow",c,null);setNonNegative(c,!0);g(10);c=createPrimitive("My Stock","Stock",[100,
100],[140,50]);setValue(c,"years+10");e=runModel(!0);assertEqual("Stock Function Value 1",e.value(c)[20],10);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);setValue(c,10);setValue(d,"years-10");setNonNegative(d,!1);e=runModel(!0);"RK1"==a[b]&&(assertEqual("Non Negative Flow 1 - stock",e.value(c)[1],0),assertEqual("Non Negative Flow 2",Math.round(1E3*e.value(d)[0]),-1E4));setNonNegative(d,!0);e=runModel(!0);assertEqual("Non Negative Flow 3 -stock",
e.value(c)[2],10);assertEqual("Non Negative Flow 4",e.value(d)[1],0);clearModel();g=createPrimitive("my converter","Converter",[0,0],[100,40]);setData(g,"1,1.1;1.5,4;2,4;3,9;4,16;100,200");k=createPrimitive("Param","Variable",[0,0],[100,40]);createConnector("link","Link",k,g);setValue(k,"years+40");setConverterInput(g,k);e=runModel(!0);assertEqual("Primitive Input Value",200,e.value(g)[60]);setConverterInput(g,null);e=runModel(!0);assertEqual("Time Input Value",1.1,e.value(g)[1]);setData(g,"0,2;20,4");
e=runModel(!0);assertEqual("Interpolation",e.value(g)[10],3);setInterpolation(g,"Discrete");e=runModel(!0);assertEqual("No Interpolation",e.value(g)[10],2);setInterpolation(g,"Linear");e=runModel(!0);assertEqual("Interpolation 2",e.value(g)[10],3);createConnector("link","Link",g,k);setValue(k,"[my converter]+[my converter]");e=runModel(!0);assertEqual("Converter Addition",e.value(k)[10],6);assertEqual("Converter Addition",e.value(k)[20],8);assertEqual("Converter Addition",e.value(k)[21],8);setUnits(k,
"Years");setUnits(g,"Years");e=runModel(!0);assertEqual("Converter Addition",e.value(k)[10],6);assertEqual("Converter Addition",e.value(k)[20],8);assertEqual("Converter Addition",e.value(k)[21],8);clearModel();k=createPrimitive("My Stock 1","Stock",[0,0],[100,100]);g=createPrimitive("My Stock 2","Stock",[0,0],[100,100]);createConnector("Link","Link",k,g);setValue(k,"10");setValue(g,"[My Stock 1]");e=runModel(!0);assertEqual("Stock Init 1",e.value(k)[0],10);assertEqual("Stock Init 2",e.value(g)[0],
10);createConnector("Link","Link",g,k);setValue(k,"[My Stock 2]");setValue(g,"20");e=runModel(!0);assertEqual("Stock Init 3",e.value(k)[0],20);assertEqual("Stock Init 4",e.value(g)[0],20);clearModel();k=createPrimitive("My Variable 1","Variable",[0,0],[100,100]);g=createPrimitive("My Variable 2","Variable",[0,0],[100,100]);createConnector("Link","Link",k,g);setValue(k,"10");setUnits(g,"Rabbits");setValue(g,"[My Variable 1]");e=runModel(!0);assertEqual("Unit Conversion Vars 1",e.value(k)[3],10);assertEqual("Unit Conversion Vars 2",
e.value(g)[3],10);clearModel();k=createPrimitive("My Variable 1","Variable",[0,0],[100,100]);g=createPrimitive("My Variable 2","Variable",[0,0],[100,100]);d=createPrimitive("My Variable 3","Variable",[0,0],[100,100]);createConnector("Link","Link",k,g);createConnector("Link","Link",g,d);setValue(k,"{a: 1.2, b:3.2}");setValue(g,"round([My Variable 1])");setValue(d,"[My Variable 2].b");e=runModel(!0);assertEqual("Recurse Function",e.value(d)[3],3);clearModel();k=createPrimitive("My Param","Variable",
[0,0],[100,100]);g=createPrimitive("Derived","Variable",[0,0],[100,100]);createConnector("Link","Link",k,g);setValue(k,"Years");setValue(g,"[My Param] + Years");d=createPrimitive("Folder","Folder",[0,0],[100,100]);setParent(k,d);setFrozen(d,!1);e=runModel(!0);assertEqual("Frozen 1",e.value(k)[3],3);assertEqual("Frozen 2",e.value(g)[3],6);setFrozen(d,!0);e=runModel(!0);assertEqual("Frozen 3",e.value(k)[3],0);assertEqual("Frozen 4",e.value(g)[3],3);clearModel();k=createPrimitive("My Param","Variable",
[0,0],[100,100]);g=createPrimitive("Delayed","Variable",[0,0],[100,100]);createConnector("Link","Link",k,g);setValue(k,"Years");setValue(g,"Delay([My Param], 5, -3)");e=runModel(!0);assertEqual("Initial Value",e.value(g)[3],-3);assertEqual("End Delay",e.value(k)[e.periods-6],e.lastValue(g));setValue(g,"Delay([My Param], 0)");e=runModel(!0);assertEqual("0 Delay",e.value(g)[3],e.value(k)[3]);setValue(k,"Years");setValue(g,"Delay([My Param], 5, -3)");e=runModel(!0);assertEqual("[ Initial Value",e.value(g)[3],
-3);assertEqual("[ End Delay",e.value(k)[e.periods-6],e.lastValue(g));setValue(g,"Delay([My Param], 0)");e=runModel(!0);assertEqual("[ 0 Delay",e.value(g)[3],e.value(k)[3]);clearModel();k=createPrimitive("My Param","Variable",[0,0],[100,100]);setValue(k,"Pulse(10,2,5)");e=runModel(!0);assertEqual("Pulse 1",e.value(k)[5],0);assertEqual("Pulse 2",e.value(k)[12],2);assertEqual("Pulse 3",e.value(k)[16],0);setValue(k,"Pulse(20,.5,2,10)");e=runModel(!0);assertEqual("Pulse 4",e.value(k)[28],0);assertEqual("Pulse 5",
e.value(k)[20],0.5);assertEqual("Pulse 6",e.value(k)[30],0.5);setValue(k,"IfThenElse(Years<20 and Years >= 10, 1, 0)");e=runModel(!0);assertEqual("IfThenElse 1",e.value(k)[5],0);assertEqual("IfThenElse 2",e.value(k)[11],1);g=createPrimitive("a","Variable",[0,0],[100,100]);createConnector("Link","Link",g,k);setValue(g,"2");d=createPrimitive("b","Variable",[0,0],[100,100]);setValue(d,"1");createConnector("Link","Link",d,k);setValue(k,"IfThenElse([a]=2,([b]+1)*[a],[a])");e=runModel(!0);assertEqual("IfThenElse 3",
e.value(k)[5],4);assertEqual("IfThenElse 4",e.value(k)[11],4);setValue(k,"IfThenElse([a]=2,[b],[a])");e=runModel(!0);assertEqual("IfThenElse 5",e.value(k)[5],1);assertEqual("IfThenElse 6",e.value(k)[11],1);setValue(g,"{a: {1,2,3}, b: {4,5,6}}");setValue(k,"[a].b{2}");e=runModel(!0);assertEqual("Comp Vector 1",e.value(k)[12],5);setValue(k,"Ramp(10, 15, 10)");e=runModel(!0);assertEqual("Ramp 1",e.value(k)[5],0);assertEqual("Ramp 2",e.value(k)[12],4);assertEqual("Ramp 3",e.value(k)[16],10);e=runModel(!0);
assertEqual("Stochastic 1",e.stochastic,!1);setValue(k,"Ramp(10, 15, 10)*rand()");e=runModel(!0);assertEqual("Stochastic 2",e.stochastic,!0);setValue(k,"Ramp(10, 15, 10)");e=runModel(!0);assertEqual("Stochastic 3",e.stochastic,!1);setValue(k,"Step(10,3)");e=runModel(!0);assertEqual("Step 1",e.value(k)[5],0);assertEqual("Step 2",e.value(k)[12],3);assertEqual("Step 3",e.value(k)[16],3);setValue(k,"Step({a: 10, b:20, c:7}, {a:1, b:20, c:14}).c");e=runModel(!0);assertEqual("Step Vec 1",e.value(k)[5],
0);assertEqual("Step Vec 2",e.value(k)[12],14);assertEqual("Step Vec 3",e.value(k)[16],14);setValue(k,"Step(7, {a:1, b:20, c:12}).c");e=runModel(!0);assertEqual("Step Vec 4",e.value(k)[5],0);assertEqual("Step Vcc 5",e.value(k)[12],12);assertEqual("Step Vec 6",e.value(k)[16],12);setValue(k,"Step(7, {1, 20, 14}).c");e=runModel(!0);assertUnequal("Step Vec 7",e.error,"none");setValue(k,"Step({a: 10, b:20, c:5}, {a:1, b:20, d:14}).b");e=runModel(!0);assertUnequal("Step Vec 8",e.error,"none");setUnits(k,
"cows");setValue(k,"{1 cows} + Pulse(10,{2 cows},5)");e=runModel(!0);assertEqual("Pulse Units 1",e.value(k)[5],1);assertEqual("Pulse Units 2",e.value(k)[12],3);assertEqual("Pulse Units 3",e.value(k)[16],1);setValue(k,"{1 cows} + Pulse(20,{.5 cows},2,10)");e=runModel(!0);assertEqual("Pulse Units 4",e.value(k)[28],1);assertEqual("Pulse Units 5",e.value(k)[20],1.5);assertEqual("Pulse Units 6",e.value(k)[30],1.5);setValue(k,"{1 cows} + Ramp(10, 15, {10 cows})");e=runModel(!0);assertEqual("Ramp Units 1",
e.value(k)[5],1);assertEqual("Ramp Units 2",e.value(k)[12],5);assertEqual("Ramp Units 3",e.value(k)[16],11);setValue(k,"{1 cows} + Step(10, {3 cows})");e=runModel(!0);assertEqual("Step Units 1",e.value(k)[5],1);assertEqual("Step Units 2",e.value(k)[12],4);assertEqual("Step Units 3",e.value(k)[16],4);clearModel();k=createPrimitive("x","Variable",[0,0],[100,100]);g=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("Link","Link",k,g);setValue(k,"(Years-60)^2");setValue(g,"PastMean([x])");
e=runModel(!0);assertEqual("Mean",e.lastValue(g),950);setValue(g,"[x].PastMean()");e=runModel(!0);assertEqual("Mean (Obj)",e.lastValue(g),950);setValue(g,"PastMedian([x])");e=runModel(!0);assertEqual("Median",Math.round(e.lastValue(g)),625);setValue(g,"[x].PastMedian()");e=runModel(!0);assertEqual("Median (Obj)",Math.round(e.lastValue(g)),625);setValue(g,"Median(PastValues([x]))");e=runModel(!0);assertEqual("Median 2",Math.round(e.lastValue(g)),625);setValue(g,"[x].PastValues().Median()");e=runModel(!0);
assertEqual("Median 2 (Obj)",Math.round(e.lastValue(g)),625);setValue(g,"PastStdDev([x])");e=runModel(!0);assertEqual("StdDev",Math.round(10*e.lastValue(g)),Math.round(9628));setValue(g,"[x].PastStdDev()");e=runModel(!0);assertEqual("StdDev (Obj)",Math.round(10*e.lastValue(g)),Math.round(9628));setValue(g,"PastMax([x])");e=runModel(!0);assertEqual("Max",Math.round(e.lastValue(g)),3600);setValue(g,"[x].PastMax()");e=runModel(!0);assertEqual("Max (Obj)",Math.round(e.lastValue(g)),3600);setValue(g,"PastMin([x])");
e=runModel(!0);assertEqual("Min",e.lastValue(g),0);setValue(g,"[x].PastMin()");e=runModel(!0);assertEqual("Min (Obj)",e.lastValue(g),0);setValue(k,"(Years-60)^2");setValue(g,"Mean(1,2,3)");e=runModel(!0);assertEqual("Mean",e.lastValue(g),2);setValue(g,"Median(1,2,4)");e=runModel(!0);assertEqual("Median",Math.round(e.lastValue(g)),2);setValue(g,"Max(1,5,7,6)");e=runModel(!0);assertEqual("Max",Math.round(e.lastValue(g)),7);setValue(g,"Min(1,0,7,6)");e=runModel(!0);assertEqual("Min",e.lastValue(g),0);
clearModel();k=createPrimitive("My Param","Variable",[0,0],[100,100]);g=createPrimitive("Smoothed","Variable",[0,0],[100,100]);createConnector("Link","Link",k,g);setValue(k,"StairCase(40, 3)");setValue(g,"Smooth([My Param],20, 5)");e=runModel(!0);assertEqual("Smooth 1",e.value(g)[0],5);assertEqual("Smooth 2",Math.round(1E3*e.value(g)[40]),Math.round(0.64256*1E3));assertEqual("Smooth 3",Math.round(1E3*e.value(g)[59]),Math.round(2.110412*1E3));setValue(g,"[My Param].Smooth(20, 5)");e=runModel(!0);assertEqual("Smooth 1 (Obj)",
e.value(g)[0],5);assertEqual("Smooth 2 (Obj)",Math.round(1E3*e.value(g)[40]),Math.round(0.64256*1E3));assertEqual("Smooth 3 (obj)",Math.round(1E3*e.value(g)[59]),Math.round(2.110412*1E3));setValue(k,"years");setValue(g,"Smooth([My Param], 20, 5)");e=runModel(!0);assertEqual("Smooth 4",e.value(g)[0],5);assertEqual("Smooth 5",e.value(g)[1],4.75);assertEqual("Smooth 6",Math.round(1E3*e.value(g)[10]),Math.round(4968.42));setValue(g,"Smooth([My Param], 20)");e=runModel(!0);assertEqual("Smooth 4",e.value(g)[0],
0);assertEqual("Smooth 5",e.value(g)[1],0);assertEqual("Smooth 6",Math.round(1E3*e.value(g)[10]),Math.round(1974.74));clearModel();k=createPrimitive("x","Variable",[0,0],[100,100]);g=createPrimitive("ExpValue","Variable",[0,0],[100,100]);createConnector("Link","Link",k,g);setValue(k,"Staircase(20)");setValue(g,"Delay3([x],10,2)");e=runModel(!0);"RK1"==a[b]?(assertEqual("ExpDelay 1",Math.round(100*e.value(g)[3]),Math.round(194.6)),assertEqual("ExpDelay 2",Math.round(100*e.value(g)[2]),Math.round(200)),
assertEqual("ExpDelay 3",Math.round(100*e.value(g)[26]),Math.round(0.269*100))):"RK4"==a[b]&&assertEqual("ExpDelay 1",Math.floor(10*e.value(g)[3]),Math.floor(19.46));setValue(g,"[x].Delay3(10,2)");e=runModel(!0);"RK1"==a[b]?(assertEqual("ExpDelay 1 (Obj)",Math.round(100*e.value(g)[3]),Math.round(194.6)),assertEqual("ExpDelay 2 (Obj)",Math.round(100*e.value(g)[2]),Math.round(200)),assertEqual("ExpDelay 3 (Obj)",Math.round(100*e.value(g)[26]),Math.round(0.269*100))):"RK4"==a[b]&&assertEqual("ExpDelay 1 (Obj)",
Math.floor(10*e.value(g)[3]),Math.floor(19.46));clearModel();k=createPrimitive("RandParam","Variable",[0,0],[100,100]);g=createPrimitive("HalfRand","Variable",[0,0],[100,100]);c=createPrimitive("HalfRand","Stock",[0,0],[100,100]);createConnector("Link","Link",k,g);createConnector("Link","Link",k,c);setValue(k,"Rand");setValue(g,"[RandParam]/2");setValue(c,"[RandParam]/4");e=runModel(!0);assertEqual("Rand Cached Value",Math.round(1E4*e.lastValue(k)),Math.round(2E4*e.lastValue(g)));"RK1"==a[b]&&assertEqual("Rand Stock",
Math.round(1E4*e.value(k)[0]),Math.round(4E4*e.value(c)[0]));e=runModel(!0);d=e.lastValue(k);e=runModel(!0);assertUnequal("Set Rand Seed 1",e.lastValue(k),d);setMacros("SetRandSeed(1)");e=runModel(!0);d=e.lastValue(k);e=runModel(!0);assertEqual("Set Rand Seed 2",e.lastValue(k),d);setMacros("SetRandSeed(3)");e=runModel(!0);assertUnequal("Set Rand Seed 3",e.lastValue(g),d);setMacros("");clearModel();k=createPrimitive("x","Variable",[0,0],[100,100]);g=createPrimitive("y","Variable",[0,0],[100,100]);
createConnector("Link","Link",k,g);setValue(k,"Years");setValue(g,"Delay([x], {3 Years} )");e=runModel(!0);assertEqual("Time Units Delay 1",Math.round(1E4*e.value(g)[6]),Math.round(3E4));setValue(g,"Delay([x], {x: {3 years}, y: {5 years}} ).x");e=runModel(!0);assertEqual("Time Units Delay Vec 1",Math.round(1E4*e.value(g)[6]),Math.round(3E4));setValue(g,"Delay([x], {x: 2, y: 4} ).y");e=runModel(!0);assertEqual("Time Units Delay Vec 2",Math.round(1E4*e.value(g)[6]),Math.round(2E4));d=createPrimitive("z",
"Variable",[0,0],[100,100]);setValue(d,"{x: 2, y: 4}");createConnector("Link","Link",d,g);setValue(g,"Delay([x], [z]).y");e=runModel(!0);assertEqual("Time Units Delay Vec 3",Math.round(1E4*e.value(g)[6]),Math.round(2E4));setValue(g,"Delay([x], {x: -1, y: 4} ).y");e=runModel(!0);assertUnequal("Time Units Delay Vec 4",e.error,"none");setValue(g,"[x].Delay({3 Years} )");e=runModel(!0);assertEqual("Time Units Delay 1 (Obj)",Math.round(1E4*e.value(g)[6]),Math.round(3E4));setValue(g,"Delay([x], {48 Months})");
e=runModel(!0);assertEqual("Time Units Delay 2",Math.round(1E4*e.value(g)[6]),Math.round(2E4));setValue(g,"PastMean([x], {48 Months})");e=runModel(!0);assertEqual("Time Units Mean 1",Math.round(1E4*e.value(g)[6]),Math.round(4E4));setValue(g,"Mean(PastValues([x], {48 Months}))");e=runModel(!0);assertEqual("Time Units Mean 2",Math.round(1E4*e.value(g)[6]),Math.round(4E4));setValue(g,"PastMean([x], {3 Years})");e=runModel(!0);assertEqual("Time Units Mean 3",Math.round(1E4*e.value(g)[6]),Math.round(45E3));
setValue(g,"PastCorrelation([x],[x])");e=runModel(!0);assertEqual("Correlation",Math.round(1E4*e.value(g)[6]),1E4);setValue(g,"PastCorrelation([x],[x], {3 Years})");e=runModel(!0);assertEqual("Correlation",Math.round(1E4*e.value(g)[6]),1E4);clearModel();k=createPrimitive("x1","Variable",[0,0],[100,100]);g=createPrimitive("x2","Variable",[0,0],[100,100]);d=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("l","Link",k,d);createConnector("l2","Link",g,d);setUnits(k,"Centimeters");setUnits(g,
"Meters^2");setUnits(d,"Meters^3");setValue(k,"200");setValue(g,"3");setValue(d,"[x1]*[x2]");e=runModel(!0);assertEqual("Variable Units Conversion 1",e.value(d)[50],6);setUnits(k,"Seconds");e=runModel(!0);assertUnequal("Variable Units Conversion 2",e.error,"none");clearModel();k=createPrimitive("y1","Variable",[0,0],[100,100]);g=createPrimitive("y2","Variable",[0,0],[100,100]);d=createPrimitive("x","Variable",[0,0],[100,100]);createConnector("l","Link",d,k);createConnector("l2","Link",d,g);setUnits(g,
"Centimeters");setValue(d,"years");setValue(k,"delay([x],3)");setValue(g,"delay([x],5)");e=runModel(!0);assertEqual("Past Values Clone Check 1",e.value(k)[10],7);assertEqual("Past Values Clone Check 2",e.value(g)[10],5);assertEqual("Past Values Clone Check 3",e.value(d)[10],10);setValue(k,"delay1([x],2)");setValue(g,"delay1([x],2)");e=runModel(!0);assertEqual("Past Values Clone Check 4",e.error,"none");setValue(k,"delay3([x],2)");setValue(g,"delay3([x],2)");e=runModel(!0);assertEqual("Past Values Clone Check 5",
e.error,"none");setValue(k,"smooth([x],2)");setValue(g,"smooth([x],2)");e=runModel(!0);assertEqual("Past Values Clone Check 6",e.error,"none");clearModel();k=createPrimitive("x","Variable",[0,0],[100,100]);g=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("l","Link",k,g);setValue(k,"{36 Meters}");setValue(g,"1");setUnits(g,"Qubits");e=runModel(!0);assertUnequal("Variable Units Scaling 1",e.error,"none");setUnits(k,"Meters");e=runModel(!0);assertEqual("Variable Units Scaling 2",e.error,
"none");setValue(g,"[x]");e=runModel(!0);assertUnequal("Variable Units Scaling 3",e.error,"none")}}function testClearModel(){test="ClearModel";setupDummy();assertUnequal("Initial",findAll().length,0);clearModel();assertEqual("Final",findAll().length,0)}
function testTimeShift(){var a=test;test="Time Shift";clearModel();var b=createPrimitive("A","Stock",[200,200],[140,30]),c=createPrimitive("B","Stock",[400,200],[140,30]),d=createConnector("Flow A","Flow",null,b),e=createConnector("Flow B","Flow",null,c);setValue(b,10);setValue(c,10);setValue(d,"0.1*[A]");setValue(e,"0.1*[B]");var f=createPrimitive("f A","Folder",[200,150],[150,100]),g=createPrimitive("f B","Folder",[200,150],[150,100]);setParent([b,d],f);setParent([c,e],g);setTimeLength(10);setTimeStep(1);
setAlgorithm("RK1");d=runModel(!0);assertEqual("Base 1",d.value(b)[1],11);assertEqual("Base 2",d.value(c)[1],11);setFolderSolver(f,{enabled:!0,algorithm:"RK4",timeStep:1});d=runModel(!0);assertEqual("Switch 1",Math.round(1E3*d.value(b)[1]),Math.round(11051.708));assertEqual("Switch 2",d.value(c)[1],11);setFolderSolver(g,{enabled:!0,algorithm:"RK1",timeStep:2.5});d=runModel(!0);assertEqual("Switch 3",Math.round(1E3*d.value(b)[1]),Math.round(11051.708));assertEqual("Switch 4",isUndefined(d.value(c)[1]),
!0);assertEqual("Switch 5",d.value(c)[3],12.5);assertEqual("Switch 6",isUndefined(d.value(b)[3]),!0);setFolderSolver(f,{enabled:!0,algorithm:"RK4",timeStep:2.5});setFolderSolver(g,{enabled:!0,algorithm:"RK1",timeStep:1});d=runModel(!0);assertEqual("Switch 7",isUndefined(d.value(b)[1]),!0);assertEqual("Switch 8",d.value(c)[1],11);assertEqual("Switch 9",Math.round(1E3*d.value(b)[3]),Math.round(12.8401699*1E3));assertEqual("Switch 10",isUndefined(d.value(c)[3]),!0);test=a}
function testFolders(){test="Folders";var a=createPrimitive("s","Stock",[300,200],[140,30]),b=createPrimitive("f","Folder",[200,150],[150,100]);assertNull("Parent Null",getParent(a));setParent(a,b);assertEqual("Set Parent",getID(getParent(a)),getID(b));graph instanceof SimpleNode||(assertEqual("Default Folder",getCollapsed(b),!1),collapseFolder(b),assertEqual("Collapse Folder",getCollapsed(b),!0),expandFolder(b),assertEqual("Expand Folder",getCollapsed(b),!1));setParent(a,null);assertNull("Set Parent Null",
getParent(a));assertEqual("Get Initial Type 1",getFolderType(b),"None");setFolderType(b,"Agent");assertEqual("Get Initial Type 2",getFolderType(b),"Agent");setFolderAgentParent(b,"abc");assertEqual("Agent Parent",getFolderAgentParent(b),"abc");clearModel()}
function testCreate(){test="Create";var a=createPrimitive("Test Stock","Stock",[300,200],[140,30]);assertEqual("Name",getName(a),"Test Stock");assertEqual("Type",getType(a),"Stock");if(!(graph instanceof SimpleNode)){var b=getPosition(a);assertEqual("Position x",b[0],300);assertEqual("Position y",b[1],200);setPosition(a,[100,400]);b=getPosition(a);assertEqual("Position x 2",b[0],100);assertEqual("Position y 2",b[1],400)}a=createPrimitive("Test Variable","Variable",[400,200],[140,30]);assertEqual("Type",
getType(a),"Variable");a=createConnector("Test Link","Link",findName("Test Stock"),findName("Test Variable"));assertEqual("Type",getType(a),"Link")}
function testFind(){test="Find";setupComplexDummy();assertEqual("findType",findType("Stock").length,4);assertEqual("findNote",findNote("foo").length,0);setNote(findType("Stock"),"foo");assertEqual("findNote",findNote("foo").length,4);assertEqual("findType",findType(["Stock","Variable"]).length,6);assertEqual("findType",findType(["dsfsdf"]).length,0);assertEqual("findType",findType("dsfsdf").length,0);assertEqual("findAll",findAll().length,10);assertNull("findName",findName("fdfsdgfg"));assertNotNull("findName",
findName("y"));assertEqual("findName",findName("y").length,2);assertEqual("findName",findName(["x","y","fvdf"]).length,3);var a=getID(findName("x"));assertNotNull("findID",findID(a));assertNotNull("findID",findID([a]));assertNull("findID",findID("gfdgdfg"))}function setupDummy(){clearModel();createPrimitive("x","Stock",[200,200],[140,30])}
function setupComplexDummy(){clearModel();createPrimitive("My Converter","Converter",[200,200],[140,30]);createPrimitive("x","Stock",[200,200],[140,30]);createPrimitive("y","Stock",[100,200],[140,30]);createPrimitive("My Stock","Stock",[200,100],[140,30]);createPrimitive("y","Stock",[200,100],[140,30]);createPrimitive("a","Variable",[300,200],[140,30]);createPrimitive("b","Variable",[300,100],[140,30]);createConnector("Link","Link",findName("x"),findName("b"));createConnector("Link 2","Link",findName("x"),
findName("My Converter"));createConnector("My Flow","Flow",findName("x"),findName("My Stock"))};Function.prototype.method=function(a,b){this.prototype[a]=b;return this};Function.method("inherits",function(a){var b={},c=this.prototype=new a;this.method("uber",function(d){d in b||(b[d]=0);var e,f;e=b[d];f=a.prototype;if(e){for(;e;)f=f.constructor.prototype,e-=1;e=f[d]}else e=c[d],e==this[d]&&(e=f[d]);b[d]+=1;f=e.apply(this,Array.prototype.slice.apply(arguments,[1]));b[d]-=1;return f});return this});var unitsBank={};
function sortAndCollapseUnits(a,b){if(1>=a.length)1==a.length&&(a[0]=a[0].toLowerCase());else{for(var c=[],d=0;d<a.length;d++)c.push({name:a[d].toLowerCase(),exponent:b[d]});c.sort(function(a,b){return a.name.localeCompare(b.name)});a=[];b=[];for(d=0;d<c.length;d++)a.push(c[d].name),b.push(c[d].exponent);for(d=0;d<a.length;d++){for(c=d+1;c<a.length;c++)a[d]===a[c]&&(b[d]+=b[c],a.splice(c,1),b.splice(c,1),c--);0==b[d]&&(a.splice(d,1),b.splice(d,1),d--)}}return{names:a,exponents:b}}
function getUnitStore(a,b,c){c&&(b=sortAndCollapseUnits(a,b),a=b.names,b=b.exponents);if(0!=a.length)return c=getUnitsId(a,b),unitsBank[c]||(unitsBank[c]=new UnitStore(a,b)),unitsBank[c]}function getUnitsId(a,b){return a.join(",")+b.join(",")}function UnitStore(a,b){this.names=a;this.exponents=b;this.baseUnits=this.toBase=null;this.multiples={};this.id=getUnitsId(this.names,this.exponents)}
UnitStore.prototype.addBase=function(){if(!this.toBase){this.toBase=1;for(var a=this.names.slice(),b=this.exponents.slice(),c=!0;c;)for(var c=!1,d=a.length-1;0<=d;d--){var e=findSourceIndex(a[d]);if(-1!==e&&(1!=conUnitTargets[e].names.length||conUnitTargets[e].names[0]!=a[d])){this.toBase=fn["*"](this.toBase,fn.expt(conScalings[e],b[d]));a=a.concat(conUnitTargets[e].names);a.splice(d,1);b=b.concat(conUnitTargets[e].exponents.map(function(a){return a*b[d]}));b.splice(d,1);c=!0;break}}a=sortAndCollapseUnits(a,
b);this.baseUnits=getUnitStore(a.names,a.exponents)}};UnitStore.prototype.power=function(a){for(var b=this.names.slice(),c=this.exponents.slice(),d=0;d<c.length;d++)c[d]*=a;return getUnitStore(b,c)};UnitStore.prototype.toStringShort=function(){for(var a="",b=0;b<this.names.length;b++)""!=a&&(a+=","),a+=this.names[b],1!=this.exponents[b]&&(a=a+"^"+this.exponents[b]);return a};
UnitStore.prototype.multiply=function(a,b){var c=a.id+";"+b;if(!this.multiples[c]){this.toBase||this.addBase();a.toBase||a.addBase();if(this.baseUnits){var d=this.baseUnits.names.slice(),e=this.baseUnits.exponents.slice();if(a.baseUnits){for(var f=0;f<a.baseUnits.names.length;f++){var g=d.indexOf(a.baseUnits.names[f]);if(-1!=g)e[g]+=a.baseUnits.exponents[f]*b;else{for(var g=!1,k=0;k<d.length;k++)if(a.baseUnits.names[f]<d[k]){d.splice(k,0,a.baseUnits.names[f]);e.splice(k,0,a.baseUnits.exponents[f]*
b);g=!0;break}g||(d.push(a.baseUnits.names[f]),e.push(a.baseUnits.exponents[f]*b))}}for(f=e.length-1;0<=f;f--)0==e[f]&&(e.splice(f,1),d.splice(f,1))}}else d=a.baseUnits.names.slice(),e=a.baseUnits.exponents.slice();this.multiples[c]=getUnitStore(d,e)}return this.multiples[c]};function unitsFromString(a){var b=[],c=[];if(""!=a){a=a.split(",");for(var d=0;d<a.length;d++)b.push(a[d].split("^")[0]),-1!=a[d].indexOf("^")?c.push(parseFloat(a[d].split("^")[1])):c.push(1)}return getUnitStore(b,c,!0)}
var titleCaseReg=/\w\S*/g,titleCaseFunc=function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()};function toTitleCase(a){return a.replace(titleCaseReg,titleCaseFunc)}
UnitStore.prototype.toString=function(){for(var a="",b="",c=0,d=0,e=0;e<this.names.length;e++)if(""!=this.names[e]){var f='<span class="unit">'+toTitleCase(this.names[e])+"</span>";1!=this.exponents[e]&&-1!=this.exponents[e]&&(f=f+"<span class='markup'>^</span><sup>"+Math.abs(this.exponents[e])+"</sup>");0<this.exponents[e]?(0<c&&(a+="<span class='markup'>*</span>"),a+=f,c+=1):(0<d&&(b+="<span class='markup'>*</span>"),b+=f,d+=1)}""==a&&(a="Unitless");if(""==b)return'<div class="units">'+a+"</div>";
"Unitless"==a&&(a="1");return'<span class="units">'+a+"<hr/><span class='markup'>/(</span>"+b+"<span class='markup'>)</span></span>"};function convertUnits(a,b,c){if(a===b)return 1;if(a&&!b||b&&!a)return c?1:0;a.toBase||a.addBase();b.toBase||b.addBase();return a.baseUnits!==b.baseUnits?0:fn["/"](a.toBase,b.toBase)};var baseSources="Degree;Radians?;Ampere;Gram;Second;Meter;(Meters? ?Squared?|Squared? ?Meters?);(Centimeters? ?Squared?|Squared? ?Centimeters?);(Centimeters? ?Cubed?|Cubic ?Centimeters?);(Meters? Cubed?|Cubic ?Meters?);(Kilometers? ?Cubed?|Cubic ?Kilometers?);(Inches? Squared?|Squared? ?Inches?);(Miles? ?Squared?|Squared? ?Miles?);(Kilometers? Squared?|Squared? ?Kilometers?);Acre? ?(Feet|Foot);Meters? ?per ?Seconds?;Meters? ?per ?Seconds? ?Squared?;(Foot|Feet) ?per ?Seconds?;(Foot|Feet) ?per ?Seconds? ?Squared?;Miles? ?per ?Hours?;Miles? ?per ?Hours? ?Squared?;Kilometers? ?per ?Hours?;Kilometers? ?per ?Hours? ?Squared?;Liters? ?per ?Seconds?;(Cubic ?Meters?|Meters? ?Cubed?) ?per ?Seconds?;(Squared? ?Yards?|Yards? ?Squared?);(Squared? ?(Feet|Foot)|(Feet|Foot) ?Squared?);(Squared? Millimeters?|Millimeters? ?Squared?);(Millimeters? ?Cubed?|Cubic ?Millimeters?);Gallons? ?per ?Seconds?;Gallons? ?per ?Minutes?;Pounds? ?per ?Seconds?;Kilograms? ?per ?Seconds?;Dollars? ?per ?Seconds?;Dollars? ?per ?Hours?;Dollars? ?per ?Days?;Dollars? ?per ?Weeks?;Dollars? ?per ?Months?;Dollars? ?per ?Quarters?;Dollars? ?per ?Years?;Euros? ?per ?Seconds?;Euros? ?per ?Hours?;Euros? ?per ?Days?;Euros? ?per ?Weeks?;Euros? ?per ?Months?;Euros? ?per ?Quarters?;Euros? ?per ?Years?;Centimeters?;Millimeters?;Kilometers?;Inch(es)?;(Foot|Feet);Yards?;Miles?;Acres?;Hectares?;Liters?;Gallons?;Quarts?;Fluid ?Ounces?;Years?;Quarters?;Months?;Weeks?;Days?;Hours?;Minutes?;Kilograms?;Milligrams?;Ounces?;Pounds?;Tonnes?;Tons?;Watts?;Kilowatts?;Megawatts?;Gigawatts?;Calories?;Kilocalories?;(BTUs?|British ?Thermal ?units?);Kilojoules?;Joules?;Coulombs?;Volts?;Millivolts?;Kilovolts?;Newtons?;Pounds? ?Force;Atoms?;Molecules?;Farads?;Pascals?;Kilopascals?;Bars?;Atmospheres?;Pounds? ?per ?Squared? ?Inch(es)?".split(";"),
baseTargets="Degrees;Degrees;Amperes;Grams;Seconds;Meters;Meters^2;Centimeters^2;Centimeters^3;Meters^3;Kilometers^3;Inches^2;Miles^2;Kilometers^2;Acres,Feet;Meters,Seconds^-1;Meters,Seconds^-2;Feet,Seconds^-1;Feet,Seconds^-2;Miles,Hours^-1;Miles,Hours^-2;Kilometers,Hours^-1;Kilometers,Hours^-2;Liters,Seconds^-1;Meters^3,Seconds^-1;Yards^2;Feet^2;Millimeters^2;Millimeters^3;Gallons,Seconds^-1;Gallons,Minutes^-1;Pounds,Seconds^-1;Kilograms,Seconds^-1;Dollars,Seconds^-1;Dollars,Hours^-1;Dollars,Days^-1;Dollars,Weeks^-1;Dollars,Months^-1;Dollars,Quarters^-1;Dollars,Years^-1;Euros,Seconds^-1;Euros,Hours^-1;Euros,Days^-1;Euros,Weeks^-1;Euros,Months^-1;Euros,Quarters^-1;Euros,Years^-1;Meters;Meters;Meters;Meters;Meters;Meters;Meters;Meters^2;Meters^2;Meters^3;Meters^3;Meters^3;Meters^3;Seconds;Seconds;Seconds;Seconds;Seconds;Seconds;Seconds;Grams;Grams;Grams;Grams;Grams;Grams;Joules,Seconds^-1;Watts;Watts;Watts;Joules;Joules;Joules;Joules;Newtons,Meters;Amperes,Seconds;Watts,Amperes^-1;Volts;Volts;Kilograms,Meters,Seconds^-2;Pounds,Feet per Second Squared;Moles;Moles;Joules,Volts^-2;Newton,Meters^-2;Pascals;Pascals;Pascals;Pascals".split(";"),
baseScalings=[1,180/Math.PI,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0.01,0.001,1E3,0.0254,0.3048,0.9144,1609.344,4046.85642,1E4,0.001,0.003785,9.46E-4,3E-5,31536E3,7884E3,2628E3,604800,86400,3600,60,1E3,0.001,28.349523,453.59237,1E6,907184.74,1,1E3,1E6,1E9,4.184,4184,1055.05585,1E3,1,1,1,0.001,1E3,1,32.17405,0,0,1,1,1E3,1E5,101325,6894],conScalings=[],conTargets=[],conSourceNames=[],conUnitTargets=[],conSourceRegEx=[];
function loadUnits(a,b,c){conScalings=c;conTargets=b;conSourceNames=a;for(a=0;a<baseSources.length;a++)conScalings.push(baseScalings[a]),conTargets.push(baseTargets[a]),conSourceNames.push(baseSources[a]);conSourceRegEx=[];conUnitTargets=[];cachedUnits={};unitsBank={};for(a=0;a<conTargets.length;a++)conUnitTargets.push(unitsFromString(conTargets[a].toLowerCase())),conSourceRegEx.push(RegExp("^"+conSourceNames[a]+"$","i"))}loadUnits([],[],[]);
var cachedUnits={},findSourceIndex=function(a){if(a in cachedUnits)return cachedUnits[a];for(var b=conSourceNames.length-1;0<=b;b--)if(""!=cachedUnits[b]&&conSourceRegEx[b].test(a))return cachedUnits[a]=b;return cachedUnits[a]=-1};function Material(a,b){this.value=a;this.units=b}Material.prototype.toNum=function(){return this};
Material.prototype.toString=function(){return this.units?"<span class='markup'>{</span>"+this.value+"&nbsp"+this.units.toString()+"<span class='markup'>}</span>":this.value+""};Material.prototype.fullClone=function(){return new Material(this.value,this.units)};Material.prototype.forceUnits=function(a){if(this.units){var b=convertUnits(this.units,a);0==b?unitAlert(this.units,a,"forceUnits"):(this.value=fn["*"](this.value,b),this.units=a)}else this.units=a;return this};
function unitAlert(a,b,c){throw"MSG: Incompatible units for the "+c+" of "+(a?a.toString():"unitless")+" and "+(b?b.toString():"unitless")+".";};var notsupportedfn=function(){console.log("Not supported")},sn=function(a){return"#"==a[0]?parseFloat(a.substr(2)):parseFloat(a)},fn={"+":function(a,b){return a+b},"-":function(a,b){return isDefined(b)?a-b:-a},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"=":function(a,b){return a==b},"<":function(a,b){return a<b},"<=":function(a,b){return a<=b},">":function(a,b){return a>b},">=":function(a,b){return a>=b},mod:function(a,b){return a%b},expt:function(a,b){return Math.pow(a,b)},abs:Math.abs,
sin:Math.sin,asin:Math.asin,cos:Math.cos,acos:Math.acos,tan:Math.tan,atan:Math.atan,sqrt:Math.sqrt,log:function(a,b){return isDefined(b)?Math.log(a)/Math.log(b):Math.log(a)},exp:Math.exp,round:Math.round,floor:Math.floor,ceiling:Math.ceil,angle:notsupportedfn,magnitude:notsupportedfn,"real-part":function(a){return a}};if("undefined"==typeof org||!org)var org={};"undefined"!=typeof org.antlr&&org.antlr||(org.antlr={});org.antlr.global=function(){return this}.call(null);org.antlr.namespace=function(){var a=arguments,b=null,c,d,e;for(c=0;c<a.length;c+=1)for(e=a[c].split("."),b=org.antlr.global,d=0;d<e.length;d+=1)b[e[d]]=b[e[d]]||{},b=b[e[d]];return b};org.antlr.env=org.antlr.env||{};
org.antlr.env.ua=function(){var a={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,rhino:!1},b,c;try{b=navigator.userAgent;/KHTML/.test(b)&&(a.webkit=1);if((c=b.match(/AppleWebKit\/([^\s]*)/))&&c[1]){a.webkit=parseFloat(c[1]);if(/ Mobile\//.test(b))a.mobile="Apple";else if(c=b.match(/NokiaN[^\/]*/))a.mobile=c[0];if(c=b.match(/AdobeAIR\/([^\s]*)/))a.air=c[0]}if(!a.webkit)if((c=b.match(/Opera[\s\/]([^\s]*)/))&&c[1]){if(a.opera=parseFloat(c[1]),c=b.match(/Opera Mini[^;]*/))a.mobile=c[0]}else if((c=b.match(/MSIE\s([^;]*)/))&&
c[1])a.ie=parseFloat(c[1]);else if(c=b.match(/Gecko\/([^\s]*)/))a.gecko=1,(c=b.match(/rv:([^\s\)]*)/))&&c[1]&&(a.gecko=parseFloat(c[1]))}catch(d){}try{"undefined"==typeof window&&loadClass&&(a.rhino=!0)}catch(e){}return a}();org.antlr.namespace("org.antlr.runtime.tree");
org.antlr.lang=org.antlr.lang||{isArray:function(a){if(a){var b=org.antlr.lang;return b.isNumber(a.length)&&b.isFunction(a.splice)}return!1},isBoolean:function(a){return"boolean"===typeof a},isFunction:function(a){return"function"===typeof a},isNull:function(a){return null===a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},isObject:function(a){return a&&("object"===typeof a||org.antlr.lang.isFunction(a))||!1},isString:function(a){return"string"===typeof a},isUndefined:function(a){return"undefined"===
typeof a},_IEEnumFix:function(a,b){if(org.antlr.env.ua.ie){var c=["toString","valueOf"],d;for(d=0;d<c.length;d+=1){var e=c[d],f=b[e];org.antlr.lang.isFunction(f)&&f!=Object.prototype[e]&&(a[e]=f)}}},extend:function(a,b,c){if(!b||!a)throw Error("org.antlr.lang.extend failed, please check that all dependencies are included.");var d=function(){};d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.superclass=b.prototype;b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=
b);if(c){for(var e in c)a.prototype[e]=c[e];org.antlr.lang._IEEnumFix(a.prototype,c)}},augmentObject:function(a,b){if(!b||!a)throw Error("Absorb failed, verify dependencies.");var c=arguments,d,e=c[2];if(e&&!0!==e)for(d=2;d<c.length;d+=1)a[c[d]]=b[c[d]];else{for(d in b)if(e||!a[d])a[d]=b[d];org.antlr.lang._IEEnumFix(a,b)}},augmentProto:function(a,b){if(!b||!a)throw Error("Augment failed, verify dependencies.");for(var c=[a.prototype,b.prototype],d=2;d<arguments.length;d+=1)c.push(arguments[d]);org.antlr.lang.augmentObject.apply(this,
c)},merge:function(){for(var a={},b=arguments,c=0,d=b.length;c<d;c+=1)org.antlr.lang.augmentObject(a,b[c],!0);return a},isValue:function(a){var b=org.antlr.lang;return b.isObject(a)||b.isString(a)||b.isNumber(a)||b.isBoolean(a)},array:{peek:function(a){if(!org.antlr.lang.isArray(a))throw Error("org.antlr.lang.array.peek: a is not an array.");var b=a.length;if(0>=b)throw Error("org.antlr.lang.array.peek: a is empty.");return a[b-1]}}};
org.antlr.runtime.RecognizerSharedState=function(){this.following=[];this._fsp=-1;this.errorRecovery=!1;this.lastErrorIndex=-1;this.failed=!1;this.backtracking=this.syntaxErrors=0;this.token=this.ruleMemo=null;this.tokenStartCharIndex=-1;this.text=null};org.antlr.runtime.IndexOutOfBoundsException=function(a){org.antlr.runtime.IndexOutOfBoundsException.superclass.constructor.call(this,a)};org.antlr.lang.extend(org.antlr.runtime.IndexOutOfBoundsException,Error,{name:"org.antlr.runtime.IndexOutOfBoundsException"});
org.antlr.runtime.RecognitionException=function(a){org.antlr.runtime.RecognitionException.superclass.constructor.call(this);this.input=a;this.index=a.index();a instanceof org.antlr.runtime.CommonTokenStream&&(this.token=a.LT(1),this.line=this.token.getLine(),this.charPositionInLine=this.token.getCharPositionInLine());a instanceof org.antlr.runtime.tree.TreeNodeStream?this.extractInformationFromTreeNodeStream(a):a instanceof org.antlr.runtime.ANTLRStringStream?(this.c=a.LA(1),this.line=a.getLine(),
this.charPositionInLine=a.getCharPositionInLine()):this.c=a.LA(1);this.message=this.toString()};
org.antlr.lang.extend(org.antlr.runtime.RecognitionException,Error,{input:null,index:null,token:null,node:null,c:null,line:null,name:"org.antlr.runtime.RecognitionException",charPositionInLine:null,approximateLineInfo:null,extractInformationFromTreeNodeStream:function(a){var b,c,d;this.node=a.LT(1);c=a.getTreeAdaptor();if(b=c.getToken(this.node))if(this.token=b,0>=b.getLine())for(d=-1,b=a.LT(d);b;){if((priorPayload=c.getToken(b))&&0<priorPayload.getLine()){this.line=priorPayload.getLine();this.charPositionInLine=
priorPayload.getCharPositionInLine();this.approximateLineInfo=!0;break}--d;b=a.LT(d)}else this.line=b.getLine(),this.charPositionInLine=b.getCharPositionInLine();else this.node instanceof org.antlr.runtime.tree.CommonTree?(this.line=this.node.getLine(),this.charPositionInLine=this.node.getCharPositionInLine(),this.node instanceof org.antlr.runtime.tree.CommonTree&&(this.token=this.node.token)):(a=c.getType(this.node),c=c.getText(this.node),this.token=new org.antlr.runtime.CommonToken(a,c))},getUnexpectedType:function(){return this.input instanceof
org.antlr.runtime.CommonTokenStream?this.token.getType():this.input instanceof org.antlr.runtime.tree.TreeNodeStream?this.input.getTreeAdaptor().getType(this.node):this.c}});org.antlr.runtime.MismatchedTokenException=function(a,b){0===arguments.length?this.expecting=org.antlr.runtime.Token.INVALID_TOKEN_TYPE:(org.antlr.runtime.MismatchedTokenException.superclass.constructor.call(this,b),this.expecting=a)};
org.antlr.lang.extend(org.antlr.runtime.MismatchedTokenException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTokenException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTokenException"});org.antlr.runtime.UnwantedTokenException=function(a,b){0<arguments.length&&org.antlr.runtime.UnwantedTokenException.superclass.constructor.call(this,a,b)};
org.antlr.lang.extend(org.antlr.runtime.UnwantedTokenException,org.antlr.runtime.MismatchedTokenException,{getUnexpectedToken:function(){return this.token},toString:function(){var a=", expected "+this.expecting;this.expecting===org.antlr.runtime.Token.INVALID_TOKEN_TYPE&&(a="");return org.antlr.lang.isValue(this.token)?"UnwantedTokenException(found="+this.token.getText()+a+")":"UnwantedTokenException(found="+a+")"},name:"org.antlr.runtime.UnwantedTokenException"});
org.antlr.runtime.MissingTokenException=function(a,b,c){0<arguments.length&&(org.antlr.runtime.MissingTokenException.superclass.constructor.call(this,a,b),this.inserted=c)};
org.antlr.lang.extend(org.antlr.runtime.MissingTokenException,org.antlr.runtime.MismatchedTokenException,{getMissingType:function(){return this.expecting},toString:function(){return org.antlr.lang.isValue(this.inserted)&&org.antlr.lang.isValue(this.token)?"MissingTokenException(inserted "+this.inserted+" at "+this.token.getText()+")":org.antlr.lang.isValue(this.token)?"MissingTokenException(at "+this.token.getText()+")":"MissingTokenException"},name:"org.antlr.runtime.MissingTokenException"});
org.antlr.runtime.NoViableAltException=function(a,b,c,d){org.antlr.runtime.NoViableAltException.superclass.constructor.call(this,d);this.grammarDecisionDescription=a;this.decisionNumber=b;this.stateNumber=c};
org.antlr.lang.extend(org.antlr.runtime.NoViableAltException,org.antlr.runtime.RecognitionException,{toString:function(){return this.input instanceof org.antlr.runtime.ANTLRStringStream?"NoViableAltException('"+this.getUnexpectedType()+"'@["+this.grammarDecisionDescription+"])":"NoViableAltException("+this.getUnexpectedType()+"@["+this.grammarDecisionDescription+"])"},name:"org.antlr.runtime.NoViableAltException"});
org.antlr.runtime.EarlyExitException=function(a,b){org.antlr.runtime.EarlyExitException.superclass.constructor.call(this,b);this.decisionNumber=a};org.antlr.lang.extend(org.antlr.runtime.EarlyExitException,org.antlr.runtime.RecognitionException,{name:"org.antlr.runtime.EarlyExitException"});org.antlr.runtime.MismatchedSetException=function(a,b){org.antlr.runtime.MismatchedSetException.superclass.constructor.call(this,b);this.expecting=a};
org.antlr.lang.extend(org.antlr.runtime.MismatchedSetException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedSetException"});org.antlr.runtime.MismatchedNotSetException=function(a,b){org.antlr.runtime.MismatchedNotSetException.superclass.constructor.call(this,a,b)};
org.antlr.lang.extend(org.antlr.runtime.MismatchedNotSetException,org.antlr.runtime.MismatchedSetException,{toString:function(){return"MismatchedNotSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedNotSetException"});org.antlr.runtime.MismatchedRangeException=function(a,b,c){if(0===arguments.length)return this;org.antlr.runtime.MismatchedRangeException.superclass.constructor.call(this,c);this.a=a;this.b=b};
org.antlr.lang.extend(org.antlr.runtime.MismatchedRangeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedRangeException("+this.getUnexpectedType()+" not in ["+this.a+","+this.b+"])"},name:"org.antlr.runtime.MismatchedRangeException"});org.antlr.runtime.FailedPredicateException=function(a,b,c){org.antlr.runtime.FailedPredicateException.superclass.constructor.call(this,a);this.ruleName=b;this.predicateText=c};
org.antlr.lang.extend(org.antlr.runtime.FailedPredicateException,org.antlr.runtime.RecognitionException,{toString:function(){return"FailedPredicateException("+this.ruleName+",{"+this.predicateText+"}?)"},name:"org.antlr.runtime.FailedPredicateException"});org.antlr.runtime.BitSet=function(a){a||(a=org.antlr.runtime.BitSet.BITS);org.antlr.lang.isArray(a)?this.bits=a:org.antlr.lang.isNumber(a)&&(this.bits=[])};
org.antlr.lang.augmentObject(org.antlr.runtime.BitSet,{BITS:32,LOG_BITS:5,MOD_MASK:31,bitMask:function(a){return 1<<(a&org.antlr.runtime.BitSet.MOD_MASK)},numWordsToHold:function(a){return(a>>org.antlr.runtime.BitSet.LOG_BITS)+1},wordNumber:function(a){return a>>org.antlr.runtime.BitSet.LOG_BITS},of:function(a,b){var c,d,e;if(org.antlr.lang.isNumber(a)){if(org.antlr.lang.isNumber(b))for(e=new org.antlr.runtime.BitSet(b+1),c=a;c<=b;c++)d=org.antlr.runtime.BitSet.wordNumber(c),e.bits[d]|=org.antlr.runtime.BitSet.bitMask(c);
else e=new org.antlr.runtime.BitSet(a+1),e.add(a);return e}if(org.antlr.lang.isArray(a)){e=new org.antlr.runtime.BitSet;for(c=a.length-1;0<=c;c--)e.add(a[c]);return e}if(a instanceof org.antlr.runtime.BitSet)return a?a:null;if(a instanceof org.antlr.runtime.IntervalSet){if(!a)return null;e=new org.antlr.runtime.BitSet;e.addAll(a);return e}if(org.antlr.lang.isObject(a)){d=[];for(c in a)org.antlr.lang.isNumber(c)&&d.push(c);return org.antlr.runtime.BitSet.of(d)}}});
org.antlr.runtime.BitSet.prototype={add:function(a){var b=org.antlr.runtime.BitSet.wordNumber(a);b>=this.bits.length&&this.growToInclude(a);this.bits[b]|=org.antlr.runtime.BitSet.bitMask(a)},addAll:function(a){var b,c;if(a instanceof org.antlr.runtime.BitSet)this.orInPlace(a);else if(!(a instanceof org.antlr.runtime.IntervalSet)&&org.antlr.lang.isArray(a))for(b=0;b<a.length;b++)c=a[b],this.add(c)},and:function(a){var b=this.clone();b.andInPlace(a);return b},andInPlace:function(a){var b=Math.min(this.bits.length,
a.bits.length),c;for(c=b-1;0<=c;c--)this.bits[c]&=a.bits[c];for(c=b;c<this.bits.length;c++)this.bits[c]=0},clear:function(a){if(0===arguments.length){var b;for(b=this.bits.length-1;0<=b;b--)this.bits[b]=0}else b=org.antlr.runtime.BitSet.wordNumber(a),b>=this.bits.length&&this.growToInclude(a),this.bits[b]&=~org.antlr.runtime.BitSet.bitMask(a)},clone:function(){var a,b,c=[];a=0;for(b=this.bits.length;a<b;a++)c[a]=this.bits[a];return new org.antlr.runtime.BitSet(c)},size:function(){var a=0,b,c,d;for(b=
this.bits.length-1;0<=b;b--)if(c=this.bits[b],0!==c)for(d=org.antlr.runtime.BitSet.BITS-1;0<=d;d--)0!==(c&1<<d)&&a++;return a},equals:function(a){if(!(a&&a instanceof org.antlr.runtime.BitSet))return!1;var b,c=Math.min(this.bits.length,a.bits.length);for(b=0;b<c;b++)if(this.bits[b]!=a.bits[b])return!1;if(this.bits.length>c)for(b=c+1;b<this.bits.length;b++){if(0!==this.bits[b])return!1}else if(a.bits.length>c)for(b=c+1;b<a.bits.length;b++)if(0!==a.bits[b])return!1;return!0},growToInclude:function(a){Math.max(this.bits.length<<
1,org.antlr.runtime.BitSet.numWordsToHold(a));a=[];var b;b=0;for(len=this.bits.length;b<len;b++)a[b]=this.bits[b];this.bits=a},member:function(a){var b=org.antlr.runtime.BitSet.wordNumber(a);return b>=this.bits.length?!1:0!==(this.bits[b]&org.antlr.runtime.BitSet.bitMask(a))},getSingleElement:function(){var a;for(a=0;a<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;a++)if(this.member(a))return a;return-1},isNil:function(){var a;for(a=this.bits.length-1;0<=a;a--)if(0!==this.bits[a])return!1;return!0},
complement:function(a){if(a)return a.subtract(this);a=this.clone();a.notInPlace();return a},notInPlace:function(){var a,b,c;if(0===arguments.length)for(a=this.bits.length-1;0<=a;a--)this.bits[a]=~this.bits[a];else for(1===arguments.length?(a=0,b=arguments[0]):(a=arguments[0],b=arguments[1]),this.growToInclude(b);a<=b;a++)c=org.antlr.runtime.BitSet.wordNumber(a),this.bits[c]^=org.antlr.runtime.BitSet.bitMask(a)},or:function(a){if(!a)return this;var b=this.clone();b.orInPlace(a);return b},orInPlace:function(a){if(a){a.bits.length>
this.bits.length&&this.setSize(a.bits.length);var b;for(b=Math.min(this.bits.length,a.bits.length)-1;0<=b;b--)this.bits[b]|=a.bits[b]}},remove:function(a){var b=org.antlr.runtime.BitSet.wordNumber(a);b>=this.bits.length&&this.growToInclude(a);this.bits[b]&=~org.antlr.runtime.BitSet.bitMask(a)},setSize:function(a){for(a-=this.bits.length;0<=a;)this.bits.push(0),a--},numBits:function(){return this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS},lengthInLongWords:function(){return this.bits.length},
subset:function(a){return a?this.and(a).equals(this):!1},subtractInPlace:function(a){if(a){var b;for(b=0;b<this.bits.length&&b<a.bits.length;b++)this.bits[b]&=~a.bits[b]}},subtract:function(a){if(!(a&&a instanceof org.antlr.runtime.BitSet))return null;var b=this.clone();b.subtractInPlace(a);return b},toArray:function(){var a=[],b,c=0;for(b=0;b<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;b++)this.member(b)&&(a[c++]=b);return a},toPackedArray:function(){return this.bits},toString:function(){return 0===
arguments.length?this.toString1(null):org.antlr.lang.isString(arguments[0])?org.antlr.lang.isValue(arguments[1])?this.toString2(arguments[0],arguments[1]):this.toString1(null):this.toString1(arguments[0])},toString1:function(a){var b="{",c,d=!1;for(c=0;c<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;c++)this.member(c)&&(0<c&&d&&(b+=","),b=a?b+a.getTokenDisplayName(c):b+c.toString(),d=!0);return b+"}"},toString2:function(a,b){var c="",d;for(d=0;d<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;d++)this.member(d)&&
(0<c.length&&(c+=a),c=d>=b.size()?c+("'"+d+"'"):org.antlr.lang.isValue(b.get(d))?c+b.get(d):c+("'"+d+"'"));return c}};org.antlr.runtime.CharStream={EOF:-1};
org.antlr.runtime.CommonToken=function(){var a;this.charPositionInLine=-1;this.channel=0;this.index=-1;1==arguments.length?org.antlr.lang.isNumber(arguments[0])?this.type=arguments[0]:(a=arguments[0],this.text=a.getText(),this.type=a.getType(),this.line=a.getLine(),this.index=a.getTokenIndex(),this.charPositionInLine=a.getCharPositionInLine(),this.channel=a.getChannel(),a instanceof org.antlr.runtime.CommonToken&&(this.start=a.start,this.stop=a.stop)):2==arguments.length?(this.type=arguments[0],this.text=
arguments[1],this.channel=0):5==arguments.length&&(this.input=arguments[0],this.type=arguments[1],this.channel=arguments[2],this.start=arguments[3],this.stop=arguments[4])};
org.antlr.runtime.CommonToken.prototype={getType:function(){return this.type},setLine:function(a){this.line=a},getText:function(){return org.antlr.lang.isString(this.text)?this.text:this.input?this.text=this.input.substring(this.start,this.stop):null},setText:function(a){this.text=a},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setCharPositionInLine:function(a){this.charPositionInLine=a},getChannel:function(){return this.channel},setChannel:function(a){this.channel=
a},setType:function(a){this.type=a},getStartIndex:function(){return this.start},setStartIndex:function(a){this.start=a},getStopIndex:function(){return this.stop},setStopIndex:function(a){this.stop=a},getTokenIndex:function(){return this.index},setTokenIndex:function(a){this.index=a},getInputStream:function(){return this.input},setInputStream:function(a){this.input=a},toString:function(){var a="";0<this.channel&&(a=",channel="+this.channel);var b=this.getText();org.antlr.lang.isNull(b)?b="<no text>":
(b=b.replace(/\n/g,"\\\\n"),b=b.replace(/\r/g,"\\\\r"),b=b.replace(/\t/g,"\\\\t"));return"[@"+this.getTokenIndex()+","+this.start+":"+this.stop+"='"+b+"',<"+this.type+">"+a+","+this.line+":"+this.getCharPositionInLine()+"]"}};org.antlr.runtime.Token=function(){};
org.antlr.lang.augmentObject(org.antlr.runtime.Token,{EOR_TOKEN_TYPE:1,DOWN:2,UP:3,MIN_TOKEN_TYPE:4,EOF:org.antlr.runtime.CharStream.EOF,EOF_TOKEN:new org.antlr.runtime.CommonToken(org.antlr.runtime.CharStream.EOF),INVALID_TOKEN_TYPE:0,INVALID_TOKEN:new org.antlr.runtime.CommonToken(0),SKIP_TOKEN:new org.antlr.runtime.CommonToken(0),DEFAULT_CHANNEL:0,HIDDEN_CHANNEL:99});org.antlr.lang.augmentObject(org.antlr.runtime.CommonToken,org.antlr.runtime.Token);
org.antlr.runtime.tree.RewriteCardinalityException=function(a){this.elementDescription=a};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteCardinalityException,Error,{getMessage:function(){return org.antlr.lang.isString(this.elementDescription)?this.elementDescription:null},name:function(){return"org.antlr.runtime.tree.RewriteCardinalityException"}});
org.antlr.runtime.tree.RewriteEmptyStreamException=function(a){org.antlr.runtime.tree.RewriteEmptyStreamException.superclass.constructor.call(this,a)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEmptyStreamException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEmptyStreamException"}});
org.antlr.runtime.tree.RewriteEarlyExitException=function(a){var b=org.antlr.runtime.tree.RewriteEarlyExitException.superclass;org.antlr.lang.isUndefined(a)&&(a=null);b.constructor.call(this,a)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEarlyExitException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEarlyExitException"}});
org.antlr.runtime.MismatchedTreeNodeException=function(a,b){a&&b&&(org.antlr.runtime.MismatchedTreeNodeException.superclass.constructor.call(this,b),this.expecting=a)};org.antlr.lang.extend(org.antlr.runtime.MismatchedTreeNodeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTreeNodeException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTreeNodeException"});org.antlr.runtime.tree.BaseTree=function(){};
org.antlr.runtime.tree.BaseTree.prototype={getChild:function(a){return!this.children||a>=this.children.length?null:this.children[a]},getChildren:function(){return this.children},getFirstChildWithType:function(a){var b,c;for(b=0;this.children&&b<this.children.length;b++)if(c=this.children[b],c.getType()===a)return c;return null},getChildCount:function(){return this.children?this.children.length:0},addChild:function(a){if(org.antlr.lang.isValue(a)){var b,c,d;if(a.isNil()){if(this.children&&this.children==
a.children)throw Error("attempt to add child list to itself");if(a.children)if(this.children)for(b=a.children.length,c=0;c<b;c++)d=a.children[c],this.children.push(d),d.setParent(this),d.setChildIndex(this.children.length-1);else this.children=a.children,this.freshenParentAndChildIndexes()}else this.children||(this.children=this.createChildrenList()),this.children.push(a),a.setParent(this),a.setChildIndex(this.children.length-1)}},addChildren:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],this.addChild(c)},
setChild:function(a,b){if(b){if(b.isNil())throw Error("Can't set single child to a list");this.children||(this.children=this.createChildrenList());this.children[a]=b;b.setParent(this);b.setChildIndex(a)}},deleteChild:function(a){if(!this.children)return null;if(0>a||a>=this.children.length)throw Error("Index out of bounds.");var b=this.children.splice(a,1)[0];this.freshenParentAndChildIndexes(a);return b},replaceChildren:function(a,b,c){if(!this.children)throw Error("indexes invalid; no children in list");
var d=b-a+1,e,f=null;c.isNil()?f=c.children:(f=[],f.push(c));var g=e=f.length;c=d-e;if(0===c)for(c=0;a<=b;a++)d=f[c],this.children[a]=d,d.setParent(this),d.setChildIndex(a),c++;else{if(0<c){for(c=0;c<g;c++)this.children[a+c]=f[c];for(d=f=a+g;d<=b;d++)this.children.splice(f,1)}else{for(c=0;c<d;c++)this.children[a+c]=f[c];for(c=d;c<e;c++)this.children.splice(a+c,0,f[c])}this.freshenParentAndChildIndexes(a)}},createChildrenList:function(){return[]},isNil:function(){return!1},freshenParentAndChildIndexes:function(a){org.antlr.lang.isNumber(a)||
(a=0);for(var b=this.getChildCount(),c;a<b;a++)c=this.getChild(a),c.setChildIndex(a),c.setParent(this)},sanityCheckParentAndChildIndexes:function(a,b){0===arguments.length&&(a=null,b=-1);if(a!==this.getParent())throw Error("parents don't match; expected "+a+" found "+this.getParent());if(b!==this.getChildIndex())throw Error("child indexes don't match; expected "+b+" found "+this.getChildIndex());var c=this.getChildCount(),d,e;for(d=0;d<c;d++)e=this.getChild(d),e.sanityCheckParentAndChildIndexes(this,
d)},getChildIndex:function(){return 0},setChildIndex:function(a){},getParent:function(){return null},setParent:function(a){},getTree:function(){return this},toStringTree:function(){if(!this.children||0===this.children.length)return this.toString();var a="",b,c;this.isNil()||(a=a+"("+this.toString(),a+=" ");for(b=0;this.children&&b<this.children.length;b++)c=this.children[b],0<b&&(a+=" "),a+=c.toStringTree();this.isNil()||(a+=")");return a},getLine:function(){return 0},getCharPositionInLine:function(){return 0}};
org.antlr.runtime.tree.CommonTree=function(a){this.childIndex=this.stopIndex=this.startIndex=-1;this.token=this.parent=null;a instanceof org.antlr.runtime.tree.CommonTree?(org.antlr.runtime.tree.CommonTree.superclass.constructor.call(this,a),this.token=a.token,this.startIndex=a.startIndex,this.stopIndex=a.stopIndex):a instanceof org.antlr.runtime.CommonToken&&(this.token=a)};
org.antlr.lang.extend(org.antlr.runtime.tree.CommonTree,org.antlr.runtime.tree.BaseTree,{getToken:function(){return this.token},dupNode:function(){return new org.antlr.runtime.tree.CommonTree(this)},isNil:function(){return!this.token},getType:function(){return this.token?this.token.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){return this.token?this.token.getText():null},getLine:function(){return this.token&&0!==this.token.getLine()?this.token.getLine():0<this.getChildCount()?
this.getChild(0).getLine():0},getCharPositionInLine:function(){return this.token&&-1!==this.token.getCharPositionInLine()?this.token.getCharPositionInLine():0<this.getChildCount()?this.getChild(0).getCharPositionInLine():0},getTokenStartIndex:function(){return this.token?this.token.getTokenIndex():this.startIndex},setTokenStartIndex:function(a){this.startIndex=a},getTokenStopIndex:function(){return this.token?this.token.getTokenIndex():this.stopIndex},setTokenStopIndex:function(a){this.stopIndex=
a},getChildIndex:function(){return this.childIndex},getParent:function(){return this.parent},setParent:function(a){this.parent=a},setChildIndex:function(a){this.childIndex=a},toString:function(){return this.isNil()?"nil":this.getType()===org.antlr.runtime.Token.INVALID_TOKEN_TYPE?"<errornode>":this.token?this.token.getText():null}});org.antlr.runtime.tree.Tree={INVALID_NODE:new org.antlr.runtime.tree.CommonTree(org.antlr.runtime.Token.INVALID_TOKEN)};
org.antlr.runtime.tree.CommonErrorNode=function(a,b,c,d){if(!c||c.getTokenIndex()<b.getTokenIndex()&&c.getType()!=org.antlr.runtime.Token.EOF)c=b;this.input=a;this.start=b;this.stop=c;this.trappedException=d};
org.antlr.lang.extend(org.antlr.runtime.tree.CommonErrorNode,org.antlr.runtime.tree.CommonTree,{isNil:function(){return!1},getType:function(){return org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){var a=null;if(this.start instanceof org.antlr.runtime.CommonToken){var a=this.start.getTokenIndex(),b=this.stop.getTokenIndex();this.stop.getType()===org.antlr.runtime.Token.EOF&&(b=this.input.size());a=this.input.toString(a,b)}else a=this.start instanceof org.antlr.runtime.tree.CommonTree?
this.input.toString(this.start,this.stop):"<unknown>";return a},toString:function(){return this.trappedException instanceof org.antlr.runtime.MissingTokenException?"<missing type: "+this.trappedException.getMissingType()+">":this.trappedException instanceof org.antlr.runtime.UnwantedTokenException?"<extraneous: "+this.trappedException.getUnexpectedToken()+", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.MismatchedTokenException?"<mismatched token: "+this.trappedException.token+
", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.NoViableAltException?"<unexpected: "+this.trappedException.token+", resync="+this.getText()+">":"<error: "+this.getText()+">"}});org.antlr.runtime.tree.BaseTreeAdaptor=function(){this.uniqueNodeID=1};
org.antlr.runtime.tree.BaseTreeAdaptor.prototype={nil:function(){return this.create(null)},errorNode:function(a,b,c,d){return new org.antlr.runtime.tree.CommonErrorNode(a,b,c,d)},isNil:function(a){return a.isNil()},dupTree:function(a,b){1===arguments.length&&(b=null);if(!a)return null;var c=this.dupNode(a);this.setChildIndex(c,this.getChildIndex(a));this.setParent(c,b);var d=this.getChildCount(a),e,f;for(e=0;e<d;e++)f=this.getChild(a,e),f=this.dupTree(f,a),this.addChild(c,f);return c},addChild:function(a,
b){a&&org.antlr.lang.isValue(b)&&a.addChild(b)},becomeRoot:function(a,b){if(a instanceof org.antlr.runtime.CommonToken||!a)a=this.create(a);var c=a;if(!b)return a;if(c.isNil()){if(1<c.getChildCount())throw Error("more than one node as root (TODO: make exception hierarchy)");c=c.getChild(0)}c.addChild(b);return c},rulePostProcessing:function(a){a&&a.isNil()&&(0===a.getChildCount()?a=null:1===a.getChildCount()&&(a=a.getChild(0),a.setParent(null),a.setChildIndex(-1)));return a},create:function(a,b){var c;
if(2===arguments.length)return org.antlr.lang.isString(arguments[1])?(c=arguments[1],b=this.createToken(a,c)):(b=this.createToken(b),b.setType(a)),c=this.create(b);if(3===arguments.length)return c=arguments[2],b=this.createToken(b),b.setType(a),b.setText(c),c=this.create(b)},getType:function(a){a.getType();return 0},setType:function(a,b){throw Error("don't know enough about Tree node");},getText:function(a){return a.getText()},setText:function(a,b){throw Error("don't know enough about Tree node");
},getChild:function(a,b){return a.getChild(b)},setChild:function(a,b,c){a.setChild(b,c)},deleteChild:function(a,b){return a.deleteChild(b)},getChildCount:function(a){return a.getChildCount()},getUniqueID:function(a){this.treeToUniqueIDMap||(this.treeToUniqueIDMap={});var b=this.treeToUniqueIDMap[a];if(org.antlr.lang.isValue(b))return b;b=this.uniqueNodeID;this.treeToUniqueIDMap[a]=b;this.uniqueNodeID++;return b}};org.antlr.runtime.tree.CommonTreeAdaptor=function(){};
org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeAdaptor,org.antlr.runtime.tree.BaseTreeAdaptor,{dupNode:function(a){return org.antlr.lang.isValue(a)?a.dupNode():null},create:function(a){return 1<arguments.length?org.antlr.runtime.tree.CommonTreeAdaptor.superclass.create.apply(this,arguments):new org.antlr.runtime.tree.CommonTree(a)},createToken:function(a){return 2===arguments.length?new org.antlr.runtime.CommonToken(arguments[0],arguments[1]):new org.antlr.runtime.CommonToken(arguments[0])},
setTokenBoundaries:function(a,b,c){if(org.antlr.lang.isValue(a)){var d=0,e=0;org.antlr.lang.isValue(b)&&(d=b.getTokenIndex?b.getTokenIndex():b.getStartIndex?b.getStartIndex():b.getTokenStartIndex());org.antlr.lang.isValue(c)&&(e=e.getTokenIndex?c.getTokenIndex():c.getStopIndex?c.getStopIndex():c.getTokenStopIndex());a.setTokenStartIndex(d);a.setTokenStopIndex(e)}},getTokenStartIndex:function(a){return a?a.getTokenStartIndex():-1},getTokenStopIndex:function(a){return a?a.getTokenStopIndex():-1},getText:function(a){return a?
a.getText():null},getType:function(a){return a?a.getType():org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getToken:function(a){return a instanceof org.antlr.runtime.tree.CommonTree?a.getToken():null},getChild:function(a,b){return a?a.getChild(b):null},getChildCount:function(a){return a?a.getChildCount():0},getParent:function(a){return a.getParent()},setParent:function(a,b){a.setParent(b)},getChildIndex:function(a){return a.getChildIndex()},setChildIndex:function(a,b){a.setChildIndex(b)},replaceChildren:function(a,
b,c,d){a&&a.replaceChildren(b,c,d)}});org.antlr.runtime.ANTLRStringStream=function(a){this.p=0;this.line=1;this.markDepth=this.charPositionInLine=0;this.lastMarker=this.markers=null;this.data=a;this.n=a.length};
org.antlr.runtime.ANTLRStringStream.prototype={reset:function(){this.p=0;this.line=1;this.markDepth=this.charPositionInLine=0},consume:function(){this.p<this.n&&(this.charPositionInLine++,"\n"===this.data.charAt(this.p)&&(this.line++,this.charPositionInLine=0),this.p++)},LA:function(a){0>a&&a++;a=this.p+a-1;return a>=this.n||0>a?org.antlr.runtime.CharStream.EOF:this.data.charAt(a)},index:function(){return this.p},size:function(){return this.n},mark:function(){this.markers||(this.markers=[],this.markers.push(null));
this.markDepth++;var a=null;this.markDepth>=this.markers.length?(a={},this.markers.push(a)):a=this.markers[this.markDepth];a.p=this.p;a.line=this.line;a.charPositionInLine=this.charPositionInLine;return this.lastMarker=this.markDepth},rewind:function(a){org.antlr.lang.isNumber(a)||(a=this.lastMarker);var b=this.markers[a];this.seek(b.p);this.line=b.line;this.charPositionInLine=b.charPositionInLine;this.release(a)},release:function(a){this.markDepth=a;this.markDepth--},seek:function(a){if(a<=this.p)this.p=
a;else for(;this.p<a;)this.consume()},substring:function(a,b){return this.data.substr(a,b-a+1)},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setLine:function(a){this.line=a},setCharPositionInLine:function(a){this.charPositionInLine=a},getSourceName:function(){return null}};org.antlr.runtime.ANTLRStringStream.LT=org.antlr.runtime.ANTLRStringStream.LA;
org.antlr.runtime.CommonTokenStream=function(a,b){this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.v_discardOffChannelTokens=!1;this.tokens=[];2<=arguments.length?this.channel=b:1===arguments.length&&(this.tokenSource=a)};
org.antlr.runtime.CommonTokenStream.prototype={setTokenSource:function(a){this.tokenSource=a;this.tokens=[];this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL},fillBuffer:function(){for(var a=0,b=this.tokenSource.nextToken(),c,d;org.antlr.lang.isValue(b)&&b.getType()!=org.antlr.runtime.CharStream.EOF;)c=!1,this.channelOverrideMap&&(d=this.channelOverrideMap[b.getType()],org.antlr.lang.isValue(d)&&b.setChannel(d)),this.discardSet&&this.discardSet[b.getType()]?c=!0:this.v_discardOffChannelTokens&&
b.getChannel()!=this.channel&&(c=!0),c||(b.setTokenIndex(a),this.tokens.push(b),a++),b=this.tokenSource.nextToken();this.p=0;this.p=this.skipOffTokenChannels(this.p)},consume:function(){this.p<this.tokens.length&&(this.p++,this.p=this.skipOffTokenChannels(this.p))},skipOffTokenChannels:function(a){for(var b=this.tokens.length;a<b&&this.tokens[a].getChannel()!=this.channel;)a++;return a},skipOffTokenChannelsReverse:function(a){for(;0<=a&&this.tokens[a].getChannel()!=this.channel;)a--;return a},setTokenTypeChannel:function(a,
b){this.channelOverrideMap||(this.channelOverrideMap={});this.channelOverrideMap[a]=b},discardTokenType:function(a){this.discardSet||(this.discardSet={});this.discardSet[a]=!0},discardOffChannelTokens:function(a){this.v_discardOffChannelTokens=a},getTokens:function(a,b,c){-1===this.p&&this.fillBuffer();if(0===arguments.length)return this.tokens;org.antlr.lang.isArray(c)?c=new org.antlr.runtime.BitSet(c):org.antlr.lang.isNumber(c)&&(c=org.antlr.runtime.BitSet.of(c));b>=this.tokens.length&&(b=this.tokens.length-
1);0>a&&(a=0);if(a>b)return null;var d=[],e,f;for(e=a;e<=b;e++)f=this.tokens[e],this.types&&!c.member(f.getType())||d.push(f);0===d.length&&(d=null);return d},LT:function(a){-1===this.p&&this.fillBuffer();if(0===a)return null;if(0>a)return this.LB(-1*a);if(this.p+a-1>=this.tokens.length)return org.antlr.runtime.Token.EOF_TOKEN;for(var b=this.p,c=1;c<a;)b=this.skipOffTokenChannels(b+1),c++;return b>=this.tokens.length?org.antlr.runtime.Token.EOF_TOKEN:this.tokens[b]},LB:function(a){-1===this.p&&this.fillBuffer();
if(0===a||0>this.p-a)return null;for(var b=this.p,c=1;c<=a;)b=this.skipOffTokenChannelsReverse(b-1),c++;return 0>b?null:this.tokens[b]},get:function(a){return this.tokens[a]},LA:function(a){return this.LT(a).getType()},mark:function(){-1===this.p&&this.fillBuffer();return this.lastMarker=this.index()},release:function(a){},size:function(){return this.tokens.length},index:function(){return this.p},rewind:function(a){org.antlr.lang.isNumber(a)||(a=this.lastMarker);this.seek(a)},reset:function(){this.p=
-1;this.lastMarker=0},seek:function(a){this.p=a},getTokenSource:function(){return this.tokenSource},getSourceName:function(){return this.getTokenSource().getSourceName()},toString:function(a,b){0===arguments.length&&(-1===this.p&&this.fillBuffer(),a=0,b=this.tokens.length-1);if(!org.antlr.lang.isNumber(a)&&!org.antlr.lang.isNumber(b))if(org.antlr.lang.isValue(a)&&org.antlr.lang.isValue(b))a=a.getTokenIndex(),b=b.getTokenIndex();else return null;var c="",d;if(0>a||0>b)return null;-1==this.p&&this.fillBuffer();
b>=this.tokens.length&&(b=this.tokens.length-1);for(d=a;d<=b;d++)t=this.tokens[d],c+=this.tokens[d].getText();return c}};org.antlr.runtime.TokenRewriteStream=function(){var a=org.antlr.runtime.TokenRewriteStream.superclass;this.lastRewriteTokenIndexes=this.programs=null;0!==arguments.length&&a.constructor.apply(this,arguments);this.init()};
(function(){var a=org.antlr.runtime.TokenRewriteStream;org.antlr.lang.augmentObject(a,{DEFAULT_PROGRAM_NAME:"default",PROGRAM_INIT_SIZE:100,MIN_TOKEN_INDEX:0});a.RewriteOperation=function(a,c){this.index=a;this.text=c};a.RewriteOperation.prototype={execute:function(a){return this.index},toString:function(){return this.text}};a.InsertBeforeOp=function(b,c){a.InsertBeforeOp.superclass.constructor.call(this,b,c)};org.antlr.lang.extend(a.InsertBeforeOp,a.RewriteOperation,{execute:function(a){a.push(this.text);
return this.index}});a.ReplaceOp=function(b,c,d){a.ReplaceOp.superclass.constructor.call(this,b,d);this.lastIndex=c};org.antlr.lang.extend(a.ReplaceOp,a.RewriteOperation,{execute:function(a){org.antlr.lang.isValue(this.text)&&a.push(this.text);return this.lastIndex+1}});a.DeleteOp=function(b,c){a.DeleteOp.superclass.constructor.call(this,b,c)};org.antlr.lang.extend(a.DeleteOp,a.ReplaceOp);org.antlr.lang.extend(a,org.antlr.runtime.CommonTokenStream,{init:function(){this.programs={};this.programs[a.DEFAULT_PROGRAM_NAME]=
[];this.lastRewriteTokenIndexes={}},rollback:function(){var b;1===arguments.length?b=a.DEFAULT_PROGRAM_NAME:2===arguments.length&&(b=arguments[0]);var c=this.programs[b];c&&(programs[b]=c.slice(a.MIN_TOKEN_INDEX,this.instructionIndex))},deleteProgram:function(b){b=b||a.DEFAULT_PROGRAM_NAME;this.rollback(b,a.MIN_TOKEN_INDEX)},addToSortedRewriteList:function(){var b,c;1===arguments.length?(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0]):2===arguments.length&&(b=arguments[0],c=arguments[1]);b=this.getProgram(b);
var d,e,f,g,k;e=0;for(d=b.length;e<d;e++)if(f=b[e],f.index===c.index){if(c instanceof a.ReplaceOp){f=!1;for(k=e;k<b.length;k++){g=b[e];if(g.index!==c.index)break;if(g instanceof a.ReplaceOp){b[e]=c;f=!0;break}}f||b.splice(k,0,c)}else b.splice(e,0,c);break}else if(f.index>c.index){b.splice(e,0,c);break}e===d&&b.push(c)},insertAfter:function(){var b,c,d;2===arguments.length?(c=a.DEFAULT_PROGRAM_NAME,b=arguments[0],d=arguments[1]):3===arguments.length&&(c=arguments[0],b=arguments[1],d=arguments[2]);
b instanceof org.antlr.runtime.CommonToken&&(b=b.index);this.insertBefore(c,b+1,d)},insertBefore:function(){var b,c,d;2===arguments.length?(c=a.DEFAULT_PROGRAM_NAME,b=arguments[0],d=arguments[1]):3===arguments.length&&(c=arguments[0],b=arguments[1],d=arguments[2]);b instanceof org.antlr.runtime.CommonToken&&(b=b.index);this.addToSortedRewriteList(c,new a.InsertBeforeOp(b,d))},replace:function(){var b,c,d,e;2===arguments.length?(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0],d=arguments[0],e=arguments[1]):
3===arguments.length&&(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0],d=arguments[1],e=arguments[2]);4===arguments.length&&(b=arguments[0],c=arguments[1],d=arguments[2],e=arguments[3]);c instanceof org.antlr.runtime.CommonToken&&(c=c.index);d instanceof org.antlr.runtime.CommonToken&&(d=d.index);c>d||0>d||0>c||this.addToSortedRewriteList(b,new a.ReplaceOp(c,d,e))},remove:function(){for(var a=[],c=arguments.length-1;0<=c;)a[c]=arguments[c],c--;a.push("");this.replace.apply(this,a)},getLastRewriteTokenIndex:function(b){b=
b||a.DEFAULT_PROGRAM_NAME;return this.lastRewriteTokenIndexes[b]||-1},setLastRewriteTokenIndex:function(a,c){this.lastRewriteTokenIndexes[a]=c},getProgram:function(a){var c=this.programs[a];c||(c=this.initializeProgram(a));return c},initializeProgram:function(a){var c=[];return this.programs[a]=c},toOriginalString:function(b,c){org.antlr.lang.isNumber(b)||(b=a.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(c)||(c=this.size()-1);var d=[],e;for(e=b;e>=a.MIN_TOKEN_INDEX&&e<=c&&e<this.tokens.length;e++)d.push(this.get(e).getText());
return d.join("")},toString:function(){var b,c,d;0===arguments.length?(b=a.DEFAULT_PROGRAM_NAME,c=a.MIN_TOKEN_INDEX,d=this.size()-1):1===arguments.length?(b=arguments[0],c=a.MIN_TOKEN_INDEX,d=this.size()-1):2===arguments.length&&(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0],d=arguments[1]);b=this.programs[b];if(!b||0===b.length)return this.toOriginalString(c,d);var e=0,f=c;c=[];for(var g;f>=a.MIN_TOKEN_INDEX&&f<=d&&f<this.tokens.length;){if(e<b.length){for(g=b[e];g.index<f&&e<b.length;)e++,e<b.length&&
(g=b[e]);for(;f===g.index&&e<b.length;)f=g.execute(c),e++,e<b.length&&(g=b[e])}f<=d&&(c.push(this.get(f).getText()),f++)}for(d=e;d<b.length;d++)g=b[d],g.index>=this.size()&&g.execute(c);return c.join("")},toDebugString:function(b,c){org.antlr.lang.isNumber(b)||(b=a.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(c)||(c=this.size()-1);var d=[],e;for(e=b;e>=a.MIN_TOKEN_INDEX&&e<=c&&e<this.tokens.length;e++)d.push(this.get(e));return d.join("")}})})();org.antlr.runtime.tree.TreeNodeStream=function(){};
org.antlr.runtime.tree.CommonTreeNodeStream=function(a,b,c){1===arguments.length&&(b=a,a=new org.antlr.runtime.tree.CommonTreeAdaptor);2>=arguments.length&&(c=org.antlr.runtime.tree.CommonTreeNodeStream.DEFAULT_INITIAL_BUFFER_SIZE);this.uniqueNavigationNodes=!1;this.p=-1;var d=org.antlr.runtime.Token;this.root=b;this.adaptor=a;this.nodes=[];this.down=this.adaptor.create(d.DOWN,"DOWN");this.up=this.adaptor.create(d.UP,"UP");this.eof=this.adaptor.create(d.EOF,"EOF")};
org.antlr.lang.augmentObject(org.antlr.runtime.tree.CommonTreeNodeStream,{DEFAULT_INITIAL_BUFFER_SIZE:100,INITIAL_CALL_STACK_SIZE:10});
org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeNodeStream,org.antlr.runtime.tree.TreeNodeStream,{StreamIterator:function(){var a=0,b=this.nodes,c=this.eof;return{hasNext:function(){return a<b.length},next:function(){var d=a;a++;return d<b.length?b[d]:c},remove:function(){throw Error("cannot remove nodes from stream");}}},fillBuffer:function(a){var b=!1;org.antlr.lang.isUndefined(a)&&(a=this.root,b=!0);var c=this.adaptor.isNil(a);c||this.nodes.push(a);var d=this.adaptor.getChildCount(a);!c&&
0<d&&this.addNavigationNode(org.antlr.runtime.Token.DOWN);var e,f;for(e=0;e<d;e++)f=this.adaptor.getChild(a,e),this.fillBuffer(f);!c&&0<d&&this.addNavigationNode(org.antlr.runtime.Token.UP);b&&(this.p=0)},getNodeIndex:function(a){-1==this.p&&this.fillBuffer();var b,c;for(b=0;b<this.nodes.length;b++)if(c=this.nodes[b],c===a)return b;return-1},addNavigationNode:function(a){var b=null,b=a===org.antlr.runtime.Token.DOWN?this.hasUniqueNavigationNodes()?this.adaptor.create(org.antlr.runtime.Token.DOWN,
"DOWN"):this.down:this.hasUniqueNavigationNodes()?this.adaptor.create(org.antlr.runtime.Token.UP,"UP"):this.up;this.nodes.push(b)},get:function(a){-1===this.p&&this.fillBuffer();return this.nodes[a]},LT:function(a){-1===this.p&&this.fillBuffer();return 0===a?null:0>a?this.LB(-1*a):this.p+a-1>=this.nodes.length?this.eof:this.nodes[this.p+a-1]},getCurrentSymbol:function(){return this.LT(1)},LB:function(a){return 0===a||0>this.p-a?null:this.nodes[this.p-a]},getTreeSource:function(){return this.root},
getSourceName:function(){return this.getTokenStream().getSourceName()},getTokenStream:function(){return this.tokens},setTokenStream:function(a){this.tokens=a},getTreeAdaptor:function(){return this.adaptor},setTreeAdaptor:function(a){this.adaptor=a},hasUniqueNavigationNodes:function(){return this.uniqueNavigationNodes},setUniqueNavigationNodes:function(a){this.uniqueNavigationNodes=a},consume:function(){-1===this.p&&this.fillBuffer();this.p++},LA:function(a){return this.adaptor.getType(this.LT(a))},
mark:function(){-1===this.p&&this.fillBuffer();return this.lastMarker=this.index()},release:function(a){},index:function(){return this.p},rewind:function(a){org.antlr.lang.isNumber(a)||(a=this.lastMarker);this.seek(a)},seek:function(a){-1===this.p&&this.fillBuffer();this.p=a},push:function(a){this.calls||(this.calls=[]);this.calls.push(this.p);this.seek(a)},pop:function(){var a=this.calls.pop();this.seek(a);return a},reset:function(){this.p=-1;this.lastMarker=0;this.calls&&(this.calls=[])},size:function(){-1===
this.p&&this.fillBuffer();return this.nodes.length},iterator:function(){-1===this.p&&this.fillBuffer();return this.StreamIterator()},replaceChildren:function(a,b,c,d){a&&this.adaptor.replaceChildren(a,b,c,d)},toTokenString:function(a,b){-1===this.p&&this.fillBuffer();var c="",d,e;for(d=a;d<this.nodes.length&&d<=b;d++)e=this.nodes[d],c+=" "+this.adaptor.getToken(e);return c},toString:function(a,b){var c="",d,e,f;if(0===arguments.length)for(-1===this.p&&this.fillBuffer(),f=0;f<this.nodes.length;f++)e=
this.nodes[f],c+=" ",c+=this.adaptor.getType(e);else{if(!org.antlr.lang.isNumber(a)||!org.antlr.lang.isNumber(b))return null;-1===this.p&&this.fillBuffer();if(this.tokens)return c=this.adaptor.getTokenStartIndex(a),d=this.adaptor.getTokenStopIndex(b),this.adaptor.getType(b)===org.antlr.runtime.Token.UP?d=this.adaptor.getTokenStopIndex(a):this.adaptor.getType(b)==org.antlr.runtime.Token.EOF&&(d=this.size()-2),this.tokens.toString(c,d);for(f=0;f<this.nodes.length&&(e=this.nodes[f],e!==a);f++);c="";
for(e=this.nodes[f];e!==b;)d=this.adaptor.getText(e),org.antlr.lang.isString(d)||(d=" "+this.adaptor.getType(e).toString()),c+=d,f++,e=nodes[f];d=this.adaptor.getText(b);org.antlr.lang.isString(d)||(d=" "+this.adaptor.getType(b).toString());c+=d}return c}});org.antlr.runtime.tree.RewriteRuleElementStream=function(a,b,c){this.cursor=0;this.dirty=!1;this.elementDescription=b;this.adaptor=a;c&&(org.antlr.lang.isArray(c)?(this.singleElement=null,this.elements=c):this.add(c))};
org.antlr.runtime.tree.RewriteRuleElementStream.prototype={reset:function(){this.cursor=0;this.dirty=!0},add:function(a){org.antlr.lang.isValue(a)&&(this.elements?this.elements.push(a):org.antlr.lang.isValue(this.singleElement)?(this.elements=[],this.elements.push(this.singleElement),this.singleElement=null,this.elements.push(a)):this.singleElement=a)},nextTree:function(){var a=this.size();return this.dirty||this.cursor>=a&&1==a?(a=this._next(),this.dup(a)):a=this._next()},_next:function(){var a=
this.size();if(0===a)throw new org.antlr.runtime.tree.RewriteEmptyStreamException(this.elementDescription);if(this.cursor>=a){if(1===a)return this.toTree(this.singleElement);throw new org.antlr.runtime.tree.RewriteCardinalityException(this.elementDescription);}if(org.antlr.lang.isValue(this.singleElement))return this.cursor++,this.toTree(this.singleElement);a=this.toTree(this.elements[this.cursor]);this.cursor++;return a},toTree:function(a){return a&&a.getTree?a.getTree():a},hasNext:function(){return org.antlr.lang.isValue(this.singleElement)&&
1>this.cursor||this.elements&&this.cursor<this.elements.length},size:function(){var a=0;org.antlr.lang.isValue(this.singleElement)&&(a=1);return this.elements?this.elements.length:a},getDescription:function(){return this.elementDescription}};org.antlr.runtime.tree.RewriteRuleNodeStream=function(a,b,c){org.antlr.runtime.tree.RewriteRuleNodeStream.superclass.constructor.apply(this,arguments)};
org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleNodeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){return this._next()},toTree:function(a){return this.adaptor.dupNode(a)},dup:function(){throw Error("dup can't be called for a node stream.");}});org.antlr.runtime.tree.RewriteRuleTokenStream=function(a,b,c){org.antlr.runtime.tree.RewriteRuleTokenStream.superclass.constructor.apply(this,arguments)};
org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleTokenStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var a=this._next();return this.adaptor.create(a)},nextToken:function(){return this._next()},toTree:function(a){return a},dup:function(a){throw Error("dup can't be called for a token stream.");}});org.antlr.runtime.tree.RewriteRuleSubtreeStream=function(){org.antlr.runtime.tree.RewriteRuleSubtreeStream.superclass.constructor.apply(this,arguments)};
org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleSubtreeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var a=this.size();return this.dirty||this.cursor>=a&&1===a?(a=this._next(),this.adaptor.dupNode(a)):a=this._next()},dup:function(a){return this.adaptor.dupTree(a)}});org.antlr.runtime.BaseRecognizer=function(a){this.state=a||new org.antlr.runtime.RecognizerSharedState};
org.antlr.lang.augmentObject(org.antlr.runtime.BaseRecognizer,{MEMO_RULE_FAILED:-2,MEMO_RULE_UNKNOWN:-1,INITIAL_FOLLOW_STACK_SIZE:100,MEMO_RULE_FAILED_I:-2,DEFAULT_TOKEN_CHANNEL:org.antlr.runtime.Token.DEFAULT_CHANNEL,HIDDEN:org.antlr.runtime.Token.HIDDEN_CHANNEL,NEXT_TOKEN_RULE_NAME:"nextToken"});
org.antlr.runtime.BaseRecognizer.prototype={reset:function(){var a,b;if(this.state&&(this.state._fsp=-1,this.state.errorRecovery=!1,this.state.lastErrorIndex=-1,this.state.failed=!1,this.state.syntaxErrors=0,this.state.backtracking=0,this.state.ruleMemo))for(a=0,b=this.state.ruleMemo.length;a<b;a++)this.state.ruleMemo[a]=null},match:function(a,b,c){var d=this.getCurrentInputSymbol(a);return a.LA(1)===b?(a.consume(),this.state.errorRecovery=!1,this.state.failed=!1,d):0<this.state.backtracking?(this.state.failed=
!0,d):d=this.recoverFromMismatchedToken(a,b,c)},matchAny:function(a){this.state.errorRecovery=!1;this.state.failed=!1;a.consume()},mismatchIsUnwantedToken:function(a,b){return a.LA(2)===b},mismatchIsMissingToken:function(a,b){if(!b)return!1;b.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)&&(0<=this.state._fsp&&b.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE),this.computeContextSensitiveRuleFOLLOW(),b=b.or(this.viableTokensFollowingThisRule));return b.member(a.LA(1))||b.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)?
!0:!1},mismatch:function(a,b,c){if(this.mismatchIsUnwantedToken(a,b))throw new org.antlr.runtime.UnwantedTokenException(b,a);if(this.mismatchIsMissingToken(a,c))throw new org.antlr.runtime.MissingTokenException(b,a,null);throw new org.antlr.runtime.MismatchedTokenException(b,a);},reportError:function(a){this.state.errorRecovery||(this.state.syntaxErrors++,this.state.errorRecovery=!0,this.displayRecognitionError(this.getTokenNames(),a))},displayRecognitionError:function(a,b){var c=this.getErrorHeader(b),
d=this.getErrorMessage(b,a);this.emitErrorMessage(c+" "+d)},getErrorHeader:function(a){org.antlr.lang.isNumber(a.line)||(a.line=0);return"line "+a.line+":"+a.charPositionInLine},emitErrorMessage:function(a){if("undefined"!=typeof window&&window.alert)throw a;print(a)},getErrorMessage:function(a,b){var c=a&&a.getMessage?a.getMessage():null;a instanceof org.antlr.runtime.UnwantedTokenException?(c=a.expecting==org.antlr.runtime.Token.EOF?"EOF":b[a.expecting],c="extraneous input "+this.getTokenErrorDisplay(a.getUnexpectedToken())+
" expecting "+c):a instanceof org.antlr.runtime.MissingTokenException?(c=a,c=c.expecting==org.antlr.runtime.Token.EOF?"EOF":b[c.expecting],c="missing "+c+" at "+this.getTokenErrorDisplay(a.token)):a instanceof org.antlr.runtime.MismatchedTokenException?(c=a,c=c.expecting==org.antlr.runtime.Token.EOF?"EOF":b[c.expecting],c="mismatched input "+this.getTokenErrorDisplay(a.token)+" expecting "+c):a instanceof org.antlr.runtime.NoViableAltException?c="no viable alternative at input "+this.getTokenErrorDisplay(a.token):
a instanceof org.antlr.runtime.EarlyExitException?c="required (...)+ loop did not match anything at input "+this.getTokenErrorDisplay(a.token):a instanceof org.antlr.runtime.MismatchedSetException?c="mismatched input "+this.getTokenErrorDisplay(a.token)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.MismatchedNotSetException?c="mismatched input "+this.getTokenErrorDisplay(a.token)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.FailedPredicateException&&(c="rule "+a.ruleName+
" failed predicate: {"+a.predicateText+"}?");return c},getNumberOfSyntaxErrors:function(){return this.state.syntaxErrors},getTokenErrorDisplay:function(a){var b=a.getText();org.antlr.lang.isValue(b)||(b=a.getType()==org.antlr.runtime.Token.EOF?"<EOF>":"<"+a.getType()+">");b=b.replace(/\n/g,"\\n");b=b.replace(/\r/g,"\\r");b=b.replace(/\t/g,"\\t");return"'"+b+"'"},recover:function(a,b){this.state.lastErrorIndex==a.index()&&a.consume();this.state.lastErrorIndex=a.index();var c=this.computeErrorRecoverySet();
this.beginResync();this.consumeUntil(a,c);this.endResync()},beginResync:function(){},endResync:function(){},computeErrorRecoverySet:function(){return this.combineFollows(!1)},computeContextSensitiveRuleFOLLOW:function(){return this.combineFollows(!0)},combineFollows:function(a){for(var b=this.state._fsp,c,d=new org.antlr.runtime.BitSet;0<=b;b--)if(c=this.state.following[b],d.orInPlace(c),a)if(c.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))0<b&&d.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE);else break;
return d},recoverFromMismatchedToken:function(a,b,c){var d=null;if(this.mismatchIsUnwantedToken(a,b))return d=new org.antlr.runtime.UnwantedTokenException(b,a),this.beginResync(),a.consume(),this.endResync(),this.reportError(d),b=this.getCurrentInputSymbol(a),a.consume(),b;if(this.mismatchIsMissingToken(a,c))return c=this.getMissingSymbol(a,d,b,c),d=new org.antlr.runtime.MissingTokenException(b,a,c),this.reportError(d),c;d=new org.antlr.runtime.MismatchedTokenException(b,a);throw d;},recoverFromMismatchedSet:function(a,
b,c){if(this.mismatchIsMissingToken(a,c))return this.reportError(b),this.getMissingSymbol(a,b,org.antlr.runtime.Token.INVALID_TOKEN_TYPE,c);throw b;},getCurrentInputSymbol:function(a){return null},getMissingSymbol:function(a,b,c,d){return null},consumeUntil:function(a,b){for(var c=a.LA(1);c!=org.antlr.runtime.Token.EOF&&!b.member(c);)a.consume(),c=a.LA(1)},pushFollow:function(a){if(this.state._fsp+1>=this.state.following.length){var b=[],c;for(c=this.state.following.length-1;0<=c;c--)b[c]=this.state.following[c];
this.state.following=b}this.state._fsp++;this.state.following[this.state._fsp]=a},getRuleInvocationStack:function(a,b){throw Error("Not implemented.");},getBacktrackingLevel:function(){return this.state.backtracking},getTokenNames:function(){return null},getGrammarFileName:function(){return null},toStrings:function(a){if(!a)return null;var b=[],c;for(c=0;c<a.length;c++)b.push(a[c].getText());return b},getRuleMemoization:function(a,b){this.state.ruleMemo[a]||(this.state.ruleMemo[a]={});var c=this.state.ruleMemo[a][b];
return org.antlr.lang.isNumber(c)?c:org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN},alreadyParsedRule:function(a,b){var c=this.getRuleMemoization(b,a.index());if(c==org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN)return!1;c==org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED?this.state.failed=!0:a.seek(c+1);return!0},memoize:function(a,b,c){a=this.state.failed?org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED:a.index()-1;if(!org.antlr.lang.isValue(this.state.ruleMemo))throw Error("!!!!!!!!! memo array is null for "+
this.getGrammarFileName());if(b>=this.state.ruleMemo.length)throw Error("!!!!!!!!! memo size is "+this.state.ruleMemo.length+", but rule index is "+b);org.antlr.lang.isValue(this.state.ruleMemo[b])&&(this.state.ruleMemo[b][c]=a)},getRuleMemoizationCacheSize:function(){var a=0,b;for(b=0;this.state.ruleMemo&&b<this.state.ruleMemo.length;b++){var c=this.state.ruleMemo[b];c&&(a+=c.length)}return a},traceIn:function(a,b,c){this.emitErrorMessage("enter "+a+" "+c);this.state.failed&&this.emitErrorMessage(" failed="+
this.failed);0<this.state.backtracking&&this.emitErrorMessage(" backtracking="+this.state.backtracking)},traceOut:function(a,b,c){this.emitErrorMessage("exit "+a+" "+c);this.state.failed&&this.emitErrorMessage(" failed="+this.state.failed);0<this.state.backtracking&&this.emitErrorMessage(" backtracking="+this.state.backtracking)}};org.antlr.runtime.Lexer=function(a,b){b&&org.antlr.runtime.Lexer.superclass.constructor.call(this,b);a&&(this.input=a)};
org.antlr.lang.extend(org.antlr.runtime.Lexer,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Lexer.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0);org.antlr.lang.isValue(this.state)&&(this.state.token=null,this.state.type=org.antlr.runtime.Token.INVALID_TOKEN_TYPE,this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL,this.state.tokenStartCharIndex=-1,this.state.tokenStartCharPositionInLine=-1,this.state.tokenStartLine=-1,this.state.text=
null)},nextToken:function(){for(;;){this.state.token=null;this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.state.tokenStartCharIndex=this.input.index();this.state.tokenStartCharPositionInLine=this.input.getCharPositionInLine();this.state.tokenStartLine=this.input.getLine();this.state.text=null;if(this.input.LA(1)===org.antlr.runtime.CharStream.EOF)return org.antlr.runtime.Token.EOF_TOKEN;try{this.mTokens();if(!org.antlr.lang.isValue(this.state.token))this.emit();else if(this.state.token==
org.antlr.runtime.Token.SKIP_TOKEN)continue;return this.state.token}catch(a){if(a instanceof org.antlr.runtime.RecognitionException)this.reportError(a);else if(a instanceof org.antlr.runtime.NoViableAltException)this.reportError(a),this.recover(a);else throw a;}}},skip:function(){this.state.token=org.antlr.runtime.Token.SKIP_TOKEN},setCharStream:function(a){this.input=null;this.reset();this.input=a},getCharStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},
emit:function(){if(0===arguments.length){var a=new org.antlr.runtime.CommonToken(this.input,this.state.type,this.state.channel,this.state.tokenStartCharIndex,this.getCharIndex()-1);a.setLine(this.state.tokenStartLine);a.setText(this.state.text);a.setCharPositionInLine(this.state.tokenStartCharPositionInLine);return this.state.token=a}this.state.token=arguments[0]},match:function(a){var b=0;if(org.antlr.lang.isString(a))for(;b<a.length;){if(this.input.LA(1)!=a.charAt(b)){if(0<this.state.backtracking){this.state.failed=
!0;break}a=new org.antlr.runtime.MismatchedTokenException(a.charAt(b),this.input);this.recover(a);throw a;}b++;this.input.consume();this.state.failed=!1}else if(org.antlr.lang.isNumber(a)){if(this.input.LA(1)!=a){if(0<this.state.backtracking){this.state.failed=!0;return}a=new org.antlr.runtime.MismatchedTokenException(a,this.input);this.recover(a);throw a;}this.input.consume();this.state.failed=!1}},matchAny:function(){this.input.consume()},matchRange:function(a,b){if(this.input.LA(1)<a||this.input.LA(1)>
b){if(0<this.state.backtracking){this.state.failed=!0;return}mre=new org.antlr.runtime.MismatchedRangeException(a,b,this.input);this.recover(mre);throw mre;}this.input.consume();this.state.failed=!1},getLine:function(){return this.input.getLine()},getCharPositionInLine:function(){return this.input.getCharPositionInLine()},getCharIndex:function(){return this.input.index()},getText:function(){return org.antlr.lang.isString(this.state.text)?this.state.text:this.input.substring(this.state.tokenStartCharIndex,
this.getCharIndex()-1)},setText:function(a){this.state.text=a},reportError:function(a){this.displayRecognitionError(this.getTokenNames(),a)},getErrorMessage:function(a,b){var c=null;return c=a instanceof org.antlr.runtime.MismatchedTokenException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting "+this.getCharErrorDisplay(a.expecting):a instanceof org.antlr.runtime.NoViableAltException?"no viable alternative at character "+this.getCharErrorDisplay(a.c):a instanceof org.antlr.runtime.EarlyExitException?
"required (...)+ loop did not match anything at character "+this.getCharErrorDisplay(a.c):a instanceof org.antlr.runtime.MismatchedNotSetException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.MismatchedSetException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.MismatchedRangeException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting set "+this.getCharErrorDisplay(a.a)+
".."+this.getCharErrorDisplay(a.b):org.antlr.runtime.Lexer.superclass.getErrorMessage.call(this,a,b)},getCharErrorDisplay:function(a){switch(a){case org.antlr.runtime.Token.EOF:a="<EOF>";break;case "\n":a="\\n";break;case "\t":a="\\t";break;case "\r":a="\\r"}return"'"+a+"'"},recover:function(a){this.input.consume()},traceIn:function(a,b){var c=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceIn.call(this,a,b,c)},
traceOut:function(a,b){var c=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceOut.call(this,a,b,c)}});org.antlr.runtime.ParserRuleReturnScope=function(){};org.antlr.runtime.ParserRuleReturnScope.prototype={getStart:function(){return this.start},getStop:function(){return this.stop}};org.antlr.runtime.tree.TreeRuleReturnScope=function(){};org.antlr.runtime.tree.TreeRuleReturnScope.prototype={getStart:function(){return this.start}};
org.antlr.runtime.Parser=function(a,b){org.antlr.runtime.Parser.superclass.constructor.call(this,b);this.setTokenStream(a)};
org.antlr.lang.extend(org.antlr.runtime.Parser,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Parser.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0)},getCurrentInputSymbol:function(a){return a.LT(1)},getMissingSymbol:function(a,b,c,d){b="<missing "+this.getTokenNames()[c]+">";c=new org.antlr.runtime.CommonToken(c,b);b=a.LT(1);b.getType()===org.antlr.runtime.Token.EOF&&(d=b,(b=a.LT(-1))||(b=d));c.line=b.getLine();c.charPositionInLine=b.getCharPositionInLine();
c.channel=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;return c},setTokenStream:function(a){this.input=null;this.reset();this.input=a},getTokenStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},traceIn:function(a,b){org.antlr.runtime.Parser.superclass.traceIn.call(this,a,b,this.input.LT(1))},traceOut:function(a,b){org.antlr.runtime.Parser.superclass.traceOut.call(this,a,b,this.input.LT(1))}});org.antlr.runtime.DFA=function(){};
org.antlr.runtime.DFA.prototype={predict:function(a){var b=a.mark(),c=0,d,e,f;try{for(;;)if(d=this.special[c],0<=d){c=this.specialStateTransition(d,a);if(-1===c)return this.noViableAlt(c,a),0;a.consume()}else{if(1<=this.accept[c])return this.accept[c];e=a.LA(1);e===org.antlr.runtime.Token.EOF?e=-1:org.antlr.lang.isString(e)&&(e=e.charCodeAt(0));if(e>=this.min[c]&&e<=this.max[c]){f=this.transition[c][e-this.min[c]];if(0>f){if(0<=this.eot[c]){c=this.eot[c];a.consume();continue}this.noViableAlt(c,a);
return 0}c=f;a.consume()}else if(0<=this.eot[c])c=this.eot[c],a.consume();else{if(e==org.antlr.runtime.Token.EOF&&0<=this.eof[c])return this.accept[this.eof[c]];this.noViableAlt(c,a);return 0}}}finally{a.rewind(b)}},noViableAlt:function(a,b){if(0<this.recognizer.state.backtracking)this.recognizer.state.failed=!0;else{var c=new org.antlr.runtime.NoViableAltException(this.getDescription(),this.decisionNumber,a,b);this.error(c);throw c;}},error:function(a){},specialStateTransition:function(a,b){return-1},
getDescription:function(){return"n/a"}};org.antlr.lang.augmentObject(org.antlr.runtime.DFA,{unpackEncodedString:function(a){var b,c=[],d=0,e,f,g;for(b=0;b<a.length;b+=2)for(e=a.charCodeAt(b),f=a.charCodeAt(b+1),65535===f&&(f=-1),g=1;g<=e;g++)c[d++]=f;return c},unpackEncodedStringToUnsignedChars:function(a){return org.antlr.runtime.DFA.unpackEncodedString(a)}});org.antlr.runtime.tree.TreeParser=function(a,b){org.antlr.runtime.tree.TreeParser.superclass.constructor.call(this,b);this.setTreeNodeStream(a)};
(function(){var a=org.antlr.runtime.tree.TreeParser;org.antlr.lang.augmentObject(a,{DOWN:org.antlr.runtime.Token.DOWN,UP:org.antlr.runtime.Token.UP});org.antlr.lang.extend(a,org.antlr.runtime.BaseRecognizer,{reset:function(){a.superclass.reset.call(this);this.input&&this.input.seek(0)},setTreeNodeStream:function(a){this.input=a},getTreeNodeStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},getCurrentInputSymbol:function(a){return a.LT(1)},getMissingSymbol:function(a,
c,d,e){a="<missing "+this.getTokenNames()[d]+">";return new org.antlr.runtime.tree.CommonTree(new org.antlr.runtime.CommonToken(d,a))},matchAny:function(b){this.state.errorRecovery=!1;this.state.failed=!1;var c=this.input.LT(1);if(0!==this.input.getTreeAdaptor().getChildCount(c))for(b=0,c=this.input.getTreeAdaptor().getType(c);c!==org.antlr.runtime.Token.EOF&&(c!==a.UP||0!==b);)this.input.consume(),c=this.input.LT(1),c=this.input.getTreeAdaptor().getType(c),c===a.DOWN?b++:c===a.UP&&b--;this.input.consume()},
mismatch:function(a,c,d){throw new org.antlr.runtime.MismatchedTreeNodeException(c,a);},getErrorHeader:function(a){return this.getGrammarFileName()+": node from "+(a.approximateLineInfo?"after ":"")+"line "+a.line+":"+a.charPositionInLine},getErrorMessage:function(b,c){var d;this instanceof a&&(d=b.input.getTreeAdaptor(),b.token=d.getToken(b.node),org.antlr.lang.isValue(b.token)||(b.token=new org.antlr.runtime.CommonToken(d.getType(b.node),d.getText(b.node))));return a.superclass.getErrorMessage.call(this,
b,c)},traceIn:function(b,c){a.superclass.traceIn.call(this,b,c,this.input.LT(1))},traceOut:function(b,c){a.superclass.traceOut.call(this,b,c,this.input.LT(1))}})})();var FormulaLexer=function(a,b){b||(b=new org.antlr.runtime.RecognizerSharedState);this.dfa30=new FormulaLexer.DFA30(this);FormulaLexer.superclass.constructor.call(this,a,b)};
org.antlr.lang.augmentObject(FormulaLexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,
T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,
FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});
(function(){var a=org.antlr.runtime.Token.HIDDEN_CHANNEL;org.antlr.lang.extend(FormulaLexer,org.antlr.runtime.Lexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,
F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,
RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112,getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});org.antlr.lang.augmentObject(FormulaLexer.prototype,{mT__113:function(){var a=this.T__113,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("(");this.state.type=a;this.state.channel=c},mT__114:function(){var a=
this.T__114,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(")");this.state.type=a;this.state.channel=c},mT__115:function(){var a=this.T__115,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<-");this.state.type=a;this.state.channel=c},mT__116:function(){var a=this.T__116,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(".");this.state.type=a;this.state.channel=c},mNEWLINE:function(){var a=this.NEWLINE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,
d=2;"\r"==this.input.LA(1)&&(d=1);switch(d){case 1:this.match("\r")}this.match("\n");this.state.type=a;this.state.channel=c},mWHILESTATEMENT:function(){var a=this.WHILESTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mW();this.mH();this.mI();this.mL();this.mE();this.state.type=a;this.state.channel=c},mFORSTATEMENT:function(){var a=this.FORSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mO();this.mR();this.state.type=a;this.state.channel=c},
mFROMSTATEMENT:function(){var a=this.FROMSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mR();this.mO();this.mM();this.state.type=a;this.state.channel=c},mINSTATEMENT:function(){var a=this.INSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mN();this.state.type=a;this.state.channel=c},mTOSTATEMENT:function(){var a=this.TOSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mO();this.state.type=a;this.state.channel=
c},mBYSTATEMENT:function(){var a=this.BYSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mB();this.mY();this.state.type=a;this.state.channel=c},mLOOPSTATEMENT:function(){var a=this.LOOPSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mL();this.mO();this.mO();this.mP();this.state.type=a;this.state.channel=c},mIFSTATEMENT:function(){var a=this.IFSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mF();this.state.type=a;this.state.channel=
c},mTHENSTATEMENT:function(){var a=this.THENSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mH();this.mE();this.mN();this.state.type=a;this.state.channel=c},mELSESTATEMENT:function(){var a=this.ELSESTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mL();this.mS();this.mE();this.state.type=a;this.state.channel=c},mFUNCTIONSTATEMENT:function(){var a=this.FUNCTIONSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();
this.mU();this.mN();this.mC();this.mT();this.mI();this.mO();this.mN();this.state.type=a;this.state.channel=c},mENDBLOCK:function(){var a=this.ENDBLOCK,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mN();this.mD();this.state.type=a;this.state.channel=c},mRETURNSTATEMENT:function(){var a=this.RETURNSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mR();this.mE();this.mT();this.mU();this.mR();this.mN();this.state.type=a;this.state.channel=c},mNEWSTATEMENT:function(){var a=
this.NEWSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mN();this.mE();this.mW();this.state.type=a;this.state.channel=c},mTRYSTATEMENT:function(){var a=this.TRYSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mR();this.mY();this.state.type=a;this.state.channel=c},mCATCHSTATEMENT:function(){var a=this.CATCHSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC();this.mA();this.mT();this.mC();this.mH();this.state.type=a;this.state.channel=
c},mTHROWSTATEMENT:function(){var a=this.THROWSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mH();this.mR();this.mO();this.mW();this.state.type=a;this.state.channel=c},mOR:function(){var a=this.OR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("|"==d)d=1;else if("O"==d||"o"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",2,0,this.input);switch(d){case 1:this.match("||");break;case 2:this.mO(),this.mR()}this.state.type=
a;this.state.channel=c},mXOR:function(){var a=this.XOR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mX();this.mO();this.mR();this.state.type=a;this.state.channel=c},mAND:function(){var a=this.AND,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("&"==d)d=1;else if("A"==d||"a"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",3,0,this.input);switch(d){case 1:this.match("&&");break;case 2:this.mA(),this.mN(),this.mD()}this.state.type=a;
this.state.channel=c},mEQUALS:function(){var a=this.EQUALS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2;if("="==this.input.LA(1))d="="==this.input.LA(2)?2:1;else throw new org.antlr.runtime.NoViableAltException("",4,0,this.input);switch(d){case 1:this.match("=");break;case 2:this.match("==")}this.state.type=a;this.state.channel=c},mNOTEQUALS:function(){var a=this.NOTEQUALS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("!"==d)d=1;else if("<"==d)d=
2;else throw new org.antlr.runtime.NoViableAltException("",5,0,this.input);switch(d){case 1:this.match("!=");break;case 2:this.match("<>")}this.state.type=a;this.state.channel=c},mLT:function(){var a=this.LT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<");this.state.type=a;this.state.channel=c},mLTEQ:function(){var a=this.LTEQ,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<=");this.state.type=a;this.state.channel=c},mGT:function(){var a=this.GT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;
this.match(">");this.state.type=a;this.state.channel=c},mGTEQ:function(){var a=this.GTEQ,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">=");this.state.type=a;this.state.channel=c},mPLUS:function(){var a=this.PLUS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("+");this.state.type=a;this.state.channel=c},mMINUS:function(){var a=this.MINUS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("-");this.state.type=a;this.state.channel=c},mMULT:function(){var a=
this.MULT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("*");this.state.type=a;this.state.channel=c},mDIV:function(){var a=this.DIV,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/");this.state.type=a;this.state.channel=c},mMOD:function(){var a=this.MOD,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("%"==d)d=1;else if("M"==d||"m"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",6,0,this.input);switch(d){case 1:this.match("%");
break;case 2:this.mM(),this.mO(),this.mD()}this.state.type=a;this.state.channel=c},mPOW:function(){var a=this.POW,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("^");this.state.type=a;this.state.channel=c},mNOT:function(){var a=this.NOT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("!"==d)d=1;else if("N"==d||"n"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",7,0,this.input);switch(d){case 1:this.match("!");break;case 2:this.mN(),
this.mO(),this.mT()}this.state.type=a;this.state.channel=c},mLARR:function(){var a=this.LARR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("\u00ab"==d)d=1;else if("<"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",8,0,this.input);switch(d){case 1:this.match("\u00ab");break;case 2:this.match("<<")}this.state.type=a;this.state.channel=c},mRARR:function(){var a=this.RARR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);
if("\u00bb"==d)d=1;else if(">"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",9,0,this.input);switch(d){case 1:this.match("\u00bb");break;case 2:this.match(">>")}this.state.type=a;this.state.channel=c},mLCURL:function(){var a=this.LCURL,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("{");this.state.type=a;this.state.channel=c},mRCURL:function(){var a=this.RCURL,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("}");this.state.type=a;this.state.channel=
c},mINTEGER:function(){var a=this.INTEGER,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=0;a:do{var e=2,f=this.input.LA(1);"0"<=f&&"9">=f&&(e=1);switch(e){case 1:this.matchRange("0","9");break;default:if(1<=d)break a;throw new org.antlr.runtime.EarlyExitException(10,this.input);}d++}while(1);d=2;"e"==this.input.LA(1)&&(d=1);switch(d){case 1:this.match("e");d=2;e=this.input.LA(1);if("+"==e||"-"==e)d=1;switch(d){case 1:if("+"==this.input.LA(1)||"-"==this.input.LA(1))this.input.consume();
else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break}a:do switch(d=2,e=this.input.LA(1),"0"<=e&&"9">=e&&(d=1),d){case 1:this.matchRange("0","9");break;default:break a}while(1)}this.state.type=a;this.state.channel=c},mFLOAT:function(){var a=this.FLOAT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;a:do{var d=2,e=this.input.LA(1);"0"<=e&&"9">=e&&(d=1);switch(d){case 1:this.matchRange("0","9");break;default:break a}}while(1);this.match(".");d=0;
a:do{var e=2,f=this.input.LA(1);"0"<=f&&"9">=f&&(e=1);switch(e){case 1:this.matchRange("0","9");break;default:if(1<=d)break a;throw new org.antlr.runtime.EarlyExitException(15,this.input);}d++}while(1);d=2;"e"==this.input.LA(1)&&(d=1);switch(d){case 1:this.match("e");d=2;e=this.input.LA(1);if("+"==e||"-"==e)d=1;switch(d){case 1:if("+"==this.input.LA(1)||"-"==this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break}a:do switch(d=
2,e=this.input.LA(1),"0"<=e&&"9">=e&&(d=1),d){case 1:this.matchRange("0","9");break;default:break a}while(1)}this.state.type=a;this.state.channel=c},mTRUE:function(){var a=this.TRUE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mR();this.mU();this.mE();this.state.type=a;this.state.channel=c},mFALSE:function(){var a=this.FALSE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mA();this.mL();this.mS();this.mE();this.state.type=a;this.state.channel=c},
mPER:function(){var a=this.PER,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mP();this.mE();this.mR();this.state.type=a;this.state.channel=c},mSQUARED:function(){var a=this.SQUARED,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mS();this.mQ();this.mU();this.mA();this.mR();this.mE();this.mD();this.state.type=a;this.state.channel=c},mCUBED:function(){var a=this.CUBED,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC();this.mU();this.mB();this.mE();this.mD();
this.state.type=a;this.state.channel=c},mIDENT:function(){var a=this.IDENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;if("A"<=this.input.LA(1)&&"Z">=this.input.LA(1)||"a"<=this.input.LA(1)&&"z">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;a:do{var d=2,e=this.input.LA(1);if("0"<=e&&"9">=e||"A"<=e&&"Z">=e||"_"==e||"a"<=e&&"z">=e)d=1;switch(d){case 1:if("0"<=this.input.LA(1)&&"9">=this.input.LA(1)||"A"<=
this.input.LA(1)&&"Z">=this.input.LA(1)||"_"==this.input.LA(1)||"a"<=this.input.LA(1)&&"z">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break;default:break a}}while(1);this.state.type=a;this.state.channel=c},mPRIMITIVE:function(){var a=this.PRIMITIVE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2;if("["==this.input.LA(1))if(d=this.input.LA(2),"\x00"<=d&&"Z">=d||"\\"<=d&&"\uffff">=d)d=1;else if("["==
d)d=2;else throw a=new org.antlr.runtime.NoViableAltException("",22,1,this.input),a;else throw a=new org.antlr.runtime.NoViableAltException("",22,0,this.input),a;switch(d){case 1:this.mLBRACKET();if("\x00"<=this.input.LA(1)&&"Z">=this.input.LA(1)||"\\"<=this.input.LA(1)&&"\uffff">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;a:do{var d=2,e=this.input.LA(1);if("]"==e)d=2;else if("\x00"<=e&&"\\">=e||"^"<=e&&"\uffff">=
e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.mRBRACKET();break;case 2:this.mLBRACKET();this.mLBRACKET();a:do{d=2;e=this.input.LA(1);if("]"==e)d=2;else if("\x00"<=e&&"\\">=e||"^"<=e&&"\uffff">=e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.mRBRACKET();this.mRBRACKET()}this.state.type=a;this.state.channel=c},mLBRACKET:function(){var a=this.LBRACKET,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("[");this.state.type=a;this.state.channel=
c},mRBRACKET:function(){var a=this.RBRACKET,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("]");this.state.type=a;this.state.channel=c},mCOMMENT:function(){var b=this.COMMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/*");a:do{var c=2,d=this.input.LA(1);if("*"==d)if(d=this.input.LA(2),"/"==d)c=2;else{if("\x00"<=d&&".">=d||"0"<=d&&"\uffff">=d)c=1}else if("\x00"<=d&&")">=d||"+"<=d&&"\uffff">=d)c=1;switch(c){case 1:this.matchAny();break;default:break a}}while(1);
this.match("*/");c=a;this.state.type=b;this.state.channel=c},mLINE_COMMENT:function(){var b=this.LINE_COMMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,c=2,c=this.input.LA(1);if("/"==c)c=1;else if("#"==c)c=2;else throw new org.antlr.runtime.NoViableAltException("",24,0,this.input);switch(c){case 1:this.match("//");break;case 2:this.match("#");break}a:do{var c=2,d=this.input.LA(1);if("\x00"<=d&&"\t">=d||"\x0B"<=d&&"\f">=d||"\u000e"<=d&&"\uffff">=d)c=1;switch(c){case 1:if("\x00"<=this.input.LA(1)&&
"\t">=this.input.LA(1)||"\x0B"<=this.input.LA(1)&&"\f">=this.input.LA(1)||"\u000e"<=this.input.LA(1)&&"\uffff">=this.input.LA(1))this.input.consume();else throw b=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(b),b;break;default:break a}}while(1);c=a;this.state.type=b;this.state.channel=c},mCOLON:function(){var a=this.COLON,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(":");this.state.type=a;this.state.channel=c},mWS:function(){var b=this.WS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,
c=0;a:do{var d=2,e=this.input.LA(1);if("\t"==e||"\f"==e||" "==e)d=1;switch(d){case 1:if("\t"==this.input.LA(1)||"\f"==this.input.LA(1)||" "==this.input.LA(1))this.input.consume();else throw b=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(b),b;break;default:if(1<=c)break a;throw new org.antlr.runtime.EarlyExitException(26,this.input);}c++}while(1);c=a;this.state.type=b;this.state.channel=c},mA:function(){if("A"==this.input.LA(1)||"a"==this.input.LA(1))this.input.consume();
else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mB:function(){if("B"==this.input.LA(1)||"b"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mC:function(){if("C"==this.input.LA(1)||"c"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mD:function(){if("D"==this.input.LA(1)||
"d"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mE:function(){if("E"==this.input.LA(1)||"e"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mF:function(){if("F"==this.input.LA(1)||"f"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;
}},mG:function(){if("G"==this.input.LA(1)||"g"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mH:function(){if("H"==this.input.LA(1)||"h"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mI:function(){if("I"==this.input.LA(1)||"i"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mJ:function(){if("J"==this.input.LA(1)||"j"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mK:function(){if("K"==this.input.LA(1)||"k"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mL:function(){if("L"==this.input.LA(1)||"l"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mM:function(){if("M"==this.input.LA(1)||"m"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mN:function(){if("N"==this.input.LA(1)||"n"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mO:function(){if("O"==this.input.LA(1)||"o"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mP:function(){if("P"==this.input.LA(1)||"p"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mQ:function(){if("Q"==this.input.LA(1)||"q"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mR:function(){if("R"==this.input.LA(1)||"r"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mS:function(){if("S"==this.input.LA(1)||"s"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mT:function(){if("T"==this.input.LA(1)||"t"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mU:function(){if("U"==this.input.LA(1)||"u"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mV:function(){if("V"==this.input.LA(1)||"v"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mW:function(){if("W"==this.input.LA(1)||"w"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mX:function(){if("X"==this.input.LA(1)||"x"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mY:function(){if("Y"==this.input.LA(1)||"y"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mZ:function(){if("Z"==this.input.LA(1)||"z"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mCOMMA:function(){var a=this.COMMA,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(",");
this.state.type=a;this.state.channel=c},mSTRING:function(){var a=this.STRING,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("'"==d)d=1;else if('"'==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",29,0,this.input);switch(d){case 1:this.match("'");a:do{var d=2,e=this.input.LA(1);if("'"==e)d=2;else if("\x00"<=e&&"&">=e||"("<=e&&"\uffff">=e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.match("'");break;case 2:this.match('"');
a:do{d=3;e=this.input.LA(1);if("\\"==e)if(e=this.input.LA(2),'"'==e)d=this.input.LA(3),d="\x00"<=d&&"\uffff">=d?1:2;else{if("\x00"<=e&&"!">=e||"#"<=e&&"\uffff">=e)d=2}else if("\x00"<=e&&"!">=e||"#"<=e&&"[">=e||"]"<=e&&"\uffff">=e)d=2;switch(d){case 1:this.match('\\"');break;case 2:if("\x00"<=this.input.LA(1)&&"!">=this.input.LA(1)||"#"<=this.input.LA(1)&&"\uffff">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break;
default:break a}}while(1);this.match('"')}this.state.type=a;this.state.channel=c},mTokens:function(){var a=59,a=this.dfa30.predict(this.input);switch(a){case 1:this.mT__113();break;case 2:this.mT__114();break;case 3:this.mT__115();break;case 4:this.mT__116();break;case 5:this.mNEWLINE();break;case 6:this.mWHILESTATEMENT();break;case 7:this.mFORSTATEMENT();break;case 8:this.mFROMSTATEMENT();break;case 9:this.mINSTATEMENT();break;case 10:this.mTOSTATEMENT();break;case 11:this.mBYSTATEMENT();break;case 12:this.mLOOPSTATEMENT();
break;case 13:this.mIFSTATEMENT();break;case 14:this.mTHENSTATEMENT();break;case 15:this.mELSESTATEMENT();break;case 16:this.mFUNCTIONSTATEMENT();break;case 17:this.mENDBLOCK();break;case 18:this.mRETURNSTATEMENT();break;case 19:this.mNEWSTATEMENT();break;case 20:this.mTRYSTATEMENT();break;case 21:this.mCATCHSTATEMENT();break;case 22:this.mTHROWSTATEMENT();break;case 23:this.mOR();break;case 24:this.mXOR();break;case 25:this.mAND();break;case 26:this.mEQUALS();break;case 27:this.mNOTEQUALS();break;
case 28:this.mLT();break;case 29:this.mLTEQ();break;case 30:this.mGT();break;case 31:this.mGTEQ();break;case 32:this.mPLUS();break;case 33:this.mMINUS();break;case 34:this.mMULT();break;case 35:this.mDIV();break;case 36:this.mMOD();break;case 37:this.mPOW();break;case 38:this.mNOT();break;case 39:this.mLARR();break;case 40:this.mRARR();break;case 41:this.mLCURL();break;case 42:this.mRCURL();break;case 43:this.mINTEGER();break;case 44:this.mFLOAT();break;case 45:this.mTRUE();break;case 46:this.mFALSE();
break;case 47:this.mPER();break;case 48:this.mSQUARED();break;case 49:this.mCUBED();break;case 50:this.mIDENT();break;case 51:this.mPRIMITIVE();break;case 52:this.mLBRACKET();break;case 53:this.mRBRACKET();break;case 54:this.mCOMMENT();break;case 55:this.mLINE_COMMENT();break;case 56:this.mCOLON();break;case 57:this.mWS();break;case 58:this.mCOMMA();break;case 59:this.mSTRING()}}},!0);org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eotS:"\u0003\uffff\u00011\u00012\u0001\uffff\n&\u0001\uffff\u0002&\u0001\uffff\u0001&\u0001\uffff\u0001J\u0001L\u0003\uffff\u0001N\u0001\uffff\u0001&\u0005\uffff\u0001P\u0002&\u0001\uffff\u0001S\f\uffff\u0005&\u0001Z\u0001[\u0001\\\u0002&\u0001a\b&\u0001\u0010\u0002&\u0005\uffff\u0001&\u0001\uffff\u0002&\u0002\uffff\u0001&\u0001p\u0003&\u0003\uffff\u0002&\u0001v\u0001&\u0001\uffff\u0002&\u0001z\u0001&\u0001|\u0001J\u0002&\u0001\u007f\u0001\u0013\u0001\u001c\u0001\u0080\u0002&\u0001\uffff\u0001\u0083\u0002&\u0001\u0086\u0001&\u0001\uffff\u0001\u0088\u0001\u0089\u0001\u008a\u0001\uffff\u0001&\u0001\uffff\u0002&\u0002\uffff\u0001&\u0001\u008f\u0001\uffff\u0001&\u0001\u0091\u0001\uffff\u0001\u0092\u0003\uffff\u0001&\u0001\u0094\u0001\u0095\u0001&\u0001\uffff\u0001&\u0002\uffff\u0001\u0098\u0002\uffff\u0002&\u0001\uffff\u0001\u009b\u0001\u009c\u0002\uffff",
DFA30_eofS:"\u009d\uffff",DFA30_minS:"\u0001\t\u0002\uffff\u0001-\u00010\u0001\uffff\u0001H\u0001A\u0001F\u0001H\u0001Y\u0001O\u0001L\u0002E\u0001A\u0001\uffff\u0001R\u0001O\u0001\uffff\u0001N\u0001\uffff\u0002=\u0003\uffff\u0001*\u0001\uffff\u0001O\u0005\uffff\u0001.\u0001E\u0001Q\u0001\uffff\u0001\x00\f\uffff\u0001I\u0001R\u0001O\u0001N\u0001L\u00030\u0001E\u0001U\u00010\u0001O\u0001S\u0001D\u0001T\u0001W\u0002T\u0001B\u00010\u0001R\u0001D\u0005\uffff\u0001D\u0001\uffff\u0001R\u0001U\u0002\uffff\u0001L\u00010\u0001M\u0001C\u0001S\u0003\uffff\u0001N\u0001O\u00010\u0001E\u0001\uffff\u0001P\u0001E\u00010\u0001U\u00020\u0001C\u0001E\u00040\u0001A\u0001E\u0001\uffff\u00010\u0001T\u0001E\u00010\u0001W\u0001\uffff\u00030\u0001\uffff\u0001R\u0001\uffff\u0001H\u0001D\u0002\uffff\u0001R\u00010\u0001\uffff\u0001I\u00010\u0001\uffff\u00010\u0003\uffff\u0001N\u00020\u0001E\u0001\uffff\u0001O\u0002\uffff\u00010\u0002\uffff\u0001D\u0001N\u0001\uffff\u00020\u0002\uffff",
DFA30_maxS:"\u0001\u00bb\u0002\uffff\u0001>\u00019\u0001\uffff\u0001h\u0001u\u0001n\u0001r\u0001y\u0001o\u0001n\u0001e\u0001o\u0001u\u0001\uffff\u0001r\u0001o\u0001\uffff\u0001n\u0001\uffff\u0001=\u0001>\u0003\uffff\u0001/\u0001\uffff\u0001o\u0005\uffff\u00019\u0001e\u0001q\u0001\uffff\u0001\uffff\f\uffff\u0001i\u0001r\u0001o\u0001n\u0001l\u0003z\u0001r\u0001y\u0001z\u0001o\u0001s\u0001d\u0001t\u0001w\u0002t\u0001b\u0001z\u0001r\u0001d\u0005\uffff\u0001d\u0001\uffff\u0001r\u0001u\u0002\uffff\u0001l\u0001z\u0001m\u0001c\u0001s\u0003\uffff\u0001n\u0001o\u0001z\u0001e\u0001\uffff\u0001p\u0001e\u0001z\u0001u\u0002z\u0001c\u0001e\u0004z\u0001a\u0001e\u0001\uffff\u0001z\u0001t\u0001e\u0001z\u0001w\u0001\uffff\u0003z\u0001\uffff\u0001r\u0001\uffff\u0001h\u0001d\u0002\uffff\u0001r\u0001z\u0001\uffff\u0001i\u0001z\u0001\uffff\u0001z\u0003\uffff\u0001n\u0002z\u0001e\u0001\uffff\u0001o\u0002\uffff\u0001z\u0002\uffff\u0001d\u0001n\u0001\uffff\u0002z\u0002\uffff",
DFA30_acceptS:"\u0001\uffff\u0001\u0001\u0001\u0002\u0002\uffff\u0001\u0005\n\uffff\u0001\u0017\u0002\uffff\u0001\u0019\u0001\uffff\u0001\u001a\u0002\uffff\u0001 \u0001!\u0001\"\u0001\uffff\u0001$\u0001\uffff\u0001%\u0001'\u0001(\u0001)\u0001*\u0003\uffff\u00012\u0001\uffff\u00015\u00017\u00018\u00019\u0001:\u0001;\u0001\u0003\u0001\u001b\u0001\u001d\u0001\u001c\u0001\u0004\u0001,\u0016\uffff\u0001&\u0001\u001f\u0001\u001e\u00016\u0001#\u0001\uffff\u0001+\u0002\uffff\u00014\u00013\u0005\uffff\u0001\t\u0001\r\u0001\n\u0004\uffff\u0001\x0B\u000e\uffff\u0001\u0007\u0005\uffff\u0001\u0014\u0003\uffff\u0001\u0011\u0001\uffff\u0001\u0013\u0002\uffff\u0001\u0018\u0001/\u0002\uffff\u0001\b\u0002\uffff\u0001\u000e\u0001\uffff\u0001-\u0001\f\u0001\u000f\u0004\uffff\u0001\u0006\u0001\uffff\u0001.\u0001\u0016\u0001\uffff\u0001\u0015\u00011\u0002\uffff\u0001\u0012\u0002\uffff\u00010\u0001\u0010",
DFA30_specialS:"'\uffff\u0001\x00u\uffff}>",DFA30_transitionS:["\u0001+\u0001\u0005\u0001\uffff\u0001+\u0001\u0005\u0012\uffff\u0001+\u0001\u0016\u0001-\u0001)\u0001\uffff\u0001\u001c\u0001\u0013\u0001-\u0001\u0001\u0001\u0002\u0001\u001a\u0001\u0018\u0001,\u0001\u0019\u0001\u0004\u0001\u001b\n#\u0001*\u0001\uffff\u0001\u0003\u0001\u0015\u0001\u0017\u0002\uffff\u0001\u0014\u0001\n\u0001\u000f\u0001&\u0001\f\u0001\u0007\u0002&\u0001\b\u0002&\u0001\x0B\u0001\u001d\u0001\u000e\u0001\u0011\u0001$\u0001&\u0001\r\u0001%\u0001\t\u0002&\u0001\u0006\u0001\u0012\u0002&\u0001'\u0001\uffff\u0001(\u0001\u001e\u0002\uffff\u0001\u0014\u0001\n\u0001\u000f\u0001&\u0001\f\u0001\u0007\u0002&\u0001\b\u0002&\u0001\x0B\u0001\u001d\u0001\u000e\u0001\u0011\u0001$\u0001&\u0001\r\u0001%\u0001\t\u0002&\u0001\u0006\u0001\u0012\u0002&\u0001!\u0001\u0010\u0001\"-\uffff\u0001\u001f\u000f\uffff\u0001 ",
"","","\u0001.\u000e\uffff\u0001\u001f\u00010\u0001/","\n3","","\u00014\u001f\uffff\u00014","\u00018\r\uffff\u00015\u0002\uffff\u00016\u0002\uffff\u00017\x0B\uffff\u00018\r\uffff\u00015\u0002\uffff\u00016\u0002\uffff\u00017","\u0001:\u0007\uffff\u00019\u0017\uffff\u0001:\u0007\uffff\u00019","\u0001<\u0006\uffff\u0001;\u0002\uffff\u0001=\u0015\uffff\u0001<\u0006\uffff\u0001;\u0002\uffff\u0001=","\u0001>\u001f\uffff\u0001>","\u0001?\u001f\uffff\u0001?","\u0001@\u0001\uffff\u0001A\u001d\uffff\u0001@\u0001\uffff\u0001A",
"\u0001B\u001f\uffff\u0001B","\u0001C\t\uffff\u0001D\u0015\uffff\u0001C\t\uffff\u0001D","\u0001E\u0013\uffff\u0001F\x0B\uffff\u0001E\u0013\uffff\u0001F","","\u0001G\u001f\uffff\u0001G","\u0001H\u001f\uffff\u0001H","","\u0001I\u001f\uffff\u0001I","","\u0001/","\u0001K\u0001 ","","","","\u0001M\u0004\uffff\u0001)","","\u0001O\u001f\uffff\u0001O","","","","","","\u00013\u0001\uffff\n#","\u0001Q\u001f\uffff\u0001Q","\u0001R\u001f\uffff\u0001R","","\x00T","","","","","","","","","","","","","\u0001U\u001f\uffff\u0001U",
"\u0001V\u001f\uffff\u0001V","\u0001W\u001f\uffff\u0001W","\u0001X\u001f\uffff\u0001X","\u0001Y\u001f\uffff\u0001Y","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001]\f\uffff\u0001^\u0012\uffff\u0001]\f\uffff\u0001^","\u0001`\u0003\uffff\u0001_\u001b\uffff\u0001`\u0003\uffff\u0001_","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001b\u001f\uffff\u0001b",
"\u0001c\u001f\uffff\u0001c","\u0001d\u001f\uffff\u0001d","\u0001e\u001f\uffff\u0001e","\u0001f\u001f\uffff\u0001f","\u0001g\u001f\uffff\u0001g","\u0001h\u001f\uffff\u0001h","\u0001i\u001f\uffff\u0001i","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001j\u001f\uffff\u0001j","\u0001k\u001f\uffff\u0001k","","","","","","\u0001l\u001f\uffff\u0001l","","\u0001m\u001f\uffff\u0001m","\u0001n\u001f\uffff\u0001n","","","\u0001o\u001f\uffff\u0001o","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&",
"\u0001q\u001f\uffff\u0001q","\u0001r\u001f\uffff\u0001r","\u0001s\u001f\uffff\u0001s","","","","\u0001t\u001f\uffff\u0001t","\u0001u\u001f\uffff\u0001u","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001w\u001f\uffff\u0001w","","\u0001x\u001f\uffff\u0001x","\u0001y\u001f\uffff\u0001y","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001{\u001f\uffff\u0001{","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&",
"\u0001}\u001f\uffff\u0001}","\u0001~\u001f\uffff\u0001~","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001\u0081\u001f\uffff\u0001\u0081","\u0001\u0082\u001f\uffff\u0001\u0082","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001\u0084\u001f\uffff\u0001\u0084","\u0001\u0085\u001f\uffff\u0001\u0085",
"\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001\u0087\u001f\uffff\u0001\u0087","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","","\u0001\u008b\u001f\uffff\u0001\u008b","","\u0001\u008c\u001f\uffff\u0001\u008c","\u0001\u008d\u001f\uffff\u0001\u008d","","","\u0001\u008e\u001f\uffff\u0001\u008e","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&",
"","\u0001\u0090\u001f\uffff\u0001\u0090","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","","","","\u0001\u0093\u001f\uffff\u0001\u0093","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001\u0096\u001f\uffff\u0001\u0096","","\u0001\u0097\u001f\uffff\u0001\u0097","","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","","",
"\u0001\u0099\u001f\uffff\u0001\u0099","\u0001\u009a\u001f\uffff\u0001\u009a","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","",""]});org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eotS),DFA30_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eofS),DFA30_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_minS),
DFA30_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_maxS),DFA30_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_acceptS),DFA30_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_specialS),DFA30_transition:function(){var a=[],c,d=FormulaLexer.DFA30_transitionS.length;for(c=0;c<d;c++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_transitionS[c]));return a}()});FormulaLexer.DFA30=function(a){this.recognizer=
a;this.decisionNumber=30;this.eot=FormulaLexer.DFA30_eot;this.eof=FormulaLexer.DFA30_eof;this.min=FormulaLexer.DFA30_min;this.max=FormulaLexer.DFA30_max;this.accept=FormulaLexer.DFA30_accept;this.special=FormulaLexer.DFA30_special;this.transition=FormulaLexer.DFA30_transition};org.antlr.lang.extend(FormulaLexer.DFA30,org.antlr.runtime.DFA,{getDescription:function(){return"1:1: Tokens : ( T__113 | T__114 | T__115 | T__116 | NEWLINE | WHILESTATEMENT | FORSTATEMENT | FROMSTATEMENT | INSTATEMENT | TOSTATEMENT | BYSTATEMENT | LOOPSTATEMENT | IFSTATEMENT | THENSTATEMENT | ELSESTATEMENT | FUNCTIONSTATEMENT | ENDBLOCK | RETURNSTATEMENT | NEWSTATEMENT | TRYSTATEMENT | CATCHSTATEMENT | THROWSTATEMENT | OR | XOR | AND | EQUALS | NOTEQUALS | LT | LTEQ | GT | GTEQ | PLUS | MINUS | MULT | DIV | MOD | POW | NOT | LARR | RARR | LCURL | RCURL | INTEGER | FLOAT | TRUE | FALSE | PER | SQUARED | CUBED | IDENT | PRIMITIVE | LBRACKET | RBRACKET | COMMENT | LINE_COMMENT | COLON | WS | COMMA | STRING );"},
specialStateTransition:function(a,c){var d=function(a,b){switch(a){case 0:var c=b.LA(1);a="\x00"<=c&&"\uffff">=c?84:83;if(0<=a)return a}}.call(this.recognizer,a,c);if(!org.antlr.lang.isUndefined(d))return d;d=new org.antlr.runtime.NoViableAltException(this.getDescription(),30,a,c);this.error(d);throw d;},dummy:null})})();var FormulaParser=function(a,b){b||(b=new org.antlr.runtime.RecognizerSharedState);FormulaParser.superclass.constructor.call(this,a,b);this.dfa5=new FormulaParser.DFA5(this);this.dfa57=new FormulaParser.DFA57(this);this.dfa58=new FormulaParser.DFA58(this);this.dfa65=new FormulaParser.DFA65(this);this.dfa72=new FormulaParser.DFA72(this);this.dfa85=new FormulaParser.DFA85(this);this.adaptor=new org.antlr.runtime.tree.CommonTreeAdaptor};
org.antlr.lang.augmentObject(FormulaParser,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,
T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,
FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});
(function(){org.antlr.lang.extend(FormulaParser,org.antlr.runtime.Parser,{setTreeAdaptor:function(a){this.adaptor=a},getTreeAdaptor:function(){return this.adaptor},getTokenNames:function(){return FormulaParser.tokenNames},getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});org.antlr.lang.augmentObject(FormulaParser.prototype,{lines_return:function(){FormulaParser.lines_return=function(){};org.antlr.lang.extend(FormulaParser.lines_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),lines:function(){var a=new FormulaParser.lines_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EOF"),m=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{a:do{var n=2;32==this.input.LA(1)&&(n=1);switch(n){case 1:c=this.match(this.input,32,
FormulaParser.FOLLOW_NEWLINE_in_lines160);if(this.state.failed)return a;0===this.state.backtracking&&k.add(c);break;default:break a}}while(1);a:do{var c=2,p=this.input.LA(1);if(38==p||42==p||54==p||60==p||63<=p&&65>=p||68<=p&&69>=p||71==p||82==p||88<=p&&89>=p||91==p||94<=p&&98>=p||113==p)c=1;switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_lines164);g=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&m.add(g.getTree());var c=2,q=this.input.LA(1);
if(32==q)c=1;else if(-1==q)c=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",3,0,this.input);}switch(c){case 1:c=0;b:do{n=2;32==this.input.LA(1)&&(n=1);switch(n){case 1:d=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_lines168);if(this.state.failed)return a;0===this.state.backtracking&&k.add(d);break;default:if(1<=c)break b;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(2,
this.input);}c++}while(1);break;case 2:e=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines171);if(this.state.failed)return a;0===this.state.backtracking&&l.add(e)}break;default:break a}}while(1);f=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines176);if(this.state.failed)return a;0===this.state.backtracking&&l.add(f);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),
u=this.adaptor.nil(),u=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),u);m.hasNext();)this.adaptor.addChild(u,m.nextTree());m.reset();this.adaptor.addChild(b,u);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(v){if(v instanceof org.antlr.runtime.RecognitionException)this.reportError(v),this.recover(this.input,v),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),
v);else throw v;}finally{}return a},expression_return:function(){FormulaParser.expression_return=function(){};org.antlr.lang.extend(FormulaParser.expression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),expression:function(){var a=new FormulaParser.expression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=null;try{var q=10,q=this.dfa5.predict(this.input);switch(q){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_assignment_in_expression508);
c=this.assignment();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_expression514);d=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 3:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_whileLoop_in_expression520);e=this.whileLoop();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;case 4:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forLoop_in_expression526);f=this.forLoop();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());break;case 5:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_expression532);g=this.forInLoop();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,g.getTree());break;case 6:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_ifThenElse_in_expression538);k=this.ifThenElse();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,k.getTree());break;case 7:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_functionDef_in_expression544);l=this.functionDef();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,l.getTree());
break;case 8:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_returnExp_in_expression550);m=this.returnExp();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,m.getTree());break;case 9:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_tryCatch_in_expression556);n=this.tryCatch();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,n.getTree());break;case 10:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_throwExp_in_expression562);
p=this.throwExp();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,p.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(u){if(u instanceof org.antlr.runtime.RecognitionException)this.reportError(u),this.recover(this.input,u),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),u);else throw u;}finally{}return a},returnExp_return:function(){FormulaParser.returnExp_return=
function(){};org.antlr.lang.extend(FormulaParser.returnExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),returnExp:function(){var a=new FormulaParser.returnExp_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();c=this.match(this.input,63,FormulaParser.FOLLOW_RETURNSTATEMENT_in_returnExp574);if(this.state.failed)return a;0===this.state.backtracking&&(e=this.adaptor.create(c),b=this.adaptor.becomeRoot(e,b));this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_returnExp577);
d=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(f){if(f instanceof org.antlr.runtime.RecognitionException)this.reportError(f),this.recover(this.input,f),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),f);else throw f;}finally{}return a},
innerBlock_return:function(){FormulaParser.innerBlock_return=function(){};org.antlr.lang.extend(FormulaParser.innerBlock_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerBlock:function(){var a=new FormulaParser.innerBlock_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{a:do{var g=
2,k=this.input.LA(1);if(38==k||42==k||54==k||60==k||63<=k&&65>=k||68<=k&&69>=k||71==k||82==k||88<=k&&89>=k||91==k||94<=k&&98>=k||113==k)g=1;switch(g){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_innerBlock590);d=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&f.add(d.getTree());g=0;b:do{var l=2;32==this.input.LA(1)&&(l=1);switch(l){case 1:c=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_innerBlock594);if(this.state.failed)return a;
0===this.state.backtracking&&e.add(c);break;default:if(1<=g)break b;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(6,this.input);}g++}while(1);break;default:break a}}while(1);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),m=this.adaptor.nil(),m=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),m);if(!f.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;
for(;f.hasNext();)this.adaptor.addChild(m,f.nextTree());f.reset();this.adaptor.addChild(b,m);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(n){if(n instanceof org.antlr.runtime.RecognitionException)this.reportError(n),this.recover(this.input,n),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),n);else throw n;}finally{}return a},whileLoop_return:function(){FormulaParser.whileLoop_return=
function(){};org.antlr.lang.extend(FormulaParser.whileLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),whileLoop:function(){var a=new FormulaParser.whileLoop_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token LOOPSTATEMENT"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token WHILESTATEMENT"),q=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),u=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,38,FormulaParser.FOLLOW_WHILESTATEMENT_in_whileLoop619);if(this.state.failed)return a;0===this.state.backtracking&&p.add(c);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_whileLoop621);
g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&u.add(g.getTree());c=0;a:do{g=2;32==this.input.LA(1)&&(g=1);switch(g){case 1:d=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_whileLoop623);if(this.state.failed)return a;0===this.state.backtracking&&l.add(d);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(8,this.input);}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_whileLoop626);
k=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&q.add(k.getTree());e=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_whileLoop629);if(this.state.failed)return a;0===this.state.backtracking&&m.add(e);f=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_whileLoop631);if(this.state.failed)return a;0===this.state.backtracking&&n.add(f);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),v=this.adaptor.nil(),v=this.adaptor.becomeRoot(this.adaptor.create(15,"WHILE"),v);this.adaptor.addChild(v,u.nextTree());this.adaptor.addChild(v,q.nextTree());this.adaptor.addChild(b,v);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(y){if(y instanceof org.antlr.runtime.RecognitionException)this.reportError(y),this.recover(this.input,
y),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),y);else throw y;}finally{}return a},forLoop_return:function(){FormulaParser.forLoop_return=function(){};org.antlr.lang.extend(FormulaParser.forLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forLoop:function(){var a=new FormulaParser.forLoop_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=null,q=null,u=null,v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token FORSTATEMENT"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),z=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FROMSTATEMENT"),x=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TOSTATEMENT"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token LOOPSTATEMENT"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token BYSTATEMENT"),G=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),C=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,42,FormulaParser.FOLLOW_FORSTATEMENT_in_forLoop652);if(this.state.failed)return a;0===this.state.backtracking&&v.add(c);d=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_forLoop654);
if(this.state.failed)return a;0===this.state.backtracking&&y.add(d);e=this.match(this.input,44,FormulaParser.FOLLOW_FROMSTATEMENT_in_forLoop656);if(this.state.failed)return a;0===this.state.backtracking&&z.add(e);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop658);n=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&C.add(n.getTree());f=this.match(this.input,48,FormulaParser.FOLLOW_TOSTATEMENT_in_forLoop660);if(this.state.failed)return a;
0===this.state.backtracking&&B.add(f);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop662);p=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&C.add(p.getTree());c=2;51==this.input.LA(1)&&(c=1);switch(c){case 1:g=this.match(this.input,51,FormulaParser.FOLLOW_BYSTATEMENT_in_forLoop665);if(this.state.failed)return a;0===this.state.backtracking&&E.add(g);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop667);q=this.logicalExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&C.add(q.getTree())}g=0;a:do{q=2;32==this.input.LA(1)&&(q=1);switch(q){case 1:k=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_forLoop671);if(this.state.failed)return a;0===this.state.backtracking&&x.add(k);break;default:if(1<=g)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(10,this.input);}g++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forLoop674);
u=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&G.add(u.getTree());l=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_forLoop677);if(this.state.failed)return a;0===this.state.backtracking&&A.add(l);m=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forLoop679);if(this.state.failed)return a;0===this.state.backtracking&&D.add(m);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),F=this.adaptor.nil(),F=this.adaptor.becomeRoot(this.adaptor.create(18,"FOR"),F);this.adaptor.addChild(F,y.nextNode());for(var I=this.adaptor.nil(),I=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),I);C.hasNext();)this.adaptor.addChild(I,C.nextTree());C.reset();this.adaptor.addChild(F,I);this.adaptor.addChild(F,G.nextTree());this.adaptor.addChild(b,F);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(H){if(H instanceof org.antlr.runtime.RecognitionException)this.reportError(H),this.recover(this.input,H),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),H);else throw H;}finally{}return a},forInLoop_return:function(){FormulaParser.forInLoop_return=function(){};org.antlr.lang.extend(FormulaParser.forInLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forInLoop:function(){var a=
new FormulaParser.forInLoop_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),q=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token LOOPSTATEMENT"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INSTATEMENT"),z=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),x=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,42,FormulaParser.FOLLOW_FORSTATEMENT_in_forInLoop707);if(this.state.failed)return a;0===this.state.backtracking&&n.add(c);d=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_forInLoop709);
if(this.state.failed)return a;0===this.state.backtracking&&p.add(d);e=this.match(this.input,46,FormulaParser.FOLLOW_INSTATEMENT_in_forInLoop711);if(this.state.failed)return a;0===this.state.backtracking&&y.add(e);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forInLoop713);l=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&x.add(l.getTree());c=0;a:do{d=2;32==this.input.LA(1)&&(d=1);switch(d){case 1:f=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_forInLoop715);
if(this.state.failed)return a;0===this.state.backtracking&&q.add(f);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(11,this.input);}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forInLoop718);m=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&z.add(m.getTree());g=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_forInLoop721);if(this.state.failed)return a;
0===this.state.backtracking&&u.add(g);k=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forInLoop723);if(this.state.failed)return a;0===this.state.backtracking&&v.add(k);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),B=this.adaptor.nil(),B=this.adaptor.becomeRoot(this.adaptor.create(19,"FORIN"),B);this.adaptor.addChild(B,p.nextNode());this.adaptor.addChild(B,x.nextTree());
this.adaptor.addChild(B,z.nextTree());this.adaptor.addChild(b,B);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(A){if(A instanceof org.antlr.runtime.RecognitionException)this.reportError(A),this.recover(this.input,A),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),A);else throw A;}finally{}return a},ifThenElse_return:function(){FormulaParser.ifThenElse_return=
function(){};org.antlr.lang.extend(FormulaParser.ifThenElse_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),ifThenElse:function(){var a=new FormulaParser.ifThenElse_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=null,q=null,u=null,v=null,y=null,z=null,x=null,B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IFSTATEMENT"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token NEWLINE"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ELSESTATEMENT"),G=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THENSTATEMENT"),C=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),F=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,54,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse748);
if(this.state.failed)return a;0===this.state.backtracking&&B.add(c);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse750);u=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&F.add(u.getTree());d=this.match(this.input,55,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse752);if(this.state.failed)return a;0===this.state.backtracking&&G.add(d);c=0;a:do{d=2;32==this.input.LA(1)&&(d=1);switch(d){case 1:e=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse755);
if(this.state.failed)return a;0===this.state.backtracking&&A.add(e);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;var I=new org.antlr.runtime.EarlyExitException(12,this.input);throw I;}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse758);v=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&C.add(v.getTree());a:do switch(e=2,57==this.input.LA(1)&&54==this.input.LA(2)&&(e=1),e){case 1:f=
this.match(this.input,57,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse762);if(this.state.failed)return a;0===this.state.backtracking&&E.add(f);g=this.match(this.input,54,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse764);if(this.state.failed)return a;0===this.state.backtracking&&B.add(g);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse766);y=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&F.add(y.getTree());k=this.match(this.input,
55,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse768);if(this.state.failed)return a;0===this.state.backtracking&&G.add(k);e=0;b:do{v=2;32==this.input.LA(1)&&(v=1);switch(v){case 1:l=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse770);if(this.state.failed)return a;0===this.state.backtracking&&A.add(l);break;default:if(1<=e)break b;if(0<this.state.backtracking)return this.state.failed=!0,a;I=new org.antlr.runtime.EarlyExitException(13,this.input);throw I;}e++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse773);
z=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&C.add(z.getTree());break;default:break a}while(1);f=2;57==this.input.LA(1)&&(f=1);switch(f){case 1:m=this.match(this.input,57,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse778);if(this.state.failed)return a;0===this.state.backtracking&&E.add(m);m=0;a:do{E=2;32==this.input.LA(1)&&(E=1);switch(E){case 1:n=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse780);if(this.state.failed)return a;
0===this.state.backtracking&&A.add(n);break;default:if(1<=m)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;I=new org.antlr.runtime.EarlyExitException(15,this.input);throw I;}m++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse783);x=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&C.add(x.getTree())}p=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_ifThenElse787);if(this.state.failed)return a;0===this.state.backtracking&&
D.add(p);q=this.match(this.input,54,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse789);if(this.state.failed)return a;0===this.state.backtracking&&B.add(q);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),H=this.adaptor.nil(),H=this.adaptor.becomeRoot(this.adaptor.create(16,"IFTHENELSE"),H),P=this.adaptor.nil(),P=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),P);if(!F.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;
for(;F.hasNext();)this.adaptor.addChild(P,F.nextTree());F.reset();this.adaptor.addChild(H,P);P=this.adaptor.nil();P=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),P);if(!C.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;C.hasNext();)this.adaptor.addChild(P,C.nextTree());C.reset();this.adaptor.addChild(H,P);this.adaptor.addChild(b,H);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,
a.start,a.stop))}catch(J){if(J instanceof org.antlr.runtime.RecognitionException)this.reportError(J),this.recover(this.input,J),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),J);else throw J;}finally{}return a},functionDef_return:function(){FormulaParser.functionDef_return=function(){};org.antlr.lang.extend(FormulaParser.functionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),functionDef:function(){var a=new FormulaParser.functionDef_return;
a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=null,q=null,u=null,v=null,y=null,z=null,x=null,B=null,A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),G=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token 113"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),H=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),P=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),J=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{c=this.match(this.input,60,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef820);
if(this.state.failed)return a;0===this.state.backtracking&&A.add(c);d=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_functionDef822);if(this.state.failed)return a;0===this.state.backtracking&&E.add(d);e=this.match(this.input,113,FormulaParser.FOLLOW_113_in_functionDef824);if(this.state.failed)return a;0===this.state.backtracking&&C.add(e);c=2;69==this.input.LA(1)&&(c=1);switch(c){case 1:f=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_functionDef827);if(this.state.failed)return a;
0===this.state.backtracking&&E.add(f);var f=2,O=this.input.LA(1);if(70==O)f=1;else if(93==O||114==O)f=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",18,0,this.input);}switch(f){case 1:g=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_functionDef831);if(this.state.failed)return a;0===this.state.backtracking&&G.add(g);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef834);z=this.defaultValue();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&J.add(z.getTree());break;case 2:a:do{g=2;if(93==this.input.LA(1)&&69==this.input.LA(2)){var Q=this.input.LA(3);if(93==Q||114==Q)g=1}switch(g){case 1:k=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_functionDef839);if(this.state.failed)return a;0===this.state.backtracking&&I.add(k);l=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_functionDef841);if(this.state.failed)return a;0===this.state.backtracking&&E.add(l);break;default:break a}}while(1);
break}a:do switch(k=2,93==this.input.LA(1)&&(k=1),k){case 1:m=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_functionDef848);if(this.state.failed)return a;0===this.state.backtracking&&I.add(m);n=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_functionDef850);if(this.state.failed)return a;0===this.state.backtracking&&E.add(n);p=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_functionDef852);if(this.state.failed)return a;0===this.state.backtracking&&G.add(p);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef854);
x=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&J.add(x.getTree());break;default:break a}while(1)}q=this.match(this.input,114,FormulaParser.FOLLOW_114_in_functionDef861);if(this.state.failed)return a;0===this.state.backtracking&&D.add(q);m=0;a:do{n=2;32==this.input.LA(1)&&(n=1);switch(n){case 1:u=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_functionDef863);if(this.state.failed)return a;0===this.state.backtracking&&F.add(u);break;default:if(1<=
m)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(21,this.input);}m++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_functionDef866);B=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&P.add(B.getTree());v=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_functionDef869);if(this.state.failed)return a;0===this.state.backtracking&&H.add(v);y=this.match(this.input,60,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef871);
if(this.state.failed)return a;0===this.state.backtracking&&A.add(y);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),N=this.adaptor.nil(),N=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),N),M=this.adaptor.nil(),M=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),M);E.hasNext();)this.adaptor.addChild(M,E.nextNode());E.reset();this.adaptor.addChild(N,M);M=this.adaptor.nil();
for(M=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),M);J.hasNext();)this.adaptor.addChild(M,J.nextTree());J.reset();this.adaptor.addChild(N,M);this.adaptor.addChild(N,P.nextTree());this.adaptor.addChild(b,N);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(R){if(R instanceof org.antlr.runtime.RecognitionException)this.reportError(R),this.recover(this.input,R),a.tree=
this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),R);else throw R;}finally{}return a},tryCatch_return:function(){FormulaParser.tryCatch_return=function(){};org.antlr.lang.extend(FormulaParser.tryCatch_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),tryCatch:function(){var a=new FormulaParser.tryCatch_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token IDENT"),q=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TRYSTATEMENT"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CATCHSTATEMENT"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),z=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock");try{c=this.match(this.input,65,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch904);
if(this.state.failed)return a;0===this.state.backtracking&&q.add(c);c=0;a:do{var x=2;32==this.input.LA(1)&&(x=1);switch(x){case 1:d=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_tryCatch906);if(this.state.failed)return a;0===this.state.backtracking&&u.add(d);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;var B=new org.antlr.runtime.EarlyExitException(22,this.input);throw B;}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch909);
m=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&z.add(m.getTree());e=this.match(this.input,67,FormulaParser.FOLLOW_CATCHSTATEMENT_in_tryCatch911);if(this.state.failed)return a;0===this.state.backtracking&&v.add(e);f=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_tryCatch913);if(this.state.failed)return a;0===this.state.backtracking&&p.add(f);d=0;a:do{e=2;32==this.input.LA(1)&&(e=1);switch(e){case 1:g=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_tryCatch915);
if(this.state.failed)return a;0===this.state.backtracking&&u.add(g);break;default:if(1<=d)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;B=new org.antlr.runtime.EarlyExitException(23,this.input);throw B;}d++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch919);n=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&z.add(n.getTree());k=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_tryCatch921);if(this.state.failed)return a;
0===this.state.backtracking&&y.add(k);l=this.match(this.input,65,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch923);if(this.state.failed)return a;0===this.state.backtracking&&q.add(l);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),A=this.adaptor.nil(),A=this.adaptor.becomeRoot(this.adaptor.create(30,"TRYCATCH"),A);z.hasNext();)this.adaptor.addChild(A,z.nextTree());z.reset();this.adaptor.addChild(A,
p.nextNode());this.adaptor.addChild(b,A);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(D){if(D instanceof org.antlr.runtime.RecognitionException)this.reportError(D),this.recover(this.input,D),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),D);else throw D;}finally{}return a},throwExp_return:function(){FormulaParser.throwExp_return=function(){};org.antlr.lang.extend(FormulaParser.throwExp_return,
org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),throwExp:function(){var a=new FormulaParser.throwExp_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THROWSTATEMENT"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule primaryExpression");try{c=this.match(this.input,68,FormulaParser.FOLLOW_THROWSTATEMENT_in_throwExp945);if(this.state.failed)return a;0===this.state.backtracking&&
e.add(c);this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_throwExp947);d=this.primaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&f.add(d.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),g=this.adaptor.nil(),g=this.adaptor.becomeRoot(this.adaptor.create(31,"THROW"),g);this.adaptor.addChild(g,f.nextTree());this.adaptor.addChild(b,
g);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(k){if(k instanceof org.antlr.runtime.RecognitionException)this.reportError(k),this.recover(this.input,k),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),k);else throw k;}finally{}return a},anonFunctionDef_return:function(){FormulaParser.anonFunctionDef_return=function(){};org.antlr.lang.extend(FormulaParser.anonFunctionDef_return,
org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),anonFunctionDef:function(){var a=new FormulaParser.anonFunctionDef_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=null,q=null,u=null,v=null,y=null,z=null,x=null,B=null,A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token IDENT"),G=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),H=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),P=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression"),
J=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),O=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{c=this.match(this.input,60,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967);if(this.state.failed)return a;0===this.state.backtracking&&A.add(c);d=this.match(this.input,113,FormulaParser.FOLLOW_113_in_anonFunctionDef970);if(this.state.failed)return a;0===this.state.backtracking&&C.add(d);c=2;69==this.input.LA(1)&&
(c=1);switch(c){case 1:e=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef973);if(this.state.failed)return a;0===this.state.backtracking&&E.add(e);var e=2,Q=this.input.LA(1);if(70==Q)e=1;else if(93==Q||114==Q)e=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;var N=new org.antlr.runtime.NoViableAltException("",25,0,this.input);throw N;}switch(e){case 1:f=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef977);if(this.state.failed)return a;
0===this.state.backtracking&&G.add(f);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef980);y=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&O.add(y.getTree());break;case 2:a:do{f=2;if(93==this.input.LA(1)&&69==this.input.LA(2)){var M=this.input.LA(3);if(93==M||114==M)f=1}switch(f){case 1:g=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef985);if(this.state.failed)return a;0===this.state.backtracking&&I.add(g);
k=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef987);if(this.state.failed)return a;0===this.state.backtracking&&E.add(k);break;default:break a}}while(1);break}a:do switch(g=2,93==this.input.LA(1)&&(g=1),g){case 1:l=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef994);if(this.state.failed)return a;0===this.state.backtracking&&I.add(l);m=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef996);if(this.state.failed)return a;0===this.state.backtracking&&
E.add(m);n=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef998);if(this.state.failed)return a;0===this.state.backtracking&&G.add(n);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef1000);z=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&O.add(z.getTree());break;default:break a}while(1)}p=this.match(this.input,114,FormulaParser.FOLLOW_114_in_anonFunctionDef1007);if(this.state.failed)return a;0===this.state.backtracking&&
D.add(p);var l=2,R=this.input.LA(1);if(32==R)l=1;else if(38==R||42==R||54==R||60==R||63<=R&&65>=R||68<=R&&69>=R||71==R||82==R||88<=R&&89>=R||91==R||94<=R&&98>=R||113==R)l=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;N=new org.antlr.runtime.NoViableAltException("",29,0,this.input);throw N;}switch(l){case 1:B=0;a:do{N=2;32==this.input.LA(1)&&(N=1);switch(N){case 1:q=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_anonFunctionDef1012);if(this.state.failed)return a;0===this.state.backtracking&&
F.add(q);break;default:if(1<=B)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(28,this.input);}B++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_anonFunctionDef1015);x=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&J.add(x.getTree());u=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_anonFunctionDef1018);if(this.state.failed)return a;0===this.state.backtracking&&
H.add(u);v=this.match(this.input,60,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020);if(this.state.failed)return a;0===this.state.backtracking&&A.add(v);break;case 2:this.pushFollow(FormulaParser.FOLLOW_expression_in_anonFunctionDef1025);B=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&P.add(B.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:
null);for(var b=this.adaptor.nil(),U=this.adaptor.nil(),U=this.adaptor.becomeRoot(this.adaptor.create(21,"ANONFUNCTION"),U),S=this.adaptor.nil(),S=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),S);E.hasNext();)this.adaptor.addChild(S,E.nextNode());E.reset();this.adaptor.addChild(U,S);S=this.adaptor.nil();for(S=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),S);O.hasNext();)this.adaptor.addChild(S,O.nextTree());O.reset();this.adaptor.addChild(U,S);J.hasNext()&&this.adaptor.addChild(U,
J.nextTree());J.reset();P.hasNext()&&this.adaptor.addChild(U,P.nextTree());P.reset();this.adaptor.addChild(b,U);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(L){if(L instanceof org.antlr.runtime.RecognitionException)this.reportError(L),this.recover(this.input,L),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),L);else throw L;}finally{}return a},assignment_return:function(){FormulaParser.assignment_return=
function(){};org.antlr.lang.extend(FormulaParser.assignment_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assignment:function(){var a=new FormulaParser.assignment_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=null,q=null,u=null,v=null,y=null,z=null,x=null,B=null,A=null,D=null,E=null,G=null,C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token IDENT"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 115"),H=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),P=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),J=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),O=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token PRIMITIVE"),Q=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule assigned"),N=
new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue"),M=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var R=2,U=this.input.LA(1);if(69==U){var S=this.input.LA(2);if(113==S)R=1;else if(89==S||91==S||93==S||115<=S&&116>=S)R=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;var L=new org.antlr.runtime.NoViableAltException("",37,1,this.input);throw L;}}else if(71==U)R=2;else{if(0<this.state.backtracking)return this.state.failed=
!0,a;L=new org.antlr.runtime.NoViableAltException("",37,0,this.input);throw L;}switch(R){case 1:c=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assignment1067);if(this.state.failed)return a;0===this.state.backtracking&&F.add(c);d=this.match(this.input,113,FormulaParser.FOLLOW_113_in_assignment1069);if(this.state.failed)return a;0===this.state.backtracking&&P.add(d);v=2;69==this.input.LA(1)&&(v=1);switch(v){case 1:e=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assignment1072);if(this.state.failed)return a;
0===this.state.backtracking&&F.add(e);var v=2,pa=this.input.LA(1);if(70==pa)v=1;else if(93==pa||114==pa)v=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;L=new org.antlr.runtime.NoViableAltException("",31,0,this.input);throw L;}switch(v){case 1:f=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_assignment1076);if(this.state.failed)return a;0===this.state.backtracking&&H.add(f);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1078);x=this.defaultValue();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&N.add(x.getTree());break;case 2:a:do{L=2;if(93==this.input.LA(1)&&69==this.input.LA(2)){var sa=this.input.LA(3);if(93==sa||114==sa)L=1}switch(L){case 1:g=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_assignment1083);if(this.state.failed)return a;0===this.state.backtracking&&J.add(g);k=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assignment1085);if(this.state.failed)return a;0===this.state.backtracking&&F.add(k);break;default:break a}}while(1);
break}a:do switch(L=2,93==this.input.LA(1)&&(L=1),L){case 1:l=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_assignment1092);if(this.state.failed)return a;0===this.state.backtracking&&J.add(l);m=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assignment1094);if(this.state.failed)return a;0===this.state.backtracking&&F.add(m);n=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_assignment1096);if(this.state.failed)return a;0===this.state.backtracking&&H.add(n);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1098);
B=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&N.add(B.getTree());break;default:break a}while(1)}p=this.match(this.input,114,FormulaParser.FOLLOW_114_in_assignment1105);if(this.state.failed)return a;0===this.state.backtracking&&C.add(p);q=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1107);if(this.state.failed)return a;0===this.state.backtracking&&I.add(q);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1109);
A=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&M.add(A.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),ia=this.adaptor.nil(),ia=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),ia),oa=this.adaptor.nil(),oa=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),oa);F.hasNext();)this.adaptor.addChild(oa,
F.nextNode());F.reset();this.adaptor.addChild(ia,oa);oa=this.adaptor.nil();for(oa=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),oa);N.hasNext();)this.adaptor.addChild(oa,N.nextTree());N.reset();this.adaptor.addChild(ia,oa);this.adaptor.addChild(ia,M.nextTree());this.adaptor.addChild(b,ia);a.tree=b}break;case 2:var l=2,Z=this.input.LA(1);if(71==Z)l=1;else if(69==Z)l=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;L=new org.antlr.runtime.NoViableAltException("",34,0,this.input);
throw L;}switch(l){case 1:u=this.match(this.input,71,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1137);if(this.state.failed)return a;0===this.state.backtracking&&O.add(u);break;case 2:this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1141);D=this.assigned();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&Q.add(D.getTree());break}a:do switch(l=2,93==this.input.LA(1)&&(l=1),l){case 1:v=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_assignment1145);if(this.state.failed)return a;
0===this.state.backtracking&&J.add(v);var l=2,fa=this.input.LA(1);if(71==fa)l=1;else if(69==fa)l=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;L=new org.antlr.runtime.NoViableAltException("",35,0,this.input);throw L;}switch(l){case 1:y=this.match(this.input,71,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1148);if(this.state.failed)return a;0===this.state.backtracking&&O.add(y);break;case 2:this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1152);E=this.assigned();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&Q.add(E.getTree())}break;default:break a}while(1);z=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1158);if(this.state.failed)return a;0===this.state.backtracking&&I.add(z);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1160);G=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&M.add(G.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);b=this.adaptor.nil();ia=this.adaptor.nil();for(ia=this.adaptor.becomeRoot(this.adaptor.create(5,"ASSIGN"),ia);O.hasNext();)this.adaptor.addChild(ia,O.nextNode());for(O.reset();Q.hasNext();)this.adaptor.addChild(ia,Q.nextTree());Q.reset();this.adaptor.addChild(ia,M.nextTree());this.adaptor.addChild(b,ia);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(ja){if(ja instanceof
org.antlr.runtime.RecognitionException)this.reportError(ja),this.recover(this.input,ja),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),ja);else throw ja;}finally{}return a},assigned_return:function(){FormulaParser.assigned_return=function(){};org.antlr.lang.extend(FormulaParser.assigned_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assigned:function(){var a=new FormulaParser.assigned_return;a.start=this.input.LT(1);var b=null,c=null,
d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selector");try{c=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assigned1186);if(this.state.failed)return a;0===this.state.backtracking&&e.add(c);var c=2,g=this.input.LA(1);if(89==g||91==g||116==g)c=1;switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_assigned1188);d=this.selector();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&f.add(d.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),k=this.adaptor.nil(),k=this.adaptor.becomeRoot(this.adaptor.create(26,"ASSIGNED"),k);this.adaptor.addChild(k,e.nextNode());f.hasNext()&&this.adaptor.addChild(k,f.nextTree());f.reset();this.adaptor.addChild(b,k);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(l){if(l instanceof org.antlr.runtime.RecognitionException)this.reportError(l),this.recover(this.input,l),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),l);else throw l;}finally{}return a},logicalExpression_return:function(){FormulaParser.logicalExpression_return=function(){};org.antlr.lang.extend(FormulaParser.logicalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
logicalExpression:function(){var a=new FormulaParser.logicalExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1214);d=this.booleanXORExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do switch(d=2,72==this.input.LA(1)&&(this.input.LA(2),this.synpred47_Formula()&&(d=1)),d){case 1:c=this.match(this.input,
72,FormulaParser.FOLLOW_OR_in_logicalExpression1217);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1220);e=this.booleanXORExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},booleanXORExpression_return:function(){FormulaParser.booleanXORExpression_return=function(){};org.antlr.lang.extend(FormulaParser.booleanXORExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
booleanXORExpression:function(){var a=new FormulaParser.booleanXORExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1250);d=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do switch(d=2,73==this.input.LA(1)&&(this.input.LA(2),this.synpred48_Formula()&&(d=1)),d){case 1:c=
this.match(this.input,73,FormulaParser.FOLLOW_XOR_in_booleanXORExpression1253);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1256);e=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},booleanAndExpression_return:function(){FormulaParser.booleanAndExpression_return=function(){};org.antlr.lang.extend(FormulaParser.booleanAndExpression_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),booleanAndExpression:function(){var a=new FormulaParser.booleanAndExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1285);d=this.equalityExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do switch(d=2,75==this.input.LA(1)&&(this.input.LA(2),this.synpred49_Formula()&&
(d=1)),d){case 1:c=this.match(this.input,75,FormulaParser.FOLLOW_AND_in_booleanAndExpression1288);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1291);e=this.equalityExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);0===
this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},equalityExpression_return:function(){FormulaParser.equalityExpression_return=function(){};org.antlr.lang.extend(FormulaParser.equalityExpression_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),equalityExpression:function(){var a=new FormulaParser.equalityExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1322);d=this.relationalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);if(70==f||76==f)this.input.LA(2),this.synpred51_Formula()&&
(d=1);switch(d){case 1:c=this.input.LT(1);if(70==this.input.LA(1)||76==this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1332);e=this.relationalExpression();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},relationalExpression_return:function(){FormulaParser.relationalExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.relationalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),relationalExpression:function(){var a=new FormulaParser.relationalExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1374);d=this.additiveExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);77<=f&&80>=f&&(this.input.LA(2),this.synpred55_Formula()&&(d=1));switch(d){case 1:c=this.input.LT(1);if(77<=this.input.LA(1)&&80>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);
}this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1389);e=this.additiveExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,
g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},additiveExpression_return:function(){FormulaParser.additiveExpression_return=function(){};org.antlr.lang.extend(FormulaParser.additiveExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),additiveExpression:function(){var a=new FormulaParser.additiveExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();
this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1432);d=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);81<=f&&82>=f&&(this.input.LA(2),this.synpred57_Formula()&&(d=1));switch(d){case 1:c=this.input.LT(1);if(81<=this.input.LA(1)&&82>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),
b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1443);e=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},multiplicativeExpression_return:function(){FormulaParser.multiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.multiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),multiplicativeExpression:function(){var a=new FormulaParser.multiplicativeExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1473);d=this.arrayExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);83<=f&&85>=f&&(this.input.LA(2),
this.synpred60_Formula()&&(d=1));switch(d){case 1:c=this.input.LT(1);if(83<=this.input.LA(1)&&85>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1486);e=this.arrayExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},
arrayExpression_return:function(){FormulaParser.arrayExpression_return=function(){};org.antlr.lang.extend(FormulaParser.arrayExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayExpression:function(){var a=new FormulaParser.arrayExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"rule negationExpression");try{this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1532);e=this.negationExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&l.add(e.getTree());e=2;86==this.input.LA(1)&&(this.input.LA(2),this.synpred61_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(e=1));switch(e){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,
"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "');}c=this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_arrayExpression1538);if(this.state.failed)return a;0===this.state.backtracking&&k.add(c);if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "');}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1542);
f=this.negationExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&l.add(f.getTree())}c=2;86==this.input.LA(1)&&(this.input.LA(2),this.synpred62_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(c=1));switch(c){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "');
}d=this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_arrayExpression1551);if(this.state.failed)return a;0===this.state.backtracking&&k.add(d);if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "');}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1555);g=this.negationExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&l.add(g.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),m=this.adaptor.nil(),m=this.adaptor.becomeRoot(this.adaptor.create(24,"RANGE"),m);l.hasNext();)this.adaptor.addChild(m,l.nextTree());l.reset();this.adaptor.addChild(b,m);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=
this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(n){if(n instanceof org.antlr.runtime.RecognitionException)this.reportError(n),this.recover(this.input,n),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),n);else throw n;}finally{}return a},negationExpression_return:function(){FormulaParser.negationExpression_return=function(){};org.antlr.lang.extend(FormulaParser.negationExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
negationExpression:function(){var a=new FormulaParser.negationExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule powerExpression");try{var k=2,l=this.input.LA(1);if(82==l)k=1;else if(60==l||64==l||69==l||71==l||88<=l&&89>=l||91==l||94<=l&&98>=l||113==l)k=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",
48,0,this.input);}switch(k){case 1:c=this.match(this.input,82,FormulaParser.FOLLOW_MINUS_in_negationExpression1580);if(this.state.failed)return a;0===this.state.backtracking&&f.add(c);this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1582);d=this.powerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&g.add(d.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",
null!=a?a.tree:null);var b=this.adaptor.nil(),m=this.adaptor.nil(),m=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),m);this.adaptor.addChild(m,g.nextTree());this.adaptor.addChild(b,m);a.tree=b}break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1596);e=this.powerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(n){if(n instanceof org.antlr.runtime.RecognitionException)this.reportError(n),this.recover(this.input,n),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),n);else throw n;}finally{}return a},powerExpression_return:function(){FormulaParser.powerExpression_return=function(){};org.antlr.lang.extend(FormulaParser.powerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
powerExpression:function(){var a=new FormulaParser.powerExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token POW"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryOrNegate"),k=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_powerExpression1607);d=this.unaryExpression();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&k.add(d.getTree());a:do switch(d=2,87==this.input.LA(1)&&(this.input.LA(2),this.synpred64_Formula()&&(d=1)),d){case 1:c=this.match(this.input,87,FormulaParser.FOLLOW_POW_in_powerExpression1610);if(this.state.failed)return a;0===this.state.backtracking&&f.add(c);this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_powerExpression1612);e=this.unaryOrNegate();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&g.add(e.getTree());
break;default:break a}while(1);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(9,"POWER"),l);for(this.adaptor.addChild(l,k.nextTree());g.hasNext();)this.adaptor.addChild(l,g.nextTree());g.reset();this.adaptor.addChild(b,l);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(m){if(m instanceof org.antlr.runtime.RecognitionException)this.reportError(m),this.recover(this.input,m),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),m);else throw m;}finally{}return a},unaryOrNegate_return:function(){FormulaParser.unaryOrNegate_return=function(){};org.antlr.lang.extend(FormulaParser.unaryOrNegate_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryOrNegate:function(){var a=
new FormulaParser.unaryOrNegate_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{var k=2,l=this.input.LA(1);if(60==l||64==l||69==l||71==l||88<=l&&89>=l||91==l||94<=l&&98>=l||113==l)k=1;else if(82==l)k=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",
50,0,this.input);}switch(k){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1639);d=this.unaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:c=this.match(this.input,82,FormulaParser.FOLLOW_MINUS_in_unaryOrNegate1645);if(this.state.failed)return a;0===this.state.backtracking&&f.add(c);this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1647);
e=this.unaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&g.add(e.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),m=this.adaptor.nil(),m=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),m);this.adaptor.addChild(m,g.nextTree());this.adaptor.addChild(b,m);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=
this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(n){if(n instanceof org.antlr.runtime.RecognitionException)this.reportError(n),this.recover(this.input,n),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),n);else throw n;}finally{}return a},unaryExpression_return:function(){FormulaParser.unaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
unaryExpression:function(){var a=new FormulaParser.unaryExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{var g=2,k=this.input.LA(1);if(88==k)g=1;else if(60==k||64==k||69==k||71==k||89==k||91==k||94<=k&&98>=k||113==k)g=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",51,0,this.input);}switch(g){case 1:b=this.adaptor.nil();c=this.match(this.input,88,FormulaParser.FOLLOW_NOT_in_unaryExpression1675);
if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1678);d=this.innerPrimaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1687);e=this.innerPrimaryExpression();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(l){if(l instanceof org.antlr.runtime.RecognitionException)this.reportError(l),this.recover(this.input,l),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),l);else throw l;}finally{}return a},innerPrimaryExpression_return:function(){FormulaParser.innerPrimaryExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.innerPrimaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerPrimaryExpression:function(){var a=new FormulaParser.innerPrimaryExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selectionExpression");try{this.pushFollow(FormulaParser.FOLLOW_selectionExpression_in_innerPrimaryExpression1718);c=this.selectionExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&d.add(c.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),e=this.adaptor.nil(),e=this.adaptor.becomeRoot(this.adaptor.create(25,"INNER"),e);this.adaptor.addChild(e,d.nextTree());this.adaptor.addChild(b,e);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(f){if(f instanceof org.antlr.runtime.RecognitionException)this.reportError(f),this.recover(this.input,f),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),f);else throw f;}finally{}return a},selectionExpression_return:function(){FormulaParser.selectionExpression_return=function(){};org.antlr.lang.extend(FormulaParser.selectionExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
selectionExpression:function(){var a=new FormulaParser.selectionExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_selectionExpression1738);c=this.primaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());a:do{c=2;switch(this.input.LA(1)){case 89:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-
1).getText()&&(c=1);break;case 91:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(c=1);break;case 116:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(c=1);break;case 113:this.input.LA(2),this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(c=1)}switch(c){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;
throw new org.antlr.runtime.FailedPredicateException(this.input,"selectionExpression",' this.input.get(this.input.index()-1).getText()!=" "');}var c=2,f=this.input.LA(1);if(89==f||91==f||116==f)c=1;else if(113==f)c=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",52,0,this.input);}switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_selectionExpression1744);d=this.selector();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:this.pushFollow(FormulaParser.FOLLOW_funCall_in_selectionExpression1746);e=this.funCall();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree())}break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),
this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},funCall_return:function(){FormulaParser.funCall_return=function(){};org.antlr.lang.extend(FormulaParser.funCall_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),funCall:function(){var a=new FormulaParser.funCall_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token 114"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),n=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,113,FormulaParser.FOLLOW_113_in_funCall1761);if(this.state.failed)return a;0===this.state.backtracking&&l.add(c);var c=2,p=this.input.LA(1);if(60==p||64==p||69==p||71==p||82==p||88<=p&&89>=p||91==p||94<=p&&98>=
p||113==p)c=1;switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1765);f=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&n.add(f.getTree());a:do switch(f=2,93==this.input.LA(1)&&(f=1),f){case 1:d=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_funCall1768);if(this.state.failed)return a;0===this.state.backtracking&&m.add(d);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1770);g=this.logicalExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&n.add(g.getTree());break;default:break a}while(1)}e=this.match(this.input,114,FormulaParser.FOLLOW_114_in_funCall1777);if(this.state.failed)return a;0===this.state.backtracking&&k.add(e);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),q=this.adaptor.nil(),q=this.adaptor.becomeRoot(this.adaptor.create(6,
"FUNCALL"),q);n.hasNext();)this.adaptor.addChild(q,n.nextTree());n.reset();this.adaptor.addChild(b,q);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(u){if(u instanceof org.antlr.runtime.RecognitionException)this.reportError(u),this.recover(this.input,u),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),u);else throw u;}finally{}return a},primaryExpression_return:function(){FormulaParser.primaryExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.primaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primaryExpression:function(){var a=new FormulaParser.primaryExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null;try{var e=2,f=this.input.LA(1);if(113==f)e=1;else if(60==f||64==f||69==f||71==f||89==f||91==f||94<=f&&98>=f)e=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",
56,0,this.input);}switch(e){case 1:b=this.adaptor.nil();this.match(this.input,113,FormulaParser.FOLLOW_113_in_primaryExpression1798);if(this.state.failed)return a;this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_primaryExpression1801);c=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());this.match(this.input,114,FormulaParser.FOLLOW_114_in_primaryExpression1803);if(this.state.failed)return a;break;case 2:b=
this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_value_in_primaryExpression1809);d=this.value();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,
a.start,this.input.LT(-1),g);else throw g;}finally{}return a},value_return:function(){FormulaParser.value_return=function(){};org.antlr.lang.extend(FormulaParser.value_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),value:function(){var a=new FormulaParser.value_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=null;try{var q=9,q=this.dfa57.predict(this.input);switch(q){case 1:b=this.adaptor.nil();
this.pushFollow(FormulaParser.FOLLOW_number_in_value1823);d=this.number();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_value1829);e=this.bool();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;case 3:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_value1835);f=this.string();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());break;case 4:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_material_in_value1841);g=this.material();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,g.getTree());break;case 5:b=this.adaptor.nil();c=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_value1846);if(this.state.failed)return a;0===this.state.backtracking&&
(p=this.adaptor.create(c),this.adaptor.addChild(b,p));break;case 6:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primitive_in_value1851);k=this.primitive();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,k.getTree());break;case 7:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_array_in_value1856);l=this.array();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,l.getTree());
break;case 8:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_anonFunctionDef_in_value1861);m=this.anonFunctionDef();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,m.getTree());break;case 9:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_newObject_in_value1866);n=this.newObject();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,n.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(u){if(u instanceof org.antlr.runtime.RecognitionException)this.reportError(u),this.recover(this.input,u),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),u);else throw u;}finally{}return a},newObject_return:function(){FormulaParser.newObject_return=function(){};org.antlr.lang.extend(FormulaParser.newObject_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
newObject:function(){var a=new FormulaParser.newObject_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),g=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWSTATEMENT"),k=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule funCall");try{c=this.match(this.input,64,FormulaParser.FOLLOW_NEWSTATEMENT_in_newObject1876);if(this.state.failed)return a;0===this.state.backtracking&&
g.add(c);d=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_newObject1878);if(this.state.failed)return a;0===this.state.backtracking&&f.add(d);c=2;c=this.dfa58.predict(this.input);switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_funCall_in_newObject1880);e=this.funCall();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&k.add(e.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=
a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(29,"NEW"),l);this.adaptor.addChild(l,f.nextNode());k.hasNext()&&this.adaptor.addChild(l,k.nextTree());k.reset();this.adaptor.addChild(b,l);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(m){if(m instanceof org.antlr.runtime.RecognitionException)this.reportError(m),this.recover(this.input,
m),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),m);else throw m;}finally{}return a},defaultValue_return:function(){FormulaParser.defaultValue_return=function(){};org.antlr.lang.extend(FormulaParser.defaultValue_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),defaultValue:function(){var a=new FormulaParser.defaultValue_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null;try{var k=5;switch(this.input.LA(1)){case 82:k=
1;break;case 95:case 96:k=2;break;case 97:case 98:k=3;break;case 94:k=4;break;case 89:case 91:k=5;break;default:if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",59,0,this.input);}switch(k){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_negnumber_in_defaultValue1906);c=this.negnumber();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());break;case 2:b=this.adaptor.nil();
this.pushFollow(FormulaParser.FOLLOW_number_in_defaultValue1912);d=this.number();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 3:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_defaultValue1918);e=this.bool();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;case 4:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_defaultValue1924);
f=this.string();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());break;case 5:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_array_in_defaultValue1930);g=this.array();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,g.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,
a.stop))}catch(l){if(l instanceof org.antlr.runtime.RecognitionException)this.reportError(l),this.recover(this.input,l),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),l);else throw l;}finally{}return a},array_return:function(){FormulaParser.array_return=function(){};org.antlr.lang.extend(FormulaParser.array_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),array:function(){var a=new FormulaParser.array_return;a.start=this.input.LT(1);var b=
null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=null,q=null,u=null,v=null,y=null,z=null,x=null,B=null,A=null,D=null,E=null,G=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RARR"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),H=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token LARR"),P=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),J=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule label");try{var O=2,Q=this.input.LA(1);if(89==Q)O=1;else if(91==Q)O=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",74,0,this.input);}switch(O){case 1:c=this.match(this.input,89,FormulaParser.FOLLOW_LARR_in_array1944);if(this.state.failed)return a;0===this.state.backtracking&&
H.add(c);a:do switch(z=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred85_Formula()&&(z=1)),z){case 1:d=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1946);if(this.state.failed)return a;0===this.state.backtracking&&C.add(d);break;default:break a}while(1);z=2;z=this.dfa65.predict(this.input);switch(z){case 1:this.pushFollow(FormulaParser.FOLLOW_label_in_array1950);B=this.label();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&J.add(B.getTree());a:do switch(z=
2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred86_Formula()&&(z=1)),z){case 1:e=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1952);if(this.state.failed)return a;0===this.state.backtracking&&C.add(e);break;default:break a}while(1);a:do switch(z=2,93==this.input.LA(1)&&(z=1),z){case 1:f=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_array1956);if(this.state.failed)return a;0===this.state.backtracking&&I.add(f);b:do switch(z=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred87_Formula()&&
(z=1)),z){case 1:g=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1958);if(this.state.failed)return a;0===this.state.backtracking&&C.add(g);break;default:break b}while(1);this.pushFollow(FormulaParser.FOLLOW_label_in_array1961);A=this.label();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&J.add(A.getTree());b:do switch(z=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred88_Formula()&&(z=1)),z){case 1:k=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1963);
if(this.state.failed)return a;0===this.state.backtracking&&C.add(k);break;default:break b}while(1);break;default:break a}while(1);break}a:do switch(I=2,32==this.input.LA(1)&&(I=1),I){case 1:l=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1970);if(this.state.failed)return a;0===this.state.backtracking&&C.add(l);break;default:break a}while(1);m=this.match(this.input,90,FormulaParser.FOLLOW_RARR_in_array1973);if(this.state.failed)return a;0===this.state.backtracking&&F.add(m);if(0===
this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),N=this.adaptor.nil(),N=this.adaptor.becomeRoot(this.adaptor.create(13,"ARRAY"),N);J.hasNext();)this.adaptor.addChild(N,J.nextTree());J.reset();this.adaptor.addChild(b,N);a.tree=b}break;case 2:n=this.match(this.input,91,FormulaParser.FOLLOW_LCURL_in_array1987);if(this.state.failed)return a;0===this.state.backtracking&&G.add(n);a:do switch(l=
2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred93_Formula()&&(l=1)),l){case 1:p=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1989);if(this.state.failed)return a;0===this.state.backtracking&&C.add(p);break;default:break a}while(1);l=2;l=this.dfa72.predict(this.input);switch(l){case 1:this.pushFollow(FormulaParser.FOLLOW_label_in_array1993);D=this.label();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&J.add(D.getTree());a:do switch(l=2,32==this.input.LA(1)&&
(this.input.LA(2),this.synpred94_Formula()&&(l=1)),l){case 1:q=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1995);if(this.state.failed)return a;0===this.state.backtracking&&C.add(q);break;default:break a}while(1);a:do switch(l=2,93==this.input.LA(1)&&(l=1),l){case 1:u=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_array1998);if(this.state.failed)return a;0===this.state.backtracking&&I.add(u);b:do switch(l=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred95_Formula()&&
(l=1)),l){case 1:v=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array2000);if(this.state.failed)return a;0===this.state.backtracking&&C.add(v);break;default:break b}while(1);this.pushFollow(FormulaParser.FOLLOW_label_in_array2003);E=this.label();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&J.add(E.getTree());b:do switch(l=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred96_Formula()&&(l=1)),l){case 1:y=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array2005);
if(this.state.failed)return a;0===this.state.backtracking&&C.add(y);break;default:break b}while(1);break;default:break a}while(1);break}a:do switch(I=2,32==this.input.LA(1)&&(I=1),I){case 1:z=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array2012);if(this.state.failed)return a;0===this.state.backtracking&&C.add(z);break;default:break a}while(1);x=this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_array2015);if(this.state.failed)return a;0===this.state.backtracking&&P.add(x);if(0===
this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);b=this.adaptor.nil();N=this.adaptor.nil();for(N=this.adaptor.becomeRoot(this.adaptor.create(13,"ARRAY"),N);J.hasNext();)this.adaptor.addChild(N,J.nextTree());J.reset();this.adaptor.addChild(b,N);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(M){if(M instanceof
org.antlr.runtime.RecognitionException)this.reportError(M),this.recover(this.input,M),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),M);else throw M;}finally{}return a},selector_return:function(){FormulaParser.selector_return=function(){};org.antlr.lang.extend(FormulaParser.selector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selector:function(){var a=new FormulaParser.selector_return;a.start=this.input.LT(1);var b=null,c=null,d=null,
e=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule dotselector"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule minarray");try{var g=2,k=this.input.LA(1);if(89==k||91==k)g=1;else if(116==k)g=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",75,0,this.input);}switch(g){case 1:this.pushFollow(FormulaParser.FOLLOW_minarray_in_selector2036);c=this.minarray();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&f.add(c.getTree());break;case 2:this.pushFollow(FormulaParser.FOLLOW_dotselector_in_selector2040);d=this.dotselector();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&e.add(d.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(27,"SELECTOR"),l);f.hasNext()&&
this.adaptor.addChild(l,f.nextTree());f.reset();e.hasNext()&&this.adaptor.addChild(l,e.nextTree());e.reset();this.adaptor.addChild(b,l);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(m){if(m instanceof org.antlr.runtime.RecognitionException)this.reportError(m),this.recover(this.input,m),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),m);else throw m;}finally{}return a},
minarray_return:function(){FormulaParser.minarray_return=function(){};org.antlr.lang.extend(FormulaParser.minarray_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),minarray:function(){var a=new FormulaParser.minarray_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=null,p=null,q=null,u=null;try{var v=2,y=this.input.LA(1);if(89==y)v=1;else if(91==y)v=2;else{if(0<this.state.backtracking)return this.state.failed=
!0,a;var z=new org.antlr.runtime.NoViableAltException("",82,0,this.input);throw z;}switch(v){case 1:b=this.adaptor.nil();this.match(this.input,89,FormulaParser.FOLLOW_LARR_in_minarray2067);if(this.state.failed)return a;var f=2,x=this.input.LA(1);if(60==x||64==x||69==x||71==x||82==x||88<=x&&89>=x||91==x||94<=x&&98>=x||113==x)f=1;else if(83==x)f=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;z=new org.antlr.runtime.NoViableAltException("",76,0,this.input);throw z;}switch(f){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2072);
g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,g.getTree());break;case 2:c=this.match(this.input,83,FormulaParser.FOLLOW_MULT_in_minarray2074);if(this.state.failed)return a;0===this.state.backtracking&&(n=this.adaptor.create(c),this.adaptor.addChild(b,n));break}a:do switch(f=2,93==this.input.LA(1)&&(f=1),f){case 1:this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_minarray2078);if(this.state.failed)return a;var f=
2,B=this.input.LA(1);if(60==B||64==B||69==B||71==B||82==B||88<=B&&89>=B||91==B||94<=B&&98>=B||113==B)f=1;else if(83==B)f=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;z=new org.antlr.runtime.NoViableAltException("",77,0,this.input);throw z;}switch(f){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2082);k=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,k.getTree());break;case 2:d=
this.match(this.input,83,FormulaParser.FOLLOW_MULT_in_minarray2084);if(this.state.failed)return a;0===this.state.backtracking&&(p=this.adaptor.create(d),this.adaptor.addChild(b,p))}break;default:break a}while(1);this.match(this.input,90,FormulaParser.FOLLOW_RARR_in_minarray2091);if(this.state.failed)return a;break;case 2:b=this.adaptor.nil();this.match(this.input,91,FormulaParser.FOLLOW_LCURL_in_minarray2097);if(this.state.failed)return a;var d=2,A=this.input.LA(1);if(60==A||64==A||69==A||71==A||
82==A||88<=A&&89>=A||91==A||94<=A&&98>=A||113==A)d=1;else if(83==A)d=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;z=new org.antlr.runtime.NoViableAltException("",79,0,this.input);throw z;}switch(d){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2102);l=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,l.getTree());break;case 2:e=this.match(this.input,83,FormulaParser.FOLLOW_MULT_in_minarray2104);
if(this.state.failed)return a;0===this.state.backtracking&&(q=this.adaptor.create(e),this.adaptor.addChild(b,q));break}a:do switch(d=2,93==this.input.LA(1)&&(d=1),d){case 1:this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_minarray2108);if(this.state.failed)return a;var d=2,D=this.input.LA(1);if(60==D||64==D||69==D||71==D||82==D||88<=D&&89>=D||91==D||94<=D&&98>=D||113==D)d=1;else if(83==D)d=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;z=new org.antlr.runtime.NoViableAltException("",
80,0,this.input);throw z;}switch(d){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2112);m=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,m.getTree());break;case 2:f=this.match(this.input,83,FormulaParser.FOLLOW_MULT_in_minarray2114);if(this.state.failed)return a;0===this.state.backtracking&&(u=this.adaptor.create(f),this.adaptor.addChild(b,u))}break;default:break a}while(1);this.match(this.input,
92,FormulaParser.FOLLOW_RCURL_in_minarray2121);if(this.state.failed)return a}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(E){if(E instanceof org.antlr.runtime.RecognitionException)this.reportError(E),this.recover(this.input,E),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),E);else throw E;}finally{}return a},dotselector_return:function(){FormulaParser.dotselector_return=
function(){};org.antlr.lang.extend(FormulaParser.dotselector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),dotselector:function(){var a=new FormulaParser.dotselector_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 116"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName");try{var g=0;a:do{var k=2;116==this.input.LA(1)&&(this.input.LA(2),this.synpred108_Formula()&&
(k=1));switch(k){case 1:c=this.match(this.input,116,FormulaParser.FOLLOW_116_in_dotselector2133);if(this.state.failed)return a;0===this.state.backtracking&&e.add(c);this.pushFollow(FormulaParser.FOLLOW_arrayName_in_dotselector2135);d=this.arrayName();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&f.add(d.getTree());break;default:if(1<=g)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(83,this.input);}g++}while(1);
if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(28,"DOTSELECTOR"),l);if(!f.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;f.hasNext();)this.adaptor.addChild(l,f.nextTree());f.reset();this.adaptor.addChild(b,l);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(m){if(m instanceof org.antlr.runtime.RecognitionException)this.reportError(m),this.recover(this.input,m),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),m);else throw m;}finally{}return a},arrayName_return:function(){FormulaParser.arrayName_return=function(){};org.antlr.lang.extend(FormulaParser.arrayName_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayName:function(){var a=
new FormulaParser.arrayName_return;a.start=this.input.LT(1);var b=null,c=null;try{b=this.adaptor.nil();c=this.input.LT(1);if(69==this.input.LA(1)||83==this.input.LA(1)||94==this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,this.adaptor.create(c)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(d){if(d instanceof org.antlr.runtime.RecognitionException)this.reportError(d),this.recover(this.input,d),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),d);else throw d;}finally{}return a},label_return:function(){FormulaParser.label_return=function(){};org.antlr.lang.extend(FormulaParser.label_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
label:function(){var a=new FormulaParser.label_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),m=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName"),n=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var p=2,p=this.dfa85.predict(this.input);
switch(p){case 1:this.pushFollow(FormulaParser.FOLLOW_arrayName_in_label2173);f=this.arrayName();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&m.add(f.getTree());a:do switch(f=2,32==this.input.LA(1)&&(f=1),f){case 1:c=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_label2175);if(this.state.failed)return a;0===this.state.backtracking&&l.add(c);break;default:break a}while(1);d=this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_label2178);if(this.state.failed)return a;
0===this.state.backtracking&&k.add(d);break}a:do switch(c=2,32==this.input.LA(1)&&(c=1),c){case 1:e=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_label2182);if(this.state.failed)return a;0===this.state.backtracking&&l.add(e);break;default:break a}while(1);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_label2185);g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&n.add(g.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),q=this.adaptor.nil(),q=this.adaptor.becomeRoot(this.adaptor.create(23,"LABEL"),q);this.adaptor.addChild(q,n.nextTree());m.hasNext()&&this.adaptor.addChild(q,m.nextTree());m.reset();this.adaptor.addChild(b,q);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(u){if(u instanceof org.antlr.runtime.RecognitionException)this.reportError(u),
this.recover(this.input,u),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),u);else throw u;}finally{}return a},number_return:function(){FormulaParser.number_return=function(){};org.antlr.lang.extend(FormulaParser.number_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),number:function(){var a=new FormulaParser.number_return;a.start=this.input.LT(1);var b=null,c=null;try{b=this.adaptor.nil();c=this.input.LT(1);if(95<=this.input.LA(1)&&96>=
this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,this.adaptor.create(c)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(d){if(d instanceof org.antlr.runtime.RecognitionException)this.reportError(d),
this.recover(this.input,d),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),d);else throw d;}finally{}return a},negnumber_return:function(){FormulaParser.negnumber_return=function(){};org.antlr.lang.extend(FormulaParser.negnumber_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negnumber:function(){var a=new FormulaParser.negnumber_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token MINUS"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule number");try{c=this.match(this.input,82,FormulaParser.FOLLOW_MINUS_in_negnumber2261);if(this.state.failed)return a;0===this.state.backtracking&&e.add(c);this.pushFollow(FormulaParser.FOLLOW_number_in_negnumber2263);d=this.number();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&f.add(d.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),g=this.adaptor.nil(),g=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),g);this.adaptor.addChild(g,f.nextTree());this.adaptor.addChild(b,g);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(k){if(k instanceof org.antlr.runtime.RecognitionException)this.reportError(k),this.recover(this.input,k),a.tree=this.adaptor.errorNode(this.input,
a.start,this.input.LT(-1),k);else throw k;}finally{}return a},bool_return:function(){FormulaParser.bool_return=function(){};org.antlr.lang.extend(FormulaParser.bool_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),bool:function(){var a=new FormulaParser.bool_return;a.start=this.input.LT(1);var b=null,c=null;try{b=this.adaptor.nil();c=this.input.LT(1);if(97<=this.input.LA(1)&&98>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,
this.adaptor.create(c)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(d){if(d instanceof org.antlr.runtime.RecognitionException)this.reportError(d),this.recover(this.input,d),a.tree=this.adaptor.errorNode(this.input,
a.start,this.input.LT(-1),d);else throw d;}finally{}return a},material_return:function(){FormulaParser.material_return=function(){};org.antlr.lang.extend(FormulaParser.material_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),material:function(){var a=new FormulaParser.material_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token RCURL"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression"),m=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule additiveExpression");try{c=this.match(this.input,91,FormulaParser.FOLLOW_LCURL_in_material2415);if(this.state.failed)return a;0===this.state.backtracking&&g.add(c);this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_material2417);e=this.additiveExpression();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&m.add(e.getTree());if(" "!=this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,"material",' this.input.get(this.input.index()-1).getText()==" "');}this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_material2421);f=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&l.add(f.getTree());
d=this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_material2423);if(this.state.failed)return a;0===this.state.backtracking&&k.add(d);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),n=this.adaptor.nil(),n=this.adaptor.becomeRoot(this.adaptor.create(7,"MATERIAL"),n);this.adaptor.addChild(n,l.nextTree());this.adaptor.addChild(n,m.nextTree());this.adaptor.addChild(b,n);a.tree=b}a.stop=
this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(p){if(p instanceof org.antlr.runtime.RecognitionException)this.reportError(p),this.recover(this.input,p),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),p);else throw p;}finally{}return a},unitMultiplicativeExpression_return:function(){FormulaParser.unitMultiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitMultiplicativeExpression_return,
org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitMultiplicativeExpression:function(){var a=new FormulaParser.unitMultiplicativeExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460);d=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,
d.getTree());a:do switch(d=2,99==this.input.LA(1)&&(d=1),d){case 1:c=this.match(this.input,99,FormulaParser.FOLLOW_PER_in_unitMultiplicativeExpression2464);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467);e=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},unitInnerMultiplicativeExpression_return:function(){FormulaParser.unitInnerMultiplicativeExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.unitInnerMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitInnerMultiplicativeExpression:function(){var a=new FormulaParser.unitInnerMultiplicativeExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483);d=this.unitClump();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);83<=f&&84>=f&&(d=1);switch(d){case 1:c=this.input.LT(1);if(83<=this.input.LA(1)&&84>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494);
e=this.unitClump();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;
}finally{}return a},unitClump_return:function(){FormulaParser.unitClump_return=function(){};org.antlr.lang.extend(FormulaParser.unitClump_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitClump:function(){var a=new FormulaParser.unitClump_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null,l=null,m=null,n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INTEGER"),p=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token SQUARED"),q=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token DIV"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CUBED"),v=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitPowerExpression");try{var y=2,z=this.input.LA(1);if(95==z)y=1;else if(69==z||113==z)y=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",93,0,this.input);}switch(y){case 1:c=this.match(this.input,
95,FormulaParser.FOLLOW_INTEGER_in_unitClump2510);if(this.state.failed)return a;0===this.state.backtracking&&n.add(c);d=this.match(this.input,84,FormulaParser.FOLLOW_DIV_in_unitClump2512);if(this.state.failed)return a;0===this.state.backtracking&&q.add(d);this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2515);l=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&v.add(l.getTree());k=2;100==this.input.LA(1)&&(k=1);switch(k){case 1:e=
this.match(this.input,100,FormulaParser.FOLLOW_CUBED_in_unitClump2517);if(this.state.failed)return a;0===this.state.backtracking&&u.add(e)}k=2;101==this.input.LA(1)&&(k=1);switch(k){case 1:f=this.match(this.input,101,FormulaParser.FOLLOW_SQUARED_in_unitClump2520);if(this.state.failed)return a;0===this.state.backtracking&&p.add(f)}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),x=
this.adaptor.nil(),x=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),x);this.adaptor.addChild(x,v.nextTree());for(this.adaptor.addChild(x,this.adaptor.create(4,"NEGATE"));u.hasNext();)this.adaptor.addChild(x,u.nextNode());for(u.reset();p.hasNext();)this.adaptor.addChild(x,p.nextNode());p.reset();this.adaptor.addChild(b,x);a.tree=b}break;case 2:this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2543);m=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&v.add(m.getTree());f=2;100==this.input.LA(1)&&(f=1);switch(f){case 1:g=this.match(this.input,100,FormulaParser.FOLLOW_CUBED_in_unitClump2545);if(this.state.failed)return a;0===this.state.backtracking&&u.add(g)}f=2;101==this.input.LA(1)&&(f=1);switch(f){case 1:k=this.match(this.input,101,FormulaParser.FOLLOW_SQUARED_in_unitClump2548);if(this.state.failed)return a;0===this.state.backtracking&&p.add(k)}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);b=this.adaptor.nil();x=this.adaptor.nil();x=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),x);for(this.adaptor.addChild(x,v.nextTree());u.hasNext();)this.adaptor.addChild(x,u.nextNode());for(u.reset();p.hasNext();)this.adaptor.addChild(x,p.nextNode());p.reset();this.adaptor.addChild(b,x);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(B){if(B instanceof
org.antlr.runtime.RecognitionException)this.reportError(B),this.recover(this.input,B),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),B);else throw B;}finally{}return a},unitPowerExpression_return:function(){FormulaParser.unitPowerExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitPowerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitPowerExpression:function(){var a=new FormulaParser.unitPowerExpression_return;
a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unit_in_unitPowerExpression2610);f=this.unit();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());a:do switch(f=2,87==this.input.LA(1)&&(f=1),f){case 1:c=this.match(this.input,87,FormulaParser.FOLLOW_POW_in_unitPowerExpression2614);if(this.state.failed)return a;0===this.state.backtracking&&(g=this.adaptor.create(c),
b=this.adaptor.becomeRoot(g,b));f=2;82==this.input.LA(1)&&(f=1);switch(f){case 1:d=this.match(this.input,82,FormulaParser.FOLLOW_MINUS_in_unitPowerExpression2617);if(this.state.failed)return a;0===this.state.backtracking&&(k=this.adaptor.create(d),this.adaptor.addChild(b,k))}e=this.input.LT(1);if(95<=this.input.LA(1)&&96>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,this.adaptor.create(e)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=
!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(l){if(l instanceof org.antlr.runtime.RecognitionException)this.reportError(l),this.recover(this.input,l),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),l);else throw l;}finally{}return a},unit_return:function(){FormulaParser.unit_return=
function(){};org.antlr.lang.extend(FormulaParser.unit_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unit:function(){var a=new FormulaParser.unit_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),
n=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression");try{var p=2,q=this.input.LA(1);if(69==q)p=1;else if(113==q)p=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",97,0,this.input);}switch(p){case 1:c=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_unit2638);if(this.state.failed)return a;0===this.state.backtracking&&l.add(c);a:do switch(c=2,69==this.input.LA(1)&&(c=1),c){case 1:d=
this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_unit2641);if(this.state.failed)return a;0===this.state.backtracking&&l.add(d);break;default:break a}while(1);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),u=this.adaptor.nil(),u=this.adaptor.becomeRoot(this.adaptor.create(8,"UNIT"),u);if(!l.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;l.hasNext();)this.adaptor.addChild(u,
l.nextNode());l.reset();this.adaptor.addChild(b,u);a.tree=b}break;case 2:e=this.match(this.input,113,FormulaParser.FOLLOW_113_in_unit2658);if(this.state.failed)return a;0===this.state.backtracking&&m.add(e);this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_unit2660);g=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&n.add(g.getTree());f=this.match(this.input,114,FormulaParser.FOLLOW_114_in_unit2662);if(this.state.failed)return a;
0===this.state.backtracking&&k.add(f);0===this.state.backtracking&&(a.tree=b,new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null),b=this.adaptor.nil(),u=this.adaptor.nil(),u=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),u),this.adaptor.addChild(u,n.nextTree()),this.adaptor.addChild(b,u),a.tree=b)}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,
a.stop))}catch(v){if(v instanceof org.antlr.runtime.RecognitionException)this.reportError(v),this.recover(this.input,v),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),v);else throw v;}finally{}return a},primitive_return:function(){FormulaParser.primitive_return=function(){};org.antlr.lang.extend(FormulaParser.primitive_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primitive:function(){var a=new FormulaParser.primitive_return;a.start=
this.input.LT(1);var b=null,c=null,d=null;try{b=this.adaptor.nil();c=this.match(this.input,71,FormulaParser.FOLLOW_PRIMITIVE_in_primitive2731);if(this.state.failed)return a;0===this.state.backtracking&&(d=this.adaptor.create(c),this.adaptor.addChild(b,d));a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(e){if(e instanceof org.antlr.runtime.RecognitionException)this.reportError(e),this.recover(this.input,
e),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),e);else throw e;}finally{}return a},string_return:function(){FormulaParser.string_return=function(){};org.antlr.lang.extend(FormulaParser.string_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),string:function(){var a=new FormulaParser.string_return;a.start=this.input.LT(1);var b=null,c=null,d=null;try{b=this.adaptor.nil();c=this.match(this.input,94,FormulaParser.FOLLOW_STRING_in_string3200);
if(this.state.failed)return a;0===this.state.backtracking&&(d=this.adaptor.create(c),b=this.adaptor.becomeRoot(d,b));a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(e){if(e instanceof org.antlr.runtime.RecognitionException)this.reportError(e),this.recover(this.input,e),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),e);else throw e;}finally{}return a},synpred5_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_assignment_in_synpred5_Formula508);
this.assignment();this.state._fsp--},synpred6_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_synpred6_Formula514);this.logicalExpression();this.state._fsp--},synpred8_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forLoop_in_synpred8_Formula526);this.forLoop();this.state._fsp--},synpred9_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_synpred9_Formula532);this.forInLoop();this.state._fsp--},synpred11_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_functionDef_in_synpred11_Formula544);
this.functionDef();this.state._fsp--},synpred47_Formula_fragment:function(){this.match(this.input,72,FormulaParser.FOLLOW_OR_in_synpred47_Formula1217);this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_synpred47_Formula1220),this.booleanXORExpression(),this.state._fsp--)},synpred48_Formula_fragment:function(){this.match(this.input,73,FormulaParser.FOLLOW_XOR_in_synpred48_Formula1253);this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_synpred48_Formula1256),
this.booleanAndExpression(),this.state._fsp--)},synpred49_Formula_fragment:function(){this.match(this.input,75,FormulaParser.FOLLOW_AND_in_synpred49_Formula1288);this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_synpred49_Formula1291),this.equalityExpression(),this.state._fsp--)},synpred51_Formula_fragment:function(){if(70==this.input.LA(1)||76==this.input.LA(1))this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking){this.state.failed=
!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_synpred51_Formula1332);this.relationalExpression();this.state._fsp--},synpred55_Formula_fragment:function(){if(77<=this.input.LA(1)&&80>=this.input.LA(1))this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_synpred55_Formula1389);
this.additiveExpression();this.state._fsp--},synpred57_Formula_fragment:function(){if(81<=this.input.LA(1)&&82>=this.input.LA(1))this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_synpred57_Formula1443);this.multiplicativeExpression();this.state._fsp--},synpred60_Formula_fragment:function(){if(83<=
this.input.LA(1)&&85>=this.input.LA(1))this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_synpred60_Formula1486);this.arrayExpression();this.state._fsp--},synpred61_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=
!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "');}this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_synpred61_Formula1538);if(!this.state.failed){if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "');
}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred61_Formula1542);this.negationExpression();this.state._fsp--}},synpred62_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "');}this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_synpred62_Formula1551);if(!this.state.failed){if(" "==
this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "');}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred62_Formula1555);this.negationExpression();this.state._fsp--}},synpred64_Formula_fragment:function(){this.match(this.input,87,FormulaParser.FOLLOW_POW_in_synpred64_Formula1610);this.state.failed||
(this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_synpred64_Formula1612),this.unaryOrNegate(),this.state._fsp--)},synpred68_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred68_Formula",' this.input.get(this.input.index()-1).getText()!=" "');}var a=2,a=this.input.LA(1);if(89==a||91==a||116==a)a=1;else if(113==a)a=2;else{if(0<this.state.backtracking){this.state.failed=
!0;return}throw new org.antlr.runtime.NoViableAltException("",119,0,this.input);}switch(a){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_synpred68_Formula1744);this.selector();this.state._fsp--;if(this.state.failed)break;break;case 2:this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred68_Formula1746),this.funCall(),this.state._fsp--}},synpred75_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_material_in_synpred75_Formula1841);this.material();this.state._fsp--},synpred78_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_array_in_synpred78_Formula1856);
this.array();this.state._fsp--},synpred80_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred80_Formula1880);this.funCall();this.state._fsp--},synpred85_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred85_Formula1946)},synpred86_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred86_Formula1952)},synpred87_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred87_Formula1958)},
synpred88_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred88_Formula1963)},synpred93_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred93_Formula1989)},synpred94_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred94_Formula1995)},synpred95_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred95_Formula2000)},synpred96_Formula_fragment:function(){this.match(this.input,
32,FormulaParser.FOLLOW_NEWLINE_in_synpred96_Formula2005)},synpred108_Formula_fragment:function(){this.match(this.input,116,FormulaParser.FOLLOW_116_in_synpred108_Formula2133);this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred108_Formula2135),this.arrayName(),this.state._fsp--)},synpred112_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred112_Formula2173);this.arrayName();this.state._fsp--;if(!this.state.failed){a:do{var a=2;32==this.input.LA(1)&&
(a=1);switch(a){case 1:this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred112_Formula2175);if(this.state.failed)return;break;default:break a}}while(1);this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_synpred112_Formula2178)}},synpred95_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred95_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},
synpred94_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred94_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred80_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred80_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=
!1;return c},synpred49_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred49_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred57_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred57_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;
this.state.failed=!1;return c},synpred68_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred68_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred51_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred51_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);
this.state.backtracking--;this.state.failed=!1;return c},synpred62_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred62_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred64_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred64_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;
this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred93_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred93_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred55_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred55_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=
!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred85_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred85_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred87_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred87_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred48_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred48_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred86_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred86_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred9_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred9_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred75_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred75_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred96_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred96_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred47_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred47_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred8_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred8_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred112_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred112_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred6_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred6_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred5_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred5_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred60_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred60_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred61_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred61_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred108_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred108_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred11_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred11_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred78_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred78_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred88_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred88_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c}},!0);org.antlr.lang.augmentObject(FormulaParser,{DFA5_eotS:"\u0017\uffff",DFA5_eofS:"\u0017\uffff",DFA5_minS:"\u0001&\u0002\x00\b\uffff\u0001\x00\u0002\uffff\u0001\x00\b\uffff",DFA5_maxS:"\u0001q\u0002\x00\b\uffff\u0001\x00\u0002\uffff\u0001\x00\b\uffff",DFA5_acceptS:"\u0003\uffff\u0001\u0002\t\uffff\u0001\u0003\u0001\uffff\u0001\u0006\u0001\b\u0001\t\u0001\n\u0001\u0001\u0001\u0007\u0001\u0004\u0001\u0005",
DFA5_specialS:"\u0001\uffff\u0001\x00\u0001\u0001\b\uffff\u0001\u0002\u0002\uffff\u0001\u0003\b\uffff}>",DFA5_transitionS:"\u0001\r\u0003\uffff\u0001\u000e\x0B\uffff\u0001\u000f\u0005\uffff\u0001\x0B\u0002\uffff\u0001\u0010\u0001\u0003\u0001\u0011\u0002\uffff\u0001\u0012\u0001\u0001\u0001\uffff\u0001\u0002\n\uffff\u0001\u0003\u0005\uffff\u0002\u0003\u0001\uffff\u0001\u0003\u0002\uffff\u0005\u0003\u000e\uffff\u0001\u0003 \u0001\uffff \u0001\uffff         \u0001\uffff   \u0001\uffff        ".split(" ")});
org.antlr.lang.augmentObject(FormulaParser,{DFA5_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eotS),DFA5_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eofS),DFA5_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_minS),DFA5_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_maxS),DFA5_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_acceptS),DFA5_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_specialS),
DFA5_transition:function(){var a=[],b,c=FormulaParser.DFA5_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_transitionS[b]));return a}()});FormulaParser.DFA5=function(a){this.recognizer=a;this.decisionNumber=5;this.eot=FormulaParser.DFA5_eot;this.eof=FormulaParser.DFA5_eof;this.min=FormulaParser.DFA5_min;this.max=FormulaParser.DFA5_max;this.accept=FormulaParser.DFA5_accept;this.special=FormulaParser.DFA5_special;this.transition=FormulaParser.DFA5_transition};
org.antlr.lang.extend(FormulaParser.DFA5,org.antlr.runtime.DFA,{getDescription:function(){return"120:1: expression : ( assignment | logicalExpression | whileLoop | forLoop | forInLoop | ifThenElse | functionDef | returnExp | tryCatch | throwExp );"},specialStateTransition:function(a,b){var c=function(a,b){switch(a){case 0:b.LA(1);var c=b.index();b.rewind();a=-1;this.synpred5_Formula()?a=19:this.synpred6_Formula()&&(a=3);b.seek(c);if(0<=a)return a;break;case 1:b.LA(1);c=b.index();b.rewind();a=-1;this.synpred5_Formula()?
a=19:this.synpred6_Formula()&&(a=3);b.seek(c);if(0<=a)return a;break;case 2:b.LA(1);c=b.index();b.rewind();a=-1;this.synpred6_Formula()?a=3:this.synpred11_Formula()&&(a=20);b.seek(c);if(0<=a)return a;break;case 3:if(b.LA(1),c=b.index(),b.rewind(),a=-1,this.synpred8_Formula()?a=21:this.synpred9_Formula()&&(a=22),b.seek(c),0<=a)return a}}.call(this.recognizer,a,b);if(!org.antlr.lang.isUndefined(c))return c;if(0<this.recognizer.state.backtracking)return this.recognizer.state.failed=!0,-1;c=new org.antlr.runtime.NoViableAltException(this.getDescription(),
5,a,b);this.error(c);throw c;},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA57_eotS:"\x0B\uffff",DFA57_eofS:"\x0B\uffff",DFA57_minS:"\u0001<\u0003\uffff\u0001\x00\u0006\uffff",DFA57_maxS:"\u0001b\u0003\uffff\u0001\x00\u0006\uffff",DFA57_acceptS:"\u0001\uffff\u0001\u0001\u0001\u0002\u0001\u0003\u0001\uffff\u0001\u0005\u0001\u0006\u0001\u0007\u0001\b\u0001\t\u0001\u0004",DFA57_specialS:"\u0004\uffff\u0001\x00\u0006\uffff}>",DFA57_transitionS:"\u0001\b\u0003\uffff\u0001\t\u0004\uffff\u0001\u0005\u0001\uffff\u0001\u0006\u0011\uffff\u0001\u0007\u0001\uffff\u0001\u0004\u0002\uffff\u0001\u0003\u0002\u0001\u0002\u0002    \u0001\uffff      ".split(" ")});
org.antlr.lang.augmentObject(FormulaParser,{DFA57_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eotS),DFA57_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eofS),DFA57_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_minS),DFA57_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_maxS),DFA57_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_acceptS),DFA57_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_specialS),
DFA57_transition:function(){var a=[],b,c=FormulaParser.DFA57_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_transitionS[b]));return a}()});FormulaParser.DFA57=function(a){this.recognizer=a;this.decisionNumber=57;this.eot=FormulaParser.DFA57_eot;this.eof=FormulaParser.DFA57_eof;this.min=FormulaParser.DFA57_min;this.max=FormulaParser.DFA57_max;this.accept=FormulaParser.DFA57_accept;this.special=FormulaParser.DFA57_special;this.transition=FormulaParser.DFA57_transition};
org.antlr.lang.extend(FormulaParser.DFA57,org.antlr.runtime.DFA,{getDescription:function(){return"283:1: value : ( number | bool | string | material | IDENT | primitive | array | anonFunctionDef | newObject );"},specialStateTransition:function(a,b){var c=function(a,b){switch(a){case 0:b.LA(1);var c=b.index();b.rewind();a=-1;this.synpred75_Formula()?a=10:this.synpred78_Formula()&&(a=7);b.seek(c);if(0<=a)return a}}.call(this.recognizer,a,b);if(!org.antlr.lang.isUndefined(c))return c;if(0<this.recognizer.state.backtracking)return this.recognizer.state.failed=
!0,-1;c=new org.antlr.runtime.NoViableAltException(this.getDescription(),57,a,b);this.error(c);throw c;},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA58_eotS:"\u001a\uffff",DFA58_eofS:"\u0001\u0002\u0019\uffff",DFA58_minS:"\u0001 \u0001\x00\u0018\uffff",DFA58_maxS:"\u0001t\u0001\x00\u0018\uffff",DFA58_acceptS:"\u0002\uffff\u0001\u0002\u0016\uffff\u0001\u0001",DFA58_specialS:"\u0001\uffff\u0001\x00\u0018\uffff}>",DFA58_transitionS:"\u0001\u0002\u000f\uffff\u0001\u0002\u0002\uffff\u0001\u0002\u0003\uffff\u0001\u0002\r\uffff\u0002\u0002\u0001\uffff\u0002\u0002\u0001\uffff\r\u0002\u0001\uffff\u0005\u0002\u0001\uffff\u0001\u0002\u0011\uffff\u0001\u0001\u0001\u0002\u0001\uffff\u0001\u0002 \u0001\uffff                        ".split(" ")});
org.antlr.lang.augmentObject(FormulaParser,{DFA58_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eotS),DFA58_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eofS),DFA58_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_minS),DFA58_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_maxS),DFA58_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_acceptS),DFA58_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_specialS),
DFA58_transition:function(){var a=[],b,c=FormulaParser.DFA58_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_transitionS[b]));return a}()});FormulaParser.DFA58=function(a){this.recognizer=a;this.decisionNumber=58;this.eot=FormulaParser.DFA58_eot;this.eof=FormulaParser.DFA58_eof;this.min=FormulaParser.DFA58_min;this.max=FormulaParser.DFA58_max;this.accept=FormulaParser.DFA58_accept;this.special=FormulaParser.DFA58_special;this.transition=FormulaParser.DFA58_transition};
org.antlr.lang.extend(FormulaParser.DFA58,org.antlr.runtime.DFA,{getDescription:function(){return"296:22: ( funCall )?"},specialStateTransition:function(a,b){var c=function(a,b){switch(a){case 0:b.LA(1);var c=b.index();b.rewind();a=-1;if(this.synpred80_Formula())a=25;else if(" "==this.input.get(this.input.index()-1).getText()||" "!=this.input.get(this.input.index()-1).getText())a=2;b.seek(c);if(0<=a)return a}}.call(this.recognizer,a,b);if(!org.antlr.lang.isUndefined(c))return c;if(0<this.recognizer.state.backtracking)return this.recognizer.state.failed=
!0,-1;c=new org.antlr.runtime.NoViableAltException(this.getDescription(),58,a,b);this.error(c);throw c;},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA65_eotS:"\u0004\uffff",DFA65_eofS:"\u0004\uffff",DFA65_minS:"\u0001 \u0001\uffff\u0001 \u0001\uffff",DFA65_maxS:"\u0001q\u0001\uffff\u0001q\u0001\uffff",DFA65_acceptS:"\u0001\uffff\u0001\u0001\u0001\uffff\u0001\u0002",DFA65_specialS:"\u0004\uffff}>",DFA65_transitionS:["\u0001\u0002\u001b\uffff\u0001\u0001\u0003\uffff\u0001\u0001\u0004\uffff\u0001\u0001\u0001\uffff\u0001\u0001\n\uffff\u0002\u0001\u0004\uffff\u0002\u0001\u0001\u0003\u0001\u0001\u0002\uffff\u0005\u0001\u000e\uffff\u0001\u0001",
"","\u0001\u0002\u001b\uffff\u0001\u0001\u0003\uffff\u0001\u0001\u0004\uffff\u0001\u0001\u0001\uffff\u0001\u0001\n\uffff\u0001\u0001\u0005\uffff\u0002\u0001\u0001\u0003\u0001\u0001\u0002\uffff\u0005\u0001\u000e\uffff\u0001\u0001",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA65_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eotS),DFA65_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eofS),DFA65_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_minS),
DFA65_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_maxS),DFA65_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_acceptS),DFA65_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_specialS),DFA65_transition:function(){var a=[],b,c=FormulaParser.DFA65_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_transitionS[b]));return a}()});FormulaParser.DFA65=function(a){this.recognizer=
a;this.decisionNumber=65;this.eot=FormulaParser.DFA65_eot;this.eof=FormulaParser.DFA65_eof;this.min=FormulaParser.DFA65_min;this.max=FormulaParser.DFA65_max;this.accept=FormulaParser.DFA65_accept;this.special=FormulaParser.DFA65_special;this.transition=FormulaParser.DFA65_transition};org.antlr.lang.extend(FormulaParser.DFA65,org.antlr.runtime.DFA,{getDescription:function(){return"309:16: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null});org.antlr.lang.augmentObject(FormulaParser,
{DFA72_eotS:"\u0004\uffff",DFA72_eofS:"\u0004\uffff",DFA72_minS:"\u0001 \u0001\uffff\u0001 \u0001\uffff",DFA72_maxS:"\u0001q\u0001\uffff\u0001q\u0001\uffff",DFA72_acceptS:"\u0001\uffff\u0001\u0001\u0001\uffff\u0001\u0002",DFA72_specialS:"\u0004\uffff}>",DFA72_transitionS:["\u0001\u0002\u001b\uffff\u0001\u0001\u0003\uffff\u0001\u0001\u0004\uffff\u0001\u0001\u0001\uffff\u0001\u0001\n\uffff\u0002\u0001\u0004\uffff\u0002\u0001\u0001\uffff\u0001\u0001\u0001\u0003\u0001\uffff\u0005\u0001\u000e\uffff\u0001\u0001",
"","\u0001\u0002\u001b\uffff\u0001\u0001\u0003\uffff\u0001\u0001\u0004\uffff\u0001\u0001\u0001\uffff\u0001\u0001\n\uffff\u0001\u0001\u0005\uffff\u0002\u0001\u0001\uffff\u0001\u0001\u0001\u0003\u0001\uffff\u0005\u0001\u000e\uffff\u0001\u0001",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA72_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eotS),DFA72_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eofS),DFA72_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_minS),
DFA72_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_maxS),DFA72_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_acceptS),DFA72_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_specialS),DFA72_transition:function(){var a=[],b,c=FormulaParser.DFA72_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_transitionS[b]));return a}()});FormulaParser.DFA72=function(a){this.recognizer=
a;this.decisionNumber=72;this.eot=FormulaParser.DFA72_eot;this.eof=FormulaParser.DFA72_eof;this.min=FormulaParser.DFA72_min;this.max=FormulaParser.DFA72_max;this.accept=FormulaParser.DFA72_accept;this.special=FormulaParser.DFA72_special;this.transition=FormulaParser.DFA72_transition};org.antlr.lang.extend(FormulaParser.DFA72,org.antlr.runtime.DFA,{getDescription:function(){return"310:19: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null});org.antlr.lang.augmentObject(FormulaParser,
{DFA85_eotS:"\u000f\uffff",DFA85_eofS:"\u000f\uffff",DFA85_minS:"\u0001 \u0001\x00\u0006\uffff\u0001\x00\u0006\uffff",DFA85_maxS:"\u0001q\u0001\x00\u0006\uffff\u0001\x00\u0006\uffff",DFA85_acceptS:"\u0002\uffff\u0001\u0002\u0007\uffff\u0001\u0001\u0004\uffff",DFA85_specialS:"\u0001\uffff\u0001\x00\u0006\uffff\u0001\u0001\u0006\uffff}>",DFA85_transitionS:"\u0001\u0002\u001b\uffff\u0001\u0002\u0003\uffff\u0001\u0002\u0004\uffff\u0001\b\u0001\uffff\u0001\u0002\n\uffff\u0001\u0002\u0001\n\u0004\uffff\u0002\u0002\u0001\uffff\u0001\u0002\u0002\uffff\u0001\u0001\u0004\u0002\u000e\uffff\u0001\u0002 \u0001\uffff       \u0001\uffff      ".split(" ")});
org.antlr.lang.augmentObject(FormulaParser,{DFA85_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eotS),DFA85_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eofS),DFA85_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_minS),DFA85_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_maxS),DFA85_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_acceptS),DFA85_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_specialS),
DFA85_transition:function(){var a=[],b,c=FormulaParser.DFA85_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_transitionS[b]));return a}()});FormulaParser.DFA85=function(a){this.recognizer=a;this.decisionNumber=85;this.eot=FormulaParser.DFA85_eot;this.eof=FormulaParser.DFA85_eof;this.min=FormulaParser.DFA85_min;this.max=FormulaParser.DFA85_max;this.accept=FormulaParser.DFA85_accept;this.special=FormulaParser.DFA85_special;this.transition=FormulaParser.DFA85_transition};
org.antlr.lang.extend(FormulaParser.DFA85,org.antlr.runtime.DFA,{getDescription:function(){return"331:2: ( arrayName ( NEWLINE )* COLON )?"},specialStateTransition:function(a,b){var c=function(a,b){switch(a){case 0:b.LA(1);var c=b.index();b.rewind();a=this.synpred112_Formula()?10:2;b.seek(c);if(0<=a)return a;break;case 1:if(b.LA(1),c=b.index(),b.rewind(),a=this.synpred112_Formula()?10:2,b.seek(c),0<=a)return a}}.call(this.recognizer,a,b);if(!org.antlr.lang.isUndefined(c))return c;if(0<this.recognizer.state.backtracking)return this.recognizer.state.failed=
!0,-1;c=new org.antlr.runtime.NoViableAltException(this.getDescription(),85,a,b);this.error(c);throw c;},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{tokenNames:"<invalid> <EOR> <DOWN> <UP> NEGATE ASSIGN FUNCALL MATERIAL UNIT POWER DEFAULTS PARAMS UNITCLUMP ARRAY LINES WHILE IFTHENELSE ELSE FOR FORIN FUNCTION ANONFUNCTION NUMBER LABEL RANGE INNER ASSIGNED SELECTOR DOTSELECTOR NEW TRYCATCH THROW NEWLINE W H I L E WHILESTATEMENT F O R FORSTATEMENT M FROMSTATEMENT N INSTATEMENT T TOSTATEMENT B Y BYSTATEMENT P LOOPSTATEMENT IFSTATEMENT THENSTATEMENT S ELSESTATEMENT U C FUNCTIONSTATEMENT D ENDBLOCK RETURNSTATEMENT NEWSTATEMENT TRYSTATEMENT A CATCHSTATEMENT THROWSTATEMENT IDENT EQUALS PRIMITIVE OR XOR X AND NOTEQUALS LT LTEQ GT GTEQ PLUS MINUS MULT DIV MOD COLON POW NOT LARR RARR LCURL RCURL COMMA STRING INTEGER FLOAT TRUE FALSE PER CUBED SQUARED Q LBRACKET RBRACKET COMMENT LINE_COMMENT WS G J K V Z '(' ')' '<-' '.'".split(" "),
FOLLOW_NEWLINE_in_lines160:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_expression_in_lines164:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_lines168:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_EOF_in_lines171:new org.antlr.runtime.BitSet([0,2420114496,3406037171,131079]),FOLLOW_EOF_in_lines176:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_expression508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_expression514:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_whileLoop_in_expression520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_expression526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_expression532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_ifThenElse_in_expression538:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_expression544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_returnExp_in_expression550:new org.antlr.runtime.BitSet([2,0]),FOLLOW_tryCatch_in_expression556:new org.antlr.runtime.BitSet([2,0]),FOLLOW_throwExp_in_expression562:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_RETURNSTATEMENT_in_returnExp574:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_returnExp577:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_innerBlock590:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_innerBlock594:new org.antlr.runtime.BitSet([2,2420114497,3406037171,131079]),FOLLOW_WHILESTATEMENT_in_whileLoop619:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_whileLoop621:new org.antlr.runtime.BitSet([0,
1]),FOLLOW_NEWLINE_in_whileLoop623:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_whileLoop626:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_whileLoop629:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_whileLoop631:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forLoop652:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forLoop654:new org.antlr.runtime.BitSet([0,4096]),FOLLOW_FROMSTATEMENT_in_forLoop656:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop658:new org.antlr.runtime.BitSet([0,65536]),FOLLOW_TOSTATEMENT_in_forLoop660:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop662:new org.antlr.runtime.BitSet([0,524289]),FOLLOW_BYSTATEMENT_in_forLoop665:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop667:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forLoop671:new org.antlr.runtime.BitSet([0,
3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forLoop674:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forLoop677:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forLoop679:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forInLoop707:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forInLoop709:new org.antlr.runtime.BitSet([0,16384]),FOLLOW_INSTATEMENT_in_forInLoop711:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forInLoop713:new org.antlr.runtime.BitSet([0,
1]),FOLLOW_NEWLINE_in_forInLoop715:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forInLoop718:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forInLoop721:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forInLoop723:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IFSTATEMENT_in_ifThenElse748:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse750:new org.antlr.runtime.BitSet([0,8388608]),
FOLLOW_THENSTATEMENT_in_ifThenElse752:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse755:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse758:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse762:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse764:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse766:new org.antlr.runtime.BitSet([0,
8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse768:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse770:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse773:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse778:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse780:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse783:new org.antlr.runtime.BitSet([0,1073741824]),
FOLLOW_ENDBLOCK_in_ifThenElse787:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse789:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef820:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef822:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_functionDef824:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_functionDef827:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_functionDef831:new org.antlr.runtime.BitSet([0,
0,3389259776,7]),FOLLOW_defaultValue_in_functionDef834:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef839:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef841:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef848:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef850:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_functionDef852:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef854:new org.antlr.runtime.BitSet([0,
0,536870912,262144]),FOLLOW_114_in_functionDef861:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_functionDef863:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_functionDef866:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_functionDef869:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef871:new org.antlr.runtime.BitSet([2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch904:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch906:new org.antlr.runtime.BitSet([0,
2420114497,3406037179,131079]),FOLLOW_innerBlock_in_tryCatch909:new org.antlr.runtime.BitSet([0,0,8,0]),FOLLOW_CATCHSTATEMENT_in_tryCatch911:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_tryCatch913:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch915:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_tryCatch919:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_tryCatch921:new org.antlr.runtime.BitSet([0,0,2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch923:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_THROWSTATEMENT_in_throwExp945:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_primaryExpression_in_throwExp947:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_anonFunctionDef970:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_anonFunctionDef973:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_anonFunctionDef977:new org.antlr.runtime.BitSet([0,
0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef980:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef985:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef987:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef994:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef996:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_anonFunctionDef998:new org.antlr.runtime.BitSet([0,0,3389259776,
7]),FOLLOW_defaultValue_in_anonFunctionDef1000:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_anonFunctionDef1007:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_NEWLINE_in_anonFunctionDef1012:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_anonFunctionDef1015:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_anonFunctionDef1018:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_expression_in_anonFunctionDef1025:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assignment1067:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_assignment1069:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_assignment1072:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_assignment1076:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1078:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1083:new org.antlr.runtime.BitSet([0,
0,32,0]),FOLLOW_IDENT_in_assignment1085:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1092:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1094:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_assignment1096:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1098:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_assignment1105:new org.antlr.runtime.BitSet([0,0,0,524288]),FOLLOW_115_in_assignment1107:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1109:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_assignment1137:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1141:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_COMMA_in_assignment1145:new org.antlr.runtime.BitSet([0,0,160,0]),FOLLOW_PRIMITIVE_in_assignment1148:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1152:new org.antlr.runtime.BitSet([0,
0,536870912,524288]),FOLLOW_115_in_assignment1158:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1160:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assigned1186:new org.antlr.runtime.BitSet([2,0,167772160,1048576]),FOLLOW_selector_in_assigned1188:new org.antlr.runtime.BitSet([2,0]),FOLLOW_booleanXORExpression_in_logicalExpression1214:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_OR_in_logicalExpression1217:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_logicalExpression1220:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_booleanAndExpression_in_booleanXORExpression1250:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_XOR_in_booleanXORExpression1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_booleanXORExpression1256:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_equalityExpression_in_booleanAndExpression1285:new org.antlr.runtime.BitSet([2,
0,2048,0]),FOLLOW_AND_in_booleanAndExpression1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_booleanAndExpression1291:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_relationalExpression_in_equalityExpression1322:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_set_in_equalityExpression1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_equalityExpression1332:new org.antlr.runtime.BitSet([2,0,4160,0]),
FOLLOW_additiveExpression_in_relationalExpression1374:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_set_in_relationalExpression1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_relationalExpression1389:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_multiplicativeExpression_in_additiveExpression1432:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_set_in_additiveExpression1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),
FOLLOW_multiplicativeExpression_in_additiveExpression1443:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_arrayExpression_in_multiplicativeExpression1473:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_set_in_multiplicativeExpression1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_multiplicativeExpression1486:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_negationExpression_in_arrayExpression1532:new org.antlr.runtime.BitSet([2,0,4194304,
0]),FOLLOW_COLON_in_arrayExpression1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1542:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negationExpression1580:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_powerExpression_in_negationExpression1582:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_powerExpression_in_negationExpression1596:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unaryExpression_in_powerExpression1607:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_powerExpression1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_powerExpression1612:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_unaryExpression_in_unaryOrNegate1639:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_unaryOrNegate1645:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_unaryExpression_in_unaryOrNegate1647:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NOT_in_unaryExpression1675:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_innerPrimaryExpression_in_unaryExpression1678:new org.antlr.runtime.BitSet([2,0]),FOLLOW_innerPrimaryExpression_in_unaryExpression1687:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selectionExpression_in_innerPrimaryExpression1718:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primaryExpression_in_selectionExpression1738:new org.antlr.runtime.BitSet([2,
0,167772160,1179648]),FOLLOW_selector_in_selectionExpression1744:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_selectionExpression1746:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_113_in_funCall1761:new org.antlr.runtime.BitSet([0,268435456,3406037153,393223]),FOLLOW_logicalExpression_in_funCall1765:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_funCall1768:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_funCall1770:new org.antlr.runtime.BitSet([0,
0,536870912,262144]),FOLLOW_114_in_funCall1777:new org.antlr.runtime.BitSet([2,0]),FOLLOW_113_in_primaryExpression1798:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_primaryExpression1801:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_primaryExpression1803:new org.antlr.runtime.BitSet([2,0]),FOLLOW_value_in_primaryExpression1809:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_value1823:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_value1829:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_string_in_value1835:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_value1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_value1846:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primitive_in_value1851:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_value1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_anonFunctionDef_in_value1861:new org.antlr.runtime.BitSet([2,0]),FOLLOW_newObject_in_value1866:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWSTATEMENT_in_newObject1876:new org.antlr.runtime.BitSet([0,
0,32,0]),FOLLOW_IDENT_in_newObject1878:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_newObject1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_negnumber_in_defaultValue1906:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_defaultValue1912:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_defaultValue1918:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_defaultValue1924:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_defaultValue1930:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_LARR_in_array1944:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_NEWLINE_in_array1946:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_label_in_array1950:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1952:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_COMMA_in_array1956:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array1958:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),
FOLLOW_label_in_array1961:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1963:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1970:new org.antlr.runtime.BitSet([0,1,67108864,0]),FOLLOW_RARR_in_array1973:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_array1987:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_NEWLINE_in_array1989:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_label_in_array1993:new org.antlr.runtime.BitSet([0,
1,805306368,0]),FOLLOW_NEWLINE_in_array1995:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_COMMA_in_array1998:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array2000:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array2003:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2005:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2012:new org.antlr.runtime.BitSet([0,1,268435456,0]),FOLLOW_RCURL_in_array2015:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_minarray_in_selector2036:new org.antlr.runtime.BitSet([2,0]),FOLLOW_dotselector_in_selector2040:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_minarray2067:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2072:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2074:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_COMMA_in_minarray2078:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2082:new org.antlr.runtime.BitSet([0,
0,603979776,0]),FOLLOW_MULT_in_minarray2084:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_RARR_in_minarray2091:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_minarray2097:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2102:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2104:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_COMMA_in_minarray2108:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),
FOLLOW_logicalExpression_in_minarray2112:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2114:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_RCURL_in_minarray2121:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_dotselector2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_dotselector2135:new org.antlr.runtime.BitSet([2,0,0,1048576]),FOLLOW_set_in_arrayName0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_label2173:new org.antlr.runtime.BitSet([0,
1,4194304,0]),FOLLOW_NEWLINE_in_label2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_label2178:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_NEWLINE_in_label2182:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_logicalExpression_in_label2185:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_number0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negnumber2261:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_number_in_negnumber2263:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_set_in_bool0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_material2415:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_material2417:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_material2421:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_RCURL_in_material2423:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460:new org.antlr.runtime.BitSet([2,
0,0,8]),FOLLOW_PER_in_unitMultiplicativeExpression2464:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_set_in_unitInnerMultiplicativeExpression2487:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494:new org.antlr.runtime.BitSet([2,
0,1572864,0]),FOLLOW_INTEGER_in_unitClump2510:new org.antlr.runtime.BitSet([0,0,1048576,0]),FOLLOW_DIV_in_unitClump2512:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitPowerExpression_in_unitClump2515:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2517:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitPowerExpression_in_unitClump2543:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2545:new org.antlr.runtime.BitSet([2,
0,0,32]),FOLLOW_SQUARED_in_unitClump2548:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unit_in_unitPowerExpression2610:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_unitPowerExpression2614:new org.antlr.runtime.BitSet([0,0,2147745792,1]),FOLLOW_MINUS_in_unitPowerExpression2617:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_set_in_unitPowerExpression2620:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_IDENT_in_unit2638:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_IDENT_in_unit2641:new org.antlr.runtime.BitSet([2,
0,32,0]),FOLLOW_113_in_unit2658:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_unit2660:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_unit2662:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_primitive2731:new org.antlr.runtime.BitSet([2,0]),FOLLOW_STRING_in_string3200:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_synpred5_Formula508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_synpred6_Formula514:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_forLoop_in_synpred8_Formula526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_synpred9_Formula532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_synpred11_Formula544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_OR_in_synpred47_Formula1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_synpred47_Formula1220:new org.antlr.runtime.BitSet([2,0]),FOLLOW_XOR_in_synpred48_Formula1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,
131079]),FOLLOW_booleanAndExpression_in_synpred48_Formula1256:new org.antlr.runtime.BitSet([2,0]),FOLLOW_AND_in_synpred49_Formula1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_synpred49_Formula1291:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred51_Formula1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_synpred51_Formula1332:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred55_Formula1378:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_additiveExpression_in_synpred55_Formula1389:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred57_Formula1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_synpred57_Formula1443:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred60_Formula1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_synpred60_Formula1486:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred61_Formula1538:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred61_Formula1542:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred62_Formula1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred62_Formula1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_POW_in_synpred64_Formula1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_synpred64_Formula1612:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selector_in_synpred68_Formula1744:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_funCall_in_synpred68_Formula1746:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_synpred75_Formula1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_synpred78_Formula1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred80_Formula1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred85_Formula1946:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred86_Formula1952:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred87_Formula1958:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_NEWLINE_in_synpred88_Formula1963:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred93_Formula1989:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred94_Formula1995:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred95_Formula2000:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred96_Formula2005:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_synpred108_Formula2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_synpred108_Formula2135:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_arrayName_in_synpred112_Formula2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_synpred112_Formula2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_synpred112_Formula2178:new org.antlr.runtime.BitSet([2,0])})})();function RandList(){this.vals=[]}RandList.prototype.get=function(a){if(a>this.vals.length-1)for(var b=this.vals.length;b<=a;b++)this.vals.push(Math.random());return this.vals[a]};function getRandPos(){return void 0===window.timeStep?0:Math.floor(time.value/timeStep.value)}
function Rand(a,b){isUndefined(window.simulate)||(simulate.stochastic=!0);if(null!=a)return Rand()*(b-a)+(0+a);if(isUndefined(window.simulate)||1==simulate.RKOrder)return Math.random();var c=getRandPos();c!=simulate.lastRandPos&&(simulate.randLoc=-1,simulate.lastRandPos=c);for(;simulate.previousRandLists.length<=c;)simulate.previousRandLists.push(new RandList);simulate.randLoc+=1;return simulate.previousRandLists[c].get(simulate.randLoc)}
function RandNormal(a,b){null==a&&(a=0);null==b&&(b=1);return Math.sqrt(-2*Math.log(1-Rand()))*Math.cos(6.283186*Rand())*b+(0+a)}function RandExp(a){null==a&&(a=1);return-(1/a)*Math.log(Rand())}function RandLognormal(a,b){var c=Math.log(a)-0.5*Math.log(1+Math.pow(b/a,2)),d=Math.sqrt(Math.log(1+Math.pow(b/a,2)));return Math.exp(RandNormal(c,d))}function RandBinomial(a,b){for(var c=0,d=1;d<=a;d++)Rand()<=b&&(c+=1);return c}
function RandNegativeBinomial(a,b){for(var c=0,d=0;d<a;)Rand()<=b&&(d+=1),c+=1;return c}function RandPoisson(a){if(50>a){a=Math.exp(-a);for(var b=0,c=1;b+=1,c*=Rand(),c>a;);return b-1}for(var b=0.767-3.36/a,c=Math.PI/Math.sqrt(3*a),d=c*a,b=Math.log(b)-a-Math.log(c);;){var e=Rand(),f=(d-Math.log((1-e)/e))/c,e=Math.floor(f+0.5);if(!(0>e)){var g=Rand(),f=d-c*f,g=f+Math.log(g/Math.pow(1+Math.exp(f),2)),f=b+e*Math.log(a)-jStat.gammaln(e+1);if(g<=f)return e}}}
function RandGamma(a,b){for(var c=1,d=1;d<=a;d++)c*=Rand();return-b*Math.log(c)}function RandBeta(a,b){var c=RandGamma(a,1),d=RandGamma(b,1);return c/(c+d)}function RandTriangular(a,b,c){a=0+a;b=0+b;c=0+c;if(a==b)throw"MSG: Maximum can't equal the minimum for the triangular distribution.";if(c<a||c>b)throw"MSG: The peak must be within the maximum and minimum for the triangular distribution.";var d=(c-a)/(b-a),e=Rand();return e<d?a+Math.sqrt(e*(b-a)*(c-a)):b-Math.sqrt((1-e)*(b-a)*(b-c))}
function RandDist(a,b){if(a.length!=b.length)throw"MSG: The lengths of the 'x' and 'y' vectors must be the same.";if(2>a.length)throw"MSG: There must be at least 2 points in a distribution to generate a random number.";for(var c=0,d=0;d<a.length-1;d++)c+=(a[d+1]-a[d])*(b[d+1]+b[d])/2;if(0==c)throw"MSG: The area of the distribution cannot be 0.";for(var e=c*Rand(),d=c=0;d<a.length-1;d++){var f=(a[d+1]-a[d])*(b[d+1]+b[d])/2;if(e>c&&e<c+f)return c=e-c,e=(b[d+1]-b[d])/(a[d+1]-a[d]),c=0==e?c/b[d]:(-b[d]+
Math.sqrt(Math.pow(b[d],2)+2*e*c))/e,a[d]+c;c+=f}};(function(a,b,c,d,e,f,g){function k(a){var b,d,e=this,f=a.length,g=0,k=e.i=e.j=e.m=0;e.S=[];e.c=[];for(f||(a=[f++]);g<c;)e.S[g]=g++;for(g=0;g<c;g++)b=e.S[g],k=k+b+a[g%f]&c-1,d=e.S[k],e.S[g]=d,e.S[k]=b;e.g=function(a){var b=e.S,d=e.i+1&c-1,f=b[d],g=e.j+f&c-1,k=b[g];b[d]=k;b[g]=f;for(var l=b[f+k&c-1];--a;)d=d+1&c-1,f=b[d],g=g+f&c-1,k=b[g],b[d]=k,b[g]=f,l=l*c+b[f+k&c-1];e.i=d;e.j=g;return l};e.g(c)}function l(a,b,c,d,e){c=[];e=typeof a;if(b&&"object"==e)for(d in a)if(5>d.indexOf("S"))try{c.push(l(a[d],
b-1))}catch(f){}return c.length?c:a+("string"!=e?"\x00":"")}function m(a,b,d,e){a+="";for(e=d=0;e<a.length;e++){var f=b,g=e&c-1,k=(d^=19*b[e&c-1])+a.charCodeAt(e);f[g]=k&c-1}a="";for(e in b)a+=String.fromCharCode(b[e]);return a}b.seedrandom=function(n,p){var q=[],u;n=m(l(p?[n,a]:arguments.length?n:[(new Date).getTime(),a,window],3),q);u=new k(q);m(u.S,a);b.random=function(){for(var a=u.g(d),b=g,k=0;a<e;)a=(a+k)*c,b*=c,k=u.g(1);for(;a>=f;)a/=2,b/=2,k>>>=1;return(a+k)/b};return n};g=b.pow(c,d);e=b.pow(2,
e);f=2*e;m(b.random(),a)})([],Math,256,6,52);if(!sn){var sn=SchemeNumber,fn=sn.fn,ns=fn["number->string"];sn.raise=function(a,b){if("division by exact zero"==b)throw"MSG: You cannot divide by 0.";throw"BigNum Error: "+b;}}var varBank={},functionBank=varBank,functionLoaders=[];
function bootCalc(){functionBank=varBank={};varBank["-parent"]=null;varBank.e=new Material(2.718281828459045);varBank.pi=new Material(3.141592653589793);varBank.phi=new Material(1.61803399);for(var a=0;a<functionLoaders.length;a++)functionLoaders[a]();varBank.stringbase=StringBase;varBank.vectorbase=VectorBase;window.ObjectBase&&(varBank.objectbase=ObjectBase);window.AgentBase&&(varBank.agentbase=AgentBase)}Agent||(Agent=function(){});Agents||(Agents=function(){});
var PrimitiveStore=function(a,b){this.primitive=a;this.type=b};Boolean.prototype.toNum=function(){return this.valueOf()};String.prototype.toNum=function(){return this.valueOf()};Number.prototype.toNum=function(){return this.valueOf()};Function.prototype.toNum=function(){return this([])};function UserFunction(){}UserFunction.prototype.toNum=function(){return this.fn?this.fn([]):this([])};
var StringObject={},StringBase,VectorObject={},VectorBase={},Vector=function(a,b,c){this.parent=c?c:VectorBase;this.items=a;this.names=b;this.namesLC=void 0;if(b)for(this.namesLC=[],a=0;a<b.length;a++)b[a]?this.namesLC.push(b[a].toLowerCase()):this.namesLC.push(void 0)};Vector.prototype.toNum=function(){if(this.isNum)return this;for(var a=this.fullClone(),b=0;b<a.items.length;b++)a.items[b]=a.items[b].toNum();a.isNum=!0;return a};
Vector.prototype.toString=function(){for(var a=[],b=0;b<this.items.length;b++){var c=prepareDisplay(this.items[b].toNum().toString());this.names&&this.names[b]&&(c=this.names[b]+": "+c);a.push(c)}return"{"+a.join(", ")+"}"};Vector.prototype.length=function(){return this.items.length};Vector.prototype.cloneCombine=function(a,b,c,d){return this.fullClone().combine(a,b,c,d)};
Vector.prototype.combine=function(a,b,c,d){if(a instanceof Vector&&this.length()!=a.length()&&!this.names&&!a.names)throw"MSG: Vectors must have equal length when combined.";if(a instanceof Vector&&this.names&&a.names){if(!d&&a.depth()>this.depth())return a.combine(this,b,!c);if(!this.keysMatch(a.namesLC)){if(this.items[0]instanceof Vector){for(d=0;d<this.items.length;d++)this.items[d].combine(a,b,c,!0);return this}throw"MSG: Keys do not match for vector operation.";}}for(d=0;d<this.length();d++){var e;
if(a instanceof Vector)if(this.names&&a.names){e=a.namesLC.indexOf(this.namesLC[d]);"*"==this.names&&(e=-2);if(isUndefined(e)||-1==e)e=a.names.indexOf("*");if(isUndefined(e)||-1==e)throw"MSG: Mismatched keys for vector operation.";e=-2==e?void 0:a.items[e]}else e=a.items[d];else e=a;isDefined(e)&&(this.items[d]=c?b(e,this.items[d]):b(this.items[d],e))}if(this.names&&-1<this.names.indexOf("*")&&a instanceof Vector&&a.names)for(e=this.items[this.names.indexOf("*")],d=0;d<a.names.length;d++)!a.names[d]||
-1!=this.namesLC.indexOf(a.namesLC[d])&&"*"!=a.names||(c?this.items.push(b(a.items[d],e)):this.items.push(b(e,a.items[d])),this.names.push(a.names[d]),this.namesLC.push(a.namesLC[d]));return this};
Vector.prototype.collapseDimensions=function(a){if(a instanceof Vector){if(this.depth()==a.depth())return this;for(var b=[],c=this,d=0;d<this.depth();d++)a instanceof Vector?keysMatch(c.namesLC,a.namesLC)?(b.push("*"),c=c.items[0],a=a.items[0]):(b.push(function(a){return functionBank.sum(a[0].items)}),c=c.items[0]):(b.push(function(a){return functionBank.sum(a[0].items)}),c=c.items[0]);if(a.items)throw"MSG: Keys do not match for vector collapsing.";return selectFromMatrix(this,b)}return functionBank.sum([functionBank.flatten([this])])};
function keysMatch(a,b){if(-1==b.indexOf("*"))for(var c=0;c<a.length;c++)if("*"!=a[c]&&(isUndefined(a[c])||-1==b.indexOf(a[c])))return!1;if(-1==a.indexOf("*"))for(c=0;c<b.length;c++)if("*"!=b[c]&&(isUndefined(b[c])||-1==a.indexOf(b[c])))return!1;return!0}Vector.prototype.depth=function(){return 0!=this.items.length&&this.items[0]instanceof Vector?this.items[0].depth()+1:1};Vector.prototype.keysMatch=function(a){return this.names?keysMatch(this.namesLC,a):!1};Vector.prototype.cloneApply=function(a){return this.fullClone().apply(a)};
Vector.prototype.apply=function(a){for(var b=0;b<this.items.length;b++)this.items[b]=a(this.items[b],this.names?this.names[b]:void 0);return this};Vector.prototype.stackApply=function(a){return 1==this.depth()?a(this):this.stack().recurseApply(a)};
Vector.prototype.stack=function(a){var b=[];a=a||[0];for(var c=this.select(a),d=1;d<this.items.length;d++){a[0]=d;var e=this.select(a);if(c instanceof Vector&&e instanceof Vector){if(c.names&&!e.names||e.names&&!c.names)throw"MSG: Mismatched keys for vector collapsing.";if(c.items.length!=e.items.length)throw"MSG: Vectors of unequal size.";}else if(!(c instanceof Vector||e instanceof Vector))throw"MSG: Mismatched keys for vector collapsing.";}a[0]=0;a.push(0);for(d=0;d<c.items.length;d++)if(a[a.length-
1]=c.names?c.namesLC[d]:d,c.items[d]instanceof Vector)b.push(this.stack(a.slice()));else{for(var e=[],f=0;f<this.items.length;f++){var g=a.slice();g[0]=f;g=this.select(g);if(g instanceof Vector)throw"MSG: Number where vector expected in vector collapsing.";e.push(g)}e=new Vector(e);e.terminateApply=!0;b.push(e)}return new Vector(b,c.names?c.names.slice():void 0)};
Vector.prototype.select=function(a){for(var b=this,c=0;c<a.length;c++){if(!b.items)throw"MSG: Number where vector expected in vector collapsing.";if(a[c]instanceof String||"string"==typeof a[c]){var d=b.namesLC.indexOf(a[c].valueOf());if(-1==d)throw"MSG: Mismatched keys for vector collapsing.";b=b.items[d]}else b=b.items[a[c]]}return b};
Vector.prototype.recurseApply=function(a){for(var b=0;b<this.items.length;b++)this.items[b]=this.items[b]instanceof Vector&&!this.items[b].terminateApply?this.items[b].recurseApply(a):a(this.items[b]);return this};
Vector.prototype.fullNames=function(){if(this.items[0]instanceof Vector&&this.items[0].names)for(var a=this.items[0].fullNames(),b=[],c=0;c<this.names.length;c++)for(var d=0;d<a.length;d++)b.push([this.names[c]].concat(a[d]));else for(b=[],c=0;c<this.names.length;c++)b.push([this.names[c]]);return b};
Vector.prototype.clone=function(){for(var a=[],b=0;b<this.items.length;b++)this.items[b]instanceof Vector?a.push(this.items[b].clone()):a.push(this.items[b]);return new Vector(a,this.names?this.names.slice():void 0,this.parent)};Vector.prototype.fullClone=function(){for(var a=[],b=0;b<this.items.length;b++)this.items[b].fullClone?a.push(this.items[b].fullClone()):a.push(this.items[b]);return new Vector(a,this.names?this.names.slice():void 0,this.parent)};
Vector.prototype.equals=function(a){if(this.length()!=a.length())return!1;for(var b=0;b<this.items.length;b++)if(!strictEquals(this.items[b],a.items[b]))return!1;return!0};Primitive||(Primitive=function(a){this.v=a;this.vector=new Vector([],[],VectorBase)},Primitive.prototype.value=function(){return this.v.fullClone()},Primitive.prototype.setValue=function(a){return this.v=a},Primitive.prototype.toNum=function(){return this.v.fullClone()},Primitive.prototype.toString=function(){return"Primitive Reference"});
function strictEquals(a,b){if(a instanceof Agent||b instanceof Agent){if(a instanceof Agent&&b instanceof Agent&&a.instanceId==b.instanceId)return!0}else if(a instanceof Vector||b instanceof Vector){if(a instanceof Vector&&b instanceof Vector&&a.equals(b))return!0}else if(eq(a,b))return!0;return!1}
function createTree(a){a=new org.antlr.runtime.ANTLRStringStream(a.replace(/\\n/g,"\n"));a=new FormulaLexer(a);a=new org.antlr.runtime.CommonTokenStream(a);a=new FormulaParser(a);var b=a.lines();a=convertToObject(b.tree,a);isLocal();return a}function trimTree(a,b){return trimNode(a,b)}function evaluateTree(a,b){evaluatingLine=void 0;try{return evaluateNode(a,b)}catch(c){if(c.returnVal)return c.data;throw c;}}
var PB={test:new Primitive(new Material(3)),a:new Primitive(new Material(1)),b:new Primitive(new Material(2)),c:new Primitive(new Material(3))};
function evaluate(a,b){PB["test vector"]=new Primitive(new Vector([new Material(1),new Material(2),new Material(3)],[],VectorBase));PB["test vector 2"]=new Primitive(new Vector([new Material(1.2),new Material(2.9),new Material(3)],[],VectorBase));var c=trimTree(createTree(a),PB),d;try{d=evaluateTree(c,varBank),b||(d=d.toNum())}catch(e){if("PLOT"==e){d={isPlot:!0,data:[]};var f={};f["-parent"]=varBank;for(var g=-100;100>=g;g+=1)f.x=new Material(g/10),d.data.push([g/10,0+evaluateTree(c,f).value]);return d}throw e;
}d instanceof Material&&(d.value.toPrecision&&(d.value=0===d.value?"0":d.value.toPrecision(21)),"."==d.value.substr(d.value.length-1,1)&&(d.value=d.value.substring(0,d.value.length-1)),d.value=d.value.replace(/\.?\+\.?/g,"+"),d.value=d.value.replace(/\.?\-\.?/g,"-"),d.value=d.value.replace(/\.i/g,"i"),d.value=d.value.replace(/(\d)i/g,"$1*<i>i</i>"),d.value=d.value.replace(/\.e/g,"e"),d.value=d.value.replace(/e\+/g,"e"),"+inf.0"==d.value?d.value="Infinity":"-inf.0"==d.value&&(d.value="-Infinity"));
return d}var TreeNode=function(a,b,c){this.origText=a;this.text=a.toLowerCase();this.typeName=b;this.line=c;this.children=[]};function convertToObject(a,b){var c=a.getToken(),c=new TreeNode(c.getText(),b.getTokenNames()[c.getType()],c.line);if(0<a.getChildCount())for(var d=a.getChildren(),e=0;e<d.length;e++)c.children.push(convertToObject(d[e],b)),!c.line&&c.children[c.children.length-1].line&&(c.line=c.children[c.children.length-1].line);return c}var funcEvalMap={},evaluatingLine=null;
funcEvalMap.LINES=function(a,b){if(0==a.children.length)return new Material(0);for(var c,d=0;d<a.children.length;d++){if("return"==a.children[d].text)throw{returnVal:!0,data:evaluateNode(a.children[d].children[0],b)};c=evaluateNode(a.children[d],b)}return c};funcEvalMap.NEGATE=function(a,b){return negate(evaluateNode(a.children[0],b).toNum())};
function negate(a){if(a instanceof Vector)return a.cloneApply(negate);if("boolean"==typeof a)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";return new Material(fn["-"](a.value),a.units)}funcEvalMap.AND=function(a,b){return funAnd(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function funAnd(a,b){return a instanceof Vector?a.cloneCombine(b,funAnd,!1):b instanceof Vector?b.cloneCombine(a,funAnd,!0):trueValue(a)&&trueValue(b)}funcEvalMap.OR=function(a,b){return funOr(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function funOr(a,b){return a instanceof Vector?a.cloneCombine(b,funOr,!1):b instanceof Vector?b.cloneCombine(a,funOr,!0):trueValue(a)||trueValue(b)}
funcEvalMap.XOR=function(a,b){return funXor(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function funXor(a,b){return a instanceof Vector?a.cloneCombine(b,funXor,!1):b instanceof Vector?b.cloneCombine(a,funXor,!0):(trueValue(a)||trueValue(b))&&!(trueValue(a)&&trueValue(b))}funcEvalMap.NOT=function(a,b){return fNot(evaluateNode(a.children[0],b).toNum())};function fNot(a){return a instanceof Vector?a.cloneApply(fNot):!trueValue(a)}
funcEvalMap.NOTEQUALS=function(a,b){return neq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function neq(a,b){if("boolean"==typeof a&&!(b instanceof Vector)||"boolean"==typeof b&&!(a instanceof Vector))return trueValue(a)!=trueValue(b);if((a instanceof String||"string"==typeof a)&&!(b instanceof Vector)||(b instanceof String||"string"==typeof b)&&!(a instanceof Vector))return(a.toLowerCase?a.toLowerCase():a)!=(b.toLowerCase?b.toLowerCase():b);if(a instanceof Vector)return a.cloneCombine(b,neq,!1);if(b instanceof Vector)return b.cloneCombine(a,neq,!0);if(!(a instanceof Material&&b instanceof
Material))return a!=b;if(a.units!==b.units){var c=convertUnits(b.units,a.units);if(0===c)return!0;b.value=fn["*"](b.value,c);b.units=a.units}return!fn["="](a.value,b.value)}funcEvalMap.EQUALS=function(a,b){return eq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function eq(a,b){if("boolean"==typeof a&&!(b instanceof Vector)||"boolean"==typeof b&&!(a instanceof Vector))return trueValue(a)==trueValue(b);if(("string"==typeof a||a instanceof String)&&!(b instanceof Vector)||("string"==typeof b||b instanceof String)&&!(a instanceof Vector))return(a.toLowerCase?a.toLowerCase():a)==(b.toLowerCase?b.toLowerCase():b);if(a instanceof Vector)return a.cloneCombine(b,eq,!1);if(b instanceof Vector)return b.cloneCombine(a,eq,!0);if(!(a instanceof Material&&b instanceof
Material))return a==b;if(a.units!==b.units){var c=convertUnits(b.units,a.units);if(0===c)return!1;b.value=fn["*"](b.value,c);b.units=a.units}return fn["="](a.value,b.value)}function comparisonValid(a,b){if(a instanceof String||"string"==typeof a||b instanceof String||"string"==typeof b)throw"MSG: Cannot use Strings in logical inequality comparisons.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot use Agents in logical inequality comparisons.";}
funcEvalMap.LT=function(a,b){return lessThan(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function lessThan(a,b){comparisonValid(a,b);if(a instanceof Vector)return a.cloneCombine(b,lessThan,!1);if(b instanceof Vector)return b.cloneCombine(a,lessThan,!0);if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units)}return fn["<"](a.value,b.value)}
funcEvalMap.LTEQ=function(a,b){return lessThanEq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function lessThanEq(a,b){comparisonValid(a,b);if(a instanceof Vector)return a.cloneCombine(b,lessThanEq,!1);if(b instanceof Vector)return b.cloneCombine(a,lessThanEq,!0);if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units)}return fn["<="](a.value,b.value)}
funcEvalMap.GT=function(a,b){return greaterThan(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function greaterThan(a,b){comparisonValid(a,b);if(a instanceof Vector)return a.cloneCombine(b,greaterThan,!1);if(b instanceof Vector)return b.cloneCombine(a,greaterThan,!0);if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units)}return fn[">"](a.value,b.value)}
funcEvalMap.GTEQ=function(a,b){return greaterThanEq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function greaterThanEq(a,b){comparisonValid(a,b);if(a instanceof Vector)return a.cloneCombine(b,greaterThanEq,!1);if(b instanceof Vector)return b.cloneCombine(a,greaterThanEq,!0);if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units)}return fn[">="](a.value,b.value)}
funcEvalMap.PLUS=function(a,b){return plus(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function plus(a,b){if(a instanceof Vector)return a.cloneCombine(b,plus,!1);if(b instanceof Vector)return b.cloneCombine(a,plus,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if("string"==typeof a||a instanceof String||"string"==typeof b||b instanceof String){var c=new String(a.toString()+b.toString());c.parent=StringBase;return c}a.units!==b.units&&(c=convertUnits(b.units,
a.units),0===c?unitAlert(a.units,b.units,"addition"):(b.value=fn["*"](b.value,c),b.units=a.units));return new Material(fn["+"](a.value,b.value),b.units)}funcEvalMap.MINUS=function(a,b){return minus(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function minus(a,b){if(a instanceof Vector)return a.cloneCombine(b,minus,!1);if(b instanceof Vector)return b.cloneCombine(a,minus,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"subtraction"):(b.value=fn["*"](b.value,c),b.units=a.units)}return new Material(fn["-"](a.value,b.value),
b.units)}funcEvalMap.MULT=function(a,b){return mult(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function mult(a,b){if(a instanceof Vector)return a.cloneCombine(b,mult,!1);if(b instanceof Vector)return b.cloneCombine(a,mult,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var c=fn["*"](a.value,b.value);return a.units&&b.units?(a.units.addBase(),b.units.addBase(),new Material(fn["*"](fn["*"](a.units.toBase,c),b.units.toBase),a.units.multiply(b.units,1))):a.units?
new Material(c,a.units):b.units?new Material(c,b.units):new Material(c)}funcEvalMap.DIV=function(a,b){return div(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function div(a,b){if(a instanceof Vector)return a.cloneCombine(b,div,!1);if(b instanceof Vector)return b.cloneCombine(a,div,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var c=fn["/"](a.value,b.value);return a.units&&b.units?(a.units.addBase(),b.units.addBase(),new Material(fn["/"](fn["*"](a.units.toBase,c),b.units.toBase),a.units.multiply(b.units,-1))):a.units?
new Material(c,a.units):b.units?new Material(c,b.units.power(-1)):new Material(c)}funcEvalMap.POWER=function(a,b){if(1==a.children.length)return evaluateNode(a.children[0],b);for(var c=evaluateNode(a.children[a.children.length-1],b).toNum(),d=a.children.length-1;0<d;d--){var e=evaluateNode(a.children[d-1],b).toNum();if(c instanceof Vector||!c.units)c=power(e,c);else throw"MSG: Exponents may not have units.";}return c};
function power(a,b){if(a instanceof Vector)return a.cloneCombine(b,power,!1);if(b instanceof Vector)return b.cloneCombine(a,power,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var c=a.value;"number"==typeof c&&(c=sn("#e"+c));return new Material(fn.expt(c,b.value),a.units?a.units.power(b.value):void 0)}
funcEvalMap.MOD=function(a,b){return doMod(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function doMod(a,b){if(a instanceof Vector)return a.cloneCombine(b,doMod,!1);if(b instanceof Vector)return b.cloneCombine(a,doMod,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(b.units)throw'MSG: The right hand side of "mod" may not have units.';return new Material(fn.mod(a.value,b.value),a.units)}
funcEvalMap.IDENT=function(a,b){for(var c=a.text;!(c in b);)if(b["-parent"])b=b["-parent"];else{if("x"==c&&window.isCalc)throw"PLOT";if("i"==c)return new Material(sn("i"));throw'MSG: The variable or function "'+a.origText+'" does not exist.';}c=b[c];c instanceof TreeNode&&"ARRAY"==c.typeName&&(c=evaluateNode(c,b));return!c.fullClone||c instanceof Vector?c:c.fullClone()};
funcEvalMap.NEW=function(a,b){var c=evaluateNode(a.children[0],b);if(c instanceof Vector){var d=new Vector([],void 0,c),e,f;try{f=selectFromVector(c,"constructor"),e=f.data}catch(g){}if(e)2==a.children.length?callFunction(e,a.children[1],b,d,f.parent):callFunction(e,{children:[]},b,d,f.parent);else if(2==a.children.length&&0<a.children[1].children.length)throw"MSG: No constructor available for '"+a.children[0].text+"'.";return d}throw"MSG: 'New' can only be use to create instances of Vectors.";};
funcEvalMap.INNER=function(a,b){var c=evaluateNode(a.children[0],b);if(2==a.children.length&"FUNCALL"==a.children[1].typeName)return callFunction(c,a.children[1],b);var d,e;b.self&&"parent"==a.children[0].text?d=b.self:c instanceof Function||c instanceof UserFunction||(d=c);for(var f=1;f<a.children.length;f++)if("SELECTOR"==a.children[f].typeName)if("DOTSELECTOR"==a.children[f].children[0].typeName)for(var g=0;g<a.children[f].children[0].children.length;g++){var k=[];a.children[f].children[0].children[g].text?
k.push(a.children[f].children[0].children[g].text):k.push(a.children[f].children[0].children[g].valueOf());try{c=selectFromMatrix(c,k)}catch(l){if(c instanceof Primitive&&!(c instanceof Agent))c=c.toNum(),g--;else throw l;}c instanceof Function||c instanceof UserFunction||(e=d=c)}else{c instanceof Primitive&&(c=c.toNum(),c instanceof Function||c instanceof UserFunction||(e=d=c));try{c=selectFromMatrix(c,createMatrixSelector(a.children[f],b,0,!0))}catch(m){if(c instanceof Primitive)c=c.toNum(),f--;
else throw m;}c instanceof Function||c instanceof UserFunction||(e=d=c)}else c=callFunction(c,a.children[f],b,d,e),c instanceof Function||c instanceof UserFunction||(e=d=c);return c};
function callFunction(a,b,c,d,e){if("function"!=typeof a&&!(a instanceof UserFunction))throw"MSG: Trying to call a non-function.";var f=[],g="";if(b instanceof Array)f=b;else if(b.functionFingerprint||(b.functionFingerprint="FINGERPRINT-"+Math.random()),g=b.functionFingerprint,a.delayEvalParams)for(var k=0;k<b.children.length;k++)f.push({node:b.children[k],scope:c});else for(k=0;k<b.children.length;k++){var l=evaluateNode(b.children[k],c);!l.fullClone||l instanceof Vector||(l=l.fullClone());f.push(l)}a.fn?
b=a.fn:(b.delayEvalParams=a.delayEvalParams,b=a);a=evaluatingLine;d=b(f,g,d,e);evaluatingLine=a;return d}
function createMatrixSelector(a,b,c,d){var e=[];for(c=c||0;c<a.children.length;c++)"MULT"==a.children[c].typeName?e.push("*"):(d=evaluateNode(a.children[c],b),"function"==typeof d||d instanceof UserFunction?function(a){e.push(function(b){if(!b[0].stackApply)throw"MSG: Can't apply function across elements of non-vector.";return b[0].stackApply(function(b){return a([b])})})}("function"==typeof d?d:d.fn):e.push(d.toNum()));return e}
function selectFromMatrix(a,b,c){a instanceof Vector||(a.vector?a=a.vector:a.parent&&(a=new Vector([],[],a.parent)));isUndefined(c)&&a.fullClone&&(a=a.fullClone());a=selectFromVector(a,b.shift(),0==b.length?c:void 0,isDefined(c));for(var d=[],d=a.collapsed?[a.data]:a.data.items;0<b.length;){for(var e=[],f=b.shift(),g=0;g<d.length;g++){if(!(d[g]instanceof Vector))throw"MSG: No element available for: "+f;var k=selectFromVector(d[g],f,0==b.length?c:void 0);k.collapsed?(c||(d[g].items=[k.data],d[g].names=
["!!BREAKOUT DATA"]),e=e.concat(k.data)):(e=e.concat(k.data.items),c||(d[g].items=k.data.items,d[g].names=k.data.names))}d=e}return doBreakouts(a.data)}function doBreakouts(a){if(!(a instanceof Vector))return a;if(1==a.items.length&&a.names&&"!!BREAKOUT DATA"==a.names[0])return doBreakouts(a.items[0]);for(var b=0;b<a.items.length;b++)a.items[b]=doBreakouts(a.items[b]);return a}
function selectFromVector(a,b,c,d){if("*"==b)return{data:a};if("function"==typeof b)return{data:b([a]),collapsed:!0};if("parent"==b){if(a.parent)return{data:d?a.parent:a.parent.fullClone(),collapsed:!0};throw"MSG: Vector does not have a parent.";}if(b instanceof Vector){d=[];for(var e=a.names?[]:void 0,f=0;f<b.items.length;f++){var g=b.items[f],k=!0;"boolean"==typeof g&&(g?g=new Material(f+1):k=!1);k&&(g=selectElementFromVector(a,g,c),d.push(g.value),e&&e.push(g.name))}return{collapsed:!1,parent:a,
data:new Vector(d,e,a.parent)}}return{collapsed:!0,parent:a,data:selectElementFromVector(a,b,c).value}}
function selectElementFromVector(a,b,c){var d=void 0,e=void 0,f;if(b instanceof String||"string"==typeof b)try{if(isUndefined(c)&&!a.names)throw"MSG: Key '"+b+"' not in vector.";if(a.names){f=-1;for(var g=b.toLowerCase(),e=0;e<a.names.length;e++)if(a.names[e]&&a.names[e].toLowerCase()===g){f=e;break}if(0>f||isUndefined(f))f=a.names.indexOf("*")}if(0>f||isUndefined(f)){if(isUndefined(c))throw"MSG: Key '"+b+"' not in vector.";f=b}}catch(k){if(a.parent)return selectElementFromVector(a.parent,b,c);throw k;
}else f=parseFloat(b.toNum())-1;if(f instanceof String||"string"==typeof f){if(!a.names)for(a.names=[],e=0;e<a.items.length;e++)a.names.push(void 0);a.items.push(c);a.names.push(f.valueOf());e=c;d=f}else{if(0>f||!a.items||f>=a.items.length||0!=f%1)throw"MSG: Index "+(1+f)+" is not in the vector.";isUndefined(c)||(a.items[f]=c);e=a.items[f];a.names&&(d=a.names[f])}return{name:d,value:e}}
funcEvalMap.ARRAY=function(a,b){if(1==a.children.length&&a.children[0]instanceof Vector)return a.children[0].fullClone();for(var c=[],d=[],e=!1,f=0;f<a.children.length;f++)c.push(evaluateNode(a.children[f].children[0],b)),1<a.children[f].children.length?(a.children[f].children[1].text?d.push(a.children[f].children[1].origText):d.push(a.children[f].children[1].valueOf()),e=!0):d.push(void 0);return new Vector(c,e?d:void 0)};
funcEvalMap.RANGE=function(a,b){if(1==a.children.length)return evaluateNode(a.children[0],b);var c=[],d=evaluateNode(a.children[0],b).toNum(),e=evaluateNode(a.children[a.children.length-1],b).toNum();if(!(d instanceof Material&&e instanceof Material))throw"MSG: Range elements must be numbers.";c.push(d.fullClone());if(d.units!==e.units&&1!=convertUnits(d.units,e.units))throw"MSG: Units on both sides of ':' must be equal.";var f=2==a.children.length?new Material(1,d.units):evaluateNode(a.children[1],
b).toNum();if(!(f instanceof Material))throw"MSG: Range elements must be numbers.";if(!eq(d,e))if(lessThan(d,e))for(d=plus(d,f);lessThanEq(d,e);)c.push(d),d=plus(d,f);else if(greaterThan(d,e))for(2==a.children.length&&(f=negate(f)),d=plus(d,f);greaterThanEq(d,e);)c.push(d),d=plus(d,f);return new Vector(c)};
function makeFunctionCall(a,b,c,d,e){var f=new UserFunction;f.localScope={};f.localScope.nVars=b.length;for(var g=0;g<b.length;g++)f.localScope[g+=""]=b[g];f.localScope["-parent"]=e;f.defaults=c;f.fn=function(b,c,g,n){var p=b.length;for(c=0;c<b.length;c++)b[c].optional&&p--;if(f.localScope.nVars-f.defaults.length>b.length||p>f.localScope.nVars){b=[];for(c=0;c<f.localScope.nVars;c++)-1<f.defaults.length-(f.localScope.nVars-c)?b.push(f.localScope[c+=""]+"="+f.defaults[f.defaults.length-(f.localScope.nVars-
c)]):b.push(f.localScope[c+=""]);throw"MSG: Wrong number of parameters for "+a+"("+b.join(", ")+").";}p={"-parent":e};for(c=0;c<b.length;c++)p[f.localScope[c+=""]]=b[c];for(c=b.length;c<f.localScope.nVars;c++)p[f.localScope[c+=""]]=f.defaults[f.defaults.length-(f.localScope.nVars-c)];g&&(p.self||(p.self=g));n&&n.parent&&(p.parent=n.parent);try{return evaluateNode(d,p)}catch(q){if(q.returnVal)return q.data;throw q;}};return f}
funcEvalMap.THROW=function(a,b){throw"MSG: "+evaluateNode(a.children[0],b);};funcEvalMap.TRYCATCH=function(a,b){try{return evaluateNode(a.children[0],b)}catch(c){var d={"-parent":b};d[a.children[2].text]="string"==typeof c||c instanceof String?s(c.substr(5)):s("An error has occurred.");return evaluateNode(a.children[1],d)}};funcEvalMap.WHILE=function(a,b){for(var c=new Material(0),d={"-parent":b};trueValue(evaluateNode(a.children[0],b).toNum());)c=evaluateNode(a.children[1],d);return c};
funcEvalMap.IFTHENELSE=function(a,b){for(var c={"-parent":b},d=0;d<a.children[0].children.length;d++)if(trueValue(evaluateNode(a.children[0].children[d],b).toNum()))return evaluateNode(a.children[1].children[d],c);return a.children[0].children.length!=a.children[1].children.length?evaluateNode(a.children[1].children[d],c):new Material(0)};
funcEvalMap.FORIN=function(a,b){var c=new Material(0),d=a.children[0].text,e={"-parent":b},f=evaluateNode(a.children[1],b);if(!(f instanceof Vector))throw"MSG: The in argument of a For-In loop mush be a a vector.";for(var g=0;g<f.items.length;g++)e[d]=f.items[g],c=evaluateNode(a.children[2],e);return c};
funcEvalMap.FOR=function(a,b){var c=new Material(0),d=a.children[0].text,e=evaluateNode(a.children[1].children[0],b).toNum(),f=new Material(1);3==a.children[1].children.length&&(f=evaluateNode(a.children[1].children[2],b).toNum());var g={"-parent":b};for(g[d]=e;fn[0<=f.value?"<=":">="](g[d].value,evaluateNode(a.children[1].children[1],b).toNum());)c=evaluateNode(a.children[2],g),g[d]=plus(g[d],f);return c};
funcEvalMap.FUNCTION=function(a,b){var c=a.children[0].children[0].text;functionGenerator(c,a.children[0],a.children[1],a.children[2],b);return'"'+c+'" defined'};funcEvalMap.ANONFUNCTION=function(a,b){return functionGenerator(null,a.children[0],a.children[1],a.children[2],b)};
funcEvalMap.ASSIGN=function(a,b){var c=a.children.length-1,d=evaluateNode(a.children[a.children.length-1],b);if(1<c&&(!(d instanceof Vector)||d.items.length<c))throw"MSG: Too few elements returned for assignment.";for(var e=0;e<c;e++)if(a.children[e]instanceof PrimitiveStore)1==c?a.children[e].primitive.setValue(d):a.children[e].primitive.setValue(d.items[e]);else{var f=a.children[e].children[0].text;if(1<a.children[e].children.length)var g=createSelector(a.children[e].children[1],b);for(var k=b;null!==
b["-parent"]&&!isDefined(b[f]);)b=b["-parent"];null===b["-parent"]&&isUndefined(b[f])&&(b=k);k=1==c?d:d.items[e];if(1==a.children[e].children.length)b[f]=k;else if(isDefined(b[f]))selectFromMatrix(b[f],g,k);else throw"MSG: The variable '"+a.children[e].children[0].origText+"' does not exist.";}return 1<c?new Vector(d.items.slice(0,c)):d};
function createSelector(a,b){if("DOTSELECTOR"==a.children[0].typeName){for(var c=[],d=0;d<a.children[0].children.length;d++)a.children[0].children[d].text?c.push(a.children[0].children[d].text):c.push(a.children[0].children[d].valueOf());return c}return createMatrixSelector(a,b,0,!0)}funcEvalMap.MATERIAL=function(a,b){var c=evaluateNode(a.children[0],b).toNum();if(c.units)throw"MSG: Cannot create material where numeric part itself has units.";return new Material(c.value,a.children[1])};
function functionGenerator(a,b,c,d,e){for(var f=[],g=[],k=null===a?0:1;k<b.children.length;k++)f.push(b.children[k].text);for(k=0;k<c.children.length;k++)g.push(c.children[k]);if(null===a)return makeFunctionCall(null===a?"Function":a,f,g,d,e);e[a]=makeFunctionCall(a,f,g,d,e)}
var unitEvalMap={MULT:function(a){return evaluateUnits(a.children[0]).concat(evaluateUnits(a.children[1]))},POW:function(a){var b=1,c=1;3==a.children.length&&(b*=-1,c++);var d=evaluateUnits(a.children[0]);a=evaluateUnits(a.children[c])*b;if(d instanceof Array){for(b=0;b<d.length;b++)d[b].exponent*=a;return d}return Math.pow(d,a)},DIV:function(a){var b=evaluateUnits(a.children[0]);a=evaluateUnits(a.children[1]);for(var c=0;c<a.length;c++)a[c].exponent*=-1;return b.concat(a)}};unitEvalMap.PER=unitEvalMap.DIV;
unitEvalMap.UNIT=function(a){for(var b="",c=0;c<a.children.length;c++)b+=a.children[c].text,c<a.children.length-1&&(b+=" ");return[{id:b,exponent:1}]};
unitEvalMap.UNITCLUMP=function(a){var b=evaluateUnits(a.children[0]);if(1<a.children.length)for(var c=1;c<a.children.length;c++)if("NEGATE"==a.children[c].typeName)for(var d=0;d<b.length;d++)b[d].exponent*=-1;else if("SQUARED"==a.children[c].typeName)for(d=0;d<b.length;d++)b[d].exponent*=2;else if("CUBED"==a.children[c].typeName)for(d=0;d<b.length;d++)b[d].exponent*=3;return b};unitEvalMap.INTEGER=function(a){return parseInt(a.text)};unitEvalMap.FLOAT=function(a){return parseFloat(a.text)};
function evaluateUnits(a){return a instanceof Material?a.value:unitEvalMap[a.typeName](a)}function evaluateNode(a,b){if(a instanceof TreeNode)return evaluatingLine=a.line||evaluatingLine,funcEvalMap[a.typeName](a,b);if(a instanceof PrimitiveStore){if("totalValue"==a.type){if(!a.primitive.totalContents)throw"MSG: You can only use the double-bracket notation for total conveyor contents on Stock primitives.";return a.primitive.totalContents()}if("object"==a.type)return a.primitive}else return a}
var trimEvalMap={POWER:function(a,b){if(1==a.children.length)return trimNode(a.children[0],b);for(var c=new TreeNode(a.origText,a.typeName,a.line),d=0;d<a.children.length;d++)c.children.push(trimNode(a.children[d],b));return c},INNER:function(a,b){if(1==a.children.length)return trimNode(a.children[0],b);for(var c=new TreeNode(a.origText,a.typeName,a.line),d=0;d<a.children.length;d++)c.children.push(trimNode(a.children[d],b));return c}};trimEvalMap.RANGE=trimEvalMap.POWER;trimEvalMap.TRUE=function(a){return!0};
trimEvalMap.FALSE=function(a){return!1};trimEvalMap.STRING=function(a){var b=a.origText.substr(1,a.origText.length-2);a='"'==a.origText[0]?b.replace(/\\\\/g,"\\\\TEMPTXT\\\\").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\t/g,"\t").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\TEMPTXT\\\\/g,"\\"):b.replace(/\n/,"\\n");a=new String(a);a.vector=new Vector([],[],StringBase);return a};trimEvalMap.INTEGER=function(a){return new Material(sn("#e"+a.text))};
trimEvalMap.MATERIAL=function(a,b){for(var c=a.children[0],d=trimNode(a.children[1],b),c=evaluateUnits(c),e=[],f=[],g=0;g<c.length;g++){var k=f.indexOf(c[g].id);-1==k?(e.push(c[g].exponent),f.push(c[g].id)):e[k]+=c[g].exponent}if(d instanceof Material){if(d.units)throw"MSG: Cannot create material where numeric part itself has units.";return new Material(d.value,getUnitStore(f,e,!0))}c=new TreeNode(a.origText,"MATERIAL",a.line);c.children=[d,getUnitStore(f,e,!0)];return c};
trimEvalMap.MULT=function(a,b){if(0==a.children.length)return"*";var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(isConst(c)&&isConst(d))return mult(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e};trimEvalMap.DIV=function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(isConst(c)&&isConst(d))return div(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e};
trimEvalMap.PLUS=function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(isConst(c)&&isConst(d))return plus(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e};trimEvalMap.MINUS=function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(isConst(c)&&isConst(d))return minus(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e};trimEvalMap.FLOAT=trimEvalMap.INTEGER;
trimEvalMap.PRIMITIVE=function(a,b){var c;c="[["==a.text.substr(0,2)?new PrimitiveStore(b[a.text.substr(2,a.text.length-4)],"totalValue"):new PrimitiveStore(b[a.text.substr(1,a.text.length-2)],"object");if("undefined"===typeof c.primitive)throw"MSG: The primitive <i>"+a.origText+"</i> could not be found.";return c};
trimEvalMap.NEGATE=function(a,b){if(0==a.children.length)return new TreeNode(a.origText,a.typeName,a.line);var c=trimNode(a.children[0],b);if(isConst(c))return negate(c);var d=new TreeNode(a.origText,a.typeName,a.line);d.children=[c];return d};
trimEvalMap.ARRAY=function(a,b){for(var c=new TreeNode(a.origText,a.typeName,a.line),d=[],e=[],f=!1,g=0;g<a.children.length;g++)c.children.push(trimNode(a.children[g],b)),d.push(c.children[g].children[0]),1<c.children[g].children.length?(c.children[g].children[1].text?e.push(c.children[g].children[1].origText):e.push(c.children[g].children[1].valueOf()),f=!0):e.push(void 0);for(var k=!0,g=0;g<d.length;g++)if(!isConst(d[g])){k=!1;break}k&&(c.children=[new Vector(d,f?e:void 0)]);return c};
function isConst(a){return a instanceof Material||"string"==typeof a||a instanceof String||"boolean"==typeof a||a instanceof Vector?!0:!1}function trimNode(a,b){if(trimEvalMap.hasOwnProperty(a.typeName))return evaluatingLine=a.line||evaluatingLine,trimEvalMap[a.typeName](a,b);for(var c=new TreeNode(a.origText,a.typeName,a.line),d=0;d<a.children.length;d++)c.children.push(trimNode(a.children[d],b));return c}
function trueValue(a){if("boolean"==typeof a)return a;if(a instanceof Material)return neq(a.value,0);throw"MSG: Only numbers can be used in place of booleans.";}function isLocal(){return"localhost"==document.location.hostname||"insightmaker.test"==document.location.hostname||"calc.test"==document.location.hostname}function isUndefined(a){return"undefined"==typeof a}function isDefined(a){return!isUndefined(a)}
function fireEvent(a,b,c){var d,e=a;if(a instanceof Vector)d=a.parent;else if(a.vector instanceof Vector)a=a.vector,d=a.parent;else if(a.parent instanceof Vector)d=a=a.parent;else return!1;try{var f=selectFromVector(a,b)}catch(g){return!1}c.optional=!0;return callFunction(f.data,[c],varBank,e,d)}function ObjToVec(a){for(var b=Object.keys(a),c=[],d=0;d<b.length;d++)c.push(a[b[d]]);return new Vector(c,b)};functionLoaders.push(function(){function a(a,b,c){var d=function(a,b){return a instanceof Vector?a.combine(b,d):[a,b]};b=b.toNum();c=c.toNum();b=b instanceof Vector?b.cloneCombine(c,d):c instanceof Vector?c.cloneCombine(b,function(a,b){return d(b,a)}):d(b,c);var e=function(a,b){return a instanceof Vector?a.combine(b,e):trueValue(a)?b[0]:b[1]};return a.cloneCombine(b,e)}function b(a,b){for(var c=0;c<b.length();c++)if(eq(a,b.items[c]))return new Material(c+1);return new Material(0)}function c(a,b,c){if(!b)for(b=
0;b<a.length;b++)a[b]=a[b].toNum();if(1==a.length&&a[0]instanceof Vector)return c?a[0]:functionBank.flatten([a[0]]);c=Vector;b=!1;for(var d,f=0;f<a.length;f++)if(a[f]instanceof Vector){d=a[f];b=!0;break}if(b)for(f=0;f<a.length;f++)a[f]instanceof Vector||(a[f]=e(d,a[f]));return new c(a)}function d(a){for(var b=0;b<a.length;b++)a[b].toNum&&(a[b]=a[b].toNum());return 1==a.length&&a[0]instanceof Vector?functionBank.flatten([a[0].toNum()]).items:c(a,void 0,!0).items}function e(a,b){for(var c=a.fullClone(),
d=0;d<c.items.length;d++)c.items[d]=c.items[d]instanceof Vector?e(c.items[d],b):b;return c}function f(a){for(var b=[],c=[],d=void 0,e=0;e<a.length();e++)if(a.items[e]instanceof Vector)var p=f(a.items[e]),b=b.concat(p.items),c=c.concat(p.names),d=d||p.hasName;else b.push(a.items[e]),a.names?(c.push(a.names[e]),d=!0):c.push(void 0);return{items:b,names:c,hasName:d}}defineFunction("RandBeta",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},function(a){return new Material(RandBeta(a[0].value,
a[1].value))});defineFunction("RandDist",{params:[{name:"Distribution",noUnits:!0,needVector:!0},{name:"Y (in which case Distribution is X)",noUnits:!0,needVector:!0,defaultVal:!1}]},function(a){var b;if(1==a.length||!1===a[1]){var c=a[0];b=[];a=[];for(var d=0;d<c.items.length;d++)b.push(c.items[d].items[0].toNum().value),a.push(c.items[d].items[1].toNum().value)}else b=a[0].toNum().items.map(function(a){return a.value}),a=a[1].toNum().items.map(function(a){return a.value});return new Material(RandDist(b,
a))});defineFunction("RandBoolean",{params:[{name:"Probability",defaultVal:0.5,noUnits:!0,noVector:!0}]},function(a){a=0!=a.length?a[0].toNum().value:0.5;return Rand()<a?!0:!1});defineFunction("Rand",{params:[{name:"Lower Bound",defaultVal:0,noUnits:!0,noVector:!0},{name:"Upper Bound",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){return 0!=a.length?new Material(Rand(a[0].toNum().value,a[1].toNum().value)):new Material(Rand())});defineFunction("RandNormal",{params:[{name:"Mean",defaultVal:0,noUnits:!0,
noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){return 0!=a.length?new Material(RandNormal(a[0].toNum().value,a[1].toNum().value)):new Material(RandNormal())});defineFunction("RandExp",{params:[{name:"Rate",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){return 0!=a.length?new Material(RandExp(a[0].toNum().value)):new Material(RandExp())});defineFunction("RandLognormal",{params:[{name:"Mean",noUnits:!0,noVector:!0},{name:"Standard Deviation",noUnits:!0,
noVector:!0}]},function(a){return new Material(RandLognormal(a[0].toNum().value,a[1].toNum().value))});defineFunction("RandBinomial",{params:[{name:"Count",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},function(a){return new Material(RandBinomial(a[0].toNum().value,a[1].toNum().value))});defineFunction("RandNegativeBinomial",{params:[{name:"Successes",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},function(a){return new Material(RandNegativeBinomial(a[0].toNum().value,
a[1].toNum().value))});defineFunction("RandGamma",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},function(a){return new Material(RandGamma(a[0].toNum().value,a[1].toNum().value))});defineFunction("RandPoisson",{params:[{name:"Rate",noUnits:!0,noVector:!0}]},function(a){return new Material(RandPoisson(a[0].toNum().value))});defineFunction("RandTriangular",{params:[{name:"Minimum",noUnits:!0,noVector:!0},{name:"Maximum",noUnits:!0,noVector:!0},{name:"Peak",noUnits:!0,
noVector:!0}]},function(a){return new Material(RandTriangular(a[0].toNum().value,a[1].toNum().value,a[2].toNum().value))});defineFunction("Real",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.value=fn["real-part"](a.value);return a});defineFunction("Imag",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.value=fn["imag-part"](a.value);return a});defineFunction("Magnitude",{params:[{name:"Number"}]},function(a){if(a[0].toNum()instanceof Vector)return functionBank.sqrt([functionBank.sum([mult(a[0],
a[0])])]);a=a[0].toNum();a.value=fn.magnitude(a.value);return a});defineFunction("Angle",{params:[{name:"Number"}],recurse:!0},function(a){return new Material(fn.angle(a[0].toNum().value),getUnitStore(["radians"],[1]))});defineFunction("Abs",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.value=fn.abs(a.value);return a});defineFunction("sin",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.units&&(a=mult(a,new Material(1,getUnitStore(["radians"],[-1]))));if(a.units)throw"MSG: Non-angular units cannot be used in Sin().";
return new Material(fn.sin(a.value))});defineFunction("cos",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.units&&(a=mult(a,new Material(1,getUnitStore(["radians"],[-1]))));if(a.units)throw"MSG: Non-angular units cannot be used in Cos().";return new Material(fn.cos(a.value))});defineFunction("tan",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.units&&(a=mult(a,new Material(1,getUnitStore(["radians"],[-1]))));if(a.units)throw"MSG: Non-angular units cannot be used in Tan().";
return new Material(fn.tan(a.value))});defineFunction("asin",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.asin(a[0].toNum().value))});defineFunction("acos",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.acos(a[0].toNum().value))});defineFunction("atan",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.atan(a[0].toNum().value))});defineFunction("arcsin",{params:[{name:"Number",noUnits:!0}],
recurse:!0},function(a){return new Material(fn.asin(a[0].toNum().value),getUnitStore(["radians"],[1]))});defineFunction("arccos",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.acos(a[0].toNum().value),getUnitStore(["radians"],[1]))});defineFunction("arctan",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.atan(a[0].toNum().value),getUnitStore(["radians"],[1]))});defineFunction("Sign",{params:[{name:"Number"}],recurse:!0},function(a){a=
a[0].toNum();if(0>a.value)return div(new Material(-1),new Material(1));if(0<a.value)return div(new Material(1),new Material(1));if(0==a.value)return new Material(0);throw"MSG: Invalid value for Sign";});defineFunction("Sqrt",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.value=fn.sqrt(a.value);if(a.units)for(var b=0;b<a.units.exponents.length;b++)a.units.exponents[b]/=2;return a});defineFunction("Ln",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.log(a[0].toNum().value))});
defineFunction("Log",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.log(a[0].toNum().value,10))});defineFunction("Logit",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){a=a[0].toNum();a.value=fn["-"](fn.log(a.value),fn.log(fn["-"](1,a.value)));return a});defineFunction("Expit",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){a=a[0].toNum();a.value=fn["/"](1,fn["+"](1,fn.exp(fn["-"](a.value))));return a});defineFunction("Round",{params:[{name:"Number",
noUnits:!1}],recurse:!0},function(a){a=a[0].toNum();a.value=fn.round(a.value);return a});defineFunction("Ceiling",{params:[{name:"Number",noUnits:!1}],recurse:!0},function(a){a=a[0].toNum();a.value=fn.ceiling(a.value);return a});defineFunction("Floor",{params:[{name:"Number",noUnits:!1}],recurse:!0},function(a){a=a[0].toNum();a.value=fn.floor(a.value);return a});defineFunction("Exp",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.exp(a[0].toNum().value))});functionBank.ifthenelse=
function(b){testArgumentsSize(b,"IfThenElse",3,3);var c=evaluateNode(b[0].node,b[0].scope).toNum();return c instanceof Vector?a(c,evaluateNode(b[1].node,b[1].scope),evaluateNode(b[2].node,b[2].scope)):trueValue(c)?evaluateNode(b[1].node,b[1].scope):evaluateNode(b[2].node,b[2].scope)};functionBank.ifthenelse.delayEvalParams=!0;functionBank.map=function(a){testArgumentsSize(a,"Map",2,2);var b;b=a[0].node instanceof Vector?a[0].node:a[0]instanceof Vector?a[0]:evaluateNode(a[0].node,a[1].scope);b instanceof
Primitive&&(b=b.toNum());if(!(b instanceof Vector))throw"MSG: Map() requires a vector as its first argument.";b=b.fullClone();var c,d={x:null,"-parent":a[1].scope},e=a[1].node;try{c=evaluateNode(e,d)}catch(f){}c instanceof Function||c instanceof UserFunction?(c.fn&&(c=c.fn),a=function(a,b){return c([a])}):a=function(a,b){d.x=a;d.key=b||"";return evaluateNode(e,d)};return b.apply(a)};functionBank.map.delayEvalParams=!0;VectorObject.map=functionBank.map;defineFunction("Sample",{object:[functionBank,
VectorObject],params:[{name:"Vector",needVector:!0},{name:"Sample Size"},{name:"Repeat",noVector:!0,allowBoolean:!0,defaultVal:!1}]},function(a){var b=a[0].toNum(),c=a[1].toNum().value;if(0==c)return new Vector([]);var d=b.length(),e=a[2]&&trueValue(a[2].toNum());if(0==d)throw"MSG: Sample() requires a non-empty vector.";a=[];if(e)for(e=0;e<c;e++)a.push(b.items[Math.floor(Rand()*d)]);else{if(d<c)throw"MSG: Vector for Sample() is too small for the given sample size.";b=b.items.slice();for(e=0;e<c;e++)a.push(b.splice(Math.floor(Rand()*
b.length),1)[0])}return new Vector(a)});defineFunction("IndexOf",{object:[functionBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,allowString:!0}]},function(a){var c=a[1];if(c instanceof Vector){for(var d=[],e=0;e<c.items.length;e++)d.push(b(c.items[e],a[0]));return new Vector(d)}return b(c,a[0])});defineFunction("Contains",{object:[functionBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,noVector:!0,
allowString:!0}]},function(a){return eq(new Material(0),functionBank.indexof(a))?!1:!0});defineFunction("Collapse",{params:[{name:"Source",needVector:!0,noUnits:!1},{name:"Target",noVector:!1}]},function(a){return a[0].toNum().collapseDimensions(a[1].toNum())});functionBank.filter=function(a){testArgumentsSize(a,"Filter",2,2);var b;b=a[0].node instanceof Vector?a[0].node:a[0]instanceof Vector?a[0]:evaluateNode(a[0].node,a[0].scope);b instanceof Primitive&&(b=b.toNum());if(!(b instanceof Vector))throw"MSG: Filter() requires a vector as its first argument.";
b=b.fullClone();a=functionBank.map(a);return functionBank.select([b,a])};functionBank.filter.delayEvalParams=!0;VectorObject.filter=functionBank.filter;functionBank.join=function(a){for(var b=[],c=[],d=!1,e=0;e<a.length;e++){var f=a[e];f instanceof Primitive&&(f=f.toNum());if(f instanceof Vector)if(b=b.concat(f.items),f.names)c=c.concat(f.names),d=!0;else for(var q=0;q<f.items.length;q++)c.push(void 0);else b.push(f),c.push(void 0)}return new Vector(b,d?c:void 0)};functionBank.repeat=function(a){testArgumentsSize(a,
"Repeat",2,2);var b=evaluateNode(a[1].node,a[1].scope).toNum(),c=b;b instanceof Vector&&(c=b.items.length);for(var d=[],e={x:null,"-parent":a[1].scope,key:null},f=0;f<c;f++)b instanceof Vector&&(e.key=b.items[f]),e.x=new Material(f+1),d.push(evaluateNode(a[0].node,e));return new Vector(d,b instanceof Vector?b.items.slice():void 0)};functionBank.repeat.delayEvalParams=!0;defineFunction("Select",{params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Indexes",noUnits:!0}]},function(a){a[1].toNum();
if(a[1]instanceof Vector){for(var b=a[1].toNum(),c=!0,d=0;d<b.length();d++)if(b.items[d]instanceof Material){c=!1;break}if(!0==c){var c=[],e=a[0].names?[]:void 0;if(b.length()!=a[0].length())throw"MSG: Length of vector must be equal for boolean selection.";for(d=0;d<b.length();d++)trueValue(b.items[d])&&(c.push(a[0].items[d]),a[0].names&&e.push(a[0].names[d]))}else for(c=[],e=a[0].names?[]:void 0,d=0;d<b.length();d++){var f=b.items[d].value;if(0>=f||f>a[0].length())throw"MSG: Selected element out of range.";
c.push(a[0].items[f-1]);a[0].names&&e.push(a[0].names[f-1])}return new Vector(c,e)}if(0<a[1].value&&a[1].value<=a[0].length())return a[0].items[a[1].value-1];throw"MSG: Selected element out of range.";});defineFunction("Reverse",{allowEmpty:!0,params:{name:"Items..."},prep:function(a){return functionBank.join(a)}},function(a){return new Vector(a.items.slice().reverse(),a.names?a.names.slice().reverse():void 0)});defineFunction("Reverse",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},
function(a){return functionBank.reverse(a)});defineFunction("Sort",{allowEmpty:!0,params:{name:"Items..."},prep:function(a){return functionBank.join(a).toNum()}},function(a){return a.stackApply(function(a){for(var b=[],c=0;c<a.items.length;c++)b.push({item:a.items[c],name:a.names?a.names[c]:void 0});var d=b.sort(function(a,b){return lessThan(a.item,b.item)?-1:greaterThan(a.item,b.item)?1:0});a=a.names?[]:void 0;b=[];for(c=0;c<d.length;c++)b.push(d[c].item),a&&a.push(d[c].name);return new Vector(b,
a)})});defineFunction("Sort",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.sort(a)});defineFunction("Unique",{allowEmpty:!0,params:{name:"Items....",allowBoolean:!0},prep:function(a){return functionBank.join(a).toNum()}},function(a){if(0==a.items.length)return new Vector([]);for(var b=[],c=a.names?[]:void 0,d=0;d<a.items.length;d++){for(var e=!1,f=0;f<b.length;f++)if(strictEquals(a.items[d],b[f])){e=!0;break}e||(b.push(a.items[d]),c&&c.push(a.names[d]))}return new Vector(b,
c)});defineFunction("Unique",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.unique(a)});defineFunction("Union",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){return functionBank.unique(functionBank.join(a).items)});defineFunction("Intersection",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){var b=a[0];a=
a[1];for(var c=[],d=0;d<b.items.length;d++)for(var e=0;e<a.items.length;e++)if(strictEquals(b.items[d],a.items[e])){c.push(b.items[d]);break}return functionBank.unique(c)});defineFunction("Difference",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){var b=a[0];a=a[1];for(var c=[],d=0;d<b.items.length;d++){for(var e=!1,f=0;f<a.items.length;f++)if(strictEquals(b.items[d],a.items[f])){e=!0;break}e||c.push(b.items[d])}for(d=0;d<
a.items.length;d++){e=!1;for(f=0;f<b.items.length;f++)if(strictEquals(a.items[d],b.items[f])){e=!0;break}e||c.push(a.items[d])}return functionBank.unique(c)});defineFunction("Factorial",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(factorial(a[0].toNum().value))});defineFunction("Max",{params:{name:"Items..."},prep:c},function(a){return a.stackApply(function(a){a=a.items;if(0<a.length){for(var b=a[0],c=1;c<a.length;c++)greaterThan(a[c],b)&&(b=a[c]);return b}throw"MSG: You must have at least one element to calculate a max.";
})});defineFunction("Max",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.max(a)});defineFunction("Lookup",{params:[{name:"Value",noVector:!0},{name:"Value Vector",needVector:!0},{name:"Results Vector",needVector:!0}]},function(a){var b=a[0].toNum(),c=a[1].toNum(),d=a[2].toNum();if(c.items.length!=d.items.length)throw"MSG: The value and results vectors must be the same length";if(1>c.items.length)throw"MSG: You must have at least one element in your vectors";
a=[];for(var e=0;e<c.items.length;e++)a.push({x:c.items[e],y:d.items[e]});a.sort(function(a,b){return greaterThan(a.x,b.x)?1:lessThan(a.x,b.x)?-1:0});for(e=0;e<a.length;e++){if(eq(a[e].x,b))return a[e].y.fullClone();if(greaterThan(a[e].x,b)){if(0==e)return a[e].y.fullClone();c=minus(a[e].x,a[e-1].x);d=minus(b,a[e-1].x);b=minus(a[e].x,b);b=div(b,c);c=div(d,c);return plus(mult(a[e-1].y,b),mult(a[e].y,c))}}return a[a.length-1].y.fullClone()});defineFunction("Fill",{object:[functionBank,VectorObject],
params:[{name:"Vector",needVector:!0},{name:"Value",allowBoolean:!0}]},function(a){return e(a[0],a[1])});defineFunction("Min",{params:{name:"Items..."},prep:c},function(a){return a.stackApply(function(a){a=a.items;if(0<a.length){for(var b=a[0],c=1;c<a.length;c++)lessThan(a[c],b)&&(b=a[c]);return b}throw"MSG: You must have at least one element to calculate a median.";})});defineFunction("Min",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.min(a)});defineFunction("Mean",
{params:{name:"Items..."},prep:d},function(a){for(var b=a[0],c=1;c<a.length;c++)b=plus(b,a[c]);return div(b,new Material(a.length))});defineFunction("Mean",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.mean(a)});defineFunction("Sum",{params:{name:"Items..."},prep:d},function(a){for(var b=a[0],c=1;c<a.length;c++)b=plus(b,a[c]);return b});defineFunction("Sum",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.sum(a)});
defineFunction("Product",{params:{name:"Items..."},prep:d},function(a){for(var b=a[0],c=1;c<a.length;c++)b=mult(b,a[c]);return b});defineFunction("Product",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.product(a)});defineFunction("Median",{params:{name:"Items..."},prep:c},function(a){return a.stackApply(function(a){a=functionBank.sort([a]).items;if(0<a.length)return Math.floor((a.length-1)/2)==(a.length-1)/2?a[(a.length-1)/2]:div(plus(a[Math.floor((a.length-
1)/2)],a[Math.ceil((a.length-1)/2)]),new Material(2));throw"MSG: You must have at least one element to calculate a median.";})});defineFunction("Median",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.median(a)});defineFunction("StdDev",{params:{name:"Items..."},prep:c},function(a){return a.stackApply(function(a){a=a.items;if(1<a.length){for(var b=functionBank.mean(a),c=power(minus(a[0],b),new Material(2)),d=1;d<a.length;d++)c=plus(c,power(minus(a[d],b),
new Material(2)));a=power(div(c,new Material(a.length-1)),new Material(0.5));return functionBank.real([a])}throw"MSG: You must have at least two elements to calculate the standard deviation.";})});defineFunction("StdDev",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.stddev(a)});defineFunction("Correlation",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){var b=a[0].toNum();a=a[1].toNum();if(1>=b.length())throw"MSG: You must have at least two elements in your vectors to calculate their correlation.";
if(b.length()!=a.length())throw"MSG: The vectors for Correlation() must be of the same size.";var c=functionBank.mean([b]),d=functionBank.mean([a]),e=functionBank.stddev([b]),f=functionBank.stddev([a]);return 0==e.value||0==f.value?new Material(0):div(functionBank.sum([mult(minus(b.clone(),c),minus(a.clone(),d))]),mult(minus(functionBank.count([b]),new Material(1)),mult(e,f)))});functionBank.count=function(a){a=functionBank.join(a).items;return new Material(sn("#e"+a.length))};functionBank.flatten=
function(a){a=f(functionBank.join(a));return new Vector(a.items,a.hasName?a.names:void 0)};defineFunction("Keys",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return a[0].names?new Vector(a[0].names.filter(function(a){return isDefined(a)}).map(function(a){return s(a)})):new Vector([])});defineFunction("Values",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return new Vector(a[0].items)});defineFunction("Length",{object:VectorObject,params:[{name:"Vector",
needVector:!0}]},function(a){return new Material(sn("#e"+a[0].items.length))});defineFunction("Count",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return new Material(sn("#e"+a[0].items.length))});defineFunction("Flatten",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.flatten(a)});defineFunction("CDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",
defaultVal:1,noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value,c=a[1]?a[1].toNum().value:0;a=a[2]?a[2].toNum().value:1;return new Material(jStat.normal.cdf(b,c,a))});defineFunction("PDFNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value,c=a[1]?a[1].toNum().value:0;a=a[2]?a[2].toNum().value:1;return new Material(jStat.normal.pdf(b,c,a))});
defineFunction("InvNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;if(0>b||1<b)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var c=a[1]?a[1].toNum().value:0;a=a[2]?a[2].toNum().value:1;return new Material(jStat.normal.inv(b,c,a))});defineFunction("CDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,
noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value,c=a[1]?a[1].toNum().value:0;a=a[2]?a[2].toNum().value:1;return new Material(jStat.lognormal.cdf(b,c,a))});defineFunction("PDFLogNormal",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value,c=a[1]?a[1].toNum().value:0;a=a[2]?a[2].toNum().value:
1;return new Material(jStat.lognormal.pdf(b,c,a))});defineFunction("InvLogNormal",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;if(0>b||1<b)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var c=a[1]?a[1].toNum().value:0;a=a[2]?a[2].toNum().value:1;return new Material(jStat.lognormal.inv(b,c,a))});defineFunction("CDFt",{params:[{name:"x",
noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;a=a[1].toNum().value;if(0>=a)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.studentt.cdf(b,a))});defineFunction("PDFt",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;a=a[1].toNum().value;if(0>=a)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.studentt.pdf(b,
a))});defineFunction("Invt",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;if(0>b||1<b)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";a=a[1].toNum().value;if(0>=a)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.studentt.inv(b,a))});defineFunction("CDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",
noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value,c=a[1].toNum().value;if(0>=c)throw"MSG: Degrees of Freedom must be greater than 0.";a=a[2].toNum().value;if(0>=a)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.centralF.cdf(b,c,a))});defineFunction("PDFF",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value,c=a[1].toNum().value;
if(0>=c)throw"MSG: Degrees of Freedom must be greater than 0.";a=a[2].toNum().value;if(0>=a)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.centralF.pdf(b,c,a))});defineFunction("InvF",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 1",noUnits:!0,noVector:!0},{name:"Degrees of Freedom 2",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;if(0>b||1<b)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";var c=a[1].toNum().value;
if(0>=c)throw"MSG: Degrees of Freedom must be greater than 0.";a=a[2].toNum().value;if(0>=a)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.centralF.inv(b,c,a))});defineFunction("CDFChiSquared",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;a=a[1].toNum().value;if(0>=a)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.chisquare.cdf(b,a))});defineFunction("PDFChiSquared",
{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;a=a[1].toNum().value;if(0>=a)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.chisquare.pdf(b,a))});defineFunction("InvChiSquared",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"Degrees of Freedom",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;if(0>b||1<b)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";
a=a[1].toNum().value;if(0>=a)throw"MSG: Degrees of Freedom must be greater than 0.";return new Material(jStat.chisquare.inv(b,a))});defineFunction("CDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;a=a[1].toNum().value;if(0>=a)throw"MSG: Rate must be greater than 0.";return new Material(jStat.exponential.cdf(b,a))});defineFunction("PDFExponential",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Rate",noUnits:!0,
noVector:!0}]},function(a){var b=a[0].toNum().value;a=a[1].toNum().value;if(0>=a)throw"MSG: Rate must be greater than 0.";return new Material(jStat.exponential.pdf(b,a))});defineFunction("InvExponential",{params:[{name:"p",noUnits:!0,noVector:!0},{name:"DRate",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;if(0>b||1<b)throw"MSG: p is a probability and must be between 0 and 1 inclusive.";a=a[1].toNum().value;if(0>=a)throw"MSG: Rate must be greater than 0.";return new Material(jStat.exponential.inv(b,
a))});defineFunction("CDFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;a=a[1].toNum().value;if(0>=a)throw"MSG: Lambda must be greater than 0.";return new Material(jStat.poisson.cdf(b,a))});defineFunction("PMFPoisson",{params:[{name:"x",noUnits:!0,noVector:!0},{name:"Lambda",noUnits:!0,noVector:!0}]},function(a){var b=a[0].toNum().value;a=a[1].toNum().value;if(0>=a)throw"MSG: Rate must be greater than 0.";return new Material(jStat.poisson.pdf(b,
a))});defineFunction("SetRandSeed",{params:[{name:"Seed Number",noUnits:!0,noVector:!0}]},function(a){Math.seedrandom(a[0].toNum().value);return"Random Seed Set"});defineFunction("Alert",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},function(a){alert(a[0]);return 1});defineFunction("Console",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},function(a){console.log(a[0]);return 1});defineFunction("Prompt",{params:[{name:"Message",allowString:!0,allowBoolean:!0},{name:"Default",
defaultVal:"",allowString:!0,allowBoolean:!0}]},function(a){var b=a[1];b instanceof Material&&!b.units&&(b=b.value);a=prompt(a[0],b);return parseFloat(a).toString()==a?new Material(parseFloat(a)):a});defineFunction("Confirm",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},function(a){return confirm(a[0])});defineFunction("Parse",{object:StringObject,params:[{name:"String",allowString:!0}]},function(a){return new Material(parseFloat(a[0],10))});defineFunction("Split",{object:StringObject,
params:[{name:"String",needString:!0},{name:"Splitter",needString:!0}]},function(a){return s(new Vector(a[0].split(a[1])))});defineFunction("Join",{object:VectorObject,params:[{name:"String",needVector:!0},{name:"Joiner",needString:!0}]},function(a){return s(a[0].items.join(a[1]))});defineFunction("Trim",{object:StringObject,params:[{name:"String",needString:!0}],recurse:!0},function(a){return s(a[0].trim())});defineFunction("Range",{object:StringObject,params:[{name:"String",needString:!0},{name:"Indexes",
noUnits:!0,allowVector:!0}]},function(a){if(a[1]instanceof Vector){for(var b="",c=0;c<a[1].items.length;c++)b+=a[0].charAt(a[1].items[c].toNum().value-1);return s(b)}return s(a[0].charAt(a[1].toNum().value-1))});defineFunction("Length",{object:StringObject,params:[{name:"String",needString:!0}]},function(a){return new Material(a[0].length)});defineFunction("IndexOf",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},function(a){return new Material(a[0].indexOf(a[1])+
1)});defineFunction("Contains",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},function(a){return!eq(StringObject.indexof(a),new Material(0))});defineFunction("Lowercase",{object:StringObject,params:[{name:"String",needString:!0}]},function(a){return s(a[0].toLowerCase())});defineFunction("Uppercase",{object:StringObject,params:[{name:"String",needString:!0}]},function(a){return s(a[0].toUpperCase())});StringBase=makeObjectBase(StringObject);VectorBase=
makeObjectBase(VectorObject)});function s(a){if(a instanceof Vector)return a.recurseApply(s);a=new String(a);a.parent=StringBase;return a}function makeObjectBase(a){for(var b=Object.keys(a),c=[],d=0;d<b.length;d++)c.push(objectizeFunction(a[b[d]]));a=new Vector(c,b);a.parent=void 0;return a}
function defineFunction(a,b,c){for(var d=b.params,e=Array.isArray(d),f=[],g=d.length,k=0;k<d.length;k++)if(d[k].hasOwnProperty("defaultVal")){g=k;break}for(k=0;k<d.length;k++)if(d[k].vectorize&&(f.push(k),d[k].noVector))throw"MSG: Cannot have a non-vector vectorized parameter. Function '"+a+"', parameter '"+d[k].name+"'.";var l;l=e?b.object?a+"("+d.slice(1).map(function(a){return a.name+(a.hasOwnProperty("defaultVal")?"="+a.defaultVal.toString():"")}).join(", ")+")":a+"("+d.map(function(a){return a.name+
(a.hasOwnProperty("defaultVal")?"="+a.defaultVal.toString():"")}).join(", ")+")":a+"(items...)";var m=function(k,p){b.prep&&(k=b.prep(k));if(e&&(k.length>d.length||k.length<g))throw"MSG: Wrong number of parameters for "+l+".";if(!e&&0==k.length&&!b.allowEmpty)throw"MSG: At least one parameter required for "+a+"().";for(var q=0;q<k.length;q++){var u=e?d[q]:d;if(u.noUnits&&k[q].toNum()instanceof Material&&k[q].toNum().units)throw"MSG: "+l+" does not except units for the argument '"+u.name+"'.";if(u.noVector&&
k[q]instanceof Vector)throw"MSG: "+l+" does not except vectors for the argument '"+u.name+"'.";if(u.vectorize&&k[q]instanceof Vector&&!k[q].names)throw"MSG: "+l+" does not accepted non-named vectors for the argument '"+u.name+"'.";if(u.needVector&&(k[q]instanceof Primitive&&(k[q]=k[q].toNum()),!(k[q]instanceof Vector)))throw"MSG: "+l+" requires a vector for the argument '"+u.name+"'.";if(u.needPrimitive&&!(k[q]instanceof Primitive))throw"MSG: "+l+" requires a primitive for the argument '"+u.name+
"'.";if(!u.allowBoolean&&"boolean"==typeof k[q])throw"MSG: "+l+" does not accept boolean values for the argument '"+u.name+"'.";!u.needAgent||k[q]instanceof Agent||(k[q]=agent(k[q],l,u.name));if(u.needString&&!("string"==typeof k[q]||k[q]instanceof String))throw"MSG: "+l+" requires a string for the argument '"+u.name+"'.";if(!u.allowString&&!u.needString&&("string"==typeof k[q]||k[q]instanceof String))throw"MSG: "+l+" does not accept string values for the argument '"+u.name+"'.";!u.needAgents||k[q]instanceof
Agents||(k[q]=agents(k[q],l,u.name));!u.needPopulation||k[q]instanceof Vector||(k[q]=getPopulation(k[q],l,u.name));if(u.needFunction&&!(k[q]instanceof Function||k[q]instanceof UserFunction))throw"MSG: "+l+" requires a function for the argument '"+u.name+"'.";}if(b.recurse)var v=k[0].toNum();if(b.recurse&&v instanceof Vector)return v.cloneApply(function(a){return m([a].concat(k.slice(1)),p)});if(0<f.length){u=void 0;v=-1;for(q=0;q<f.length;q++)if(k[f[q]]){var y=k[f[q]].toNum();if(y instanceof Vector&&
y.namesLC)if(!u)u=y,v=f[q];else if(!u.keysMatch(y.namesLC))throw"MSG: Vector keys do not match between parameters '"+d[v].name+"' and '"+d[f[q]].name+"' in "+l+".";}if(u){for(var z=u.namesLC,x=[],q=0;q<z.length;q++){for(var B=[],A=0;A<k.length;A++)-1==f.indexOf(A)?B.push(k[A]):(y=k[A].toNum(),y instanceof Vector&&y.namesLC?B.push(y.select([z[q]])):B.push(y));y=c(B,p);if(y instanceof Vector){if(!u.keysMatch(y.namesLC))throw"MSG: Vector keys do not match between parameter '"+d[v].name+"' and calculation result.";
x.push(y.select([z[q]]))}else x.push(y)}return new Vector(x,z)}}return c(k,p)};if(b.object)if(b.object instanceof Array)for(k=0;k<b.object.length;k++)b.object[k][a.toLowerCase()]=m;else b.object[a.toLowerCase()]=m;else functionBank[a.toLowerCase()]=m;b.recurse&&(VectorObject[a.toLowerCase()]=m)}function objectizeFunction(a){var b=function(b,d,e){return a([e].concat(b),d,e)};b.delayEvalParams=a.delayEvalParams;return b}
function factorial(a){if(Math.round(a)!=a)throw"MSG: The factorial() function only accepts integers.";if(0>a)throw"MSG: The factorial() function is only defined for integers 0 or larger.";return 1<a?a*factorial(a-1):1}function testArgumentsSize(a,b,c,d){if(a.length<c||a.length>d)throw"MSG: Wrong number of parameters for "+b+"().";};var AgentBase,AgentObject={},PrimitiveBase,PrimitiveObject={};
functionLoaders.push(function(){function a(a){if(a instanceof Vector){if(2!=a.items.length)throw"MSG: Location vector does not contain exactly two elements.";return a}try{return agent(a).location}catch(c){throw"MSG: Location must be a vector or an agent.";}}defineFunction("Stop",{params:[]},function(a){throw{msg:"STOP"};});defineFunction("Pause",{params:[]},function(a){simulate.sleep(!0);return new Material(0)});defineFunction("Time",{params:[]},function(a){return simulate.time().fullClone()});defineFunction("TimeStep",
{params:[]},function(a){return simulate.timeStep.fullClone()});defineFunction("TimeLength",{params:[]},function(a){return simulate.timeLength.fullClone()});defineFunction("TimeStart",{params:[]},function(a){return simulate.timeStart.fullClone()});defineFunction("TimeEnd",{params:[]},function(a){return simulate.timeEnd.fullClone()});defineFunction("Seconds",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,
getUnitStore(["seconds"],[-1])))});defineFunction("Minutes",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["minutes"],[-1])))});defineFunction("Hours",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["hours"],[-1])))});defineFunction("Days",{params:[{name:"Value",
defaultVal:"time",vectorize:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["days"],[-1])))});defineFunction("Weeks",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["weeks"],[-1])))});defineFunction("Months",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},function(a){a=0==a.length?simulate.time().fullClone():
a[0].toNum();return mult(a,new Material(1,getUnitStore(["months"],[-1])))});defineFunction("Years",{params:[{name:"Value",defaultVal:"time",vectorize:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["years"],[-1])))});defineFunction("Seasonal",{params:[{name:"Peak",defaultVal:"0",vectorize:!0}]},function(a){0==a.length?a=new Material(0,simulate.timeUnits):(a=a[0].fullClone(),a.units||(a.units=simulate.timeUnits));a=6.28318530718*minus(functionBank.time([]),
a).forceUnits(createUnitStore("years")).value;return new Material(Math.cos(a))});defineFunction("Unitless",{params:[{name:"Value",noVector:!0}]},function(a){return new Material(a[0].toNum().value)});defineFunction("PastMean",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},function(a){return 1==a.length?functionBank.mean(a[0].getPastValues()):functionBank.mean(a[0].getPastValues(a[1].toNum()))});
defineFunction("PastMedian",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},function(a){return 1==a.length?functionBank.median(a[0].getPastValues()):functionBank.median(a[0].getPastValues(a[1].toNum()))});defineFunction("PastValues",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},function(a){a=
1==a.length?a[0].getPastValues():a[0].getPastValues(a[1].toNum());return new Vector(a)});defineFunction("PastStdDev",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},function(a){a=1==a.length?a[0].getPastValues():a[0].getPastValues(a[1].toNum());return 1<a.length?functionBank.stddev(a):new Material(0)});defineFunction("PastCorrelation",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},
{name:"[Primitive]",noVector:!0,needPrimitive:!0,object:[functionBank,PrimitiveObject]},{name:"Past Range",vectorize:!0,defaultVal:"All Time"}]},function(a){var c;"All Time"!=a[2]?(c=a[0].getPastValues(),a=a[1].getPastValues()):(c=a[0].getPastValues(a[2].toNum()),a=a[1].getPastValues(a[2].toNum()));return 1<c.length?functionBank.correlation([new Vector(c),new Vector(a)]):new Material(0)});defineFunction("PastMax",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},
{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},function(a){return 1==a.length?functionBank.max(a[0].getPastValues()):functionBank.max(a[0].getPastValues(a[1].toNum()))});defineFunction("PastMin",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",vectorize:!0}]},function(a){return 1==a.length?functionBank.min(a[0].getPastValues()):functionBank.min(a[0].getPastValues(a[1].toNum()))});defineFunction("Pulse",
{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1},{name:"Width",vectorize:!0,defaultVal:0},{name:"Repeat Period",vectorize:!0,defaultVal:0}]},function(a){var c=a[0].toNum(),d=new Material(1),e=new Material(0),f=new Material(0);1<a.length&&(d=a[1].toNum(),2<a.length&&(e=a[2].toNum(),3<a.length&&(f=a[3].toNum())));c.units||(c.units=simulate.timeUnits);e.units||(e.units=simulate.timeUnits);f.units||(f.units=simulate.timeUnits);if(0>=f.value){if(eq(simulate.time(),c)||
greaterThanEq(simulate.time(),c)&&lessThanEq(simulate.time(),plus(c,e)))return d}else if(greaterThanEq(simulate.time(),c)){a=minus(simulate.time(),mult(functionBank.floor([div(minus(simulate.time(),c),f)]),f));var g=minus(simulate.time(),c);if(0==minus(functionBank.round([div(g,f)]),div(g,f)).value||greaterThanEq(a,c)&&lessThanEq(a,plus(c,e)))return d}return new Material(0,d.units)});defineFunction("Ramp",{params:[{name:"Start Time",vectorize:!0},{name:"Finish Time",vectorize:!0},{name:"Height",vectorize:!0,
defaultVal:1}]},function(a){var c=a[0].toNum(),d=a[1].toNum(),e=new Material(1);3==a.length&&(e=a[2].toNum());c.units||(c.units=simulate.timeUnits);d.units||(d.units=simulate.timeUnits);return greaterThanEq(simulate.time(),c)?div(mult(functionBank.min([minus(d,c),minus(simulate.time(),c)]),e),minus(d,c)):new Material(0,e.units)});defineFunction("Step",{params:[{name:"Start Time",vectorize:!0},{name:"Height",vectorize:!0,defaultVal:1}]},function(a){var c=a[0].toNum(),d=new Material(1);2==a.length&&
(d=a[1].toNum());c.units||(c.units=simulate.timeUnits);return greaterThanEq(simulate.time(),c)?d:new Material(0,d.units)});functionBank.staircase=functionBank.step;defineFunction("Smooth",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Period",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},function(a){if(0>=a[1].toNum().value)throw"MSG: The smoothing period must be greater than 0.";return 2==a.length?a[0].smoothF(a[1].toNum()):
a[0].smoothF(a[1].toNum(),a[2].toNum())});defineFunction("Delay",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",defaultVal:"None",vectorize:!0}]},function(a){if(0>a[1].toNum().value)throw"MSG: The delay must be greater than or equal to 0.";return 2==a.length?a[0].pastValue(a[1].toNum()):a[0].pastValue(a[1].toNum(),a[2].toNum())});defineFunction("Delay1",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",
noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},function(a){if(0>=a[1].toNum().value)throw"MSG: The delay must be greater than 0.";return 2==a.length?a[0].expDelayF(1,a[1].toNum()):a[0].expDelayF(1,a[1].toNum(),a[2].toNum())});defineFunction("Delay3",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Delay",vectorize:!0},{name:"Initial Value",vectorize:!0,defaultVal:"None"}]},function(a){if(0>=
a[1].toNum().value)throw"MSG: The delay must be greater than 0.";return 2==a.length?a[0].expDelayF(3,a[1].toNum()):a[0].expDelayF(3,a[1].toNum(),a[2].toNum())});functionBank.fix=function(a,c){testArgumentsSize(a,"Fix",1,2);var d=-1;2==a.length&&(d=evaluateNode(a[1].node,a[1].scope).toNum());for(var e=null,f=0;f<simulate.oldAggregateSeries.length;f++)if(simulate.oldAggregateSeries[f].match(c)){e=simulate.oldAggregateSeries[f];break}null===e&&(e=new AggregateSeries(c,d),simulate.oldAggregateSeries.push(e));
return e.get(a[0])};functionBank.fix.delayEvalParams=!0;functionBank.populationsize=function(a){testArgumentsSize(a,"PopulationSize",1,1);if(a[0]instanceof Agents)return new Material(sn("#e"+a[0].agents.length));throw"MSG: PopulationSize must be passed an agent population as an argument.";};PrimitiveObject.populationsize=functionBank.populationsize;defineFunction("Remove",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},function(a){if(a[0].dead)throw"MSG: Cannot remove an already removed agent.";
simulate.tasks.add(new Task({time:simulate.time(),priority:10,expires:1,name:"Remove Agent",action:function(){a[0].die()}}));return new Material(1)});defineFunction("Add",{object:[functionBank,PrimitiveObject],params:[{name:"[Agent Population]"},{needAgent:!0,name:"[Base]",defaultVal:"Agent Base"}]},function(a){for(;!(a[0]instanceof Agents)&&null!=a[0].container;)a[0]=a[0].container;if(!(a[0]instanceof Agents))throw"MSG: You must pass an agent population as the first argument to Add().";return 2==
a.length?a[0].add(a[1]):a[0].add()});defineFunction("FindAll",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"}]},function(a){return a[0]});defineFunction("ResetTimer",{object:[functionBank,PrimitiveObject],params:[{needPrimitive:!0,name:"[Action]"}]},function(a){if(!(a[0]instanceof Action))throw"MSG: ResetTimer requires an Action primitive.";a[0].resetTimer();return new Material(0)});defineFunction("Transition",{object:[functionBank,PrimitiveObject],
params:[{needPrimitive:!0,name:"[Transition]"}]},function(a){if(!(a[0]instanceof Transition))throw"MSG: Transition requires an Transition primitive.";a[0].doTransition();return new Material(0)});defineFunction("Value",{object:[functionBank,VectorObject,AgentObject],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"}]},function(a){var c=a[1].id,d=null;a[0]instanceof Agents||a[0]instanceof Agent||a[0]instanceof Vector||!a[0]||(a[0]=a[0].toNum());a[0]instanceof Agents&&(d=getPopulation(a[0]));
a[0]instanceof Vector&&(d=a[0]);if(null!==d){a=[];for(var e=-1,f=0;f<d.items.length;f++)if(-1!=e)a.push(d.items[f].children[e]);else for(var g=0;g<d.items[f].children.length;g++)if(d.items[f].children[g].id==c){a.push(d.items[f].children[g]);e=g;break}return new Vector(a)}if(a[0]instanceof Agent){for(g=0;g<a[0].children.length;g++)if(a[0].children[g].id==c)return a[0].children[g];throw'MSG: Could not find referenced primitive for "Value()".';}throw'MSG: Invalid type for the first argument of "Value()".';
});defineFunction("SetValue",{object:[functionBank,VectorObject,PrimitiveObject,AgentObject],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"},{name:"Value",noVector:!0,allowBoolean:!0}]},function(a){var c=a[1].id,d=null;a[0]instanceof Agents&&(d=getPopulation(a[0]));a[0]instanceof Vector&&(d=a[0]);if(null!==d){for(var e=0;e<d.length();e++)for(var f=0;f<d.items[e].children.length;f++)d.items[e].children[f].id==c&&d.items[e].children[f].setValue(a[2]);return new Material(1)}if(a[0]instanceof
Agent){for(f=0;f<a[0].children.length;f++)if(a[0].children[f].id==c)return a[0].children[f].setValue(a[2]),new Material(1);throw'MSG: Could not find referenced primitive for "SetValue()".';}throw'MSG: Invalid type for the first argument of "SetValue()".';});defineFunction("FindIndex",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Index",noVector:!0,noUnits:!0}]},function(a){for(var c=a[0],d=0;d<c.length();d++)if(c.items[d].index+1==
a[1].value)return c.items[d];throw"MSG: Index not found in population.";});defineFunction("FindState",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},function(a){var c=a[0];if(!(a[1]instanceof State||"State"===a[1].dna.type))throw"MSG: FindState() requires a State primitive as its argument.";a=a[1].id;for(var d=[],e=0;e<c.items.length;e++)-1!==c.items[e].stateIDs.indexOf(a)&&d.push(c.items[e]);return new Vector(d)});
defineFunction("FindNotState",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},function(a){var c=a[0];if(!(a[1]instanceof State||"State"===a[1].dna.type))throw"MSG: FindNotState() requires a State primitive as its argument.";a=a[1].id;for(var d=[],e=0;e<c.items.length;e++)-1===c.items[e].stateIDs.indexOf(a)&&d.push(c.items[e]);return new Vector(d)});defineFunction("FindNearby",{object:[functionBank,VectorObject,
PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{name:"Distance Limit",noVector:!0}]},function(b){var c=b[0],d=a(b[1]);try{var e=agent(b[1])}catch(f){}for(var g=[],k=0;k<c.length();k++){var l=agent(c.items[k]);l!==e&&lessThanEq(distance(d,l),b[2])&&g.push(l)}return new Vector(g)});defineFunction("FindNearest",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,defaultVal:1,
name:"Count"}]},function(b){var c=b[0],d=1;if(3==b.length){d=b[2].value;if(1>d)throw"MSG: You must select at least one agent in FindNearest().";if(d!=Math.floor(d))throw"MSG: Count must be an integer.";}var e=a(b[1]);try{var f=agent(b[1])}catch(g){}b=[];for(var k=0;k<c.items.length;k++){var l=agent(c.items[k]);l!==f&&b.push({distance:distance(e,l),item:l})}if(b.length<d)throw"MSG: Can't find nearest "+d+" agents of a population of size "+b.length+".";c=[b[0]];for(k=1;k<b.length;k++){e=!1;for(f=0;f<
c.length;f++)if(lessThan(b[k].distance,c[f].distance)){c.splice(f,0,b[k]);e=!0;break}!e&&c.length<d?c.push(b[k]):c.length>d&&(c.length=d)}if(1===c.length)return c[0].item;c.sort(function(a,b){return a.distance-b.distance});return new Vector(c.map(function(a){return a.item}))});defineFunction("FindFurthest",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Target"},{noUnits:!0,noVector:!0,defaultVal:1,name:"Count"}]},function(b){var c=
b[0],d=1;if(3===b.length){d=b[2].value;if(1>d)throw"MSG: You must select at least one agent in FindFurthest().";if(d!=Math.floor(d))throw"MSG: Count must be an integer.";}var e=a(b[1]);try{var f=agent(b[1])}catch(g){}b=[];for(var k=0;k<c.items.length;k++){var l=agent(c.items[k]);l!==f&&b.push({distance:distance(e,l),item:l})}if(b.length<d)throw"MSG: Can't find furthest "+d+" agents of a population of size "+b.length+".";c=[b[0]];for(k=1;k<b.length;k++){e=!1;for(f=0;f<c.length;f++)if(greaterThan(b[k].distance,
c[f].distance)){c.splice(f,0,b[k]);e=!0;break}!e&&c.length<d?c.push(b[k]):c.length>d&&(c.length=d)}if(1===c.length)return c[0].item;c.sort(function(a,b){return b.distance-a.distance});return new Vector(c.map(function(a){return a.item}))});defineFunction("Index",{object:[functionBank,AgentObject],params:[{noVector:!0,needAgent:!0,name:"[Agent]"}]},function(a){return new Material(sn("#e"+(a[0].index+1)))});defineFunction("Connect",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},
{name:"[Agent 2]"},{name:"Weight",defaultVal:"missing"}]},function(a){var c=void 0;"missing"!=a[2]&&(c=a[2]);a[1]instanceof Vector?a[1].items.forEach(function(d){a[0].connect(d,c)}):a[0].connect(a[1],c);return new Material(1)});defineFunction("Unconnect",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},function(a){a[1]instanceof Vector?a[1].items.forEach(function(c){a[0].unconnect(c)}):a[0].unconnect(a[1]);return new Material(1)});defineFunction("Connected",
{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},function(a){return new Vector(a[0].connected.slice())});defineFunction("ConnectionWeight",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},function(a){return a[1]instanceof Vector?new Vector(a[1].items.map(function(c){return a[0].connectionWeight(c)})):a[0].connectionWeight(a[1])});defineFunction("SetConnectionWeight",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},
{name:"[Agent 2]"},{name:"Weight"}]},function(a){a[1]instanceof Vector?a[1].items.forEach(function(c){a[0].setConnectionWeight(c,a[2])}):a[0].setConnectionWeight(a[1],a[2]);return new Material(1)});functionBank.die=function(a){console.log(a);throw'MSG: Terminated using "die".';};functionBank.print=function(a){if(2==a.length)return console.log(a[0].value.toString()),console.log(a[1]),a[1];console.log(a[0]);return a[0]};defineFunction("Width",{params:[{needAgents:!0,name:"[Agent Population]"}]},function(a){return a[0].geoWidth});
defineFunction("Height",{params:[{needAgents:!0,name:"[Agent Population]"}]},function(a){return a[0].geoHeight});defineFunction("Distance",{object:[functionBank,AgentObject],params:[{name:"Location 1"},{name:"Location 2"}]},function(b){b[0]=a(b[0]);b[1]=a(b[1]);return distance(b[0],b[1])});defineFunction("Location",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},function(a){if(a[0].location)return a[0].location.fullClone();throw"MSG: The location is not defined.";});defineFunction("SetLocation",
{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"},{needVector:!0,name:"Direction"}]},function(a){var c=a[1].toNum();a=a[0];a.location=c.fullClone();a.location.names||(a.location.names=["x","y"],a.location.namesLC=["x","y"]);return new Material(0)});defineFunction("Move",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Mover]"},{needVector:!0,name:"Direction"}]},function(a){var c=a[1].toNum();shiftLocation(a[0],plus(a[0].location,c));return new Material(0)});defineFunction("MoveTowards",
{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Mover]"},{name:"[Target]"},{name:"Distance",noVector:!0}]},function(b){var c=b[0],d=a(b[1]),e=c.location,f=minus(d.items[0],e.items[0]),d=minus(d.items[1],e.items[1]);if(0==f.value&&0==d.value)return new Material(1);c.container.geoWrap&&(greaterThan(f,c.container.halfWidth)?f=minus(c.container.geoWidth,f):lessThan(f,negate(c.container.halfWidth))&&(f=minus(f,negate(c.container.geoWidth))),greaterThan(d,c.container.halfHeight)?d=minus(c.container.geoHeight,
d):lessThan(d,negate(c.container.halfHeight))&&(d=minus(d,negate(c.container.geoHeight))));c=new Vector([f,d],["x","y"]);shiftLocation(b[0],plus(b[0].location,mult(c,div(b[2],distance(b[0],b[1]instanceof Vector?b[1]:agent(b[1]))))));return new Material(1)});PrimitiveBase=makeObjectBase(PrimitiveObject);AgentBase=makeObjectBase(AgentObject);PrimitiveBase.parent=AgentBase;VectorBase=makeObjectBase(VectorObject)});
function distance(a,b){var c=a instanceof Vector?a:a.location,d=b instanceof Vector?b:b.location,e=c.items[0].toString()+","+c.items[1].toString(),f=d.items[0].toString()+","+d.items[1].toString();if(simulate.distanceCache[e+"-"+f])return simulate.distanceCache[e+"-"+f];if(simulate.distanceCache[f+"-"+e])return simulate.distanceCache[f+"-"+e];var g=minus(c.items[0],d.items[0]),c=minus(c.items[1],d.items[1]),d=null;a instanceof Vector?b instanceof Vector||(d=b.container):d=a.container;null!==d&&d.geoWrap&&
(greaterThan(g,d.halfWidth)?g=minus(d.geoWidth,g):lessThan(g,negate(d.halfWidth))&&(g=minus(g,negate(d.geoWidth))),greaterThan(c,d.halfHeight)?c=minus(d.geoHeight,c):lessThan(c,negate(d.halfHeight))&&(c=minus(c,negate(d.geoHeight))));var d=g.value,k=c.value;g.units!==c.units&&(k=fn["*"](k,convertUnits(g.units,c.units)));c=fn["real-part"](fn.sqrt(fn["+"](fn["*"](d,d),fn["*"](k,k))));c=new Material(c,g.units);return simulate.distanceCache[e+f]=c}
function agent(a){if(a instanceof Variable||a instanceof Stock)a=a.toNum();if(a instanceof Agent)return a;if(!strictAgentResolution&&a instanceof Primitive)return agent(a.container);throw"MSG: An agent is required here.";}function agents(a){if(a instanceof Agents)return a;if(a instanceof Primitive||a instanceof Agent)return agents(a.container);throw"MSG: An agent population is required here.";}
function getPopulation(a){return a.items?a:a instanceof Agents?new Vector(a.agents.slice()):a.toNum()instanceof Vector?a.toNum():new Vector([agent(a)])}
function shiftLocation(a,b){if(a.container.geoWrap){for(;lessThan(b.items[0],new Material(0));)b.items[0]=plus(b.items[0],a.container.geoWidth);for(;greaterThan(b.items[0],a.container.geoWidth);)b.items[0]=minus(b.items[0],a.container.geoWidth);for(;lessThan(b.items[1],new Material(0));)b.items[1]=plus(b.items[1],a.container.geoHeight);for(;greaterThan(b.items[1],a.container.geoHeight);)b.items[1]=minus(b.items[1],a.container.geoHeight)}a.location=b;a.location.names||(a.location.names=["x","y"],a.location.namesLC=
["x","y"])}function isUndefined(a){return"undefined"==typeof a}function isDefined(a){return!isUndefined(a)}function constraintAlert(a,b,c){b="The "+("max"==b?"maximum":"minimum")+" constraint on the primitive <b>"+clean(getName(findID(a.id)))+"</b> has been violated. The primitive's value attempted to become "+c.value+" when the "+("max"==b?"maximum":"minimum")+" allowed value is "+("max"==b?a.dna.maxConstraint:a.dna.minConstraint)+".";error(b,a,!1)}
function error(a,b,c,d,e){a={msg:a,primitive:b,showEditor:c,line:d,details:e};isLocal()&&(console.log("Error:"),console.log(a));throw a;}function testPrimitive(a,b,c){for(var d=0;d<c.length;d++)if(!(a[c[d]]instanceof Primitive))throw"MSG: "+b+"() requires a primitive reference to be passed to it as argument number "+(c[d]+1)+".";}function prepareDisplay(a){return a};function AggregateSeries(a,b){this.id=a;this.spacing=b;this.oldValues=[]}AggregateSeries.method("match",function(a){return this.id==a});
AggregateSeries.method("get",function(a){for(var b=0,b=0>this.spacing?0:0==this.spacing?Math.floor(div(minus(simulate.time(),simulate.timeStart),simulate.UserTimeStep).value):Math.floor(div(minus(simulate.time(),simulate.timeStart),this.spacing.forceUnits(simulate.timeUnits)).value);this.oldValues.length-1<b;)this.oldValues.push(evaluateNode(a.node,a.scope));return this.oldValues[b].fullClone?this.oldValues[b].fullClone():this.oldValues[b]});function DataBank(){this.dataSeries={}}
DataBank.method("series",function(){return Object.keys(this.dataSeries)});DataBank.method("clone",function(){for(var a=new DataBank,b=this.series(),c=0;c<b.length;c++)a.dataSeries[b[c]]=this.dataSeries[b[c]];return a});DataBank.method("getSeries",function(a){this.dataSeries[a]||(this.dataSeries[a]=[]);return this.dataSeries[a]});DataBank.method("trimValues",function(a){for(var b=this.series(),c=0;c<b.length;c++){var d=this.getSeries(b[c]);d.length-1>a&&d.splice(a+1,d.length-a+1)}});
function ExpGroup(a,b,c){this.stocks=[];this.k=b;for(b=1;b<=a;b++)this.stocks.push(c);this.out=c}ExpGroup.method("moveForward",function(a){var b=new ExpGroup(this.stocks.length,this.k,new Material(0));b.out=this.stocks[this.stocks.length-1];for(var c=this.stocks.length-1;0<c;c--)b.stocks[c]=plus(mult(this.stocks[c],new Material(1-this.k)),mult(this.stocks[c-1],new Material(this.k)));b.stocks[0]=plus(mult(this.stocks[0],new Material(1-this.k)),mult(a,new Material(this.k)));return b});function Primitive(){this.equation=this.dna=this.container=this.instanceId=this.index=this.agentId=this.id=null;this.cachedValue=void 0;this.pastValues=[];this.pastData=new DataBank;this.frozen=!1;this.parent=PrimitiveBase}
Primitive.method("clone",function(){var a=new this.constructorFunction;a.dna=this.dna;a.container=this.container;a.agentId=this.agentId;a.index=this.index;a.id=this.id;a.createIds();a.pastValues=this.pastValues.slice(0);this.dna.slider&&(simulate.sliders[this.dna.id]?simulate.sliders[this.dna.id].push(a):simulate.sliders[this.dna.id]=[a]);a.cachedValue=this.cachedValue?this.cachedValue.fullClone():this.cachedValue;this.innerClone(a);return a});
Primitive.method("clearCached",function(){this.cachedValue=void 0});Primitive.method("storeValue",function(){isUndefined(this.cachedValue)&&this.value();this.pastValues.push(this.cachedValue)});Primitive.method("toNum",function(){return this.value()});Primitive.method("calculateValue",function(){throw"MSG: "+getText("[%s] does not have a value and can not be used as a value in an equation.",this.dna.name);});Primitive.method("createIds",function(){this.instanceId=simulate.getID(this.agentId+"-"+this.index)});
Primitive.method("getPastValues",function(a){var b=this.pastValues.slice(),c=Math.ceil(div(simulate.time(),this.dna.solver.userTimeStep).value)+1;b.length<c&&b.push(this.value());if(isUndefined(a))a=b.map(function(a){return a.fullClone()});else for(c=Math.ceil(div(a.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value),a=[],c=Math.max(0,b.length-1-c);c<b.length;c++)a.push(b[c].fullClone());return a});
Primitive.method("pastValue",function(a,b){var c;c=this.pastValues.length-1<Math.round((simulate.time().value-simulate.timeStart.value)/this.dna.solver.userTimeStep.value)?div(a.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value:div(a.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value+1;if(0==c)return this.value();if(Math.ceil(c)>this.pastValues.length)return isUndefined(b)?0<this.pastValues.length?this.pastValues[0].fullClone():this.value():b;if(c==Math.round(c))return 0==
c?value:this.pastValues[this.pastValues.length-c].fullClone();var d=c-Math.floor(c),e=Math.floor(c);c=0==e?this.value():this.pastValues[this.pastValues.length-e];e=this.pastValues[this.pastValues.length-1-e];return plus(mult(c,new Material(1-d)),mult(e,new Material(d)))});
Primitive.method("smoothF",function(a,b){var c=div(this.dna.solver.userTimeStep,a.forceUnits(simulate.timeUnits)).value,d=this.pastData.getSeries("Smooth: "+c+","+b);0==d.length&&(isUndefined(b)?d.push(this.pastValues[0]?this.pastValues[0]:this.value()):d.push(b));for(var e=Math.floor((simulate.time().value-simulate.timeStart.value)/this.dna.solver.userTimeStep.value),f=d.length-1;f<e;f++){var g=this.pastValues[f]?this.pastValues[f]:this.cachedValue?this.cachedValue:this.pastValues[f-1];d.push(plus(mult(d[f],
new Material(1-c)),mult(new Material(c),g)))}return d[d.length-1].fullClone()});
Primitive.method("expDelayF",function(a,b,c){this.value();var d=div(this.dna.solver.userTimeStep,b.forceUnits(simulate.timeUnits)).value*a;b=this.pastData.getSeries("ExpDelay: "+a+","+b.value+","+c);0==b.length&&(isUndefined(c)?b.push(new ExpGroup(a,d,this.pastValues[0]?this.pastValues[0]:this.value())):(a=new ExpGroup(a,d,c),b.push(a.moveForward(this.pastValues[0]?this.pastValues[0]:this.value()))));for(a=b.length;a<this.pastValues.length;a++)b.push(b[a-1].moveForward(this.pastValues[a]));return b[b.length-
1].out.fullClone()});
Primitive.method("testUnits",function(a,b){if(a instanceof Vector){var c=this;a.recurseApply(function(a){c.testUnits(a,b);return a})}else{if(!this.dna.units&&a.units)error(getText("Wrong units generated for %s. Expected no units and got %s. Either specify units for the primitive or adjust the equation.","<i>"+clean(this.dna.name)+"</i>","<i>"+clean(a.units.toString())+"</i>"),this,!0);else if(this.dna.units!==a.units){var d=convertUnits(a.units,this.dna.units,!0);if(0==d){isLocal()&&(console.log(a.units),
console.log(this.dna.units));error(getText("Wrong units generated for %s. Expected %s, and got %s.","<i>"+clean(this.dna.name)+"</i>","<i>"+clean(this.dna.units.toString())+"</i>","<i>"+clean(a.units.toString())+"</i>"),this,!0);return}a.value*=d;a.units=this.dna.units}this instanceof Flow&&!0!=b&&this.dna.flowUnitless&&(d=mult(a,new Material(1,simulate.timeUnits)),a.value=d.value,a.units=d.units)}});
Primitive.method("setValue",function(){throw"MSG: "+getText("You cannot set the value for that primitive.");});Primitive.method("printPastValues",function(){console.log(this.pastValues.map(function(a){return a.value}))});
Primitive.method("value",function(){if(isUndefined(this.cachedValue)&&this.frozen&&0<this.pastValues.length){var a=this.pastValues[this.pastValues.length-1];this.cachedValue=a.fullClone?a.fullClone():a}if(isUndefined(this.cachedValue)){if(-1<simulate.valuedPrimitives.indexOf(this))throw"MSG: "+getText("Circular equation loop identified including the primitives: %s",simulate.valuedPrimitives.slice(simulate.valuedPrimitives.indexOf(this)).map(function(a){return a.dna.name}).join(", "));simulate.valuedPrimitives.push(this);
try{var b=this.calculateValue().toNum();if(b instanceof Material&&!isFinite(b.value)){isLocal()&&console.log(b);if(this instanceof Stock)throw"MSG: "+getText("The stock has become infinite in size. Check the flows into it for rapid growth.");throw"MSG: "+getText("The result of this calculation is not a number (are you dividing by 0?).");}}catch(c){if(!c.substr)throw c;isLocal()&&console.log(c);"MSG:"==c.substr(0,4)?error(c.substr(4,c.length),this,!0):error(c,this,!0)}this instanceof State||(this.testUnits(b),
this.testConstraints(b));this.cachedValue=b}return this.cachedValue.fullClone?this.cachedValue.fullClone():this.cachedValue});
Primitive.method("testConstraints",function(a){var b=this,c=function(a){(1==b.dna.maxConstraintType&&a.value>b.dna.maxConstraint||2==b.dna.maxConstraintType&&a.value>=b.dna.maxConstraint)&&constraintAlert(b,"max",a);(1==b.dna.minConstraintType&&a.value<b.dna.minConstraint||2==b.dna.minConstraintType&&a.value<=b.dna.minConstraint)&&constraintAlert(b,"min",a);return a};a instanceof Vector?a.recurseApply(c):c(a)});
Primitive.method("setEquation",function(a,b){if(this instanceof Flow||this instanceof Transition)null!==this.omega&&(b.omega=this.omega),null!==this.alpha&&(b.alpha=this.alpha);try{this.equation=trimTree(a,b)}catch(c){isLocal()&&console.log(c),error(c.substr(4,c.length),this,!0)}});function Placeholder(a,b){this.dna=a;this.id=a.id;this.primitive=b}Placeholder.inherits(Primitive);
Placeholder.method("calculateValue",function(){error(getText("[%s] is a placeholder and cannot be used as a direct value in equations.",clean(this.dna.name)),this.primitive,!0)});function State(){Primitive.call(this);this.active=null;this.downStreamTransitions=[];this.constructorFunction=State}State.inherits(Primitive);State.method("innerClone",function(a){a.setValue(this.active)});
State.method("setValue",function(a){this.setActive(trueValue(a));this.cachedValue=void 0;simulate.valuedPrimitives=[];this.value();this.agentId&&this.container.updateStates()});State.method("calculateValue",function(){null===this.active&&this.setInitialActive(!0);return this.active?new Material(1):new Material(0)});
State.method("setInitialActive",function(a){var b;try{b=evaluateTree(this.equation,globalVars(this)).toNum()}catch(c){if(!c.substr)throw c;isLocal()&&console.log(c);"MSG:"==c.substr(0,4)?error(c.substr(4,c.length),this,!0):error(c,this,!0)}this.setActive(trueValue(b),a);this.agentId&&this.container.updateStates()});
State.method("setActive",function(a,b){if((this.active=a)&&null!==this.dna.residency){var c=this;simulate.tasks.add(new Task({name:"State Residency",time:plus(simulate.time(),this.dna.residency),priority:5,expires:1,action:function(){for(var a=0;a<c.downStreamTransitions.length;a++)scheduleTrigger.call(c.downStreamTransitions[a])}}))}else if(!b){if(a){simulate.transitionPrimitives||(simulate.transitionPrimitives=[]);if(1200<simulate.transitionPrimitives.length&&-1<simulate.transitionPrimitives.indexOf(this))throw"MSG: "+
getText("Circular fully active transition loop identified including the states: %s",simulate.transitionPrimitives.slice(0,5).map(function(a){return a.dna.name}).join(", "));simulate.transitionPrimitives.push(this)}for(var d=0;d<this.downStreamTransitions.length;d++)scheduleTrigger.call(this.downStreamTransitions[d]);a&&(simulate.transitionPrimitives=[])}});State.method("getActive",function(){null===this.active&&this.setInitialActive(!0);return this.active});
function Transition(){Primitive.call(this);this.scheduledTrigger=this.omega=this.alpha=null;this.constructorFunction=Transition}Transition.inherits(Primitive);Transition.method("innerClone",function(a){});Transition.method("setEnds",function(a,b){this.alpha=a;this.omega=b;a&&a.downStreamTransitions.push(this)});Transition.method("canTrigger",function(){return!this.alpha||this.alpha&&this.alpha.getActive()||this.dna.repeat&&"Condition"!=this.dna.trigger});
Transition.method("trigger",function(){this.scheduledTrigger=null;this.frozen||(this.alpha&&this.alpha.setActive(!1),this.omega&&this.omega.setActive(!0),this.agentId&&this.container.updateStates(),this.dna.repeat&&"Condition"!=this.dna.trigger&&scheduleTrigger.call(this))});function scheduleTrigger(){updateTrigger.call(this,!0)}function clearTrigger(a){!this.scheduledTrigger||!a&&this.dna.repeat||(this.scheduledTrigger.kill(),this.scheduledTrigger=null)}
function updateTrigger(a){a&&clearTrigger.call(this);if(this.canTrigger()){try{var b=evaluateTree(this.equation,globalVars(this)).toNum()}catch(c){if(!c.substr)throw c;isLocal()&&console.log(c);"MSG:"==c.substr(0,4)?error(c.substr(4,c.length),this,!0):error(c,this,!0)}if("Condition"==this.dna.trigger)trueValue(b)&&this.trigger();else{b instanceof Material||error(getText("The value of this trigger must evaluate to a number."),this,!0);var d;if("Timeout"==this.dna.trigger){b.units||(b.units=simulate.timeUnits);
if(this.scheduledTrigger&&eq(b,this.scheduledTrigger.data.value))return;this.dna.repeat&&0==b.value&&error(getText("A trigger Timeout of 0 with 'Repeat' set to true results in an infinite loop."),this,!0);d=b}else if("Probability"==this.dna.trigger){b.units&&error(getText("The probability for the trigger had units of %s. Probabilities must be unitless.",this.value().units.toString()),this,!0);b=b.value;if(this.scheduledTrigger&&eq(b,this.scheduledTrigger.data.value))return;if(1==b)this.dna.repeat&&
error(getText("A trigger probability of 1 with 'Repeat' as true results in an infinite loop."),this,!0),d=new Material(0,simulate.timeUnits);else if(1<b)error(getText("The probability for the trigger must be less than or equal to 1."),this,!0);else if(0>b)error(getText("The probability for the trigger must be greater than or equal to 0."),this,!0);else if(0==b){if(!this.scheduledTrigger)return}else a=-Math.log(1-b),d=new Material(RandExp(a),simulate.timeUnits)}a=simulate.time();if(this.scheduledTrigger)if(this.scheduledTrigger.kill(),
"Timeout"==this.dna.trigger){if(lessThanEq(d,minus(simulate.time(),this.scheduledTrigger.data.start))){this.scheduledTrigger=null;this.trigger();return}a=this.scheduledTrigger.data.start;d=minus(d,minus(simulate.time(),a));this.scheduledTrigger=null}else if("Probability"==this.dna.trigger){if(0==b){this.scheduledTrigger=null;return}d=minus(this.scheduledTrigger.time,simulate.time());var e=-Math.log(1-this.scheduledTrigger.data.value);a=-Math.log(1-b);d=mult(d,new Material(e/a));a=this.scheduledTrigger.data.start;
this.scheduledTrigger=null}d=plus(d,simulate.time());var f=this;this.scheduledTrigger=new Task({name:"Trigger",time:d,priority:5,expires:1,action:function(){f.trigger()},data:{start:a,value:b}});simulate.tasks.add(this.scheduledTrigger)}}}function Action(){Primitive.call(this);this.scheduledTrigger=this.action=null;this.block=!1;this.constructorFunction=Action}Action.inherits(Primitive);Action.method("innerClone",function(a){});Action.method("canTrigger",function(){return!this.block});
Action.method("resetTimer",function(){scheduleTrigger.call(this)});Action.method("trigger",function(){this.scheduledTrigger=null;if(!this.frozen)try{evaluateTree(this.action,globalVars(this)),this.dna.repeat?"Condition"!==this.dna.trigger&&scheduleTrigger.call(this):this.block=!0}catch(a){if(!a.substr)throw a;isLocal()&&console.log(a);"MSG:"==a.substr(0,4)?error(a.substr(4,a.length),this,!0):error(a,this,!0)}});
function Agents(){Primitive.call(this);this.DNAs=this.geoWrap=this.geoDimUnitsObject=this.geoDimUnits=this.halfHeight=this.halfWidth=this.geoHeight=this.geoWidth=this.agents=this.size=null;this.stateIds=[];this.constructorFunction=Agents;this.vector=new Vector([],[],PrimitiveBase)}Agents.inherits(Primitive);
Agents.method("collectData",function(){for(var a=[],b=0;b<this.agents.length;b++){var c=this.agents[b];a.push({instanceId:c.instanceId,connected:c.connected.map(function(a){return a.instanceId}),location:simpleNum(c.location.clone(),this.geoDimUnitsObject),state:0<c.states.length?c.states.slice():null})}return a});Agents.method("states",function(){return this.stateIds.slice(0)});
Agents.method("toNum",function(){throw"MSG: "+getText("[%s] is a population of agents and cannot be used as a direct value in equations.",clean(this.dna.name));});
Agents.method("add",function(a){this.size=1+parseInt(this.size,10);if(a){var b=a.agentClone();b.agentId=this.agentId;b.setIndex(this.size-1);b.createAgentIds();for(var c=0;c<this.DNAs.length;c++){var d=b.children[c],e=this.DNAs[c];d.container=b;linkPrimitive(d,e)}b.updateStates()}else{b=new Agent;b.container=this;b.children=[];b.childrenId={};b.agentId=this.agentId;for(c=0;c<this.DNAs.length;c++)decodeDNA(this.DNAs[c],b);b.setIndex(this.size-1);b.createAgentIds();for(c=0;c<this.DNAs.length;c++)linkPrimitive(b.children[c],
this.DNAs[c]);setAgentInitialValues(b);d=getPrimitiveNeighborhood(this,this.dna);"Custom Function"==this.placement?(d.self=b,b.location=simpleUnitsTest(simpleEquation(this.placementFunction,{"-parent":varBank,self:b},d),this.geoDimUnitsObject),b.location.names||(b.location.names=["x","y"],b.location.namesLC=["x","y"])):b.location=new Vector([mult(this.geoWidth,new Material(Rand())),mult(this.geoHeight,new Material(Rand()))],["x","y"]);if("Custom Function"==this.network)for(e=trimTree(createTree(this.networkFunction),
d),c+=1;c<this.agents.length;c++)trueValue(simpleEquation(this.networkFunction,{"-parent":varBank,a:b,b:this.agents[c]},d,e))&&b.connect(this.agents[c])}var f=this;simulate.tasks.add(new Task({priority:10,expires:1,name:"Add Agent",time:simulate.time(),action:function(){f.agents.push(b);for(var c=0;c<b.children.length;c++){var d=b.children[c],e=f.DNAs[c];(d instanceof Action||d instanceof Transition)&&"Condition"!=e.trigger&&scheduleTrigger.call(d);a&&(d instanceof Action?e.solver.actions.push(d):
d instanceof Transition?e.solver.transitions.push(d):d instanceof Agents||(e.solver.valued.push(d),d instanceof Flow?e.solver.flows.push(d):d instanceof Stock?e.solver.stocks.push(d):d instanceof State&&e.solver.states.push(d)))}}}));return b});function Agent(){this.location=this.children=this.index=this.instanceId=this.agentId=null;this.connected=[];this.connectedWeights=[];this.dead=!1;this.constructorFunction=Agent;this.stateIDs=[];this.states=[];this.vector=new Vector([],[],AgentBase)}
Agent.prototype.createIds=Primitive.prototype.createIds;Agent.method("toString",function(){return"Agent "+(this.index+1)});Agent.method("toNum",function(){return this});Agent.method("updateStates",function(){this.states=[];this.stateIDs=[];for(var a=0;a<this.children.length;a++)this.children[a].active&&(this.states.push(this.children[a]),this.stateIDs.push(this.children[a].dna.id))});
Agent.method("agentClone",function(){var a=new Agent;a.dna=this.dna;a.children=[];a.childrenId={};for(var b=0;b<this.children.length;b++)a.children.push(this.children[b].clone()),a.childrenId[a.children[b].dna.id]=a.children[b];a.location=this.location.clone();a.connected=this.connected.slice(0);a.connectedWeights=this.connectedWeights.slice(0);a.container=this.container;return a});Agent.method("setIndex",function(a){this.index=a;for(var b=0;b<this.children.length;b++)this.children[b].index=a});
Agent.method("createAgentIds",function(){this.createIds();for(var a=0;a<this.children.length;a++)this.children[a].createIds()});
Agent.method("die",function(){for(;0<this.connected.length;)this.unconnect(this.connected[0]);for(var a=0;a<this.container.agents.length;a++)if(this.container.agents[a]==this){this.container.agents.splice(a,1);break}for(a=0;a<this.children.length;a++){var b=this.children[a],c=b.dna.solver;b instanceof Action?(c.actions.splice(c.actions.indexOf(b),1),clearTrigger.call(b,!0)):b instanceof Transition?(c.transitions.splice(c.transitions.indexOf(b),1),clearTrigger.call(b,!0)):b instanceof Agents||(c.valued.splice(c.valued.indexOf(b),
1),b instanceof Flow?c.flows.splice(c.flows.indexOf(b),1):b instanceof Stock?c.stocks.splice(c.stocks.indexOf(b),1):b instanceof State&&c.states.splice(c.states.indexOf(b),1))}this.dead=!0});
Agent.method("connect",function(a,b){var c=void 0===b?new Material(1):b;if(a!==this)if(-1==this.connected.indexOf(a))if(a instanceof Agent)this.connected.push(a),this.connectedWeights.push(c),a.connected.push(this),a.connectedWeights.push(c);else throw"MSG: Only agents may be connected.";else void 0!==b&&(this.connectedWeights[this.connected.indexOf(a)]=b,a.connectedWeights[a.connected.indexOf(a)]=b)});
Agent.method("unconnect",function(a){if(a!==this){var b=this.connected.indexOf(a);-1!=b&&(this.connected.splice(b,1),this.connectedWeights.splice(b,1),b=a.connected.indexOf(this),a.connected.splice(b,1),a.connectedWeights.splice(b,1))}});Agent.method("connectionWeight",function(a){if(a!==this&&(a=this.connected.indexOf(a),-1!=a))return this.connectedWeights[a].fullClone();throw"MSG: Agents are not connected and so do not have a connection weight.";});
Agent.method("setConnectionWeight",function(a,b){if(a!==this){var c=this.connected.indexOf(a);if(-1!=c){this.connectedWeights[c]=b.fullClone();return}}throw"MSG: Agents are not connected and so do not have a connection weight.";});function Stock(){Primitive.call(this);this.level=null;this.constructorFunction=Stock;this.delay=void 0;this.tasks=[];this.initRate=null;this.oldLevel}Stock.inherits(Primitive);
Stock.method("innerClone",function(a){a.level=this.level;a.oldLevel=this.oldLevel;a.tasks=this.tasks;a.delay=this.delay});Stock.method("setValue",function(a){this.level=a;this.cachedValue=void 0;simulate.valuedPrimitives=[];this.value()});Stock.method("print",function(){console.log(this.level.map(function(a){return a.value}))});Stock.method("preserveLevel",function(){for(var a=this.tasks.length-1;0<=a;a--)this.tasks[a].data.tentative=!1;this.oldLevel=this.level});
Stock.method("restoreLevel",function(){for(var a=this.tasks.length-1;0<=a;a--)this.tasks[a].data.tentative&&(this.tasks[a].remove(),this.tasks.splice(a,1));this.level=this.oldLevel});Stock.method("setDelay",function(a){this.delay=a=a||this.dna.delay});
Stock.method("setInitialValue",function(){var a=this,b;try{b=evaluateTree(this.equation,globalVars(this)).toNum()}catch(c){if(!c.substr)throw c;isLocal()&&console.log(c);"MSG:"==c.substr(0,4)?error(c.substr(4,c.length),this,!0):error(c,this,!0)}"boolean"==typeof b&&(b=b?new Material(1):new Material(0));if(b instanceof Vector){var d=this.dna;b.recurseApply(function(a){d.nonNegative&&0>a.value&&(a=new Material(0,d.units));a.units||(a.units=d.units);return a})}else this.dna.nonNegative&&0>b.value&&(b=
new Material(0,this.dna.units)),b.units||(b.units=this.dna.units);if(isUndefined(this.delay))this.level=b;else{var e=mult(b,div(simulate.userTimeStep,this.delay));this.initRate=div(b,this.delay.forceUnits(simulate.timeUnits));this.level=e;a=this;simulate.tasks.addEvent(function(b,c,d){0<b.value&&lessThanEq(minus(d,simulate.timeStart),minus(a.delay,simulate.userTimeStep))&&(b=functionBank.min([b,minus(a.delay,minus(c,simulate.timeStart))]),a.level=plus(a.level,mult(b,a.initRate)))})}});
Stock.method("subtract",function(a,b){this.level=minus(this.level,a);if(this.dna.nonNegative)if(this.level instanceof Vector){var c=this.dna;this.level.recurseApply(function(a){return 0>a.value?new Material(0,c.units):a})}else 0>this.level.value&&(this.level=new Material(0,this.dna.units))});
Stock.method("add",function(a,b){if(isUndefined(this.delay)){if(this.level=plus(this.level,a),this.dna.nonNegative)if(this.level instanceof Vector){var c=this.dna;this.level.recurseApply(function(a){return 0>a.value?new Material(0,c.units):a})}else 0>this.level.value&&(this.level=new Material(0,this.dna.units))}else this.scheduleAdd(a,b)});
Stock.method("scheduleAdd",function(a,b,c){var d=this;c=c||this.delay;var e;b=new Task({time:plus(b,c),data:{amnt:a,tentative:!0},priority:-100,name:"Conveyor Add ("+this.dna.name+")",action:function(){e=d.level;d.level=plus(d.level,a);if(d.dna.nonNegative)if(d.level instanceof Vector){var b=d.dna;d.level.recurseApply(function(a){return 0>a.value?new Material(0,b.units):a})}else 0>d.level.value&&(d.level=new Material(0,d.dna.units))},rollback:function(){d.level=e}});this.tasks.push(b);simulate.tasks.add(b)});
Stock.method("totalContents",function(){if(isDefined(this.delay)){for(var a=this.level,b=0;b<this.tasks.length;b++)greaterThan(this.tasks[b].time,simulate.time())&&lessThanEq(this.tasks[b].time,plus(simulate.time(),this.delay))&&(a=plus(a,this.tasks[b].data.amnt));b=minus(this.delay,simulate.userTimeStep);greaterThan(b,simulate.timeProgressed())&&(b=minus(b,simulate.timeProgressed()),a=plus(a,mult(this.initRate,b)));return a}return this.level});
Stock.method("calculateValue",function(){null===this.level&&this.setInitialValue();if(isDefined(this.delay)&&4==this.dna.solver.RKOrder){for(var a=this.level,b=0;b<this.tasks.length;b++)greaterThan(this.tasks[b].time,simulate.time())&&lessThanEq(this.tasks[b].time,plus(simulate.time(),this.dna.solver.timeStep))&&(a=plus(a,this.tasks[b].data.amnt));return a}return this.level});function Converter(){Primitive.call(this);this.source=null;this.constructorFunction=Converter}Converter.inherits(Primitive);
Converter.method("innerClone",function(a){});Converter.method("setSource",function(a){this.source=a});Converter.method("getInputValue",function(){var a;"*time"==this.source?a=simulate.time():((a=this.source.value().toNum())||error(getText("Undefined input value."),this,!1),a instanceof Vector&&error(getText("Converters do not accept vectors as input values."),this,!1));return a});Converter.method("calculateValue",function(){return new Material(this.getOutputValue().value,this.dna.units)});
Converter.method("getOutputValue",function(){var a=this.getInputValue();if(0==this.dna.inputs.length)return new Material(0);for(var b=0;b<this.dna.inputs.length;b++)if("discrete"==this.dna.interpolation){if(greaterThan(this.dna.inputs[b],a))return 0==b?this.dna.outputs[0]:this.dna.outputs[b-1]}else if("linear"==this.dna.interpolation){if(eq(this.dna.inputs[b],a))return this.dna.outputs[b];if(greaterThan(this.dna.inputs[b],a))return 0==b?this.dna.outputs[0]:div(plus(mult(minus(a,this.dna.inputs[b-
1]),this.dna.outputs[b]),mult(minus(this.dna.inputs[b],a),this.dna.outputs[b-1])),minus(this.dna.inputs[b],this.dna.inputs[b-1]))}return this.dna.outputs[this.dna.outputs.length-1]});function Variable(){Primitive.call(this);this.constructorFunction=Variable}Variable.inherits(Primitive);Variable.method("innerClone",function(a){});
Variable.method("calculateValue",function(){var a=evaluateTree(this.equation,globalVars(this));if("boolean"==typeof a)a=a?new Material(1):new Material(0);else if(a instanceof Vector)return a;a.units||(a.units=this.dna.units);return a});function Flow(){Primitive.call(this);this.rate=this.omega=this.alpha=null;this.RKPrimary=[];this.constructorFunction=Flow}Flow.inherits(Primitive);Flow.method("innerClone",function(a){});Flow.method("setEnds",function(a,b){this.alpha=a;this.omega=b});
Flow.method("calculateValue",function(){this.predict();return this.rate.fullClone()});Flow.method("clean",function(){this.rate=null;this.RKPrimary=[]});
Flow.method("predict",function(a){if(null===this.rate||a){try{var b=evaluateTree(this.equation,globalVars(this)).toNum();if(!(b instanceof Vector||isFinite(b.value)))throw"MSG: "+getText("The result of this calculation is not finite. Flows must have finite values. Are you dividing by 0?");}catch(c){if(!c.substr)throw c;isLocal()&&console.log(c);"MSG:"==c.substr(0,4)?error(c.substr(4,c.length),this,!0):error(c,this,!0)}"boolean"==typeof b&&(b=b?new Material(1):new Material(0));this.rate=b.fullClone();
if(this.rate instanceof Vector){var d=this.dna;this.rate.recurseApply(function(a){a.units||(a.units=d.units);return a})}else this.rate.units||(this.rate.units=this.dna.units);this.testUnits(this.rate,!0);this.rate=mult(this.rate,this.dna.solver.timeStep);a?0<this.RKPrimary.length?this.RKPrimary[this.RKPrimary.length-1]=this.rate:this.RKPrimary.push(this.rate):this.RKPrimary.push(this.rate);4==this.dna.solver.RKOrder&&(1==this.dna.solver.RKPosition?this.rate=this.RKPrimary[0]:2==this.dna.solver.RKPosition?
this.rate=this.RKPrimary[1]:3==this.dna.solver.RKPosition?this.rate=this.RKPrimary[2]:4==this.dna.solver.RKPosition&&(this.rate=div(plus(plus(plus(this.RKPrimary[0],mult(new Material(2),this.RKPrimary[1])),mult(new Material(2),this.RKPrimary[2])),this.RKPrimary[3]),new Material(6))));this.rate=div(this.rate,this.dna.solver.timeStep);this.dna.onlyPositive&&(this.rate instanceof Vector?this.rate.recurseApply(function(a){return 0<=a.value?a:new Material(0,a.units)}):0>=this.rate.value&&(this.rate=new Material(0,
this.rate.units)))}});
Flow.method("apply",function(a,b,c){try{if(null!==this.rate){var d=this.rate.fullClone();c=a=d=mult(d,a);var e=!1;if(null!==this.alpha){var f=this.alpha.level;d instanceof Vector&&(!(f instanceof Vector)||f.depth()<d.depth())?(a=d.fullClone().collapseDimensions(f),e=!0):f instanceof Vector&&(!(d instanceof Vector)||f.depth()>d.depth())&&error(getText("The alpha of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the alpha."),this,
!0)}null!==this.omega&&(f=this.omega.level,d instanceof Vector&&(!(f instanceof Vector)||f.depth()<d.depth())?(c=d.fullClone().collapseDimensions(f),e=!0):f instanceof Vector&&(!(d instanceof Vector)||f.depth()>d.depth())&&error(getText("The omega of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the omega."),this,!0));if(e)null!==this.alpha&&this.alpha.dna.nonNegative&&error(getText("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed."),
this.alpha,!1),null!==this.omega&&this.omega.dna.nonNegative&&error(getText("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed."),this.omega,!1);else{f=0;if(null!==this.omega&&this.omega.dna.nonNegative){var g=plus(this.omega.level.toNum(),d);g instanceof Vector?(g.recurseApply(function(a){return 0>a.value?a:new Material(0,a.units)}),d=minus(d,g)):0>g.value&&(d=negate(this.omega.level.toNum()));f++}null!==this.alpha&&this.alpha.dna.nonNegative&&(g=minus(this.alpha.level.toNum(),
d),g instanceof Vector?(g.recurseApply(function(a){return 0>a.value?a:new Material(0,a.units)}),d=minus(d,g),d=minus(d,g)):0>g.value&&(d=this.alpha.level.toNum()),f++);if(null!==this.omega&&this.omega.dna.nonNegative)if(d instanceof Vector)for(var k=functionBank.flatten([plus(this.omega.level.toNum(),d)]),g=0;g<k.items.length;g++)0>k.items[g].value&&error(getText("Inconsistent non-negative constraints for flow."),this,!1);else 0>plus(this.omega.level.toNum(),d).value&&error(getText("Inconsistent non-negative constraints for flow."),
this,!1)}k=0;try{null!==this.omega&&(k=1,e?this.omega.add(c,b):this.omega.add(d,b)),null!==this.alpha&&(k=2,e?this.alpha.subtract(a,b):this.alpha.subtract(d,b))}catch(l){b="",1==k?b=this.omega:2==k&&(b=this.alpha),"MSG: Keys do not match for vector operation."==l?error(getText("Incompatible vector keys for flow %s and connected stock %s.","<i>["+clean(this.dna.name)+"]</i>","<i>["+clean(b.dna.name)+"]</i>"),this,!1):error(getText("Incompatible units for flow %s and connected stock %s. Stock has units of %s. The flow should have the equivalent units divided by some time unit such as Years.",
"<i>["+clean(this.dna.name)+"]</i>","<i>["+clean(b.dna.name)+"]</i>","<i>"+(b.dna.units?clean(b.dna.units.toString()):"unitless")+"</i>"),this,!1)}}}catch(m){if(!m.substr)throw m;"MSG:"==m.substr(0,4)?error(m.substr(4,m.length),this,!0):error(m,this,!0)}});function globalVars(a){return a instanceof Agent?{"-parent":varBank,self:a}:a.container?{"-parent":varBank,self:a.container}:varBank};function TaskQueue(a){a=a||{};this.tasks=new RedBlackTree;this.onMoveEvents=[];this.setTime(a.start);this.debug=!1;this.end=a.end;this.states={}}
TaskQueue.prototype.print=function(){console.log("Current Time: "+this.time.value);for(this.tasks.goMin();null!==this.tasks.current();)console.log(this.tasks.current().name),console.log("    Time: "+this.tasks.current().time.value),console.log("    Priority: "+this.tasks.current().priority),isDefined(this.tasks.current().expires)&&console.log("    Expires: "+this.tasks.current().expires),isDefined(this.tasks.current().skip)&&console.log("    Skip: "+this.tasks.current().skip),this.tasks.next()};
TaskQueue.prototype.addEvent=function(a){this.onMoveEvents.push(a)};TaskQueue.prototype.fireEvents=function(a,b,c){this.debug&&console.log("Firing Events");for(var d=0;d<this.onMoveEvents.length;d++)this.onMoveEvents[d](a,b,c)};TaskQueue.prototype.setTime=function(a){if(isUndefined(this.time)||neq(a,this.time)){var b=this.time;this.time=a;isDefined(b)&&this.fireEvents(minus(a,b),b,a)}};
TaskQueue.prototype.moveTime=function(a){this.debug&&console.log("Shifting time by: "+a.value);this.moveTo(timePlus(this.time,a))};
TaskQueue.prototype.moveTo=function(a){if(!eq(this.time,a)){this.debug&&console.log("Shifting time to: "+a.value);if(null!==this.tasks.current()){for(var b=this.tasks.max().time,c=this.tasks.min().time;lessThan(this.time,a)&&!greaterThan(this.time,b);)this.step();for(;greaterThan(this.time,a)&&greaterThan(this.time,c);)this.stepBack()}this.setTime(a);this.debug&&console.log("Time shift to  "+a.value+" completed.")}};TaskQueue.prototype.add=function(a){a.queue=this;this.tasks.add(a)};
TaskQueue.prototype.step=function(){isUndefined(this.time)&&(this.tasks.goMin(),this.setTime(this.tasks.current().time));this.tasks.current();if(null!==this.tasks.current()){var a=this.tasks.current().deadAction;this.tasks.current().execute();if(!a&&this.tasks.current().timeShift){this.tasks.current().timeShift();return}this.tasks.next()}null!==this.tasks.current()?this.setTime(this.tasks.current().time):(this.tasks.next(),this.setTime(mult(this.tasks.max().time,new Material(10))))};
TaskQueue.prototype.stepBack=function(){if(isUndefined(this.time))this.tasks.goMin();else{null===this.tasks.current()?this.tasks.goMax():this.tasks.previous();for(var a=this.tasks.current().time;null!==this.tasks.current()&&eq(a,this.tasks.current().time);)this.tasks.current().rollback(),this.tasks.previous();null===this.tasks.current()?this.tasks.goMin():this.tasks.next()}this.setTime(this.tasks.current().time)};
TaskQueue.prototype.atStart=function(){return isUndefined(this.time)||this.tasks.current()===this.tasks.min()};TaskQueue.prototype.completed=function(){return isDefined(this.time)&&(greaterThan(this.time,this.end)||null===this.tasks.current())};TaskQueue.prototype.remove=function(a){a==this.tasks.current()&&this.tasks.next();this.tasks.remove(a)};var TaskId=0;
function Task(a){this.id=TaskId++;this.name=a.name;this.time=a.time;this.action=a.action;this.reverse=a.rollback;this.priority=a.priority||0;this.expires=a.expires;this.skip=a.skip;this.timeShift=a.timeShift;this.data=a.data;this.blocker=a.blocker;this.deadReverse=this.deadAction=!1;this.action&&(this.action.task=this);this.reverse&&(this.action.reverse=this)}
Task.prototype.execute=function(){!this.action||this.deadAction||this.blocker&&this.queue.states[this.blocker]||(isDefined(this.skip)&&0<this.skip?(this.skip--,this.queue.debug&&console.log("Skipping: "+this.name)):(this.queue.debug&&console.log("%c Executing: "+this.name+" (Time: "+this.time.value+")","color:blue"),isDefined(this.expires)&&(this.expires--,this.queue.debug&&console.log("    Current count before expire: "+this.expires),0>=this.expires&&(this.queue.debug&&console.log("    Task expired."),
this.deadAction=!0))),this.action())};Task.prototype.rollback=function(){!this.reverse||this.deadReverse||this.blocker&&this.queue.states[this.blocker]||(this.queue.debug&&console.log("Rolling back: "+this.name+" (Time: "+this.time.value+")"),isDefined(this.expires)&&0>=this.expires&&(this.queue.debug&&console.log("    Rollback expired."),this.deadReverse=!0),this.reverse())};Task.prototype.reschedule=function(a){this.queue.remove(this);this.time=a;this.queue.add(this)};Task.prototype.remove=function(){this.queue.remove(this)};
Task.prototype.kill=function(){this.deadReverse=this.deadAction=!0};Task.prototype.block=function(a){a=a||this.blocker;this.queue.states[a]=!0};Task.prototype.unblock=function(a){a=a||this.blocker;this.queue.states[a]=!1};Task.prototype.compare=function(a){return eq(a.time,this.time)?a.priority==this.priority?a.id==this.id?0:a.id<this.id?1:-1:a.priority<this.priority?1:-1:lessThan(a.time,this.time)?1:-1;throw"Comparison error";};Task.prototype.toString=function(){return this.name+" - "+this.id};
function scheduleRepeated(a,b,c,d,e){e=div(minus(e,c),d);for(var f=0;f<=e;f++)b.time=plus(c,mult(d,new Material(f))),a.add(new Task(b))};function Simulator(a){this.lastRandPos=this.randLoc=-1;this.previousRandLists=[];this.valuedPrimitives=[];this.unitsToBases={};this.distanceCache={};this.sliders={};this.ids={};this.idCount=0;this.stochastic=!1}
Simulator.prototype.setup=function(a){this.model=a.model;this.solversCompletedFirstPass=0;this.timeStart=this.model.timeStart;this.timeLength=this.model.timeLength;this.timePause=this.model.timePause;this.timeEnd=plus(this.timeStart,this.timeLength);this.timeStep=this.model.solvers.base.timeStep;this.userTimeStep=this.model.solvers.base.userTimeStep;this.timeUnits=this.timeStart.units;this.timeUnits.addBase();this.oldAggregateSeries=[];this.distanceCache={};this.tasks=new TaskQueue({start:this.timeStart,
end:this.timeEnd})};Simulator.prototype.getID=function(a){this.ids[a]||(this.idCount++,this.ids[a]=this.idCount);return this.ids[a]};Simulator.prototype.time=function(){return this.tasks.time};Simulator.prototype.timeProgressed=function(){return minus(this.time(),this.timeStart)};Simulator.prototype.frame=function(a,b){for(var c=a.length,d=0;d<c;d++)a[d].storeValue();this.printStates(b)};
Simulator.prototype.step=function(a){if(!a.completedFirstPass&&(a.completedFirstPass=!0,this.solversCompletedFirstPass++,this.solversCompletedFirstPass==Object.keys(this.model.solvers).length&&this.config.onCompletedFirstPass))this.config.onCompletedFirstPass();if(0<a.displayed.length)for(var b=this.results[a.displayed[0].id].results.length;b<this.results.Time.length;b++)for(var c=0;c<a.displayed.length;c++)this.results[a.displayed[c].id].results.push(this.results.data[b][a.displayed[c].id]);if(this.config.onStep)this.config.onStep(a)};
Simulator.prototype.sleep=function(a){this.config&&(this.config.silent?this.config.onPause&&(this.shouldSleep=!0):(this.shouldSleep=window.storyConverter?!1:!0,this.shouldUpdateScripter=a))};Simulator.prototype.resume=function(){try{this.run()}catch(a){return checkErr(a,this.config)}};Simulator.prototype.completed=function(){return this.terminated||this.tasks.completed()};
Simulator.prototype.terminate=function(){this.terminated||(clearTimeout(this.timer),this.sleep(),this.terminated=!0,this.resultsWindow&&this.resultsWindow.scripter.finished())};
Simulator.prototype.run=function(a){var b=this,c=function(a,d){b.tasks.add(new Task({time:a,expires:1,name:"Interval Pause",priority:1,action:function(){b.sleep(!0);d&&lessThan(plus(a,b.timePause),b.timeEnd)&&c(plus(a,b.timePause),d)}}));b.tasks.add(new Task({time:a,expires:1,name:"Interval Pause",priority:1,action:function(){if(b.valueChange){simulate.valuedPrimitives=[];for(var a in b.model.solvers){for(var c=b.model.solvers[a],d=0;d<c.valued.length;d++)c.valued[d].clearCached();for(d=0;d<c.flows.length;d++)c.flows[d].predict(!0)}b.valueChange=
!1}}}))};if(a){this.config=a;a=Object.keys(this.model.solvers);for(var d=0;d<a.length;d++)this.createSolver(this.model.solvers[a[d]]);this.timePause&&!window.storyConverter&&c(plus(this.timeStart,this.timePause),!0);this.tasks.tasks.goMin()}this.wakeUpTime=(new Date).getTime();try{for(;!this.completed();)if(this.tasks.step(),this.shouldSleep){for(var e in this.model.solvers)updateDisplayed(this.model.solvers[e]);this.shouldUpdateScripter&&(this.resultsWindow.scripter.endMode="pause",this.shouldUpdateScripter=
!1);this.config.onPause&&setTimeout(function(){var a=formatSimResults(this.results),c=a.data.length,d=a.data[c-1],e;for(e in d)a[e].results.length<c&&a[e].results.push(d[e]);a.resume=b.resume.bind(this);a.setValue=function(a,b){var c=simpleEquation(""+b,{"-parent":varBank});this.valuedPrimitives.forEach(function(b){b.id==a.id&&(c.fullClone?(b.dna.equation=c.fullClone(),b.equation=c.fullClone()):(b.dna.equation=c,b.equation=c))});this.valueChange=!0}.bind(this);b.config.onPause(a)}.bind(this),10);
this.shouldSleep=!1;return}}catch(f){if("STOP"!=f.msg)throw f;}this.results=formatSimResults(this.results);this.results.stochastic=this.stochastic;if(this.config.onSuccess)this.config.onSuccess(this.results);this.terminate();if(this.resultsWindow)for(e in this.results.window=this.resultsWindow,this.model.solvers)updateDisplayed(this.model.solvers[e]);return this.results};Simulator.prototype.progress=function(){return div(minus(this.time(),this.timeStart),this.timeLength).value};
Simulator.prototype.printStates=function(a){var b=parseFloat(this.time().value.toPrecision(20));if(-1==this.results.Time.indexOf(b)){for(var c=this.results.Time.length;0<c;c--)if(this.results.Time[c-1]<b){this.results.Time.splice(c,0,b);this.results.data.splice(c,0,{});break}0==c&&(this.results.Time.splice(0,0,b),this.results.data.splice(0,0,{}))}b=this.results.data[this.results.Time.indexOf(b)];for(c=0;c<a.length;c++){var d=a[c];if(!(d instanceof State&&isDefined(b[d.id])))if(d instanceof Agents)this.results[d.id].dataMode=
"agents",b[d.id]={current:d.collectData()};else{var e=d.value();if(e instanceof Vector&&!e.names)b[d.id]=e,this.results[d.id].dataMode="auto";else if(e instanceof Vector){var f=this;e.recurseApply(function(a){return f.adjustNum(d,a)});b[d.id]=e}else e instanceof Agent?(b[d.id]=e,this.results[d.id].dataMode="auto"):b[d.id]=this.adjustNum(d,e)}}};
Simulator.prototype.unitsToBase=function(a,b,c){var d=a.id+"-"+(b?b.id:"");if(d in this.unitsToBases)return this.unitsToBases[d];var e=1;c&&(e=this.timeUnits.toBase);c=1;b&&(b.addBase(),c=b.toBase);this.unitsToBases[d]=fn["/"](fn["/"](sn("#e"+c),a.dna.toBase),sn("#e"+e));return this.unitsToBases[d]};
Simulator.prototype.adjustNum=function(a,b){a.unitless&&b.units&&error(getText("The result of the calculation has units %s, but the primitive is unitless. Please set the units for the primitive so we can determine the proper output.",b.units.toString()),findID(a.id),!0);a instanceof Flow&&!a.dna.flowUnitless&&(b=mult(b,new Material(1,this.timeUnits)));b=a instanceof State||!b.units&&!a instanceof Flow?b.value:fn["*"](b.value,this.unitsToBase(a,b.units,a instanceof Flow));return b+0};
Simulator.prototype.createSolver=function(a){function b(c,d,e){k.tasks.add(new Task({time:c,expires:1,name:"RK1 Solver - "+a.id,action:function(){simulate.valuedPrimitives=[];if(e){for(var c=m.length,f=0;f<c;f++)m[f].clean();c=q.length;for(f=0;f<c;f++)q[f].clearCached()}k.frame(q,u);c=n.length;for(f=0;f<c;f++)n[f].dna.recalculate&&!n[f].block&&updateTrigger.call(n[f]);c=p.length;for(f=0;f<c;f++)p[f].dna.recalculate&&updateTrigger.call(p[f]);k.step(a);d&&D<=G&&(D++,b(E[D],!0,!0))}}))}function c(b,
d){k.tasks.add(new Task({time:b,name:"RK4 Solver (Init)  - "+a.id,priority:-10,expires:1,blocker:v+" init",action:function(){for(var b=m.length,c=0;c<b;c++)m[c].clean();simulate.valuedPrimitives=[];b=q.length;for(c=0;c<b;c++)q[c].clearCached();a.RKPosition=1;this.unblock(v+" start");this.block()}}));k.tasks.add(new Task({time:b,name:"RK4 Solver (step 1) - "+a.id,priority:-5,expires:4,blocker:v+" start",action:function(){if(1<a.RKPosition){simulate.valuedPrimitives=[];for(var b=q.length,e=0;e<b;e++)q[e].clearCached(),
q[e].pastValues.pop()}k.frame(q,u);if(4==a.RKPosition){b=n.length;for(e=0;e<b;e++)n[e].dna.recalculate&&!n[e].block&&updateTrigger.call(n[e]);b=p.length;for(e=0;e<b;e++)p[e].dna.recalculate&&updateTrigger.call(p[e]);this.unblock(v+" init");d&&D<=G&&(D+=2,c(E[D],!0));k.step(a)}else if(eq(simulate.time(),simulate.timeEnd))k.step(a);else for(b=l.length,e=0;e<b;e++)l[e].preserveLevel();this.block();this.unblock(v+" mid")},rollback:function(){for(var a=l.length,b=0;b<a;b++)l[b].restoreLevel()}}));k.tasks.add(new Task({time:E[D+
1],name:"RK4 Solver (step 2,3) - "+a.id,priority:-10,expires:2,blocker:v+" mid",action:function(){simulate.valuedPrimitives=[];for(var b=q.length,c=0;c<b;c++)q[c]instanceof State||q[c].clearCached();a.RKPosition++;b=m.length;for(c=0;c<b;c++)m[c].rate=null,m[c].predict();this.unblock(v+" start");this.block()},timeShift:function(){k.tasks.moveTo(E[D])}}));k.tasks.add(new Task({time:E[D+2],name:"RK4 Solver (step 4) - "+a.id,priority:-30,expires:1,action:function(){simulate.valuedPrimitives=[];for(var b=
q.length,c=0;c<b;c++)q[c]instanceof State||q[c].clearCached();a.RKPosition++;b=m.length;for(c=0;c<b;c++)m[c].rate=null,m[c].predict();this.unblock(v+" start")},timeShift:function(){k.tasks.moveTo(E[D])}}))}function d(a,b){if(a instanceof Vector){var c=!1;a.recurseApply(function(a){c=c||b(a)});return c}return b(a)}function e(a){return a&&d(a.toNum(),function(a){return a instanceof Material&&0>a.value})}function f(a){return a&&d(a.toNum(),function(a){return a instanceof Material&&0<a.value})}function g(a,
b,c){for(var d=m.length,g=[],k=0;k<d;k++)m[k].alpha&&m[k].alpha.dna.nonNegative&&f(m[k].rate)?g.push(m[k]):m[k].omega&&m[k].omega.dna.nonNegative&&e(m[k].rate)?g.push(m[k]):m[k].apply(a,b,c);for(k=0;k<g.length;k++)g[k].apply(a,b,c)}var k=this,l=a.stocks,m=a.flows,n=a.actions,p=a.transitions,q=a.valued,u=a.displayed,v=a.id,y=a.timeStep,z=a.RKOrder;a.RKPosition=1;for(var x=y.value,x=x.toPrecision(),B=-1==x.indexOf(".")?0:x.length-x.indexOf(".")-1,A=parseFloat(x.replace(".","")),D=0,E=[],G=Math.ceil((k.timeEnd.value-
k.timeStart.value)/y.value),x=0;x<=G+2;x++)E.push(new Material(k.timeStart.value+x*A/Math.pow(10,B),y.units));y=n.length;for(x=0;x<y;x++)"Condition"!==n[x].dna.trigger&&updateTrigger.call(n[x]);y=p.length;for(x=0;x<y;x++)updateTrigger.call(p[x]);if(1==z)this.tasks.addEvent(function(a,b,c){g.apply(null,arguments)}),b(this.timeStart,!0);else if(4==z)this.tasks.addEvent(function(a,b,c){0<a.value&&g.apply(null,arguments)}),c(this.timeStart,!0);else throw"Unknown solution algorithm.";};var simulate,model,strictUnits=null,strictAgentResolution=!1,strictLinks=!1;function runSimulation(a){try{return innerRunSimulation(a)}catch(b){return checkErr(b,a)}}
function checkErr(a,b,c){simulate&&simulate.terminate();isLocal()&&console.log(a);a.msg?c={error:a.msg,errorPrimitive:isDefined(a.primitive)?findID(a.primitive.id):null}:(c={error:getText("An unknown simulation error occurred. Please report this issue to the Insight Maker team."),errorPrimitive:null},"string"==typeof a?("MSG:"===a.substr(0,4)&&(c.error=a.substr(4)),a={msg:c.error}):a.msg=c.msg);simulate.results||(simulate.results={});simulate.results.error=a.msg;if(b.onError)b.onError(c);if(b.silent)return c;
handleErrorObject(a)}var timeUnits=null;
function innerRunSimulation(a){evaluatingLine=null;simulate=new Simulator;a.resultsWindow&&(simulate.resultsWindow=a.resultsWindow);bootCalc();allPlaceholders=[];model={submodels:{base:{id:"base",DNAs:[],agents:[{children:[],childrenId:{}}],size:1}}};var b=getSetting();strictUnits=isTrue(b.getAttribute("StrictUnits"));strictAgentResolution=isTrue(b.getAttribute("StrictAgentResolution"));strictLinks=isTrue(getSetting().getAttribute("StrictLinks"));var c=b.getAttribute("Units");if(isDefined(c)){for(var d=
b.getAttribute("Units").split("\n"),e=[],f=[],g=[],c=0;c<d.length;c++){var k=d[c].split("<>");if(k[2]&&""!=k[2].trim()){e.push(k[0]);f.push(k[1]);k=createUnitStore(k[2]);if(isUndefined(k))throw{msg:'You cannot define a units synonym for "unitless".'};g.push(k.toStringShort())}}loadUnits(e,g,f)}timeUnits=b.getAttribute("TimeUnits").toLowerCase();e=getUnitStore([timeUnits],[1]);model.timeLength=new Material(sn("#i"+b.getAttribute("TimeLength")),e);model.timeStart=new Material(sn("#i"+b.getAttribute("TimeStart")),
e);model.timeStep=new Material(sn("#i"+b.getAttribute("TimeStep")),e);0<b.getAttribute("TimePause")&&(model.timePause=new Material(sn("#i"+b.getAttribute("TimePause")),e));simulate.timeUnits=e;d={};d.base={timeStep:new Material(sn("#i"+b.getAttribute("TimeStep")),e),algorithm:b.getAttribute("SolutionAlgorithm"),id:"base",maxLoaded:-1};model.solvers=d;f=findType("Folder");for(c=0;c<f.length;c++)if(g=f[c].getAttribute("Solver"))g=JSON.parse(g),g.enabled&&(d[f[c].id]=g,d[f[c].id].timeStep=new Material(sn("#i"+
d[f[c].id].timeStep),e),d[f[c].id].id=f[c].id,d[f[c].id].maxLoaded=-1);e=Object.keys(d);for(c=0;c<e.length;c++)g=d[e[c]],g.userTimeStep=g.timeStep,g.RKOrder="RK4"==g.algorithm?4:1,g.timeStep=4==g.RKOrder?div(g.userTimeStep,new Material(2)):g.userTimeStep,g.stocks=[],g.flows=[],g.transitions=[],g.actions=[],g.states=[],g.valued=[],g.displayed=[];if(isDefined(b.getAttribute("Macros")))try{evaluateMacros(b.getAttribute("Macros"))}catch(l){var m=[],c=getText("An error with the macros prevented the simulation from running.");
l.msg?c=c+"<br/><br/>"+l.msg:l.toString&&"MSG:"==l.toString().substr(0,4)?c=c+"<br/><br/>"+l.toString().substr(4):l.toString&&l.match&&l.match(/line (\d+)/i)&&(b=l.match(/line (\d+)/i)[1],m.push({type:"error",row:void 0!==b?b-1:evaluatingLine-1,text:l}));showMacros(m);throw{msg:c};}b=primitives();for(c=0;c<b.length;c++)if("Agents"==b[c].value.nodeName){e=b[c];g=e.getAttribute("Agent");f=parseInt(g,10);f==g&&(g=f);if(isUndefined(g))throw{msg:getText("You must select a base agent for the primitive %s. You can create agent definitions using Folder primitives.",
"<i>"+clean(e.getAttribute("name"))+"</i>"),primitive:e,showEditor:!1};f=new Agents;f.dna=new DNA(e,g);f.id=e.id;f.agentId=g;f.createIds();f.dna.solver=folderSolvers(e,d);f.dna.solver.displayed.push(f);f.geoDimUnits=e.getAttribute("GeoDimUnits");f.geoDimUnitsObject=createUnitStore(e.getAttribute("GeoDimUnits"));f.geoWidth=simpleUnitsTest(simpleEquation(e.getAttribute("GeoWidth")),f.geoDimUnitsObject,e);f.geoHeight=simpleUnitsTest(simpleEquation(e.getAttribute("GeoHeight")),f.geoDimUnitsObject,e);
f.halfWidth=div(f.geoWidth,new Material(2));f.halfHeight=div(f.geoHeight,new Material(2));f.geoWrap=isTrue(e.getAttribute("GeoWrap"));f.placement=e.getAttribute("Placement");f.placementFunction=e.getAttribute("PlacementFunction");f.network=e.getAttribute("Network");f.networkFunction=e.getAttribute("NetworkFunction");f.agentBase=findID(g).getAttribute("AgentBase")||"";""!=f.agentBase.trim()&&(f.agentBase=simpleEquation(f.agentBase,varBank));k=getChildren(findID(g));f.DNAs=[];for(g=0;g<k.length;g++)modelType(k[g].value.nodeName)&&
f.DNAs.push(getDNA(k[g],d)),"State"==k[g].value.nodeName&&f.stateIds.push(k[g].id);f.size=e.getAttribute("Size");f.agents=[];f.dna.agents=f;model.submodels[e.id]=f;model.submodels.base.DNAs.push(f.dna)}else inAgent(b[c])||modelType(b[c].value.nodeName)&&model.submodels.base.DNAs.push(getDNA(b[c],d));for(m in model.submodels)for(m=model.submodels[m],g=0;g<m.size;g++)for("base"==m.id?b=m.agents[0]:(b=new Agent,b.container=m,b.index=g,b.children=[],b.childrenId={},b.agentId=m.id,b.createIds(),m.agentBase&&
(b.vector.parent=m.agentBase),m.agents.push(b)),c=0;c<m.DNAs.length;c++)decodeDNA(m.DNAs[c],b);simulate.setup({model:model});for(m in model.submodels)for(m=model.submodels[m],g=0;g<m.size;g++)for(c=0;c<m.DNAs.length;c++)linkPrimitive(m.agents[g].children[c],m.DNAs[c]);for(m in model.submodels)for(m=model.submodels[m],g=0;g<m.size;g++)setAgentInitialValues(m.agents[g]);for(m in model.submodels)if("base"!=m){try{buildNetwork(model.submodels[m])}catch(n){throw isLocal()&&console.log(n),c=getText("An error with the custom network function prevented the simulation from running."),
n.msg?c=c+"<br/><br/>"+n.msg:"MSG:"==n.toString().substr(0,4)&&(c=c+"<br/><br/>"+n.toString().substr(4)),{msg:c,primitive:model.submodels[m].cell,showEditor:!1};}try{buildPlacements(model.submodels[m])}catch(p){throw isLocal()&&console.log(p),c=getText("An error with the agent placement function prevented the simulation from running."),p.msg?c=c+"<br/><br/>"+p.msg:"MSG:"==p.toString().substr(0,4)&&(c=c+"<br/><br/>"+p.toString().substr(4)),{msg:c,primitive:model.submodels[m].cell,showEditor:!1};}}simulate.results=
{Time:[],data:[]};simulate.displayInformation={ids:[],times:[],objects:[]};model.submodels.base.agents[0].children.forEach(function(a){if(!(a instanceof Action||a instanceof Transition)){simulate.displayInformation.objects.push(a);simulate.displayInformation.ids.push(a.id);var b={};a instanceof Agents?(b.width=a.geoWidth,b.height=a.geoHeight,b.units=a.geoDimUnitsObject,b.states=a.states()):a.dna.solver.displayed.push(a);simulate.results[a.id]={data:b,results:[],dataMode:"float"}}});if(a.silent)if(a.onPause)simulate.run(a);
else return formatSimResults(simulate.run(a));else{m=div(model.timeLength,model.timeStep);for(c=0;c<=m;c++)simulate.displayInformation.times.push(plus(model.timeStart,mult(model.timeStep,new Material(c))).value);var q=a.onSuccess;a.onSuccess=function(a){updateDisplayed(null);simulate.resultsWindow.results=formatSimResults(simulate.results);q?q(a):null};a.onCompletedFirstPass=function(){if(a.resultsWindow){a.resultsWindow.displayInformation.store.suspendEvents();a.resultsWindow.displayInformation.store.maxLoaded=
-1;a.resultsWindow.displayInformation.store.clearFilter();a.resultsWindow.displayInformation.store.removeAll();simulate.displayInformation=a.resultsWindow.displayInformation;var b=a.resultsWindow.displayInformation.scripter;b.simulator=simulate;b.playBut.setGlyph(61516);b.combo.setValue(-1);b.time=0;b.timeIndex=0;b.isFinished=!1;b.updatingSlider=!0;b.slider.setValue(b.minTime);b.updatingSlider=!1;b.advanceTimer();a.resultsWindow.displayInformation.store.resumeEvents();clearInterval(b.animInter);b.animInter=
setInterval(function(){b.advanceTimer()},200);for(var c=0;c<simulate.displayInformation.origIds.length;c++){var d=simulate.displayInformation.origIds[c],e=simulate.displayInformation.objects[c],f=e.dna;if("Agents"==f.type)simulate.results[d].states=e.stateIds,simulate.displayInformation.agents[d.toString()].data=simulate.results[d].data,simulate.displayInformation.agents[d.toString()].results=simulate.results[d].results;else if(simulate.results.data[0][d]instanceof Vector&&simulate.results.data[0][d].names){var g=
simulate.results.data[0][d].fullNames();simulate.results[d].indexedFullNames=g.slice();for(e=0;e<g.length;e++)g[e]=g[e].join(", ");simulate.results[d].indexedNames=g}}}else{simulate.displayInformation.colors=[];simulate.displayInformation.headers=[];simulate.displayInformation.agents=[];simulate.displayInformation.displayedHeaders=[];simulate.displayInformation.displayedIds=[];simulate.displayInformation.renderers=[];simulate.displayInformation.elementIds=[];simulate.displayInformation.res=simulate.results;
var k=[];simulate.displayInformation.origIds=simulate.displayInformation.ids.slice();for(c=0;c<simulate.displayInformation.origIds.length;c++)if(d=simulate.displayInformation.origIds[c],e=simulate.displayInformation.objects[c],f=e.dna,simulate.displayInformation.displayedIds.push(d),simulate.displayInformation.displayedHeaders.push(f.name),"Agents"==f.type){g=e.stateIds;simulate.results[d].states=g;for(e=0;e<g.length;e++){var l=findID(g[e]);k.push(d);simulate.displayInformation.elementIds.push("e"+
d+"-"+g[e]);simulate.displayInformation.headers.push(getName(l));simulate.displayInformation.colors.push(getLineColor(l));"float"==simulate.results[d].dataMode?simulate.displayInformation.renderers.push(commaStr):"agents"==simulate.results[d].dataMode?simulate.displayInformation.renderers.push(function(a){return a}):simulate.displayInformation.renderers.push(void 0)}simulate.displayInformation.agents[d.toString()]={id:d,item:f.cell,data:simulate.results[d].data,results:simulate.results[d].results}}else if(simulate.results.data[0][d]instanceof
Vector&&simulate.results.data[0][d].names){l=getLineColor(f.cell);g=simulate.results.data[0][d].fullNames();simulate.results[d].indexedFullNames=g.slice();for(e=0;e<g.length;e++)g[e]=g[e].join(", ");simulate.results[d].indexedNames=g;for(e=0;e<g.length;e++)k.push(d),simulate.displayInformation.elementIds.push("e"+d+"-"+e),simulate.displayInformation.headers.push(f.name+" ("+g[e]+")"),simulate.displayInformation.colors.push(l),simulate.displayInformation.renderers.push(commaStr)}else k.push(d),simulate.displayInformation.elementIds.push("e"+
d),simulate.displayInformation.headers.push(f.name),simulate.displayInformation.colors.push(getLineColor(f.cell)),"float"==simulate.results[d].dataMode?simulate.displayInformation.renderers.push(commaStr):simulate.displayInformation.renderers.push(void 0);d=[{type:"float",name:"Time"},{type:"int",name:"id"}];for(c=0;c<simulate.displayInformation.elementIds.length;c++)d.push({type:"auto",name:simulate.displayInformation.elementIds[c],defaultValue:void 0});simulate.displayInformation.store=new Ext.data.Store({fields:d,
data:void 0});simulate.displayInformation.store.maxLoaded=-1;simulate.displayInformation.ids=k}};var u=a.onStep;a.onStep=function(a){var b=!1,c=simulate.progress();if(!simulate.shouldSleep){var d=(new Date).getTime()-simulate.wakeUpTime;if(!simulate.resultsWindow&&100<d||600<d)updateDisplayed(a),b=!0,simulate.timer=setTimeout(function(){simulate.resume()},20),simulate.sleep()}1!=c||b||updateDisplayed(a);u?u(a):null};var v=a.onError;a.onError=function(a){try{for(var b in simulate.model.solvers)updateDisplayed(simulate.model.solvers[b])}catch(c){}simulate.resultsWindow&&
(simulate.resultsWindow.scripter.pause(!1),simulate.resultsWindow.scripter.finished());v?v(a):null};simulate.run(a)}}
function formatSimResults(a){var b=function(a){return function(b){if(b instanceof Vector){if(b.names){for(var d={},k=0;k<b.names.length;k++)d[b.names[k]]=c(b.items[k]);return d}return b.items.slice().map(c)}if(a)return b}},c=b(!0);a=deepClone({},a,3,b(!1));isUndefined(a.error)&&(a.error="none",a.errorPrimitive=null);a.names={};for(var b=model.submodels.base.agents[0].children,d=0;d<b.length;d++)a.names[b[d].name]=b[d].id;a.value=function(a){return this[a.id].results};a.lastValue=function(a){return this[a.id].results[this[a.id].results.length-
1]};a.Time&&(a.periods=a.Time.length,a.times=a.Time);return a}function createUnitStore(a){return a&&""!=a.trim()&&"unitless"!=a.trim().toLowerCase()?simpleEquation("{1 "+a+"}").units:void 0}function simpleEquation(a,b,c,d){b||(b={});c||(c={});d||(d=trimTree(createTree(a),c));return evaluateTree(d,b)}
function simpleNum(a,b){if(a instanceof Vector)return new Vector(a.items.map(function(a){return simpleNum(a,b)}));if(!b&&a.units)throw getText("The result of the calculation has units %s, but no units are specified for the calculation. Please set the units for the calculation so we can determine the proper output.",a.units.toString());return a.units?(a.units.addBase(),b.addBase(),0+fn["*"](a.value,fn["/"](sn("#e"+a.units.toBase),b.toBase))):0+a.value}
function simpleUnitsTest(a,b,c,d){if(a instanceof Vector)return new Vector(a.items.map(function(a){return simpleUnitsTest(a,b,c,d)}));if(a.units||b){if(a.units){if(a.units===b)return a;var e=convertUnits(a.units,b,!1);if(0==e)throw isLocal()&&(console.log(a.units),console.log(b)),{msg:getText("Wrong units generated. Expected %s, and got %s.","<i>"+clean(b?b.toString():"unitless")+"</i>","<i>"+clean(a.units?a.units.toString():"unitless")+"</i>"),primitive:c,showEditor:d};a.value*=e;a.units=b;return a}a.units=
b}return a}function handleErrorObject(a){isLocal()&&(console.log(a),console.trace&&console.trace());if(a.msg){if(isDefined(a.primitive)){var b=findID(a.primitive.id);highlight(b);a.showEditor&&showEditor(b,[{type:"error",row:void 0!==a.line?a.line-1:evaluatingLine-1,text:a.details?a.details:"Error"}])}mxUtils.alert(a.msg)}else a.error?mxUtils.alert(a):mxUtils.alert(getText("An unknown model simulation error occurred. Please report this issue to the Insight Maker team."))}
function evaluateMacros(a){evaluateTree(trimTree(createTree(a),{}),varBank)}function DNA(a,b){this.type=a.value.nodeName;this.cell=a;b=b||a.id;var c=parseInt(a.id,10);this.id=c==a.id?c:b;this.name=a.getAttribute("name");this.units=null}
function getDNA(a,b){var c=new DNA(a);c.solver=folderSolvers(a,b);if(a){var d=getParent(a);d&&(c.frozen=isTrue(getFrozen(d)))}"Variable"!==c.type&&"Flow"!=c.type||!isTrue(a.getAttribute("ShowSlider"))||(c.slider=!0);if("Flow"==c.type||"Transition"==c.type)null!==a.target&&(c.targetId=orig(a.target).id),null!==a.source&&(c.sourceId=orig(a.source).id);if("Converter"==c.type)c.value=getValue(a);else try{c.value=createTree(getValue(a))}catch(e){isLocal()&&console.log(e);d=getText("The primitive %s has an equation error that must be corrected before the model can be run.",
"<i>["+clean(c.name)+"]</i>");e.substr&&"MSG:"==e.substr(0,4)&&(d+="<br/><br/>"+e.toString().substr(4));var f=void 0;e.match&&e.match(/line (\d+)/i)&&(f=e.match(/line (\d+)/i)[1]);error(d,a,!0,f,e.match?e:void 0)}if("Action"==c.type){c.trigger=a.getAttribute("Trigger");c.repeat=isTrue(a.getAttribute("Repeat"));c.recalculate=isTrue(a.getAttribute("Recalculate"))||"Condition"==c.trigger;try{c.triggerValue=createTree(""+a.getAttribute("Value"))}catch(g){d=getText("The trigger for %s has an equation error that must be corrected before the model can be run.",
"<i>["+clean(c.name)+"]</i>"),g.substr&&"MSG:"==g.substr(0,4)&&(d+="<br/><br/>"+g.toString().substr(4)),error(d,c.cell,!1,f)}}else if("Transition"==c.type)c.trigger=a.getAttribute("Trigger"),c.repeat=isTrue(a.getAttribute("Repeat")),c.recalculate=isTrue(a.getAttribute("Recalculate"))||"Condition"==c.trigger;else if("State"==c.type)if(isUndefined(a.getAttribute("Residency"))||""==a.getAttribute("Residency").trim())c.residency=null;else try{c.residency=evaluateTree(trimTree(createTree(a.getAttribute("Residency")),
{})),c.residency.units||(c.residency.units=simulate.timeUnits),eq(c.residency,new Material(0,simulate.timeUnits))&&(c.residency=null)}catch(k){throw isLocal()&&console.log(k),{msg:getText("Invalid state residency."),primitive:a,showEditor:!1};}else if("Stock"==c.type){if(c.nonNegative=isTrue(a.getAttribute("NonNegative")),"Conveyor"==a.getAttribute("StockMode")){c.stockType="Conveyor";try{c.delay=evaluateTree(trimTree(createTree(a.getAttribute("Delay")),{})),c.delay.units||(c.delay.units=simulate.timeUnits)}catch(l){throw isLocal()&&
console.log(l),{msg:getText("Invalid stock delay."),primitive:a,showEditor:!1};}}}else if("Flow"==c.type)c.onlyPositive=isTrue(a.getAttribute("OnlyPositive"));else if("Converter"==c.type){c.source=a.getAttribute("Source");c.interpolation="Linear"==a.getAttribute("Interpolation")?"linear":"discrete";if(isUndefined(a.getAttribute("Data"))||""==a.getAttribute("Data").trim())throw{msg:getText("The converter %s does not have any data.","<i>"+clean(c.name)+"</i>"),primitive:a,showEditor:!0};var f=a.getAttribute("Data").split(";"),
d=[],m=[],n;n="Time"==c.source?simulate.timeUnits:createUnitStore(orig(findID(c.source)).getAttribute("Units"));for(var p=0;p<f.length;p++){var q=f[p].split(",");d.push(new Material(sn(q[0].trim()),n));m.push(new Material(sn(q[1].trim())))}c.inputs=d;c.outputs=m}if("State"!=c.type){if("Transition"!=c.type&&"Action"!=c.type){f=a.getAttribute("Units");try{"Flow"!=c.type||f&&""!=f.trim()&&"unitless"!=f.trim().toLowerCase()?c.units=createUnitStore(f):(c.units=getUnitStore([timeUnits],[-1]),c.flowUnitless=
!0)}catch(u){throw isLocal()&&console.log(u),{msg:getText('Invalid units specified for primitive: "%s".',clean(f)),primitive:a,showEditor:!0};}}else"Timeout"==c.trigger&&(c.units=simulate.timeUnits);c.maxConstraint=a.getAttribute("MaxConstraint");c.maxConstraintType=isTrue(a.getAttribute("MaxConstraintUsed"))?1:null;c.minConstraint=a.getAttribute("MinConstraint");c.minConstraintType=isTrue(a.getAttribute("MinConstraintUsed"))?1:null}c.units?(c.units.addBase(),c.toBase=c.units.toBase):c.toBase=1;c.unitless=
!c.units;return c}function folderSolvers(a,b){if(!a||null==a)return b.base;if("Agents"==a.value.nodeName){var c=a.getAttribute("Agent");if(b[c])return b[c]}return(c=getParent(a))&&b[c.id]?b[c.id]:folderSolvers(c,b)}
function decodeDNA(a,b){var c=a.type,d;"Variable"==c?d=new Variable:"State"==c?d=new State:"Transition"==c?d=new Transition:"Action"==c?d=new Action:"Stock"==c?d=new Stock:"Flow"==c?d=new Flow:"Converter"==c&&(d=new Converter);d?(d.dna=a,d.id=a.id,d.index=b.index,d.agentId=b.agentId,d.container=b,d.createIds(),d.frozen=a.frozen,b.children.push(d),b.childrenId[d.id]=d,a.slider&&(simulate.sliders[a.id]?simulate.sliders[a.id].push(d):simulate.sliders[a.id]=[d]),d instanceof Action?a.solver.actions.push(d):
d instanceof Transition?a.solver.transitions.push(d):d instanceof Agents||(a.solver.valued.push(d),d instanceof Flow?a.solver.flows.push(d):d instanceof Stock?a.solver.stocks.push(d):d instanceof State&&a.solver.states.push(d))):"Agents"==c&&(b.children.push(a.agents),b.childrenId[a.id]=a)}
function linkPrimitive(a,b){var c=b.type;if("Agents"!=c){var d=getPrimitiveNeighborhood(a,b);if("Flow"==c||"Transition"==c){var e=null,f=null;d["[alpha"]&&(e=d["[alpha"],d.alpha||(d.alpha=e));d["[omega"]&&(f=d["[omega"],d.omega||(d.omega=f));a.setEnds(e,f)}if("Action"==c){try{a.equation=trimTree(b.triggerValue,d)}catch(g){var k=getText("The primitive %s has an equation error that must be corrected before the model can be run.","<i>["+clean(b.name)+"]</i>");g.substr&&"MSG:"==g.substr(0,4)&&(k+="<br/><br/>"+
g.toString().substr(4));error(k,b.cell,!1,m)}try{a.action=trimTree(b.value,d)}catch(l){k=getText("The primitive %s has an equation error that must be corrected before the model can be run.","<i>["+clean(b.name)+"]</i>");l.substr&&"MSG:"==l.substr(0,4)&&(k+="<br/><br/>"+l.toString().substr(4));var m=void 0;l.match&&l.match(/line (\d+)/i)&&(m=l.match(/line (\d+)/i)[1]);error(k,b.cell,!0,m,l.match?l:void 0)}}else if("Converter"==c)if("Time"==b.source)a.setSource("*time");else{m=orig(findID(b.source)).id;
c=!1;for(k in d)if(m==d[k].id){a.setSource(d[k]);c=!0;break}c||error("Converter source could not be found. Please redefine it.",b.cell,!1)}else a.setEquation(b.value,d)}}
function setAgentInitialValues(a){for(var b=0;b<a.children.length;b++)if(a.children[b]instanceof Stock){a.children[b].setDelay();try{a.children[b].setInitialValue()}catch(c){if(isLocal()&&console.log(c),c instanceof String)error(c.substr(4,c.length),a.children[b],!0);else throw c;}}else if(a.children[b]instanceof State)try{null===a.children[b].active&&a.children[b].setInitialActive(!0)}catch(d){if(isLocal()&&console.log(d),d instanceof String)error(d.substr(4,d.length),a.children[b],!0);else throw d;
}}function buildNetwork(a){if("Custom Function"==a.network)for(var b=getPrimitiveNeighborhood(a,a.dna),c=trimTree(createTree(a.networkFunction),b),d=0;d<a.agents.length-1;d++)for(var e=d+1;e<a.agents.length;e++)trueValue(simpleEquation(a.networkFunction,{"-parent":varBank,a:a.agents[d],b:a.agents[e]},b,c))&&a.agents[d].connect(a.agents[e]);else if("None"!=a.network)throw{msg:"Unknown network type: "+a.network+".",primitive:a.cell,showEditor:!1};}
function buildPlacements(a,b){var c,d,e;if("Random"==a.placement)a.agents.forEach(function(b){b.location=new Vector([mult(a.geoWidth,new Material(Rand())),mult(a.geoHeight,new Material(Rand()))],["x","y"])});else if("Custom Function"==a.placement)a.agents.forEach(function(b){var c=getPrimitiveNeighborhood(a,a.dna);c.self=b;b.location=simpleUnitsTest(simpleEquation(a.placementFunction,{"-parent":varBank,self:b},c),a.geoDimUnitsObject);b.location.names||(b.location.names=["x","y"],b.location.namesLC=
["x","y"])});else if("Grid"==a.placement){c=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{});var f=a.agents.length,g=simpleNum(simpleEquation("width(self)/height(self)",{"-parent":varBank,self:a},{}),a.geoDimUnitsObject);e=Math.sqrt(f/g);d=Math.floor(e*g);e=Math.ceil(e);!e*d>=f&&(d+=1);var k=0;a.agents.forEach(function(b){var f=(Math.floor(k/d)+0.5)/e;b.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",{self:b,x:new Material((k%d+0.5)/d),y:new Material(f),
"-parent":varBank},{},c),a.geoDimUnitsObject);k++})}else if("Ellipse"==a.placement)c=trimTree(createTree("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), height(self)}/2"),{}),f=new Material(a.agents.length),a.agents.forEach(function(b){b.location=simpleUnitsTest(simpleEquation("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), heigh(self)}/2",{self:b,size:f,"-parent":varBank},
{},c),a.geoDimUnitsObject)});else if("Network"==a.placement){c=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{});var l=new Graph,m=a.agents.map(function(a){return l.newNode({data:a})}),n=function(a){for(var b=0;b<m.length;b++)if(m[b].data.data===a)return m[b];return null};a.agents.forEach(function(a){a.connected.forEach(function(b){l.newEdge(n(a),n(b))})});for(var g=new Layout.ForceDirected(l,400,600,0.5),p=0;60>p;p++)g.applyCoulombsLaw(),g.applyHookesLaw(),g.attractToCentre(),g.updateVelocity(0.03),
g.updatePosition(0.03);var q=g.getBoundingBox();q.width=q.topright.x-q.bottomleft.x;q.height=q.topright.y-q.bottomleft.y;g.eachNode(function(b,d){var e=(d.p.y-q.bottomleft.y)/q.height;b.data.data.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",{self:a,x:new Material((d.p.x-q.bottomleft.x)/q.width),y:new Material(e),"-parent":varBank},{},c),a.geoDimUnitsObject)})}else throw{msg:"Unknown placement type: "+a.placement+".",primitive:a.cell,showEditor:!1};}
var allPlaceholders={};
function getPrimitiveNeighborhood(a,b){var c=neighborhood(b.cell),d=allPlaceholders[b.id]?allPlaceholders[b.id]:{},e={self:a};if(!c.placeholders&&"Agents"==b.type)for(var f=0;f<a.DNAs.length;f++)d[a.DNAs[f].name.toLowerCase()]=new Placeholder(a.DNAs[f],a);for(var g=0;g<c.length;g++){var k=c[g].item;if("Agents"==k.value.nodeName){if(e[model.submodels[k.id].dna.name.toLowerCase()]=model.submodels[k.id],!c.placeholders)for(f=0;f<model.submodels[k.id].DNAs.length;f++)e[model.submodels[k.id].DNAs[f].name.toLowerCase()]=new Placeholder(model.submodels[k.id].DNAs[f],
a)}else if("agent"!=c[g].type){f=!1;if(a.container&&a.container.childrenId[k.id]){var l=a.container.childrenId[k.id].dna.name.toLowerCase();e[l]=a.container.childrenId[k.id];f=!0}!f&&model.submodels.base.agents[0].childrenId[k.id]&&(l=model.submodels.base.agents[0].childrenId[k.id].dna.name.toLowerCase(),e[l]=model.submodels.base.agents[0].childrenId[k.id],f=!0);f||"Flow"!=b.type&&"Transition"!=b.type||k!=findID(k.id)||error(b.type+" primitives may not cross agent boundaries.",b.cell,!1);("Flow"==
b.type||"Transition"==b.type)&&e[l]&&(b.targetId==e[l].id?e["[omega"]=e[l]:b.sourceId==e[l].id&&(e["[alpha"]=e[l]))}}c=Object.keys(d);for(f=0;f<c.length;f++)e[c[f]]=d[c[f]];allPlaceholders[b.id]=d;return e}function modelType(a){return!("Link"==a||"Picture"==a||"Text"==a||"Button"==a||"Folder"==a||"Setting"==a||"Display"==a||"Ghost"==a)}
function updateDisplayed(a){var b=a?a.displayed:[];if(simulate.displayInformation.store){if(0<b.length){for(var c=[],d=a.maxLoaded,d=isDefined(d)?d+1:0,e=a.maxLoaded;d<simulate.results.Time.length;d++){var f=simulate.displayInformation.store.getById(d),g={};f||(g.id=d,g.Time=simulate.results.Time[d]);if(!isUndefined(simulate.results.data[d][b[0].id]))for(var e=d,k=0;k<b.length;k++){var l=simulate.displayInformation.ids.indexOf(b[k].id);if(-1<l)if(simulate.results[simulate.displayInformation.ids[l]].states){var m=
simulate.results[simulate.displayInformation.ids[l]].states;if(simulate.results.data[d][b[k].id]){for(var n=simulate.results.data[d][b[k].id].current,p={},q=0;q<n.length;q++)if(n[q].state)for(var u=0;u<n[q].state.length;u++)p[n[q].state[u].id.toString()]=p[n[q].state[u].id.toString()]+1||1;for(q=0;q<m.length;q++)g[simulate.displayInformation.elementIds[l+q]]=p[m[q]]||0}}else if(simulate.results[simulate.displayInformation.ids[l]].indexedNames)for(m=0;l<simulate.displayInformation.ids.length&&simulate.displayInformation.ids[l]==
b[k].id;){try{g[simulate.displayInformation.elementIds[l]]=selectFromMatrix(simulate.results.data[d][b[k].id].fullClone(),simulate.results[simulate.displayInformation.ids[l]].indexedFullNames[m].slice())}catch(v){throw{msg:getText("Cannot change vector keys during a simulation."),primitive:b[k].dna.cell,showEditor:!0};}m++;l++}else g[simulate.displayInformation.elementIds[l]]=simulate.results.data[d][b[k].id]}f?(f.set(g),f.commit()):c.push(g)}a.maxLoaded=e;simulate.displayInformation.store.maxLoaded=
Math.max(simulate.displayInformation.store.maxLoaded,a.maxLoaded);simulate.displayInformation.store.suspendEvents();simulate.displayInformation.store.add(c);simulate.displayInformation.store.resumeEvents();simulate.displayInformation.store.filter()}simulate.resultsWindow||(simulate.resultsWindow=createResultsWindow(simulate.displayInformation,simulate.config),simulate.resultsWindow.scripter.loadTime(0),a=-1==simulate.resultsWindow.scripter.combo.getValue()?200:100/Math.min(0.5,simulate.resultsWindow.scripter.combo.getValue()),
u=simulate.resultsWindow.scripter,simulate.resultsWindow.scripter.animInter=setInterval(function(){u.advanceTimer()},a));simulate.resultsWindow.sliders=simulate.sliders;d==simulate.displayInformation.times.length&&simulate.resultsWindow.scripter.finished()}};RedBlackNode.VERSION=1;function RedBlackNode(a,b){this._right=this._left=null;this._value=a;this._height=1;this.parent=b}RedBlackNode.prototype.add=function(a){var b=a.compare(this._value),c;0!=b?(0>b?null!=this._left?(a=this._left.add(a),this._left=a[0],this._left.parent=this,c=a[1]):c=this._left=new RedBlackNode(a,this):0<b&&(null!=this._right?(a=this._right.add(a),this._right=a[0],this._right.parent=this,c=a[1]):c=this._right=new RedBlackNode(a,this)),a=[this.balanceTree(),c]):a=[this,this];return a};
RedBlackNode.prototype.balanceTree=function(){var a=null!=this._left?this._left._height:0,b=null!=this._right?this._right._height:0;a>b+1?a=this.swingRight():b>a+1?a=this.swingLeft():(this.setHeight(),a=this);return a};RedBlackNode.prototype.join=function(a){if(null==a)a=this;else{var b;this._height>a._height?(b=this,b._right=a.join(b._right),b._right.parent=b):(b=a,b._left=this.join(b._left),b._left.parent=b);a=b.balanceTree()}return a};
RedBlackNode.prototype.moveLeft=function(){var a=this._right;if(this._right=a._left)this._right.parent=this;a._left=this;a._left.parent=a;this.setHeight();a.setHeight();return a};RedBlackNode.prototype.moveRight=function(){var a=this._left;if(this._left=a._right)this._left.parent=this;a._right=this;a._right.parent=a;this.setHeight();a.setHeight();return a};
RedBlackNode.prototype.remove=function(a){var b=a.compare(this._value);if(0!=b){if(0>b)if(null!=this._left){a=this._left.remove(a);if(this._left=a[0])this._left.parent=this;b=a[1]}else b=null;else if(null!=this._right){a=this._right.remove(a);if(this._right=a[0])this._right.parent=this;b=a[1]}else b=null;a=this}else b=this,null==this._left?a=this._right:null==this._right?a=this._left:(a=this._left.join(this._right),this._right=this._left=null);return null!=b?null!=a?[a.balanceTree(),b]:[a,b]:[this,
null]};RedBlackNode.prototype.setHeight=function(){var a=null!=this._left?this._left._height:0,b=null!=this._right?this._right._height:0;this._height=a<b?b+1:a+1};RedBlackNode.prototype.swingLeft=function(){var a=this._right,b=a._left,c=a._right;(null!=b?b._height:0)>(null!=c?c._height:0)&&(this._right=a.moveRight(),this._right.parent=this);return this.moveLeft()};
RedBlackNode.prototype.swingRight=function(){var a=this._left,b=a._right,c=a._left;(null!=b?b._height:0)>(null!=c?c._height:0)&&(this._left=a.moveLeft(),this._left.parent=this);return this.moveRight()};RedBlackNode.prototype.traverse=function(a){null!=this._left&&this._left.traverse(a);a(this);null!=this._right&&this._right.traverse(a)};RedBlackNode.prototype.toString=function(){return this._value.toString()};
RedBlackNode.prototype.validateParents=function(){this._right&&(this._right.parent!==this&&(console.log("Invalid right"),console.log(this)),this._right.validateParents());this._left&&(this._left.parent!==this&&(console.log("Invalid left"),console.log(this)),this._left.validateParents())};RedBlackTree.VERSION=1;function RedBlackTree(){this._cursor=this._root=null}RedBlackTree.prototype._findNode=function(a){for(var b=this._root;null!=b;){var c=a.compare(b._value);if(0!=c)b=0>c?b._left:b._right;else break}return b};RedBlackTree.prototype._maxNode=function(a){null==a&&(a=this._root);if(null!=a)for(;null!=a._right;)a=a._right;return a};RedBlackTree.prototype._minNode=function(a){null==a&&(a=this._root);if(null!=a)for(;null!=a._left;)a=a._left;return a};
RedBlackTree.prototype._nextNode=function(a){if(null!=a)if(null!=a._right)a=this._minNode(a._right);else{for(;null!=a.parent&&a.parent._right===a;)a=a.parent;a=a.parent}else a=this._minNode(this._root);return a};RedBlackTree.prototype._previousNode=function(a){if(null!=a)if(null!=a._left)a=this._maxNode(a._left);else{for(;null!=a.parent&&a.parent._left===a;)a=a.parent;a=a.parent}else a=this._maxNode(this._root);return a};
RedBlackTree.prototype.add=function(a){null==this._root?a=this._root=new RedBlackNode(a):(a=this._root.add(a),this._root=a[0],this._root.parent=null,a=a[1]);return a};RedBlackTree.prototype.find=function(a){a=this._findNode(a);return null!=a?a:null};RedBlackTree.prototype.findNext=function(a){a=this._findNode(a,!0);a=this._nextNode(a);return null!=a?a._value:null};RedBlackTree.prototype.findPrevious=function(a){a=this._findNode(a,!0);a=this._previousNode(a);return null!=a?a._value:null};
RedBlackTree.prototype.max=function(){var a=this._maxNode();return null!=a?a._value:null};RedBlackTree.prototype.min=function(){var a=this._minNode();return null!=a?a._value:null};RedBlackTree.prototype.next=function(){return(this._cursor=this._nextNode(this._cursor))?this._cursor._value:null};RedBlackTree.prototype.previous=function(){return(this._cursor=this._previousNode(this._cursor))?this._cursor._value:null};
RedBlackTree.prototype.remove=function(a){null!=this._root?(a=this._root.remove(a),this._root=a[0],a=a[1]):a=null;return a};RedBlackTree.prototype.goMin=function(){this._cursor=this._minNode(this._root)};RedBlackTree.prototype.goMax=function(){this._cursor=this._maxNode(this._root)};RedBlackTree.prototype.current=function(){return this._cursor?this._cursor._value:null};RedBlackTree.prototype.traverse=function(a){null!=this._root&&this._root.traverse(a)};
RedBlackTree.prototype.toString=function(){var a=[];if(null!=this._root)for(var b=[[this._root,0,"^"]];0<b.length;){for(var c=b.pop(),d=c[0],e=c[1],f="",g=0;g<e;g++)f+="  ";f+=c[2]+"("+d.toString()+")";a.push(f);null!=d._right&&b.push([d._right,e+1,"R"]);null!=d._left&&b.push([d._left,e+1,"L"])}return a.join("\n")};RedBlackTree.prototype.validateParents=function(){null!=this._root.parent&&(console.log("Invalid root node parent"),this._root.validateParents());console.log("done")};(function(a){var b={inEffect:{opacity:"show"},inEffectDuration:300,stayTime:4E3,text:"",sticky:!1,type:"notice",position:"top-right",closeText:"",close:null},c={init:function(c){c&&a.extend(b,c)},showToast:function(c){var e={};a.extend(e,b,c);var f,g;c=a(".toast-container").length?a(".toast-container"):a("<div></div>").addClass("toast-container").addClass("toast-position-"+e.position).appendTo("body");f=a("<div></div>").addClass("toast-item-wrapper");g=a("<div></div>").hide().addClass("toast-item toast-type-"+
e.type).appendTo(c).html(a("<p>").append(e.text)).animate(e.inEffect,e.inEffectDuration).wrap(f);a("<div></div>").addClass("toast-item-close").prependTo(g).html(e.closeText).click(function(){a().toastmessage("removeToast",g,e)});a("<div></div>").addClass("toast-item-image").addClass("toast-item-image-"+e.type).prependTo(g);navigator.userAgent.match(/MSIE 6/i)&&c.css({top:document.documentElement.scrollTop});e.sticky||setTimeout(function(){a().toastmessage("removeToast",g,e)},e.stayTime);return g},
showNoticeToast:function(b){b={text:b,type:"notice"};return a().toastmessage("showToast",b)},showSuccessToast:function(b){b={text:b,type:"success"};return a().toastmessage("showToast",b)},showErrorToast:function(b){b={text:b,type:"error"};return a().toastmessage("showToast",b)},showWarningToast:function(b){b={text:b,type:"warning"};return a().toastmessage("showToast",b)},removeToast:function(a,b){a.animate({opacity:"0"},200,function(){a.parent().animate({height:"0px"},300,function(){a.parent().remove()})});
b&&null!==b.close&&b.close()}};a.fn.toastmessage=function(b){if(c[b])return c[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof b&&b)a.error("Method "+b+" does not exist on jQuery.toastmessage");else return c.init.apply(this,arguments)}})(jQuery);function X2JS(a){function b(a){var b=a.localName;null==b&&(b=a.baseName);if(null==b||""==b)b=a.nodeName;return b}function c(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function d(b,c,d){switch(a.arrayAccessForm){case "property":b[c+"_asArray"]=b[c]instanceof Array?b[c]:[b[c]]}if(!(b[c]instanceof Array)&&0<a.arrayAccessFormPaths.length){for(var e=0;e<a.arrayAccessFormPaths.length;e++){var f=
a.arrayAccessFormPaths[e];if("string"===typeof f){if(f==d)break}else if(f instanceof RegExp){if(f.test(d))break}else if("function"===typeof f&&f(b,c,d))break}e!=a.arrayAccessFormPaths.length&&(b[c]=[b[c]])}}function e(a){var b=a.split(/[-T:+Z]/g),c=new Date(b[0],b[1]-1,b[2]),d=b[5].split(".");c.setHours(b[3],b[4],d[0]);1<d.length&&c.setMilliseconds(d[1]);b[6]&&b[7]?(b=60*b[6]+Number(b[7]),b=0+("-"==(/\d\d-\d\d:\d\d$/.test(a)?"-":"+")?-1*b:b),c.setMinutes(c.getMinutes()-b-c.getTimezoneOffset())):-1!==
a.indexOf("Z",a.length-1)&&(c=new Date(Date.UTC(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())));return c}function f(b,c,d){if(0<a.datetimeAccessFormPaths.length){d=d.split(".#")[0];for(var f=0;f<a.datetimeAccessFormPaths.length;f++){var g=a.datetimeAccessFormPaths[f];if("string"===typeof g){if(g==d)break}else if(g instanceof RegExp){if(g.test(d))break}else if("function"===typeof g&&g(obj,c,d))break}return f!=a.datetimeAccessFormPaths.length?
e(b):b}return b}function g(c,e){if(c.nodeType==v.DOCUMENT_NODE){for(var k={},l=c.childNodes,m=0;m<l.length;m++){var n=l.item(m);if(n.nodeType==v.ELEMENT_NODE){var p=b(n);k[p]=g(n,p)}}return k}if(c.nodeType==v.ELEMENT_NODE){k={__cnt:0};l=c.childNodes;for(m=0;m<l.length;m++)n=l.item(m),p=b(n),n.nodeType!=v.COMMENT_NODE&&(k.__cnt++,null==k[p]?(k[p]=g(n,e+"."+p),d(k,p,e+"."+p)):(null==k[p]||k[p]instanceof Array||(k[p]=[k[p]],d(k,p,e+"."+p)),k[p][k[p].length]=g(n,e+"."+p)));for(l=0;l<c.attributes.length;l++)m=
c.attributes.item(l),k.__cnt++,k[a.attributePrefix+m.name]=m.value;l=c.prefix;null!=l&&""!=l&&(k.__cnt++,k.__prefix=l);null!=k["#text"]&&(k.__text=k["#text"],k.__text instanceof Array&&(k.__text=k.__text.join("\n")),a.escapeMode&&(k.__text=k.__text.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")),a.stripWhitespaces&&(k.__text=k.__text.trim()),delete k["#text"],"property"==a.arrayAccessForm&&delete k["#text_asArray"],
k.__text=f(k.__text,p,e+"."+p));null!=k["#cdata-section"]&&(k.__cdata=k["#cdata-section"],delete k["#cdata-section"],"property"==a.arrayAccessForm&&delete k["#cdata-section_asArray"]);1==k.__cnt&&null!=k.__text?k=k.__text:0==k.__cnt&&"text"==a.emptyNodeForm?k="":1<k.__cnt&&null!=k.__text&&a.skipEmptyTextNodesForObj&&(a.stripWhitespaces&&""==k.__text||""==k.__text.trim())&&delete k.__text;delete k.__cnt;!a.enableToStringFunc||null==k.__text&&null==k.__cdata||(k.toString=function(){return(null!=this.__text?
this.__text:"")+(null!=this.__cdata?this.__cdata:"")});return k}if(c.nodeType==v.TEXT_NODE||c.nodeType==v.CDATA_SECTION_NODE)return c.nodeValue}function k(b,d,e,f){d="<"+(null!=b&&null!=b.__prefix?b.__prefix+":":"")+d;if(null!=e)for(var g=0;g<e.length;g++){var k=e[g],l=b[k];a.escapeMode&&(l=c(l));d+=" "+k.substr(a.attributePrefix.length)+"='"+l+"'"}return f?d+"/>":d+">"}function l(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function m(b,c){return"property"==a.arrayAccessForm&&-1!==
c.toString().indexOf("_asArray",c.toString().length-8)||0==c.toString().indexOf(a.attributePrefix)||0==c.toString().indexOf("__")||b[c]instanceof Function?!0:!1}function n(a){var b=0;if(a instanceof Object)for(var c in a)m(a,c)||b++;return b}function p(b){var c=[];if(b instanceof Object)for(var d in b)-1==d.toString().indexOf("__")&&0==d.toString().indexOf(a.attributePrefix)&&c.push(d);return c}function q(b){var d="";if(b instanceof Object){var e="";null!=b.__cdata&&(e+="<![CDATA["+b.__cdata+"]]\x3e");
null!=b.__text&&(e=a.escapeMode?e+c(b.__text):e+b.__text);d+=e}else null!=b&&(d=a.escapeMode?d+c(b):d+b);return d}function u(a){var b="";if(0<n(a))for(var c in a)if(!m(a,c)){var d=a[c],e=p(d);if(null==d||void 0==d)b+=k(d,c,e,!0);else if(d instanceof Object)if(d instanceof Array){var f=c,g="";if(0==d.length)g+=k(d,f,e,!0);else for(e=0;e<d.length;e++)g+=k(d[e],f,p(d[e]),!1),g+=u(d[e]),g+=l(d[e],f);b+=g}else d instanceof Date?(b+=k(d,c,e,!1),b+=d.toISOString(),b+=l(d,c)):0<n(d)||null!=d.__text||null!=
d.__cdata?(b+=k(d,c,e,!1),b+=u(d),b+=l(d,c)):b+=k(d,c,e,!0);else b+=k(d,c,e,!1),b+=q(d),b+=l(d,c)}return b+=q(a)}a=a||{};void 0===a.escapeMode&&(a.escapeMode=!0);a.attributePrefix=a.attributePrefix||"_";a.arrayAccessForm=a.arrayAccessForm||"none";a.emptyNodeForm=a.emptyNodeForm||"text";void 0===a.enableToStringFunc&&(a.enableToStringFunc=!0);a.arrayAccessFormPaths=a.arrayAccessFormPaths||[];void 0===a.skipEmptyTextNodesForObj&&(a.skipEmptyTextNodesForObj=!0);void 0===a.stripWhitespaces&&(a.stripWhitespaces=
!0);a.datetimeAccessFormPaths=a.datetimeAccessFormPaths||[];(function(){function a(b){b=String(b);1===b.length&&(b="0"+b);return b}"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")});"function"!==typeof Date.prototype.toISOString&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+
"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"})})();var v={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b=window.ActiveXObject||"ActiveXObject"in window;if(void 0===a)return null;var c;if(window.DOMParser){var d=new window.DOMParser,e=null;if(!b)try{e=d.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(f){e=null}try{c=d.parseFromString(a,"text/xml"),null!=e&&0<c.getElementsByTagNameNS(e,
"parsererror").length&&(c=null)}catch(g){c=null}}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a);return c};this.asArray=function(a){return a instanceof Array?a:[a]};this.toXmlDateTime=function(a){return a instanceof Date?a.toISOString():"number"===typeof a?(new Date(a)).toISOString():null};this.asDateTime=function(a){return"string"==typeof a?e(a):a};this.xml2json=function(a){return g(a)};this.xml_str2json=function(a){a=
this.parseXmlString(a);return null!=a?this.xml2json(a):null};this.json2xml_str=function(a){return u(a)};this.json2xml=function(a){a=this.json2xml_str(a);return this.parseXmlString(a)};this.getVersion=function(){return"1.1.5"}};function ElementaryCyclesSearch(a,b){this.cycles=[];this.adjList=a;this.graphNodes=b;this.blocked=[];this.B=[];this.stack=[]}
ElementaryCyclesSearch.prototype.getElementaryCycles=function(){this.cycles=[];this.blocked=this.adjList.map(function(){return!1});this.B=this.adjList.map(function(){return null});this.stack=[];for(var a=new StrongConnectedComponents(this.adjList),b=0;;)if(b=a.getAdjacencyList(b),null!=b&&null!=b.getAdjList()){for(var c=b.getAdjList(),b=b.getLowestNodeId(),d=0;d<c.length;d++)null!=c[d]&&0<c[d].length&&(this.blocked[d]=!1,this.B[d]=[]);this.findCycles(b,b,c);b++}else break;return this.cycles.map(function(a){return a.reverse()})};
ElementaryCyclesSearch.prototype.findCycles=function(a,b,c){var d=!1;this.stack.push(a);this.blocked[a]=!0;for(var e=0;e<c[a].length;e++){var f=c[a][e];if(f==b){d=[];for(f=0;f<this.stack.length;f++)d.push(this.graphNodes[this.stack[f]]);this.cycles.push(d);d=!0}else this.blocked[f]||this.findCycles(f,b,c)&&(d=!0)}if(d)this.unblock(a);else for(e=0;e<c[a].length;e++)f=c[a][e],-1==this.B[f].indexOf(a)&&this.B[f].push(a);this.stack.splice(this.stack.indexOf(a),1);return d};
ElementaryCyclesSearch.prototype.unblock=function(a){this.blocked[a]=!1;for(a=this.B[a];0<a.length;){var b=a[0];a.splice(0,1);this.blocked[b]&&this.unblock(b)}};function StrongConnectedComponents(a){this.adjListOriginal=a;this.number=this.lowlink=this.stack=this.visited=this.adjList=null;this.sccCounter=0;this.currentSCCs=null}
StrongConnectedComponents.prototype.getAdjacencyList=function(a){this.visited=this.adjListOriginal.map(function(){return!1});this.lowlink=this.adjListOriginal.map(function(){return 0});this.number=this.adjListOriginal.map(function(){return 0});this.visited=this.adjListOriginal.map(function(){return!1});this.stack=[];this.currentSCCs=[];this.makeAdjListSubgraph(a);for(var b=a;b<this.adjListOriginal.length;b++)if(!this.visited[b]){this.getStrongConnectedComponents(b);var c=this.getLowestIdComponent();
if(null!=c&&-1==c.indexOf(a)&&-1==c.indexOf(a+1))return this.getAdjacencyList(a+1);c=this.getAdjList(c);if(null!=c)for(var d=0;d<this.adjListOriginal.length;d++)if(0<c[d].length)return new SCCResult(c,d)}return null};
StrongConnectedComponents.prototype.makeAdjListSubgraph=function(a){this.adjList=this.adjListOriginal.map(function(a){return[]});for(var b=a;b<this.adjList.length;b++){for(var c=[],d=0;d<this.adjListOriginal[b].length;d++)this.adjListOriginal[b][d]>=a&&c.push(this.adjListOriginal[b][d]);if(0<c.length)for(this.adjList[b]=c.map(function(a){return 0}),d=0;d<c.length;d++)this.adjList[b][d]=c[d]}};
StrongConnectedComponents.prototype.getLowestIdComponent=function(){for(var a=this.adjList.length,b=null,c=0;c<this.currentSCCs.length;c++)for(var d=this.currentSCCs[c],e=0;e<d.length;e++){var f=d[e];f<a&&(b=d,a=f)}return b};StrongConnectedComponents.prototype.getAdjList=function(a){a=a||null;var b=null;if(null!=a)for(var b=this.adjList.map(function(a){return[]}),c=0;c<a.length;c++)for(var d=a[c],e=0;e<this.adjList[d].length;e++){var f=this.adjList[d][e];-1<a.indexOf(f)&&b[d].push(f)}return b};
StrongConnectedComponents.prototype.getStrongConnectedComponents=function(a){this.sccCounter++;this.lowlink[a]=this.sccCounter;this.number[a]=this.sccCounter;this.visited[a]=!0;this.stack.push(a);for(var b=0;b<this.adjList[a].length;b++){var c=this.adjList[a][b];this.visited[c]?this.number[c]<this.number[a]&&-1<this.stack.indexOf(c)&&(this.lowlink[a]=Math.min(this.lowlink[a],this.number[c])):(this.getStrongConnectedComponents(c),this.lowlink[a]=Math.min(this.lowlink[a],this.lowlink[c]))}if(this.lowlink[a]==
this.number[a]&&0<this.stack.length){b=-1;c=[];do b=this.stack[this.stack.length-1],this.stack.splice(this.stack.length-1,1),c.push(b);while(this.number[b]>this.number[a]);1<c.length&&this.currentSCCs.push(c)}};function SCCResult(a,b){this.adjList=a;this.lowestNodeId=b}SCCResult.prototype.getAdjList=function(){return this.adjList};SCCResult.prototype.getLowestNodeId=function(){return this.lowestNodeId};var Graph=function(){this.nodeSet={};this.nodes=[];this.edges=[];this.adjacency={};this.nextEdgeId=this.nextNodeId=0;this.eventListeners=[]},Node=function(a,b){this.id=a;this.data="undefined"!==typeof b?b:{}},Edge=function(a,b,c,d){this.id=a;this.source=b;this.target=c;this.data="undefined"!==typeof d?d:{}};Graph.prototype.addNode=function(a){"undefined"===typeof this.nodeSet[a.id]&&this.nodes.push(a);this.nodeSet[a.id]=a;this.notify();return a};
Graph.prototype.addEdge=function(a){var b=!1;this.edges.forEach(function(c){a.id===c.id&&(b=!0)});b||this.edges.push(a);"undefined"===typeof this.adjacency[a.source.id]&&(this.adjacency[a.source.id]={});"undefined"===typeof this.adjacency[a.source.id][a.target.id]&&(this.adjacency[a.source.id][a.target.id]=[]);b=!1;this.adjacency[a.source.id][a.target.id].forEach(function(c){a.id===c.id&&(b=!0)});b||this.adjacency[a.source.id][a.target.id].push(a);this.notify();return a};
Graph.prototype.newNode=function(a){a=new Node(this.nextNodeId++,a);this.addNode(a);return a};Graph.prototype.newEdge=function(a,b,c){a=new Edge(this.nextEdgeId++,a,b,c);this.addEdge(a);return a};Graph.prototype.getEdges=function(a,b){return"undefined"!==typeof this.adjacency[a.id]&&"undefined"!==typeof this.adjacency[a.id][b.id]?this.adjacency[a.id][b.id]:[]};
Graph.prototype.removeNode=function(a){"undefined"!==typeof this.nodeSet[a.id]&&delete this.nodeSet[a.id];for(var b=this.nodes.length-1;0<=b;b--)this.nodes[b].id===a.id&&this.nodes.splice(b,1);this.detachNode(a)};Graph.prototype.detachNode=function(a){this.edges.slice().forEach(function(b){b.source.id!==a.id&&b.target.id!==a.id||this.removeEdge(b)},this);this.notify()};
Graph.prototype.removeEdge=function(a){for(var b=this.edges.length-1;0<=b;b--)this.edges[b].id===a.id&&this.edges.splice(b,1);for(var c in this.adjacency)for(var d in this.adjacency[c])for(b=this.adjacency[c][d].length-1;0<=b;b--)this.adjacency[c][d][b].id===a.id&&this.adjacency[c][d].splice(b,1);this.notify()};
Graph.prototype.merge=function(a){var b=[];a.nodes.forEach(function(a){b.push(this.addNode(new Node(a.id,a.data)))},this);a.edges.forEach(function(a){var d=b[a.from],e=b[a.to],f=a.directed?f=a.type+"-"+d.id+"-"+e.id:d.id<e.id?a.type+"-"+d.id+"-"+e.id:a.type+"-"+e.id+"-"+d.id;this.addEdge(new Edge(f,d,e,a.data)).data.type=a.type},this)};Graph.prototype.filterNodes=function(a){this.nodes.slice().forEach(function(b){a(b)||this.removeNode(b)},this)};
Graph.prototype.filterEdges=function(a){this.edges.slice().forEach(function(b){a(b)||this.removeEdge(b)},this)};Graph.prototype.addGraphListener=function(a){this.eventListeners.push(a)};Graph.prototype.notify=function(){this.eventListeners.forEach(function(a){a.graphChanged()})};var Layout={ForceDirected:function(a,b,c,d){this.graph=a;this.stiffness=b;this.repulsion=c;this.damping=d;this.nodePoints={};this.edgeSprings={}}};
Layout.ForceDirected.prototype.point=function(a){if("undefined"===typeof this.nodePoints[a.id]){var b="undefined"!==typeof a.data.mass?a.data.mass:1;this.nodePoints[a.id]=new Layout.ForceDirected.Point(gVector.random(),b)}return this.nodePoints[a.id]};
Layout.ForceDirected.prototype.spring=function(a){if("undefined"===typeof this.edgeSprings[a.id]){var b="undefined"!==typeof a.data.length?a.data.length:1,c=!1,d=this.graph.getEdges(a.source,a.target);d.forEach(function(a){!1===c&&"undefined"!==typeof this.edgeSprings[a.id]&&(c=this.edgeSprings[a.id])},this);if(!1!==c)return new Layout.ForceDirected.Spring(c.point1,c.point2,0,0);this.graph.getEdges(a.target,a.source);d.forEach(function(a){!1===c&&"undefined"!==typeof this.edgeSprings[a.id]&&(c=this.edgeSprings[a.id])},
this);if(!1!==c)return new Layout.ForceDirected.Spring(c.point2,c.point1,0,0);this.edgeSprings[a.id]=new Layout.ForceDirected.Spring(this.point(a.source),this.point(a.target),b,this.stiffness)}return this.edgeSprings[a.id]};Layout.ForceDirected.prototype.eachNode=function(a){var b=this;this.graph.nodes.forEach(function(c){a.call(b,c,b.point(c))})};Layout.ForceDirected.prototype.eachEdge=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,c,b.spring(c))})};
Layout.ForceDirected.prototype.eachSpring=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,b.spring(c))})};Layout.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(a,b){this.eachNode(function(a,d){if(b!==d){var e=b.p.subtract(d.p),f=e.magnitude()+0.1,e=e.normalise();b.applyForce(e.multiply(this.repulsion).divide(f*f*0.5));d.applyForce(e.multiply(this.repulsion).divide(f*f*-0.5))}})})};
Layout.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(a){var b=a.point2.p.subtract(a.point1.p),c=a.length-b.magnitude(),b=b.normalise();a.point1.applyForce(b.multiply(a.k*c*-0.5));a.point2.applyForce(b.multiply(a.k*c*0.5))})};Layout.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(a,b){var c=b.p.multiply(-1);b.applyForce(c.multiply(this.repulsion/50))})};
Layout.ForceDirected.prototype.updateVelocity=function(a){this.eachNode(function(b,c){c.v=c.v.add(c.a.multiply(a)).multiply(this.damping);c.a=new gVector(0,0)})};Layout.ForceDirected.prototype.updatePosition=function(a){this.eachNode(function(b,c){c.p=c.p.add(c.v.multiply(a))})};Layout.ForceDirected.prototype.totalEnergy=function(a){var b=0;this.eachNode(function(a,d){var e=d.v.magnitude();b+=0.5*d.m*e*e});return b};var __bind=function(a,b){return function(){return a.apply(b,arguments)}};
Layout.requestAnimationFrame=__bind(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,10)},window);
Layout.ForceDirected.prototype.start=function(a,b,c){var d=this;this._started||(this._started=!0,Layout.requestAnimationFrame(function f(){d.applyCoulombsLaw();d.applyHookesLaw();d.attractToCentre();d.updateVelocity(0.03);d.updatePosition(0.03);"undefined"!==typeof b&&b();0.01>d.totalEnergy()?(d._started=!1,"undefined"!==typeof c&&c()):Layout.requestAnimationFrame(f)}))};
Layout.ForceDirected.prototype.nearest=function(a){var b={node:null,point:null,distance:null},c=this;this.graph.nodes.forEach(function(d){var e=c.point(d),f=e.p.subtract(a).magnitude();if(null===b.distance||f<b.distance)b={node:d,point:e,distance:f}});return b};
Layout.ForceDirected.prototype.getBoundingBox=function(){var a=new gVector(-2,-2),b=new gVector(2,2);this.eachNode(function(c,e){e.p.x<a.x&&(a.x=e.p.x);e.p.y<a.y&&(a.y=e.p.y);e.p.x>b.x&&(b.x=e.p.x);e.p.y>b.y&&(b.y=e.p.y)});var c=b.subtract(a).multiply(0.07);return{bottomleft:a.subtract(c),topright:b.add(c)}};gVector=function(a,b){this.x=a;this.y=b};gVector.random=function(){return new gVector(10*(Math.random()-0.5),10*(Math.random()-0.5))};
gVector.prototype.add=function(a){return new gVector(this.x+a.x,this.y+a.y)};gVector.prototype.subtract=function(a){return new gVector(this.x-a.x,this.y-a.y)};gVector.prototype.multiply=function(a){return new gVector(this.x*a,this.y*a)};gVector.prototype.divide=function(a){return new gVector(this.x/a||0,this.y/a||0)};gVector.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};gVector.prototype.normal=function(){return new gVector(-this.y,this.x)};
gVector.prototype.normalise=function(){return this.divide(this.magnitude())};Layout.ForceDirected.Point=function(a,b){this.p=a;this.m=b;this.v=new gVector(0,0);this.a=new gVector(0,0)};Layout.ForceDirected.Point.prototype.applyForce=function(a){this.a=this.a.add(a.divide(this.m))};Layout.ForceDirected.Spring=function(a,b,c,d){this.point1=a;this.point2=b;this.length=c;this.k=d};
function Renderer(a,b,c,d,e){this.interval=a;this.layout=b;this.clear=c;this.drawEdge=d;this.drawNode=e;this.layout.graph.addGraphListener(this)}Renderer.prototype.graphChanged=function(a){this.start()};Renderer.prototype.start=function(){var a=this;this.layout.start(50,function(){a.clear();a.layout.eachEdge(function(b,c){a.drawEdge(b,c.point1.p,c.point2.p)});a.layout.eachNode(function(b,c){a.drawNode(b,c.p)})})};
